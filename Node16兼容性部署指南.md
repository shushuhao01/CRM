# ğŸ”§ Node.js 16ç‰ˆæœ¬å…¼å®¹æ€§éƒ¨ç½²æŒ‡å—

## âš ï¸ ç‰ˆæœ¬å…¼å®¹æ€§è¯´æ˜

æ‚¨çš„å®å¡”é¢æ¿ç¯å¢ƒï¼š
- **Node.jsç‰ˆæœ¬**ï¼š16.20.2
- **NPMç‰ˆæœ¬**ï¼š8.19.4
- **V8ç‰ˆæœ¬**ï¼š9.4.146.26

é¡¹ç›®è¦æ±‚ï¼š
- **å‰ç«¯é¡¹ç›®**ï¼šNode.js 20+ ï¼ˆéœ€è¦è°ƒæ•´ï¼‰
- **åç«¯é¡¹ç›®**ï¼šNode.js 16+ ï¼ˆå…¼å®¹ï¼‰

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šå‡çº§Node.jsç‰ˆæœ¬ï¼ˆæ¨èï¼‰

#### åœ¨å®å¡”é¢æ¿ä¸­å‡çº§Node.js
1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥ **è½¯ä»¶å•†åº—** â†’ **è¿è¡Œç¯å¢ƒ**
3. æ‰¾åˆ° **Node.jsé¡¹ç›®ç®¡ç†å™¨**
4. å®‰è£… **Node.js 18.x** æˆ– **Node.js 20.x** ç‰ˆæœ¬
5. è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬

#### éªŒè¯å‡çº§
```bash
node --version  # åº”æ˜¾ç¤º 18.x æˆ– 20.x
npm --version   # åº”æ˜¾ç¤º 9.x æˆ– 10.x
```

### æ–¹æ¡ˆäºŒï¼šä¿®æ”¹é¡¹ç›®é…ç½®å…¼å®¹Node.js 16

å¦‚æœæ— æ³•å‡çº§Node.jsç‰ˆæœ¬ï¼Œå¯ä»¥ä¿®æ”¹é¡¹ç›®é…ç½®ï¼š

#### 1. ä¿®æ”¹å‰ç«¯package.json
```json
{
  "engines": {
    "node": ">=16.20.0"
  }
}
```

#### 2. åˆ›å»º.nvmrcæ–‡ä»¶
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º
echo "16.20.2" > .nvmrc
```

#### 3. ä¿®æ”¹æ„å»ºè„šæœ¬
```json
{
  "scripts": {
    "build": "vite build --target es2020",
    "build-only": "vite build --target es2020"
  }
}
```

## ğŸš€ Node.js 16ç‰ˆæœ¬éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡å…¼å®¹æ€§æ–‡ä»¶

#### 1. æ›´æ–°å‰ç«¯é…ç½®
```bash
# åœ¨æœ¬åœ°ä¿®æ”¹package.json
# å°† "node": "^20.19.0 || >=22.12.0" 
# æ”¹ä¸º "node": ">=16.20.0"
```

#### 2. é‡æ–°æ„å»ºå‰ç«¯ï¼ˆå¦‚éœ€è¦ï¼‰
```bash
# å¦‚æœé‡åˆ°æ„å»ºé—®é¢˜ï¼Œä½¿ç”¨å…¼å®¹æ€§æ„å»º
npm run build -- --target es2020
```

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ å’Œé…ç½®

#### 1. ä¸Šä¼ é¡¹ç›®æ–‡ä»¶
- å°†æ•´ä¸ªCRMç›®å½•ä¸Šä¼ åˆ°ï¼š`/www/wwwroot/crm`
- ç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®

#### 2. é…ç½®Node.jsé¡¹ç›®
```bash
# é¡¹ç›®é…ç½®
é¡¹ç›®è·¯å¾„: /www/wwwroot/crm/backend
å¯åŠ¨æ–‡ä»¶: dist/app.js
ç«¯å£: 3000
Nodeç‰ˆæœ¬: 16.20.2
```

#### 3. å®‰è£…ä¾èµ–ï¼ˆå…¼å®¹æ€§å®‰è£…ï¼‰
```bash
cd /www/wwwroot/crm/backend

# ä½¿ç”¨npm 8.xå®‰è£…ä¾èµ–
npm install --production --legacy-peer-deps

# å¦‚æœé‡åˆ°æƒé™é—®é¢˜
npm install --production --legacy-peer-deps --unsafe-perm
```

### ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨æœåŠ¡

#### 1. ç›´æ¥å¯åŠ¨æµ‹è¯•
```bash
cd /www/wwwroot/crm/backend
node dist/app.js
```

#### 2. ä½¿ç”¨PM2å¯åŠ¨
```bash
# ä¿®æ”¹ecosystem.config.jsä¸­çš„nodeç‰ˆæœ¬è¦æ±‚
pm2 start ecosystem.config.js --env production

# æˆ–è€…ç›´æ¥å¯åŠ¨
pm2 start dist/app.js --name crm-backend
```

## ğŸ” å¸¸è§é—®é¢˜è§£å†³

### 1. å‰ç«¯æ„å»ºå¤±è´¥
```bash
# é”™è¯¯ï¼šNode.jsç‰ˆæœ¬ä¸å…¼å®¹
# è§£å†³ï¼šä½¿ç”¨å…¼å®¹æ€§æ„å»ºå‘½ä»¤
npm run build -- --target es2020 --legacy-peer-deps
```

### 2. åç«¯ä¾èµ–å®‰è£…å¤±è´¥
```bash
# é”™è¯¯ï¼šæŸäº›åŒ…éœ€è¦Node.js 18+
# è§£å†³ï¼šä½¿ç”¨legacyæ¨¡å¼
npm install --legacy-peer-deps --production
```

### 3. TypeScriptç¼–è¯‘é”™è¯¯
```bash
# é”™è¯¯ï¼šES2022è¯­æ³•ä¸æ”¯æŒ
# è§£å†³ï¼šä¿®æ”¹tsconfig.json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020"]
  }
}
```

### 4. PM2å¯åŠ¨å¤±è´¥
```bash
# é”™è¯¯ï¼šPM2ç‰ˆæœ¬ä¸å…¼å®¹
# è§£å†³ï¼šç›´æ¥ä½¿ç”¨nodeå¯åŠ¨
node dist/app.js

# æˆ–è€…æ›´æ–°PM2
npm install -g pm2@latest
```

## ğŸ“‹ Node.js 16å…¼å®¹æ€§æ£€æŸ¥æ¸…å•

### å‰ç«¯å…¼å®¹æ€§
- [ ] ä¿®æ”¹package.jsonä¸­çš„engineså­—æ®µ
- [ ] ä½¿ç”¨--target es2020æ„å»º
- [ ] æ£€æŸ¥ä¾èµ–åŒ…å…¼å®¹æ€§
- [ ] éªŒè¯æ„å»ºäº§ç‰©æ­£å¸¸

### åç«¯å…¼å®¹æ€§
- [ ] ç¡®è®¤TypeScriptç¼–è¯‘ç›®æ ‡ä¸ºES2020
- [ ] æ£€æŸ¥æ‰€æœ‰ä¾èµ–åŒ…æ”¯æŒNode.js 16
- [ ] æµ‹è¯•æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] éªŒè¯APIæ¥å£å“åº”

### éƒ¨ç½²éªŒè¯
- [ ] Node.jsç‰ˆæœ¬ç¡®è®¤ï¼š16.20.2
- [ ] ä¾èµ–å®‰è£…æˆåŠŸ
- [ ] æœåŠ¡å¯åŠ¨æ­£å¸¸
- [ ] æ•°æ®åº“è¿æ¥æˆåŠŸ
- [ ] å‰ç«¯é¡µé¢åŠ è½½æ­£å¸¸
- [ ] APIæ¥å£è°ƒç”¨æˆåŠŸ

## ğŸ¯ æ¨èçš„éƒ¨ç½²æµç¨‹

### 1. æœ¬åœ°å‡†å¤‡ï¼ˆå¦‚æœéœ€è¦é‡æ–°æ„å»ºï¼‰
```bash
# ä¿®æ”¹å‰ç«¯é…ç½®å…¼å®¹Node.js 16
# é‡æ–°æ„å»ºå‰ç«¯é¡¹ç›®
npm run build -- --target es2020
```

### 2. æœåŠ¡å™¨éƒ¨ç½²
```bash
# ä¸Šä¼ æ–‡ä»¶
# é…ç½®Node.jsé¡¹ç›®
# å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨legacyæ¨¡å¼ï¼‰
# å¯åŠ¨æœåŠ¡
```

### 3. æµ‹è¯•éªŒè¯
```bash
# è®¿é—®ç½‘ç«™
# æµ‹è¯•ç™»å½•
# æ£€æŸ¥åŠŸèƒ½
```

## ğŸ’¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### Node.js 16ç¯å¢ƒä¼˜åŒ–
```bash
# è®¾ç½®Node.jså†…å­˜é™åˆ¶
export NODE_OPTIONS="--max-old-space-size=2048"

# å¯ç”¨å®éªŒæ€§åŠŸèƒ½ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
export NODE_OPTIONS="--experimental-modules"
```

### PM2é…ç½®ä¼˜åŒ–
```javascript
// ecosystem.config.js
module.exports = {
  apps: [{
    name: 'crm-backend',
    script: 'dist/app.js',
    node_args: '--max-old-space-size=2048',
    env_production: {
      NODE_ENV: 'production',
      NODE_OPTIONS: '--max-old-space-size=2048'
    }
  }]
}
```

## âš¡ å¿«é€Ÿéƒ¨ç½²å‘½ä»¤

å¦‚æœæ‚¨é€‰æ‹©ç»§ç»­ä½¿ç”¨Node.js 16ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å¿«é€Ÿéƒ¨ç½²å‘½ä»¤ï¼š

```bash
# 1. ä¸Šä¼ æ–‡ä»¶åï¼Œè¿›å…¥åç«¯ç›®å½•
cd /www/wwwroot/crm/backend

# 2. å®‰è£…ä¾èµ–
npm install --production --legacy-peer-deps

# 3. å¯åŠ¨æœåŠ¡
pm2 start dist/app.js --name crm-backend

# 4. ä¿å­˜PM2é…ç½®
pm2 save
pm2 startup
```

---

**å»ºè®®**ï¼šè™½ç„¶å¯ä»¥åœ¨Node.js 16ä¸Šè¿è¡Œï¼Œä½†ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½å’Œå…¼å®¹æ€§ï¼Œå»ºè®®å‡çº§åˆ°Node.js 18æˆ–20ç‰ˆæœ¬ã€‚