# 三域名部署指南

## 域名规划

| 域名 | 用途 | 目录 |
|------|------|------|
| abc222.cn | 官网 | /www/wwwroot/abc789.cn/website/dist |
| admin.abc789.cn | 管理后台 | /www/wwwroot/abc789.cn/admin/dist |
| abc789.cn | CRM主应用 | /www/wwwroot/abc789.cn/dist |

## 部署步骤

### 1. 域名解析

在域名服务商处添加解析：

```
abc222.cn       → A记录 → 服务器IP
www.abc222.cn   → A记录 → 服务器IP
admin.abc789.cn → A记录 → 服务器IP
```

### 2. 申请SSL证书

在宝塔面板申请证书：
- abc222.cn（官网域名）
- admin.abc789.cn（可以用abc789.cn的泛域名证书，或单独申请）

### 3. 构建前端项目

在服务器项目目录执行：

```bash
cd /www/wwwroot/abc789.cn

# 拉取最新代码
git pull

# 构建CRM主应用
npm run build

# 构建官网
cd website
npm install
npm run build
cd ..

# 构建管理后台
cd admin
npm install
npm run build
cd ..
```

### 4. 配置Nginx

方式一：宝塔面板操作
1. 网站 → 添加站点 → yunkes.com
2. 网站 → 添加站点 → admin.abc789.cn
3. 分别配置SSL证书
4. 修改各站点的nginx配置（参考 nginx-三域名部署配置.conf）

方式二：直接编辑配置文件
```bash
# 备份原配置
cp /www/server/panel/vhost/nginx/abc789.cn.conf /www/server/panel/vhost/nginx/abc789.cn.conf.bak

# 复制新配置
cat docs/nginx-三域名部署配置.conf > /www/server/panel/vhost/nginx/abc789.cn.conf

# 测试配置
nginx -t

# 重载nginx
nginx -s reload
```

### 5. 验证部署

访问以下地址确认部署成功：
- https://abc222.cn - 官网首页
- https://admin.abc789.cn - 管理后台登录页
- https://abc789.cn - CRM登录页

## 常见问题

### Q: admin.abc789.cn 需要单独申请证书吗？
A: 如果你的abc789.cn证书是泛域名证书（*.abc789.cn），可以直接使用。否则需要单独申请。

### Q: 官网API如何调用？
A: 官网的API请求会代理到同一个后端服务（端口3000），使用 /api/v1/public/ 前缀的公开接口。

### Q: 三个站点共用一个后端吗？
A: 是的，三个前端站点都代理到同一个Node.js后端服务，通过不同的API路径区分：
- CRM: /api/v1/*
- 官网: /api/v1/public/*
- 管理后台: /api/v1/admin/*

## 快速部署命令

```bash
# 一键构建所有前端
cd /www/wwwroot/abc789.cn
git pull
npm run build
cd website && npm install && npm run build && cd ..
cd admin && npm install && npm run build && cd ..

# 重启后端
pm2 restart crm-backend

# 重载nginx
nginx -s reload
```
