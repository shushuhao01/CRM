# 服务器快速更新指令

## 当前问题
后端服务启动失败，因为代码中引用了不存在的路由文件（profileRoutes）

## 已修复内容
✅ 移除了 `mockAuthRoutes` 导入和使用
✅ 移除了 `profileRoutes` 导入和使用（文件不存在）
✅ 代码已提交到 GitHub

## 服务器更新步骤

### 1. SSH 登录到宝塔服务器
```bash
ssh root@你的服务器IP
```

### 2. 进入项目目录
```bash
cd /www/wwwroot/abc789.cn
# 或者你的实际项目路径
```

### 3. 拉取最新代码
```bash
git pull origin main
```

### 4. 重启后端服务
```bash
cd backend
pm2 restart crm-backend
```

### 5. 查看服务状态
```bash
pm2 logs crm-backend --lines 50
```

### 6. 检查服务是否正常
```bash
curl http://localhost:3000/health
```

应该返回：
```json
{"success":true,"message":"CRM API服务运行正常",...}
```

## 如果还有问题

### 检查数据库连接
```bash
cd /www/wwwroot/abc789.cn/backend
cat .env | grep DB_
```

确认：
- DB_TYPE=mysql
- DB_HOST=localhost
- DB_DATABASE=abc789_cn
- DB_USERNAME=abc789_cn
- DB_PASSWORD=（你的密码）

### 查看完整日志
```bash
pm2 logs crm-backend --lines 100
```

### 重新安装依赖（如果需要）
```bash
cd /www/wwwroot/abc789.cn/backend
npm install --production
pm2 restart crm-backend
```

## 测试创建功能

服务启动成功后，访问网站：
1. 登录系统（superadmin / super123456）
2. 尝试创建部门
3. 尝试创建客户
4. 尝试创建订单

所有创建操作应该都能正常工作了！

## 常用命令

```bash
# 查看所有 PM2 进程
pm2 list

# 重启服务
pm2 restart crm-backend

# 停止服务
pm2 stop crm-backend

# 查看实时日志
pm2 logs crm-backend

# 查看服务详情
pm2 show crm-backend
```
