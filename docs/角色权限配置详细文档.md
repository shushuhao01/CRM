# CRM系统角色权限配置详细文档

> 文档版本：1.0
> 更新日期：2025-12-12
> 适用系统：智能销售CRM

---

## 一、系统角色概述

系统预设了5个角色，每个角色有不同的权限范围和数据访问级别：

| 角色编码 | 角色名称 | 数据范围 | 说明 |
|---------|---------|---------|------|
| `super_admin` | 超级管理员 | 全公司 | 拥有系统所有权限，可管理所有功能和数据 |
| `admin` | 管理员 | 全公司 | 拥有系统所有权限，可管理所有功能和数据 |
| `department_manager` | 部门经理 | 本部门 | 管理本部门业务和团队，查看部门数据 |
| `sales_staff` | 销售员 | 个人 | 专注于客户开发和订单管理，查看个人数据 |
| `customer_service` | 客服 | 全公司 | 处理订单审核、物流和售后服务 |

---

## 二、权限树结构（完整版）

### 2.1 系统管理 (system)

| 一级菜单 | 二级菜单 | 按钮权限 | 权限ID |
|---------|---------|---------|--------|
| 系统管理 | 部门管理 | 查看部门 | `system.department.view` |
| | | 新增部门 | `system.department.create` |
| | | 编辑部门 | `system.department.edit` |
| | | 删除部门 | `system.department.delete` |
| | | 管理部门 | `system.department.manage` |
| | 用户管理 | 查看用户 | `system.user.view` |
| | | 新增用户 | `system.user.create` |
| | | 编辑用户 | `system.user.edit` |
| | | 删除用户 | `system.user.delete` |
| | | 重置密码 | `system.user.resetPassword` |
| | | 权限设置 | `system.user.setPermissions` |
| | | 操作日志 | `system.user.viewLogs` |
| | 角色权限 | 查看角色 | `system.role.view` |
| | | 新增角色 | `system.role.create` |
| | | 编辑角色 | `system.role.edit` |
| | | 删除角色 | `system.role.delete` |
| | | 设置权限 | `system.role.setPermissions` |
| | 权限管理 | 查看权限 | `system.permission.view` |
| | | 权限管理 | `system.permission.manage` |
| | | 角色管理 | `system.permission.roleManage` |
| | | 敏感权限 | `system.permission.sensitivePermission` |
| | | 客服管理 | `system.permission.customerServiceManage` |
| | 超管面板 | 查看面板 | `system.superAdmin.view` |
| | | 编辑权限 | `system.superAdmin.editPermissions` |
| | | 查看详情 | `system.superAdmin.viewDetails` |
| | | 重置密码 | `system.superAdmin.resetPassword` |
| | | 成员管理 | `system.superAdmin.memberManage` |
| | | 权限详情 | `system.superAdmin.permissionDetails` |
| | 客服管理 | 查看客服 | `system.customerService.view` |
| | | 管理客服 | `system.customerService.manage` |
| | | 设置权限 | `system.customerService.setPermissions` |
| | | 全部启用 | `system.customerService.enableAll` |
| | | 全部禁用 | `system.customerService.disableAll` |
| | 消息管理 | 查看消息 | `system.message.view` |
| | | 发送消息 | `system.message.send` |
| | | 删除消息 | `system.message.delete` |
| | | 消息管理 | `system.message.manage` |
| | 系统设置 | 查看设置 | `system.settings.view` |
| | | 编辑设置 | `system.settings.edit` |
| | | 数据备份 | `system.settings.backup` |
| | | 数据恢复 | `system.settings.restore` |

### 2.2 客户管理 (customer)

| 一级菜单 | 二级菜单 | 按钮权限 | 权限ID |
|---------|---------|---------|--------|
| 客户管理 | 客户列表 | 查看客户 | `customer.list.view` |
| | | 导出客户 | `customer.list.export` |
| | | 导入客户 | `customer.list.import` |
| | | 编辑客户 | `customer.list.edit` |
| | | 删除客户 | `customer.list.delete` |
| | | 分配客户 | `customer.list.assign` |
| | | 批量操作 | `customer.list.batchOperation` |
| | 新增客户 | 创建客户 | `customer.add.create` |
| | 客户标签 | 查看标签 | `customer.tags.view` |
| | | 新增标签 | `customer.tags.create` |
| | | 编辑标签 | `customer.tags.edit` |
| | | 删除标签 | `customer.tags.delete` |
| | | 分配标签 | `customer.tags.assign` |
| | 客户分组 | 查看分组 | `customer.groups.view` |
| | | 新增分组 | `customer.groups.create` |
| | | 编辑分组 | `customer.groups.edit` |
| | | 删除分组 | `customer.groups.delete` |
| | | 管理分组 | `customer.groups.manage` |

### 2.3 订单管理 (order)

| 一级菜单 | 二级菜单 | 按钮权限 | 权限ID |
|---------|---------|---------|--------|
| 订单管理 | 订单列表 | 查看订单 | `order.list.view` |
| | | 导出订单 | `order.list.export` |
| | | 编辑订单 | `order.list.edit` |
| | | 删除订单 | `order.list.delete` |
| | | 取消订单 | `order.list.cancel` |
| | | 批量操作 | `order.list.batchOperation` |
| | 新增订单 | 创建订单 | `order.add.create` |
| | 订单审核 | 查看审核 | `order.audit.view` |
| | | 通过审核 | `order.audit.approve` |
| | | 拒绝审核 | `order.audit.reject` |
| | | 撤销审核 | `order.audit.revoke` |
| | | 批量审核 | `order.audit.batchAudit` |

### 2.4 服务管理 (service)

| 一级菜单 | 二级菜单 | 按钮权限 | 权限ID |
|---------|---------|---------|--------|
| 服务管理 | 工单管理 | 查看工单 | `service.ticket.view` |
| | | 创建工单 | `service.ticket.create` |
| | | 编辑工单 | `service.ticket.edit` |
| | | 删除工单 | `service.ticket.delete` |
| | | 分配工单 | `service.ticket.assign` |
| | | 关闭工单 | `service.ticket.close` |
| | | 导出工单 | `service.ticket.export` |
| | 在线客服 | 查看对话 | `service.chat.view` |
| | | 回复消息 | `service.chat.reply` |
| | | 转接客服 | `service.chat.transfer` |
| | | 查看历史 | `service.chat.history` |
| | | 客服设置 | `service.chat.settings` |
| | 知识库 | 查看知识库 | `service.knowledge.view` |
| | | 创建文档 | `service.knowledge.create` |
| | | 编辑文档 | `service.knowledge.edit` |
| | | 删除文档 | `service.knowledge.delete` |
| | | 分类管理 | `service.knowledge.category` |
| | | 发布文档 | `service.knowledge.publish` |
| | 通话管理 | 查看通话记录 | `service.call.view` |
| | | 发起通话 | `service.call.make` |
| | | 录音管理 | `service.call.record` |
| | | 通话统计 | `service.call.statistics` |
| | 短信管理 | 查看短信记录 | `service.sms.view` |
| | | 发送短信 | `service.sms.send` |
| | | 模板管理 | `service.sms.template` |
| | | 批量发送 | `service.sms.batch` |
| | | 短信统计 | `service.sms.statistics` |

### 2.5 业绩统计 (performance)

| 一级菜单 | 二级菜单 | 按钮权限 | 权限ID |
|---------|---------|---------|--------|
| 业绩统计 | 个人业绩 | 查看个人业绩 | `performance.personal.view` |
| | | 导出个人数据 | `performance.personal.export` |
| | 团队业绩 | 查看团队业绩 | `performance.team.view` |
| | | 导出团队数据 | `performance.team.export` |
| | | 业绩对比 | `performance.team.compare` |
| | 业绩分析 | 查看分析报告 | `performance.analysis.view` |
| | | 趋势分析 | `performance.analysis.trend` |
| | | 业绩预测 | `performance.analysis.forecast` |
| | 业绩分享 | 查看分享 | `performance.share.view` |
| | | 创建分享 | `performance.share.create` |
| | | 管理分享 | `performance.share.manage` |

### 2.6 物流管理 (logistics)

| 一级菜单 | 二级菜单 | 按钮权限 | 权限ID |
|---------|---------|---------|--------|
| 物流管理 | 物流列表 | 查看物流列表 | `logistics.list.view` |
| | | 导出物流数据 | `logistics.list.export` |
| | 物流跟踪 | 查看跟踪信息 | `logistics.track.view` |
| | | 更新跟踪状态 | `logistics.track.update` |
| | 物流公司 | 查看物流公司 | `logistics.companies.view` |
| | | 添加物流公司 | `logistics.companies.create` |
| | | 编辑物流公司 | `logistics.companies.edit` |
| | | 删除物流公司 | `logistics.companies.delete` |
| | 发货列表 | 查看发货列表 | `logistics.shipping.view` |
| | | 创建发货单 | `logistics.shipping.create` |
| | | 编辑发货单 | `logistics.shipping.edit` |
| | | 批量导出 | `logistics.shipping.batchExport` |
| | 状态更新 | 查看状态 | `logistics.status.view` |
| | | 更新状态 | `logistics.status.update` |
| | | 批量更新 | `logistics.status.batch` |

### 2.7 售后管理 (afterSales)

| 一级菜单 | 二级菜单 | 按钮权限 | 权限ID |
|---------|---------|---------|--------|
| 售后管理 | 售后订单 | 查看售后订单 | `afterSales.list.view` |
| | | 导出售后数据 | `afterSales.list.export` |
| | 新建售后 | 创建售后单 | `afterSales.add.create` |
| | | 批量创建 | `afterSales.add.batch` |
| | 售后详情 | 查看售后详情 | `afterSales.detail.view` |
| | | 编辑售后单 | `afterSales.detail.edit` |
| | | 处理售后 | `afterSales.detail.process` |
| | 售后数据 | 查看售后数据 | `afterSales.data.view` |
| | | 售后分析 | `afterSales.data.analysis` |
| | | 售后报告 | `afterSales.data.report` |

### 2.8 资料管理 (data)

| 一级菜单 | 二级菜单 | 按钮权限 | 权限ID |
|---------|---------|---------|--------|
| 资料管理 | 资料列表 | 查看资料列表 | `data.list.view` |
| | | 导出资料 | `data.list.export` |
| | | 导入资料 | `data.list.import` |
| | | 分配资料 | `data.list.assign` |
| | 客户查询 | 基础查询 | `data.search.basic` |
| | | 高级查询 | `data.search.advanced` |
| | | 导出查询结果 | `data.search.export` |
| | 回收站 | 查看回收站 | `data.recycle.view` |
| | | 恢复数据 | `data.recycle.restore` |
| | | 彻底删除 | `data.recycle.delete` |

### 2.9 商品管理 (product)

| 一级菜单 | 二级菜单 | 按钮权限 | 权限ID |
|---------|---------|---------|--------|
| 商品管理 | 商品列表 | 查看商品 | `product.list.view` |
| | | 导出商品 | `product.list.export` |
| | | 编辑商品 | `product.list.edit` |
| | | 删除商品 | `product.list.delete` |
| | | 批量操作 | `product.list.batchOperation` |
| | | 价格调整 | `product.list.priceAdjust` |
| | 新增商品 | 创建商品 | `product.add.create` |
| | | 批量新增 | `product.add.batchAdd` |
| | 商品分类 | 查看分类 | `product.category.view` |
| | | 新增分类 | `product.category.create` |
| | | 编辑分类 | `product.category.edit` |
| | | 删除分类 | `product.category.delete` |
| | | 管理分类 | `product.category.manage` |
| | 库存管理 | 查看库存 | `product.inventory.view` |
| | | 调整库存 | `product.inventory.adjust` |
| | | 入库操作 | `product.inventory.inbound` |
| | | 出库操作 | `product.inventory.outbound` |
| | | 转移库存 | `product.inventory.transfer` |
| | | 预警设置 | `product.inventory.alert` |
| | 商品分析 | 查看分析 | `product.analytics.view` |
| | | 销售分析 | `product.analytics.sales` |
| | | 利润分析 | `product.analytics.profit` |
| | | 趋势分析 | `product.analytics.trend` |
| | | 导出报表 | `product.analytics.exportReport` |

---

## 三、各角色默认权限配置详情


### 3.1 超级管理员 (super_admin)

**权限标识**: `*` (所有权限)

**权限说明**:
- 拥有系统所有功能的完整访问权限
- 可以管理所有用户、角色、部门
- 可以查看和操作全公司所有数据
- 可以进行系统设置和数据备份恢复
- 不受任何数据范围限制

**数据过滤规则**:
- 客户数据：全公司所有客户
- 订单数据：全公司所有订单
- 业绩数据：全公司所有成员业绩
- 物流数据：全公司所有物流记录

---

### 3.2 管理员 (admin)

**权限标识**: `*` (所有权限)

**权限说明**:
- 与超级管理员权限相同
- 拥有系统所有功能的完整访问权限
- 可以管理所有用户、角色、部门

**数据过滤规则**:
- 与超级管理员相同，无数据范围限制

---

### 3.3 部门经理 (department_manager)

**已配置权限列表**:

```
dashboard                    - 数据看板（一级菜单）
dashboard:personal           - 个人看板
dashboard:department         - 部门看板

customer                     - 客户管理（一级菜单）
customer:list                - 客户列表
customer:view:personal       - 查看个人客户
customer:view:department     - 查看部门客户
customer:add                 - 新增客户
customer:edit                - 编辑客户
customer:import              - 导入客户
customer:export              - 导出客户

order                        - 订单管理（一级菜单）
order:list                   - 订单列表
order:view:personal          - 查看个人订单
order:view:department        - 查看部门订单
order:add                    - 新增订单
order:edit                   - 编辑订单

service                      - 服务管理（一级菜单）
service:call                 - 通话管理
service:call:view            - 查看通话记录
service:call:add             - 新增通话
service:call:edit            - 编辑通话

performance                  - 业绩统计（一级菜单）
performance:personal         - 个人业绩
performance:personal:view    - 查看个人业绩
performance:team             - 团队业绩
performance:team:view        - 查看团队业绩
performance:analysis         - 业绩分析
performance:share            - 业绩分享

logistics                    - 物流管理（一级菜单）
logistics:list               - 物流列表
logistics:view               - 查看物流
logistics:add                - 新增物流
logistics:edit               - 编辑物流
logistics:tracking           - 物流跟踪
logistics:tracking:view      - 查看跟踪

aftersale                    - 售后管理（一级菜单）
aftersale:order              - 售后订单
aftersale:view:personal      - 查看个人售后
aftersale:view:department    - 查看部门售后
aftersale:add                - 新增售后
aftersale:edit               - 编辑售后
aftersale:analysis           - 售后分析

data                         - 资料管理（一级菜单）
data:customer                - 客户资料
data:customer:search         - 客户查询
```

**数据过滤规则**:
- 客户数据：本部门所有成员的客户
- 订单数据：本部门所有成员的订单
- 业绩数据：可查看本部门所有成员业绩，可点击查看详情
- 物流数据：本部门相关的物流记录

**特殊权限说明**:
- ❌ 无系统管理权限
- ❌ 无客户标签管理权限
- ❌ 无客户分组管理权限
- ❌ 无资料列表权限
- ✅ 可查看部门成员业绩详情
- ✅ 可点击团队业绩中所有本部门成员的单数超链接

---

### 3.4 销售员 (sales_staff)

**已配置权限列表**:

```
dashboard                    - 数据看板（一级菜单）
dashboard:personal           - 个人看板

customer                     - 客户管理（一级菜单）
customer:list                - 客户列表
customer:view:personal       - 查看个人客户
customer:add                 - 新增客户

order                        - 订单管理（一级菜单）
order:list                   - 订单列表
order:view:personal          - 查看个人订单
order:add                    - 新增订单
order:edit                   - 编辑订单

service                      - 服务管理（一级菜单）
service:call                 - 通话管理
service:call:view            - 查看通话记录
service:call:add             - 新增通话
service:call:edit            - 编辑通话

performance                  - 业绩统计（一级菜单）
performance:personal         - 个人业绩
performance:personal:view    - 查看个人业绩
performance:team             - 团队业绩
performance:team:view        - 查看团队业绩

logistics                    - 物流管理（一级菜单）
logistics:list               - 物流列表
logistics:view               - 查看物流
logistics:tracking           - 物流跟踪
logistics:tracking:view      - 查看跟踪

aftersale                    - 售后管理（一级菜单）
aftersale:order              - 售后订单
aftersale:view:personal      - 查看个人售后
aftersale:add                - 新增售后

data                         - 资料管理（一级菜单）
data:customer                - 客户资料
data:customer:search         - 客户查询
```

**数据过滤规则**:
- 客户数据：仅个人创建/负责的客户
- 订单数据：仅个人创建的订单
- 业绩数据：可查看团队业绩列表，但只能点击自己那一行的详情
- 物流数据：仅个人相关的物流记录

**特殊权限说明**:
- ❌ 无系统管理权限
- ❌ 无客户标签管理权限
- ❌ 无客户分组管理权限
- ❌ 无客户编辑权限（仅能新增）
- ❌ 无发货列表权限
- ❌ 无状态更新权限
- ❌ 无售后数据分析权限
- ❌ 无回收站权限
- ❌ 无短信管理权限
- ✅ 团队业绩页面只能点击自己那一行的单数超链接和查看详情按钮
- ✅ 其他成员的行显示为普通文本或隐藏操作按钮

---

### 3.5 客服 (customer_service)

**已配置权限列表**:

```
dashboard                    - 数据看板（一级菜单）
dashboard:personal           - 个人看板

order                        - 订单管理（一级菜单）
order:audit                  - 订单审核
order:audit:view             - 查看待审核订单

logistics                    - 物流管理（一级菜单）
logistics:list               - 物流列表
logistics:list:view          - 查看物流列表
logistics:shipping           - 发货列表
logistics:shipping:view      - 查看发货列表
logistics:tracking           - 物流跟踪
logistics:tracking:view      - 查看跟踪
logistics:status             - 状态更新
logistics:status_update      - 更新状态

aftersale                    - 售后管理（一级菜单）
aftersale:order              - 售后订单
aftersale:order:view         - 查看售后订单
aftersale:add                - 新增售后
aftersale:analysis           - 售后分析

data                         - 资料管理（一级菜单）
data:customer                - 客户资料
data:customer:search         - 客户查询
data:list                    - 资料列表
```

**数据过滤规则**:
- 订单数据：全公司待审核订单（用于审核）
- 物流数据：全公司所有物流记录
- 售后数据：全公司所有售后记录

**特殊权限说明**:
- ❌ 无系统管理权限
- ❌ 无客户管理权限（不能查看客户列表）
- ❌ 无订单列表权限（只有审核权限）
- ❌ 无业绩统计权限
- ✅ 可审核全公司订单
- ✅ 可管理全公司物流
- ✅ 可处理全公司售后

---

## 四、数据范围控制规则

### 4.1 数据范围类型

| 范围类型 | 说明 | 适用角色 |
|---------|------|---------|
| `all` | 全公司数据 | 超级管理员、管理员、客服 |
| `department` | 本部门数据 | 部门经理 |
| `self` | 仅个人数据 | 销售员 |

### 4.2 各模块数据过滤规则

#### 客户管理
- **超管/管理员**: 查看全公司所有客户
- **部门经理**: 查看本部门所有成员的客户
- **销售员**: 仅查看自己创建/负责的客户
- **客服**: 无客户列表权限

#### 订单管理
- **超管/管理员**: 查看全公司所有订单
- **部门经理**: 查看本部门所有成员的订单
- **销售员**: 仅查看自己创建的订单
- **客服**: 仅查看待审核订单（用于审核）

#### 业绩统计
- **超管/管理员**: 
  - 查看全公司所有成员业绩
  - 可点击任意成员的单数超链接
  - 可查看任意成员的详情
- **部门经理**: 
  - 查看本部门所有成员业绩
  - 可点击本部门成员的单数超链接
  - 可查看本部门成员的详情
- **销售员**: 
  - 可查看团队业绩列表（只读）
  - 只能点击自己那一行的单数超链接
  - 只能查看自己的详情
  - 其他成员行的操作按钮隐藏
- **客服**: 无业绩统计权限

#### 物流管理
- **超管/管理员**: 查看全公司所有物流
- **部门经理**: 查看本部门相关物流
- **销售员**: 查看个人相关物流
- **客服**: 查看全公司所有物流（用于处理）

---

## 五、权限配置页面说明

### 5.1 访问路径
系统管理 → 角色权限 → 点击"权限设置"按钮

### 5.2 权限树结构
权限树采用三级结构：
1. **一级菜单**: 如"系统管理"、"客户管理"等
2. **二级菜单**: 如"部门管理"、"客户列表"等
3. **按钮权限**: 如"查看"、"新增"、"编辑"、"删除"等

### 5.3 权限保存流程
1. 选择要配置的角色
2. 在权限树中勾选需要的权限
3. 点击"保存权限"按钮
4. 权限保存到数据库（roles表的permissions字段）
5. 同时更新本地缓存
6. 如果当前用户是该角色，立即生效

### 5.4 权限生效机制
- 权限保存后立即生效
- 用户登录时从数据库加载权限
- 权限变更后，当前用户需要刷新页面或重新登录

---

## 六、技术实现说明

### 6.1 数据库存储
- **表名**: `roles`
- **字段**: `permissions` (JSON类型)
- **格式**: 字符串数组，如 `["dashboard", "customer", "customer:list"]`

### 6.2 API接口
- `GET /api/v1/roles` - 获取角色列表（包含权限）
- `GET /api/v1/roles/:id/permissions` - 获取角色权限
- `PUT /api/v1/roles/:id` - 更新角色（包括权限）
- `PUT /api/v1/roles/:id/permissions` - 更新角色权限

### 6.3 前端权限检查
```typescript
// 检查用户是否有某个权限
const hasPermission = (permissionCode: string) => {
  const userPermissions = userStore.permissions
  if (userPermissions.includes('*')) return true // 超管
  return userPermissions.includes(permissionCode)
}
```

### 6.4 默认权限配置文件
- **路径**: `src/config/defaultRolePermissions.ts`
- **作用**: 当角色没有配置权限时，使用默认配置

---

## 七、注意事项

1. **超级管理员和管理员**不可禁用，这是系统预设的保护机制
2. **权限修改后**，已登录用户需要刷新页面才能生效
3. **数据范围控制**是在后端API层面实现的，前端只做显示控制
4. **敏感信息**（如手机号）会根据权限进行脱敏显示
5. **批量操作**权限需要同时具有对应的单条操作权限

---

> 文档结束
