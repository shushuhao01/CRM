# 增值管理系统功能说明

## 系统概述

增值管理系统用于管理外包客户数据和订单，按订单收费（如900元/单），跟踪有效性、结算和补偿。

## 功能特性

### 1. 自动同步订单
- 所有已签收（delivered）和已完成（completed）状态的订单会自动同步到增值管理列表
- 后端在每次查询增值订单时会自动执行同步逻辑

### 2. 数据汇总卡片
- 全部资料：显示所有订单数量和总金额
- 有效资料：显示有效订单数量和结算金额
- 无效资料：显示无效订单数量和单价总额（虽然不结算，但显示金额）
- 未结算：显示待结算订单数量和金额
- 已结算：显示已结算订单数量和金额
- 汇总卡片根据筛选条件动态更新

### 3. 快捷日期筛选
- 今日、本月、上月、本季、上季
- Q1、Q2、Q3、Q4
- 今年、全部
- 默认选中"本月"
- 使用圆角按钮样式

### 4. 标签选项卡
- 全部、待处理、有效、无效
- 每个标签显示数量徽章（带彩色背景）
- 点击标签自动筛选对应状态的订单

### 5. 筛选器
- 关键词搜索：订单号/客户电话/物流单号
- 外包公司筛选
- 搜索按钮

### 6. 数据列表
- 订单号、客户姓名、客户电话、物流单号
- 外包公司、单价（灰色显示）
- 实际结算金额（颜色规则）：
  - 有效：绿色 ¥900
  - 无效：红色 ¥0.00
  - 待处理：灰色横杠 (-)
  - 已结算：蓝色 ¥900
- 状态、结算状态、创建时间
- 操作按钮：详情、有效、无效、结算

### 7. 批量操作
- 标记有效
- 标记无效（需填写无效原因）
- 批量结算
- 补单

### 8. 外包公司管理
- 新增公司
- 编辑公司信息
- 查看公司详情
- 统计数据：总订单、有效订单、无效订单、已结算金额

### 9. 费用配置管理
- 新增费用配置
- 编辑配置
- 设置单价、生效日期、适用公司
- 启用/停用配置

### 10. 结算报表
- 汇总卡片：总结算订单、总结算金额、平均单价
- 结算趋势图：折线图（双Y轴）显示订单数和金额
- 公司结算占比：饼图显示各公司结算金额占比
- 公司排名：显示奖牌（🥇🥈🥉）和趋势指标

## 页面布局顺序

1. 汇总卡片（5个）
2. 快捷日期筛选按钮
3. 标签选项卡
4. 筛选器
5. 批量操作栏（选中订单时显示）
6. 数据列表
7. 加载更多按钮

## 路由配置

- 增值管理：`/finance/value-added-manage`
- 结算报表：`/finance/settlement-report`
- 位置：财务管理 > 代收管理下方

## 数据库表结构

### 1. value_added_orders（增值订单表）
- 订单信息：订单号、客户信息、物流单号
- 外包公司：公司ID、公司名称
- 费用信息：单价、实际结算金额
- 状态：pending（待处理）、valid（有效）、invalid（无效）、supplemented（已补单）
- 结算状态：unsettled（未结算）、settled（已结算）
- 结算信息：结算日期、结算批次号
- 无效原因、补单关联ID、导出信息、备注

### 2. outsource_companies（外包公司表）
- 公司信息：名称、联系人、电话、邮箱、地址
- 统计数据：总订单数、有效订单数、无效订单数、总金额、已结算金额
- 状态：active（启用）、inactive（停用）

### 3. value_added_price_config（费用配置表）
- 配置名称、外包公司ID
- 单价（元/单）
- 生效日期范围
- 适用条件（JSON格式）
- 状态：active（启用）、inactive（停用）

## API接口

### 增值订单
- GET `/api/v1/value-added/orders` - 获取订单列表（自动同步）
- GET `/api/v1/value-added/stats` - 获取统计数据
- POST `/api/v1/value-added/orders` - 创建订单
- PUT `/api/v1/value-added/orders/batch-process` - 批量处理订单

### 外包公司
- GET `/api/v1/value-added/companies` - 获取公司列表
- POST `/api/v1/value-added/companies` - 创建公司
- PUT `/api/v1/value-added/companies/:id` - 更新公司

### 费用配置
- GET `/api/v1/value-added/price-configs` - 获取配置列表
- POST `/api/v1/value-added/price-configs` - 创建配置
- PUT `/api/v1/value-added/price-configs/:id` - 更新配置

### 结算报表
- GET `/api/v1/value-added/settlement-report` - 获取报表数据

## 使用流程

1. 系统自动同步已签收和已完成的订单到增值管理列表
2. 财务人员查看订单列表，使用筛选器和标签快速定位
3. 标记订单为有效或无效（无效需填写原因）
4. 对有效订单进行结算操作
5. 查看结算报表，分析各公司结算情况
6. 管理外包公司和费用配置

## 访问地址

- 前端：http://localhost:5173
- 后端：http://localhost:3000
- 增值管理：http://localhost:5173/finance/value-added-manage
- 结算报表：http://localhost:5173/finance/settlement-report

## 注意事项

1. 所有已签收和已完成状态的订单会自动出现在增值管理列表中
2. 无效资料也显示金额（单价总额），方便了解不结算订单的总金额
3. 汇总卡片会根据筛选条件动态更新
4. 默认页面大小为10条，使用"加载更多"功能
5. 快捷日期筛选默认选中"本月"

## 开发状态

✅ 已完成：
- 数据库表结构设计和迁移脚本
- TypeORM实体定义
- 后端路由和API实现
- 自动同步已签收和已完成订单功能
- 前端API封装
- 增值管理主视图
- 结算报表视图
- 路由配置和导航

⏳ 待完善：
- 外包公司新增/编辑表单
- 费用配置新增/编辑表单
- 订单详情弹窗
- 数据库表创建（需要执行迁移脚本）

## 下一步操作

1. 在MySQL数据库中执行迁移脚本：`backend/database-migrations/create-value-added-tables.sql`
2. 访问 http://localhost:5173 登录系统
3. 进入"财务管理" > "增值管理"测试功能
4. 进入"财务管理" > "结算报表"查看报表
5. 完善外包公司和费用配置的表单功能

---

创建时间：2026-02-28
更新时间：2026-02-28
