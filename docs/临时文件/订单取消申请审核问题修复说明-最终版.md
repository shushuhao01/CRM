# 订单取消申请审核问题修复说明（最终版）

## 问题描述

生产环境中，成员新建订单后申请取消订单，但在订单列表页面点击"取消订单申请审核"按钮打开的弹窗中，看不到这条取消申请的订单，无法进行审核。

## 问题原因

订单列表页面的"取消订单审核"弹窗依赖当前页面的 `orderList` 数据，而 `orderList` 是根据用户选择的筛选条件加载的。如果筛选条件不包含 `pending_cancel` 状态，待取消的订单就不会被加载，导致弹窗显示为空。

## 解决方案

### 核心思路
使用后端专门的 API 来获取取消申请订单，而不是依赖通用的订单列表 API。

### 后端 API 修复

#### 1. 修复 `/api/v1/orders/pending-cancel` API
- 文件：`backend/src/routes/orders.ts`
- 修复：查询 `status = 'pending_cancel'` 的订单（原来查询逻辑不正确）
- 返回字段：包含 `createdByName`（销售员名称）

#### 2. 修复 `/api/v1/orders/audited-cancel` API
- 文件：`backend/src/routes/orders.ts`
- 修复：查询 `status IN ('cancelled', 'cancel_failed')` 的订单
- 限制：只返回最近100条

### 前端修复

#### 修改 `loadCancelAuditOrders` 函数
- 文件：`src/views/Order/List.vue`
- 修复：使用专门的 API `getPendingCancelOrders()` 和 `getAuditedCancelOrders()`
- 优势：不依赖当前页面的筛选条件，直接从后端获取所有取消申请订单

## 修复效果

修复后，无论用户在订单列表选择什么筛选条件，点击"取消订单申请审核"按钮都能看到所有待审核的取消申请。

## 测试步骤

1. 登录普通成员账号，创建订单并申请取消
2. 登录管理员账号，在订单列表选择任意筛选条件
3. 点击"取消订单申请审核"按钮
4. 验证：弹窗中应该显示待审核的取消申请

## 相关文件

- 后端：`backend/src/routes/orders.ts`
- 前端：`src/views/Order/List.vue`
- API定义：`src/api/order.ts`
