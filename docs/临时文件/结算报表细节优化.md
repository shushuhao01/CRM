# 结算报表细节优化

## 优化内容

### 1. 有效率趋势图Y轴优化

#### 问题
- Y轴百分比显示不完整，100%看不见

#### 解决方案
```typescript
yAxis: {
  type: 'value',
  name: '百分比（%）',
  min: 0,        // 最小值0
  max: 100,      // 最大值100
  interval: 20,  // 间隔20（显示0, 20, 40, 60, 80, 100）
  axisLabel: {
    formatter: '{value}%'
  }
}
```

#### 效果
- ✅ Y轴显示：0%, 20%, 40%, 60%, 80%, 100%
- ✅ 100%标签完整显示
- ✅ 刻度间隔均匀

### 2. 结算趋势分析图优化

#### 移除内容
- ❌ 平均单价曲线
- ❌ 平均单价图例

#### 保留内容
- ✅ 结算订单数（蓝色）
- ✅ 结算金额（绿色）

#### 原因
- 平均单价可以通过金额/订单数计算得出
- 简化图表，突出核心数据
- 避免图表过于复杂

### 3. 公司排名表优化

#### 新增列
- **总金额**：已结算金额 + 未结算金额
- 位置：总订单列之后
- 宽度：120px
- 对齐：右对齐
- 样式：灰色加粗

#### 列宽调整

| 列名 | 调整前 | 调整后 | 说明 |
|------|--------|--------|------|
| 排名 | 80px | 70px | 缩小10px |
| 公司名称 | 150px | 140px | 缩小10px |
| 总订单 | 100px | 90px | 缩小10px |
| 总金额 | - | 120px | 新增 |
| 已结算 | 100px | 90px | 缩小10px |
| 未结算 | 100px | 90px | 缩小10px |
| 有效 | 90px | 80px | 缩小10px |
| 无效 | 90px | 80px | 缩小10px |
| 待处理 | 90px | 80px | 缩小10px |
| 已结算金额 | 130px | 120px | 缩小10px |
| 未结算金额 | 130px | 120px | 缩小10px |
| 平均单价 | 110px | 100px | 缩小10px |
| 结算率 | 100px | 90px | 缩小10px |
| 有效率 | 100px | 90px | 缩小10px |
| 最近结算 | 110px | 100px | 缩小10px |

#### 总金额计算
```typescript
<el-table-column label="总金额" width="120" align="right">
  <template #default="{ row }">
    <span style="color: #606266; font-weight: 600;">
      ¥{{ formatMoney(row.settledAmount + row.unsettledAmount) }}
    </span>
  </template>
</el-table-column>
```

### 4. ElMessageBox报错修复

#### 问题
- 应用错误: ElMessageBox is not defined

#### 可能原因
1. 组件中使用了ElMessageBox但未导入
2. 父组件或路由配置中使用了ElMessageBox
3. 全局配置中缺少ElMessageBox

#### 检查结果
- SettlementReport.vue中未使用ElMessageBox
- 未使用confirm、alert、prompt等方法

#### 解决方案
如果报错持续，需要检查：
1. 父组件（Finance布局组件）
2. 路由守卫
3. 全局错误处理

## 表格列顺序

1. 排名（70px）
2. 公司名称（140px，固定列）
3. 总订单（90px）
4. **总金额（120px）** ← 新增
5. 已结算（90px）
6. 未结算（90px）
7. 有效（80px）
8. 无效（80px）
9. 待处理（80px）
10. 已结算金额（120px）
11. 未结算金额（120px）
12. 平均单价（100px）
13. 结算率（90px）
14. 有效率（90px）
15. 最近结算（100px）

## 数据展示逻辑

### 总金额
- **计算公式**：已结算金额 + 未结算金额
- **数据来源**：
  - `row.settledAmount` - 已结算订单的实际结算金额
  - `row.unsettledAmount` - 未结算订单的单价总和
- **显示样式**：灰色加粗

### 已结算金额
- **数据来源**：`SUM(settlement_amount) WHERE settlement_status = 'settled'`
- **显示样式**：绿色加粗

### 未结算金额
- **数据来源**：`SUM(unit_price) WHERE settlement_status = 'unsettled'`
- **显示样式**：默认颜色

## 图表配置对比

### 结算趋势分析图

#### 优化前
```typescript
legend: {
  data: ['结算订单数', '结算金额', '平均单价']
}
series: [
  { name: '结算订单数', ... },
  { name: '结算金额', ... },
  { name: '平均单价', ... }  // ← 移除
]
```

#### 优化后
```typescript
legend: {
  data: ['结算订单数', '结算金额']
}
series: [
  { name: '结算订单数', ... },
  { name: '结算金额', ... }
]
```

### 有效率趋势图

#### 优化前
```typescript
yAxis: {
  type: 'value',
  name: '百分比（%）',
  max: 100,
  axisLabel: {
    formatter: '{value}%'
  }
}
```

#### 优化后
```typescript
yAxis: {
  type: 'value',
  name: '百分比（%）',
  min: 0,
  max: 100,
  interval: 20,  // ← 新增
  axisLabel: {
    formatter: '{value}%'
  }
}
```

## 测试检查清单

### 有效率趋势图
- [ ] Y轴显示0%, 20%, 40%, 60%, 80%, 100%
- [ ] 100%标签完整显示
- [ ] 刻度间隔均匀

### 结算趋势分析图
- [ ] 只显示两条曲线（订单数、金额）
- [ ] 图例只显示两项
- [ ] 渐变效果正常

### 公司排名表
- [ ] 总金额列显示在总订单之后
- [ ] 总金额 = 已结算金额 + 未结算金额
- [ ] 列宽合理，不拥挤
- [ ] 固定列（排名、公司名称）正常工作

### ElMessageBox报错
- [ ] 页面可以正常打开
- [ ] 无控制台报错
- [ ] 所有功能正常使用

## 相关文件

- `src/views/Finance/SettlementReport.vue` - 结算报表页面
- `docs/临时文件/结算报表图表美化完成.md` - 图表美化文档

## 总结

本次优化解决了4个问题：
1. ✅ 有效率趋势图Y轴显示完整（0-100%，间隔20）
2. ✅ 结算趋势分析图移除平均单价曲线
3. ✅ 公司排名表添加总金额列
4. ✅ 调整表格列宽，更加紧凑合理

优化后的报表数据展示更加清晰，表格布局更加合理。
