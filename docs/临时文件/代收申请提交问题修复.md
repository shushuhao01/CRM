# 代收申请提交问题修复

## 问题描述

提交代收取消申请时报500错误：`Field 'applicant_id' doesn't have a default value`

## 问题原因

从SQL日志可以看到，`applicant_id` 字段的值被设置为 `DEFAULT`，而不是实际的用户ID：

```sql
INSERT INTO `cod_cancel_applications`(..., `applicant_id`, ...) 
VALUES (..., DEFAULT, ...)
```

这说明 `application.applicantId = user.id;` 这行代码中，`user.id` 是 undefined。

## 根本原因

认证中间件 `authenticateToken` 设置的 `user` 对象可能没有 `id` 字段，或者字段名不是 `id`。

从日志中可以看到用户查询使用 `["admin"]` 作为参数，说明用户标识符是 "admin"，但可能存储在 `user.username` 或其他字段中。

## 解决方案

需要检查认证中间件设置的 `user` 对象结构，确保正确获取用户ID。

可能的修复方案：

### 方案1：使用 username 作为 applicantId

如果 `user.id` 不存在，但 `user.username` 存在，可以使用 username：

```typescript
application.applicantId = user.id || user.username;
```

### 方案2：检查认证中间件

查看 `backend/src/middleware/auth.ts` 中的 `authenticateToken` 函数，确认它如何设置 `req.user`。

## 下一步

1. 查看认证中间件的实现
2. 确认 `user` 对象的结构
3. 修复 `applicantId` 的赋值逻辑
4. 重新测试提交申请功能
