# 结算报表布局优化

## 优化内容

### 1. 图表布局调整

#### 调整前
- 结算趋势分析图：全宽显示（占据整行）
- 有效率趋势图和状态分布图：并排显示

#### 调整后
- **第一行**：结算趋势分析图 + 有效率趋势图（各占50%）
- **第二行**：状态分布图 + 有效/无效对比图（各占50%）

### 2. 公司排名表格优化

#### 移除字段
- ❌ 首次结算日期（firstSettlementDate）

#### 保留字段（12列）
1. 排名
2. 公司名称
3. 总订单
4. 已结算
5. 未结算
6. 有效
7. 无效
8. 待处理
9. 已结算金额
10. 未结算金额
11. 平均单价
12. 结算率（进度条）
13. 有效率（进度条）
14. 最近结算

### 3. 新增图表：有效/无效对比

#### 图表类型
环形饼图（Donut Chart）

#### 数据展示
- **有效资料**：绿色 (#67c23a)
- **无效资料**：红色 (#f56c6c)

#### 图表特点
- 环形设计，中空部分占40%
- 圆角边框，白色分隔线
- 标签显示：名称、数量、百分比
- 悬停放大效果

#### 数据来源
```typescript
{
  name: '有效',
  value: summary.value.valid.count,
  itemStyle: { color: '#67c23a' }
},
{
  name: '无效',
  value: summary.value.invalid.count,
  itemStyle: { color: '#f56c6c' }
}
```

## 页面布局结构

```
┌─────────────────────────────────────────────────────────┐
│ 页面头部（筛选器）                                        │
├─────────────────────────────────────────────────────────┤
│ 快捷日期筛选                                             │
├─────────────────────────────────────────────────────────┤
│ 汇总卡片（第一行）- 4个卡片                               │
│ [总订单] [已结算] [未结算] [平均单价+结算率]              │
├─────────────────────────────────────────────────────────┤
│ 汇总卡片（第二行）- 3个卡片                               │
│ [有效资料] [无效资料] [待处理]                            │
├─────────────────────────────────────────────────────────┤
│ 图表区域（第一行）- 2个图表                               │
│ ┌──────────────────────┬──────────────────────┐         │
│ │ 结算趋势分析          │ 有效率趋势            │         │
│ │ (订单数/金额/单价)    │ (有效率/结算率)       │         │
│ └──────────────────────┴──────────────────────┘         │
├─────────────────────────────────────────────────────────┤
│ 图表区域（第二行）- 2个图表                               │
│ ┌──────────────────────┬──────────────────────┐         │
│ │ 状态分布              │ 有效/无效对比         │         │
│ │ (有效/无效/待处理)    │ (环形饼图)            │         │
│ └──────────────────────┴──────────────────────┘         │
├─────────────────────────────────────────────────────────┤
│ 公司排名表格（12列）                                      │
│ [排名][公司][总订单][已结算][未结算][有效][无效]...      │
└─────────────────────────────────────────────────────────┘
```

## 图表尺寸

所有图表统一高度：350px

```scss
.chart-container {
  width: 100%;
  height: 350px;
}
```

## 响应式处理

所有图表监听窗口大小变化，自动调整尺寸：

```typescript
window.addEventListener('resize', () => {
  trendChart?.resize()
  validRateChart?.resize()
  statusPieChart?.resize()
  validInvalidPieChart?.resize()
})
```

## 图表配置详情

### 有效/无效对比图配置

```typescript
{
  tooltip: {
    trigger: 'item',
    formatter: '{a} <br/>{b}: {c}单 ({d}%)'
  },
  legend: {
    orient: 'vertical',
    left: 'left'
  },
  series: [{
    name: '有效/无效对比',
    type: 'pie',
    radius: ['40%', '70%'],  // 环形图
    avoidLabelOverlap: false,
    itemStyle: {
      borderRadius: 10,      // 圆角
      borderColor: '#fff',   // 白色边框
      borderWidth: 2
    },
    label: {
      show: true,
      formatter: '{b}\n{c}单\n{d}%'  // 多行显示
    },
    emphasis: {
      label: {
        show: true,
        fontSize: 16,
        fontWeight: 'bold'
      }
    },
    data: [
      { name: '有效', value: validCount, itemStyle: { color: '#67c23a' } },
      { name: '无效', value: invalidCount, itemStyle: { color: '#f56c6c' } }
    ]
  }]
}
```

## 优化效果

### 布局优化
- ✅ 图表布局更加均衡，不再有全宽图表
- ✅ 4个图表并排显示，信息密度更高
- ✅ 页面滚动距离减少，用户体验更好

### 数据展示
- ✅ 新增有效/无效对比图，直观展示资料质量
- ✅ 环形图设计更加现代化
- ✅ 移除不常用的"首次结算"字段，表格更简洁

### 视觉效果
- ✅ 图表大小统一，视觉更协调
- ✅ 颜色编码一致（绿色=有效，红色=无效）
- ✅ 图表间距合理，不拥挤

## 数据分析价值

### 有效/无效对比图的作用
1. **快速评估资料质量**：一眼看出有效率
2. **发现问题**：无效资料占比过高时需要关注
3. **趋势对比**：配合有效率趋势图，分析质量变化
4. **决策支持**：帮助管理层评估外包公司表现

### 与其他图表的配合
- **状态分布图**：显示有效/无效/待处理三种状态
- **有效/无效对比图**：聚焦有效和无效的对比
- **有效率趋势图**：显示有效率随时间的变化
- **结算趋势图**：显示结算金额和订单数的变化

## 相关文件

- `src/views/Finance/SettlementReport.vue` - 结算报表页面
- `docs/临时文件/结算报表全面优化完成.md` - 之前的优化文档

## 总结

本次优化主要解决了两个问题：
1. ✅ 结算趋势图占据整行，导致页面布局不均衡
2. ✅ 缺少有效/无效的直观对比图表

优化后的布局更加合理，数据展示更加全面，用户体验得到提升。
