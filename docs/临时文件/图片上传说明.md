# 图片上传存储说明

## 存储位置

### 开发环境
- **物理路径**：`项目根目录/uploads/cod-proof/`
- **访问URL**：`http://localhost:3000/uploads/cod-proof/文件名.png`

### 生产环境
- **物理路径**：`项目根目录/uploads/cod-proof/`
- **访问URL**：`https://你的域名/uploads/cod-proof/文件名.png`

## 文件命名规则

```
时间戳-随机数.扩展名
例如：1771989402894-983122876.png
```

## 静态文件服务配置

后端已配置静态文件服务（`backend/src/app.ts`）：

```typescript
app.use('/uploads', express.static(path.join(process.cwd(), 'uploads')));
```

## 支持的图片格式

- JPEG (.jpg, .jpeg)
- PNG (.png)
- GIF (.gif)
- WebP (.webp)

## 文件大小限制

- 单个文件最大：5MB
- 每次申请最多：5张图片

## 生产环境部署注意事项

### 1. 创建上传目录

```bash
# 在项目根目录执行
mkdir -p uploads/cod-proof
chmod 755 uploads/cod-proof
```

### 2. 确保目录权限

```bash
# 确保Node.js进程有写权限
chown -R node_user:node_group uploads/
```

### 3. Nginx配置（如果使用Nginx）

```nginx
location /uploads/ {
    alias /path/to/project/uploads/;
    expires 30d;
    add_header Cache-Control "public, immutable";
}
```

## 迁移到OSS（可选）

如果需要使用阿里云OSS或其他云存储服务，需要修改：

1. 安装OSS SDK：`npm install ali-oss`
2. 修改 `backend/src/routes/codApplication.ts` 的上传配置
3. 将multer的本地存储改为OSS上传
4. 返回OSS的公网URL

### OSS配置示例

```typescript
import OSS from 'ali-oss';

const client = new OSS({
  region: 'oss-cn-hangzhou',
  accessKeyId: process.env.OSS_ACCESS_KEY_ID,
  accessKeySecret: process.env.OSS_ACCESS_KEY_SECRET,
  bucket: 'your-bucket-name'
});

// 上传到OSS
const result = await client.put(`cod-proof/${filename}`, file.buffer);
const fileUrl = result.url; // OSS公网URL
```

## 当前状态

✅ 已修复路径配置问题
✅ 文件已迁移到正确位置（`uploads/cod-proof/`）
✅ 静态文件服务已配置
✅ 支持本地文件系统存储

## 已存在的文件

当前 `uploads/cod-proof/` 目录中有5个文件：
- 1771989402894-983122876.png
- 1771989617382-546356455.png
- 1771990424073-686288109.png
- 1771990537415-967435310.png
- 1771990545613-9566588.png
