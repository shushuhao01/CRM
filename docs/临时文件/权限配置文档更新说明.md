# 权限配置文档更新说明

## 更新日期
2025年12月25日

## 更新内容

### 1. 文档重命名
为了更好地区分两个权限配置文档的用途，进行了重命名：

| 原文件名 | 新文件名 | 说明 |
|---------|---------|------|
| `角色权限配置详细文档.md` | `角色权限配置说明-完整版.md` | 包含所有权限的详细说明，适合开发人员和系统管理员 |
| `角色权限配置说明文档.md` | `角色权限配置说明-简化版.md` | 简化版权限说明，适合日常查阅和培训使用 |

### 2. 新增财务管理模块权限说明

#### 2.1 简化版文档更新
- 更新文档版本：v2.0 → v2.1
- 更新日期：2025年12月25日
- 新增内容：
  - 超级管理员权限表格中新增财务管理模块（5个子菜单）
  - 部门经理权限表格中新增财务管理模块（绩效数据、取消代收申请）
  - 销售员权限表格中新增财务管理模块（绩效数据、取消代收申请）
  - 客服权限表格中标注财务管理模块无权限
  - 新增"第十章：财务管理模块权限详解"，包含：
    - 10.1 财务管理模块概述
    - 10.2 绩效数据权限说明
    - 10.3 绩效管理权限说明
    - 10.4 代收管理权限说明
    - 10.5 取消代收申请权限说明
    - 10.6 取消代收审核权限说明
    - 10.7 数据范围控制
    - 10.8 特殊权限说明

#### 2.2 完整版文档更新
- 更新文档版本：1.0 → 1.1
- 更新日期：2025年12月25日
- 新增内容：
  - 2.10 财务管理权限树结构（包含所有按钮权限）
  - 新增"第八章：财务管理模块权限详解"，包含：
    - 8.1 模块概述
    - 8.2 绩效数据详细说明
    - 8.3 绩效管理详细说明
    - 8.4 代收管理详细说明
    - 8.5 取消代收申请详细说明
    - 8.6 取消代收审核详细说明
    - 8.7 数据范围控制总结
    - 8.8 配置文件位置

### 3. 财务管理模块权限配置详情

#### 3.1 模块结构
```
财务管理 (finance)
├── 绩效数据 (finance.performance_data)
│   ├── 查看绩效数据
│   ├── 导出绩效数据
│   └── 查看统计
├── 绩效管理 (finance.manage)
│   ├── 查看绩效管理
│   ├── 编辑绩效状态
│   ├── 批量更新状态
│   ├── 设置绩效系数
│   ├── 配置管理
│   └── 导出数据
├── 代收管理 (finance.cod)
│   ├── 查看代收列表
│   ├── 改代收金额
│   ├── 标记返款
│   ├── 批量改代收
│   ├── 批量返款
│   └── 导出代收数据
├── 取消代收申请 (finance.cod_application)
│   ├── 查看申请列表
│   ├── 发起申请
│   ├── 编辑申请
│   ├── 撤回申请
│   └── 上传凭证
└── 取消代收审核 (finance.cod.review)
    ├── 查看审核列表
    ├── 审核通过
    ├── 审核拒绝
    └── 查看详情
```

#### 3.2 各角色权限分配

| 功能模块 | 超管 | 管理员 | 部门经理 | 销售员 | 客服 |
|---------|:----:|:------:|:--------:|:------:|:----:|
| 绩效数据 | ✅ 全部 | ✅ 全部 | ✅ 部门 | ✅ 个人 | ❌ |
| 绩效管理 | ✅ | ✅ | ❌ | ❌ | ❌ |
| 代收管理 | ✅ | ✅ | ❌ | ❌ | ❌ |
| 取消代收申请 | ✅ 全部 | ✅ 全部 | ✅ 个人 | ✅ 个人 | ❌ |
| 取消代收审核 | ✅ | ✅ | ❌ | ❌ | ❌ |

#### 3.3 关键业务规则

1. **代收金额修改规则**：
   - 使用当前代收金额作为修改上限，而不是原始代收金额
   - 示例：原始¥300 → 改为¥100 → 再次修改最多¥100

2. **订单状态限制**：
   - 已发货（未签收）：可以改代收 ✅
   - 已签收/已完成：不能改代收 ❌（客户已付款给快递员）

3. **代收状态变化**：
   - 改为0元 → 标记为"已改代收"（不能再修改）
   - 改为>0元 → 保持"待处理"（可以继续修改）

4. **消息通知**：
   - 申请提交 → 通知审核人员（管理员）
   - 审核通过 → 通知申请人
   - 审核拒绝 → 通知申请人

### 4. 权限标识汇总

#### 4.1 部门经理新增权限
```typescript
// 财务管理（绩效数据和取消代收申请，部门数据）
'finance', 
'finance.performance_data', 
'finance.performance_data.view',
'finance.cod_application', 
'finance.cod_application.view', 
'finance.cod_application.create'
```

#### 4.2 销售员新增权限
```typescript
// 财务管理（绩效数据和取消代收申请，个人数据）
'finance', 
'finance.performance_data', 
'finance.performance_data.view',
'finance.cod_application', 
'finance.cod_application.view', 
'finance.cod_application.create'
```

#### 4.3 管理员新增权限
```typescript
// 财务管理（全部权限）
'finance', 
'finance:data', 
'finance:manage', 
'finance:cod'
```

### 5. 配置文件更新位置

需要更新以下配置文件以应用新的权限：

1. **菜单配置**：`src/config/menu.ts`
   - 已配置财务管理菜单和子菜单
   - 已设置各菜单的角色和权限要求

2. **默认权限配置**：`src/config/defaultRolePermissions.ts`
   - 需要为部门经理和销售员添加财务管理权限

3. **路由配置**：`src/router/index.ts`
   - 已配置财务管理相关路由

### 6. 注意事项

1. **权限生效**：
   - 修改权限配置后，用户需要重新登录才能生效
   - 或者在"系统管理 → 角色权限"中重新保存角色权限

2. **数据范围**：
   - 前端和后端都需要实现数据范围过滤
   - 前端控制显示，后端控制数据访问

3. **消息通知**：
   - 需要配置消息通知类型和模板
   - 在"系统管理 → 消息管理 → 通知配置"中配置

4. **测试建议**：
   - 使用不同角色账号测试各功能的访问权限
   - 验证数据范围过滤是否正确
   - 测试消息通知是否正常发送

---

## 文档位置

- **简化版**：`docs/角色权限配置说明-简化版.md`
- **完整版**：`docs/角色权限配置说明-完整版.md`
- **本说明**：`docs/临时文件/权限配置文档更新说明.md`

---

> 更新完成时间：2025年12月25日
