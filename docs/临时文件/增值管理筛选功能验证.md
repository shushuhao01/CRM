# å¢å€¼ç®¡ç†ç­›é€‰åŠŸèƒ½éªŒè¯

## éªŒè¯æ—¶é—´
2026-03-01

## æ ¸å¿ƒç¡®è®¤

### âœ… ç­›é€‰æ—¶é—´å­—æ®µç¡®è®¤
æ‰€æœ‰ç­›é€‰æ¡ä»¶éƒ½åŸºäº**è®¢å•ä¸‹å•æ—¶é—´**ï¼ˆ`order.created_at` æˆ– `order_date`ï¼‰ï¼Œè€Œä¸æ˜¯ç»“ç®—æ—¥æœŸã€‚

## ä»£ç éªŒè¯

### 1. è®¢å•åˆ—è¡¨API (`GET /value-added/orders`)

#### æ—¥æœŸç­›é€‰ä»£ç 
```typescript
// ğŸ”¥ æ—¥æœŸç­›é€‰ - æ”¯æŒå¿«æ·æ—¥æœŸå’Œè‡ªå®šä¹‰æ—¥æœŸ
if (dateFilter && dateFilter !== 'all') {
  // ... è®¡ç®—æ—¥æœŸèŒƒå›´ ...
  queryBuilder.andWhere('order.created_at BETWEEN :startDate AND :endDate', {
    startDate: filterStartDate,
    endDate: filterEndDate
  });
} else if (startDate && endDate) {
  // è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´
  queryBuilder.andWhere('order.created_at BETWEEN :startDate AND :endDate', {
    startDate: new Date(startDate as string),
    endDate: new Date(endDate as string + ' 23:59:59')
  });
}
```

âœ… **ç¡®è®¤**ï¼šä½¿ç”¨ `order.created_at`ï¼ˆä¸‹å•æ—¶é—´ï¼‰

### 2. ç»Ÿè®¡æ•°æ®API (`GET /value-added/stats`)

#### æ—¥æœŸç­›é€‰ä»£ç 
```typescript
// æ—¥æœŸç­›é€‰ - æ”¯æŒå¿«æ·æ—¥æœŸå’Œè‡ªå®šä¹‰æ—¥æœŸ
if (dateFilter && dateFilter !== 'all') {
  // ... è®¡ç®—æ—¥æœŸèŒƒå›´ ...
  queryBuilder.where('order.created_at BETWEEN :startDate AND :endDate', {
    startDate: filterStartDate,
    endDate: filterEndDate
  });
} else if (startDate && endDate) {
  // è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´
  queryBuilder.where('order.created_at BETWEEN :startDate AND :endDate', {
    startDate: new Date(startDate as string),
    endDate: new Date(endDate as string + ' 23:59:59')
  });
}
```

âœ… **ç¡®è®¤**ï¼šä½¿ç”¨ `order.created_at`ï¼ˆä¸‹å•æ—¶é—´ï¼‰

## ç­›é€‰æ¡ä»¶å®Œæ•´æ€§éªŒè¯

### è®¢å•åˆ—è¡¨APIæ”¯æŒçš„ç­›é€‰æ¡ä»¶
- âœ… `dateFilter` - å¿«æ·æ—¥æœŸï¼ˆä»Šæ—¥ã€æœ¬æœˆã€ä¸Šæœˆç­‰ï¼‰
- âœ… `startDate` + `endDate` - è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´
- âœ… `companyId` - å¤–åŒ…å…¬å¸
- âœ… `status` - æœ‰æ•ˆçŠ¶æ€
- âœ… `settlementStatus` - ç»“ç®—çŠ¶æ€
- âœ… `keywords` - æ‰¹é‡æœç´¢
- âœ… `tab` - æ ‡ç­¾é¡µç­›é€‰

### ç»Ÿè®¡æ•°æ®APIæ”¯æŒçš„ç­›é€‰æ¡ä»¶
- âœ… `dateFilter` - å¿«æ·æ—¥æœŸ
- âœ… `startDate` + `endDate` - è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´
- âœ… `companyId` - å¤–åŒ…å…¬å¸
- âš ï¸ **ç¼ºå°‘** `status` - æœ‰æ•ˆçŠ¶æ€ç­›é€‰
- âš ï¸ **ç¼ºå°‘** `settlementStatus` - ç»“ç®—çŠ¶æ€ç­›é€‰

## éœ€è¦ä¿®å¤çš„é—®é¢˜

### é—®é¢˜ï¼šç»Ÿè®¡æ•°æ®APIç¼ºå°‘ç­›é€‰æ¡ä»¶æ”¯æŒ

ç»Ÿè®¡æ•°æ®APIéœ€è¦æ”¯æŒä¸è®¢å•åˆ—è¡¨ç›¸åŒçš„ç­›é€‰æ¡ä»¶ï¼Œç¡®ä¿ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºçš„æ•°æ®ä¸åˆ—è¡¨æ•°æ®ä¸€è‡´ã€‚

#### å½“å‰é—®é¢˜
ç”¨æˆ·åœ¨ç­›é€‰å™¨ä¸­é€‰æ‹©"æœ‰æ•ˆçŠ¶æ€"æˆ–"ç»“ç®—çŠ¶æ€"æ—¶ï¼š
- âœ… è®¢å•åˆ—è¡¨æ­£ç¡®ç­›é€‰
- âŒ ç»Ÿè®¡å¡ç‰‡ä¸ä¼šæ ¹æ®è¿™äº›æ¡ä»¶æ›´æ–°

#### è§£å†³æ–¹æ¡ˆ
åœ¨ç»Ÿè®¡æ•°æ®APIä¸­æ·»åŠ å¯¹ `status` å’Œ `settlementStatus` çš„æ”¯æŒã€‚

## æ•°æ®æµç¨‹å›¾

```
ç”¨æˆ·æ“ä½œ
  â†“
é€‰æ‹©ç­›é€‰æ¡ä»¶ï¼ˆæ—¥æœŸã€å…¬å¸ã€çŠ¶æ€ç­‰ï¼‰
  â†“
å‰ç«¯è°ƒç”¨ä¸¤ä¸ªAPI
  â”œâ”€â†’ GET /value-added/orders (è®¢å•åˆ—è¡¨)
  â”‚     â”œâ”€ ä½¿ç”¨ order.created_at ç­›é€‰
  â”‚     â”œâ”€ åº”ç”¨æ‰€æœ‰ç­›é€‰æ¡ä»¶
  â”‚     â””â”€ è¿”å›è®¢å•åˆ—è¡¨
  â”‚
  â””â”€â†’ GET /value-added/stats (ç»Ÿè®¡æ•°æ®)
        â”œâ”€ ä½¿ç”¨ order.created_at ç­›é€‰
        â”œâ”€ åº”ç”¨ç­›é€‰æ¡ä»¶ï¼ˆéœ€è¦å®Œå–„ï¼‰
        â””â”€ è¿”å›ç»Ÿè®¡å¡ç‰‡æ•°æ®
```

## æµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šå¿«æ·æ—¥æœŸç­›é€‰
1. ç‚¹å‡»"æœ¬æœˆ"æŒ‰é’®
2. **é¢„æœŸç»“æœ**ï¼š
   - è®¢å•åˆ—è¡¨æ˜¾ç¤ºæœ¬æœˆä¸‹å•çš„è®¢å•
   - ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºæœ¬æœˆä¸‹å•è®¢å•çš„ç»Ÿè®¡æ•°æ®
   - ä¸¤è€…æ•°æ®ä¸€è‡´

### åœºæ™¯2ï¼šè‡ªå®šä¹‰æ—¥æœŸç­›é€‰
1. é€‰æ‹©æ—¥æœŸèŒƒå›´ï¼š2025-01-01 è‡³ 2025-01-31
2. **é¢„æœŸç»“æœ**ï¼š
   - è®¢å•åˆ—è¡¨æ˜¾ç¤ºè¯¥æ—¥æœŸèŒƒå›´å†…ä¸‹å•çš„è®¢å•
   - ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºè¯¥æ—¥æœŸèŒƒå›´å†…è®¢å•çš„ç»Ÿè®¡æ•°æ®
   - ä¸¤è€…æ•°æ®ä¸€è‡´

### åœºæ™¯3ï¼šç»„åˆç­›é€‰ï¼ˆæ—¥æœŸ+å…¬å¸ï¼‰
1. é€‰æ‹©"æœ¬æœˆ" + "å…¬å¸A"
2. **é¢„æœŸç»“æœ**ï¼š
   - è®¢å•åˆ—è¡¨æ˜¾ç¤ºæœ¬æœˆä¸‹å•ä¸”åˆ†é…ç»™å…¬å¸Açš„è®¢å•
   - ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºæœ¬æœˆä¸‹å•ä¸”åˆ†é…ç»™å…¬å¸Açš„è®¢å•ç»Ÿè®¡
   - ä¸¤è€…æ•°æ®ä¸€è‡´

### åœºæ™¯4ï¼šç»„åˆç­›é€‰ï¼ˆæ—¥æœŸ+çŠ¶æ€ï¼‰
1. é€‰æ‹©"æœ¬æœˆ" + "æœ‰æ•ˆçŠ¶æ€"
2. **é¢„æœŸç»“æœ**ï¼š
   - è®¢å•åˆ—è¡¨æ˜¾ç¤ºæœ¬æœˆä¸‹å•ä¸”çŠ¶æ€ä¸ºæœ‰æ•ˆçš„è®¢å•
   - ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºæœ¬æœˆä¸‹å•ä¸”çŠ¶æ€ä¸ºæœ‰æ•ˆçš„è®¢å•ç»Ÿè®¡
   - âš ï¸ **å½“å‰é—®é¢˜**ï¼šç»Ÿè®¡å¡ç‰‡ä¸ä¼šæ ¹æ®æœ‰æ•ˆçŠ¶æ€ç­›é€‰

### åœºæ™¯5ï¼šç»„åˆç­›é€‰ï¼ˆæ—¥æœŸ+ç»“ç®—çŠ¶æ€ï¼‰
1. é€‰æ‹©"æœ¬æœˆ" + "å·²ç»“ç®—"
2. **é¢„æœŸç»“æœ**ï¼š
   - è®¢å•åˆ—è¡¨æ˜¾ç¤ºæœ¬æœˆä¸‹å•ä¸”å·²ç»“ç®—çš„è®¢å•
   - ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºæœ¬æœˆä¸‹å•ä¸”å·²ç»“ç®—çš„è®¢å•ç»Ÿè®¡
   - âš ï¸ **å½“å‰é—®é¢˜**ï¼šç»Ÿè®¡å¡ç‰‡ä¸ä¼šæ ¹æ®ç»“ç®—çŠ¶æ€ç­›é€‰

## æ•°æ®åº“å­—æ®µè¯´æ˜

### value_added_orders è¡¨å…³é”®å­—æ®µ
- `created_at` - å¢å€¼è®¢å•åˆ›å»ºæ—¶é—´ï¼ˆè®¢å•åŒæ­¥åˆ°å¢å€¼ç®¡ç†çš„æ—¶é—´ï¼‰
- `order_date` - åŸå§‹è®¢å•ä¸‹å•æ—¶é—´ï¼ˆä»ordersè¡¨åŒæ­¥è¿‡æ¥ï¼‰
- `settlement_date` - ç»“ç®—æ—¥æœŸï¼ˆè®¢å•ç»“ç®—çš„æ—¶é—´ï¼‰

### ç­›é€‰åº”è¯¥ä½¿ç”¨çš„å­—æ®µ
- âœ… **æ­£ç¡®**ï¼šä½¿ç”¨ `created_at` æˆ– `order_date`ï¼ˆä¸‹å•æ—¶é—´ï¼‰
- âŒ **é”™è¯¯**ï¼šä½¿ç”¨ `settlement_date`ï¼ˆç»“ç®—æ—¶é—´ï¼‰

## ä¸šåŠ¡é€»è¾‘è¯´æ˜

### ä¸ºä»€ä¹ˆä½¿ç”¨ä¸‹å•æ—¶é—´è€Œä¸æ˜¯ç»“ç®—æ—¶é—´ï¼Ÿ

1. **ä¸šåŠ¡éœ€æ±‚**ï¼šç”¨æˆ·éœ€è¦æŸ¥çœ‹æŸä¸ªæ—¶é—´æ®µå†…äº§ç”Ÿçš„è®¢å•ï¼Œè€Œä¸æ˜¯æŸä¸ªæ—¶é—´æ®µå†…ç»“ç®—çš„è®¢å•
2. **æ•°æ®å®Œæ•´æ€§**ï¼šæœªç»“ç®—çš„è®¢å•æ²¡æœ‰ç»“ç®—æ—¥æœŸï¼Œå¦‚æœæŒ‰ç»“ç®—æ—¥æœŸç­›é€‰ä¼šé—æ¼è¿™äº›è®¢å•
3. **ç»Ÿè®¡å‡†ç¡®æ€§**ï¼šæŒ‰ä¸‹å•æ—¶é—´ç»Ÿè®¡å¯ä»¥å‡†ç¡®åæ˜ ä¸šåŠ¡é‡å’Œè¶‹åŠ¿

### ç¤ºä¾‹è¯´æ˜

å‡è®¾æœ‰ä»¥ä¸‹è®¢å•ï¼š
- è®¢å•Aï¼š2025-01-15ä¸‹å•ï¼Œ2025-02-01ç»“ç®—
- è®¢å•Bï¼š2025-01-20ä¸‹å•ï¼Œæœªç»“ç®—
- è®¢å•Cï¼š2025-02-05ä¸‹å•ï¼Œ2025-02-10ç»“ç®—

ç”¨æˆ·é€‰æ‹©"2025å¹´1æœˆ"ç­›é€‰ï¼š
- âœ… **æ­£ç¡®ç»“æœ**ï¼ˆæŒ‰ä¸‹å•æ—¶é—´ï¼‰ï¼šæ˜¾ç¤ºè®¢å•Aå’Œè®¢å•B
- âŒ **é”™è¯¯ç»“æœ**ï¼ˆæŒ‰ç»“ç®—æ—¶é—´ï¼‰ï¼šåªæ˜¾ç¤ºè®¢å•Aï¼Œé—æ¼è®¢å•B

## å‰ç«¯ç­›é€‰é€»è¾‘

### æ—¥æœŸä¼˜å…ˆçº§
```typescript
// ä¼˜å…ˆä½¿ç”¨è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´ï¼Œå¦åˆ™ä½¿ç”¨å¿«æ·æ—¥æœŸ
if (customDateRange.value && customDateRange.value.length === 2) {
  params.startDate = customDateRange.value[0]
  params.endDate = customDateRange.value[1]
} else if (quickDateFilter.value) {
  params.dateFilter = quickDateFilter.value
}
```

### ç­›é€‰æ¡ä»¶ä¼ é€’
```typescript
const params: any = {
  page: pagination.page,
  pageSize: pagination.pageSize
}

// æ—¥æœŸç­›é€‰
if (customDateRange.value) {
  params.startDate = customDateRange.value[0]
  params.endDate = customDateRange.value[1]
} else if (quickDateFilter.value) {
  params.dateFilter = quickDateFilter.value
}

// å…¶ä»–ç­›é€‰æ¡ä»¶
if (companyFilter.value) params.companyId = companyFilter.value
if (statusFilter.value) params.status = statusFilter.value
if (settlementStatusFilter.value) params.settlementStatus = settlementStatusFilter.value
if (activeTab.value !== 'all') params.tab = activeTab.value
if (batchSearchKeywords.value) params.keywords = batchSearchKeywords.value
```

## åç»­ä¼˜åŒ–å»ºè®®

1. âœ… ç»Ÿè®¡æ•°æ®APIæ·»åŠ  `status` å’Œ `settlementStatus` ç­›é€‰æ”¯æŒ
2. æ·»åŠ ç­›é€‰æ¡ä»¶çš„æŒä¹…åŒ–ï¼Œè®°ä½ç”¨æˆ·çš„ç­›é€‰åå¥½
3. æ·»åŠ "æŒ‰ç»“ç®—æ—¥æœŸç­›é€‰"çš„é€‰é¡¹ï¼ˆä½œä¸ºé¢å¤–åŠŸèƒ½ï¼‰
4. ä¼˜åŒ–å¤§æ•°æ®é‡ä¸‹çš„æŸ¥è¯¢æ€§èƒ½ï¼ˆæ·»åŠ ç´¢å¼•ï¼‰

## ç›¸å…³æ–‡ä»¶

- `backend/src/routes/valueAdded.ts` - åç«¯è·¯ç”±ï¼ˆè®¢å•åˆ—è¡¨å’Œç»Ÿè®¡æ•°æ®ï¼‰
- `src/views/Finance/ValueAddedManage.vue` - å‰ç«¯ä¸»è§†å›¾
- `backend/src/entities/ValueAddedOrder.ts` - æ•°æ®å®ä½“

## æ€»ç»“

âœ… **å·²ç¡®è®¤**ï¼š
- è®¢å•åˆ—è¡¨APIä½¿ç”¨ä¸‹å•æ—¶é—´ï¼ˆ`order.created_at`ï¼‰è¿›è¡Œç­›é€‰
- ç»Ÿè®¡æ•°æ®APIä½¿ç”¨ä¸‹å•æ—¶é—´ï¼ˆ`order.created_at`ï¼‰è¿›è¡Œç­›é€‰
- è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©å™¨å·²å®ç°
- å¿«æ·æ—¥æœŸç­›é€‰å·²å®ç°

âš ï¸ **éœ€è¦æ³¨æ„**ï¼š
- ç»Ÿè®¡æ•°æ®APIéœ€è¦æ·»åŠ å¯¹æœ‰æ•ˆçŠ¶æ€å’Œç»“ç®—çŠ¶æ€çš„ç­›é€‰æ”¯æŒ
- ç¡®ä¿ç»Ÿè®¡å¡ç‰‡æ•°æ®ä¸è®¢å•åˆ—è¡¨æ•°æ®ä¸€è‡´
