# 数据库表补充需求分析

## 📋 需求分析结果

根据代码分析，以下是各功能模块的数据库表需求：

### 1. ✅ 消息提醒和系统公告 - **需要添加**

**当前状态**：仅存储在 localStorage，没有数据库表
**建议**：创建消息通知表

**理由**：
- 代码中有完整的消息类型定义（50+种消息类型）
- 支持多种消息分类（订单、售后、客户、物流、审核、业绩、短信等）
- 需要持久化存储和跨设备同步
- 需要支持消息已读/未读状态管理

**需要的表**：
1. `notifications` - 消息通知表
2. `system_announcements` - 系统公告表

---

### 2. ✅ 订单审核 - **需要添加**

**当前状态**：审核信息存储在订单表的JSON字段中
**建议**：创建独立的审核记录表

**理由**：
- 需要记录完整的审核历史
- 支持多级审核流程
- 需要审核统计和报表
- 便于审核权限管理

**需要的表**：
1. `order_audits` - 订单审核记录表

---

### 3. ✅ 业绩分享 - **需要添加**

**当前状态**：代码中有完整的业绩分享功能实现
**建议**：创建业绩分享相关表

**理由**：
- 支持多人业绩分配
- 需要记录分享比例和确认状态
- 需要业绩分享统计
- 涉及金额计算，需要可靠存储

**需要的表**：
1. `performance_shares` - 业绩分享记录表
2. `performance_share_members` - 业绩分享成员表

---

### 4. ✅ 物流管理 - **需要完善**

**当前状态**：已有 `logistics` 表，但功能不完整
**建议**：补充物流相关表

**理由**：
- 需要管理物流公司信息
- 需要记录物流状态更新历史
- 需要物流异常处理记录
- 需要物流待办事项管理

**需要的表**：
1. `logistics_companies` - 物流公司表 ✨新增
2. `logistics_status_history` - 物流状态历史表 ✨新增
3. `logistics_exceptions` - 物流异常记录表 ✨新增
4. `logistics_todos` - 物流待办事项表 ✨新增

---

### 5. ⚠️ 系统管理模块 - **部分需要**

#### 5.1 部门管理 ✅ 已有
- 表：`departments` - 已存在，无需添加

#### 5.2 用户管理 ✅ 已有
- 表：`users` - 已存在，无需添加

#### 5.3 角色权限 ✅ 已有
- 表：`roles` - 已存在，无需添加

#### 5.4 客服管理 ❌ 不需要
- 客服信息存储在 `users` 表中，通过角色区分

#### 5.5 消息管理 ✅ 需要
- 见第1点：消息提醒和系统公告

#### 5.6 权限管理 ✅ 已有
- 权限信息存储在 `roles` 表的 JSON 字段中

#### 5.7 系统设置 ✅ 已有
- 表：`system_configs` - 已存在，无需添加

---

## 📊 需要添加的数据库表汇总

### 总计：**10个新表**

1. **notifications** - 消息通知表
2. **system_announcements** - 系统公告表
3. **order_audits** - 订单审核记录表
4. **performance_shares** - 业绩分享记录表
5. **performance_share_members** - 业绩分享成员表
6. **logistics_companies** - 物流公司表
7. **logistics_status_history** - 物流状态历史表
8. **logistics_exceptions** - 物流异常记录表
9. **logistics_todos** - 物流待办事项表
10. **order_field_configs** - 订单字段配置表（可选）

---

## 🎯 优先级建议

### 高优先级（必须）
1. ✅ **notifications** - 消息通知表
2. ✅ **order_audits** - 订单审核记录表
3. ✅ **logistics_companies** - 物流公司表
4. ✅ **logistics_status_history** - 物流状态历史表

### 中优先级（重要）
5. ✅ **performance_shares** - 业绩分享记录表
6. ✅ **performance_share_members** - 业绩分享成员表
7. ✅ **system_announcements** - 系统公告表

### 低优先级（可选）
8. ⭕ **logistics_exceptions** - 物流异常记录表
9. ⭕ **logistics_todos** - 物流待办事项表
10. ⭕ **order_field_configs** - 订单字段配置表

---

## 💡 实施建议

1. **第一阶段**：添加高优先级的4个表
   - 解决核心业务功能的数据持久化问题
   - 预计工作量：2-3小时

2. **第二阶段**：添加中优先级的3个表
   - 完善业务功能和用户体验
   - 预计工作量：1-2小时

3. **第三阶段**：根据实际需求添加低优先级表
   - 优化系统功能和性能
   - 预计工作量：1小时

---

## 📝 注意事项

1. **数据迁移**：部分功能当前使用 localStorage 存储，需要编写数据迁移脚本
2. **API适配**：需要同步更新后端API接口
3. **前端适配**：需要修改前端代码，从localStorage改为API调用
4. **权限控制**：新表需要配置相应的数据权限规则
5. **索引优化**：根据查询场景添加合适的索引

---

## 🔄 下一步行动

是否需要我立即创建这些数据库表的SQL脚本？

请确认：
- [ ] 是否需要全部10个表？
- [ ] 还是只创建高优先级的4个表？
- [ ] 或者按阶段逐步创建？
