# 财务管理权限配置说明

## 修改时间
2026年2月26日

## 修改内容
为销售员和部门经理角色添加财务管理模块的访问权限

---

## 一、权限配置总览

### 五个角色的财务管理权限

| 角色 | 绩效数据 | 绩效管理 | 代收管理 | 取消代收申请 | 取消代收审核 | 数据范围 |
|------|:--------:|:--------:|:--------:|:------------:|:------------:|----------|
| **超级管理员** | ✅ | ✅ | ✅ | ✅ | ✅ | 全部数据 |
| **管理员** | ✅ | ✅ | ✅ | ✅ | ✅ | 全部数据 |
| **部门经理** | ✅ | ❌ | ❌ | ✅ | ❌ | 本部门/个人 |
| **销售员** | ✅ | ❌ | ❌ | ✅ | ❌ | 个人数据 |
| **客服** | ❌ | ❌ | ❌ | ❌ | ❌ | 无权访问 |

---

## 二、修改的文件

### 1. src/config/defaultRolePermissions.ts

#### 部门经理权限（新增）
```typescript
// 财务管理（绩效数据和取消代收申请，本部门/个人数据）
'finance', 'finance.performance_data', 'finance.performance_data.view',
'finance.cod_application', 'finance.cod_application.view', 'finance.cod_application.create'
```

#### 销售员权限（新增）
```typescript
// 财务管理（绩效数据和取消代收申请，个人数据）
'finance', 'finance.performance_data', 'finance.performance_data.view',
'finance.cod_application', 'finance.cod_application.view', 'finance.cod_application.create'
```

---

## 三、权限说明

### 1. 绩效数据 (finance:performance_data)

**功能**：查看订单绩效数据和统计信息

**权限分配**：
- **超级管理员/管理员**：查看全部数据，可导出
- **部门经理**：查看本部门数据，可导出
- **销售员**：查看个人数据，可导出
- **客服**：无权访问

**权限代码**：
- `finance` - 财务管理一级菜单
- `finance.performance_data` - 绩效数据二级菜单
- `finance.performance_data.view` - 查看权限

---

### 2. 取消代收申请 (finance:cod_application)

**功能**：发起代收取消申请，查看自己的申请记录

**权限分配**：
- **超级管理员/管理员**：查看全部申请，可代他人申请
- **部门经理**：查看和操作自己的申请
- **销售员**：查看和操作自己的申请
- **客服**：无权访问

**权限代码**：
- `finance` - 财务管理一级菜单
- `finance.cod_application` - 取消代收申请二级菜单
- `finance.cod_application.view` - 查看权限
- `finance.cod_application.create` - 创建权限

**业务规则**：
1. 只能申请自己创建的订单（管理员不受限制）
2. 订单必须是"已发货（未签收）"状态
3. 订单代收状态必须是"待处理"
4. 修改后金额不能大于当前代收金额

---

### 3. 绩效管理 (finance:performance_manage)

**功能**：管理订单绩效状态和系数

**权限分配**：
- **超级管理员/管理员**：全部权限
- **部门经理**：无权访问
- **销售员**：无权访问
- **客服**：无权访问

---

### 4. 代收管理 (finance:cod)

**功能**：管理已发货订单的代收款项

**权限分配**：
- **超级管理员/管理员**：全部权限
- **部门经理**：无权访问
- **销售员**：无权访问
- **客服**：无权访问

---

### 5. 取消代收审核 (finance:cod:review)

**功能**：审核销售人员提交的代收取消申请

**权限分配**：
- **超级管理员/管理员**：全部权限
- **部门经理**：无权访问
- **销售员**：无权访问
- **客服**：无权访问

---

## 四、菜单显示逻辑

### 财务管理菜单结构

```
财务管理 (finance)
├── 绩效数据 (finance:performance_data) - 超管/管理员/经理/销售员
├── 绩效管理 (finance:performance_manage) - 仅超管/管理员
├── 代收管理 (finance:cod) - 仅超管/管理员
├── 取消代收申请 (finance:cod_application) - 超管/管理员/经理/销售员
└── 取消代收审核 (finance:cod:review) - 仅超管/管理员
```

### 各角色可见菜单

#### 超级管理员/管理员
- ✅ 绩效数据
- ✅ 绩效管理
- ✅ 代收管理
- ✅ 取消代收申请
- ✅ 取消代收审核

#### 部门经理
- ✅ 绩效数据（本部门）
- ✅ 取消代收申请（个人）

#### 销售员
- ✅ 绩效数据（个人）
- ✅ 取消代收申请（个人）

#### 客服
- 无财务管理菜单

---

## 五、数据范围控制

### 绩效数据
| 角色 | 数据范围 | 说明 |
|------|----------|------|
| 超管/管理员 | 全部数据 | 可查看所有订单绩效 |
| 部门经理 | 本部门数据 | 仅查看本部门订单绩效 |
| 销售员 | 个人数据 | 仅查看个人订单绩效 |

### 取消代收申请
| 角色 | 数据范围 | 说明 |
|------|----------|------|
| 超管/管理员 | 全部申请 | 可查看和操作所有申请 |
| 部门经理 | 个人申请 | 仅查看和操作自己的申请 |
| 销售员 | 个人申请 | 仅查看和操作自己的申请 |

---

## 六、测试验证

### 测试步骤

1. **部门经理登录**
   - 检查左侧菜单是否显示"财务管理"
   - 点击"财务管理"，应该看到：
     - ✅ 绩效数据
     - ✅ 取消代收申请
   - 不应该看到：
     - ❌ 绩效管理
     - ❌ 代收管理
     - ❌ 取消代收审核

2. **销售员登录**
   - 检查左侧菜单是否显示"财务管理"
   - 点击"财务管理"，应该看到：
     - ✅ 绩效数据
     - ✅ 取消代收申请
   - 不应该看到：
     - ❌ 绩效管理
     - ❌ 代收管理
     - ❌ 取消代收审核

3. **客服登录**
   - 检查左侧菜单不应该显示"财务管理"

4. **数据范围验证**
   - 部门经理查看绩效数据：只能看到本部门的数据
   - 销售员查看绩效数据：只能看到个人的数据
   - 部门经理/销售员查看取消代收申请：只能看到自己的申请

---

## 七、注意事项

1. **权限缓存**：
   - 用户权限会缓存在 localStorage 中
   - 修改权限后需要用户重新登录生效
   - 或者清除浏览器缓存后刷新页面

2. **数据过滤**：
   - 前端菜单显示由权限控制
   - 后端API需要根据角色过滤数据
   - 确保前后端权限验证一致

3. **权限继承**：
   - 超级管理员和管理员拥有 `*` 通配符权限
   - 自动拥有所有权限，无需单独配置

4. **动态调整**：
   - 系统支持在"系统管理 → 角色权限"中动态调整权限
   - 调整后会覆盖默认配置

---

## 八、相关文件

| 文件路径 | 说明 |
|----------|------|
| `src/config/menu.ts` | 菜单配置，定义菜单的角色访问控制 |
| `src/config/defaultRolePermissions.ts` | 角色默认权限配置 |
| `src/types/permissions.ts` | 权限类型定义 |
| `src/views/Finance/PerformanceData.vue` | 绩效数据页面 |
| `src/views/Finance/MyCodApplication.vue` | 取消代收申请页面 |

---

## 九、权限代码对照表

| 功能 | 权限代码 | 说明 |
|------|----------|------|
| 财务管理菜单 | `finance` | 一级菜单权限 |
| 绩效数据 | `finance.performance_data` | 二级菜单权限 |
| 查看绩效数据 | `finance.performance_data.view` | 操作权限 |
| 取消代收申请 | `finance.cod_application` | 二级菜单权限 |
| 查看申请 | `finance.cod_application.view` | 操作权限 |
| 创建申请 | `finance.cod_application.create` | 操作权限 |
| 绩效管理 | `finance.performance_manage` | 二级菜单权限（仅管理员） |
| 代收管理 | `finance.cod` | 二级菜单权限（仅管理员） |
| 取消代收审核 | `finance.cod.review` | 二级菜单权限（仅管理员） |

---

> 文档创建时间：2026年2月26日
> 
> 修改人员：系统管理员
