# å¢å€¼ç®¡ç†ç­›é€‰åŠŸèƒ½å®Œå–„

## å®ç°æ—¶é—´
2026-03-01

## éœ€æ±‚è¯´æ˜
1. æ·»åŠ è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©å™¨ï¼Œæ”¯æŒé€‰æ‹©ä»»æ„æ—¥æœŸèŒƒå›´
2. æ£€æŸ¥å¹¶å®Œå–„æ‰€æœ‰ç­›é€‰åŠŸèƒ½ï¼Œç¡®ä¿å‰åç«¯æ­£ç¡®åä½œ

## å®ç°å†…å®¹

### 1. å‰ç«¯æ·»åŠ è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©å™¨

#### æ·»åŠ æ—¥æœŸé€‰æ‹©å™¨ç»„ä»¶
```vue
<el-date-picker
  v-model="customDateRange"
  type="daterange"
  range-separator="è‡³"
  start-placeholder="å¼€å§‹æ—¥æœŸ"
  end-placeholder="ç»“æŸæ—¥æœŸ"
  format="YYYY-MM-DD"
  value-format="YYYY-MM-DD"
  clearable
  @change="handleCustomDateChange"
  class="filter-item"
  style="width: 240px;"
/>
```

#### æ·»åŠ å˜é‡å’Œå¤„ç†å‡½æ•°
```typescript
// ç­›é€‰æ¡ä»¶
const quickDateFilter = ref('thisMonth')
const customDateRange = ref<[string, string] | null>(null) // è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´

// è‡ªå®šä¹‰æ—¥æœŸå˜åŒ–
const handleCustomDateChange = (dates: [string, string] | null) => {
  if (dates && dates.length === 2) {
    quickDateFilter.value = '' // æ¸…ç©ºå¿«æ·æ—¥æœŸ
    customDateRange.value = dates
  } else {
    customDateRange.value = null
  }
  pagination.page = 1
  loadData()
  loadStats()
}

// å¿«æ·æ—¥æœŸç‚¹å‡»
const handleQuickDateClick = (val: string) => {
  quickDateFilter.value = val
  customDateRange.value = null // æ¸…ç©ºè‡ªå®šä¹‰æ—¥æœŸ
  pagination.page = 1
  loadData()
  loadStats()
}
```

#### ä¿®æ”¹æ•°æ®åŠ è½½é€»è¾‘
```typescript
// åŠ è½½æ•°æ®
const loadData = async () => {
  loading.value = true
  try {
    const params: any = {
      page: pagination.page,
      pageSize: pagination.pageSize
    }

    // ğŸ”¥ ä¼˜å…ˆä½¿ç”¨è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´ï¼Œå¦åˆ™ä½¿ç”¨å¿«æ·æ—¥æœŸ
    if (customDateRange.value && customDateRange.value.length === 2) {
      params.startDate = customDateRange.value[0]
      params.endDate = customDateRange.value[1]
    } else if (quickDateFilter.value) {
      params.dateFilter = quickDateFilter.value
    }

    if (companyFilter.value) params.companyId = companyFilter.value
    if (statusFilter.value) params.status = statusFilter.value
    if (settlementStatusFilter.value) params.settlementStatus = settlementStatusFilter.value
    if (activeTab.value !== 'all') params.tab = activeTab.value
    if (batchSearchKeywords.value) params.keywords = batchSearchKeywords.value

    const res = await getValueAddedOrders(params) as any
    tableData.value = res?.data?.list || res?.list || []
    pagination.total = res?.data?.total || res?.total || 0
  } catch (e) {
    console.error('åŠ è½½æ•°æ®å¤±è´¥:', e)
    ElMessage.error('åŠ è½½æ•°æ®å¤±è´¥')
  } finally {
    loading.value = false
  }
}
```

### 2. åç«¯å®Œå–„æ—¥æœŸç­›é€‰é€»è¾‘

#### æ·»åŠ  dateFilter å‚æ•°æ”¯æŒ
```typescript
router.get('/orders', authenticateToken, async (req: Request, res: Response) => {
  try {
    const {
      page = 1,
      pageSize = 10,
      status,
      settlementStatus,
      companyId,
      startDate,
      endDate,
      dateFilter, // ğŸ”¥ æ·»åŠ å¿«æ·æ—¥æœŸç­›é€‰å‚æ•°
      keywords,
      tab
    } = req.query;

    // ... å…¶ä»–ä»£ç  ...

    // ğŸ”¥ æ—¥æœŸç­›é€‰ - æ”¯æŒå¿«æ·æ—¥æœŸå’Œè‡ªå®šä¹‰æ—¥æœŸ
    if (dateFilter && dateFilter !== 'all') {
      const now = new Date();
      let filterStartDate: Date;
      let filterEndDate: Date = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);

      switch (dateFilter) {
        case 'today':
          filterStartDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
          break;
        case 'thisMonth':
          filterStartDate = new Date(now.getFullYear(), now.getMonth(), 1);
          filterEndDate = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);
          break;
        case 'lastMonth':
          filterStartDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
          filterEndDate = new Date(now.getFullYear(), now.getMonth(), 0, 23, 59, 59);
          break;
        case 'thisQuarter':
          const thisQuarter = Math.floor(now.getMonth() / 3);
          filterStartDate = new Date(now.getFullYear(), thisQuarter * 3, 1);
          filterEndDate = new Date(now.getFullYear(), (thisQuarter + 1) * 3, 0, 23, 59, 59);
          break;
        case 'lastQuarter':
          const lastQuarter = Math.floor(now.getMonth() / 3) - 1;
          const lastQuarterYear = lastQuarter < 0 ? now.getFullYear() - 1 : now.getFullYear();
          const lastQuarterMonth = lastQuarter < 0 ? 3 : lastQuarter;
          filterStartDate = new Date(lastQuarterYear, lastQuarterMonth * 3, 1);
          filterEndDate = new Date(lastQuarterYear, (lastQuarterMonth + 1) * 3, 0, 23, 59, 59);
          break;
        case 'q1':
          filterStartDate = new Date(now.getFullYear(), 0, 1);
          filterEndDate = new Date(now.getFullYear(), 3, 0, 23, 59, 59);
          break;
        case 'q2':
          filterStartDate = new Date(now.getFullYear(), 3, 1);
          filterEndDate = new Date(now.getFullYear(), 6, 0, 23, 59, 59);
          break;
        case 'q3':
          filterStartDate = new Date(now.getFullYear(), 6, 1);
          filterEndDate = new Date(now.getFullYear(), 9, 0, 23, 59, 59);
          break;
        case 'q4':
          filterStartDate = new Date(now.getFullYear(), 9, 1);
          filterEndDate = new Date(now.getFullYear(), 12, 0, 23, 59, 59);
          break;
        case 'thisYear':
          filterStartDate = new Date(now.getFullYear(), 0, 1);
          filterEndDate = new Date(now.getFullYear(), 12, 0, 23, 59, 59);
          break;
        default:
          filterStartDate = new Date(now.getFullYear(), now.getMonth(), 1);
      }

      queryBuilder.andWhere('order.created_at BETWEEN :startDate AND :endDate', {
        startDate: filterStartDate,
        endDate: filterEndDate
      });
    } else if (startDate && endDate) {
      // è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´
      queryBuilder.andWhere('order.created_at BETWEEN :startDate AND :endDate', {
        startDate: new Date(startDate as string),
        endDate: new Date(endDate as string + ' 23:59:59')
      });
    }
  }
});
```

## ç­›é€‰åŠŸèƒ½æ¸…å•

### 1. å¿«æ·æ—¥æœŸç­›é€‰
- âœ… ä»Šæ—¥
- âœ… æœ¬æœˆ
- âœ… ä¸Šæœˆ
- âœ… æœ¬å­£
- âœ… ä¸Šå­£
- âœ… Q1ï¼ˆç¬¬ä¸€å­£åº¦ï¼‰
- âœ… Q2ï¼ˆç¬¬äºŒå­£åº¦ï¼‰
- âœ… Q3ï¼ˆç¬¬ä¸‰å­£åº¦ï¼‰
- âœ… Q4ï¼ˆç¬¬å››å­£åº¦ï¼‰
- âœ… ä»Šå¹´
- âœ… å…¨éƒ¨

### 2. è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´
- âœ… æ”¯æŒé€‰æ‹©ä»»æ„å¼€å§‹å’Œç»“æŸæ—¥æœŸ
- âœ… ä¸å¿«æ·æ—¥æœŸäº’æ–¥ï¼ˆé€‰æ‹©ä¸€ä¸ªä¼šæ¸…ç©ºå¦ä¸€ä¸ªï¼‰
- âœ… æ”¯æŒæ¸…ç©º

### 3. å¤–åŒ…å…¬å¸ç­›é€‰
- âœ… æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çŠ¶æ€çš„å…¬å¸
- âœ… æ”¯æŒ"å…¨éƒ¨å…¬å¸"é€‰é¡¹
- âœ… åœç”¨çš„å…¬å¸ä¸æ˜¾ç¤ºåœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­

### 4. æœ‰æ•ˆçŠ¶æ€ç­›é€‰
- âœ… ä»çŠ¶æ€é…ç½®è¡¨åŠ¨æ€åŠ è½½
- âœ… æ”¯æŒè‡ªå®šä¹‰çŠ¶æ€

### 5. ç»“ç®—çŠ¶æ€ç­›é€‰
- âœ… ä»çŠ¶æ€é…ç½®è¡¨åŠ¨æ€åŠ è½½
- âœ… æ”¯æŒè‡ªå®šä¹‰çŠ¶æ€

### 6. æ‰¹é‡æœç´¢
- âœ… æ”¯æŒè®¢å•å·æœç´¢
- âœ… æ”¯æŒå®¢æˆ·å§“åæœç´¢
- âœ… æ”¯æŒå®¢æˆ·ç”µè¯æœç´¢
- âœ… æ”¯æŒç‰©æµå•å·æœç´¢
- âœ… æ”¯æŒä¸€æ¬¡è¾“å…¥å¤šä¸ªå…³é”®è¯ï¼ˆæ¢è¡Œæˆ–é€—å·åˆ†éš”ï¼‰

### 7. æ ‡ç­¾é¡µç­›é€‰
- âœ… å…¨éƒ¨
- âœ… å¾…å¤„ç†
- âœ… æœ‰æ•ˆ
- âœ… æ— æ•ˆ

## ç­›é€‰ä¼˜å…ˆçº§

1. **æ ‡ç­¾é¡µç­›é€‰**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
   - æ ‡ç­¾é¡µç­›é€‰ä¼šè¦†ç›–æœ‰æ•ˆçŠ¶æ€ç­›é€‰
   - ä¾‹å¦‚ï¼šé€‰æ‹©"æœ‰æ•ˆ"æ ‡ç­¾é¡µæ—¶ï¼Œæœ‰æ•ˆçŠ¶æ€ç­›é€‰å™¨å¤±æ•ˆ

2. **æ—¥æœŸç­›é€‰**
   - è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´ä¼˜å…ˆäºå¿«æ·æ—¥æœŸ
   - é€‰æ‹©è‡ªå®šä¹‰æ—¥æœŸä¼šæ¸…ç©ºå¿«æ·æ—¥æœŸ
   - é€‰æ‹©å¿«æ·æ—¥æœŸä¼šæ¸…ç©ºè‡ªå®šä¹‰æ—¥æœŸ

3. **å…¶ä»–ç­›é€‰**
   - å¤–åŒ…å…¬å¸ã€ç»“ç®—çŠ¶æ€ã€æ‰¹é‡æœç´¢å¯ä»¥åŒæ—¶ç”Ÿæ•ˆ
   - å¤šä¸ªç­›é€‰æ¡ä»¶ä¹‹é—´æ˜¯"AND"å…³ç³»

## æ•°æ®æµç¨‹

### å‰ç«¯ â†’ åç«¯
```
ç”¨æˆ·æ“ä½œ â†’ æ›´æ–°ç­›é€‰æ¡ä»¶ â†’ è°ƒç”¨ loadData() â†’ æ„å»ºè¯·æ±‚å‚æ•° â†’ å‘é€APIè¯·æ±‚
```

### åç«¯å¤„ç†
```
æ¥æ”¶è¯·æ±‚å‚æ•° â†’ æ„å»ºSQLæŸ¥è¯¢ â†’ åº”ç”¨ç­›é€‰æ¡ä»¶ â†’ æ‰§è¡ŒæŸ¥è¯¢ â†’ è¿”å›ç»“æœ
```

### åç«¯ â†’ å‰ç«¯
```
è¿”å›æ•°æ® â†’ æ›´æ–°è¡¨æ ¼æ•°æ® â†’ æ›´æ–°åˆ†é¡µä¿¡æ¯ â†’ æ¸²æŸ“ç•Œé¢
```

## æµ‹è¯•è¦ç‚¹

### 1. å¿«æ·æ—¥æœŸç­›é€‰æµ‹è¯•
- [ ] ç‚¹å‡»"ä»Šæ—¥"ï¼ŒéªŒè¯åªæ˜¾ç¤ºä»Šå¤©çš„è®¢å•
- [ ] ç‚¹å‡»"æœ¬æœˆ"ï¼ŒéªŒè¯æ˜¾ç¤ºæœ¬æœˆçš„è®¢å•
- [ ] ç‚¹å‡»"ä¸Šæœˆ"ï¼ŒéªŒè¯æ˜¾ç¤ºä¸Šæœˆçš„è®¢å•
- [ ] ç‚¹å‡»"Q1"ï¼ŒéªŒè¯æ˜¾ç¤ºç¬¬ä¸€å­£åº¦çš„è®¢å•
- [ ] ç‚¹å‡»"ä»Šå¹´"ï¼ŒéªŒè¯æ˜¾ç¤ºä»Šå¹´çš„è®¢å•
- [ ] ç‚¹å‡»"å…¨éƒ¨"ï¼ŒéªŒè¯æ˜¾ç¤ºæ‰€æœ‰è®¢å•

### 2. è‡ªå®šä¹‰æ—¥æœŸæµ‹è¯•
- [ ] é€‰æ‹©æ—¥æœŸèŒƒå›´ï¼ŒéªŒè¯åªæ˜¾ç¤ºè¯¥èŒƒå›´å†…çš„è®¢å•
- [ ] é€‰æ‹©è‡ªå®šä¹‰æ—¥æœŸåï¼Œå¿«æ·æ—¥æœŸæŒ‰é’®åº”è¯¥å–æ¶ˆé«˜äº®
- [ ] æ¸…ç©ºè‡ªå®šä¹‰æ—¥æœŸï¼ŒéªŒè¯æ¢å¤åˆ°å¿«æ·æ—¥æœŸç­›é€‰

### 3. å…¬å¸ç­›é€‰æµ‹è¯•
- [ ] é€‰æ‹©å…¬å¸ï¼ŒéªŒè¯åªæ˜¾ç¤ºè¯¥å…¬å¸çš„è®¢å•
- [ ] åœç”¨å…¬å¸åï¼ŒéªŒè¯è¯¥å…¬å¸ä¸å†å‡ºç°åœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­
- [ ] é€‰æ‹©"å…¨éƒ¨å…¬å¸"ï¼ŒéªŒè¯æ˜¾ç¤ºæ‰€æœ‰å…¬å¸çš„è®¢å•

### 4. çŠ¶æ€ç­›é€‰æµ‹è¯•
- [ ] é€‰æ‹©æœ‰æ•ˆçŠ¶æ€ï¼ŒéªŒè¯åªæ˜¾ç¤ºè¯¥çŠ¶æ€çš„è®¢å•
- [ ] é€‰æ‹©ç»“ç®—çŠ¶æ€ï¼ŒéªŒè¯åªæ˜¾ç¤ºè¯¥çŠ¶æ€çš„è®¢å•
- [ ] åŒæ—¶é€‰æ‹©å¤šä¸ªç­›é€‰æ¡ä»¶ï¼ŒéªŒè¯ç»“æœæ­£ç¡®

### 5. æ‰¹é‡æœç´¢æµ‹è¯•
- [ ] è¾“å…¥å•ä¸ªè®¢å•å·ï¼ŒéªŒè¯èƒ½æ‰¾åˆ°å¯¹åº”è®¢å•
- [ ] è¾“å…¥å¤šä¸ªå…³é”®è¯ï¼ˆæ¢è¡Œåˆ†éš”ï¼‰ï¼ŒéªŒè¯èƒ½æ‰¾åˆ°æ‰€æœ‰åŒ¹é…è®¢å•
- [ ] è¾“å…¥å®¢æˆ·å§“åï¼ŒéªŒè¯èƒ½æ‰¾åˆ°å¯¹åº”è®¢å•
- [ ] è¾“å…¥å®¢æˆ·ç”µè¯ï¼ŒéªŒè¯èƒ½æ‰¾åˆ°å¯¹åº”è®¢å•
- [ ] è¾“å…¥ç‰©æµå•å·ï¼ŒéªŒè¯èƒ½æ‰¾åˆ°å¯¹åº”è®¢å•

### 6. æ ‡ç­¾é¡µç­›é€‰æµ‹è¯•
- [ ] ç‚¹å‡»"å¾…å¤„ç†"æ ‡ç­¾ï¼ŒéªŒè¯åªæ˜¾ç¤ºå¾…å¤„ç†è®¢å•
- [ ] ç‚¹å‡»"æœ‰æ•ˆ"æ ‡ç­¾ï¼ŒéªŒè¯åªæ˜¾ç¤ºæœ‰æ•ˆè®¢å•
- [ ] ç‚¹å‡»"æ— æ•ˆ"æ ‡ç­¾ï¼ŒéªŒè¯åªæ˜¾ç¤ºæ— æ•ˆè®¢å•
- [ ] æ ‡ç­¾é¡µå¾½ç« æ•°å­—ä¸å®é™…è®¢å•æ•°ä¸€è‡´

### 7. ç»„åˆç­›é€‰æµ‹è¯•
- [ ] åŒæ—¶ä½¿ç”¨æ—¥æœŸ+å…¬å¸ç­›é€‰ï¼ŒéªŒè¯ç»“æœæ­£ç¡®
- [ ] åŒæ—¶ä½¿ç”¨æ—¥æœŸ+çŠ¶æ€ç­›é€‰ï¼ŒéªŒè¯ç»“æœæ­£ç¡®
- [ ] åŒæ—¶ä½¿ç”¨å¤šä¸ªç­›é€‰æ¡ä»¶ï¼ŒéªŒè¯ç»“æœæ­£ç¡®

### 8. é‡ç½®åŠŸèƒ½æµ‹è¯•
- [ ] ç‚¹å‡»"é‡ç½®"æŒ‰é’®ï¼ŒéªŒè¯æ‰€æœ‰ç­›é€‰æ¡ä»¶æ¸…ç©º
- [ ] é‡ç½®åæ¢å¤åˆ°é»˜è®¤çŠ¶æ€ï¼ˆæœ¬æœˆï¼‰

### 9. ç»Ÿè®¡æ•°æ®æµ‹è¯•
- [ ] åˆ‡æ¢ç­›é€‰æ¡ä»¶ï¼ŒéªŒè¯ç»Ÿè®¡å¡ç‰‡æ•°æ®åŒæ­¥æ›´æ–°
- [ ] ç»Ÿè®¡æ•°æ®ä¸åˆ—è¡¨æ•°æ®ä¸€è‡´

## æ³¨æ„äº‹é¡¹

1. **æ—¥æœŸæ—¶åŒºé—®é¢˜**
   - åç«¯ä½¿ç”¨æœåŠ¡å™¨æ—¶åŒº
   - å‰ç«¯ä½¿ç”¨ç”¨æˆ·æœ¬åœ°æ—¶åŒº
   - æ—¥æœŸèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œç»“æŸæ—¥æœŸè‡ªåŠ¨åŠ ä¸Š `23:59:59`

2. **æ€§èƒ½ä¼˜åŒ–**
   - æ‰¹é‡æœç´¢æ”¯æŒå¤šä¸ªå…³é”®è¯ï¼Œä½†ä¸è¦è¾“å…¥è¿‡å¤šï¼ˆå»ºè®®ä¸è¶…è¿‡100ä¸ªï¼‰
   - å¤§æ•°æ®é‡æ—¶ä½¿ç”¨åˆ†é¡µï¼Œé¿å…ä¸€æ¬¡åŠ è½½è¿‡å¤šæ•°æ®

3. **ç”¨æˆ·ä½“éªŒ**
   - ç­›é€‰æ¡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨åˆ·æ–°æ•°æ®
   - æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼Œé¿å…ç”¨æˆ·é‡å¤ç‚¹å‡»
   - ç­›é€‰å¤±è´¥æ—¶æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º

4. **æ•°æ®ä¸€è‡´æ€§**
   - ç­›é€‰æ¡ä»¶åŒæ—¶åº”ç”¨äºè®¢å•åˆ—è¡¨å’Œç»Ÿè®¡æ•°æ®
   - ç¡®ä¿ç»Ÿè®¡æ•°æ®ä¸åˆ—è¡¨æ•°æ®ä¸€è‡´

## ç›¸å…³æ–‡ä»¶

- `src/views/Finance/ValueAddedManage.vue` - å‰ç«¯ä¸»è§†å›¾
- `backend/src/routes/valueAdded.ts` - åç«¯è·¯ç”±
- `src/api/valueAdded.ts` - APIæ¥å£å®šä¹‰

## åç»­ä¼˜åŒ–å»ºè®®

1. æ·»åŠ ç­›é€‰æ¡ä»¶çš„ä¿å­˜åŠŸèƒ½ï¼Œè®°ä½ç”¨æˆ·çš„ç­›é€‰åå¥½
2. æ·»åŠ å¿«æ·ç­›é€‰ç»„åˆï¼ˆä¾‹å¦‚ï¼š"æœ¬æœˆæœªç»“ç®—"ï¼‰
3. æ·»åŠ å¯¼å‡ºåŠŸèƒ½ï¼Œæ”¯æŒå¯¼å‡ºç­›é€‰åçš„æ•°æ®
4. æ·»åŠ ç­›é€‰å†å²è®°å½•ï¼Œæ–¹ä¾¿å¿«é€Ÿåˆ‡æ¢
5. ä¼˜åŒ–å¤§æ•°æ®é‡ä¸‹çš„ç­›é€‰æ€§èƒ½
