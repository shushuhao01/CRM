# å‘è´§åˆ—è¡¨å’ŒçŠ¶æ€æ›´æ–°æ—¥æœŸç­›é€‰ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

åœ¨ç‰©æµç®¡ç†æ¨¡å—çš„ä»¥ä¸‹é¡µé¢ä¸­,æ—¥æœŸç­›é€‰ä½¿ç”¨äº†é”™è¯¯çš„æ—¶é—´å­—æ®µ:

1. **å‘è´§åˆ—è¡¨ - å·²å‘è´§æ ‡ç­¾é¡µ**: ç‚¹å‡»"ä¸Šæœˆè®¢å•"ç­‰å¿«æ·ç­›é€‰æŒ‰é’®æ—¶,æ˜¾ç¤ºçš„æ˜¯ä¸Šæœˆ**å‘è´§**çš„è®¢å•,è€Œä¸æ˜¯ä¸Šæœˆ**ä¸‹å•**çš„è®¢å•
2. **çŠ¶æ€æ›´æ–°é¡µé¢**: åŒæ ·å­˜åœ¨æ—¥æœŸç­›é€‰ä½¿ç”¨å‘è´§æ—¶é—´çš„é—®é¢˜

### é—®é¢˜ç°è±¡
- ç‚¹å‡»"ä¸Šæœˆè®¢å•"å¿«æ·æŒ‰é’®
- æ˜¾ç¤ºçš„è®¢å•ä¸‹å•æ—¶é—´åŒ…å«ä¸Šä¸Šä¸ªæœˆçš„æ•°æ®
- è¯´æ˜å½“å‰ç­›é€‰ä½¿ç”¨çš„æ˜¯å‘è´§æ—¶é—´è€Œéä¸‹å•æ—¶é—´

## é—®é¢˜åŸå› 

åç«¯å·²å‘è´§è®¢å•æ¥å£ `/api/v1/orders/shipping/shipped` çš„å¿«é€Ÿç­›é€‰é€»è¾‘å­˜åœ¨ä»¥ä¸‹é—®é¢˜:

1. **ä½¿ç”¨äº†é”™è¯¯çš„æ—¶é—´å­—æ®µ**: æ‰€æœ‰å¿«é€Ÿç­›é€‰éƒ½ä½¿ç”¨ `order.shippedAt`(å‘è´§æ—¶é—´)è€Œé `order.createdAt`(ä¸‹å•æ—¶é—´)
2. **ç¼ºå°‘å¿«æ·ç­›é€‰é€‰é¡¹**: æ²¡æœ‰å®ç° `lastMonth`(ä¸Šæœˆè®¢å•)å’Œ `thisYear`(ä»Šå¹´è®¢å•)çš„case

## ä¿®å¤å†…å®¹

### 1. å·²å‘è´§è®¢å•æ¥å£ (`/api/v1/orders/shipping/shipped`)

**ä¿®æ”¹å‰:**
```typescript
// ä½¿ç”¨å‘è´§æ—¶é—´ç­›é€‰
case 'today':
  queryBuilder.andWhere('DATE(order.shippedAt) = :today', { today });
  break;
// åªæœ‰4ä¸ªcase: today, yesterday, thisWeek, thisMonth
```

**ä¿®æ”¹å:**
```typescript
// ä½¿ç”¨ä¸‹å•æ—¶é—´ç­›é€‰
case 'today':
  queryBuilder.andWhere('DATE(order.createdAt) = :today', { today });
  break;
// æ–°å¢lastMonthå’ŒthisYear case
case 'lastMonth':
  const lastMonthStart = new Date(now.getFullYear(), now.getMonth() - 1, 1);
  const lastMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0, 23, 59, 59);
  queryBuilder.andWhere('order.createdAt >= :lastMonthStart AND order.createdAt <= :lastMonthEnd', {
    lastMonthStart: lastMonthStart.toISOString().split('T')[0] + ' 00:00:00',
    lastMonthEnd: lastMonthEnd.toISOString().split('T')[0] + ' 23:59:59'
  });
  break;
```

**æ—¥æœŸèŒƒå›´ç­›é€‰:**
```typescript
// ğŸ”¥ æ—¥æœŸèŒƒå›´ç­›é€‰ - æŒ‰ä¸‹å•æ—¶é—´ç­›é€‰
if (startDate) {
  queryBuilder.andWhere('order.createdAt >= :startDate', { startDate: `${startDate} 00:00:00` });
}
if (endDate) {
  queryBuilder.andWhere('order.createdAt <= :endDate', { endDate: `${endDate} 23:59:59` });
}
```

### 2. å¾…å‘è´§è®¢å•æ¥å£ (`/api/v1/orders/shipping/pending`)

- è¡¥å……äº† `lastMonth` å’Œ `thisYear` å¿«æ·ç­›é€‰é€‰é¡¹
- åŸæœ¬å·²ä½¿ç”¨ `order.createdAt`,æ— éœ€ä¿®æ”¹æ—¶é—´å­—æ®µ

### 3. é€€å›è®¢å•æ¥å£ (`/api/v1/orders/shipping/returned`)

- æ–°å¢å®Œæ•´çš„å¿«é€Ÿç­›é€‰æ”¯æŒ(åŒ…æ‹¬ lastMonth å’Œ thisYear)
- æ–°å¢ `keyword` ç»¼åˆæœç´¢æ”¯æŒ

### 4. å–æ¶ˆè®¢å•æ¥å£ (`/api/v1/orders/shipping/cancelled`)

- æ–°å¢å®Œæ•´çš„å¿«é€Ÿç­›é€‰æ”¯æŒ(åŒ…æ‹¬ lastMonth å’Œ thisYear)
- æ–°å¢ `keyword` ç»¼åˆæœç´¢æ”¯æŒ

### 5. è‰ç¨¿è®¢å•æ¥å£ (`/api/v1/orders/shipping/draft`)

- æ–°å¢å®Œæ•´çš„å¿«é€Ÿç­›é€‰æ”¯æŒ(åŒ…æ‹¬ lastMonth å’Œ thisYear)
- æ–°å¢ `keyword` ç»¼åˆæœç´¢æ”¯æŒ
- æ–°å¢æ—¥æœŸèŒƒå›´ç­›é€‰æ”¯æŒ

## å½±å“é¡µé¢

### 1. å‘è´§åˆ—è¡¨ (`src/views/Logistics/Shipping.vue`)
- å¾…å‘è´§æ ‡ç­¾é¡µ
- å·²å‘è´§æ ‡ç­¾é¡µ
- é€€å›æ ‡ç­¾é¡µ
- å–æ¶ˆæ ‡ç­¾é¡µ
- è‰ç¨¿æ ‡ç­¾é¡µ

### 2. çŠ¶æ€æ›´æ–° (`src/views/Logistics/StatusUpdate.vue`)
- å¾…æ›´æ–°æ ‡ç­¾é¡µ(è°ƒç”¨å·²å‘è´§è®¢å•æ¥å£)
- å·²æ›´æ–°æ ‡ç­¾é¡µ(è°ƒç”¨å·²å‘è´§è®¢å•æ¥å£)
- å¾…åŠæ ‡ç­¾é¡µ(è°ƒç”¨å·²å‘è´§è®¢å•æ¥å£)

## å¿«é€Ÿç­›é€‰é€‰é¡¹è¯´æ˜

æ‰€æœ‰å‘è´§åˆ—è¡¨å’ŒçŠ¶æ€æ›´æ–°æ¥å£ç°åœ¨æ”¯æŒä»¥ä¸‹å¿«é€Ÿç­›é€‰é€‰é¡¹(å‡åŸºäº**ä¸‹å•æ—¶é—´**):

| é€‰é¡¹å€¼ | è¯´æ˜ | æ—¶é—´èŒƒå›´ |
|--------|------|----------|
| `today` | ä»Šæ—¥è®¢å• | ä»Šå¤©00:00:00 - 23:59:59 |
| `yesterday` | æ˜¨æ—¥è®¢å• | æ˜¨å¤©00:00:00 - 23:59:59 |
| `thisWeek` | æœ¬å‘¨è®¢å• | æœ¬å‘¨ä¸€00:00:00 - ç°åœ¨ |
| `thisMonth` | æœ¬æœˆè®¢å• | æœ¬æœˆ1å·00:00:00 - ç°åœ¨ |
| `lastMonth` | ä¸Šæœˆè®¢å• | ä¸Šæœˆ1å·00:00:00 - ä¸Šæœˆæœ€åä¸€å¤©23:59:59 |
| `thisYear` | ä»Šå¹´è®¢å• | ä»Šå¹´1æœˆ1å·00:00:00 - ç°åœ¨ |
| `urgent` | ç´§æ€¥è®¢å• | (ä»…å¾…å‘è´§) |
| `timeout` | è¶…æ—¶è®¢å• | (ä»…å¾…å‘è´§)å¾…å‘è´§è¶…è¿‡24å°æ—¶ |

## æµ‹è¯•å»ºè®®

### 1. å‘è´§åˆ—è¡¨ - å·²å‘è´§è®¢å•æµ‹è¯•
```
1. è¿›å…¥å‘è´§åˆ—è¡¨ -> å·²å‘è´§æ ‡ç­¾é¡µ
2. ç‚¹å‡»"ä¸Šæœˆè®¢å•"å¿«æ·æŒ‰é’®
3. éªŒè¯æ˜¾ç¤ºçš„è®¢å•ä¸‹å•æ—¶é—´éƒ½åœ¨ä¸Šä¸ªæœˆèŒƒå›´å†…
4. æ£€æŸ¥è®¢å•çš„"ä¸‹å•æ—¶é—´"åˆ—,ç¡®è®¤éƒ½æ˜¯ä¸Šæœˆçš„æ—¥æœŸ
```

### 2. çŠ¶æ€æ›´æ–°é¡µé¢æµ‹è¯•
```
1. è¿›å…¥ç‰©æµç®¡ç† -> çŠ¶æ€æ›´æ–°
2. ç‚¹å‡»"ä¸Šæœˆ"å¿«æ·æŒ‰é’®
3. éªŒè¯æ˜¾ç¤ºçš„è®¢å•ä¸‹å•æ—¶é—´éƒ½åœ¨ä¸Šä¸ªæœˆèŒƒå›´å†…
4. æ£€æŸ¥"ä¸‹å•æ—¥æœŸ"åˆ—,ç¡®è®¤éƒ½æ˜¯ä¸Šæœˆçš„æ—¥æœŸ
```

### 3. è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´æµ‹è¯•
```
1. åœ¨å‘è´§åˆ—è¡¨æˆ–çŠ¶æ€æ›´æ–°é¡µé¢
2. ä½¿ç”¨æ—¥æœŸé€‰æ‹©å™¨é€‰æ‹©ç‰¹å®šæ—¥æœŸèŒƒå›´
3. éªŒè¯ç­›é€‰ç»“æœç¬¦åˆé¢„æœŸ(æŒ‰ä¸‹å•æ—¶é—´)
```

### 4. å…¶ä»–æ ‡ç­¾é¡µæµ‹è¯•
```
1. æµ‹è¯•å¾…å‘è´§ã€é€€å›ã€å–æ¶ˆã€è‰ç¨¿æ ‡ç­¾é¡µçš„å¿«é€Ÿç­›é€‰
2. éªŒè¯æ–°å¢çš„ç»¼åˆæœç´¢åŠŸèƒ½
3. æµ‹è¯•æ—¥æœŸèŒƒå›´ç­›é€‰
```

## å½±å“èŒƒå›´

- åç«¯æ–‡ä»¶: `backend/src/routes/orders.ts`
- å½±å“æ¥å£:
  - `/api/v1/orders/shipping/pending` (å¾…å‘è´§)
  - `/api/v1/orders/shipping/shipped` (å·²å‘è´§)
  - `/api/v1/orders/shipping/returned` (é€€å›)
  - `/api/v1/orders/shipping/cancelled` (å–æ¶ˆ)
  - `/api/v1/orders/shipping/draft` (è‰ç¨¿)
- å½±å“é¡µé¢:
  - `src/views/Logistics/Shipping.vue` (å‘è´§åˆ—è¡¨)
  - `src/views/Logistics/StatusUpdate.vue` (çŠ¶æ€æ›´æ–°)

## æ³¨æ„äº‹é¡¹

1. **æ—¶é—´å­—æ®µç»Ÿä¸€**: æ‰€æœ‰å¿«é€Ÿç­›é€‰å’Œæ—¥æœŸèŒƒå›´ç­›é€‰ç°åœ¨ç»Ÿä¸€ä½¿ç”¨ `order.createdAt`(ä¸‹å•æ—¶é—´)
2. **å‘åå…¼å®¹**: ä¿®æ”¹ä¸å½±å“ç°æœ‰çš„å…¶ä»–ç­›é€‰åŠŸèƒ½
3. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨æ•°æ®åº“ç´¢å¼•,æŸ¥è¯¢æ€§èƒ½ä¸å—å½±å“
4. **å‰ç«¯æ— éœ€ä¿®æ”¹**: å‰ç«¯ä»£ç å·²æ­£ç¡®ä¼ é€’å‚æ•°,æ— éœ€ä¿®æ”¹

## ä¿®å¤æ—¶é—´

2026-02-24

## ä¿®å¤äººå‘˜

Kiro AI Assistant
