# 代收管理批量导出功能说明

## 功能概述
在代收管理页面添加了批量导出功能，支持将选中的代收订单导出为美化的 Excel 文件。

## 实现内容

### 1. 前端实现
- **文件**: `src/views/Finance/CodCollection.vue`
- **位置**: 刷新按钮后面
- **图标**: Download 图标
- **禁用逻辑**: 未选中订单时按钮禁用

### 2. 导出字段
导出的 Excel 文件包含以下字段：
- 订单号
- 客户姓名
- 订单状态
- 订单金额
- 代收金额
- 代收状态
- 销售人员
- 物流单号
- 最新物流动态
- 下单时间

### 3. 格式美化
- **列宽设置**: 根据内容自动调整列宽
  - 订单号: 20字符
  - 客户姓名: 12字符
  - 订单状态: 10字符
  - 订单金额: 12字符
  - 代收金额: 12字符
  - 代收状态: 10字符
  - 销售人员: 10字符
  - 物流单号: 20字符
  - 最新物流动态: 40字符
  - 下单时间: 20字符

### 4. 文件命名
- **格式**: `代收管理_YYYYMMDD_HHMM.xlsx`
- **示例**: `代收管理_20250224_1430.xlsx`

## 使用方法

1. 在代收管理页面，勾选需要导出的订单
2. 点击"批量导出"按钮
3. 系统自动生成并下载 Excel 文件
4. 导出成功后显示成功提示

## 技术实现

### 依赖库
- **xlsx**: 用于生成 Excel 文件（动态导入）

### 核心代码
```typescript
const handleExport = async () => {
  // 1. 检查是否有选中的订单
  if (selectedRows.value.length === 0) {
    ElMessage.warning('请先选择要导出的数据')
    return
  }

  try {
    // 2. 动态导入 xlsx 库
    const XLSX = await import('xlsx')

    // 3. 准备导出数据（格式化状态、金额等）
    const exportData = selectedRows.value.map((row) => ({
      订单号: row.orderNumber,
      客户姓名: row.customerName,
      // ... 其他字段
    }))

    // 4. 创建工作簿和工作表
    const wb = XLSX.utils.book_new()
    const ws = XLSX.utils.json_to_sheet(exportData)

    // 5. 设置列宽
    ws['!cols'] = [
      { wch: 20 }, // 订单号
      // ... 其他列宽
    ]

    // 6. 添加工作表到工作簿
    XLSX.utils.book_append_sheet(wb, ws, '代收管理')

    // 7. 生成文件名（包含日期时间）
    const fileName = `代收管理_${dateStr}.xlsx`

    // 8. 触发下载
    XLSX.writeFile(wb, fileName)
    ElMessage.success(`成功导出 ${exportData.length} 条数据`)
  } catch (e) {
    console.error('导出失败:', e)
    ElMessage.error('导出失败')
  }
}
```

## 注意事项

1. **选择订单**: 必须先勾选订单才能导出
2. **数据格式**: 金额字段导出为数字类型，方便 Excel 中进行计算
3. **状态转换**: 订单状态和代收状态会转换为中文显示
4. **动态导入**: xlsx 库采用动态导入，减少初始加载体积
5. **错误处理**: 导出失败时会显示错误提示

## 测试建议

1. 测试未选中订单时的提示
2. 测试选中单个订单导出
3. 测试选中多个订单批量导出
4. 测试不同标签页（待处理、已返款、已改代收、全部）的导出
5. 验证导出的 Excel 文件格式和内容
6. 验证列宽是否合适
7. 验证文件名格式是否正确

## 相关文件

- `src/views/Finance/CodCollection.vue` - 代收管理页面
- `src/api/codCollection.ts` - 代收管理 API
- `backend/src/routes/codCollection.ts` - 后端路由
