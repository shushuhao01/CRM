<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®èŒƒå›´æ§åˆ¶UIæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fafafa;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        .user-info {
            background-color: #fff3e0;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid #ff9800;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .data-table th,
        .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .data-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .access-yes {
            color: #4caf50;
            font-weight: bold;
        }
        .access-no {
            color: #f44336;
            font-weight: bold;
        }
        .test-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
        }
        .test-pass {
            background-color: #e8f5e8;
            border-left: 4px solid #4caf50;
        }
        .test-fail {
            background-color: #ffeaea;
            border-left: 4px solid #f44336;
        }
        .button-group {
            text-align: center;
            margin: 20px 0;
        }
        .test-button {
            background-color: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-button:hover {
            background-color: #1976d2;
        }
        .summary {
            background-color: #e8f5e8;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            border-left: 4px solid #4caf50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”’ æ•°æ®èŒƒå›´æ§åˆ¶UIæµ‹è¯•</h1>
            <p>éªŒè¯ä¸åŒè§’è‰²ç”¨æˆ·åœ¨è®¢å•åˆ—è¡¨é¡µé¢çœ‹åˆ°çš„æ•°æ®æ˜¯å¦ç¬¦åˆæƒé™è®¾ç½®</p>
        </div>

        <div class="button-group">
            <button class="test-button" onclick="testAllRoles()">å¼€å§‹å…¨é¢æµ‹è¯•</button>
            <button class="test-button" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
            <button class="test-button" onclick="openCRMSystem()">æ‰“å¼€CRMç³»ç»Ÿ</button>
        </div>

        <div id="test-results"></div>

        <div class="summary" id="test-summary" style="display: none;">
            <h3>ğŸ“Š æµ‹è¯•æ€»ç»“</h3>
            <div id="summary-content"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
        const mockUsers = [
            {
                id: 'admin_001',
                name: 'å¼ ä¸‰ï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰',
                role: 'admin',
                roleText: 'è¶…çº§ç®¡ç†å‘˜',
                dataScope: 'all',
                departmentId: null,
                expectedAccess: {
                    allOrders: true,
                    ownOrders: true,
                    departmentOrders: true,
                    otherDepartmentOrders: true
                }
            },
            {
                id: 'manager_001',
                name: 'æå››ï¼ˆéƒ¨é—¨è´Ÿè´£äººï¼‰',
                role: 'department_manager',
                roleText: 'éƒ¨é—¨è´Ÿè´£äºº',
                dataScope: 'department',
                departmentId: 'dept_sales',
                expectedAccess: {
                    allOrders: false,
                    ownOrders: true,
                    departmentOrders: true,
                    otherDepartmentOrders: false
                }
            },
            {
                id: 'sales_001',
                name: 'ç‹äº”ï¼ˆé”€å”®å‘˜ï¼‰',
                role: 'sales_staff',
                roleText: 'é”€å”®å‘˜',
                dataScope: 'self',
                departmentId: 'dept_sales',
                expectedAccess: {
                    allOrders: false,
                    ownOrders: true,
                    departmentOrders: false,
                    otherDepartmentOrders: false
                }
            },
            {
                id: 'cs_001',
                name: 'èµµå…­ï¼ˆå®¢æœï¼‰',
                role: 'customer_service',
                roleText: 'å®¢æœ',
                dataScope: 'custom',
                departmentId: 'dept_service',
                customerServiceType: 'after_sales',
                expectedAccess: {
                    allOrders: false,
                    ownOrders: true,
                    departmentOrders: false,
                    otherDepartmentOrders: true, // å”®åå®¢æœå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å”®åç›¸å…³è®¢å•
                    afterSalesOrders: true
                }
            }
        ];

        // æ¨¡æ‹Ÿè®¢å•æ•°æ®
        const mockOrders = [
            {
                id: 'order_001',
                orderNumber: 'ORD20241201001',
                customerName: 'å®¢æˆ·A',
                ownerId: 'admin_001',
                departmentId: 'dept_sales',
                type: 'normal',
                status: 'pending_shipment'
            },
            {
                id: 'order_002',
                orderNumber: 'ORD20241201002',
                customerName: 'å®¢æˆ·B',
                ownerId: 'sales_001',
                departmentId: 'dept_sales',
                type: 'normal',
                status: 'delivered'
            },
            {
                id: 'order_003',
                orderNumber: 'ORD20241201003',
                customerName: 'å®¢æˆ·C',
                ownerId: 'sales_002',
                departmentId: 'dept_marketing',
                type: 'after_sales',
                status: 'after_sales_created'
            },
            {
                id: 'order_004',
                orderNumber: 'ORD20241201004',
                customerName: 'å®¢æˆ·D',
                ownerId: 'manager_001',
                departmentId: 'dept_sales',
                type: 'normal',
                status: 'shipped'
            }
        ];

        // æ•°æ®è®¿é—®æƒé™æ£€æŸ¥å‡½æ•°
        function checkDataAccess(userId, dataOwnerId, dataDepartmentId, dataType = 'normal') {
            const user = mockUsers.find(u => u.id === userId);
            if (!user) return false;

            // è¶…çº§ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰æ•°æ®
            if (user.dataScope === 'all') {
                return true;
            }

            // ç”¨æˆ·å¯ä»¥è®¿é—®è‡ªå·±åˆ›å»ºçš„æ•°æ®
            if (dataOwnerId === userId) {
                return true;
            }

            // éƒ¨é—¨è´Ÿè´£äººå¯ä»¥è®¿é—®éƒ¨é—¨å†…çš„æ•°æ®
            if (user.dataScope === 'department') {
                return dataDepartmentId === user.departmentId;
            }

            // é”€å”®å‘˜åªèƒ½è®¿é—®è‡ªå·±åˆ›å»ºçš„æ•°æ®
            if (user.dataScope === 'self') {
                return dataOwnerId === userId;
            }

            // å®¢æœæ ¹æ®ç±»å‹åˆ¤æ–­
            if (user.dataScope === 'custom' && user.customerServiceType === 'after_sales') {
                // å”®åå®¢æœå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å”®åç›¸å…³è®¢å•
                return dataType === 'after_sales' || dataOwnerId === userId;
            }

            return false;
        }

        // æµ‹è¯•å•ä¸ªç”¨æˆ·çš„æ•°æ®è®¿é—®æƒé™
        function testUserDataAccess(user) {
            const results = [];
            
            mockOrders.forEach(order => {
                const hasAccess = checkDataAccess(user.id, order.ownerId, order.departmentId, order.type);
                results.push({
                    order: order,
                    hasAccess: hasAccess,
                    expected: shouldHaveAccess(user, order)
                });
            });

            return results;
        }

        // åˆ¤æ–­ç”¨æˆ·æ˜¯å¦åº”è¯¥æœ‰è®¿é—®æƒé™ï¼ˆæœŸæœ›ç»“æœï¼‰
        function shouldHaveAccess(user, order) {
            if (user.dataScope === 'all') return true;
            if (order.ownerId === user.id) return true;
            if (user.dataScope === 'department' && order.departmentId === user.departmentId) return true;
            if (user.dataScope === 'self') return order.ownerId === user.id;
            if (user.dataScope === 'custom' && user.customerServiceType === 'after_sales') {
                return order.type === 'after_sales' || order.ownerId === user.id;
            }
            return false;
        }

        // æµ‹è¯•æ‰€æœ‰è§’è‰²
        function testAllRoles() {
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.innerHTML = '';

            let totalTests = 0;
            let passedTests = 0;

            mockUsers.forEach(user => {
                const testResults = testUserDataAccess(user);
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'test-section';

                let sectionHTML = `
                    <div class="test-title">ğŸ§ª ${user.roleText}æƒé™æµ‹è¯•</div>
                    <div class="user-info">
                        <strong>ç”¨æˆ·ä¿¡æ¯ï¼š</strong>${user.name} | 
                        <strong>è§’è‰²ï¼š</strong>${user.roleText} | 
                        <strong>æ•°æ®èŒƒå›´ï¼š</strong>${getDataScopeText(user.dataScope)} | 
                        <strong>éƒ¨é—¨ï¼š</strong>${user.departmentId || 'æ— '}
                        ${user.customerServiceType ? ` | <strong>å®¢æœç±»å‹ï¼š</strong>${getCustomerServiceTypeText(user.customerServiceType)}` : ''}
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è®¢å•å·</th>
                                <th>å®¢æˆ·åç§°</th>
                                <th>åˆ›å»ºè€…</th>
                                <th>æ‰€å±éƒ¨é—¨</th>
                                <th>è®¢å•ç±»å‹</th>
                                <th>å®é™…è®¿é—®æƒé™</th>
                                <th>æœŸæœ›è®¿é—®æƒé™</th>
                                <th>æµ‹è¯•ç»“æœ</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                let sectionPassed = 0;
                testResults.forEach(result => {
                    const isCorrect = result.hasAccess === result.expected;
                    totalTests++;
                    if (isCorrect) {
                        passedTests++;
                        sectionPassed++;
                    }

                    sectionHTML += `
                        <tr>
                            <td>${result.order.orderNumber}</td>
                            <td>${result.order.customerName}</td>
                            <td>${getUserName(result.order.ownerId)}</td>
                            <td>${result.order.departmentId}</td>
                            <td>${getOrderTypeText(result.order.type)}</td>
                            <td class="${result.hasAccess ? 'access-yes' : 'access-no'}">
                                ${result.hasAccess ? 'âœ“ å¯è®¿é—®' : 'âœ— ä¸å¯è®¿é—®'}
                            </td>
                            <td class="${result.expected ? 'access-yes' : 'access-no'}">
                                ${result.expected ? 'âœ“ åº”å¯è®¿é—®' : 'âœ— åº”ä¸å¯è®¿é—®'}
                            </td>
                            <td class="${isCorrect ? 'access-yes' : 'access-no'}">
                                ${isCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯'}
                            </td>
                        </tr>
                    `;
                });

                sectionHTML += `
                        </tbody>
                    </table>
                    <div class="test-result ${sectionPassed === testResults.length ? 'test-pass' : 'test-fail'}">
                        <strong>æµ‹è¯•ç»“æœï¼š</strong>
                        ${sectionPassed}/${testResults.length} ä¸ªæµ‹è¯•ç”¨ä¾‹é€šè¿‡
                        ${sectionPassed === testResults.length ? ' - âœ… å…¨éƒ¨é€šè¿‡' : ' - âŒ å­˜åœ¨é—®é¢˜'}
                    </div>
                `;

                sectionDiv.innerHTML = sectionHTML;
                resultsContainer.appendChild(sectionDiv);
            });

            // æ˜¾ç¤ºæ€»ç»“
            showTestSummary(totalTests, passedTests);
        }

        // æ˜¾ç¤ºæµ‹è¯•æ€»ç»“
        function showTestSummary(total, passed) {
            const summaryDiv = document.getElementById('test-summary');
            const summaryContent = document.getElementById('summary-content');
            
            const passRate = ((passed / total) * 100).toFixed(1);
            const isAllPassed = passed === total;

            summaryContent.innerHTML = `
                <p><strong>æ€»æµ‹è¯•ç”¨ä¾‹ï¼š</strong>${total} ä¸ª</p>
                <p><strong>é€šè¿‡æµ‹è¯•ï¼š</strong>${passed} ä¸ª</p>
                <p><strong>å¤±è´¥æµ‹è¯•ï¼š</strong>${total - passed} ä¸ª</p>
                <p><strong>é€šè¿‡ç‡ï¼š</strong>${passRate}%</p>
                <p class="${isAllPassed ? 'access-yes' : 'access-no'}">
                    <strong>æ•´ä½“ç»“æœï¼š</strong>${isAllPassed ? 'âœ… æ•°æ®èŒƒå›´æ§åˆ¶åŠŸèƒ½æ­£å¸¸' : 'âŒ æ•°æ®èŒƒå›´æ§åˆ¶å­˜åœ¨é—®é¢˜'}
                </p>
            `;

            summaryDiv.style.display = 'block';
            summaryDiv.className = isAllPassed ? 'summary test-pass' : 'summary test-fail';
        }

        // è¾…åŠ©å‡½æ•°
        function getDataScopeText(scope) {
            const scopeMap = {
                'all': 'å…¨éƒ¨æ•°æ®',
                'department': 'éƒ¨é—¨æ•°æ®',
                'self': 'ä¸ªäººæ•°æ®',
                'custom': 'è‡ªå®šä¹‰èŒƒå›´'
            };
            return scopeMap[scope] || scope;
        }

        function getCustomerServiceTypeText(type) {
            const typeMap = {
                'after_sales': 'å”®åå®¢æœ',
                'audit': 'å®¡æ ¸å®¢æœ',
                'logistics': 'ç‰©æµå®¢æœ',
                'product': 'å•†å“å®¢æœ',
                'general': 'é€šç”¨å®¢æœ'
            };
            return typeMap[type] || type;
        }

        function getOrderTypeText(type) {
            const typeMap = {
                'normal': 'æ™®é€šè®¢å•',
                'after_sales': 'å”®åè®¢å•',
                'refund': 'é€€æ¬¾è®¢å•',
                'return': 'é€€è´§è®¢å•'
            };
            return typeMap[type] || type;
        }

        function getUserName(userId) {
            const user = mockUsers.find(u => u.id === userId);
            return user ? user.name.split('ï¼ˆ')[0] : userId;
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('test-summary').style.display = 'none';
        }

        function openCRMSystem() {
            window.open('http://localhost:5173', '_blank');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            console.log('æ•°æ®èŒƒå›´æ§åˆ¶UIæµ‹è¯•é¡µé¢å·²åŠ è½½');
            // å¯ä»¥é€‰æ‹©è‡ªåŠ¨è¿è¡Œæµ‹è¯•
            // testAllRoles();
        };
    </script>
</body>
</html>