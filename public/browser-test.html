<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>浏览器环境测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            backdrop-filter: blur(10px);
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        .status {
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            margin: 5px;
        }
        .success { background: #4CAF50; }
        .error { background: #f44336; }
        .warning { background: #ff9800; }
        #apiTest { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>🔍 浏览器环境对比测试</h1>
    
    <div class="test-card">
        <h2>📊 浏览器信息</h2>
        <div class="info-grid">
            <div><strong>用户代理:</strong> <span id="userAgent"></span></div>
            <div><strong>浏览器:</strong> <span id="browser"></span></div>
            <div><strong>版本:</strong> <span id="version"></span></div>
            <div><strong>平台:</strong> <span id="platform"></span></div>
            <div><strong>语言:</strong> <span id="language"></span></div>
            <div><strong>时区:</strong> <span id="timezone"></span></div>
        </div>
    </div>

    <div class="test-card">
        <h2>🌐 网络连接测试</h2>
        <div id="networkTest">
            <div>测试中...</div>
        </div>
    </div>

    <div class="test-card">
        <h2>🎨 CSS特性支持</h2>
        <div id="cssTest">
            <div class="status" id="flexbox">Flexbox</div>
            <div class="status" id="grid">CSS Grid</div>
            <div class="status" id="backdrop">Backdrop Filter</div>
            <div class="status" id="variables">CSS Variables</div>
        </div>
    </div>

    <div class="test-card">
        <h2>⚡ JavaScript特性</h2>
        <div id="jsTest">
            <div class="status" id="es6">ES6</div>
            <div class="status" id="fetch">Fetch API</div>
            <div class="status" id="promise">Promise</div>
            <div class="status" id="async">Async/Await</div>
        </div>
    </div>

    <div class="test-card">
        <h2>🔗 API连接测试</h2>
        <div id="apiTest">
            <button onclick="testAPI()" style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">测试后端连接</button>
            <div id="apiResult" style="margin-top: 10px;"></div>
        </div>
    </div>

    <script>
        // 浏览器信息检测
        function detectBrowser() {
            const ua = navigator.userAgent;
            document.getElementById('userAgent').textContent = ua;
            document.getElementById('platform').textContent = navigator.platform;
            document.getElementById('language').textContent = navigator.language;
            document.getElementById('timezone').textContent = Intl.DateTimeFormat().resolvedOptions().timeZone;

            let browser = 'Unknown';
            let version = 'Unknown';

            if (ua.includes('Chrome') && !ua.includes('Edg')) {
                browser = 'Chrome';
                version = ua.match(/Chrome\/([0-9.]+)/)?.[1] || 'Unknown';
            } else if (ua.includes('Firefox')) {
                browser = 'Firefox';
                version = ua.match(/Firefox\/([0-9.]+)/)?.[1] || 'Unknown';
            } else if (ua.includes('Safari') && !ua.includes('Chrome')) {
                browser = 'Safari';
                version = ua.match(/Version\/([0-9.]+)/)?.[1] || 'Unknown';
            } else if (ua.includes('Edg')) {
                browser = 'Edge';
                version = ua.match(/Edg\/([0-9.]+)/)?.[1] || 'Unknown';
            }

            document.getElementById('browser').textContent = browser;
            document.getElementById('version').textContent = version;
        }

        // CSS特性测试
        function testCSS() {
            const tests = {
                flexbox: () => CSS.supports('display', 'flex'),
                grid: () => CSS.supports('display', 'grid'),
                backdrop: () => CSS.supports('backdrop-filter', 'blur(10px)'),
                variables: () => CSS.supports('--test', 'value')
            };

            Object.entries(tests).forEach(([test, fn]) => {
                const element = document.getElementById(test);
                try {
                    if (fn()) {
                        element.classList.add('success');
                        element.textContent += ' ✓';
                    } else {
                        element.classList.add('error');
                        element.textContent += ' ✗';
                    }
                } catch (e) {
                    element.classList.add('error');
                    element.textContent += ' ✗';
                }
            });
        }

        // JavaScript特性测试
        function testJS() {
            const tests = {
                es6: () => {
                    try {
                        eval('const test = () => {};');
                        return true;
                    } catch (e) {
                        return false;
                    }
                },
                fetch: () => typeof fetch !== 'undefined',
                promise: () => typeof Promise !== 'undefined',
                async: () => {
                    try {
                        eval('async function test() {}');
                        return true;
                    } catch (e) {
                        return false;
                    }
                }
            };

            Object.entries(tests).forEach(([test, fn]) => {
                const element = document.getElementById(test);
                try {
                    if (fn()) {
                        element.classList.add('success');
                        element.textContent += ' ✓';
                    } else {
                        element.classList.add('error');
                        element.textContent += ' ✗';
                    }
                } catch (e) {
                    element.classList.add('error');
                    element.textContent += ' ✗';
                }
            });
        }

        // 网络测试
        async function testNetwork() {
            const networkDiv = document.getElementById('networkTest');
            const tests = [
                { name: '本地前端', url: 'http://localhost:5173/' },
                { name: '本地后端', url: 'http://localhost:3000/health' }
            ];

            networkDiv.innerHTML = '';

            for (const test of tests) {
                const testDiv = document.createElement('div');
                testDiv.innerHTML = `<span class="status warning">${test.name}: 测试中...</span>`;
                networkDiv.appendChild(testDiv);

                try {
                    const response = await fetch(test.url, { 
                        method: 'GET',
                        mode: 'cors'
                    });
                    if (response.ok) {
                        testDiv.innerHTML = `<span class="status success">${test.name}: 连接成功 ✓</span>`;
                    } else {
                        testDiv.innerHTML = `<span class="status error">${test.name}: HTTP ${response.status} ✗</span>`;
                    }
                } catch (error) {
                    testDiv.innerHTML = `<span class="status error">${test.name}: ${error.message} ✗</span>`;
                }
            }
        }

        // API测试
        async function testAPI() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = '<div class="status warning">测试中...</div>';

            try {
                const response = await fetch('http://localhost:3000/health');
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="status success">✓ 后端连接成功</div>
                        <div style="margin-top: 10px; font-size: 14px;">
                            <strong>响应:</strong> ${JSON.stringify(data, null, 2)}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="status error">✗ HTTP ${response.status}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">✗ ${error.message}</div>`;
            }
        }

        // 页面加载时执行测试
        window.addEventListener('load', () => {
            detectBrowser();
            testCSS();
            testJS();
            testNetwork();
        });
    </script>
</body>
</html>