import{l as e,r as a,e as l,w as s,ag as t,M as i,q as n,O as o,U as d,p as r,u,m as c,F as m,a9 as p,S as v,T as f,Q as y,n as g,I as h,R as b,J as _,a2 as k,b as V,aq as w,P as C}from"./vendor-BtukhyiH.js";import{D as x,l as I,u as z,f as U,a4 as $,E,F as A,r as O,H as P,ah as S,aK as B,t as D,G as R,U as L,b as j,C as q,s as M,B as T,au as F,aN as N,aq as W}from"./elementPlus-DxaqjplL.js";import{useDepartmentStore as J}from"./department-DPqzaatc.js";import{G,H,_ as K}from"./index-DkAJPKqn.js";import"./utils-DfI7e5Rl.js";const Q={class:"form-section"},X={class:"role-option"},Y={class:"role-option"},Z={class:"role-option"},ee={class:"role-option"},ae={class:"form-section"},le={class:"permission-templates"},se={class:"templates-header"},te={class:"templates-list"},ie={class:"permissions-tree"},ne={class:"menu-header"},oe={class:"menu-title"},de={class:"menu-count"},re={key:0,class:"submenu-list"},ue={class:"submenu-header"},ce={class:"submenu-title"},me={class:"submenu-count"},pe={key:0,class:"action-list"},ve={class:"action-content"},fe={class:"action-name"},ye={class:"action-desc"},ge={class:"permission-summary"},he={class:"summary-item"},be={class:"summary-value"},_e={class:"summary-item"},ke={class:"summary-item"},Ve={class:"summary-value"},we={class:"dialog-footer"},Ce=K(e({__name:"RoleDialog",props:{modelValue:{type:Boolean},role:{},isEdit:{type:Boolean}},emits:["update:modelValue","success"],setup(e,{emit:h}){const b=e,_=h,k=J(),V=a(),w=a(!1),C=a(""),A=a({name:"",description:"",departmentId:"",type:"member",permissions:[]}),O=l({get:()=>b.modelValue,set:e=>_("update:modelValue",e)}),P={name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"角色名称长度在 2 到 20 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择角色类型",trigger:"change"}],departmentId:[{required:!0,message:"请选择所属部门",trigger:"change"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"},{min:5,max:200,message:"角色描述长度在 5 到 200 个字符",trigger:"blur"}]};a(G.map(e=>({key:e.code,name:e.name,checked:!1,indeterminate:!1,permissions:e.children?.flatMap(e=>[{key:e.code,name:`${e.name}菜单`,description:`访问${e.name}页面`},...e.actions?.map(a=>({key:`${e.code}:${a.code}`,name:`${e.name}-${a.name}`,description:a.description}))||[]])||[]})));const S=a(Object.entries(H).map(([e,a])=>({key:e,name:a.name,permissions:a.permissions}))),B=e=>{let a=0;return A.value.permissions.includes(e.code)&&a++,e.children&&e.children.forEach(e=>{A.value.permissions.includes(e.code)&&a++,e.actions&&e.actions.forEach(l=>{A.value.permissions.includes(`${e.code}:${l.code}`)&&a++})}),a},D=e=>{let a=1;return e.children&&(a+=e.children.length,e.children.forEach(e=>{e.actions&&(a+=e.actions.length)})),a},R=e=>{const a=B(e),l=D(e);return a>0&&a<l},L=e=>{let a=0;return A.value.permissions.includes(e.code)&&a++,e.actions&&e.actions.forEach(l=>{A.value.permissions.includes(`${e.code}:${l.code}`)&&a++}),a},j=e=>{let a=1;return e.actions&&(a+=e.actions.length),a},q=e=>{const a=L(e),l=j(e);return a>0&&a<l},M=()=>{const e=A.value.permissions.length;return e>=30?"超级管理员":e>=20?"高级权限":e>=10?"中级权限":e>=3?"基础权限":"无权限"},T=()=>{const e=A.value.permissions.length;return e>=30?"danger":e>=20?"warning":e>=10?"primary":e>=3?"success":"info"},F=()=>{const e=new Set;return A.value.permissions.forEach(a=>{const l=a.split(":")[0],s=G.find(e=>e.code===l);s&&e.add(s.name)}),Array.from(e).join("、")},N=()=>{C.value="",A.value.permissions=[]},W=()=>{A.value={name:"",description:"",departmentId:"",type:"member",permissions:[]},C.value=""},K=()=>{W(),_("update:modelValue",!1)},Ce=async()=>{if(V.value)try{await V.value.validate(),w.value=!0,await new Promise(e=>setTimeout(e,1e3)),_("success"),E.success(b.isEdit?"角色更新成功":"角色创建成功")}catch(e){console.error("表单验证失败:",e)}finally{w.value=!1}};return s(()=>b.modelValue,e=>{e&&g(()=>{b.isEdit&&b.role?A.value={name:b.role.name,description:b.role.description,departmentId:b.role.departmentId,type:b.role.type,permissions:[...b.role.permissions]}:W()})}),s(()=>A.value.permissions,()=>{updateAllCategoryStatus()},{deep:!0}),(a,l)=>{const s=t("el-input"),g=t("el-form-item"),h=t("el-col"),b=t("el-icon"),_=t("el-option"),E=t("el-select"),W=t("el-row"),J=t("el-button"),H=t("el-checkbox"),xe=t("el-tag"),Ie=t("el-form"),ze=t("el-dialog");return n(),i(ze,{modelValue:O.value,"onUpdate:modelValue":l[7]||(l[7]=e=>O.value=e),title:e.isEdit?"编辑角色":"新建角色",width:"800px","before-close":K,class:"role-dialog"},{footer:o(()=>[r("div",we,[d(J,{onClick:K,class:"cancel-btn"},{default:o(()=>[...l[19]||(l[19]=[v("取消",-1)])]),_:1}),d(J,{type:"primary",onClick:Ce,loading:w.value,class:"submit-btn"},{default:o(()=>[v(f(e.isEdit?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:o(()=>[d(Ie,{ref_key:"formRef",ref:V,model:A.value,rules:P,"label-width":"100px",class:"role-form"},{default:o(()=>[r("div",Q,[l[12]||(l[12]=r("h4",{class:"section-title"},"基本信息",-1)),d(W,{gutter:20},{default:o(()=>[d(h,{span:12},{default:o(()=>[d(g,{label:"角色名称",prop:"name"},{default:o(()=>[d(s,{modelValue:A.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>A.value.name=e),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),d(h,{span:12},{default:o(()=>[d(g,{label:"角色类型",prop:"type"},{default:o(()=>[d(E,{modelValue:A.value.type,"onUpdate:modelValue":l[1]||(l[1]=e=>A.value.type=e),placeholder:"选择角色类型",style:{width:"100%"}},{default:o(()=>[d(_,{label:"部门负责人",value:"manager"},{default:o(()=>[r("div",X,[d(b,null,{default:o(()=>[d(u(x))]),_:1}),l[8]||(l[8]=r("span",null,"部门负责人",-1))])]),_:1}),d(_,{label:"主管",value:"supervisor"},{default:o(()=>[r("div",Y,[d(b,null,{default:o(()=>[d(u(I))]),_:1}),l[9]||(l[9]=r("span",null,"主管",-1))])]),_:1}),d(_,{label:"专员",value:"specialist"},{default:o(()=>[r("div",Z,[d(b,null,{default:o(()=>[d(u(x))]),_:1}),l[10]||(l[10]=r("span",null,"专员",-1))])]),_:1}),d(_,{label:"普通成员",value:"member"},{default:o(()=>[r("div",ee,[d(b,null,{default:o(()=>[d(u(z))]),_:1}),l[11]||(l[11]=r("span",null,"普通成员",-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),d(g,{label:"所属部门",prop:"departmentId"},{default:o(()=>[d(E,{modelValue:A.value.departmentId,"onUpdate:modelValue":l[2]||(l[2]=e=>A.value.departmentId=e),placeholder:"选择所属部门",style:{width:"100%"}},{default:o(()=>[(n(!0),c(m,null,p(u(k).departmentList,e=>(n(),i(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(g,{label:"角色描述",prop:"description"},{default:o(()=>[d(s,{modelValue:A.value.description,"onUpdate:modelValue":l[3]||(l[3]=e=>A.value.description=e),type:"textarea",rows:3,placeholder:"请输入角色描述",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),r("div",ae,[l[18]||(l[18]=r("h4",{class:"section-title"},"权限配置",-1)),r("div",le,[r("div",se,[l[14]||(l[14]=r("span",null,"快速模板",-1)),d(J,{type:"text",size:"small",onClick:N},{default:o(()=>[...l[13]||(l[13]=[v(" 清空权限 ",-1)])]),_:1})]),r("div",te,[(n(!0),c(m,null,p(S.value,e=>(n(),i(J,{key:e.key,size:"small",type:e.key===C.value?"primary":"default",onClick:a=>(e=>{C.value=e.key,A.value.permissions=[...e.permissions]})(e),class:"template-btn"},{default:o(()=>[v(f(e.name),1)]),_:2},1032,["type","onClick"]))),128))])]),r("div",ie,[(n(!0),c(m,null,p(u(G),e=>(n(),c("div",{key:e.code,class:"permission-menu"},[r("div",ne,[d(H,{modelValue:A.value.permissions,"onUpdate:modelValue":l[4]||(l[4]=e=>A.value.permissions=e),value:e.code,onChange:a=>(e=>{if(A.value.permissions.includes(e.code))A.value.permissions.includes(e.code)||A.value.permissions.push(e.code),e.children&&e.children.forEach(e=>{A.value.permissions.includes(e.code)||A.value.permissions.push(e.code),e.actions&&e.actions.forEach(a=>{const l=`${e.code}:${a.code}`;A.value.permissions.includes(l)||A.value.permissions.push(l)})});else{const a=A.value.permissions.indexOf(e.code);a>-1&&A.value.permissions.splice(a,1),e.children&&e.children.forEach(e=>{const a=A.value.permissions.indexOf(e.code);a>-1&&A.value.permissions.splice(a,1),e.actions&&e.actions.forEach(a=>{const l=`${e.code}:${a.code}`,s=A.value.permissions.indexOf(l);s>-1&&A.value.permissions.splice(s,1)})})}})(e),indeterminate:R(e)},{default:o(()=>[r("span",oe,[d(b,null,{default:o(()=>[d(u(U))]),_:1}),v(" "+f(e.name),1)])]),_:2},1032,["modelValue","value","onChange","indeterminate"]),r("span",de,f(B(e))+"/"+f(D(e)),1)]),e.children?(n(),c("div",re,[(n(!0),c(m,null,p(e.children,e=>(n(),c("div",{key:e.code,class:"submenu-item"},[r("div",ue,[d(H,{modelValue:A.value.permissions,"onUpdate:modelValue":l[5]||(l[5]=e=>A.value.permissions=e),value:e.code,onChange:a=>(e=>{if(A.value.permissions.includes(e.code))A.value.permissions.includes(e.code)||A.value.permissions.push(e.code),e.actions&&e.actions.forEach(a=>{const l=`${e.code}:${a.code}`;A.value.permissions.includes(l)||A.value.permissions.push(l)});else{const a=A.value.permissions.indexOf(e.code);a>-1&&A.value.permissions.splice(a,1),e.actions&&e.actions.forEach(a=>{const l=`${e.code}:${a.code}`,s=A.value.permissions.indexOf(l);s>-1&&A.value.permissions.splice(s,1)})}})(e),indeterminate:q(e)},{default:o(()=>[r("span",ce,[d(b,null,{default:o(()=>[d(u($))]),_:1}),v(" "+f(e.name),1)])]),_:2},1032,["modelValue","value","onChange","indeterminate"]),r("span",me,f(L(e))+"/"+f(j(e)),1)]),e.actions?(n(),c("div",pe,[(n(!0),c(m,null,p(e.actions,a=>(n(),i(H,{key:`${e.code}:${a.code}`,modelValue:A.value.permissions,"onUpdate:modelValue":l[6]||(l[6]=e=>A.value.permissions=e),value:`${e.code}:${a.code}`,class:"action-item"},{default:o(()=>[r("div",ve,[r("span",fe,f(a.name),1),r("span",ye,f(a.description),1)])]),_:2},1032,["modelValue","value"]))),128))])):y("",!0)]))),128))])):y("",!0)]))),128))]),r("div",ge,[r("div",he,[l[15]||(l[15]=r("span",{class:"summary-label"},"已选权限：",-1)),r("span",be,f(A.value.permissions.length)+" 项",1)]),r("div",_e,[l[16]||(l[16]=r("span",{class:"summary-label"},"权限等级：",-1)),d(xe,{type:T(),size:"small"},{default:o(()=>[v(f(M()),1)]),_:1},8,["type"])]),r("div",ke,[l[17]||(l[17]=r("span",{class:"summary-label"},"覆盖模块：",-1)),r("span",Ve,f(F()),1)])])])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-0d8fa1ba"]]),xe={class:"dialog-content"},Ie={class:"role-info-section"},ze={class:"role-header"},Ue={class:"role-details"},$e={class:"role-name"},Ee={class:"role-desc"},Ae={class:"role-meta"},Oe={class:"department-name"},Pe={class:"filter-section"},Se={class:"users-section"},Be={class:"section-header"},De={class:"header-left"},Re={class:"user-count"},Le={class:"header-actions"},je={class:"users-grid"},qe=["onClick"],Me={class:"user-avatar"},Te={key:0,class:"assigned-badge"},Fe={class:"user-info"},Ne={class:"user-name"},We={class:"user-id"},Je={class:"user-department"},Ge={class:"user-status"},He={class:"user-actions"},Ke={class:"selection-indicator"},Qe={key:0,class:"empty-state"},Xe={key:0,class:"assigned-section"},Ye={class:"section-header"},Ze={class:"user-count"},ea={class:"assigned-users"},aa={class:"user-name"},la={class:"user-id"},sa={class:"dialog-footer"},ta=K(e({__name:"UserAssignDialog",props:{modelValue:{type:Boolean},role:{}},emits:["update:modelValue","success"],setup(e,{emit:V}){const w=e,C=V,U=J(),$=a(""),S=a(""),B=a(""),D=a([]),R=a([]),L=a([]),j=a(!1),q=l({get:()=>w.modelValue,set:e=>C("update:modelValue",e)}),M=a([{id:"1",name:"张三",employeeId:"EMP001",avatar:"",departmentId:"2",status:"active",email:"zhangsan@company.com",phone:"13800138001"},{id:"2",name:"李四",employeeId:"EMP002",avatar:"",departmentId:"2",status:"active",email:"lisi@company.com",phone:"13800138002"},{id:"3",name:"王五",employeeId:"EMP003",avatar:"",departmentId:"3",status:"active",email:"wangwu@company.com",phone:"13800138003"},{id:"4",name:"赵六",employeeId:"EMP004",avatar:"",departmentId:"4",status:"probation",email:"zhaoliu@company.com",phone:"13800138004"},{id:"5",name:"钱七",employeeId:"EMP005",avatar:"",departmentId:"2",status:"inactive",email:"qianqi@company.com",phone:"13800138005"}]),T=l(()=>{let e=M.value;if($.value){const a=$.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(a)||e.employeeId.toLowerCase().includes(a))}return S.value&&(e=e.filter(e=>e.status===S.value)),B.value&&(e=e.filter(e=>e.departmentId===B.value)),e}),F=l(()=>{const e=R.value.map(e=>e.id).sort(),a=L.value.sort();return JSON.stringify(e)!==JSON.stringify(a)}),N=e=>{if(!e)return"未知部门";const a=U.getDepartmentById(e);return a?.name||"未知部门"},W=e=>{const a={manager:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",member:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",specialist:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",supervisor:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"};return a[e]||a.member},G=e=>({manager:"部门负责人",member:"普通成员",specialist:"专员",supervisor:"主管"}[e]||"未知"),H=e=>({active:"在职",inactive:"离职",probation:"试用期"}[e]||"未知"),K=e=>R.value.some(a=>a.id===e),Q=()=>{$.value="",S.value="",B.value="",D.value=[],E.success("数据已刷新")},X=e=>{const a=R.value.findIndex(a=>a.id===e.id);a>-1&&R.value.splice(a,1)},Y=()=>{D.value.forEach(e=>{const a=M.value.find(a=>a.id===e);a&&!K(e)&&R.value.push(a)}),D.value=[]},Z=()=>{R.value=M.value.filter(e=>L.value.includes(e.id)),D.value=[],$.value="",S.value="",B.value="",C("update:modelValue",!1)},ee=async()=>{try{j.value=!0,await new Promise(e=>setTimeout(e,1e3)),L.value=R.value.map(e=>e.id),C("success"),E.success("用户分配成功")}catch(e){E.error("保存失败，请重试")}finally{j.value=!1}};return s(()=>w.modelValue,e=>{e&&g(()=>{w.role&&(R.value=M.value.slice(0,2),L.value=R.value.map(e=>e.id)),D.value=[]})}),(a,l)=>{const s=t("el-icon"),g=t("el-tag"),V=t("el-divider"),w=t("el-input"),C=t("el-col"),E=t("el-option"),L=t("el-select"),M=t("el-button"),J=t("el-row"),ae=t("el-avatar"),le=t("el-checkbox"),se=t("el-empty"),te=t("el-dialog");return n(),i(te,{modelValue:q.value,"onUpdate:modelValue":l[5]||(l[5]=e=>q.value=e),title:"分配用户",width:"900px","before-close":Z,class:"user-assign-dialog"},{footer:o(()=>[r("div",sa,[d(M,{onClick:Z,class:"cancel-btn"},{default:o(()=>[...l[12]||(l[12]=[v("取消",-1)])]),_:1}),d(M,{type:"primary",onClick:ee,loading:j.value,disabled:!F.value,class:"save-btn"},{default:o(()=>[...l[13]||(l[13]=[v(" 保存分配 ",-1)])]),_:1},8,["loading","disabled"])])]),default:o(()=>{return[r("div",xe,[r("div",Ie,[r("div",ze,[r("div",{class:"role-icon",style:h({background:W(e.role?.type)})},[d(s,null,{default:o(()=>{return[(n(),i(b((a=e.role?.type,{manager:x,member:z,specialist:x,supervisor:I}[a]||z))))];var a}),_:1})],4),r("div",Ue,[r("h3",$e,f(e.role?.name),1),r("p",Ee,f(e.role?.description),1),r("div",Ae,[d(g,{type:(a=e.role?.type,{manager:"danger",member:"primary",specialist:"success",supervisor:"warning"}[a]||"primary"),size:"small"},{default:o(()=>[v(f(G(e.role?.type)),1)]),_:1},8,["type"]),r("span",Oe,f(N(e.role?.departmentId)),1)])])])]),d(V),r("div",Pe,[d(J,{gutter:20,align:"middle"},{default:o(()=>[d(C,{span:8},{default:o(()=>[d(w,{modelValue:$.value,"onUpdate:modelValue":l[0]||(l[0]=e=>$.value=e),placeholder:"搜索用户姓名、工号","prefix-icon":u(A),clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),d(C,{span:6},{default:o(()=>[d(L,{modelValue:S.value,"onUpdate:modelValue":l[1]||(l[1]=e=>S.value=e),placeholder:"用户状态",clearable:""},{default:o(()=>[d(E,{label:"全部状态",value:""}),d(E,{label:"在职",value:"active"}),d(E,{label:"离职",value:"inactive"}),d(E,{label:"试用期",value:"probation"})]),_:1},8,["modelValue"])]),_:1}),d(C,{span:6},{default:o(()=>[d(L,{modelValue:B.value,"onUpdate:modelValue":l[2]||(l[2]=e=>B.value=e),placeholder:"所属部门",clearable:""},{default:o(()=>[d(E,{label:"全部部门",value:""}),(n(!0),c(m,null,p(u(U).departmentList,e=>(n(),i(E,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(C,{span:4},{default:o(()=>[d(M,{icon:u(O),onClick:Q,class:"refresh-btn"},{default:o(()=>[...l[6]||(l[6]=[v(" 刷新 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1})]),r("div",Se,[r("div",Be,[r("div",De,[l[7]||(l[7]=r("h4",null,"可分配用户",-1)),r("span",Re,"共 "+f(T.value.length)+" 人",1)]),r("div",Le,[d(M,{size:"small",disabled:0===D.value.length,onClick:Y,class:"batch-btn"},{default:o(()=>[v(" 批量分配 ("+f(D.value.length)+") ",1)]),_:1},8,["disabled"])])]),r("div",je,[(n(!0),c(m,null,p(T.value,e=>{return n(),c("div",{key:e.id,class:_(["user-card",{selected:D.value.includes(e.id),assigned:K(e.id)}]),onClick:a=>(e=>{if(K(e.id))return;const a=D.value.indexOf(e.id);a>-1?D.value.splice(a,1):D.value.push(e.id)})(e)},[r("div",Me,[d(ae,{size:48,src:e.avatar},{default:o(()=>[v(f(e.name.charAt(0)),1)]),_:2},1032,["src"]),K(e.id)?(n(),c("div",Te,[d(s,null,{default:o(()=>[d(u(P))]),_:1})])):y("",!0)]),r("div",Fe,[r("h5",Ne,f(e.name),1),r("p",We,"工号："+f(e.employeeId),1),r("p",Je,f(N(e.departmentId)),1),r("div",Ge,[d(g,{type:(a=e.status,{active:"success",inactive:"danger",probation:"warning"}[a]||"info"),size:"small"},{default:o(()=>[v(f(H(e.status)),1)]),_:2},1032,["type"])])]),r("div",He,[K(e.id)?(n(),i(M,{key:1,size:"small",type:"danger",onClick:k(a=>X(e),["stop"]),class:"unassign-btn"},{default:o(()=>[...l[9]||(l[9]=[v(" 取消分配 ",-1)])]),_:1},8,["onClick"])):(n(),i(M,{key:0,size:"small",type:"primary",onClick:k(a=>(e=>{if(!K(e.id)){R.value.push(e);const a=D.value.indexOf(e.id);a>-1&&D.value.splice(a,1)}})(e),["stop"]),class:"assign-btn"},{default:o(()=>[...l[8]||(l[8]=[v(" 分配 ",-1)])]),_:1},8,["onClick"]))]),r("div",Ke,[d(le,{modelValue:D.value,"onUpdate:modelValue":l[3]||(l[3]=e=>D.value=e),value:e.id,onClick:l[4]||(l[4]=k(()=>{},["stop"]))},null,8,["modelValue","value"])])],10,qe);var a}),128))]),0===T.value.length?(n(),c("div",Qe,[d(se,{description:"暂无可分配的用户"})])):y("",!0)]),R.value.length>0?(n(),c("div",Xe,[r("div",Ye,[l[10]||(l[10]=r("h4",null,"已分配用户",-1)),r("span",Ze,f(R.value.length)+" 人",1)]),r("div",ea,[(n(!0),c(m,null,p(R.value,e=>(n(),c("div",{key:e.id,class:"assigned-user"},[d(ae,{size:32,src:e.avatar},{default:o(()=>[v(f(e.name.charAt(0)),1)]),_:2},1032,["src"]),r("span",aa,f(e.name),1),r("span",la,f(e.employeeId),1),d(M,{size:"small",type:"danger",link:"",onClick:a=>X(e)},{default:o(()=>[...l[11]||(l[11]=[v(" 移除 ",-1)])]),_:1},8,["onClick"])]))),128))])])):y("",!0)])];var a}),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-fee92dc7"]]),ia={class:"dialog-content"},na={class:"role-info-section"},oa={class:"role-header"},da={class:"role-details"},ra={class:"role-name"},ua={class:"role-desc"},ca={class:"role-meta"},ma={class:"department-name"},pa={class:"permission-count"},va={class:"permission-stats"},fa={class:"stat-item"},ya={class:"stat-icon total"},ga={class:"stat-content"},ha={class:"stat-number"},ba={class:"stat-item"},_a={class:"stat-icon modules"},ka={class:"stat-content"},Va={class:"stat-number"},wa={class:"stat-item"},Ca={class:"stat-icon level"},xa={class:"stat-content"},Ia={class:"stat-number"},za={class:"permissions-section"},Ua={class:"section-header"},$a={class:"view-options"},Ea={key:0,class:"category-view"},Aa={class:"category-header"},Oa={class:"category-info"},Pa={class:"category-name"},Sa={class:"category-count"},Ba={class:"category-progress"},Da={class:"category-permissions"},Ra={class:"permission-icon"},La={class:"permission-content"},ja={class:"permission-name"},qa={class:"permission-desc"},Ma={class:"permission-level"},Ta={key:1,class:"list-view"},Fa={class:"permission-name-cell"},Na={key:0,class:"comparison-section"},Wa={class:"section-header"},Ja={class:"comparison-content"},Ga={class:"dialog-footer"},Ha=K(e({__name:"PermissionDetailDialog",props:{modelValue:{type:Boolean},role:{}},emits:["update:modelValue"],setup(e,{emit:s}){const g=e,_=s,k=J(),V=a("category"),w=a(!1),C=l({get:()=>g.modelValue,set:e=>_("update:modelValue",e)}),U={"customer:read":{key:"customer:read",name:"查看客户",description:"查看客户基本信息和详情",module:"客户管理"},"customer:write":{key:"customer:write",name:"编辑客户",description:"创建、修改客户信息",module:"客户管理"},"customer:delete":{key:"customer:delete",name:"删除客户",description:"删除客户记录",module:"客户管理"},"customer:export":{key:"customer:export",name:"导出客户",description:"导出客户数据",module:"客户管理"},"customer:import":{key:"customer:import",name:"导入客户",description:"批量导入客户数据",module:"客户管理"},"order:read":{key:"order:read",name:"查看订单",description:"查看订单信息和状态",module:"订单管理"},"order:write":{key:"order:write",name:"编辑订单",description:"创建、修改订单",module:"订单管理"},"order:audit":{key:"order:audit",name:"审核订单",description:"审核订单状态",module:"订单管理"},"order:cancel":{key:"order:cancel",name:"取消订单",description:"取消订单操作",module:"订单管理"},"order:refund":{key:"order:refund",name:"退款处理",description:"处理订单退款",module:"订单管理"},"finance:read":{key:"finance:read",name:"查看财务",description:"查看财务数据和报表",module:"财务管理"},"finance:write":{key:"finance:write",name:"编辑财务",description:"录入、修改财务数据",module:"财务管理"},"finance:audit":{key:"finance:audit",name:"财务审核",description:"审核财务单据",module:"财务管理"},"finance:report":{key:"finance:report",name:"财务报表",description:"生成财务报表",module:"财务管理"},"finance:settlement":{key:"finance:settlement",name:"结算管理",description:"处理结算业务",module:"财务管理"},"logistics:read":{key:"logistics:read",name:"查看物流",description:"查看物流信息",module:"物流管理"},"logistics:write":{key:"logistics:write",name:"编辑物流",description:"创建、修改物流单",module:"物流管理"},"logistics:track":{key:"logistics:track",name:"物流跟踪",description:"跟踪物流状态",module:"物流管理"},"logistics:warehouse":{key:"logistics:warehouse",name:"仓库管理",description:"管理仓库库存",module:"物流管理"},"service:read":{key:"service:read",name:"查看工单",description:"查看客服工单",module:"客服管理"},"service:write":{key:"service:write",name:"处理工单",description:"创建、处理工单",module:"客服管理"},"service:assign":{key:"service:assign",name:"分配工单",description:"分配工单给客服",module:"客服管理"},"service:close":{key:"service:close",name:"关闭工单",description:"关闭已处理工单",module:"客服管理"},"system:user":{key:"system:user",name:"用户管理",description:"管理系统用户",module:"系统管理"},"system:role":{key:"system:role",name:"角色管理",description:"管理用户角色",module:"系统管理"},"system:dept":{key:"system:dept",name:"部门管理",description:"管理部门结构",module:"系统管理"},"system:config":{key:"system:config",name:"系统配置",description:"配置系统参数",module:"系统管理"},"system:log":{key:"system:log",name:"日志查看",description:"查看系统日志",module:"系统管理"},"performance:read":{key:"performance:read",name:"查看绩效",description:"查看绩效数据",module:"绩效管理"}},$=l(()=>{if(!g.role?.permissions)return[];const e=new Set;return g.role.permissions.forEach(a=>{const l=U[a];l&&e.add(l.module)}),Array.from(e)}),A=l(()=>{const e=g.role?.permissions.length||0;return e>=15?"高级":e>=8?"中级":e>=3?"基础":"无"}),O=l(()=>{if(!g.role?.permissions)return[];const e={};return g.role.permissions.forEach(a=>{const l=U[a];if(l){const a=l.key.split(":")[0];e[a]||(e[a]={key:a,name:l.module,permissions:[]}),e[a].permissions.push(l)}}),Object.values(e)}),j=l(()=>g.role?.permissions?g.role.permissions.map(e=>U[e]||{key:e,name:e,description:"未知权限",module:"未知"}):[]),q=e=>{if(!e)return"未知部门";const a=k.getDepartmentById(e);return a?.name||"未知部门"},M=e=>{const a={manager:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",member:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",specialist:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",supervisor:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"};return a[e]||a.member},T=e=>({manager:"部门负责人",member:"普通成员",specialist:"专员",supervisor:"主管"}[e]||"未知"),F=e=>{const a=Object.values(U).filter(a=>a.module===e.name);return 0===a.length?100:Math.round(e.permissions.length/a.length*100)},N=e=>{const a=F(e);return a>=80?"#67c23a":a>=50?"#e6a23c":"#f56c6c"},W=e=>e.includes("delete")||e.includes("audit")?"danger":e.includes("write")||e.includes("edit")?"warning":"success",G=e=>e.includes("delete")||e.includes("audit")?"高级":e.includes("write")||e.includes("edit")?"中级":"基础",H=()=>{_("update:modelValue",!1)},K=()=>{const e=j.value.map(e=>({"权限名称":e.name,"权限描述":e.description,"所属模块":e.module,"权限等级":G(e.key)}));console.log("导出数据:",e),E.success("权限列表已导出")};return(a,l)=>{const s=t("el-icon"),g=t("el-tag"),_=t("el-divider"),k=t("el-col"),U=t("el-row"),E=t("el-radio-button"),J=t("el-radio-group"),Q=t("el-progress"),X=t("el-table-column"),Y=t("el-table"),Z=t("el-button"),ee=t("el-empty"),ae=t("el-dialog");return n(),i(ae,{modelValue:C.value,"onUpdate:modelValue":l[3]||(l[3]=e=>C.value=e),title:"权限详情",width:"700px","before-close":H,class:"permission-detail-dialog"},{footer:o(()=>[r("div",Ga,[d(Z,{onClick:K,class:"export-btn"},{default:o(()=>[d(s,null,{default:o(()=>[d(u(R))]),_:1}),l[12]||(l[12]=v(" 导出权限 ",-1))]),_:1}),d(Z,{onClick:l[2]||(l[2]=e=>w.value=!w.value),class:"compare-btn"},{default:o(()=>[d(s,null,{default:o(()=>[d(u(L))]),_:1}),l[13]||(l[13]=v(" 权限对比 ",-1))]),_:1}),d(Z,{type:"primary",onClick:H,class:"close-btn"},{default:o(()=>[...l[14]||(l[14]=[v(" 关闭 ",-1)])]),_:1})])]),default:o(()=>{return[r("div",ia,[r("div",na,[r("div",oa,[r("div",{class:"role-icon",style:h({background:M(e.role?.type)})},[d(s,null,{default:o(()=>{return[(n(),i(b((a=e.role?.type,{manager:x,member:z,specialist:x,supervisor:I}[a]||z))))];var a}),_:1})],4),r("div",da,[r("h3",ra,f(e.role?.name),1),r("p",ua,f(e.role?.description),1),r("div",ca,[d(g,{type:(a=e.role?.type,{manager:"danger",member:"primary",specialist:"success",supervisor:"warning"}[a]||"primary"),size:"small"},{default:o(()=>[v(f(T(e.role?.type)),1)]),_:1},8,["type"]),r("span",ma,f(q(e.role?.departmentId)),1),r("span",pa,f(e.role?.permissions.length||0)+" 项权限",1)])])])]),d(_),r("div",va,[d(U,{gutter:16},{default:o(()=>[d(k,{span:8},{default:o(()=>[r("div",fa,[r("div",ya,[d(s,null,{default:o(()=>[d(u(S))]),_:1})]),r("div",ga,[r("div",ha,f(e.role?.permissions.length||0),1),l[4]||(l[4]=r("div",{class:"stat-label"},"总权限数",-1))])])]),_:1}),d(k,{span:8},{default:o(()=>[r("div",ba,[r("div",_a,[d(s,null,{default:o(()=>[d(u(B))]),_:1})]),r("div",ka,[r("div",Va,f($.value.length),1),l[5]||(l[5]=r("div",{class:"stat-label"},"覆盖模块",-1))])])]),_:1}),d(k,{span:8},{default:o(()=>[r("div",wa,[r("div",Ca,[d(s,null,{default:o(()=>[d(u(D))]),_:1})]),r("div",xa,[r("div",Ia,f(A.value),1),l[6]||(l[6]=r("div",{class:"stat-label"},"权限等级",-1))])])]),_:1})]),_:1})]),r("div",za,[r("div",Ua,[l[9]||(l[9]=r("h4",null,"权限详情",-1)),r("div",$a,[d(J,{modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=e=>V.value=e),size:"small"},{default:o(()=>[d(E,{value:"category"},{default:o(()=>[...l[7]||(l[7]=[v("按模块",-1)])]),_:1}),d(E,{value:"list"},{default:o(()=>[...l[8]||(l[8]=[v("列表",-1)])]),_:1})]),_:1},8,["modelValue"])])]),"category"===V.value?(n(),c("div",Ea,[(n(!0),c(m,null,p(O.value,e=>(n(),c("div",{key:e.key,class:"permission-category"},[r("div",Aa,[r("div",Oa,[r("h5",Pa,f(e.name),1),r("span",Sa,f(e.permissions.length)+" 项",1)]),r("div",Ba,[d(Q,{percentage:F(e),"stroke-width":6,"show-text":!1,color:N(e)},null,8,["percentage","color"])])]),r("div",Da,[(n(!0),c(m,null,p(e.permissions,e=>(n(),c("div",{key:e.key,class:"permission-item"},[r("div",Ra,[d(s,null,{default:o(()=>[d(u(P))]),_:1})]),r("div",La,[r("span",ja,f(e.name),1),r("span",qa,f(e.description),1)]),r("div",Ma,[d(g,{type:W(e.key),size:"small"},{default:o(()=>[v(f(G(e.key)),1)]),_:2},1032,["type"])])]))),128))])]))),128))])):(n(),c("div",Ta,[d(Y,{data:j.value,style:{width:"100%"}},{default:o(()=>[d(X,{prop:"name",label:"权限名称",width:"150"},{default:o(({row:e})=>[r("div",Fa,[d(s,{class:"permission-icon"},{default:o(()=>[d(u(P))]),_:1}),r("span",null,f(e.name),1)])]),_:1}),d(X,{prop:"description",label:"权限描述","min-width":"200"}),d(X,{prop:"module",label:"所属模块",width:"120"},{default:o(({row:e})=>[d(g,{size:"small"},{default:o(()=>[v(f(e.module),1)]),_:2},1024)]),_:1}),d(X,{prop:"level",label:"权限等级",width:"100"},{default:o(({row:e})=>[d(g,{type:W(e.key),size:"small"},{default:o(()=>[v(f(G(e.key)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]))]),w.value?(n(),c("div",Na,[r("div",Wa,[l[11]||(l[11]=r("h4",null,"权限对比",-1)),d(Z,{size:"small",type:"text",onClick:l[1]||(l[1]=e=>w.value=!1)},{default:o(()=>[...l[10]||(l[10]=[v(" 隐藏对比 ",-1)])]),_:1})]),r("div",Ja,[d(ee,{description:"暂无对比数据"})])])):y("",!0)])];var a}),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-7e0ff117"]]),Ka={class:"config-target-section"},Qa={key:0,class:"target-selection"},Xa={class:"target-item"},Ya={class:"target-info"},Za={class:"target-name"},el={class:"target-desc"},al={key:0,class:"target-stats"},ll={key:1,class:"target-stats"},sl={key:0,class:"config-method-section"},tl={key:0,class:"template-selection"},il={class:"template-option"},nl={key:0,class:"template-preview"},ol={class:"permission-tags"},dl={key:1,class:"custom-permissions"},rl={class:"permission-categories"},ul={class:"category-header"},cl={class:"category-count"},ml={class:"category-permissions"},pl={key:2,class:"copy-source"},vl={class:"copy-source-option"},fl={key:1,class:"config-preview"},yl={class:"preview-details"},gl={class:"affected-targets"},hl={class:"target-list"},bl={class:"permission-summary"},_l={class:"summary-stats"},kl={class:"dialog-footer"},Vl=K(e({__name:"BatchConfigDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(e,{emit:u}){const g=e,h=u,b=J(),_=l({get:()=>g.modelValue,set:e=>h("update:modelValue",e)}),k=a(!1),V=a("roles"),w=a("template"),C=a([]),x=a(""),I=a([]),z=a(""),U=a([{id:"sales",name:"销售人员",permissions:["customer.view","customer.create","customer.edit","order.view","order.create"]},{id:"manager",name:"部门经理",permissions:["customer.all","order.all","report.view","team.manage"]},{id:"audit",name:"审核人员",permissions:["order.audit","customer.audit","report.view"]},{id:"finance",name:"财务人员",permissions:["order.finance","report.finance","customer.finance"]}]),$=a([{id:"customer",name:"客户管理",checked:!1,indeterminate:!1,checkedCount:0,permissions:[{id:"customer.view",name:"查看客户"},{id:"customer.create",name:"创建客户"},{id:"customer.edit",name:"编辑客户"},{id:"customer.delete",name:"删除客户"},{id:"customer.export",name:"导出客户"}]},{id:"order",name:"订单管理",checked:!1,indeterminate:!1,checkedCount:0,permissions:[{id:"order.view",name:"查看订单"},{id:"order.create",name:"创建订单"},{id:"order.edit",name:"编辑订单"},{id:"order.delete",name:"删除订单"},{id:"order.audit",name:"审核订单"}]},{id:"report",name:"报表管理",checked:!1,indeterminate:!1,checkedCount:0,permissions:[{id:"report.view",name:"查看报表"},{id:"report.export",name:"导出报表"},{id:"report.create",name:"创建报表"}]}]),A=l(()=>"roles"===V.value?b.roles.map(e=>({key:e.id,label:e.name,description:e.description,userCount:e.userCount||0,permissionCount:e.permissions?.length||0})):b.departments.map(e=>({key:e.id,label:e.name,description:e.description||"",memberCount:e.memberCount||0,level:e.level}))),O=l(()=>{const e="roles"===V.value?"角色":"部门";return[`可选${e}`,`已选${e}`]}),P=l(()=>"roles"===V.value?"搜索角色":"搜索部门"),S=l(()=>{const e=[];return"roles"===V.value&&e.push({label:"角色",options:b.roles.map(e=>({value:`role_${e.id}`,label:e.name,permissionCount:e.permissions?.length||0}))}),e.push({label:"部门",options:b.departments.map(e=>({value:`dept_${e.id}`,label:e.name,permissionCount:e.permissions?.length||0}))}),e}),B=l(()=>C.value.length>0&&("template"===w.value&&x.value||"custom"===w.value&&I.value.length>0||"copy"===w.value&&z.value)),D=l(()=>B.value&&!k.value);s(I,()=>{L()},{deep:!0});const R=()=>{C.value=[],H()},L=()=>{$.value.forEach(e=>{const a=e.permissions.filter(e=>I.value.includes(e.id)).length;e.checkedCount=a,e.checked=a===e.permissions.length,e.indeterminate=a>0&&a<e.permissions.length})},q=e=>{const a=U.value.find(a=>a.id===e);return a?.permissions||[]},M=e=>{for(const a of $.value){const l=a.permissions.find(a=>a.id===e);if(l)return l.name}return e},T=e=>{const a=A.value.find(a=>a.key===e);return a?.label||e},F=()=>{if("template"===w.value&&x.value)return q(x.value);if("custom"===w.value)return I.value;if("copy"===w.value&&z.value){const[e,a]=z.value.split("_");if("role"===e){const e=b.roles.find(e=>e.id===a);return e?.permissions||[]}if("dept"===e){const e=b.departments.find(e=>e.id===a);return e?.permissions||[]}}return[]},N=()=>{const e=F(),a=new Set;return e.forEach(e=>{const l=e.split(".")[0];a.add(l)}),Array.from(a)},W=()=>{const e=F();return e.length>=15?"高级":e.length>=8?"中级":e.length>=3?"基础":"无"},G=()=>{V.value="roles",w.value="template",C.value=[],x.value="",I.value=[],z.value="",L()},H=()=>{w.value="template",x.value="",I.value=[],z.value="",L()},K=()=>{_.value=!1,G()},Q=async()=>{try{await j.confirm(`确认为 ${C.value.length} 个${"roles"===V.value?"角色":"部门"}配置权限？`,"确认操作",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),k.value=!0;const e=F();"roles"===V.value?await b.batchUpdateRolePermissions(C.value,e):await b.batchUpdatePermissions(C.value,e),E.success("批量权限配置成功"),h("success"),K()}catch(e){"cancel"!==e&&E.error("批量权限配置失败")}finally{k.value=!1}};return(e,a)=>{const l=t("el-radio"),s=t("el-radio-group"),u=t("el-tag"),g=t("el-transfer"),h=t("el-option"),b=t("el-select"),E=t("el-checkbox"),j=t("el-checkbox-group"),J=t("el-option-group"),H=t("el-alert"),X=t("el-statistic"),Y=t("el-button"),Z=t("el-dialog");return n(),i(Z,{modelValue:_.value,"onUpdate:modelValue":a[6]||(a[6]=e=>_.value=e),title:"批量权限配置",width:"900px","before-close":K,class:"batch-config-dialog"},{footer:o(()=>[r("div",kl,[d(Y,{onClick:K},{default:o(()=>[...a[17]||(a[17]=[v("取消",-1)])]),_:1}),d(Y,{onClick:G},{default:o(()=>[...a[18]||(a[18]=[v("重置",-1)])]),_:1}),d(Y,{type:"primary",onClick:Q,loading:k.value,disabled:!D.value},{default:o(()=>[...a[19]||(a[19]=[v(" 确认配置 ",-1)])]),_:1},8,["loading","disabled"])])]),default:o(()=>[r("div",Ka,[a[9]||(a[9]=r("h4",null,"配置目标",-1)),d(s,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),onChange:R},{default:o(()=>[d(l,{value:"roles"},{default:o(()=>[...a[7]||(a[7]=[v("按角色配置",-1)])]),_:1}),d(l,{value:"departments"},{default:o(()=>[...a[8]||(a[8]=[v("按部门配置",-1)])]),_:1})]),_:1},8,["modelValue"]),V.value?(n(),c("div",Qa,[d(g,{modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value=e),data:A.value,titles:O.value,"button-texts":["移除","添加"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},filterable:"","filter-placeholder":P.value,style:{"text-align":"left",display:"inline-block"}},{default:o(({option:e})=>[r("div",Xa,[r("div",Ya,[r("span",Za,f(e.label),1),r("span",el,f(e.description),1)]),"roles"===V.value?(n(),c("div",al,[d(u,{size:"small",type:"info"},{default:o(()=>[v(f(e.userCount)+"人",1)]),_:2},1024),d(u,{size:"small",type:"success"},{default:o(()=>[v(f(e.permissionCount)+"权限",1)]),_:2},1024)])):(n(),c("div",ll,[d(u,{size:"small",type:"info"},{default:o(()=>[v(f(e.memberCount)+"成员",1)]),_:2},1024),d(u,{size:"small",type:"warning"},{default:o(()=>[v(f(e.level)+"级",1)]),_:2},1024)]))])]),_:1},8,["modelValue","data","titles","filter-placeholder"])])):y("",!0)]),C.value.length>0?(n(),c("div",sl,[a[14]||(a[14]=r("h4",null,"配置方式",-1)),d(s,{modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=e=>w.value=e)},{default:o(()=>[d(l,{value:"template"},{default:o(()=>[...a[10]||(a[10]=[v("使用权限模板",-1)])]),_:1}),d(l,{value:"custom"},{default:o(()=>[...a[11]||(a[11]=[v("自定义权限",-1)])]),_:1}),d(l,{value:"copy"},{default:o(()=>[...a[12]||(a[12]=[v("复制现有权限",-1)])]),_:1})]),_:1},8,["modelValue"]),"template"===w.value?(n(),c("div",tl,[d(b,{modelValue:x.value,"onUpdate:modelValue":a[3]||(a[3]=e=>x.value=e),placeholder:"选择权限模板",style:{width:"300px"}},{default:o(()=>[(n(!0),c(m,null,p(U.value,e=>(n(),i(h,{key:e.id,label:e.name,value:e.id},{default:o(()=>[r("div",il,[r("span",null,f(e.name),1),d(u,{size:"small",type:"info"},{default:o(()=>[v(f(e.permissions.length)+"项权限",1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),x.value?(n(),c("div",nl,[a[13]||(a[13]=r("h5",null,"模板权限预览：",-1)),r("div",ol,[(n(!0),c(m,null,p(q(x.value),e=>(n(),i(u,{key:e,size:"small",style:{margin:"2px"}},{default:o(()=>[v(f(M(e)),1)]),_:2},1024))),128))])])):y("",!0)])):y("",!0),"custom"===w.value?(n(),c("div",dl,[r("div",rl,[(n(!0),c(m,null,p($.value,e=>(n(),c("div",{key:e.id,class:"category-section"},[r("div",ul,[d(E,{modelValue:e.checked,"onUpdate:modelValue":a=>e.checked=a,indeterminate:e.indeterminate,onChange:a=>(e=>{e.checked?e.permissions.forEach(e=>{I.value.includes(e.id)||I.value.push(e.id)}):e.permissions.forEach(e=>{const a=I.value.indexOf(e.id);a>-1&&I.value.splice(a,1)}),L()})(e)},{default:o(()=>[v(f(e.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","indeterminate","onChange"]),r("span",cl,"("+f(e.checkedCount)+"/"+f(e.permissions.length)+")",1)]),r("div",ml,[d(j,{modelValue:I.value,"onUpdate:modelValue":a[4]||(a[4]=e=>I.value=e)},{default:o(()=>[(n(!0),c(m,null,p(e.permissions,e=>(n(),i(E,{key:e.id,value:e.id,label:e.name},null,8,["value","label"]))),128))]),_:2},1032,["modelValue"])])]))),128))])])):y("",!0),"copy"===w.value?(n(),c("div",pl,[d(b,{modelValue:z.value,"onUpdate:modelValue":a[5]||(a[5]=e=>z.value=e),placeholder:"选择权限复制源",style:{width:"300px"}},{default:o(()=>[(n(!0),c(m,null,p(S.value,e=>(n(),i(J,{key:e.label,label:e.label},{default:o(()=>[(n(!0),c(m,null,p(e.options,e=>(n(),i(h,{key:e.value,label:e.label,value:e.value},{default:o(()=>[r("div",vl,[r("span",null,f(e.label),1),d(u,{size:"small",type:"success"},{default:o(()=>[v(f(e.permissionCount)+"权限",1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])):y("",!0)])):y("",!0),B.value?(n(),c("div",fl,[a[16]||(a[16]=r("h4",null,"配置预览",-1)),d(H,{title:`将为 ${C.value.length} 个${"roles"===V.value?"角色":"部门"}配置权限`,type:"info","show-icon":"",closable:!1},null,8,["title"]),r("div",yl,[r("div",gl,[r("h5",null,"影响的"+f("roles"===V.value?"角色":"部门")+"：",1),r("div",hl,[(n(!0),c(m,null,p(C.value,e=>(n(),i(u,{key:e,style:{margin:"2px"}},{default:o(()=>[v(f(T(e)),1)]),_:2},1024))),128))])]),r("div",bl,[a[15]||(a[15]=r("h5",null,"权限配置：",-1)),r("div",_l,[d(X,{title:"总权限数",value:F().length},null,8,["value"]),d(X,{title:"覆盖模块",value:N().length},null,8,["value"]),d(X,{title:"权限等级",value:W(),"value-style":"color: #409EFF"},null,8,["value"])])])])])):y("",!0)]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-b766eda9"]]),wl={class:"department-roles-container"},Cl={class:"page-header"},xl={class:"header-actions"},Il={class:"stats-section"},zl={class:"stat-card"},Ul={class:"stat-icon roles"},$l={class:"stat-content"},El={class:"stat-number"},Al={class:"stat-card"},Ol={class:"stat-icon departments"},Pl={class:"stat-content"},Sl={class:"stat-number"},Bl={class:"stat-card"},Dl={class:"stat-icon permissions"},Rl={class:"stat-content"},Ll={class:"stat-number"},jl={class:"stat-card"},ql={class:"stat-icon users"},Ml={class:"stat-content"},Tl={class:"stat-number"},Fl={class:"filter-section"},Nl={class:"roles-section"},Wl={class:"section-header"},Jl={class:"view-options"},Gl={key:0,class:"roles-grid"},Hl=["onClick"],Kl={class:"role-header"},Ql={class:"role-info"},Xl={class:"role-details"},Yl={class:"role-name"},Zl={class:"role-desc"},es={class:"role-meta"},as={class:"meta-item"},ls={class:"meta-value"},ss={class:"meta-item"},ts={class:"meta-item"},is={class:"meta-value"},ns={class:"meta-item"},os={class:"meta-value"},ds={class:"role-permissions"},rs={class:"permissions-header"},us={class:"permissions-list"},cs={class:"role-actions"},ms={key:1,class:"roles-table"},ps={class:"role-name-cell"},vs={class:"table-actions"},fs=K(e({__name:"DepartmentRoles",setup(e){const s=J(),g=a(""),_=a(""),U=a(""),$=a("card"),P=a(!1),B=a(!1),D=a(!1),R=a(!1),L=a(!1),j=a(null),G=a(!1),H=a([{id:"1",name:"销售部经理",description:"销售部门负责人，负责销售团队管理和业务决策",departmentId:"2",type:"manager",permissions:["customer:read","customer:write","order:read","order:write","performance:read"],userCount:1,createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"2",name:"销售专员",description:"销售部门普通成员，负责客户开发和订单处理",departmentId:"2",type:"member",permissions:["customer:read","customer:write","order:read","order:write"],userCount:8,createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"3",name:"审核主管",description:"审核部门负责人，负责订单审核和风险控制",departmentId:"3",type:"manager",permissions:["order:read","order:audit","customer:read","finance:read"],userCount:1,createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"4",name:"财务经理",description:"财务部门负责人，负责财务管理和报表分析",departmentId:"4",type:"manager",permissions:["finance:read","finance:write","finance:audit","finance:report"],userCount:1,createdAt:"2024-01-01",updatedAt:"2024-01-01"}]),K=l(()=>{const e=new Set(H.value.map(e=>e.departmentId)),a=new Set(H.value.flatMap(e=>e.permissions)).size,l=H.value.reduce((e,a)=>e+a.userCount,0);return{totalRoles:H.value.length,departmentsWithRoles:e.size,totalPermissions:a,usersWithRoles:l}}),Q=l(()=>{let e=H.value;if(g.value){const a=g.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(a)||e.description.toLowerCase().includes(a))}return _.value&&(e=e.filter(e=>e.departmentId===_.value)),U.value&&(e=e.filter(e=>e.type===U.value)),e}),X=e=>{const a=s.getDepartmentById(e);return a?.name||"未知部门"},Y=e=>{const a={manager:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",member:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",specialist:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",supervisor:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"};return a[e]||a.member},Z=e=>({manager:x,member:z,specialist:x,supervisor:I}[e]||z),ee=e=>({manager:"danger",member:"primary",specialist:"success",supervisor:"warning"}[e]||"primary"),ae=e=>({manager:"部门负责人",member:"普通成员",specialist:"专员",supervisor:"主管"}[e]||"未知"),le=e=>({"customer:read":"查看客户","customer:write":"编辑客户","order:read":"查看订单","order:write":"编辑订单","order:audit":"审核订单","finance:read":"查看财务","finance:write":"编辑财务","finance:audit":"财务审核","finance:report":"财务报表","performance:read":"查看绩效"}[e]||e),se=()=>{g.value="",_.value="",U.value="",E.success("数据已刷新")},te=()=>{j.value=null,G.value=!1,B.value=!0},ie=e=>{j.value=e,G.value=!0,B.value=!0},ne=e=>{const a=H.value.findIndex(a=>a.id===e.id);a>-1&&(H.value.splice(a,1),E.success("角色删除成功"))},oe=e=>{j.value=e,D.value=!0},de=e=>{j.value=e,R.value=!0},re=()=>{L.value=!0},ue=({action:e,role:a})=>{switch(e){case"edit":ie(a);break;case"copy":console.log("复制角色:",a);break;case"delete":ne(a)}},ce=()=>{B.value=!1,E.success(G.value?"角色更新成功":"角色创建成功")},me=()=>{D.value=!1,E.success("用户分配成功")},pe=()=>{L.value=!1,E.success("批量配置成功")};return V(()=>{}),(e,a)=>{const l=t("el-button"),V=t("el-icon"),x=t("el-col"),I=t("el-row"),z=t("el-input"),E=t("el-option"),J=t("el-select"),H=t("el-radio-button"),ve=t("el-radio-group"),fe=t("el-dropdown-item"),ye=t("el-dropdown-menu"),ge=t("el-dropdown"),he=t("el-tag"),be=t("el-table-column"),_e=t("el-popconfirm"),ke=t("el-table"),Ve=w("loading");return n(),c("div",wl,[r("div",Cl,[a[10]||(a[10]=r("div",{class:"header-left"},[r("h2",{class:"page-title"},"部门角色权限"),r("p",{class:"page-desc"},"管理不同部门的角色权限配置，包括部门负责人、普通成员等角色")],-1)),r("div",xl,[d(l,{type:"primary",icon:u(q),onClick:te,class:"add-btn"},{default:o(()=>[...a[8]||(a[8]=[v(" 新建角色 ",-1)])]),_:1},8,["icon"]),d(l,{icon:u(M),onClick:re,class:"batch-btn"},{default:o(()=>[...a[9]||(a[9]=[v(" 批量配置 ",-1)])]),_:1},8,["icon"])])]),r("div",Il,[d(I,{gutter:20},{default:o(()=>[d(x,{span:6},{default:o(()=>[r("div",zl,[r("div",Ul,[d(V,null,{default:o(()=>[d(u(T))]),_:1})]),r("div",$l,[r("div",El,f(K.value.totalRoles),1),a[11]||(a[11]=r("div",{class:"stat-label"},"总角色数",-1))])])]),_:1}),d(x,{span:6},{default:o(()=>[r("div",Al,[r("div",Ol,[d(V,null,{default:o(()=>[d(u(F))]),_:1})]),r("div",Pl,[r("div",Sl,f(K.value.departmentsWithRoles),1),a[12]||(a[12]=r("div",{class:"stat-label"},"已配置部门",-1))])])]),_:1}),d(x,{span:6},{default:o(()=>[r("div",Bl,[r("div",Dl,[d(V,null,{default:o(()=>[d(u(S))]),_:1})]),r("div",Rl,[r("div",Ll,f(K.value.totalPermissions),1),a[13]||(a[13]=r("div",{class:"stat-label"},"权限总数",-1))])])]),_:1}),d(x,{span:6},{default:o(()=>[r("div",jl,[r("div",ql,[d(V,null,{default:o(()=>[d(u(N))]),_:1})]),r("div",Ml,[r("div",Tl,f(K.value.usersWithRoles),1),a[14]||(a[14]=r("div",{class:"stat-label"},"已分配用户",-1))])])]),_:1})]),_:1})]),r("div",Fl,[d(I,{gutter:20,align:"middle"},{default:o(()=>[d(x,{span:6},{default:o(()=>[d(z,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),placeholder:"搜索角色名称","prefix-icon":u(A),clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),d(x,{span:6},{default:o(()=>[d(J,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=e=>_.value=e),placeholder:"选择部门",clearable:""},{default:o(()=>[d(E,{label:"全部部门",value:""}),(n(!0),c(m,null,p(u(s).departmentList,e=>(n(),i(E,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(x,{span:6},{default:o(()=>[d(J,{modelValue:U.value,"onUpdate:modelValue":a[2]||(a[2]=e=>U.value=e),placeholder:"角色类型",clearable:""},{default:o(()=>[d(E,{label:"全部类型",value:""}),d(E,{label:"部门负责人",value:"manager"}),d(E,{label:"普通成员",value:"member"}),d(E,{label:"专员",value:"specialist"}),d(E,{label:"主管",value:"supervisor"})]),_:1},8,["modelValue"])]),_:1}),d(x,{span:6},{default:o(()=>[d(l,{icon:u(O),onClick:se,class:"refresh-btn"},{default:o(()=>[...a[15]||(a[15]=[v(" 刷新 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1})]),r("div",Nl,[r("div",Wl,[a[18]||(a[18]=r("h3",null,"角色列表",-1)),r("div",Jl,[d(ve,{modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=e=>$.value=e),size:"small"},{default:o(()=>[d(H,{value:"card"},{default:o(()=>[...a[16]||(a[16]=[v("卡片视图",-1)])]),_:1}),d(H,{value:"table"},{default:o(()=>[...a[17]||(a[17]=[v("表格视图",-1)])]),_:1})]),_:1},8,["modelValue"])])]),"card"===$.value?(n(),c("div",Gl,[(n(!0),c(m,null,p(Q.value,e=>(n(),c("div",{key:e.id,class:"role-card",onClick:a=>(e=>{console.log("查看角色:",e)})(e)},[r("div",Kl,[r("div",Ql,[r("div",{class:"role-icon",style:h({background:Y(e.type)})},[d(V,null,{default:o(()=>[(n(),i(b(Z(e.type))))]),_:2},1024)],4),r("div",Xl,[r("h4",Yl,f(e.name),1),r("p",Zl,f(e.description),1)])]),d(ge,{onCommand:ue},{dropdown:o(()=>[d(ye,null,{default:o(()=>[d(fe,{command:{action:"edit",role:e}},{default:o(()=>[...a[19]||(a[19]=[v("编辑",-1)])]),_:1},8,["command"]),d(fe,{command:{action:"copy",role:e}},{default:o(()=>[...a[20]||(a[20]=[v("复制",-1)])]),_:1},8,["command"]),d(fe,{command:{action:"delete",role:e},divided:""},{default:o(()=>[...a[21]||(a[21]=[v("删除",-1)])]),_:1},8,["command"])]),_:2},1024)]),default:o(()=>[d(l,{type:"text",icon:u(W)},null,8,["icon"])]),_:2},1024)]),r("div",es,[r("div",as,[a[22]||(a[22]=r("span",{class:"meta-label"},"所属部门：",-1)),r("span",ls,f(X(e.departmentId)),1)]),r("div",ss,[a[23]||(a[23]=r("span",{class:"meta-label"},"角色类型：",-1)),d(he,{type:ee(e.type),size:"small"},{default:o(()=>[v(f(ae(e.type)),1)]),_:2},1032,["type"])]),r("div",ts,[a[24]||(a[24]=r("span",{class:"meta-label"},"权限数量：",-1)),r("span",is,f(e.permissions.length)+" 项",1)]),r("div",ns,[a[25]||(a[25]=r("span",{class:"meta-label"},"分配用户：",-1)),r("span",os,f(e.userCount)+" 人",1)])]),r("div",ds,[r("div",rs,[a[27]||(a[27]=r("span",null,"主要权限",-1)),d(l,{type:"text",size:"small",onClick:k(a=>de(e),["stop"])},{default:o(()=>[...a[26]||(a[26]=[v(" 查看全部 ",-1)])]),_:1},8,["onClick"])]),r("div",us,[(n(!0),c(m,null,p(e.permissions.slice(0,3),e=>(n(),i(he,{key:e,size:"small",class:"permission-tag"},{default:o(()=>[v(f(le(e)),1)]),_:2},1024))),128)),e.permissions.length>3?(n(),i(he,{key:0,size:"small",type:"info"},{default:o(()=>[v(" +"+f(e.permissions.length-3),1)]),_:2},1024)):y("",!0)])]),r("div",cs,[d(l,{size:"small",type:"primary",onClick:k(a=>ie(e),["stop"])},{default:o(()=>[...a[28]||(a[28]=[v(" 编辑 ",-1)])]),_:1},8,["onClick"]),d(l,{size:"small",type:"success",onClick:k(a=>oe(e),["stop"])},{default:o(()=>[...a[29]||(a[29]=[v(" 分配用户 ",-1)])]),_:1},8,["onClick"])])],8,Hl))),128))])):(n(),c("div",ms,[C((n(),i(ke,{data:Q.value},{default:o(()=>[d(be,{prop:"name",label:"角色名称",width:"200"},{default:o(({row:e})=>[r("div",ps,[r("div",{class:"role-icon-small",style:h({background:Y(e.type)})},[d(V,null,{default:o(()=>[(n(),i(b(Z(e.type))))]),_:2},1024)],4),r("span",null,f(e.name),1)])]),_:1}),d(be,{prop:"departmentId",label:"所属部门",width:"150"},{default:o(({row:e})=>[v(f(X(e.departmentId)),1)]),_:1}),d(be,{prop:"type",label:"角色类型",width:"120"},{default:o(({row:e})=>[d(he,{type:ee(e.type),size:"small"},{default:o(()=>[v(f(ae(e.type)),1)]),_:2},1032,["type"])]),_:1}),d(be,{prop:"permissions",label:"权限数量",width:"100"},{default:o(({row:e})=>[v(f(e.permissions.length)+" 项 ",1)]),_:1}),d(be,{prop:"userCount",label:"分配用户",width:"100"},{default:o(({row:e})=>[v(f(e.userCount)+" 人 ",1)]),_:1}),d(be,{prop:"updatedAt",label:"更新时间",width:"180"},{default:o(({row:e})=>{return[v(f((a=e.updatedAt,new Date(a).toLocaleString("zh-CN"))),1)];var a}),_:1}),d(be,{label:"操作",width:"200",fixed:"right"},{default:o(({row:e})=>[r("div",vs,[d(l,{size:"small",type:"primary",link:"",onClick:a=>ie(e)},{default:o(()=>[...a[30]||(a[30]=[v(" 编辑 ",-1)])]),_:1},8,["onClick"]),d(l,{size:"small",type:"success",link:"",onClick:a=>oe(e)},{default:o(()=>[...a[31]||(a[31]=[v(" 分配用户 ",-1)])]),_:1},8,["onClick"]),d(l,{size:"small",type:"info",link:"",onClick:a=>de(e)},{default:o(()=>[...a[32]||(a[32]=[v(" 权限详情 ",-1)])]),_:1},8,["onClick"]),d(_e,{title:"确定要删除这个角色吗？",onConfirm:a=>ne(e)},{reference:o(()=>[d(l,{size:"small",type:"danger",link:""},{default:o(()=>[...a[33]||(a[33]=[v("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])])]),_:1})]),_:1},8,["data"])),[[Ve,P.value]])]))]),d(Ce,{modelValue:B.value,"onUpdate:modelValue":a[4]||(a[4]=e=>B.value=e),role:j.value,"is-edit":G.value,onSuccess:ce},null,8,["modelValue","role","is-edit"]),d(ta,{modelValue:D.value,"onUpdate:modelValue":a[5]||(a[5]=e=>D.value=e),role:j.value,onSuccess:me},null,8,["modelValue","role"]),d(Ha,{modelValue:R.value,"onUpdate:modelValue":a[6]||(a[6]=e=>R.value=e),role:j.value},null,8,["modelValue","role"]),d(Vl,{modelValue:L.value,"onUpdate:modelValue":a[7]||(a[7]=e=>L.value=e),onSuccess:pe},null,8,["modelValue"])])}}}),[["__scopeId","data-v-63677a32"]]);export{fs as default};
