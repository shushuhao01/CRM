import{u as e,e as a}from"./call-x2JnX9hE.js";import{i as t,L as l}from"./utils-DfI7e5Rl.js";import{U as s,G as r,M as i,a3 as o,T as n,ab as d,F as c,E as u}from"./elementPlus-DxaqjplL.js";import{l as m,r as p,e as f,b as v,ag as h,m as y,q as _,p as g,U as b,S as w,O as x,u as C,T as S,n as D}from"./vendor-BtukhyiH.js";import{_ as R}from"./index-C4IdUW1A.js";const A={class:"call-dashboard"},k={class:"page-header"},O={class:"header-content"},U={class:"page-title"},V={class:"date-filter"},M={class:"metrics-cards"},Y={class:"metric-content"},$={class:"metric-icon total-calls"},j={class:"metric-info"},L={class:"metric-value"},F={class:"metric-content"},E={class:"metric-icon total-duration"},I={class:"metric-info"},T={class:"metric-value"},B={class:"metric-content"},z={class:"metric-icon avg-duration"},N={class:"metric-info"},P={class:"metric-value"},q={class:"metric-content"},G={class:"metric-icon connection-rate"},X={class:"metric-info"},H={class:"metric-value"},J={class:"charts-section"},K={class:"card-header"},Q={class:"staff-statistics"},W={class:"card-header"},Z={class:"time-analysis"},ee=R(m({__name:"Dashboard",setup(m){const R=e(),ee=p([new Date(Date.now()-6048e5).toISOString().split("T")[0],(new Date).toISOString().split("T")[0]]),ae=p(null),te=p("calls"),le=p(""),se=p(!1),re=p(),ie=p(),oe=p(),ne=f(()=>ae.value?.userStats?ae.value.userStats.filter(e=>e.userName.toLowerCase().includes(le.value.toLowerCase())).map(e=>({...e,avgDuration:e.calls>0?e.duration/e.calls:0,department:"销售部"})):[]),de=e=>{if(e<60)return`${e}秒`;const a=Math.floor(e/3600),t=Math.floor(e%3600/60),l=e%60;return a>0?`${a}小时${t}分${l}秒`:`${t}分${l}秒`},ce=(e,a)=>e>=80&&a>=50?"优秀":e>=60&&a>=30?"良好":"待提升",ue=()=>{me()},me=async()=>{try{const[e,a]=ee.value,t=await R.fetchCallStatistics({startDate:e,endDate:a,groupBy:"day"});ae.value=t,await D(),fe()}catch(e){console.error("加载统计数据失败:",e)}},pe=async()=>{try{se.value=!0;const[e,t]=ee.value,l=await a({startDate:e,endDate:t,format:"excel"}),s=new Blob([l.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=window.URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=`通话数据_${e}_${t}.xlsx`,i.click(),window.URL.revokeObjectURL(r),u.success("数据导出成功")}catch(e){console.error("导出失败:",e),u.error("数据导出失败")}finally{se.value=!1}},fe=()=>{ve(),he(),ye()},ve=()=>{if(!re.value||!ae.value?.dailyStats)return;const e=t(re.value),a=ae.value.dailyStats,l={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["通话数","通话时长(分钟)","接通率(%)"]},xAxis:{type:"category",data:a.map(e=>e.date)},yAxis:[{type:"value",name:"通话数/时长",position:"left"},{type:"value",name:"接通率(%)",position:"right",max:100}],series:[{name:"通话数",type:"line",data:a.map(e=>e.calls),smooth:!0,itemStyle:{color:"#409EFF"}},{name:"通话时长(分钟)",type:"line",data:a.map(e=>Math.round(e.duration/60)),smooth:!0,itemStyle:{color:"#67C23A"}},{name:"接通率(%)",type:"line",yAxisIndex:1,data:a.map(e=>e.connectionRate),smooth:!0,itemStyle:{color:"#E6A23C"}}]};e.setOption(l)},he=()=>{if(!ie.value||!ae.value)return;const e=t(ie.value),{totalCalls:a,connectedCalls:l,missedCalls:s}=ae.value,r={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{name:"通话状态",type:"pie",radius:"50%",data:[{value:l,name:"已接通",itemStyle:{color:"#67C23A"}},{value:s,name:"未接听",itemStyle:{color:"#E6A23C"}},{value:a-l-s,name:"失败/拒接",itemStyle:{color:"#F56C6C"}}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};e.setOption(r)},ye=()=>{if(!oe.value)return;const e=t(oe.value),a=[{time:"09:00",calls:15},{time:"10:00",calls:25},{time:"11:00",calls:30},{time:"14:00",calls:35},{time:"15:00",calls:40},{time:"16:00",calls:32},{time:"17:00",calls:28}],s={tooltip:{trigger:"axis"},xAxis:{type:"category",data:a.map(e=>e.time)},yAxis:{type:"value",name:"通话数"},series:[{name:"通话数",type:"bar",data:a.map(e=>e.calls),itemStyle:{color:new l(0,0,0,1,[{offset:0,color:"#83bff6"},{offset:.5,color:"#188df0"},{offset:1,color:"#188df0"}])}}]};e.setOption(s)};return v(async()=>{await me()}),(e,a)=>{const t=h("el-icon"),l=h("el-date-picker"),u=h("el-button"),m=h("el-card"),p=h("el-col"),f=h("el-row"),v=h("el-radio-button"),D=h("el-radio-group"),R=h("el-input"),me=h("el-table-column"),fe=h("el-tag"),ve=h("el-table");return _(),y("div",A,[g("div",k,[g("div",O,[g("h1",U,[b(t,null,{default:x(()=>[b(C(s))]),_:1}),a[3]||(a[3]=w(" 通话数据汇总 ",-1))]),a[4]||(a[4]=g("p",{class:"page-description"},"查看通话统计、呼出时长、拨打个数等详细数据分析",-1))]),g("div",V,[b(l,{modelValue:ee.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ee.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ue},null,8,["modelValue"]),b(u,{onClick:pe,loading:se.value},{default:x(()=>[b(t,null,{default:x(()=>[b(C(r))]),_:1}),a[5]||(a[5]=w(" 导出数据 ",-1))]),_:1},8,["loading"])])]),g("div",M,[b(f,{gutter:20},{default:x(()=>[b(p,{span:6},{default:x(()=>[b(m,{class:"metric-card"},{default:x(()=>[g("div",Y,[g("div",$,[b(t,null,{default:x(()=>[b(C(i))]),_:1})]),g("div",j,[g("div",L,S(ae.value?.totalCalls||0),1),a[6]||(a[6]=g("div",{class:"metric-label"},"总通话数",-1)),a[7]||(a[7]=g("div",{class:"metric-trend"},[g("span",{class:"trend-text"},"较昨日 +12%")],-1))])])]),_:1})]),_:1}),b(p,{span:6},{default:x(()=>[b(m,{class:"metric-card"},{default:x(()=>[g("div",F,[g("div",E,[b(t,null,{default:x(()=>[b(C(o))]),_:1})]),g("div",I,[g("div",T,S(de(ae.value?.totalDuration||0)),1),a[8]||(a[8]=g("div",{class:"metric-label"},"总通话时长",-1)),a[9]||(a[9]=g("div",{class:"metric-trend"},[g("span",{class:"trend-text"},"较昨日 +8%")],-1))])])]),_:1})]),_:1}),b(p,{span:6},{default:x(()=>[b(m,{class:"metric-card"},{default:x(()=>[g("div",B,[g("div",z,[b(t,null,{default:x(()=>[b(C(n))]),_:1})]),g("div",N,[g("div",P,S(de(ae.value?.averageDuration||0)),1),a[10]||(a[10]=g("div",{class:"metric-label"},"平均通话时长",-1)),a[11]||(a[11]=g("div",{class:"metric-trend"},[g("span",{class:"trend-text"},"较昨日 -2%")],-1))])])]),_:1})]),_:1}),b(p,{span:6},{default:x(()=>[b(m,{class:"metric-card"},{default:x(()=>[g("div",q,[g("div",G,[b(t,null,{default:x(()=>[b(C(d))]),_:1})]),g("div",X,[g("div",H,S((ae.value?.connectionRate||0).toFixed(1))+"%",1),a[12]||(a[12]=g("div",{class:"metric-label"},"接通率",-1)),a[13]||(a[13]=g("div",{class:"metric-trend"},[g("span",{class:"trend-text"},"较昨日 +5%")],-1))])])]),_:1})]),_:1})]),_:1})]),g("div",J,[b(f,{gutter:20},{default:x(()=>[b(p,{span:16},{default:x(()=>[b(m,null,{header:x(()=>[g("div",K,[a[17]||(a[17]=g("span",null,"通话趋势分析",-1)),b(D,{modelValue:te.value,"onUpdate:modelValue":a[1]||(a[1]=e=>te.value=e),size:"small"},{default:x(()=>[b(v,{label:"calls"},{default:x(()=>[...a[14]||(a[14]=[w("通话数",-1)])]),_:1}),b(v,{label:"duration"},{default:x(()=>[...a[15]||(a[15]=[w("时长",-1)])]),_:1}),b(v,{label:"rate"},{default:x(()=>[...a[16]||(a[16]=[w("接通率",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:x(()=>[g("div",{ref_key:"trendChartRef",ref:re,style:{height:"300px"}},null,512)]),_:1})]),_:1}),b(p,{span:8},{default:x(()=>[b(m,null,{header:x(()=>[...a[18]||(a[18]=[g("span",null,"通话状态分布",-1)])]),default:x(()=>[g("div",{ref_key:"statusChartRef",ref:ie,style:{height:"300px"}},null,512)]),_:1})]),_:1})]),_:1})]),g("div",Q,[b(m,null,{header:x(()=>[g("div",W,[a[19]||(a[19]=g("span",null,"人员通话统计",-1)),b(R,{modelValue:le.value,"onUpdate:modelValue":a[2]||(a[2]=e=>le.value=e),placeholder:"搜索人员姓名",style:{width:"200px"},clearable:""},{prefix:x(()=>[b(t,null,{default:x(()=>[b(C(c))]),_:1})]),_:1},8,["modelValue"])])]),default:x(()=>[b(ve,{data:ne.value,style:{width:"100%"}},{default:x(()=>[b(me,{prop:"userName",label:"姓名",width:"120"}),b(me,{prop:"department",label:"部门",width:"120"}),b(me,{prop:"calls",label:"通话数",width:"100",sortable:""}),b(me,{prop:"duration",label:"通话时长",width:"120",sortable:""},{default:x(({row:e})=>[w(S(de(e.duration)),1)]),_:1}),b(me,{prop:"connectionRate",label:"接通率",width:"100",sortable:""},{default:x(({row:e})=>[w(S(e.connectionRate.toFixed(1))+"% ",1)]),_:1}),b(me,{prop:"avgDuration",label:"平均时长",width:"120",sortable:""},{default:x(({row:e})=>[w(S(de(e.avgDuration||0)),1)]),_:1}),b(me,{label:"效率评级",width:"120"},{default:x(({row:e})=>{return[b(fe,{type:(a=e.connectionRate,t=e.calls,a>=80&&t>=50?"success":a>=60&&t>=30?"warning":"danger")},{default:x(()=>[w(S(ce(e.connectionRate,e.calls)),1)]),_:2},1032,["type"])];var a,t}),_:1}),b(me,{label:"操作",width:"120"},{default:x(({row:e})=>[b(u,{text:"",size:"small",onClick:a=>{return t=e,void console.log("查看用户详情:",t);var t}},{default:x(()=>[...a[20]||(a[20]=[w(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),g("div",Z,[b(m,null,{header:x(()=>[...a[21]||(a[21]=[g("span",null,"时段通话分析",-1)])]),default:x(()=>[g("div",{ref_key:"timeAnalysisChartRef",ref:oe,style:{height:"250px"}},null,512)]),_:1})])])}}}),[["__scopeId","data-v-bd5d0e70"]]);export{ee as default};
