import{l as e,aA as a,r as l,e as t,w as s,ag as n,m as i,q as o,F as c,U as d,O as u,M as p,Q as r,p as v,a9 as m,T as f,u as y,S as b,b as g,aq as h,P as _}from"./vendor-BtukhyiH.js";import{c as w,_ as k}from"./index-DkAJPKqn.js";import{W as V,e as N,u as x,K as C,F as U,E as D,s as I,C as A,m as z,T,t as S,U as j,H as E,j as M,Z as $,b as F}from"./elementPlus-DxaqjplL.js";import{C as B}from"./CreateTemplateDialog-DU-rKNj1.js";import"./utils-DfI7e5Rl.js";const P={class:"template-select-wrapper"},q={class:"template-option"},R={class:"template-name"},L={class:"template-category"},O={class:"template-content-wrapper"},H={class:"template-info"},K={class:"template-usage"},Q={class:"recipients-wrapper"},W={class:"recipients-actions"},Z={class:"form-tip"},G={key:0,class:"recipients-count"},J={class:"count-number"},X={class:"variables-section"},Y={class:"variables-header"},ee={class:"variables-list"},ae={class:"variable-label"},le={class:"preview-wrapper"},te={class:"preview-info"},se={class:"content-length"},ne={class:"sms-count"},ie={class:"send-settings"},oe={class:"dialog-footer"},ce={class:"footer-info"},de={class:"cost-info"},ue={class:"footer-actions"},pe={class:"customer-search"},re=k(e({__name:"SendSmsDialog",props:{modelValue:{type:Boolean},templates:{default:()=>[]},customers:{default:()=>[]}},emits:["update:modelValue","send","apply-template"],setup(e,{expose:g,emit:h}){const _=e,k=h,I=a(),A=w(I),z=l(),T=l(!1),S=l(!1),j=l(!1),E=l(""),M=l([]),$=l({templateId:"",recipients:"",variables:{},sendImmediately:!0,scheduledTime:null,remark:""}),F={templateId:[{required:!0,message:"请选择短信模板",trigger:"change"}],recipients:[{required:!0,message:"请输入接收人手机号",trigger:"blur"},{validator:(e,a,l)=>{if(!a)return void l(new Error("请输入接收人手机号"));const t=ge(a);if(0===t.length)return void l(new Error("请输入有效的手机号"));const s=t.filter(e=>!he(e.phone));s.length>0?l(new Error(`以下手机号格式不正确: ${s.map(e=>e.phone).join(", ")}`)):l()},trigger:"blur"}]},B=t(()=>$.value.templateId?_.templates.find(e=>e.id===$.value.templateId):null),re=t(()=>{if(!B.value)return[];const e=B.value.content.match(/\{(\w+)\}/g);return e?e.map(e=>e.slice(1,-1)):[]}),ve=t(()=>{if(!B.value)return"";let e=B.value.content;return Object.entries($.value.variables).forEach(([a,l])=>{l&&(e=e.replace(new RegExp(`\\{${a}\\}`,"g"),l))}),e}),me=t(()=>$.value.recipients?ge($.value.recipients).length:0),fe=t(()=>me.value*Math.ceil((ve.value?.length||0)/70)*.1),ye=t(()=>$.value.templateId&&$.value.recipients&&me.value>0&&re.value.every(e=>$.value.variables[e])),be=t(()=>E.value?_.customers.filter(e=>e.name.includes(E.value)||e.phone.includes(E.value)):_.customers);s(()=>_.modelValue,e=>{T.value=e}),s(T,e=>{k("update:modelValue",e),e||Te()}),s(()=>re.value,e=>{$.value.variables={},e.forEach(e=>{$.value.variables[e]=""})},{immediate:!0});const ge=e=>{if(!e)return[];const a=e.split(/[\n,，]/).filter(e=>e.trim()),l=[];return a.forEach(e=>{if((e=e.trim()).includes(":")||e.includes("：")){const[a,t]=e.split(/[:：]/);t&&t.trim()&&l.push({name:a.trim(),phone:t.trim()})}else e&&l.push({phone:e})}),l},he=e=>/^1[3-9]\d{9}$/.test(e),_e=e=>({order:"订单通知",logistics:"物流通知",marketing:"营销推广",service:"客服通知",system:"系统通知"}[e]||e),we=()=>{$.value.variables={},re.value.forEach(e=>{$.value.variables[e]=""})},ke=()=>{k("apply-template"),A.push("/system/sms-templates")},Ve=()=>{D.info("导入联系人功能开发中")},Ne=()=>{j.value=!0},xe=e=>{M.value=e},Ce=()=>{const e=M.value.map(e=>`${e.name}:${e.phone}`).join("\n");$.value.recipients?$.value.recipients+="\n"+e:$.value.recipients=e,j.value=!1,M.value=[],D.success(`已添加 ${M.value.length} 个客户`)},Ue=()=>{D.info("批量填充变量功能开发中")},De=e=>e.getTime()<Date.now()-864e5,Ie=()=>{const e=new Date,a=[];for(let l=0;l<e.getHours();l++)a.push(l);return a},Ae=async()=>{try{await(z.value?.validate());const e=ge($.value.recipients),a={templateId:$.value.templateId,template:B.value,recipients:e,variables:$.value.variables,content:ve.value,sendImmediately:$.value.sendImmediately,scheduledTime:$.value.scheduledTime,remark:$.value.remark,estimatedCost:fe.value};S.value=!0,await new Promise(e=>setTimeout(e,2e3)),k("send",a),D.success($.value.sendImmediately?"短信发送成功":"定时发送任务已创建"),ze()}catch(e){console.error("发送失败:",e)}finally{S.value=!1}},ze=()=>{T.value=!1},Te=()=>{$.value={templateId:"",recipients:"",variables:{},sendImmediately:!0,scheduledTime:null,remark:""},z.value?.resetFields()};return g({resetForm:Te}),(a,l)=>{const t=n("el-option"),s=n("el-select"),g=n("el-button"),h=n("el-form-item"),_=n("el-input"),w=n("el-tag"),k=n("el-icon"),D=n("el-checkbox"),I=n("el-date-picker"),A=n("el-form"),ge=n("el-dialog"),he=n("el-table-column"),Te=n("el-table");return o(),i(c,null,[d(ge,{modelValue:T.value,"onUpdate:modelValue":l[5]||(l[5]=e=>T.value=e),title:"发送短信",width:"700px","before-close":ze,class:"send-sms-dialog"},{footer:u(()=>[v("div",oe,[v("div",ce,[v("span",de,"预计费用: ¥"+f(fe.value.toFixed(2)),1)]),v("div",ue,[d(g,{onClick:ze},{default:u(()=>[...l[18]||(l[18]=[b("取消",-1)])]),_:1}),d(g,{type:"primary",onClick:Ae,loading:S.value,disabled:!ye.value},{default:u(()=>[b(f($.value.sendImmediately?"立即发送":"定时发送"),1)]),_:1},8,["loading","disabled"])])])]),default:u(()=>[d(A,{model:$.value,rules:F,ref_key:"formRef",ref:z,"label-width":"100px",class:"send-form"},{default:u(()=>[d(h,{label:"选择模板",prop:"templateId"},{default:u(()=>[v("div",P,[d(s,{modelValue:$.value.templateId,"onUpdate:modelValue":l[0]||(l[0]=e=>$.value.templateId=e),placeholder:"请选择短信模板",style:{flex:"1"},onChange:we,filterable:""},{default:u(()=>[(o(!0),i(c,null,m(e.templates,e=>(o(),p(t,{key:e.id,label:e.name,value:e.id},{default:u(()=>[v("div",q,[v("div",R,f(e.name),1),v("div",L,f(_e(e.category)),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),d(g,{type:"primary",icon:y(V),onClick:ke,class:"apply-template-btn",title:"申请新模板"},{default:u(()=>[...l[9]||(l[9]=[b(" 申请模板 ",-1)])]),_:1},8,["icon"])])]),_:1}),B.value?(o(),p(h,{key:0,label:"模板内容"},{default:u(()=>[v("div",O,[d(_,{value:B.value.content,type:"textarea",rows:3,readonly:"",class:"template-content"},null,8,["value"]),v("div",H,[d(w,{size:"small",type:"info"},{default:u(()=>[b(f(_e(B.value.category)),1)]),_:1}),v("span",K,"使用次数: "+f(B.value.usage||0),1)])])]),_:1})):r("",!0),d(h,{label:"接收人",prop:"recipients"},{default:u(()=>[v("div",Q,[d(_,{modelValue:$.value.recipients,"onUpdate:modelValue":l[1]||(l[1]=e=>$.value.recipients=e),type:"textarea",rows:4,placeholder:"请输入手机号，多个号码用换行或逗号分隔\n支持格式：\n13800138001\n13800138002,13800138003\n张三:13800138001",class:"recipients-input"},null,8,["modelValue"]),v("div",W,[d(g,{size:"small",icon:y(N),onClick:Ve},{default:u(()=>[...l[10]||(l[10]=[b(" 导入联系人 ",-1)])]),_:1},8,["icon"]),d(g,{size:"small",icon:y(x),onClick:Ne},{default:u(()=>[...l[11]||(l[11]=[b(" 选择客户 ",-1)])]),_:1},8,["icon"])])]),v("div",Z,[d(k,null,{default:u(()=>[d(y(C))]),_:1}),l[12]||(l[12]=b(" 支持批量输入，每行一个手机号或用逗号分隔，可包含姓名（格式：姓名:手机号） ",-1))]),me.value>0?(o(),i("div",G,[l[13]||(l[13]=b(" 已输入 ",-1)),v("span",J,f(me.value),1),l[14]||(l[14]=b(" 个接收人 ",-1))])):r("",!0)]),_:1}),re.value.length>0?(o(),p(h,{key:1,label:"模板变量"},{default:u(()=>[v("div",X,[v("div",Y,[l[16]||(l[16]=v("span",{class:"variables-title"},"请填写模板中的变量值：",-1)),d(g,{size:"small",type:"primary",link:"",onClick:Ue},{default:u(()=>[...l[15]||(l[15]=[b(" 批量填充 ",-1)])]),_:1})]),v("div",ee,[(o(!0),i(c,null,m(re.value,e=>(o(),i("div",{key:e,class:"variable-item"},[v("label",ae,f(e)+":",1),d(_,{modelValue:$.value.variables[e],"onUpdate:modelValue":a=>$.value.variables[e]=a,placeholder:`请输入${e}的值`,class:"variable-input"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])])]),_:1})):r("",!0),ve.value?(o(),p(h,{key:2,label:"预览内容"},{default:u(()=>[v("div",le,[d(_,{value:ve.value,type:"textarea",rows:3,readonly:"",class:"preview-content"},null,8,["value"]),v("div",te,[v("span",se,"内容长度: "+f(ve.value.length)+" 字符",1),v("span",ne,"预计短信条数: "+f(Math.ceil(ve.value.length/70)),1)])])]),_:1})):r("",!0),d(h,{label:"发送设置"},{default:u(()=>[v("div",ie,[d(D,{modelValue:$.value.sendImmediately,"onUpdate:modelValue":l[2]||(l[2]=e=>$.value.sendImmediately=e)},{default:u(()=>[...l[17]||(l[17]=[b("立即发送",-1)])]),_:1},8,["modelValue"]),$.value.sendImmediately?r("",!0):(o(),p(I,{key:0,modelValue:$.value.scheduledTime,"onUpdate:modelValue":l[3]||(l[3]=e=>$.value.scheduledTime=e),type:"datetime",placeholder:"选择发送时间","disabled-date":De,"disabled-hours":Ie,style:{"margin-left":"20px"}},null,8,["modelValue"]))])]),_:1}),d(h,{label:"备注说明"},{default:u(()=>[d(_,{modelValue:$.value.remark,"onUpdate:modelValue":l[4]||(l[4]=e=>$.value.remark=e),type:"textarea",rows:2,placeholder:"可选：添加发送备注说明",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),d(ge,{modelValue:j.value,"onUpdate:modelValue":l[8]||(l[8]=e=>j.value=e),title:"选择客户",width:"800px",class:"customer-select-dialog"},{footer:u(()=>[d(g,{onClick:l[7]||(l[7]=e=>j.value=!1)},{default:u(()=>[...l[19]||(l[19]=[b("取消",-1)])]),_:1}),d(g,{type:"primary",onClick:Ce,disabled:0===M.value.length},{default:u(()=>[b(" 确定选择 ("+f(M.value.length)+") ",1)]),_:1},8,["disabled"])]),default:u(()=>[v("div",pe,[d(_,{modelValue:E.value,"onUpdate:modelValue":l[6]||(l[6]=e=>E.value=e),placeholder:"搜索客户姓名或手机号","prefix-icon":y(U),clearable:"",style:{width:"300px"}},null,8,["modelValue","prefix-icon"])]),d(Te,{data:be.value,onSelectionChange:xe,"max-height":"400",style:{"margin-top":"20px"}},{default:u(()=>[d(he,{type:"selection",width:"55"}),d(he,{prop:"name",label:"客户姓名",width:"120"}),d(he,{prop:"phone",label:"手机号",width:"140"}),d(he,{prop:"company",label:"公司"}),d(he,{prop:"tags",label:"标签",width:"150"},{default:u(({row:e})=>[(o(!0),i(c,null,m(e.tags?.slice(0,2),e=>(o(),p(w,{key:e,size:"small",style:{"margin-right":"5px"}},{default:u(()=>[b(f(e),1)]),_:2},1024))),128))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-f9216305"]]),ve={class:"sms-management"},me={class:"page-header"},fe={class:"header-actions"},ye={class:"stats-overview"},be={class:"stat-content"},ge={class:"stat-icon"},he={class:"stat-info"},_e={class:"stat-number"},we={class:"stat-content"},ke={class:"stat-icon"},Ve={class:"stat-info"},Ne={class:"stat-number"},xe={class:"stat-content"},Ce={class:"stat-icon"},Ue={class:"stat-info"},De={class:"stat-number"},Ie={class:"stat-content"},Ae={class:"stat-icon"},ze={class:"stat-info"},Te={class:"stat-number"},Se={class:"tab-label"},je={class:"tab-header"},Ee={class:"tab-actions"},Me={class:"templates-list"},$e={class:"template-info"},Fe={class:"template-header"},Be={class:"template-name"},Pe={class:"template-meta"},qe={class:"apply-time"},Re={class:"template-content"},Le={class:"content-text"},Oe={key:0,class:"variables"},He={key:0,class:"template-description"},Ke={class:"desc-text"},Qe={class:"applicant-info"},We={class:"applicant-name"},Ze={class:"applicant-dept"},Ge={class:"template-actions"},Je={class:"tab-header"},Xe={class:"tab-actions"},Ye={class:"templates-list"},ea={class:"template-info"},aa={class:"template-header"},la={class:"template-name"},ta={class:"template-meta"},sa={class:"approve-time"},na={class:"template-content"},ia={class:"content-text"},oa={class:"approval-info"},ca={class:"approval-name"},da={class:"approval-time"},ua={class:"template-actions"},pa={class:"tab-label"},ra={class:"tab-header"},va={class:"tab-actions"},ma={class:"sms-list"},fa={class:"sms-info"},ya={class:"sms-header"},ba={class:"sms-title"},ga={class:"sms-meta"},ha={class:"apply-time"},_a={class:"sms-content"},wa={class:"content-text"},ka={class:"recipients"},Va={class:"recipients-count"},Na={class:"applicant-info"},xa={class:"applicant-name"},Ca={class:"applicant-dept"},Ua={class:"sms-actions"},Da={class:"tab-header"},Ia={class:"tab-actions"},Aa={class:"sms-list"},za={class:"sms-info"},Ta={class:"sms-header"},Sa={class:"sms-title"},ja={class:"sms-meta"},Ea={class:"approve-time"},Ma={class:"sms-content"},$a={class:"content-text"},Fa={class:"recipients"},Ba={class:"recipients-count"},Pa={class:"approval-info"},qa={class:"approval-name"},Ra={class:"approval-time"},La={class:"sms-actions"},Oa={class:"tab-header"},Ha={class:"tab-actions"},Ka={key:0,class:"template-preview-content"},Qa={class:"template-content-section"},Wa={class:"content-display"},Za={key:0,class:"variables-section"},Ga={class:"variables-list"},Ja={class:"preview-section"},Xa={class:"preview-content"},Ya={key:0,class:"sms-detail-content"},el={class:"sms-content-section"},al={class:"content-display"},ll={key:0,class:"recipients-section"},tl={class:"recipients-list"},sl={key:0,class:"more-recipients"},nl={key:1,class:"remark-section"},il={class:"remark-content"},ol={key:0,class:"record-detail-content"},cl={class:"record-content-section"},dl={class:"content-display"},ul={class:"send-details-section"},pl=k(e({__name:"SmsManagement",setup(e){const s=a(),k=w(s),V=l("templates"),N=l("pending"),x=l("pending"),C=l(""),P=l(""),q=l(""),R=l(""),L=l(""),O=l([]),H=l(!1),K=l(!1),Q=l(!1),W=l(!1),Z=l(!1),G=l(!1),J=l(!1),X=l(!1),Y=l(!1),ee=l(!1),ae=l(null),le=l(null),te=l(null),se=l({pendingTemplates:0,pendingSms:0,todaySent:0,totalSent:0}),ne=l([]),ie=l([]),oe=l([]),ce=l([]),de=l([]),ue=t(()=>ne.value.length),pe=t(()=>oe.value.length),pl=t(()=>C.value?ne.value.filter(e=>e.name.includes(C.value)||e.applicantName.includes(C.value)):ne.value),rl=t(()=>P.value?ie.value.filter(e=>e.name.includes(P.value)):ie.value),vl=t(()=>q.value?oe.value.filter(e=>e.templateName.includes(q.value)||e.content.includes(q.value)||e.applicantName.includes(q.value)):oe.value),ml=t(()=>R.value?ce.value.filter(e=>e.templateName.includes(R.value)||e.content.includes(R.value)):ce.value),fl=t(()=>L.value?de.value.filter(e=>e.templateName.includes(L.value)||e.content.includes(L.value)):de.value),yl=()=>{G.value=!0},bl=()=>{J.value=!0},gl=()=>{k.push("/system/sms-templates")},hl=e=>{console.log("模板提交数据:",e),"apply"===e.mode&&ne.value.unshift({id:Date.now().toString(),name:e.name,category:e.category,content:e.content,variables:e.variables,description:e.description,applicantName:"当前用户",applicantDept:"当前部门",createdAt:(new Date).toLocaleString()}),G.value=!1},_l=e=>{console.log("短信发送数据:",e),J.value=!1},wl=e=>{ae.value=e,X.value=!0},kl=e=>{le.value=e,Y.value=!0},Vl=e=>{if(!e||!e.content)return"";let a=e.content;const l={orderNo:"ORD20240115001",deliveryTime:"2024-01-16 14:00",trackingNo:"SF1234567890",customerName:"张先生",amount:"299.00",productName:"商品名称",companyName:"公司名称",phone:"138****8888",code:"123456"};return e.variables&&e.variables.forEach(e=>{const t=e.replace(/[{}]/g,""),s=l[t]||`[${t}]`;a=a.replace(new RegExp(`\\${e}`,"g"),s)}),a},Nl=e=>({order:"订单通知",logistics:"物流通知",marketing:"营销推广",service:"客服通知"}[e]||e),xl=e=>({completed:"success",failed:"danger",sending:"warning"}[e]||"info"),Cl=e=>({completed:"发送完成",failed:"发送失败",sending:"发送中"}[e]||e);g(()=>{Ul()});const Ul=()=>{ie.value=[{id:1,name:"客户回访模板",category:"service",content:"尊敬的{customerName}，感谢您对我们产品的支持，我们将为您提供更好的服务。如有任何问题，请联系我们：{phone}",variables:["customerName","phone"],status:"approved",usage:156},{id:2,name:"促销活动模板",category:"marketing",content:"【{companyName}】新年大促销！全场商品{discount}折起，活动时间：{startDate}至{endDate}，详情咨询客服。",variables:["companyName","discount","startDate","endDate"],status:"approved",usage:89},{id:3,name:"验证码模板",category:"verification",content:"您的验证码是：{code}，请在{minutes}分钟内使用，请勿泄露给他人。",variables:["code","minutes"],status:"approved",usage:1234},{id:4,name:"订单确认通知",category:"notification",content:"【{companyName}】您的订单{orderNo}已确认，商品：{productName}，金额：{amount}元，预计{deliveryDate}发货。",variables:["companyName","orderNo","productName","amount","deliveryDate"],status:"approved",usage:892},{id:5,name:"发货通知模板",category:"notification",content:"【{companyName}】您的订单{orderNo}已发货，快递单号：{trackingNo}，请注意查收。物流查询：{trackingUrl}",variables:["companyName","orderNo","trackingNo","trackingUrl"],status:"approved",usage:756},{id:6,name:"付款提醒模板",category:"notification",content:"尊敬的{customerName}，您的订单{orderNo}待付款，金额{amount}元，请及时完成支付。如有疑问请联系客服。",variables:["customerName","orderNo","amount"],status:"approved",usage:423},{id:7,name:"会议通知模板",category:"notification",content:"【会议通知】{meetingTitle}将于{meetingDate} {meetingTime}在{location}举行，请准时参加。联系人：{contact}",variables:["meetingTitle","meetingDate","meetingTime","location","contact"],status:"approved",usage:234},{id:8,name:"生日祝福模板",category:"marketing",content:"亲爱的{customerName}，今天是您的生日，{companyName}全体员工祝您生日快乐！特为您准备了生日礼品，请到店领取。",variables:["customerName","companyName"],status:"approved",usage:67},{id:9,name:"服务预约确认",category:"service",content:"【{companyName}】您预约的{serviceName}服务已确认，时间：{appointmentDate} {appointmentTime}，地址：{address}，联系电话：{phone}",variables:["companyName","serviceName","appointmentDate","appointmentTime","address","phone"],status:"approved",usage:345},{id:10,name:"账户余额提醒",category:"notification",content:"【{companyName}】您的账户余额为{balance}元，余额不足可能影响服务使用，请及时充值。充值热线：{phone}",variables:["companyName","balance","phone"],status:"approved",usage:178},{id:11,name:"密码重置通知",category:"notification",content:"【{companyName}】您的账户密码已重置，新密码：{newPassword}，请及时登录修改。如非本人操作，请联系客服：{phone}",variables:["companyName","newPassword","phone"],status:"approved",usage:89},{id:12,name:"活动邀请模板",category:"marketing",content:"【{companyName}】诚邀您参加{eventName}，时间：{eventDate}，地点：{venue}。精彩活动，丰厚奖品等您来！报名电话：{phone}",variables:["companyName","eventName","eventDate","venue","phone"],status:"approved",usage:123}]};return(e,a)=>{const l=n("el-icon"),t=n("el-button"),s=n("el-card"),g=n("el-col"),w=n("el-row"),k=n("el-badge"),de=n("el-input"),Ul=n("el-tag"),Dl=n("el-empty"),Il=n("el-tab-pane"),Al=n("el-tabs"),zl=n("el-date-picker"),Tl=n("el-table-column"),Sl=n("el-table"),jl=n("el-descriptions-item"),El=n("el-descriptions"),Ml=n("el-dialog"),$l=h("loading");return o(),i("div",ve,[v("div",me,[a[20]||(a[20]=v("div",{class:"header-left"},[v("h2",{class:"page-title"},"短信管理"),v("p",{class:"page-description"},"管理短信模板和发送记录，审核短信申请")],-1)),v("div",fe,[d(t,{type:"info",onClick:gl},{default:u(()=>[d(l,null,{default:u(()=>[d(y(I))]),_:1}),a[17]||(a[17]=b(" 模板管理 ",-1))]),_:1}),d(t,{type:"primary",onClick:yl},{default:u(()=>[d(l,null,{default:u(()=>[d(y(A))]),_:1}),a[18]||(a[18]=b(" 创建短信模板 ",-1))]),_:1}),d(t,{type:"success",onClick:bl},{default:u(()=>[d(l,null,{default:u(()=>[d(y(z))]),_:1}),a[19]||(a[19]=b(" 发送短信 ",-1))]),_:1})])]),v("div",ye,[d(w,{gutter:20},{default:u(()=>[d(g,{span:6},{default:u(()=>[d(s,{class:"stat-card pending"},{default:u(()=>[v("div",be,[v("div",ge,[d(l,null,{default:u(()=>[d(y(T))]),_:1})]),v("div",he,[v("div",_e,f(se.value.pendingTemplates),1),a[21]||(a[21]=v("div",{class:"stat-label"},"待审核模板",-1))])])]),_:1})]),_:1}),d(g,{span:6},{default:u(()=>[d(s,{class:"stat-card sms"},{default:u(()=>[v("div",we,[v("div",ke,[d(l,null,{default:u(()=>[d(y(z))]),_:1})]),v("div",Ve,[v("div",Ne,f(se.value.pendingSms),1),a[22]||(a[22]=v("div",{class:"stat-label"},"待审核短信",-1))])])]),_:1})]),_:1}),d(g,{span:6},{default:u(()=>[d(s,{class:"stat-card today"},{default:u(()=>[v("div",xe,[v("div",Ce,[d(l,null,{default:u(()=>[d(y(S))]),_:1})]),v("div",Ue,[v("div",De,f(se.value.todaySent),1),a[23]||(a[23]=v("div",{class:"stat-label"},"今日发送",-1))])])]),_:1})]),_:1}),d(g,{span:6},{default:u(()=>[d(s,{class:"stat-card total"},{default:u(()=>[v("div",Ie,[v("div",Ae,[d(l,null,{default:u(()=>[d(y(j))]),_:1})]),v("div",ze,[v("div",Te,f(se.value.totalSent),1),a[24]||(a[24]=v("div",{class:"stat-label"},"总发送量",-1))])])]),_:1})]),_:1})]),_:1})]),d(s,{class:"main-content"},{default:u(()=>[d(Al,{modelValue:V.value,"onUpdate:modelValue":a[8]||(a[8]=e=>V.value=e),class:"sms-tabs"},{default:u(()=>[d(Il,{name:"templates"},{label:u(()=>[v("span",Se,[a[25]||(a[25]=b(" 模板审核 ",-1)),d(k,{value:ue.value,hidden:0===ue.value},null,8,["value","hidden"])])]),default:u(()=>[d(Al,{modelValue:N.value,"onUpdate:modelValue":a[2]||(a[2]=e=>N.value=e),type:"card",class:"sub-tabs"},{default:u(()=>[d(Il,{label:"待审核",name:"pending"},{default:u(()=>[v("div",je,[v("div",Ee,[d(de,{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),placeholder:"搜索模板名称、申请人","prefix-icon":y(U),clearable:"",style:{width:"300px"}},null,8,["modelValue","prefix-icon"])])]),_((o(),i("div",Me,[(o(!0),i(c,null,m(pl.value,e=>(o(),i("div",{key:e.id,class:"template-item"},[v("div",$e,[v("div",Fe,[v("h4",Be,f(e.name),1),v("div",Pe,[d(Ul,{size:"small",type:"info"},{default:u(()=>[b(f(Nl(e.category)),1)]),_:2},1024),v("span",qe,f(e.createdAt),1)])]),v("div",Re,[v("p",Le,f(e.content),1),e.variables?.length?(o(),i("div",Oe,[a[26]||(a[26]=v("span",{class:"variables-label"},"变量：",-1)),(o(!0),i(c,null,m(e.variables,e=>(o(),p(Ul,{key:e,size:"small",class:"variable-tag"},{default:u(()=>[b(f(e),1)]),_:2},1024))),128))])):r("",!0)]),e.description?(o(),i("div",He,[a[27]||(a[27]=v("span",{class:"desc-label"},"申请说明：",-1)),v("p",Ke,f(e.description),1)])):r("",!0),v("div",Qe,[a[28]||(a[28]=v("span",{class:"applicant-label"},"申请人：",-1)),v("span",We,f(e.applicantName),1),v("span",Ze,f(e.applicantDept),1)])]),v("div",Ge,[d(t,{type:"success",icon:y(E),onClick:a=>(async e=>{try{await F.confirm("确认通过此模板申请？","确认操作",{type:"warning"});const a=ne.value.findIndex(a=>a.id===e.id);a>-1&&(ne.value.splice(a,1),ie.value.unshift({...e,approvedBy:"当前用户",approvedAt:(new Date).toLocaleString()})),D.success("模板审核通过")}catch{}})(e),class:"approve-btn"},{default:u(()=>[...a[29]||(a[29]=[b(" 通过 ",-1)])]),_:1},8,["icon","onClick"]),d(t,{type:"danger",icon:y(M),onClick:a=>(async e=>{try{await F.confirm("确认拒绝此模板申请？","确认操作",{type:"warning"});const a=ne.value.findIndex(a=>a.id===e.id);a>-1&&ne.value.splice(a,1),D.success("模板申请已拒绝")}catch{}})(e),class:"reject-btn"},{default:u(()=>[...a[30]||(a[30]=[b(" 拒绝 ",-1)])]),_:1},8,["icon","onClick"]),d(t,{type:"info",icon:y($),onClick:a=>wl(e),class:"preview-btn"},{default:u(()=>[...a[31]||(a[31]=[b(" 预览 ",-1)])]),_:1},8,["icon","onClick"])])]))),128)),0!==pl.value.length||H.value?r("",!0):(o(),p(Dl,{key:0,description:"暂无待审核模板","image-size":120}))])),[[$l,H.value]])]),_:1}),d(Il,{label:"审核通过",name:"approved"},{default:u(()=>[v("div",Je,[v("div",Xe,[d(de,{modelValue:P.value,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value=e),placeholder:"搜索已通过模板","prefix-icon":y(U),clearable:"",style:{width:"300px"}},null,8,["modelValue","prefix-icon"])])]),_((o(),i("div",Ye,[(o(!0),i(c,null,m(rl.value,e=>(o(),i("div",{key:e.id,class:"template-item approved"},[v("div",ea,[v("div",aa,[v("h4",la,f(e.name),1),v("div",ta,[d(Ul,{size:"small",type:"success"},{default:u(()=>[...a[32]||(a[32]=[b("已通过",-1)])]),_:1}),d(Ul,{size:"small",type:"info"},{default:u(()=>[b(f(Nl(e.category)),1)]),_:2},1024),v("span",sa,f(e.approvedAt),1)])]),v("div",na,[v("p",ia,f(e.content),1)]),v("div",oa,[a[33]||(a[33]=v("span",{class:"approval-label"},"审核人：",-1)),v("span",ca,f(e.approvedBy),1),v("span",da,f(e.approvedAt),1)])]),v("div",ua,[d(t,{type:"primary",icon:y($),onClick:a=>wl(e),size:"small"},{default:u(()=>[...a[34]||(a[34]=[b(" 查看 ",-1)])]),_:1},8,["icon","onClick"])])]))),128)),0!==rl.value.length||K.value?r("",!0):(o(),p(Dl,{key:0,description:"暂无已通过模板","image-size":120}))])),[[$l,K.value]])]),_:1})]),_:1},8,["modelValue"])]),_:1}),d(Il,{name:"sms"},{label:u(()=>[v("span",pa,[a[35]||(a[35]=b(" 短信审核 ",-1)),d(k,{value:pe.value,hidden:0===pe.value},null,8,["value","hidden"])])]),default:u(()=>[d(Al,{modelValue:x.value,"onUpdate:modelValue":a[5]||(a[5]=e=>x.value=e),type:"card",class:"sub-tabs"},{default:u(()=>[d(Il,{label:"待审核",name:"pending"},{default:u(()=>[v("div",ra,[v("div",va,[d(de,{modelValue:q.value,"onUpdate:modelValue":a[3]||(a[3]=e=>q.value=e),placeholder:"搜索短信内容、申请人","prefix-icon":y(U),clearable:"",style:{width:"300px"}},null,8,["modelValue","prefix-icon"])])]),_((o(),i("div",ma,[(o(!0),i(c,null,m(vl.value,e=>(o(),i("div",{key:e.id,class:"sms-item"},[v("div",fa,[v("div",ya,[v("h4",ba,f(e.templateName),1),v("div",ga,[d(Ul,{size:"small",type:"warning"},{default:u(()=>[...a[36]||(a[36]=[b("待审核",-1)])]),_:1}),v("span",ha,f(e.createdAt),1)])]),v("div",_a,[v("p",wa,f(e.content),1),v("div",ka,[a[37]||(a[37]=v("span",{class:"recipients-label"},"发送对象：",-1)),v("span",Va,f(e.recipients?.length||0)+" 人",1)])]),v("div",Na,[a[38]||(a[38]=v("span",{class:"applicant-label"},"申请人：",-1)),v("span",xa,f(e.applicantName),1),v("span",Ca,f(e.applicantDept),1)])]),v("div",Ua,[d(t,{type:"success",icon:y(E),onClick:a=>(async e=>{try{await F.confirm("确认通过此短信发送申请？","确认操作",{type:"warning"});const a=oe.value.findIndex(a=>a.id===e.id);a>-1&&(oe.value.splice(a,1),ce.value.unshift({...e,approvedBy:"当前用户",approvedAt:(new Date).toLocaleString()})),D.success("短信发送申请已通过")}catch{}})(e),class:"approve-btn"},{default:u(()=>[...a[39]||(a[39]=[b(" 通过 ",-1)])]),_:1},8,["icon","onClick"]),d(t,{type:"danger",icon:y(M),onClick:a=>(async e=>{try{await F.confirm("确认拒绝此短信发送申请？","确认操作",{type:"warning"});const a=oe.value.findIndex(a=>a.id===e.id);a>-1&&oe.value.splice(a,1),D.success("短信发送申请已拒绝")}catch{}})(e),class:"reject-btn"},{default:u(()=>[...a[40]||(a[40]=[b(" 拒绝 ",-1)])]),_:1},8,["icon","onClick"]),d(t,{type:"info",icon:y($),onClick:a=>kl(e),class:"preview-btn"},{default:u(()=>[...a[41]||(a[41]=[b(" 详情 ",-1)])]),_:1},8,["icon","onClick"])])]))),128)),0!==vl.value.length||Q.value?r("",!0):(o(),p(Dl,{key:0,description:"暂无待审核短信","image-size":120}))])),[[$l,Q.value]])]),_:1}),d(Il,{label:"审核通过",name:"approved"},{default:u(()=>[v("div",Da,[v("div",Ia,[d(de,{modelValue:R.value,"onUpdate:modelValue":a[4]||(a[4]=e=>R.value=e),placeholder:"搜索已通过短信","prefix-icon":y(U),clearable:"",style:{width:"300px"}},null,8,["modelValue","prefix-icon"])])]),_((o(),i("div",Aa,[(o(!0),i(c,null,m(ml.value,e=>(o(),i("div",{key:e.id,class:"sms-item approved"},[v("div",za,[v("div",Ta,[v("h4",Sa,f(e.templateName),1),v("div",ja,[d(Ul,{size:"small",type:"success"},{default:u(()=>[...a[42]||(a[42]=[b("已通过",-1)])]),_:1}),v("span",Ea,f(e.approvedAt),1)])]),v("div",Ma,[v("p",$a,f(e.content),1),v("div",Fa,[a[43]||(a[43]=v("span",{class:"recipients-label"},"发送对象：",-1)),v("span",Ba,f(e.recipients?.length||0)+" 人",1)])]),v("div",Pa,[a[44]||(a[44]=v("span",{class:"approval-label"},"审核人：",-1)),v("span",qa,f(e.approvedBy),1),v("span",Ra,f(e.approvedAt),1)])]),v("div",La,[d(t,{type:"primary",icon:y($),onClick:a=>kl(e),size:"small"},{default:u(()=>[...a[45]||(a[45]=[b(" 查看 ",-1)])]),_:1},8,["icon","onClick"])])]))),128)),0!==ml.value.length||W.value?r("",!0):(o(),p(Dl,{key:0,description:"暂无已通过短信","image-size":120}))])),[[$l,W.value]])]),_:1})]),_:1},8,["modelValue"])]),_:1}),d(Il,{label:"发送记录",name:"records"},{default:u(()=>[v("div",Oa,[v("div",Ha,[d(zl,{modelValue:O.value,"onUpdate:modelValue":a[6]||(a[6]=e=>O.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{"margin-right":"10px"}},null,8,["modelValue"]),d(de,{modelValue:L.value,"onUpdate:modelValue":a[7]||(a[7]=e=>L.value=e),placeholder:"搜索发送记录","prefix-icon":y(U),clearable:"",style:{width:"300px"}},null,8,["modelValue","prefix-icon"])])]),_((o(),p(Sl,{data:fl.value},{default:u(()=>[d(Tl,{prop:"templateName",label:"模板名称"}),d(Tl,{prop:"content",label:"短信内容","show-overflow-tooltip":""}),d(Tl,{prop:"recipientCount",label:"发送数量",width:"100"}),d(Tl,{prop:"successCount",label:"成功数量",width:"100"}),d(Tl,{prop:"failCount",label:"失败数量",width:"100"}),d(Tl,{prop:"status",label:"状态",width:"100"},{default:u(({row:e})=>[d(Ul,{type:xl(e.status)},{default:u(()=>[b(f(Cl(e.status)),1)]),_:2},1032,["type"])]),_:1}),d(Tl,{prop:"sentAt",label:"发送时间",width:"180"},{default:u(({row:e})=>[b(f(e.sentAt),1)]),_:1}),d(Tl,{label:"操作",width:"120"},{default:u(({row:e})=>[d(t,{type:"primary",size:"small",onClick:a=>{return l=e,te.value={...l,sendDetails:[{phone:"138****8001",status:"success",sentAt:"2024-01-15 10:30:01",errorMsg:""},{phone:"138****8002",status:"success",sentAt:"2024-01-15 10:30:02",errorMsg:""},{phone:"138****8003",status:"failed",sentAt:"2024-01-15 10:30:03",errorMsg:"号码无效"},{phone:"138****8004",status:"success",sentAt:"2024-01-15 10:30:04",errorMsg:""},{phone:"138****8005",status:"failed",sentAt:"2024-01-15 10:30:05",errorMsg:"余额不足"}]},void(ee.value=!0);var l}},{default:u(()=>[...a[46]||(a[46]=[b(" 查看详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[$l,Z.value]])]),_:1})]),_:1},8,["modelValue"])]),_:1}),d(B,{modelValue:G.value,"onUpdate:modelValue":a[9]||(a[9]=e=>G.value=e),mode:"apply",onSubmit:hl},null,8,["modelValue"]),d(re,{modelValue:J.value,"onUpdate:modelValue":a[10]||(a[10]=e=>J.value=e),templates:ie.value,onSubmit:_l},null,8,["modelValue","templates"]),d(Ml,{modelValue:X.value,"onUpdate:modelValue":a[12]||(a[12]=e=>X.value=e),title:"模板预览",width:"600px",class:"template-preview-dialog"},{footer:u(()=>[d(t,{onClick:a[11]||(a[11]=e=>X.value=!1)},{default:u(()=>[...a[50]||(a[50]=[b("关闭",-1)])]),_:1})]),default:u(()=>[ae.value?(o(),i("div",Ka,[d(El,{column:1,border:""},{default:u(()=>[d(jl,{label:"模板名称"},{default:u(()=>[b(f(ae.value.name),1)]),_:1}),d(jl,{label:"模板分类"},{default:u(()=>[b(f(Nl(ae.value.category)),1)]),_:1}),d(jl,{label:"创建时间"},{default:u(()=>[b(f(ae.value.createdAt),1)]),_:1}),d(jl,{label:"申请人"},{default:u(()=>[b(f(ae.value.applicant),1)]),_:1}),d(jl,{label:"审核状态"},{default:u(()=>[d(Ul,{type:"approved"===ae.value.status?"success":"warning"},{default:u(()=>[b(f("approved"===ae.value.status?"已通过":"待审核"),1)]),_:1},8,["type"])]),_:1})]),_:1}),v("div",Qa,[a[47]||(a[47]=v("h4",null,"模板内容：",-1)),v("div",Wa,f(ae.value.content),1)]),ae.value.variables&&ae.value.variables.length>0?(o(),i("div",Za,[a[48]||(a[48]=v("h4",null,"包含变量：",-1)),v("div",Ga,[(o(!0),i(c,null,m(ae.value.variables,e=>(o(),p(Ul,{key:e,class:"variable-tag",type:"info"},{default:u(()=>[b(f(e),1)]),_:2},1024))),128))])])):r("",!0),v("div",Ja,[a[49]||(a[49]=v("h4",null,"预览效果：",-1)),v("div",Xa,f(Vl(ae.value)),1)])])):r("",!0)]),_:1},8,["modelValue"]),d(Ml,{modelValue:Y.value,"onUpdate:modelValue":a[14]||(a[14]=e=>Y.value=e),title:"短信详情",width:"700px",class:"sms-detail-dialog"},{footer:u(()=>[d(t,{onClick:a[13]||(a[13]=e=>Y.value=!1)},{default:u(()=>[...a[54]||(a[54]=[b("关闭",-1)])]),_:1})]),default:u(()=>[le.value?(o(),i("div",Ya,[d(El,{column:2,border:""},{default:u(()=>[d(jl,{label:"模板名称"},{default:u(()=>[b(f(le.value.templateName),1)]),_:1}),d(jl,{label:"申请人"},{default:u(()=>[b(f(le.value.applicant),1)]),_:1}),d(jl,{label:"收件人数量"},{default:u(()=>[b(f(le.value.recipientCount),1)]),_:1}),d(jl,{label:"申请时间"},{default:u(()=>[b(f(le.value.createdAt),1)]),_:1}),d(jl,{label:"审核状态",span:2},{default:u(()=>[d(Ul,{type:"approved"===le.value.status?"success":"warning"},{default:u(()=>[b(f("approved"===le.value.status?"已通过":"待审核"),1)]),_:1},8,["type"])]),_:1})]),_:1}),v("div",el,[a[51]||(a[51]=v("h4",null,"短信内容：",-1)),v("div",al,f(le.value.content),1)]),le.value.recipients&&le.value.recipients.length>0?(o(),i("div",ll,[a[52]||(a[52]=v("h4",null,"收件人列表：",-1)),v("div",tl,[(o(!0),i(c,null,m(le.value.recipients.slice(0,10),(e,a)=>(o(),p(Ul,{key:a,class:"recipient-tag"},{default:u(()=>[b(f(e),1)]),_:2},1024))),128)),le.value.recipients.length>10?(o(),i("span",sl," 等"+f(le.value.recipients.length)+"个收件人 ",1)):r("",!0)])])):r("",!0),le.value.remark?(o(),i("div",nl,[a[53]||(a[53]=v("h4",null,"备注说明：",-1)),v("div",il,f(le.value.remark),1)])):r("",!0)])):r("",!0)]),_:1},8,["modelValue"]),d(Ml,{modelValue:ee.value,"onUpdate:modelValue":a[16]||(a[16]=e=>ee.value=e),title:"发送记录详情",width:"800px",class:"record-detail-dialog"},{footer:u(()=>[d(t,{onClick:a[15]||(a[15]=e=>ee.value=!1)},{default:u(()=>[...a[57]||(a[57]=[b("关闭",-1)])]),_:1})]),default:u(()=>[te.value?(o(),i("div",ol,[d(El,{column:2,border:""},{default:u(()=>[d(jl,{label:"模板名称"},{default:u(()=>[b(f(te.value.templateName),1)]),_:1}),d(jl,{label:"发送状态"},{default:u(()=>[d(Ul,{type:xl(te.value.status)},{default:u(()=>[b(f(Cl(te.value.status)),1)]),_:1},8,["type"])]),_:1}),d(jl,{label:"发送数量"},{default:u(()=>[b(f(te.value.recipientCount),1)]),_:1}),d(jl,{label:"成功数量"},{default:u(()=>[b(f(te.value.successCount),1)]),_:1}),d(jl,{label:"失败数量"},{default:u(()=>[b(f(te.value.failCount),1)]),_:1}),d(jl,{label:"发送时间"},{default:u(()=>[b(f(te.value.sentAt),1)]),_:1})]),_:1}),v("div",cl,[a[55]||(a[55]=v("h4",null,"短信内容：",-1)),v("div",dl,f(te.value.content),1)]),v("div",ul,[a[56]||(a[56]=v("h4",null,"发送详情：",-1)),d(Sl,{data:te.value.sendDetails||[],"max-height":"300"},{default:u(()=>[d(Tl,{prop:"phone",label:"手机号",width:"120"}),d(Tl,{prop:"status",label:"状态",width:"100"},{default:u(({row:e})=>[d(Ul,{type:"success"===e.status?"success":"danger",size:"small"},{default:u(()=>[b(f("success"===e.status?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),d(Tl,{prop:"sentAt",label:"发送时间",width:"150"}),d(Tl,{prop:"errorMsg",label:"失败原因","show-overflow-tooltip":""})]),_:1},8,["data"])])])):r("",!0)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-65ac9a53"]]);export{pl as default};
