const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/uploadService-CL6v6DXe.js","assets/index-C4IdUW1A.js","assets/vendor-BtukhyiH.js","assets/elementPlus-DxaqjplL.js","assets/utils-DfI7e5Rl.js","assets/index-Cj-RrGL6.css","assets/qr-connection-C28yXtL2.js"])))=>i.map(i=>d[i]);
import{a as e,_ as a,u as l,I as t,J as s,r as o,l as n}from"./index-C4IdUW1A.js";import{E as i,b as r,C as c,m as u,T as d,t as p,U as m,F as g,H as f,j as v,Z as y,r as h,A as b,e as _,_ as w,$ as x,aa as S,M as k,s as C,az as V,l as z,ai as A,G as I,aP as T,R as O,k as P,aK as D,a4 as U,Q as N,aQ as E,aC as $,aH as B,aj as R}from"./elementPlus-DxaqjplL.js";import{O as M}from"./aliyun-oss-sdk-DCJ43jeS.js";import{l as L,r as q,Z as F,e as K,b as j,w as J,ag as W,aq as H,m as Q,q as G,p as Z,U as Y,u as X,O as ee,S as ae,T as le,M as te,Q as se,P as oe,F as ne,a9 as ie,J as re,s as ce,z as ue,I as de,n as pe,Y as me}from"./vendor-BtukhyiH.js";import{u as ge}from"./orderFieldConfig-CmLjo1wL.js";import{T as fe,E as ve}from"./style-BM3euvlk.js";import{f as ye,s as he,a as be,b as _e,c as we,d as xe,e as Se,h as ke,i as Ce,g as Ve,j as ze,k as Ae,l as Ie}from"./alternative-connection-BVqgabiQ.js";import"./utils-DfI7e5Rl.js";import"./env-DLalhsF6.js";class Te{static instance;ossClient=null;configStore=e();constructor(){this.initOSSClient()}static getInstance(){return Te.instance||(Te.instance=new Te),Te.instance}async initOSSClient(){try{const e=this.configStore.storageConfig;if("oss"!==e.storageType)return void console.log("当前存储类型不是OSS，跳过初始化");if(!(e.accessKey&&e.secretKey&&e.bucketName&&e.region))return void console.warn("OSS配置不完整，无法初始化客户端");this.ossClient=new M({region:e.region,accessKeyId:e.accessKey,accessKeySecret:e.secretKey,bucket:e.bucketName,endpoint:e.customDomain||void 0,secure:!0,cname:!!e.customDomain})}catch(e){console.error("OSS客户端初始化失败:",e),this.ossClient=null}}isOSSAvailable(){const e=this.configStore.storageConfig;return!!("oss"===e.storageType&&this.ossClient&&e.accessKey&&e.secretKey&&e.bucketName)}getOSSConfigDiagnosis(){const e=this.configStore.storageConfig,a=[];return"oss"!==e.storageType&&a.push("存储类型未设置为OSS"),e.accessKey||a.push("Access Key未配置"),e.secretKey||a.push("Secret Key未配置"),e.bucketName||a.push("Bucket名称未配置"),e.region||a.push("Region未配置"),this.ossClient||a.push("OSS客户端未初始化"),{isAvailable:this.isOSSAvailable(),issues:a,config:{storageType:e.storageType,hasAccessKey:!!e.accessKey,hasSecretKey:!!e.secretKey,hasBucketName:!!e.bucketName,hasRegion:!!e.region,hasClient:!!this.ossClient}}}async diagnoseOSSPermissions(){const e={hasListPermission:!1,hasReadPermission:!1,hasWritePermission:!1,errors:[],recommendations:[]};try{if(this.ossClient||await this.initOSSClient(),!this.ossClient)return e.errors.push("OSS客户端初始化失败"),e.recommendations.push("检查Access Key、Secret Key和Region配置"),e;try{await this.ossClient.list({"max-keys":1}),e.hasListPermission=!0,console.log("✓ List权限测试通过")}catch(a){e.errors.push(`List权限测试失败: ${a.code||a.message}`),"AccessDenied"===a.code&&e.recommendations.push("需要为Access Key添加oss:ListObjects权限")}try{await this.ossClient.get("permission-test-nonexistent-file.txt")}catch(a){"NoSuchKey"===a.code?(e.hasReadPermission=!0,console.log("✓ Read权限测试通过")):"AccessDenied"===a.code?(e.errors.push("Read权限测试失败: 访问被拒绝"),e.recommendations.push("需要为Access Key添加oss:GetObject权限")):e.errors.push(`Read权限测试失败: ${a.code||a.message}`)}try{const a="permission-test",t=`permission-test-${Date.now()}.txt`;await this.ossClient.put(t,Buffer.from(a)),e.hasWritePermission=!0,console.log("✓ Write权限测试通过");try{await this.ossClient.delete(t)}catch(l){console.warn("清理测试文件失败:",l)}}catch(a){e.errors.push(`Write权限测试失败: ${a.code||a.message}`),"AccessDenied"===a.code&&e.recommendations.push("需要为Access Key添加oss:PutObject和oss:DeleteObject权限")}}catch(a){e.errors.push(`权限诊断失败: ${a.message}`)}return e}async testOSSConnection(){try{if(this.ossClient||(console.log("OSS客户端未初始化，尝试重新初始化..."),await this.initOSSClient()),!this.ossClient)return{success:!1,error:"OSS客户端初始化失败，请检查配置"};if("function"!=typeof this.ossClient.list)return console.error("OSS客户端对象:",this.ossClient),console.error("可用方法:",Object.getOwnPropertyNames(this.ossClient)),{success:!1,error:"OSS客户端方法不可用，可能是版本兼容性问题"};const e=this.configStore.storageConfig.bucketName,a=await this.ossClient.list({"max-keys":1});return{success:!0,details:{bucketName:e,region:this.configStore.storageConfig.region,objectCount:a.objects?a.objects.length:0,isTruncated:a.isTruncated||!1}}}catch(e){let l="未知错误",t={},s="";if("RequestError"===e.name||e.message?.includes("XHR error")||e.message?.includes("ERR_FAILED"))l=`OSS错误: ${e.name} - ${e.message}`,s="这可能是CORS配置问题。请检查：\n1. OSS Bucket的CORS规则是否包含当前域名\n2. 允许的方法是否包含GET\n3. 是否使用了正确的协议(HTTPS)",t={name:e.name,message:e.message,status:e.status,code:e.code,corsAdvice:s,currentOrigin:window.location.origin,requestUrl:`https://${this.configStore.storageConfig.bucketName}.${this.configStore.storageConfig.region}.aliyuncs.com/`};else if(e.code){switch(e.code){case"InvalidAccessKeyId":l="Access Key ID无效";break;case"SignatureDoesNotMatch":l="Secret Key错误或签名不匹配";break;case"NoSuchBucket":l="Bucket不存在";break;case"AccessDenied":l="访问被拒绝，请检查权限配置";break;case"RequestTimeTooSkewed":l="请求时间偏差过大，请检查系统时间";break;default:l=`OSS错误: ${e.code} - ${e.message}`}t={code:e.code,message:e.message,requestId:e.requestId}}else l=e.message||"连接失败",t=e;let o=null;if("AccessDenied"===e.code||l.includes("访问被拒绝")){console.log("检测到权限错误，开始权限诊断...");try{o=await this.diagnoseOSSPermissions(),console.log("权限诊断结果:",o)}catch(a){console.error("权限诊断失败:",a)}}return console.error("OSS连接测试失败:",{error:l,details:t,permissionDiagnosis:o,config:{region:this.configStore.storageConfig.region,bucket:this.configStore.storageConfig.bucketName,endpoint:this.configStore.storageConfig.customDomain,hasClient:!!this.ossClient,currentOrigin:window.location.origin}}),{success:!1,error:`${l}${s?" "+s:""}`,details:{...t,permissionDiagnosis:o}}}}async uploadFile(e,a,l){try{if(!this.isOSSAvailable())return{success:!1,error:"OSS服务不可用，请检查配置"};const t=this.generateFileName(e.name),s=a?`${a}/${t}`:t;return{success:!0,url:(await this.ossClient.put(s,e,{progress:e=>{l&&l(Math.round(100*e))}})).url,key:s}}catch(t){return console.error("OSS文件上传失败:",t),{success:!1,error:t instanceof Error?t.message:"上传失败"}}}async deleteFile(e){try{if(!e||"string"!=typeof e)return console.error("OSS文件删除失败: 无效的文件key",{key:e}),!1;if(!this.isOSSAvailable())return console.warn("OSS服务不可用，无法删除文件",{key:e,diagnosis:this.getOSSConfigDiagnosis()}),!1;await this.ossClient.delete(e);return!0}catch(a){if("AccessDenied"===a.code);else{if("NoSuchKey"===a.code)return!0;"InvalidAccessKeyId"===a.code||a.code}return!1}}async listFiles(e,a=100){try{if(!this.isOSSAvailable())return{success:!1,error:"OSS服务不可用"};console.log(`开始列出OSS文件，前缀: ${e||"无"}`);const l=await this.ossClient.list({prefix:e||"","max-keys":a}),t=l.objects?.map(e=>({key:e.name,size:e.size,lastModified:new Date(e.lastModified),etag:e.etag}))||[];return console.log(`OSS文件列表获取成功，共 ${t.length} 个文件`),{success:!0,files:t}}catch(l){return console.error("OSS文件列表获取失败:",{prefix:e,error:l.message||l,code:l.code,requestId:l.requestId}),{success:!1,error:l.message||"获取文件列表失败"}}}async downloadFile(e){try{if(!e||"string"!=typeof e)return{success:!1,error:"无效的文件key"};if(!this.isOSSAvailable())return{success:!1,error:"OSS服务不可用"};console.log(`开始下载OSS文件: ${e}`);const a=await this.ossClient.get(e);if(a.content){const l=a.content.toString();return console.log(`OSS文件下载成功: ${e}，大小: ${l.length} 字符`),{success:!0,content:l,blob:new Blob([l],{type:"application/json"})}}return{success:!1,error:"文件内容为空"}}catch(a){return console.error("OSS文件下载失败:",{key:e,error:a.message||a,code:a.code,requestId:a.requestId}),"NoSuchKey"===a.code?{success:!1,error:"文件不存在"}:"AccessDenied"===a.code?{success:!1,error:"访问被拒绝，请检查权限配置"}:{success:!1,error:a.message||"下载文件失败"}}}getFileUrl(e){const a=this.configStore.storageConfig;return a.customDomain?`${a.customDomain}/${e}`:`https://${a.bucketName}.${a.region}.aliyuncs.com/${e}`}generateFileName(e){return`${Date.now()}_${Math.random().toString(36).substring(2,8)}.${e.split(".").pop()}`}validateFileType(e){const a=this.configStore.storageConfig.allowedTypes.split(",").map(e=>e.trim().toLowerCase()),l=e.name.split(".").pop()?.toLowerCase();return!!l&&a.includes(l)}validateFileSize(e){const a=1024*this.configStore.storageConfig.maxFileSize*1024;return e.size<=a}async reinitialize(){this.ossClient=null,await this.initOSSClient()}}const Oe=Te.getInstance(),Pe=Object.freeze(Object.defineProperty({__proto__:null,OSSService:Te,ossService:Oe},Symbol.toStringTag,{value:"Module"}));class De{static instance;configStore=e();syncStatus={isEnabled:!1,syncInProgress:!1,totalItems:0,syncedItems:0,failedItems:0,errors:[]};syncConfig={autoSync:!0,syncInterval:30,syncOnDataChange:!0,backupRetention:5};syncTimer=null;constructor(){this.initializeSync()}static getInstance(){return De.instance||(De.instance=new De),De.instance}initializeSync(){this.syncStatus.isEnabled=Oe.isOSSAvailable(),this.syncStatus.isEnabled&&this.syncConfig.autoSync&&this.startAutoSync(),this.watchStorageConfig()}watchStorageConfig(){setInterval(()=>{const e=this.syncStatus.isEnabled;this.syncStatus.isEnabled=Oe.isOSSAvailable(),!e&&this.syncStatus.isEnabled?this.syncConfig.autoSync&&this.startAutoSync():e&&!this.syncStatus.isEnabled&&this.stopAutoSync()},5e3)}startAutoSync(){this.syncStatus.isEnabled?(this.stopAutoSync(),this.syncTimer=window.setInterval(()=>{this.syncStatus.syncInProgress||this.syncAllData()},60*this.syncConfig.syncInterval*1e3),console.log(`自动同步已启动，间隔: ${this.syncConfig.syncInterval}分钟`)):console.warn("OSS服务不可用，无法启动自动同步")}stopAutoSync(){this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null,console.log("自动同步已停止"))}async syncAllData(){if(!this.syncStatus.isEnabled)return console.warn("OSS服务不可用，无法同步数据"),!1;if(this.syncStatus.syncInProgress)return console.warn("同步正在进行中，请稍后再试"),!1;try{this.syncStatus.syncInProgress=!0,this.syncStatus.syncedItems=0,this.syncStatus.failedItems=0,this.syncStatus.errors=[],console.log("开始同步数据到OSS...");const a=this.getAllLocalData();this.syncStatus.totalItems=a.length;for(const l of a)try{await this.syncSingleData(l),this.syncStatus.syncedItems++}catch(e){this.syncStatus.failedItems++,this.syncStatus.errors.push(`同步 ${l.key} 失败: ${e instanceof Error?e.message:"未知错误"}`)}return this.syncStatus.lastSyncTime=(new Date).toISOString(),console.log(`数据同步完成: 成功 ${this.syncStatus.syncedItems}，失败 ${this.syncStatus.failedItems}`),0===this.syncStatus.failedItems}catch(e){return console.error("数据同步失败:",e),!1}finally{this.syncStatus.syncInProgress=!1}}getAllLocalData(){const e=[];for(let l=0;l<localStorage.length;l++){const t=localStorage.key(l);if(t&&t.startsWith("crm_"))try{const a=localStorage.getItem(t);a&&e.push({key:t,data:JSON.parse(a)})}catch(a){console.warn(`解析本地数据失败: ${t}`,a)}}return e}async syncSingleData(e){const a=`backup/${e.key}_${Date.now()}.json`,l=new Blob([JSON.stringify(e.data,null,2)],{type:"application/json"}),t=new File([l],a,{type:"application/json"}),s=await Oe.uploadFile(t,"crm-backup");if(!s.success)throw new Error(s.error||"上传失败")}async restoreFromOSS(){if(!this.syncStatus.isEnabled)return console.warn("OSS服务不可用，无法恢复数据"),!1;try{return console.log("开始从OSS恢复数据..."),console.log("数据恢复功能需要进一步实现"),!0}catch(e){return console.error("从OSS恢复数据失败:",e),!1}}getSyncStatus(){return{...this.syncStatus}}getSyncConfig(){return{...this.syncConfig}}updateSyncConfig(e){Object.assign(this.syncConfig,e),void 0!==e.autoSync&&(e.autoSync&&this.syncStatus.isEnabled?this.startAutoSync():this.stopAutoSync()),void 0!==e.syncInterval&&this.syncConfig.autoSync&&this.startAutoSync()}async cleanupOldBackups(){if(this.syncStatus.isEnabled)try{console.log("清理旧备份文件...")}catch(e){console.error("清理旧备份失败:",e)}}async checkDataIntegrity(){try{const e=this.getAllLocalData();return console.log(`本地数据项数量: ${e.length}`),!0}catch(e){return console.error("数据完整性检查失败:",e),!1}}}const Ue=De.getInstance();const Ne=new class{dataSyncService=Ue;async saveData(e,a){try{localStorage.setItem(e,JSON.stringify(a));return this.dataSyncService.getSyncConfig().syncOnDataChange&&this.dataSyncService.getSyncStatus().isEnabled&&setTimeout(()=>{this.dataSyncService.syncAllData()},1e3),!0}catch(l){return console.error("保存数据失败:",l),!1}}loadData(e){try{const a=localStorage.getItem(e);return a?JSON.parse(a):null}catch(a){return console.error("加载数据失败:",a),null}}async removeData(e){try{localStorage.removeItem(e);return this.dataSyncService.getSyncConfig().syncOnDataChange&&this.dataSyncService.getSyncStatus().isEnabled&&setTimeout(()=>{this.dataSyncService.syncAllData()},1e3),!0}catch(a){return console.error("删除数据失败:",a),!1}}};const Ee=new class{results=[];async runAllTests(){return this.results=[],console.log("开始数据持久性测试..."),await this.testLocalStorage(),await this.testConfigStore(),await this.testEnhancedStorage(),await this.testOSSService(),await this.testDataSyncService(),console.log("数据持久性测试完成"),this.printResults(),this.results}async testLocalStorage(){try{const e="test_local_storage",a={message:"Hello World",timestamp:Date.now()};localStorage.setItem(e,JSON.stringify(a));const l=localStorage.getItem(e),t=l?JSON.parse(l):null,s=t&&t.message===a.message;localStorage.removeItem(e),this.addResult({name:"本地存储功能",passed:s,message:s?"本地存储读写正常":"本地存储读写失败",error:{testData:a,savedData:t}})}catch(e){this.addResult({name:"本地存储功能",passed:!1,message:`本地存储测试失败: ${e instanceof Error?e.message:"未知错误"}`,error:e})}}async testConfigStore(){try{const a=e(),l={...a.systemConfig},t={...l,siteName:"Test Site Name"};a.updateSystemConfig(t);const s="Test Site Name"===a.systemConfig.siteName;a.updateSystemConfig(l),this.addResult({name:"配置存储功能",passed:s,message:s?"配置存储更新正常":"配置存储更新失败",error:{testSystemConfig:t,currentConfig:a.systemConfig}})}catch(a){this.addResult({name:"配置存储功能",passed:!1,message:`配置存储测试失败: ${a instanceof Error?a.message:"未知错误"}`,error:a})}}async testEnhancedStorage(){try{const e="test_enhanced_storage",a={type:"enhanced",value:"test data",timestamp:Date.now()},l=await Ne.saveData(e,a),t=Ne.loadData(e),s=l&&t&&t.value===a.value;await Ne.removeData(e),this.addResult({name:"增强存储服务",passed:s,message:s?"增强存储服务正常":"增强存储服务异常",error:{testData:a,loadedData:t,saveResult:l}})}catch(e){this.addResult({name:"增强存储服务",passed:!1,message:`增强存储服务测试失败: ${e instanceof Error?e.message:"未知错误"}`,error:e})}}async testOSSService(){try{const a=Oe.getOSSConfigDiagnosis();if(!a.isAvailable)return void this.addResult({name:"OSS服务可用性",passed:!1,message:`OSS服务不可用: ${a.issues.join(", ")}`,error:{diagnosis:a}});const l=await Oe.testOSSConnection();if(this.addResult({name:"OSS连接测试",passed:l.success,message:l.success?"OSS连接成功":`OSS连接失败: ${l.error}`,error:l.success?null:l.details}),!l.success)return;const t=new Blob(["This is a test file for OSS upload"],{type:"text/plain"}),s=new File([t],"test-file.txt",{type:"text/plain"}),o=await Oe.uploadFile(s,"test");if(this.addResult({name:"OSS文件上传",passed:o.success,message:o.success?"OSS文件上传成功":`OSS文件上传失败: ${o.error}`,error:{uploadResult:o,fileName:s.name}}),o.success&&o.key)try{const e=await Oe.deleteFile(o.key);this.addResult({name:"OSS文件删除",passed:e,message:e?"OSS文件删除成功":"OSS文件删除失败",error:e?null:{fileKey:o.key,url:o.url}})}catch(e){this.addResult({name:"OSS文件删除",passed:!1,message:`OSS文件删除测试失败: ${e instanceof Error?e.message:"未知错误"}`,error:{deleteError:e,fileKey:o.key,url:o.url}})}else o.success&&!o.key&&this.addResult({name:"OSS文件删除",passed:!1,message:"OSS文件删除失败: 上传结果中缺少文件key",error:{uploadResult:o}})}catch(a){this.addResult({name:"OSS服务",passed:!1,message:`OSS服务测试失败: ${a instanceof Error?a.message:"未知错误"}`,error:a})}}async testDataSyncService(){try{const a=Ue.getSyncStatus(),l=Ue.getSyncConfig(),t=await Ue.checkDataIntegrity();if(this.addResult({name:"数据同步服务状态",passed:!0,message:"数据同步服务状态获取正常",error:{syncStatus:a,syncConfig:l,integrityCheck:t}}),a.isEnabled)try{const e=await Ue.checkDataIntegrity();this.addResult({name:"数据同步准备",passed:e,message:e?"数据同步准备就绪":"数据同步准备失败",error:{testSyncResult:e}})}catch(e){this.addResult({name:"数据同步准备",passed:!1,message:`数据同步准备失败: ${e instanceof Error?e.message:"未知错误"}`,error:e})}else this.addResult({name:"数据同步准备",passed:!1,message:"数据同步服务未启用，OSS配置可能不完整",error:{syncStatus:a}})}catch(a){this.addResult({name:"数据同步服务",passed:!1,message:`数据同步服务测试失败: ${a instanceof Error?a.message:"未知错误"}`,error:a})}}addResult(e){this.results.push(e),console.log(`[测试] ${e.name}: ${e.passed?"✅ 通过":"❌ 失败"} - ${e.message}`)}printResults(){const e=this.results.length,a=this.results.filter(e=>e.passed).length,l=e-a;console.log("\n=== 数据持久性测试结果摘要 ==="),console.log(`总测试数: ${e}`),console.log(`通过: ${a}`),console.log(`失败: ${l}`),console.log(`成功率: ${(a/e*100).toFixed(1)}%`),l>0&&(console.log("\n失败的测试:"),this.results.filter(e=>!e.passed).forEach(e=>{console.log(`- ${e.name}: ${e.message}`)}))}getResults(){return[...this.results]}getSummary(){const e=this.results.length,a=this.results.filter(e=>e.passed).length;return{total:e,passed:a,failed:e-a,successRate:e>0?a/e*100:0}}};async function $e(){return await Ee.runAllTests()}"undefined"!=typeof window&&(window.testDataPersistence=$e().dataPersistenceTest=Ee);const Be=new class{configStore=e();autoBackupTimer=null;getDefaultBackupConfig(){return{enabled:!1,autoBackupInterval:24,maxBackupCount:30,backupPath:"backups/data",includeStores:["crm_store_customer","crm_store_order","crm_store_product","crm_store_performance","crm_store_department","crm_store_service","crm_store_config"],excludeKeys:["test_","temp_","cache_"]}}getBackupConfig(){const e=localStorage.getItem("crm_backup_config");if(e)try{return{...this.getDefaultBackupConfig(),...JSON.parse(e)}}catch(a){console.error("备份配置解析失败:",a)}return this.getDefaultBackupConfig()}saveBackupConfig(e){localStorage.setItem("crm_backup_config",JSON.stringify(e)),this.setupAutoBackup()}async setBackupConfig(e){this.saveBackupConfig(e),this.setupAutoBackup(),console.log("备份配置已更新并重新启动自动备份")}collectBackupData(e){const a={};let l=0,t=0;for(let o=0;o<localStorage.length;o++){const n=localStorage.key(o);if(!n)continue;const i=e.includeStores.some(e=>n.startsWith(e))||n.startsWith("crm_"),r=e.excludeKeys.some(e=>n.includes(e));if(i&&!r)try{const e=localStorage.getItem(n);e&&(a[n]=JSON.parse(e),l+=n.length+e.length,t++)}catch(s){console.warn(`备份数据时跳过无效键 ${n}:`,s)}}return{version:"1.0.0",timestamp:Date.now(),data:a,metadata:{userAgent:navigator.userAgent,url:window.location.href,totalSize:l,itemCount:t}}}async performManualBackup(){try{if(!Oe.isOSSAvailable())return i.error("OSS未配置或不可用，无法执行备份"),!1;const e=this.getBackupConfig(),a=this.collectBackupData(e),l=(new Date).toISOString().replace(/[:.]/g,"-"),t=`${e.backupPath}/manual-backup-${l}.json`,s=JSON.stringify(a,null,2),o=new Blob([s],{type:"application/json"}),n=new File([o],`manual-backup-${l}.json`,{type:"application/json"}),r=await Oe.uploadFile(n,t);return r.success?(localStorage.setItem("crm_last_backup_time",Date.now().toString()),i.success(`手动备份成功！备份了 ${a.metadata.itemCount} 项数据`),await this.cleanupOldBackups(e),!0):(i.error(`备份失败: ${r.error}`),!1)}catch(e){return console.error("手动备份失败:",e),i.error(`备份失败: ${e instanceof Error?e.message:"未知错误"}`),!1}}async performAutoBackup(){try{if(!Oe.isOSSAvailable())return console.warn("OSS未配置或不可用，跳过自动备份"),!1;const e=this.getBackupConfig();if(!e.enabled)return!1;const a=this.collectBackupData(e),l=(new Date).toISOString().replace(/[:.]/g,"-"),t=`${e.backupPath}/auto-backup-${l}.json`,s=JSON.stringify(a,null,2),o=new Blob([s],{type:"application/json"}),n=new File([o],`auto-backup-${l}.json`,{type:"application/json"}),i=await Oe.uploadFile(n,t);return i.success?(localStorage.setItem("crm_last_backup_time",Date.now().toString()),console.log(`自动备份成功！备份了 ${a.metadata.itemCount} 项数据`),await this.cleanupOldBackups(e),!0):(console.error(`自动备份失败: ${i.error}`),!1)}catch(e){return console.error("自动备份失败:",e),!1}}async getBackupList(){try{if(!Oe.isOSSAvailable())throw new Error("OSS未配置或不可用");const a=this.getBackupConfig(),l=await Oe.listFiles(a.backupPath,1e3);if(!l.success)throw new Error(l.error||"获取备份列表失败");const t=l.files?.filter(e=>e.key.endsWith(".json")&&(e.key.includes("manual-backup-")||e.key.includes("auto-backup-")))||[],s=[];for(const o of t)try{const e=o.key.split("/").pop()||o.key,a=e.match(/(\d{4}-\d{2}-\d{2}T\d{2}-\d{2}-\d{2})/);let l=o.lastModified.getTime();if(a){const e=a[1].replace(/-/g,":").replace("T","T").slice(0,-3)+":"+a[1].slice(-3),t=new Date(e.replace(/-/g,":"));isNaN(t.getTime())||(l=t.getTime())}s.push({filename:e,timestamp:l,size:o.size,version:"1.0.0",itemCount:0})}catch(e){console.warn("解析备份文件信息失败:",o.key,e)}return s.sort((e,a)=>a.timestamp-e.timestamp),console.log(`获取到 ${s.length} 个备份文件`),s}catch(e){throw console.error("获取备份列表失败:",e),e}}async restoreFromBackup(e){try{if("confirm"!==await r.confirm("恢复备份将覆盖当前所有数据，此操作不可撤销。是否继续？","确认恢复",{confirmButtonText:"确定恢复",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!1}))return!1;if(!Oe.isOSSAvailable())return i.error("OSS未配置或不可用，无法恢复备份"),!1;const l=`${this.getBackupConfig().backupPath}/${e}`,t=await Oe.downloadFile(l);if(!t.success)return i.error(`下载备份文件失败: ${t.error}`),!1;if(!t.content)return i.error("备份文件内容为空"),!1;let s;try{s=JSON.parse(t.content)}catch(a){return i.error("备份文件格式错误，无法解析"),!1}if(!s.data||!s.version||!s.timestamp)return i.error("备份文件格式不正确"),!1;let o=0;for(const[e,n]of Object.entries(s.data))try{"string"==typeof n?localStorage.setItem(e,n):localStorage.setItem(e,JSON.stringify(n)),o++}catch(a){console.warn(`恢复数据项失败: ${e}`,a)}return localStorage.setItem("crm_last_restore_time",Date.now().toString()),localStorage.setItem("crm_last_restore_file",e),i.success(`数据恢复成功！恢复了 ${o} 项数据，页面将自动刷新`),setTimeout(()=>{window.location.reload()},2e3),!0}catch(a){return"cancel"===a||(console.error("恢复备份失败:",a),i.error(`恢复失败: ${a instanceof Error?a.message:"未知错误"}`)),!1}}async cleanupOldBackups(e){try{if(e.maxBackupCount<=0)return;const l=await this.getBackupList();if(l.length<=e.maxBackupCount)return void console.log(`当前备份数量 ${l.length}，未超过限制 ${e.maxBackupCount}，无需清理`);const t=l.sort((e,a)=>a.timestamp-e.timestamp).slice(e.maxBackupCount);console.log(`开始清理 ${t.length} 个旧备份`);let s=0;for(const o of t)try{const a=`${e.backupPath}/${o.filename}`;await Oe.deleteFile(a)?(s++,console.log(`删除旧备份成功: ${o.filename}`)):console.warn(`删除旧备份失败: ${o.filename}`)}catch(a){console.error(`删除备份文件失败: ${o.filename}`,a)}console.log(`清理旧备份完成，成功删除 ${s} 个文件`)}catch(a){console.error("清理旧备份失败:",a)}}setupAutoBackup(){this.autoBackupTimer&&(clearInterval(this.autoBackupTimer),this.autoBackupTimer=null);const e=this.getBackupConfig();if(!e.enabled||e.autoBackupInterval<=0)return;const a=60*e.autoBackupInterval*60*1e3;this.autoBackupTimer=window.setInterval(()=>{this.performAutoBackup()},a),console.log(`自动备份已设置，间隔: ${e.autoBackupInterval} 小时`)}stopAutoBackup(){this.autoBackupTimer&&(clearInterval(this.autoBackupTimer),this.autoBackupTimer=null,console.log("自动备份已停止"))}initialize(){this.setupAutoBackup(),window.addEventListener("beforeunload",()=>{this.stopAutoBackup()})}getBackupStats(){const e=this.getBackupConfig(),a=this.collectBackupData(e),l=localStorage.getItem("crm_last_backup_time"),t=l?new Date(parseInt(l)).toLocaleString():null;return{totalItems:a.metadata.itemCount,totalSize:this.formatFileSize(a.metadata.totalSize),lastBackup:t}}formatFileSize(e){if(0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB"][a]}};function Re(){const e={test_customer_data:JSON.stringify([{id:1,name:"测试客户1",phone:"13800138001"},{id:2,name:"测试客户2",phone:"13800138002"}]),test_order_data:JSON.stringify([{id:1,customerId:1,amount:1e3,status:"已完成"},{id:2,customerId:2,amount:2e3,status:"进行中"}]),test_config:JSON.stringify({theme:"dark",language:"zh-CN",autoSave:!0}),test_user_preferences:JSON.stringify({sidebarCollapsed:!1,tablePageSize:20,notifications:!0})};Object.entries(e).forEach(([e,a])=>{localStorage.setItem(e,a)}),console.log("测试数据已创建:",e),i.success("测试数据创建成功")}async function Me(){try{console.log("开始测试手动备份功能..."),Re();return await Be.performManualBackup()?(console.log("手动备份测试成功"),i.success("手动备份测试成功"),!0):(console.error("手动备份测试失败"),i.error("手动备份测试失败"),!1)}catch(e){return console.error("手动备份测试异常:",e),i.error(`手动备份测试异常: ${e}`),!1}}async function Le(){try{console.log("开始测试备份列表功能...");const e=await Be.getBackupList();return console.log("备份列表:",e),i.success(`获取到 ${e.length} 个备份文件`),!0}catch(e){return console.error("备份列表测试失败:",e),i.error(`备份列表测试失败: ${e}`),!1}}async function qe(){try{console.log("开始测试备份配置功能...");const e=Be.getDefaultBackupConfig();console.log("默认配置:",e);const a={...e,enabled:!0,autoBackupInterval:2,maxBackupCount:5};await Be.setBackupConfig(a);const l=Be.getBackupConfig();return console.log("保存的配置:",l),l.enabled===a.enabled&&l.autoBackupInterval===a.autoBackupInterval?(console.log("备份配置测试成功"),i.success("备份配置测试成功"),!0):(console.error("备份配置测试失败: 配置不匹配"),i.error("备份配置测试失败: 配置不匹配"),!1)}catch(e){return console.error("备份配置测试异常:",e),i.error(`备份配置测试异常: ${e}`),!1}}async function Fe(){console.log("开始运行备份服务测试套件...");const e=[{name:"备份配置测试",fn:qe},{name:"手动备份测试",fn:Me},{name:"备份列表测试",fn:Le}],a=[];for(const o of e)try{console.log(`\n=== ${o.name} ===`);const e=await o.fn();a.push({name:o.name,success:e}),await new Promise(e=>setTimeout(e,1e3))}catch(s){console.error(`${o.name} 执行异常:`,s),a.push({name:o.name,success:!1})}console.log("\n=== 测试结果汇总 ==="),a.forEach(e=>{console.log(`${e.name}: ${e.success?"✅ 通过":"❌ 失败"}`)});const l=a.filter(e=>e.success).length,t=a.length;l===t?i.success(`所有测试通过 (${l}/${t})`):i.warning(`部分测试失败 (${l}/${t})`),console.log(`测试完成: ${l}/${t} 通过`)}Be.initialize(),"undefined"!=typeof window&&(window.backupTests={createTestData:Re,cleanupTestData:function(){["test_customer_data","test_order_data","test_config","test_user_preferences"].forEach(e=>{localStorage.removeItem(e)}),console.log("测试数据已清理"),i.success("测试数据清理完成")},verifyTestData:function(){const e=["test_customer_data","test_order_data","test_config","test_user_preferences"].filter(e=>!localStorage.getItem(e));return e.length>0?(console.warn("缺少测试数据:",e),i.warning(`缺少测试数据: ${e.join(", ")}`),!1):(console.log("测试数据验证通过"),i.success("测试数据验证通过"),!0)},testManualBackup:Me,testBackupList:Le,testBackupConfig:qe,runAllTests:Fe},console.log("备份测试工具已加载，可在控制台使用 window.backupTests"));class Ke{async exportAllData(){try{const a={customers:[],orders:[],products:[],departments:[],users:[],configs:{}},l=localStorage.getItem("customers");l&&(a.customers=JSON.parse(l));const t=localStorage.getItem("orders");t&&(a.orders=JSON.parse(t));const s=localStorage.getItem("products");s&&(a.products=JSON.parse(s));const o=localStorage.getItem("departments");o&&(a.departments=JSON.parse(o));const n=localStorage.getItem("userDatabase");n&&(a.users=JSON.parse(n));const i={};for(let u=0;u<localStorage.length;u++){const a=localStorage.key(u);if(a&&a.startsWith("crm_config_"))try{const e=localStorage.getItem(a);e&&(i[a]=JSON.parse(e))}catch(e){console.warn(`解析配置失败: ${a}`,e)}}a.configs=i;const r=JSON.stringify(a).length;a.metadata={exportTime:(new Date).toISOString(),version:"1.0.0",totalSize:r,itemCount:a.customers.length+a.orders.length+a.products.length+a.departments.length+a.users.length},console.log("[数据导出] 导出完成:",{customers:a.customers.length,orders:a.orders.length,products:a.products.length,departments:a.departments.length,users:a.users.length,configs:Object.keys(a.configs).length,totalSize:this.formatBytes(r)});const c=this.getDataStatistics(a);return this.downloadAsJson(a),{success:!0,data:a,statistics:c}}catch(e){return console.error("[数据导出] 导出失败:",e),{success:!1,error:e instanceof Error?e.message:"未知错误"}}}async validateData(){try{const e=await this.exportAllData();if(!e.success||!e.data)return{issues:["无法读取数据"],warnings:[],summary:{totalIssues:1,totalWarnings:0,isValid:!1}};const a=e.data,l=[],t=[];return a.customers.forEach((e,a)=>{e.name||l.push(`客户 ${a+1}: 缺少姓名`),e.phone||e.email||t.push(`客户 ${a+1}: 缺少联系方式`),e.id||l.push(`客户 ${a+1}: 缺少ID`)}),a.orders.forEach((e,a)=>{e.orderNumber||l.push(`订单 ${a+1}: 缺少订单号`),e.customerId||l.push(`订单 ${a+1}: 缺少客户ID`),e.products&&0!==e.products.length||l.push(`订单 ${a+1}: 缺少商品信息`),(!e.totalAmount||e.totalAmount<=0)&&t.push(`订单 ${a+1}: 订单金额异常`)}),a.products.forEach((e,a)=>{e.name||l.push(`产品 ${a+1}: 缺少产品名称`),(!e.price||e.price<=0)&&l.push(`产品 ${a+1}: 价格无效`),e.id||l.push(`产品 ${a+1}: 缺少ID`)}),a.departments.forEach((e,a)=>{e.name||l.push(`部门 ${a+1}: 缺少部门名称`),e.id||l.push(`部门 ${a+1}: 缺少ID`)}),a.users.forEach((e,a)=>{e.username||l.push(`用户 ${a+1}: 缺少用户名`),e.name||t.push(`用户 ${a+1}: 缺少姓名`),e.role||t.push(`用户 ${a+1}: 缺少角色`)}),console.log("[数据验证] 验证完成:",{totalIssues:l.length,totalWarnings:t.length,isValid:0===l.length}),{issues:l,warnings:t,summary:{totalIssues:l.length,totalWarnings:t.length,isValid:0===l.length}}}catch(e){return console.error("[数据验证] 验证失败:",e),{issues:["数据验证失败: "+(e instanceof Error?e.message:"未知错误")],warnings:[],summary:{totalIssues:1,totalWarnings:0,isValid:!1}}}}getDataStatistics(e){if(!e){e={customers:JSON.parse(localStorage.getItem("customers")||"[]"),orders:JSON.parse(localStorage.getItem("orders")||"[]"),products:JSON.parse(localStorage.getItem("products")||"[]"),departments:JSON.parse(localStorage.getItem("departments")||"[]"),users:JSON.parse(localStorage.getItem("userDatabase")||"[]"),configs:{}};for(let a=0;a<localStorage.length;a++){const t=localStorage.key(a);if(t&&t.startsWith("crm_config_"))try{const a=localStorage.getItem(t);a&&(e.configs[t]=JSON.parse(a))}catch(l){console.warn(`解析配置失败: ${t}`,l)}}}const a=JSON.stringify(e).length;return{customers:e.customers.length,orders:e.orders.length,products:e.products.length,departments:e.departments.length,users:e.users.length,configs:Object.keys(e.configs).length,totalSize:a,totalSizeFormatted:this.formatBytes(a),exportTime:(new Date).toLocaleString()}}downloadAsJson(e,a=`crm_data_export_${Date.now()}.json`){try{const l=JSON.stringify(e,null,2),t=new Blob([l],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=a,document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(()=>URL.revokeObjectURL(s.href),100),console.log("[数据导出] 文件下载成功:",a)}catch(l){throw console.error("[数据导出] 文件下载失败:",l),l}}formatBytes(e){if(0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB"][a]}}const je={class:"sms-management"},Je={class:"management-header"},We={class:"header-content"},He={class:"header-right"},Qe={class:"stats-overview"},Ge={class:"stats-grid"},Ze={class:"stat-item pending"},Ye={class:"stat-icon"},Xe={class:"stat-content"},ea={class:"stat-number"},aa={class:"stat-action"},la={class:"stat-item sms"},ta={class:"stat-icon"},sa={class:"stat-content"},oa={class:"stat-number"},na={class:"stat-action"},ia={class:"stat-item today"},ra={class:"stat-icon"},ca={class:"stat-content"},ua={class:"stat-number"},da={class:"stat-item total"},pa={class:"stat-icon"},ma={class:"stat-content"},ga={class:"stat-number"},fa={class:"management-tabs"},va={class:"tab-header"},ya={class:"tab-title"},ha={class:"tab-actions"},ba={class:"templates-list"},_a={class:"template-info"},wa={class:"template-header"},xa={class:"template-name"},Sa={class:"template-meta"},ka={class:"apply-time"},Ca={class:"template-content"},Va={class:"content-text"},za={key:0,class:"variables"},Aa={key:0,class:"template-description"},Ia={class:"desc-text"},Ta={class:"applicant-info"},Oa={class:"applicant-name"},Pa={class:"applicant-dept"},Da={class:"template-actions"},Ua={class:"tab-header"},Na={class:"tab-title"},Ea={class:"tab-actions"},$a={class:"sms-list"},Ba={class:"sms-info"},Ra={class:"sms-header"},Ma={class:"sms-title"},La={class:"sms-meta"},qa={class:"recipient-count"},Fa={class:"apply-time"},Ka={class:"sms-content"},ja={class:"content-text"},Ja={class:"recipients-info"},Wa={class:"recipients-list"},Ha={key:0,class:"more-recipients"},Qa={key:0,class:"sms-reason"},Ga={class:"reason-text"},Za={class:"applicant-info"},Ya={class:"applicant-name"},Xa={class:"applicant-dept"},el={key:0,class:"sms-actions"},al={key:1,class:"sms-result"},ll={class:"result-info"},tl={class:"result-time"},sl={class:"tab-header"},ol={class:"tab-actions"},nl={class:"records-table"},il={class:"content-preview"},rl={class:"recipient-count"},cl={class:"success-stats"},ul={class:"success"},dl={class:"failed"},pl={class:"pagination-section"},ml={key:0,class:"template-preview-content"},gl={class:"preview-header"},fl={class:"preview-body"},vl={class:"content-section"},yl={class:"content-display"},hl={key:0,class:"variables-section"},bl={class:"variables-display"},_l={class:"meta-section"},wl={class:"meta-item"},xl={class:"value"},Sl={class:"meta-item"},kl={class:"value"},Cl={class:"meta-item"},Vl={class:"value"},zl={key:1,class:"description-section"},Al={class:"description-display"},Il={key:0,class:"sms-detail-content"},Tl={class:"detail-header"},Ol={class:"detail-body"},Pl={class:"content-section"},Dl={class:"content-display"},Ul={class:"recipients-section"},Nl={class:"recipients-table"},El={class:"meta-section"},$l={class:"meta-item"},Bl={class:"value"},Rl={class:"meta-item"},Ml={class:"value"},Ll={class:"meta-item"},ql={class:"value"},Fl={key:0,class:"meta-item"},Kl={class:"value"},jl={key:0,class:"reason-section"},Jl={class:"reason-display"},Wl=a(L({__name:"SmsManagement",setup(e){const a=q("templates"),l=q(!1),t=q(!1),s=q(!1),o=q(!1),n=q(!1),b=q(""),_=q(""),w=q(""),x=q(""),S=q(null),k=q(null),C=q(null),V=F({pendingTemplates:0,pendingSms:0,todaySent:0,totalSent:0}),z=q([]),A=q([]),I=q([]),T=F({currentPage:1,pageSize:20,total:0}),O=K(()=>{if(!b.value)return z.value;const e=b.value.toLowerCase();return z.value.filter(a=>a.name.toLowerCase().includes(e)||a.content.toLowerCase().includes(e)||a.applicantName.toLowerCase().includes(e))}),P=K(()=>{let e=A.value;if(w.value&&(e=e.filter(e=>e.status===w.value)),_.value){const a=_.value.toLowerCase();e=e.filter(e=>e.content.toLowerCase().includes(a)||e.applicantName.toLowerCase().includes(a)||e.recipients.some(e=>e.name.toLowerCase().includes(a)||e.phone.includes(a)))}return e}),D=async()=>{l.value=!0;try{await new Promise(e=>setTimeout(e,500)),z.value=[{id:"1",name:"营销推广模板",content:"【限时优惠】{name}，{product}现在只要{price}元！立即购买享受{discount}折优惠，活动截止{endTime}。",category:"marketing",variables:["name","product","price","discount","endTime"],description:"用于产品促销活动的短信推广，需要向客户发送优惠信息",applicantName:"张三",applicantDept:"市场部",createdAt:"2024-01-22 11:20:00"},{id:"2",name:"会议通知模板",content:"尊敬的{name}，您有一场会议将于{time}在{location}举行，主题：{topic}，请准时参加。",category:"notification",variables:["name","time","location","topic"],description:"用于公司内部会议通知，提醒员工参加重要会议",applicantName:"李四",applicantDept:"行政部",createdAt:"2024-01-21 15:30:00"}]}catch(e){i.error("加载待审核模板失败")}finally{l.value=!1}},U=async()=>{t.value=!0;try{await new Promise(e=>setTimeout(e,500)),A.value=[{id:"1",templateName:"验证码模板",content:"您的验证码是123456，请在5分钟内使用，请勿泄露给他人。",recipients:[{name:"王五",phone:"13800138001",department:"技术部",status:"pending"},{name:"赵六",phone:"13800138002",department:"产品部",status:"pending"}],reason:"系统测试需要发送验证码",status:"pending",applicantName:"王五",applicantDept:"技术部",createdAt:"2024-01-22 14:30:00"},{id:"2",templateName:"订单通知",content:"您的订单ORD123456已确认，金额299元，预计明天送达。",recipients:[{name:"客户A",phone:"13900139001",department:"客户",status:"pending"},{name:"客户B",phone:"13900139002",department:"客户",status:"pending"},{name:"客户C",phone:"13900139003",department:"客户",status:"pending"}],reason:"订单确认通知，需要及时告知客户",status:"approved",applicantName:"李四",applicantDept:"销售部",createdAt:"2024-01-21 16:45:00",processedAt:"2024-01-21 17:00:00"}]}catch(e){i.error("加载短信申请失败")}finally{t.value=!1}},N=async()=>{s.value=!0;try{await new Promise(e=>setTimeout(e,500)),I.value=[{id:"1",templateName:"验证码模板",content:"您的验证码是123456，请在5分钟内使用，请勿泄露给他人。",recipientCount:150,status:"success",successCount:148,failedCount:2,sentAt:"2024-01-22 10:30:00",operator:"管理员"},{id:"2",templateName:"订单通知",content:"您的订单已确认，请注意查收。",recipientCount:89,status:"success",successCount:89,failedCount:0,sentAt:"2024-01-21 15:20:00",operator:"张三"}],T.total=I.value.length}catch(e){i.error("加载发送记录失败")}finally{s.value=!1}},E=async()=>{try{V.pendingTemplates=z.value.length,V.pendingSms=A.value.filter(e=>"pending"===e.status).length,V.todaySent=1250,V.totalSent=15680}catch(e){i.error("加载统计数据失败")}},$=()=>{i.info("跳转到模板创建页面")},B=()=>{i.info("打开短信发送对话框")},R=e=>{T.pageSize=e,N()},M=e=>{T.currentPage=e,N()},L=e=>({marketing:"营销推广",notification:"系统通知",verification:"验证码",order:"订单提醒"}[e]||"其他"),ce=e=>({pending:"warning",approved:"success",rejected:"danger"}[e]||"info"),ue=e=>({pending:"待审核",approved:"已通过",rejected:"已拒绝"}[e]||"未知"),de=e=>({success:"发送成功",failed:"发送失败",sending:"发送中"}[e]||"未知"),pe=e=>e||"-";return j(()=>{(async()=>{await Promise.all([D(),U(),N(),E()])})()}),J(a,e=>{"records"===e&&N()}),(e,D)=>{const U=W("el-button"),E=W("el-icon"),q=W("el-badge"),F=W("el-input"),K=W("el-tag"),j=W("el-empty"),J=W("el-tab-pane"),me=W("el-option"),ge=W("el-select"),fe=W("el-date-picker"),ve=W("el-table-column"),ye=W("el-table"),he=W("el-pagination"),be=W("el-tabs"),_e=W("el-card"),we=W("el-dialog"),xe=H("loading");return G(),Q("div",je,[Z("div",Je,[Z("div",We,[D[14]||(D[14]=Z("div",{class:"header-left"},[Z("h2",{class:"header-title"},"短信管理中心"),Z("p",{class:"header-subtitle"},"审核模板申请、管理短信发送和查看统计数据")],-1)),Z("div",He,[Y(U,{type:"primary",icon:X(c),onClick:$,class:"create-btn"},{default:ee(()=>[...D[12]||(D[12]=[ae(" 创建模板 ",-1)])]),_:1},8,["icon"]),Y(U,{type:"success",icon:X(u),onClick:B,class:"send-btn"},{default:ee(()=>[...D[13]||(D[13]=[ae(" 发送短信 ",-1)])]),_:1},8,["icon"])])])]),Z("div",Qe,[Z("div",Ge,[Z("div",Ze,[Z("div",Ye,[Y(E,null,{default:ee(()=>[Y(X(d))]),_:1})]),Z("div",Xe,[Z("div",ea,le(V.pendingTemplates),1),D[15]||(D[15]=Z("div",{class:"stat-label"},"待审核模板",-1))]),Z("div",aa,[V.pendingTemplates>0?(G(),te(U,{key:0,size:"small",type:"warning",onClick:D[0]||(D[0]=e=>a.value="templates")},{default:ee(()=>[...D[16]||(D[16]=[ae(" 立即处理 ",-1)])]),_:1})):se("",!0)])]),Z("div",la,[Z("div",ta,[Y(E,null,{default:ee(()=>[Y(X(u))]),_:1})]),Z("div",sa,[Z("div",oa,le(V.pendingSms),1),D[17]||(D[17]=Z("div",{class:"stat-label"},"待审核短信",-1))]),Z("div",na,[V.pendingSms>0?(G(),te(U,{key:0,size:"small",type:"primary",onClick:D[1]||(D[1]=e=>a.value="sms")},{default:ee(()=>[...D[18]||(D[18]=[ae(" 立即处理 ",-1)])]),_:1})):se("",!0)])]),Z("div",ia,[Z("div",ra,[Y(E,null,{default:ee(()=>[Y(X(p))]),_:1})]),Z("div",ca,[Z("div",ua,le(V.todaySent),1),D[19]||(D[19]=Z("div",{class:"stat-label"},"今日发送",-1))])]),Z("div",da,[Z("div",pa,[Y(E,null,{default:ee(()=>[Y(X(m))]),_:1})]),Z("div",ma,[Z("div",ga,le(V.totalSent),1),D[20]||(D[20]=Z("div",{class:"stat-label"},"总发送量",-1))])])])]),Z("div",fa,[Y(_e,{class:"tabs-card"},{default:ee(()=>[Y(be,{modelValue:a.value,"onUpdate:modelValue":D[9]||(D[9]=e=>a.value=e),class:"management-tabs-content"},{default:ee(()=>[Y(J,{label:"模板审核",name:"templates"},{default:ee(()=>[Z("div",va,[Z("div",ya,[D[21]||(D[21]=Z("h3",null,"模板审核",-1)),z.value.length>0?(G(),te(q,{key:0,value:z.value.length,class:"badge"},null,8,["value"])):se("",!0)]),Z("div",ha,[Y(F,{modelValue:b.value,"onUpdate:modelValue":D[2]||(D[2]=e=>b.value=e),placeholder:"搜索模板","prefix-icon":X(g),clearable:"",style:{width:"250px"}},null,8,["modelValue","prefix-icon"])])]),oe((G(),Q("div",ba,[(G(!0),Q(ne,null,ie(O.value,e=>(G(),Q("div",{key:e.id,class:"template-item"},[Z("div",_a,[Z("div",wa,[Z("h4",xa,le(e.name),1),Z("div",Sa,[Y(K,{size:"small",type:"info"},{default:ee(()=>[ae(le(L(e.category)),1)]),_:2},1024),Z("span",ka,le(pe(e.createdAt)),1)])]),Z("div",Ca,[Z("p",Va,le(e.content),1),e.variables?.length?(G(),Q("div",za,[D[22]||(D[22]=Z("span",{class:"variables-label"},"变量：",-1)),(G(!0),Q(ne,null,ie(e.variables,e=>(G(),te(K,{key:e,size:"small",class:"variable-tag"},{default:ee(()=>[ae(le(e),1)]),_:2},1024))),128))])):se("",!0)]),e.description?(G(),Q("div",Aa,[D[23]||(D[23]=Z("span",{class:"desc-label"},"申请说明：",-1)),Z("p",Ia,le(e.description),1)])):se("",!0),Z("div",Ta,[D[24]||(D[24]=Z("span",{class:"applicant-label"},"申请人：",-1)),Z("span",Oa,le(e.applicantName),1),Z("span",Pa,le(e.applicantDept),1)])]),Z("div",Da,[Y(U,{type:"success",icon:X(f),onClick:a=>(async e=>{try{await r.confirm("确定要审核通过这个模板吗？","确认审核",{type:"warning"}),await new Promise(e=>setTimeout(e,1e3));const a=z.value.findIndex(a=>a.id===e.id);a>-1&&(z.value.splice(a,1),V.pendingTemplates--),i.success("模板审核通过")}catch(a){}})(e),class:"approve-btn"},{default:ee(()=>[...D[25]||(D[25]=[ae(" 通过 ",-1)])]),_:1},8,["icon","onClick"]),Y(U,{type:"danger",icon:X(v),onClick:a=>(async e=>{try{const{value:a}=await r.prompt("请输入拒绝原因","审核拒绝",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{5,}/,inputErrorMessage:"拒绝原因至少5个字符"});await new Promise(e=>setTimeout(e,1e3));const l=z.value.findIndex(a=>a.id===e.id);l>-1&&(z.value.splice(l,1),V.pendingTemplates--),i.success("模板已拒绝")}catch(a){}})(e),class:"reject-btn"},{default:ee(()=>[...D[26]||(D[26]=[ae(" 拒绝 ",-1)])]),_:1},8,["icon","onClick"]),Y(U,{type:"info",icon:X(y),onClick:a=>(e=>{k.value=e,o.value=!0})(e),class:"preview-btn"},{default:ee(()=>[...D[27]||(D[27]=[ae(" 预览 ",-1)])]),_:1},8,["icon","onClick"])])]))),128)),0!==O.value.length||l.value?se("",!0):(G(),te(j,{key:0,description:"暂无待审核模板","image-size":120}))])),[[xe,l.value]])]),_:1}),Y(J,{label:"短信审核",name:"sms"},{default:ee(()=>[Z("div",Ua,[Z("div",Na,[D[28]||(D[28]=Z("h3",null,"短信审核",-1)),A.value.length>0?(G(),te(q,{key:0,value:A.value.length,class:"badge"},null,8,["value"])):se("",!0)]),Z("div",Ea,[Y(ge,{modelValue:w.value,"onUpdate:modelValue":D[3]||(D[3]=e=>w.value=e),placeholder:"状态筛选",style:{width:"120px","margin-right":"12px"}},{default:ee(()=>[Y(me,{label:"全部",value:""}),Y(me,{label:"待审核",value:"pending"}),Y(me,{label:"已通过",value:"approved"}),Y(me,{label:"已拒绝",value:"rejected"})]),_:1},8,["modelValue"]),Y(F,{modelValue:_.value,"onUpdate:modelValue":D[4]||(D[4]=e=>_.value=e),placeholder:"搜索内容或接收人","prefix-icon":X(g),clearable:"",style:{width:"250px"}},null,8,["modelValue","prefix-icon"])])]),oe((G(),Q("div",$a,[(G(!0),Q(ne,null,ie(P.value,e=>(G(),Q("div",{key:e.id,class:re(["sms-item",{approved:"approved"===e.status,rejected:"rejected"===e.status}])},[Z("div",Ba,[Z("div",Ra,[Z("div",Ma,[Z("h4",null,le(e.templateName||"自定义内容"),1),Y(K,{type:ce(e.status),size:"small"},{default:ee(()=>[ae(le(ue(e.status)),1)]),_:2},1032,["type"])]),Z("div",La,[Z("span",qa,le(e.recipients.length)+" 人",1),Z("span",Fa,le(pe(e.createdAt)),1)])]),Z("div",Ka,[Z("p",ja,le(e.content),1)]),Z("div",Ja,[D[29]||(D[29]=Z("span",{class:"recipients-label"},"接收人：",-1)),Z("div",Wa,[(G(!0),Q(ne,null,ie(e.recipients.slice(0,5),(e,a)=>(G(),te(K,{key:a,size:"small",class:"recipient-tag"},{default:ee(()=>[ae(le(e.name)+" ("+le(e.phone)+") ",1)]),_:2},1024))),128)),e.recipients.length>5?(G(),Q("span",Ha," 等 "+le(e.recipients.length)+" 人 ",1)):se("",!0)])]),e.reason?(G(),Q("div",Qa,[D[30]||(D[30]=Z("span",{class:"reason-label"},"发送原因：",-1)),Z("p",Ga,le(e.reason),1)])):se("",!0),Z("div",Za,[D[31]||(D[31]=Z("span",{class:"applicant-label"},"申请人：",-1)),Z("span",Ya,le(e.applicantName),1),Z("span",Xa,le(e.applicantDept),1)])]),"pending"===e.status?(G(),Q("div",el,[Y(U,{type:"success",icon:X(f),onClick:a=>(async e=>{try{await r.confirm("确定要审核通过这条短信申请吗？","确认审核",{type:"warning"}),await new Promise(e=>setTimeout(e,1e3)),e.status="approved",e.processedAt=(new Date).toLocaleString(),V.pendingSms--,i.success("短信申请已通过，将立即发送")}catch(a){}})(e),class:"approve-btn"},{default:ee(()=>[...D[32]||(D[32]=[ae(" 通过 ",-1)])]),_:1},8,["icon","onClick"]),Y(U,{type:"danger",icon:X(v),onClick:a=>(async e=>{try{const{value:a}=await r.prompt("请输入拒绝原因","审核拒绝",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{5,}/,inputErrorMessage:"拒绝原因至少5个字符"});await new Promise(e=>setTimeout(e,1e3)),e.status="rejected",e.processedAt=(new Date).toLocaleString(),e.rejectReason=a,V.pendingSms--,i.success("短信申请已拒绝")}catch(a){}})(e),class:"reject-btn"},{default:ee(()=>[...D[33]||(D[33]=[ae(" 拒绝 ",-1)])]),_:1},8,["icon","onClick"]),Y(U,{type:"info",icon:X(y),onClick:a=>(e=>{C.value=e,n.value=!0})(e),class:"preview-btn"},{default:ee(()=>[...D[34]||(D[34]=[ae(" 详情 ",-1)])]),_:1},8,["icon","onClick"])])):(G(),Q("div",al,[Z("div",ll,[D[35]||(D[35]=Z("span",{class:"result-label"},"处理结果：",-1)),Z("span",{class:re(["result-text",e.status])},le(ue(e.status)),3)]),Z("div",tl,[Z("span",null,le(pe(e.processedAt)),1)])]))],2))),128)),0!==P.value.length||t.value?se("",!0):(G(),te(j,{key:0,description:"暂无短信记录","image-size":120}))])),[[xe,t.value]])]),_:1}),Y(J,{label:"发送记录",name:"records"},{default:ee(()=>[Z("div",sl,[D[37]||(D[37]=Z("div",{class:"tab-title"},[Z("h3",null,"发送记录")],-1)),Z("div",ol,[Y(fe,{modelValue:S.value,"onUpdate:modelValue":D[5]||(D[5]=e=>S.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{"margin-right":"12px"}},null,8,["modelValue"]),Y(ge,{modelValue:x.value,"onUpdate:modelValue":D[6]||(D[6]=e=>x.value=e),placeholder:"状态筛选",style:{width:"120px","margin-right":"12px"}},{default:ee(()=>[Y(me,{label:"全部",value:""}),Y(me,{label:"发送成功",value:"success"}),Y(me,{label:"发送失败",value:"failed"}),Y(me,{label:"发送中",value:"sending"})]),_:1},8,["modelValue"]),Y(U,{type:"primary",icon:X(h),onClick:N},{default:ee(()=>[...D[36]||(D[36]=[ae("刷新",-1)])]),_:1},8,["icon"])])]),Z("div",nl,[oe((G(),te(ye,{data:I.value,stripe:"",style:{width:"100%"}},{default:ee(()=>[Y(ve,{prop:"templateName",label:"模板名称",width:"150"},{default:ee(({row:e})=>[Z("span",null,le(e.templateName||"自定义内容"),1)]),_:1}),Y(ve,{prop:"content",label:"短信内容","min-width":"200"},{default:ee(({row:e})=>[Z("div",il,le(e.content),1)]),_:1}),Y(ve,{prop:"recipientCount",label:"接收人数",width:"100",align:"center"},{default:ee(({row:e})=>[Z("span",rl,le(e.recipientCount),1)]),_:1}),Y(ve,{prop:"status",label:"发送状态",width:"100"},{default:ee(({row:e})=>{return[Y(K,{type:(a=e.status,{success:"success",failed:"danger",sending:"warning"}[a]||"info"),size:"small"},{default:ee(()=>[ae(le(de(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),Y(ve,{prop:"successCount",label:"成功/失败",width:"100",align:"center"},{default:ee(({row:e})=>[Z("div",cl,[Z("span",ul,le(e.successCount),1),D[38]||(D[38]=Z("span",{class:"divider"},"/",-1)),Z("span",dl,le(e.failedCount),1)])]),_:1}),Y(ve,{prop:"sentAt",label:"发送时间",width:"160"},{default:ee(({row:e})=>[Z("span",null,le(pe(e.sentAt)),1)]),_:1}),Y(ve,{prop:"operator",label:"操作人",width:"120"},{default:ee(({row:e})=>[Z("span",null,le(e.operator),1)]),_:1}),Y(ve,{label:"操作",width:"120",fixed:"right"},{default:ee(({row:e})=>[Y(U,{size:"small",type:"primary",icon:X(y),onClick:e=>{i.info("查看发送记录详情")}},{default:ee(()=>[...D[39]||(D[39]=[ae(" 详情 ",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[xe,s.value]]),Z("div",pl,[Y(he,{"current-page":T.currentPage,"onUpdate:currentPage":D[7]||(D[7]=e=>T.currentPage=e),"page-size":T.pageSize,"onUpdate:pageSize":D[8]||(D[8]=e=>T.pageSize=e),"page-sizes":[10,20,50,100],total:T.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:R,onCurrentChange:M},null,8,["current-page","page-size","total"])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),Y(we,{modelValue:o.value,"onUpdate:modelValue":D[10]||(D[10]=e=>o.value=e),title:"模板预览",width:"600px",class:"preview-dialog"},{default:ee(()=>[k.value?(G(),Q("div",ml,[Z("div",gl,[Z("h4",null,le(k.value.name),1),Y(K,{type:"warning"},{default:ee(()=>[...D[40]||(D[40]=[ae("待审核",-1)])]),_:1})]),Z("div",fl,[Z("div",vl,[D[41]||(D[41]=Z("h5",null,"模板内容",-1)),Z("div",yl,le(k.value.content),1)]),k.value.variables?.length?(G(),Q("div",hl,[D[42]||(D[42]=Z("h5",null,"变量列表",-1)),Z("div",bl,[(G(!0),Q(ne,null,ie(k.value.variables,e=>(G(),te(K,{key:e,class:"variable-tag"},{default:ee(()=>[ae(le(e),1)]),_:2},1024))),128))])])):se("",!0),Z("div",_l,[Z("div",wl,[D[43]||(D[43]=Z("span",{class:"label"},"分类：",-1)),Z("span",xl,le(L(k.value.category)),1)]),Z("div",Sl,[D[44]||(D[44]=Z("span",{class:"label"},"申请人：",-1)),Z("span",kl,le(k.value.applicantName),1)]),Z("div",Cl,[D[45]||(D[45]=Z("span",{class:"label"},"申请时间：",-1)),Z("span",Vl,le(pe(k.value.createdAt)),1)])]),k.value.description?(G(),Q("div",zl,[D[46]||(D[46]=Z("h5",null,"申请说明",-1)),Z("div",Al,le(k.value.description),1)])):se("",!0)])])):se("",!0)]),_:1},8,["modelValue"]),Y(we,{modelValue:n.value,"onUpdate:modelValue":D[11]||(D[11]=e=>n.value=e),title:"短信详情",width:"800px",class:"detail-dialog"},{default:ee(()=>[C.value?(G(),Q("div",Il,[Z("div",Tl,[Z("h4",null,le(C.value.templateName||"自定义短信"),1),Y(K,{type:ce(C.value.status)},{default:ee(()=>[ae(le(ue(C.value.status)),1)]),_:1},8,["type"])]),Z("div",Ol,[Z("div",Pl,[D[47]||(D[47]=Z("h5",null,"短信内容",-1)),Z("div",Dl,le(C.value.content),1)]),Z("div",Ul,[Z("h5",null,"接收人列表 ("+le(C.value.recipients.length)+" 人)",1),Z("div",Nl,[Y(ye,{data:C.value.recipients,"max-height":"300"},{default:ee(()=>[Y(ve,{prop:"name",label:"姓名",width:"120"}),Y(ve,{prop:"phone",label:"手机号",width:"140"}),Y(ve,{prop:"department",label:"部门",width:"120"}),Y(ve,{prop:"status",label:"发送状态",width:"100"},{default:ee(({row:e})=>[Y(K,{type:"success"===e.status?"success":"failed"===e.status?"danger":"warning",size:"small"},{default:ee(()=>[ae(le("success"===e.status?"成功":"failed"===e.status?"失败":"待发送"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])])]),Z("div",El,[Z("div",$l,[D[48]||(D[48]=Z("span",{class:"label"},"申请人：",-1)),Z("span",Bl,le(C.value.applicantName),1)]),Z("div",Rl,[D[49]||(D[49]=Z("span",{class:"label"},"申请部门：",-1)),Z("span",Ml,le(C.value.applicantDept),1)]),Z("div",Ll,[D[50]||(D[50]=Z("span",{class:"label"},"申请时间：",-1)),Z("span",ql,le(pe(C.value.createdAt)),1)]),C.value.processedAt?(G(),Q("div",Fl,[D[51]||(D[51]=Z("span",{class:"label"},"处理时间：",-1)),Z("span",Kl,le(pe(C.value.processedAt)),1)])):se("",!0)]),C.value.reason?(G(),Q("div",jl,[D[52]||(D[52]=Z("h5",null,"发送原因",-1)),Z("div",Jl,le(C.value.reason),1)])):se("",!0)])])):se("",!0)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-440989b0"]]),Hl={class:"health-check-notification-settings"},Ql={class:"card-header"},Gl={key:0,class:"no-permission"},Zl={key:1,class:"settings-content"},Yl={class:"status-section"},Xl={class:"preference-section"},et={class:"current-preference"},at={class:"suppress-time"},lt={class:"suppress-time"},tt={class:"last-notification"},st={class:"test-section"},ot={class:"info-section"},nt=a(L({__name:"HealthCheckNotificationSettings",setup(e){const a=l(),o=q(!1),n=q({suppressType:"none",suppressUntil:null,lastNotificationTime:null}),c=K(()=>a.isSuperAdmin),u=K(()=>t.isApiMode()),d=K(()=>{const e=localStorage.getItem("api_health_check_errors");return e&&JSON.parse(e).count||0}),p=K(()=>{const e=localStorage.getItem("api_health_check_errors");if(e){const a=JSON.parse(e);return a.lastCheck?new Date(a.lastCheck).toLocaleString():null}return null}),m=K(()=>"none"===n.value.suppressType),g=()=>{switch(n.value.suppressType){case"none":return"正常接收";case"today":return"今天已暂停";case"month":return"一个月已暂停";default:return"未知状态"}},f=e=>e?new Date(e).toLocaleString():"",v=async e=>{const l=a.currentUser?.id;if(l)try{if("none"===e)n.value={suppressType:"none",suppressUntil:null,lastNotificationTime:n.value.lastNotificationTime},s.clearAllPreferences(),i.success("已恢复API健康检查通知");else{const a=Date.now();let t;if("today"===e){const e=new Date;e.setDate(e.getDate()+1),e.setHours(0,0,0,0),t=e.getTime(),i.success("已设置今天不再提醒API健康检查失败")}else t=a+2592e6,i.success("已设置一个月内不再提醒API健康检查失败");n.value={suppressType:e,suppressUntil:t,lastNotificationTime:n.value.lastNotificationTime};s.setSuppression(l,e)}}catch(t){console.error("设置通知偏好失败:",t),i.error("设置失败，请重试")}else i.error("用户信息获取失败")},y=async()=>{o.value=!0;try{await s.showHealthCheckFailureNotification("这是一个测试通知")}catch(e){console.error("测试通知失败:",e)}finally{o.value=!1}},h=async()=>{try{await r.confirm("确定要清除所有用户的通知偏好设置吗？此操作不可撤销。","确认清除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),s.clearAllPreferences(),b(),i.success("已清除所有通知偏好设置")}catch{}},b=()=>{const e=a.currentUser?.id;if(!e)return;const l=s.getUserPreference(e);l&&(n.value={suppressType:l.suppressType,suppressUntil:l.suppressUntil,lastNotificationTime:l.lastNotificationTime})};return j(()=>{b()}),(e,a)=>{const l=W("el-tag"),t=W("el-result"),s=W("el-descriptions-item"),i=W("el-descriptions"),r=W("el-form-item"),b=W("el-button"),_=W("el-button-group"),w=W("el-form"),x=W("el-alert"),S=W("el-card");return G(),Q("div",Hl,[Y(S,{class:"setting-card"},{header:ee(()=>[Z("div",Ql,[a[4]||(a[4]=Z("span",null,"API健康检查通知设置",-1)),c.value?se("",!0):(G(),te(l,{key:0,type:"info",size:"small"},{default:ee(()=>[...a[3]||(a[3]=[ae(" 仅超级管理员可见 ",-1)])]),_:1}))])]),default:ee(()=>[c.value?(G(),Q("div",Zl,[Z("div",Yl,[a[5]||(a[5]=Z("h4",null,"当前状态",-1)),Y(i,{column:2,border:""},{default:ee(()=>[Y(s,{label:"API状态"},{default:ee(()=>[Y(l,{type:u.value?"success":"danger"},{default:ee(()=>[ae(le(u.value?"正常":"异常"),1)]),_:1},8,["type"])]),_:1}),Y(s,{label:"通知状态"},{default:ee(()=>[Y(l,{type:m.value?"success":"warning"},{default:ee(()=>[ae(le(g()),1)]),_:1},8,["type"])]),_:1}),Y(s,{label:"上次检查时间"},{default:ee(()=>[ae(le(p.value||"暂无"),1)]),_:1}),Y(s,{label:"错误次数"},{default:ee(()=>[ae(le(d.value),1)]),_:1})]),_:1})]),Z("div",Xl,[a[12]||(a[12]=Z("h4",null,"通知偏好",-1)),Y(w,{model:n.value,"label-width":"140px"},{default:ee(()=>[Y(r,{label:"当前设置"},{default:ee(()=>[Z("div",et,["none"===n.value.suppressType?(G(),te(l,{key:0,type:"success"},{default:ee(()=>[...a[6]||(a[6]=[ae(" 正常接收通知 ",-1)])]),_:1})):"today"===n.value.suppressType?(G(),te(l,{key:1,type:"warning"},{default:ee(()=>[a[7]||(a[7]=ae(" 今天不再提醒 ",-1)),Z("span",at," (至 "+le(f(n.value.suppressUntil))+") ",1)]),_:1})):"month"===n.value.suppressType?(G(),te(l,{key:2,type:"info"},{default:ee(()=>[a[8]||(a[8]=ae(" 一个月不再提醒 ",-1)),Z("span",lt," (至 "+le(f(n.value.suppressUntil))+") ",1)]),_:1})):se("",!0)])]),_:1}),Y(r,{label:"快速设置"},{default:ee(()=>[Y(_,null,{default:ee(()=>[Y(b,{onClick:a[0]||(a[0]=e=>v("none")),type:"none"===n.value.suppressType?"primary":"default"},{default:ee(()=>[...a[9]||(a[9]=[ae(" 恢复通知 ",-1)])]),_:1},8,["type"]),Y(b,{onClick:a[1]||(a[1]=e=>v("today")),type:"today"===n.value.suppressType?"primary":"default"},{default:ee(()=>[...a[10]||(a[10]=[ae(" 今天不再提醒 ",-1)])]),_:1},8,["type"]),Y(b,{onClick:a[2]||(a[2]=e=>v("month")),type:"month"===n.value.suppressType?"primary":"default"},{default:ee(()=>[...a[11]||(a[11]=[ae(" 一个月不再提醒 ",-1)])]),_:1},8,["type"])]),_:1})]),_:1}),Y(r,{label:"上次通知时间"},{default:ee(()=>[Z("span",tt,le(n.value.lastNotificationTime?new Date(n.value.lastNotificationTime).toLocaleString():"暂无通知记录"),1)]),_:1})]),_:1},8,["model"])]),Z("div",st,[a[17]||(a[17]=Z("h4",null,"测试功能",-1)),Y(w,{"label-width":"140px"},{default:ee(()=>[Y(r,{label:"手动测试"},{default:ee(()=>[Y(b,{onClick:y,loading:o.value,type:"warning"},{default:ee(()=>[...a[13]||(a[13]=[ae(" 模拟API失败通知 ",-1)])]),_:1},8,["loading"]),a[14]||(a[14]=Z("span",{class:"test-tip"}," 点击此按钮可以测试API健康检查失败时的通知效果 ",-1))]),_:1}),Y(r,{label:"清除设置"},{default:ee(()=>[Y(b,{onClick:h,type:"danger",plain:""},{default:ee(()=>[...a[15]||(a[15]=[ae(" 清除所有通知偏好 ",-1)])]),_:1}),a[16]||(a[16]=Z("span",{class:"clear-tip"}," 清除所有用户的通知偏好设置，恢复默认状态 ",-1))]),_:1})]),_:1})]),Z("div",ot,[Y(x,{title:"功能说明",type:"info",closable:!1,"show-icon":""},{default:ee(()=>[...a[18]||(a[18]=[Z("ul",{class:"info-list"},[Z("li",null,"API健康检查每12小时自动执行一次（每天2次）"),Z("li",null,"只有超级管理员才能看到API失败通知"),Z("li",null,'可以设置"今天不再提醒"或"一个月不再提醒"'),Z("li",null,"系统会自动记住您的通知偏好设置"),Z("li",null,"API恢复正常后，错误计数会自动重置")],-1)])]),_:1})])])):(G(),Q("div",Gl,[Y(t,{icon:"info",title:"权限提示","sub-title":"API健康检查通知功能仅对超级管理员开放"})]))]),_:1})])}}}),[["__scopeId","data-v-617f40f4"]]),it={class:"order-settings-container"},rt={class:"card-header"},ct={class:"options-preview"},ut={class:"card-header"},dt={class:"card-header"},pt={class:"card-header"},mt={class:"card-header"},gt={class:"save-actions"},ft={class:"options-editor"},vt={class:"options-editor"},yt=a(L({__name:"OrderSettings",setup(e){const a=ge(),l=F({orderSourceFieldName:"",orderSourceOptions:[],customFields:[]}),t=F({mode:"delayed",delayMinutes:3}),s=q(!1),o=q([]),n=q(!1),u=q(!1),d=q(!1),p=q(!1),m=q(""),g=F({label:"",value:"",sortOrder:0}),f=async()=>{try{n.value=!0;const e=localStorage.getItem("auth_token"),a=await fetch("/api/v1/system/payment-methods/all",{headers:{Authorization:`Bearer ${e}`}}),l=await a.json();l.success&&l.data&&(o.value=l.data)}catch(e){console.error("加载支付方式失败:",e)}finally{n.value=!1}},v=()=>{d.value=!1,m.value="",g.label="",g.value="",g.sortOrder=o.value.length+1,u.value=!0},y=async()=>{if(g.label&&g.value)try{p.value=!0;const e=localStorage.getItem("auth_token"),a=d.value?`/api/v1/system/payment-methods/${m.value}`:"/api/v1/system/payment-methods",l=d.value?"PUT":"POST",t=await fetch(a,{method:l,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(g)}),s=await t.json();s.success?(i.success(d.value?"支付方式更新成功":"支付方式添加成功"),u.value=!1,f()):i.error(s.message||"操作失败")}catch(e){console.error("保存支付方式失败:",e),i.error("保存失败")}finally{p.value=!1}else i.warning("请填写完整信息")},h=e=>{t.delayMinutes="immediate"===e?0:3},_=async()=>{try{s.value=!0;const e=localStorage.getItem("auth_token"),a=await fetch("/api/v1/system/order-transfer-config",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({mode:t.mode,delayMinutes:"immediate"===t.mode?0:t.delayMinutes})}),l=await a.json();l.success?i.success("流转配置保存成功，已全局生效"):i.error(l.message||"保存失败")}catch(e){console.error("保存流转配置失败:",e),i.error("保存流转配置失败")}finally{s.value=!1}},w=q(!1),x=q(!1),S=q(!1),k=q(-1),C=q(!1),V=q(),z=F({fieldName:"",options:[]}),A=F({fieldName:"",fieldKey:"",fieldType:"text",required:!1,placeholder:"",showInList:!0,options:[]}),I={fieldName:[{required:!0,message:"请输入字段名称",trigger:"blur"}],fieldKey:[{required:!0,message:"请输入字段键名",trigger:"blur"},{pattern:/^[a-zA-Z][a-zA-Z0-9_]*$/,message:"字段键名必须以字母开头，只能包含字母、数字和下划线",trigger:"blur"}],fieldType:[{required:!0,message:"请选择字段类型",trigger:"change"}]},T=e=>({text:"文本",number:"数字",date:"日期",datetime:"日期时间",select:"下拉选择",radio:"单选",checkbox:"多选"}[e]||e),O=()=>{l.orderSourceFieldName=a.orderSourceFieldName,l.orderSourceOptions=JSON.parse(JSON.stringify(a.orderSourceOptions)),l.customFields=JSON.parse(JSON.stringify(a.customFields))},P=()=>{z.fieldName=l.orderSourceFieldName,z.options=JSON.parse(JSON.stringify(l.orderSourceOptions)),w.value=!0},D=()=>{if(z.fieldName.trim())if(0!==z.options.length){for(const e of z.options)if(!e.label.trim()||!e.value.trim())return void i.warning("请填写完整的选项信息");l.orderSourceFieldName=z.fieldName,l.orderSourceOptions=JSON.parse(JSON.stringify(z.options)),w.value=!1,i.success('订单来源配置已更新，请点击"保存配置"按钮保存')}else i.warning("请至少添加一个选项");else i.warning("请输入字段名称")},U=()=>{z.options.push({label:"",value:""})},N=()=>{S.value=!1,k.value=-1,Object.assign(A,{fieldName:"",fieldKey:"",fieldType:"text",required:!1,placeholder:"",showInList:!0,options:[]}),x.value=!0},E=async()=>{try{if(await(V.value?.validate()),!S.value){if(l.customFields.some(e=>e.fieldKey===A.fieldKey))return void i.warning("字段键名已存在，请使用其他键名")}if(["select","radio","checkbox"].includes(A.fieldType)){if(0===A.options.length)return void i.warning("请至少添加一个选项");for(const e of A.options)if(!e.label.trim()||!e.value.trim())return void i.warning("请填写完整的选项信息")}if(S.value){const e=l.customFields[k.value];e.fieldName=A.fieldName,e.required=A.required,e.placeholder=A.placeholder,e.showInList=A.showInList,A.options.length>0&&(e.options=JSON.parse(JSON.stringify(A.options))),i.success('字段已更新，请点击"保存配置"按钮保存')}else{const e={id:"field_"+Date.now(),fieldName:A.fieldName,fieldKey:A.fieldKey,fieldType:A.fieldType,required:A.required,placeholder:A.placeholder,showInList:A.showInList,sortOrder:l.customFields.length,options:A.options.length>0?JSON.parse(JSON.stringify(A.options)):void 0};l.customFields.push(e),i.success('字段已添加，请点击"保存配置"按钮保存')}x.value=!1}catch(e){console.error("保存字段失败:",e)}},$=()=>{A.options.push({label:"",value:""})},B=async()=>{try{if(C.value=!0,!l.orderSourceFieldName.trim())return void i.warning("请配置订单来源字段名称");if(0===l.orderSourceOptions.length)return void i.warning("请至少添加一个订单来源选项");a.updateOrderSourceConfig(l.orderSourceFieldName,l.orderSourceOptions);const e=[...a.customFields];for(const l of e)a.deleteCustomField(l.id);for(const t of l.customFields)a.addCustomField({fieldName:t.fieldName,fieldKey:t.fieldKey,fieldType:t.fieldType,required:t.required,placeholder:t.placeholder,showInList:t.showInList,options:t.options});i.success("配置保存成功，已全局生效")}catch(e){console.error("保存配置失败:",e),i.error("保存配置失败")}finally{C.value=!1}},R=async()=>{try{await r.confirm("确定要重置配置吗？将恢复到当前保存的配置。","确认重置",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),O(),i.success("配置已重置")}catch{}},M=q([]),L=q([]),K=q(""),J=q(!1),re=q(!1),ce=F({departmentId:"",departmentName:"",orderCountEnabled:!1,maxOrderCount:1,singleAmountEnabled:!1,maxSingleAmount:1e4,totalAmountEnabled:!1,maxTotalAmount:5e4,isEnabled:!0,remark:""}),ue=async()=>{try{const e=localStorage.getItem("auth_token"),a=await fetch("/api/v1/system/department-order-limits",{headers:{Authorization:`Bearer ${e}`}}),l=await a.json();l.success&&l.data&&(L.value=l.data)}catch(e){console.error("加载部门下单限制配置失败:",e)}},de=async e=>{if(!e)return;const a=L.value.find(a=>a.departmentId===e);a&&Object.assign(ce,a)},pe=()=>{if(!K.value)return void i.warning("请先选择部门");const e=M.value.find(e=>e.id===K.value);if(!e)return;const a=L.value.find(e=>e.departmentId===K.value);a?Object.assign(ce,a):(ce.departmentId=e.id,ce.departmentName=e.name,ce.orderCountEnabled=!1,ce.maxOrderCount=1,ce.singleAmountEnabled=!1,ce.maxSingleAmount=1e4,ce.totalAmountEnabled=!1,ce.maxTotalAmount=5e4,ce.isEnabled=!0,ce.remark=""),J.value=!0},me=async()=>{try{re.value=!0;const e=localStorage.getItem("auth_token"),a=await fetch("/api/v1/system/department-order-limits",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(ce)}),l=await a.json();l.success?(i.success("部门下单限制配置保存成功"),J.value=!1,await ue()):i.error(l.message||"保存失败")}catch(e){console.error("保存部门下单限制配置失败:",e),i.error("保存失败")}finally{re.value=!1}};return j(()=>{O(),(async()=>{try{const e=localStorage.getItem("auth_token"),a=await fetch("/api/v1/system/order-transfer-config",{headers:{Authorization:`Bearer ${e}`}}),l=await a.json();l.success&&l.data&&(t.mode=l.data.mode||"delayed",t.delayMinutes=l.data.delayMinutes??3)}catch(e){console.error("加载流转配置失败:",e)}})(),(async()=>{try{const e=localStorage.getItem("auth_token"),a=await fetch("/api/v1/system/departments",{headers:{Authorization:`Bearer ${e}`}}),l=await a.json();l.success&&l.data&&(M.value=l.data,console.log("[订单设置] 加载部门列表成功:",M.value.length,"个部门"))}catch(e){console.error("加载部门列表失败:",e)}})(),ue(),f()}),(e,a)=>{const O=W("el-button"),q=W("el-descriptions-item"),F=W("el-descriptions"),j=W("el-tag"),ge=W("el-card"),fe=W("el-table-column"),ve=W("el-table"),ye=W("el-empty"),he=W("el-radio"),be=W("el-radio-group"),_e=W("el-form-item"),we=W("el-input-number"),xe=W("el-form"),Se=W("el-switch"),ke=W("el-input"),Ce=W("el-dialog"),Ve=W("el-alert"),ze=W("el-option"),Ae=W("el-select"),Ie=W("el-divider"),Te=H("loading");return G(),Q("div",it,[a[79]||(a[79]=Z("div",{class:"page-header"},[Z("h2",null,"订单设置"),Z("p",null,"配置订单字段和自定义字段")],-1)),Y(ge,{class:"config-card"},{header:ee(()=>[Z("div",rt,[a[30]||(a[30]=Z("span",null,"订单来源配置",-1)),Y(O,{type:"primary",size:"small",onClick:P},{default:ee(()=>[...a[29]||(a[29]=[ae(" 编辑配置 ",-1)])]),_:1})])]),default:ee(()=>[Y(F,{column:2,border:""},{default:ee(()=>[Y(q,{label:"字段名称"},{default:ee(()=>[ae(le(l.orderSourceFieldName),1)]),_:1}),Y(q,{label:"选项数量"},{default:ee(()=>[ae(le(l.orderSourceOptions.length)+" 个 ",1)]),_:1})]),_:1}),Z("div",ct,[a[31]||(a[31]=Z("h4",null,"当前选项:",-1)),(G(!0),Q(ne,null,ie(l.orderSourceOptions,e=>(G(),te(j,{key:e.value,style:{margin:"5px"}},{default:ee(()=>[ae(le(e.label),1)]),_:2},1024))),128))])]),_:1}),Y(ge,{class:"config-card"},{header:ee(()=>[Z("div",ut,[a[33]||(a[33]=Z("span",null,"自定义字段管理",-1)),Y(O,{type:"primary",size:"small",icon:X(c),onClick:N},{default:ee(()=>[...a[32]||(a[32]=[ae(" 添加字段 ",-1)])]),_:1},8,["icon"])])]),default:ee(()=>[l.customFields.length>0?(G(),te(ve,{key:0,data:l.customFields,style:{width:"100%"}},{default:ee(()=>[Y(fe,{prop:"fieldName",label:"字段名称",width:"150"}),Y(fe,{prop:"fieldKey",label:"字段键名",width:"150"}),Y(fe,{prop:"fieldType",label:"字段类型",width:"120"},{default:ee(({row:e})=>{return[Y(j,{type:(a=e.fieldType,{text:"primary",number:"success",date:"warning",datetime:"warning",select:"info",radio:"danger",checkbox:"danger"}[a]||"primary"),size:"small"},{default:ee(()=>[ae(le(T(e.fieldType)),1)]),_:2},1032,["type"])];var a}),_:1}),Y(fe,{prop:"required",label:"必填",width:"80"},{default:ee(({row:e})=>[Y(j,{type:e.required?"danger":"info",size:"small"},{default:ee(()=>[ae(le(e.required?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),Y(fe,{prop:"showInList",label:"列表显示",width:"100"},{default:ee(({row:e})=>[Y(j,{type:e.showInList?"success":"info",size:"small"},{default:ee(()=>[ae(le(e.showInList?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),Y(fe,{prop:"placeholder",label:"占位符","min-width":"150","show-overflow-tooltip":""}),Y(fe,{label:"操作",width:"200",fixed:"right"},{default:ee(({row:e,$index:t})=>[Y(O,{size:"small",type:"primary",link:"",onClick:a=>{return l=e,s=t,S.value=!0,k.value=s,Object.assign(A,{fieldName:l.fieldName,fieldKey:l.fieldKey,fieldType:l.fieldType,required:l.required,placeholder:l.placeholder||"",showInList:l.showInList,options:l.options?JSON.parse(JSON.stringify(l.options)):[]}),void(x.value=!0);var l,s}},{default:ee(()=>[...a[34]||(a[34]=[ae(" 编辑 ",-1)])]),_:1},8,["onClick"]),Y(O,{size:"small",link:"",onClick:e=>(e=>{if(e>0){const a=l.customFields[e];l.customFields[e]=l.customFields[e-1],l.customFields[e-1]=a,l.customFields.forEach((e,a)=>{e.sortOrder=a}),i.success('字段已上移，请点击"保存配置"按钮保存')}})(t),disabled:0===t},{default:ee(()=>[...a[35]||(a[35]=[ae(" 上移 ",-1)])]),_:1},8,["onClick","disabled"]),Y(O,{size:"small",link:"",onClick:e=>(e=>{if(e<l.customFields.length-1){const a=l.customFields[e];l.customFields[e]=l.customFields[e+1],l.customFields[e+1]=a,l.customFields.forEach((e,a)=>{e.sortOrder=a}),i.success('字段已下移，请点击"保存配置"按钮保存')}})(t),disabled:t===l.customFields.length-1},{default:ee(()=>[...a[36]||(a[36]=[ae(" 下移 ",-1)])]),_:1},8,["onClick","disabled"]),Y(O,{size:"small",type:"danger",link:"",onClick:e=>(async e=>{try{const a=l.customFields[e];await r.confirm(`确定要删除字段"${a.fieldName}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),l.customFields.splice(e,1),l.customFields.forEach((e,a)=>{e.sortOrder=a}),i.success('字段已删除，请点击"保存配置"按钮保存')}catch{}})(t)},{default:ee(()=>[...a[37]||(a[37]=[ae(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(G(),te(ye,{key:1,description:"暂无自定义字段，点击上方【添加字段】按钮开始配置"}))]),_:1}),Y(ge,{class:"config-card"},{header:ee(()=>[Z("div",dt,[a[39]||(a[39]=Z("span",null,"订单流转时间配置",-1)),Y(j,{type:"warning",size:"small"},{default:ee(()=>[...a[38]||(a[38]=[ae("全局生效",-1)])]),_:1})])]),default:ee(()=>[Y(xe,{"label-width":"140px"},{default:ee(()=>[Y(_e,{label:"流转模式"},{default:ee(()=>[Y(be,{modelValue:t.mode,"onUpdate:modelValue":a[0]||(a[0]=e=>t.mode=e),onChange:h},{default:ee(()=>[Y(he,{label:"immediate"},{default:ee(()=>[...a[40]||(a[40]=[ae("无等待（立即流转）",-1)])]),_:1}),Y(he,{label:"delayed"},{default:ee(()=>[...a[41]||(a[41]=[ae("延迟流转",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"delayed"===t.mode?(G(),te(_e,{key:0,label:"流转等待时间"},{default:ee(()=>[Y(we,{modelValue:t.delayMinutes,"onUpdate:modelValue":a[1]||(a[1]=e=>t.delayMinutes=e),min:1,max:1440,step:1,style:{width:"200px"}},null,8,["modelValue"]),a[42]||(a[42]=Z("span",{style:{"margin-left":"10px",color:"#666"}},"分钟",-1)),a[43]||(a[43]=Z("div",{class:"form-tip"}," 订单创建后，将在设定时间后自动流转到审核。范围：1-1440分钟（最长24小时） ",-1))]),_:1})):se("",!0),Y(_e,{label:"当前配置预览"},{default:ee(()=>[Y(j,{type:"immediate"===t.mode?"success":"warning",size:"large"},{default:ee(()=>[ae(le("immediate"===t.mode?"订单创建后立即流转到审核":`订单创建后 ${t.delayMinutes} 分钟后流转到审核`),1)]),_:1},8,["type"])]),_:1}),Y(_e,null,{default:ee(()=>[Y(O,{type:"primary",onClick:_,loading:s.value},{default:ee(()=>[...a[44]||(a[44]=[ae(" 保存流转配置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),Y(ge,{class:"config-card"},{header:ee(()=>[Z("div",pt,[a[46]||(a[46]=Z("span",null,"支付方式配置",-1)),Y(O,{type:"primary",size:"small",icon:X(c),onClick:v},{default:ee(()=>[...a[45]||(a[45]=[ae(" 添加支付方式 ",-1)])]),_:1},8,["icon"])])]),default:ee(()=>[o.value.length>0?oe((G(),te(ve,{key:0,data:o.value,style:{width:"100%"}},{default:ee(()=>[Y(fe,{prop:"label",label:"支付方式名称",width:"200"}),Y(fe,{prop:"value",label:"选项值",width:"150"}),Y(fe,{prop:"sortOrder",label:"排序",width:"100"}),Y(fe,{label:"启用",width:"100"},{default:ee(({row:e})=>[Y(Se,{modelValue:e.isEnabled,"onUpdate:modelValue":a=>e.isEnabled=a,onChange:a=>(async e=>{try{e.toggling=!0;const a=localStorage.getItem("auth_token"),l=await fetch(`/api/v1/system/payment-methods/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({isEnabled:e.isEnabled})}),t=await l.json();t.success?i.success(e.isEnabled?"已启用":"已禁用"):(e.isEnabled=!e.isEnabled,i.error(t.message||"操作失败"))}catch(a){console.error("切换状态失败:",a),e.isEnabled=!e.isEnabled,i.error("切换状态失败")}finally{e.toggling=!1}})(e),loading:e.toggling},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),_:1}),Y(fe,{label:"操作",width:"150",fixed:"right"},{default:ee(({row:e})=>[Y(O,{size:"small",type:"primary",link:"",onClick:a=>(e=>{d.value=!0,m.value=e.id,g.label=e.label,g.value=e.value,g.sortOrder=e.sortOrder,u.value=!0})(e)},{default:ee(()=>[...a[47]||(a[47]=[ae(" 编辑 ",-1)])]),_:1},8,["onClick"]),Y(O,{size:"small",type:"danger",link:"",onClick:a=>(async e=>{try{await r.confirm("确定要删除该支付方式吗？","确认删除",{type:"warning"});const a=localStorage.getItem("auth_token"),l=await fetch(`/api/v1/system/payment-methods/${e.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});(await l.json()).success&&(i.success("删除成功"),f())}catch(a){"cancel"!==a&&console.error("删除失败:",a)}})(e)},{default:ee(()=>[...a[48]||(a[48]=[ae(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Te,n.value]]):(G(),te(ye,{key:1,description:"暂无支付方式配置，点击上方【添加支付方式】按钮开始配置"}))]),_:1}),Y(Ce,{modelValue:u.value,"onUpdate:modelValue":a[6]||(a[6]=e=>u.value=e),title:d.value?"编辑支付方式":"添加支付方式",width:"500px"},{footer:ee(()=>[Y(O,{onClick:a[5]||(a[5]=e=>u.value=!1)},{default:ee(()=>[...a[49]||(a[49]=[ae("取消",-1)])]),_:1}),Y(O,{type:"primary",onClick:y,loading:p.value},{default:ee(()=>[...a[50]||(a[50]=[ae("保存",-1)])]),_:1},8,["loading"])]),default:ee(()=>[Y(xe,{model:g,"label-width":"100px"},{default:ee(()=>[Y(_e,{label:"名称",required:""},{default:ee(()=>[Y(ke,{modelValue:g.label,"onUpdate:modelValue":a[2]||(a[2]=e=>g.label=e),placeholder:"请输入支付方式名称"},null,8,["modelValue"])]),_:1}),Y(_e,{label:"选项值",required:""},{default:ee(()=>[Y(ke,{modelValue:g.value,"onUpdate:modelValue":a[3]||(a[3]=e=>g.value=e),placeholder:"请输入选项值（英文）",disabled:d.value},null,8,["modelValue","disabled"])]),_:1}),Y(_e,{label:"排序"},{default:ee(()=>[Y(we,{modelValue:g.sortOrder,"onUpdate:modelValue":a[4]||(a[4]=e=>g.sortOrder=e),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),Y(ge,{class:"config-card"},{header:ee(()=>[Z("div",mt,[a[52]||(a[52]=Z("span",null,"部门下单限制配置",-1)),Y(j,{type:"danger",size:"small"},{default:ee(()=>[...a[51]||(a[51]=[ae("全局生效",-1)])]),_:1})])]),default:ee(()=>[Y(Ve,{type:"info",closable:!1,style:{"margin-bottom":"20px"}},{title:ee(()=>[...a[53]||(a[53]=[ae(" 配置说明：可针对不同部门设置同一客户的下单次数、单笔金额、累计金额限制。配置后，该部门成员创建订单时将自动验证限制条件。 ",-1)])]),_:1}),Y(xe,{"label-width":"140px"},{default:ee(()=>[Y(_e,{label:"选择部门"},{default:ee(()=>[Y(Ae,{modelValue:K.value,"onUpdate:modelValue":a[7]||(a[7]=e=>K.value=e),placeholder:"请选择要配置的部门",style:{width:"300px"},onChange:de,clearable:""},{default:ee(()=>[(G(!0),Q(ne,null,ie(M.value,e=>(G(),te(ze,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Y(O,{type:"primary",icon:X(c),style:{"margin-left":"10px"},onClick:pe,disabled:!K.value},{default:ee(()=>[...a[54]||(a[54]=[ae(" 添加/编辑配置 ",-1)])]),_:1},8,["icon","disabled"])]),_:1})]),_:1}),L.value.length>0?(G(),te(ve,{key:0,data:L.value,style:{width:"100%"}},{default:ee(()=>[Y(fe,{prop:"departmentName",label:"部门名称",width:"150"}),Y(fe,{label:"下单次数限制",width:"180"},{default:ee(({row:e})=>[e.orderCountEnabled?(G(),te(j,{key:0,type:"warning",size:"small"},{default:ee(()=>[ae(" 最多"+le(e.maxOrderCount)+"次 ",1)]),_:2},1024)):(G(),te(j,{key:1,type:"info",size:"small"},{default:ee(()=>[...a[55]||(a[55]=[ae("无限制",-1)])]),_:1}))]),_:1}),Y(fe,{label:"单笔金额限制",width:"180"},{default:ee(({row:e})=>[e.singleAmountEnabled?(G(),te(j,{key:0,type:"warning",size:"small"},{default:ee(()=>[ae(" 最高¥"+le(e.maxSingleAmount),1)]),_:2},1024)):(G(),te(j,{key:1,type:"info",size:"small"},{default:ee(()=>[...a[56]||(a[56]=[ae("无限制",-1)])]),_:1}))]),_:1}),Y(fe,{label:"累计金额限制",width:"180"},{default:ee(({row:e})=>[e.totalAmountEnabled?(G(),te(j,{key:0,type:"warning",size:"small"},{default:ee(()=>[ae(" 最高¥"+le(e.maxTotalAmount),1)]),_:2},1024)):(G(),te(j,{key:1,type:"info",size:"small"},{default:ee(()=>[...a[57]||(a[57]=[ae("无限制",-1)])]),_:1}))]),_:1}),Y(fe,{prop:"isEnabled",label:"状态",width:"100"},{default:ee(({row:e})=>[Y(j,{type:e.isEnabled?"success":"danger",size:"small"},{default:ee(()=>[ae(le(e.isEnabled?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),Y(fe,{label:"操作",width:"150",fixed:"right"},{default:ee(({row:e})=>[Y(O,{size:"small",type:"primary",link:"",onClick:a=>(e=>{Object.assign(ce,e),J.value=!0})(e)},{default:ee(()=>[...a[58]||(a[58]=[ae(" 编辑 ",-1)])]),_:1},8,["onClick"]),Y(O,{size:"small",type:"danger",link:"",onClick:a=>(async e=>{try{await r.confirm(`确定要删除部门"${e.departmentName}"的下单限制配置吗？`,"确认删除",{type:"warning"});const a=localStorage.getItem("auth_token"),l=await fetch(`/api/v1/system/department-order-limits/${e.departmentId}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}}),t=await l.json();t.success?(i.success("删除成功"),await ue()):i.error(t.message||"删除失败")}catch(a){"cancel"!==a&&(console.error("删除部门下单限制配置失败:",a),i.error("删除失败"))}})(e)},{default:ee(()=>[...a[59]||(a[59]=[ae(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(G(),te(ye,{key:1,description:"暂无部门下单限制配置"}))]),_:1}),Y(Ce,{modelValue:J.value,"onUpdate:modelValue":a[17]||(a[17]=e=>J.value=e),title:"部门下单限制配置",width:"600px","close-on-click-modal":!1},{footer:ee(()=>[Y(O,{onClick:a[16]||(a[16]=e=>J.value=!1)},{default:ee(()=>[...a[67]||(a[67]=[ae("取消",-1)])]),_:1}),Y(O,{type:"primary",onClick:me,loading:re.value},{default:ee(()=>[...a[68]||(a[68]=[ae(" 保存配置 ",-1)])]),_:1},8,["loading"])]),default:ee(()=>[Y(xe,{model:ce,"label-width":"140px"},{default:ee(()=>[Y(_e,{label:"部门"},{default:ee(()=>[Y(j,{size:"large"},{default:ee(()=>[ae(le(ce.departmentName),1)]),_:1})]),_:1}),Y(Ie,{"content-position":"left"},{default:ee(()=>[...a[60]||(a[60]=[ae("下单次数限制",-1)])]),_:1}),Y(_e,{label:"启用限制"},{default:ee(()=>[Y(Se,{modelValue:ce.orderCountEnabled,"onUpdate:modelValue":a[8]||(a[8]=e=>ce.orderCountEnabled=e)},null,8,["modelValue"])]),_:1}),ce.orderCountEnabled?(G(),te(_e,{key:0,label:"最大下单次数"},{default:ee(()=>[Y(we,{modelValue:ce.maxOrderCount,"onUpdate:modelValue":a[9]||(a[9]=e=>ce.maxOrderCount=e),min:1,max:100},null,8,["modelValue"]),a[61]||(a[61]=Z("span",{style:{"margin-left":"10px",color:"#666"}},"次（同一客户在该部门最多下单次数）",-1))]),_:1})):se("",!0),Y(Ie,{"content-position":"left"},{default:ee(()=>[...a[62]||(a[62]=[ae("单笔金额限制",-1)])]),_:1}),Y(_e,{label:"启用限制"},{default:ee(()=>[Y(Se,{modelValue:ce.singleAmountEnabled,"onUpdate:modelValue":a[10]||(a[10]=e=>ce.singleAmountEnabled=e)},null,8,["modelValue"])]),_:1}),ce.singleAmountEnabled?(G(),te(_e,{key:1,label:"单笔最大金额"},{default:ee(()=>[Y(we,{modelValue:ce.maxSingleAmount,"onUpdate:modelValue":a[11]||(a[11]=e=>ce.maxSingleAmount=e),min:1,max:9999999,precision:2},null,8,["modelValue"]),a[63]||(a[63]=Z("span",{style:{"margin-left":"10px",color:"#666"}},"元",-1))]),_:1})):se("",!0),Y(Ie,{"content-position":"left"},{default:ee(()=>[...a[64]||(a[64]=[ae("累计金额限制",-1)])]),_:1}),Y(_e,{label:"启用限制"},{default:ee(()=>[Y(Se,{modelValue:ce.totalAmountEnabled,"onUpdate:modelValue":a[12]||(a[12]=e=>ce.totalAmountEnabled=e)},null,8,["modelValue"])]),_:1}),ce.totalAmountEnabled?(G(),te(_e,{key:2,label:"累计最大金额"},{default:ee(()=>[Y(we,{modelValue:ce.maxTotalAmount,"onUpdate:modelValue":a[13]||(a[13]=e=>ce.maxTotalAmount=e),min:1,max:99999999,precision:2},null,8,["modelValue"]),a[65]||(a[65]=Z("span",{style:{"margin-left":"10px",color:"#666"}},"元（同一客户在该部门累计订单金额）",-1))]),_:1})):se("",!0),Y(Ie),Y(_e,{label:"启用配置"},{default:ee(()=>[Y(Se,{modelValue:ce.isEnabled,"onUpdate:modelValue":a[14]||(a[14]=e=>ce.isEnabled=e)},null,8,["modelValue"]),a[66]||(a[66]=Z("span",{style:{"margin-left":"10px",color:"#999"}},"关闭后该部门不受限制",-1))]),_:1}),Y(_e,{label:"备注"},{default:ee(()=>[Y(ke,{modelValue:ce.remark,"onUpdate:modelValue":a[15]||(a[15]=e=>ce.remark=e),type:"textarea",rows:2,placeholder:"可选，填写配置说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),Z("div",gt,[Y(O,{size:"large",onClick:R},{default:ee(()=>[...a[69]||(a[69]=[ae("重置配置",-1)])]),_:1}),Y(O,{type:"primary",size:"large",onClick:B,loading:C.value},{default:ee(()=>[...a[70]||(a[70]=[ae(" 保存配置 ",-1)])]),_:1},8,["loading"])]),Y(Ce,{modelValue:w.value,"onUpdate:modelValue":a[20]||(a[20]=e=>w.value=e),title:"编辑订单来源配置",width:"700px","close-on-click-modal":!1},{footer:ee(()=>[Y(O,{onClick:a[19]||(a[19]=e=>w.value=!1)},{default:ee(()=>[...a[72]||(a[72]=[ae("取消",-1)])]),_:1}),Y(O,{type:"primary",onClick:D},{default:ee(()=>[...a[73]||(a[73]=[ae("确定",-1)])]),_:1})]),default:ee(()=>[Y(xe,{model:z,"label-width":"100px"},{default:ee(()=>[Y(_e,{label:"字段名称",required:""},{default:ee(()=>[Y(ke,{modelValue:z.fieldName,"onUpdate:modelValue":a[18]||(a[18]=e=>z.fieldName=e),placeholder:"请输入字段名称，如：订单来源、订单渠道"},null,8,["modelValue"])]),_:1}),Y(_e,{label:"选项配置",required:""},{default:ee(()=>[Z("div",ft,[(G(!0),Q(ne,null,ie(z.options,(e,a)=>(G(),Q("div",{key:a,class:"option-item"},[Y(ke,{modelValue:e.label,"onUpdate:modelValue":a=>e.label=a,placeholder:"选项名称，如：线上商城",style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue"]),Y(ke,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,placeholder:"选项值，如：online",style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue"]),Y(O,{type:"danger",icon:X(b),circle:"",size:"small",onClick:e=>(e=>{z.options.splice(e,1)})(a),disabled:z.options.length<=1},null,8,["icon","onClick","disabled"])]))),128)),Y(O,{type:"primary",size:"small",icon:X(c),onClick:U},{default:ee(()=>[...a[71]||(a[71]=[ae(" 添加选项 ",-1)])]),_:1},8,["icon"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),Y(Ce,{modelValue:x.value,"onUpdate:modelValue":a[28]||(a[28]=e=>x.value=e),title:S.value?"编辑自定义字段":"添加自定义字段",width:"700px","close-on-click-modal":!1},{footer:ee(()=>[Y(O,{onClick:a[27]||(a[27]=e=>x.value=!1)},{default:ee(()=>[...a[77]||(a[77]=[ae("取消",-1)])]),_:1}),Y(O,{type:"primary",onClick:E},{default:ee(()=>[...a[78]||(a[78]=[ae("确定",-1)])]),_:1})]),default:ee(()=>[Y(xe,{ref_key:"customFieldFormRef",ref:V,model:A,rules:I,"label-width":"100px"},{default:ee(()=>[Y(_e,{label:"字段名称",prop:"fieldName"},{default:ee(()=>[Y(ke,{modelValue:A.fieldName,"onUpdate:modelValue":a[21]||(a[21]=e=>A.fieldName=e),placeholder:"请输入字段名称，如：客户等级"},null,8,["modelValue"])]),_:1}),Y(_e,{label:"字段键名",prop:"fieldKey"},{default:ee(()=>[Y(ke,{modelValue:A.fieldKey,"onUpdate:modelValue":a[22]||(a[22]=e=>A.fieldKey=e),placeholder:"请输入字段键名，如：customerLevel",disabled:S.value},null,8,["modelValue","disabled"]),a[74]||(a[74]=Z("div",{class:"form-tip"},"字段键名用于数据存储，只能包含字母、数字和下划线，且以字母开头",-1))]),_:1}),Y(_e,{label:"字段类型",prop:"fieldType"},{default:ee(()=>[Y(Ae,{modelValue:A.fieldType,"onUpdate:modelValue":a[23]||(a[23]=e=>A.fieldType=e),placeholder:"请选择字段类型",style:{width:"100%"},disabled:S.value},{default:ee(()=>[Y(ze,{label:"文本",value:"text"}),Y(ze,{label:"数字",value:"number"}),Y(ze,{label:"日期",value:"date"}),Y(ze,{label:"日期时间",value:"datetime"}),Y(ze,{label:"下拉选择",value:"select"}),Y(ze,{label:"单选",value:"radio"}),Y(ze,{label:"多选",value:"checkbox"})]),_:1},8,["modelValue","disabled"])]),_:1}),Y(_e,{label:"必填",prop:"required"},{default:ee(()=>[Y(Se,{modelValue:A.required,"onUpdate:modelValue":a[24]||(a[24]=e=>A.required=e)},null,8,["modelValue"])]),_:1}),Y(_e,{label:"占位符",prop:"placeholder"},{default:ee(()=>[Y(ke,{modelValue:A.placeholder,"onUpdate:modelValue":a[25]||(a[25]=e=>A.placeholder=e),placeholder:"请输入占位符提示文本"},null,8,["modelValue"])]),_:1}),Y(_e,{label:"列表显示",prop:"showInList"},{default:ee(()=>[Y(Se,{modelValue:A.showInList,"onUpdate:modelValue":a[26]||(a[26]=e=>A.showInList=e)},null,8,["modelValue"]),a[75]||(a[75]=Z("div",{class:"form-tip"},"开启后，该字段将在订单列表中显示",-1))]),_:1}),["select","radio","checkbox"].includes(A.fieldType)?(G(),te(_e,{key:0,label:"选项配置",required:""},{default:ee(()=>[Z("div",vt,[(G(!0),Q(ne,null,ie(A.options,(e,a)=>(G(),Q("div",{key:a,class:"option-item"},[Y(ke,{modelValue:e.label,"onUpdate:modelValue":a=>e.label=a,placeholder:"选项名称",style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue"]),Y(ke,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,placeholder:"选项值",style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue"]),Y(O,{type:"danger",icon:X(b),circle:"",size:"small",onClick:e=>(e=>{A.options.splice(e,1)})(a),disabled:A.options.length<=1},null,8,["icon","onClick","disabled"])]))),128)),Y(O,{type:"primary",size:"small",icon:X(c),onClick:$},{default:ee(()=>[...a[76]||(a[76]=[ae(" 添加选项 ",-1)])]),_:1},8,["icon"])])]),_:1})):se("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-3d2abe61"]]),ht={class:"rich-text-editor"},bt=a(L({__name:"RichTextEditor",props:{modelValue:{},height:{default:"400px"},placeholder:{default:"请输入内容..."},mode:{default:"default"}},emits:["update:modelValue"],setup(e,{emit:a}){const l=e,t=a,s=ce(),o=q(l.modelValue),n={excludeKeys:["group-video","insertImage","uploadImage"]},i={placeholder:l.placeholder,MENU_CONF:{}};ue(()=>{const e=s.value;null!=e&&e.destroy()});const r=e=>{s.value=e},c=e=>{t("update:modelValue",o.value)};return J(()=>l.modelValue,e=>{e!==o.value&&(o.value=e)}),(a,l)=>(G(),Q("div",ht,[Y(X(fe),{editor:s.value,defaultConfig:n,mode:e.mode,class:"editor-toolbar"},null,8,["editor","mode"]),Y(X(ve),{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value=e),defaultConfig:i,mode:e.mode,onOnCreated:r,onOnChange:c,class:"editor-content",style:de({height:e.height})},null,8,["modelValue","mode","style"])]))}}),[["__scopeId","data-v-25050145"]]),_t={class:"agreement-editor"},wt={class:"dialog-footer"},xt=a(L({__name:"AgreementEditorDialog",props:{modelValue:{type:Boolean},agreement:{}},emits:["update:modelValue","save"],setup(e,{emit:a}){const l=e,t=a,s=q(l.modelValue),o=q(l.agreement),n=q(""),r=q(!1);J(()=>l.modelValue,e=>{s.value=e}),J(()=>l.agreement,async e=>{o.value=e,e&&e.content?(n.value=e.content,await pe()):n.value=""}),J(s,e=>{t("update:modelValue",e)});const c=()=>{s.value=!1},u=()=>{n.value.trim()?(t("save",n.value),c()):i.warning("协议内容不能为空")};return(e,a)=>{const l=W("el-button"),t=W("el-dialog");return G(),te(t,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),title:`编辑${o.value?.title||"协议"}`,width:"65%","close-on-click-modal":!1,onClose:c,class:"agreement-editor-dialog"},{footer:ee(()=>[Z("div",wt,[Y(l,{onClick:c},{default:ee(()=>[...a[2]||(a[2]=[ae("取消",-1)])]),_:1}),Y(l,{type:"primary",onClick:u,loading:r.value},{default:ee(()=>[...a[3]||(a[3]=[ae(" 保存 ",-1)])]),_:1},8,["loading"])])]),default:ee(()=>[Z("div",_t,[Y(bt,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),height:"500px",placeholder:`请输入${o.value?.title}内容，支持富文本格式`},null,8,["modelValue","placeholder"])])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-e7dbbc25"]]),St={class:"system-settings"},kt={class:"settings-tabs-container"},Ct={class:"tabs-nav-container"},Vt={class:"tabs-nav-wrapper"},zt={class:"card-header"},At=["src"],It={class:"qr-upload-buttons"},Tt={key:0,class:"qr-preview-area"},Ot=["src"],Pt={class:"qr-overlay"},Dt={key:1,class:"qr-empty-state"},Ut={class:"card-header"},Nt={class:"card-header"},Et={class:"header-actions"},$t={class:"form-section"},Bt={class:"section-title"},Rt={class:"form-section"},Mt={class:"section-title"},Lt={class:"form-section"},qt={class:"section-title"},Ft={class:"form-section"},Kt={class:"section-title"},jt={class:"card-header"},Jt={class:"header-actions"},Wt={class:"card-header"},Ht={class:"header-actions"},Qt={class:"card-header"},Gt={class:"header-actions"},Zt={class:"sync-status"},Yt={key:1,class:"sync-info"},Xt={key:2,class:"sync-progress"},es={key:0,class:"failed-count"},as={class:"sync-actions"},ls={class:"card-header"},ts={class:"form-section"},ss={class:"section-title"},os={class:"form-section"},ns={class:"section-title"},is={class:"form-section"},rs={class:"section-title"},cs={class:"form-section"},us={class:"section-title"},ds={class:"form-section"},ps={class:"section-title"},ms={key:0,class:"form-actions"},gs={class:"card-header"},fs={class:"monitor-content"},vs={class:"monitor-section"},ys={class:"monitor-section"},hs={class:"monitor-section"},bs={class:"monitor-section"},_s={class:"card-header"},ws={class:"header-actions"},xs={class:"form-section"},Ss={class:"form-section"},ks={class:"form-section"},Cs={class:"card-header"},Vs={class:"header-actions"},zs={class:"migration-content"},As={key:0,class:"data-statistics"},Is={key:1,class:"validation-result"},Ts={key:0},Os={class:"migration-steps"},Ps={class:"documentation-links"},Ds={class:"card-header"},Us={class:"header-actions"},Ns={class:"agreement-title"},Es={class:"word-count"},$s={class:"content-summary"},Bs={class:"update-time"},Rs={class:"card-header"},Ms={class:"header-actions"},Ls={class:"mobile-app-content"},qs={class:"sdk-overview"},Fs={class:"section-title"},Ks={class:"status-info"},js={class:"file-size"},Js={class:"status-info"},Ws={class:"file-size"},Hs={class:"status-info"},Qs={class:"sdk-management"},Gs={class:"section-title"},Zs={class:"sdk-grid"},Ys={class:"sdk-item"},Xs={class:"sdk-header"},eo={class:"sdk-icon android"},ao={class:"sdk-details"},lo={class:"detail-item"},to={class:"value"},so={class:"detail-item"},oo={class:"value"},no={class:"detail-item"},io={class:"value"},ro={class:"sdk-actions"},co={class:"sdk-item"},uo={class:"sdk-header"},po={class:"sdk-icon ios"},mo={class:"sdk-details"},go={class:"detail-item"},fo={class:"value"},vo={class:"detail-item"},yo={class:"value"},ho={class:"detail-item"},bo={class:"value"},_o={class:"sdk-actions"},wo={class:"sdk-item"},xo={class:"sdk-header"},So={class:"sdk-icon pwa"},ko={class:"sdk-actions"},Co={class:"connection-status"},Vo={class:"section-title"},zo={class:"qr-connection-management"},Ao={class:"section-title"},Io={class:"qr-generator"},To={class:"qr-display"},Oo={key:0,class:"qr-code-container"},Po=["src"],Do={class:"qr-info"},Uo={class:"qr-status"},No={key:0,class:"qr-expire"},Eo={key:1,class:"qr-id"},$o={key:1,class:"qr-placeholder"},Bo={class:"alternative-connections"},Ro={class:"section-title"},Mo={class:"connection-header"},Lo={class:"connection-content"},qo={class:"connection-status"},Fo={class:"connection-config"},Ko={class:"connection-actions"},jo={class:"connection-header"},Jo={class:"connection-content"},Wo={class:"connection-status"},Ho={class:"connection-config"},Qo={class:"connection-actions"},Go={class:"connection-header"},Zo={class:"connection-content"},Yo={class:"connection-status"},Xo={class:"connection-config"},en={class:"pairing-code-display"},an={class:"pairing-code"},ln={class:"connection-actions"},tn={class:"stat-item"},sn={class:"stat-value"},on={class:"stat-item"},nn={class:"stat-value"},rn={class:"stat-item"},cn={class:"stat-value"},un={class:"stat-item"},dn={class:"stat-value"},pn={class:"connected-devices-section"},mn={class:"card-header"},gn={key:0,class:"empty-devices"},fn={class:"usage-guide"},vn={class:"section-title"},yn={class:"guide-content"},hn={class:"card-header"},bn={class:"logs-container"},_n=L({__name:"Settings",setup(a){const t=l(),s=e(),u=q("basic"),p=q(!1),m=q(!1),g=q(!1),v=q(!1),M=q(!1),L=q(!1),J=q(!1),re=q(!1),ce=q(!1),ue=q(!1),de=q(!1),pe=q(!1),ge=q(!1),fe=q(!1),ve=K(()=>s.systemConfig),Te=K(()=>s.securityConfig),Oe=q([{id:1,type:"user",title:"用户使用协议",content:'<div style="font-family: Microsoft YaHei, PingFang SC, sans-serif; line-height: 1.8; color: #333; padding: 20px;"><h1 style="text-align: center; color: #409eff; font-size: 20px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #409eff; font-weight: bold;">用户使用协议</h1><p style="text-indent: 2em; margin-bottom: 15px; font-size: 14px; color: #606266;">欢迎使用本CRM客户管理系统（以下简称<strong style="color: #409eff;">"本系统"</strong>）。在使用本系统之前，请您<strong style="color: #409eff;">仔细阅读并充分理解</strong>本协议的全部内容。</p><h2 style="color: #409eff; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #409eff; font-weight: bold;">一、协议的接受</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">1.1 本协议是您与本系统运营方之间关于使用本系统服务所订立的协议。</p><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">1.2 您点击<strong style="color: #409eff;">"同意"</strong>按钮即表示您<strong style="color: #409eff;">完全接受</strong>本协议的全部条款。</p><h2 style="color: #409eff; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #409eff; font-weight: bold;">二、服务内容</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">2.1 本系统为企业提供<strong style="color: #409eff;">客户关系管理服务</strong>，包括但不限于：</p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">客户信息管理</li><li style="margin-bottom: 5px; font-size: 14px;">订单管理</li><li style="margin-bottom: 5px; font-size: 14px;">业绩统计</li><li style="margin-bottom: 5px; font-size: 14px;">数据分析</li><li style="margin-bottom: 5px; font-size: 14px;">团队协作</li></ul><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">2.2 本系统保留随时修改或中断服务而不需通知用户的权利。</p><h2 style="color: #409eff; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #409eff; font-weight: bold;">三、用户权利和义务</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #409eff;">3.1 用户权利：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">使用本系统提供的各项功能</li><li style="margin-bottom: 5px; font-size: 14px;">管理自己的客户数据</li><li style="margin-bottom: 5px; font-size: 14px;">查看业绩统计报表</li><li style="margin-bottom: 5px; font-size: 14px;">获得技术支持服务</li></ul><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #409eff;">3.2 用户义务：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">遵守国家法律法规</li><li style="margin-bottom: 5px; font-size: 14px;">不得利用本系统从事违法活动</li><li style="margin-bottom: 5px; font-size: 14px;">妥善保管账号密码</li><li style="margin-bottom: 5px; font-size: 14px;">对账号下的所有行为负责</li><li style="margin-bottom: 5px; font-size: 14px;">不得恶意攻击系统</li><li style="margin-bottom: 5px; font-size: 14px;">不得泄露客户隐私信息</li></ul><h2 style="color: #409eff; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #409eff; font-weight: bold;">四、数据安全</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">4.1 本系统采用<strong style="color: #409eff;">行业标准的安全措施</strong>保护用户数据。</p><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">4.2 用户应定期备份重要数据，本系统不对数据丢失承担责任。</p><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">4.3 未经授权访问、使用、修改或破坏系统数据的行为将<strong style="color: #f56c6c;">承担法律责任</strong>。</p><h2 style="color: #409eff; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #409eff; font-weight: bold;">五、知识产权</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">5.1 本系统的所有内容，包括但不限于<strong style="color: #409eff;">文字、图片、软件、程序</strong>等，均受知识产权法保护。</p><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">5.2 未经许可，用户不得复制、传播、修改本系统的任何内容。</p><h2 style="color: #409eff; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #409eff; font-weight: bold;">六、免责声明</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">6.1 本系统不对因以下原因导致的损失承担责任：</p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">不可抗力因素</li><li style="margin-bottom: 5px; font-size: 14px;">网络故障</li><li style="margin-bottom: 5px; font-size: 14px;">用户操作不当</li><li style="margin-bottom: 5px; font-size: 14px;">第三方侵权行为</li></ul><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">6.2 本系统提供的数据分析结果仅供参考，不构成任何投资建议。</p><h2 style="color: #409eff; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #409eff; font-weight: bold;">七、协议的变更</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">7.1 本系统有权随时修改本协议条款。</p><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">7.2 协议变更后，继续使用本系统即视为<strong style="color: #409eff;">接受新协议</strong>。</p><h2 style="color: #409eff; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #409eff; font-weight: bold;">八、争议解决</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">8.1 本协议的解释、效力及纠纷的解决，适用<strong style="color: #409eff;">中华人民共和国法律</strong>。</p><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">8.2 若发生争议，双方应友好协商解决；协商不成的，可向本系统所在地人民法院提起诉讼。</p><h2 style="color: #409eff; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #409eff; font-weight: bold;">九、其他</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">9.1 本协议自用户点击同意之日起生效。</p><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">9.2 如本协议中的任何条款无论因何种原因完全或部分无效或不具有执行力，本协议的其余条款仍应有效并且有约束力。</p><p style="text-align: center; margin-top: 30px; color: #909399; font-size: 13px;">最后更新日期：2025年11月22日</p></div>',wordCount:1456,summary:'欢迎使用本CRM客户管理系统（以下简称"本系统"）。在使用本系统之前，请您仔细阅读并充分理解本协议的全部内容。一、协议的接受1.1 本协议是您与本系统运营方之间关于使用本系统服务所订立的协议。1.2 您点击"同意"按钮即表示您完全接受本协议的全部条款...',updateTime:"2025/11/22 17:30:00",enabled:!0},{id:2,type:"privacy",title:"用户隐私协议",content:'<div style="font-family: Microsoft YaHei, PingFang SC, sans-serif; line-height: 1.8; color: #333; padding: 20px;"><h1 style="text-align: center; color: #67C23A; font-size: 20px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #67C23A; font-weight: bold;">用户隐私协议</h1><p style="text-indent: 2em; margin-bottom: 15px; font-size: 14px; color: #606266;">本隐私协议（以下简称<strong style="color: #67C23A;">"本协议"</strong>）适用于本CRM客户管理系统（以下简称<strong style="color: #67C23A;">"本系统"</strong>）。我们非常重视用户的隐私保护，特制定本协议。</p><h2 style="color: #67C23A; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #67C23A; font-weight: bold;">一、信息收集</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">1.1 我们收集的信息类型：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">账号信息：用户名、密码、邮箱、手机号</li><li style="margin-bottom: 5px; font-size: 14px;">个人信息：姓名、部门、职位</li><li style="margin-bottom: 5px; font-size: 14px;">业务信息：客户数据、订单信息、业绩数据</li><li style="margin-bottom: 5px; font-size: 14px;">使用信息：登录日志、操作记录、访问时间</li></ul><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">1.2 信息收集方式：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">用户主动提供</li><li style="margin-bottom: 5px; font-size: 14px;">系统自动收集</li><li style="margin-bottom: 5px; font-size: 14px;">第三方合法提供</li></ul><h2 style="color: #67C23A; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #67C23A; font-weight: bold;">二、信息使用</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">2.1 我们使用收集的信息用于：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">提供系统服务</li><li style="margin-bottom: 5px; font-size: 14px;">改进用户体验</li><li style="margin-bottom: 5px; font-size: 14px;">数据统计分析</li><li style="margin-bottom: 5px; font-size: 14px;">安全监控</li><li style="margin-bottom: 5px; font-size: 14px;">技术支持</li><li style="margin-bottom: 5px; font-size: 14px;">发送系统通知</li></ul><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">2.2 我们承诺：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">不会将用户信息用于本协议未载明的其他用途</li><li style="margin-bottom: 5px; font-size: 14px;">不会向第三方出售用户信息</li><li style="margin-bottom: 5px; font-size: 14px;">严格限制信息访问权限</li></ul><h2 style="color: #67C23A; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #67C23A; font-weight: bold;">三、信息存储</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">3.1 存储位置：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">用户数据存储在本地浏览器</li><li style="margin-bottom: 5px; font-size: 14px;">部分数据可能存储在服务器</li><li style="margin-bottom: 5px; font-size: 14px;">采用加密技术保护敏感信息</li></ul><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">3.2 存储期限：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">账号存续期间持续存储</li><li style="margin-bottom: 5px; font-size: 14px;">账号注销后，数据将在30天内删除</li><li style="margin-bottom: 5px; font-size: 14px;">法律法规要求保留的除外</li></ul><h2 style="color: #67C23A; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #67C23A; font-weight: bold;">四、信息保护</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">4.1 安全措施：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">数据加密传输（HTTPS）</li><li style="margin-bottom: 5px; font-size: 14px;">密码加密存储</li><li style="margin-bottom: 5px; font-size: 14px;">访问权限控制</li><li style="margin-bottom: 5px; font-size: 14px;">定期安全审计</li><li style="margin-bottom: 5px; font-size: 14px;">异常行为监控</li></ul><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">4.2 安全承诺：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">采用行业标准的安全技术</li><li style="margin-bottom: 5px; font-size: 14px;">建立数据安全管理制度</li><li style="margin-bottom: 5px; font-size: 14px;">定期进行安全培训</li><li style="margin-bottom: 5px; font-size: 14px;">及时修复安全漏洞</li></ul><h2 style="color: #67C23A; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #67C23A; font-weight: bold;">五、信息共享</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">5.1 我们不会与第三方共享用户信息，除非：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">获得用户明确同意</li><li style="margin-bottom: 5px; font-size: 14px;">法律法规要求</li><li style="margin-bottom: 5px; font-size: 14px;">保护系统安全所必需</li><li style="margin-bottom: 5px; font-size: 14px;">维护用户合法权益所必需</li></ul><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">5.2 共享原则：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">最小必要原则</li><li style="margin-bottom: 5px; font-size: 14px;">合法正当原则</li><li style="margin-bottom: 5px; font-size: 14px;">安全可控原则</li></ul><h2 style="color: #67C23A; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #67C23A; font-weight: bold;">六、用户权利</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">6.1 您享有以下权利：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">访问您的个人信息</li><li style="margin-bottom: 5px; font-size: 14px;">更正不准确的信息</li><li style="margin-bottom: 5px; font-size: 14px;">删除您的个人信息</li><li style="margin-bottom: 5px; font-size: 14px;">撤回信息使用授权</li><li style="margin-bottom: 5px; font-size: 14px;">注销您的账号</li><li style="margin-bottom: 5px; font-size: 14px;">投诉举报</li></ul><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">6.2 权利行使方式：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">通过系统设置自行操作</li><li style="margin-bottom: 5px; font-size: 14px;">联系客服协助处理</li><li style="margin-bottom: 5px; font-size: 14px;">发送邮件申请</li></ul><h2 style="color: #67C23A; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #67C23A; font-weight: bold;">七、Cookie使用</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;"><strong style="color: #67C23A;">7.1 本系统使用Cookie技术：</strong></p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">记住登录状态</li><li style="margin-bottom: 5px; font-size: 14px;">保存用户偏好设置</li><li style="margin-bottom: 5px; font-size: 14px;">统计访问数据</li><li style="margin-bottom: 5px; font-size: 14px;">改善用户体验</li></ul><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">7.2 您可以通过浏览器设置管理Cookie。</p><h2 style="color: #67C23A; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #67C23A; font-weight: bold;">八、未成年人保护</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">8.1 本系统不向未满18周岁的未成年人提供服务。</p><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">8.2 如发现未成年人使用本系统，我们将立即停止服务并删除相关信息。</p><h2 style="color: #67C23A; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #67C23A; font-weight: bold;">九、隐私协议的变更</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">9.1 我们可能适时修订本协议。</p><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">9.2 变更后的协议将在系统内公布，继续使用即视为<strong style="color: #67C23A;">接受新协议</strong>。</p><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">9.3 重大变更将通过系统通知或邮件方式告知用户。</p><h2 style="color: #67C23A; font-size: 16px; margin: 20px 0 10px; padding-left: 10px; border-left: 3px solid #67C23A; font-weight: bold;">十、联系我们</h2><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">如您对本隐私协议有任何疑问、意见或建议，请通过以下方式联系我们：</p><ul style="margin-left: 3em; margin-bottom: 15px; list-style: disc; color: #606266;"><li style="margin-bottom: 5px; font-size: 14px;">客服电话：<strong style="color: #67C23A;">13570727364</strong></li><li style="margin-bottom: 5px; font-size: 14px;">客服微信：<strong style="color: #67C23A;">nxys789</strong></li><li style="margin-bottom: 5px; font-size: 14px;">客服邮箱：<strong style="color: #67C23A;">xianhuquwang@163.com</strong></li><li style="margin-bottom: 5px; font-size: 14px;">公司地址：<strong style="color: #67C23A;">广州市黄埔区南翔一路68号</strong></li></ul><p style="text-indent: 2em; margin-bottom: 10px; font-size: 14px;">我们将在收到您的反馈后<strong style="color: #67C23A;">15个工作日</strong>内予以回复。</p><p style="text-align: center; margin-top: 30px; color: #909399; font-size: 13px;">最后更新日期：2025年11月22日</p></div>',wordCount:1523,summary:'本隐私协议（以下简称"本协议"）适用于本CRM客户管理系统（以下简称"本系统"）。我们非常重视用户的隐私保护，特制定本协议。一、信息收集1.1 我们收集的信息类型：账号信息：用户名、密码、邮箱、手机号；个人信息：姓名、部门、职位；业务信息：客户数据、订单信息、业绩数据...',updateTime:"2025/11/22 17:45:00",enabled:!0}]),De=q(!1),Ne=K(()=>t.isAdmin),Ee=q(!1),Re=q(null),Me=F({smtpHost:"smtp.qq.com",smtpPort:587,senderEmail:"",senderName:"CRM系统",emailPassword:"",enableSsl:!1,enableTls:!0,testEmail:""}),Le=F({sipServer:"",sipPort:5060,sipUsername:"",sipPassword:"",sipTransport:"UDP",autoAnswer:!1,autoRecord:!0,qualityMonitoring:!0,incomingCallPopup:!0,maxCallDuration:3600,recordFormat:"wav",recordQuality:"standard",recordPath:"/recordings",recordRetentionDays:30,outboundPermission:["admin","manager","sales"],recordAccessPermission:["admin","manager"],statisticsPermission:["admin","manager"],numberRestriction:!1,allowedPrefixes:""}),qe=K(()=>s.smsConfig),je=K(()=>s.storageConfig),Je=K(()=>s.productConfig),We=q(Ue.getSyncConfig()),He=q(Ue.getSyncStatus()),Qe=q({systemInfo:{os:"",arch:"",cpuCores:0,totalMemory:"",nodeVersion:"",uptime:""},performance:{cpuUsage:0,memoryUsage:0,diskUsage:0,networkLatency:0},database:{type:"localStorage",version:"浏览器存储",connected:!0,activeConnections:0,size:"0 KB",lastBackup:"未备份"},services:[]}),Ge=()=>{try{if(Qe.value.systemInfo={os:navigator.platform||"未知",arch:navigator.userAgent.includes("x64")?"x64":navigator.userAgent.includes("ARM")?"ARM":"x86",cpuCores:navigator.hardwareConcurrency||0,totalMemory:performance.memory?`${(performance.memory.jsHeapSizeLimit/1024/1024/1024).toFixed(2)} GB (JS堆)`:"未知",nodeVersion:"浏览器环境",uptime:`页面运行 ${Math.floor(performance.now()/1e3/60)} 分钟`},performance&&performance.memory){const e=performance.memory;Qe.value.performance.memoryUsage=Math.round(e.usedJSHeapSize/e.jsHeapSizeLimit*100)}else Qe.value.performance.memoryUsage=0;const e=performance.getEntriesByType("navigation");if(e.length>0){const a=e[0],l=a.loadEventEnd-a.fetchStart;Qe.value.performance.cpuUsage=Math.min(Math.round(l/100),100)}let a=0;for(const t in localStorage)localStorage.hasOwnProperty(t)&&(a+=localStorage[t].length);const l=10;if(Qe.value.performance.diskUsage=Math.min(Math.round(a/1024/1024/l*100),100),navigator.connection&&navigator.connection.rtt)Qe.value.performance.networkLatency=navigator.connection.rtt;else{const e=performance.getEntriesByType("resource");if(e.length>0){const a=e.reduce((e,a)=>e+a.duration,0)/e.length;Qe.value.performance.networkLatency=Math.round(a)}}Qe.value.database={type:"localStorage",version:"浏览器存储",connected:!0,activeConnections:1,size:`${(a/1024).toFixed(2)} KB`,lastBackup:localStorage.getItem("lastBackupTime")||"未备份"},Qe.value.services=[{name:"前端应用",status:"running",port:window.location.port||"80",uptime:`${Math.floor(performance.now()/1e3/60)} 分钟`,memory:performance.memory?`${(performance.memory.usedJSHeapSize/1024/1024).toFixed(2)} MB`:"未知"},{name:"localStorage",status:"running",port:"-",uptime:"持久化",memory:`${(a/1024).toFixed(2)} KB`},{name:"网络连接",status:navigator.onLine?"running":"stopped",port:"-",uptime:navigator.onLine?"在线":"离线",memory:navigator.connection?`${navigator.connection.effectiveType||"未知"}`:"未知"}],console.log("[系统监控] 真实数据已加载:",Qe.value)}catch(e){console.error("[系统监控] 获取真实数据失败:",e)}};j(()=>{Ge()});const Ze=q(!1),Ye=q(!1),Xe=q(!1),ea=q(""),aa=q(!1),la=F({autoBackupEnabled:!1,backupFrequency:"daily",retentionDays:30,compression:!0}),ta=q(""),sa=q(0),oa=q(0),na=q([]),ia=q(!1),ra=q(!1),ca=q(null),ua=q(null),da=q(0),pa=q([]),ma=q(!1),ga=q("android"),fa=q({android:{version:"v2.1.3",size:"6.0 MB",updateTime:"2024-01-20 16:45:00",available:!0,downloadUrl:"/api/sdk/download/android/latest",features:["通话管理","客户管理","数据同步","离线支持"]},ios:{version:"v2.1.3",size:"32.8 MB",updateTime:"2024-01-20 16:45:00",available:!0,downloadUrl:"/api/sdk/download/ios/latest",features:["通话管理","客户管理","数据同步","离线支持"]}}),va=q(!1);q({qrCodeUrl:"",connectionId:"",expiresAt:"",isActive:!1}),F({userId:t.user?.id||"",permissions:["read","write"],expirationMinutes:30});const ya=q([]),ha=q(!1),ba=q({qrCodeUrl:"",connectionId:"",status:"inactive",expiresAt:"",connectedDevices:[]}),_a=F({permissions:["call","sms"],expireTime:"30"}),wa=q(!1),xa=q({host:"localhost",port:3e3,wsPort:3001,ssl:!1,apiVersion:"v1.0"}),Sa=q({active:5,today:23,total:156,lastConnection:"2024-01-15 16:45:00",qr:0,bluetooth:0,network:0,digital:0}),ka=q({enabled:!1,deviceName:"CRM-Server",pairingCode:""}),Ca=q(!1),Va=q({enabled:!1,port:8080,broadcastInterval:"10"}),za=q(!1),Aa=q({enabled:!1,currentCode:"",expireTime:"10"}),Ia=q(!1),Ta=q(!1),Oa=K(()=>{const e=s.storageConfig;return"oss"===e.storageType&&e.accessKey&&e.secretKey&&e.bucketName&&e.region}),Pa=K(()=>{const e=je.value;if(!e.imageCompressEnabled)return"图片压缩已关闭，上传的图片将保持原始大小";let a=60,l=1200,t="标准";switch(e.imageCompressQuality){case"high":a=80,l=1920,t="高清";break;case"medium":a=60,l=1200,t="标准";break;case"low":a=40,l=800,t="省流";break;case"custom":a=e.imageCompressCustomQuality||60,l=e.imageCompressMaxWidth||1200,t="自定义"}return`当前配置：${t}模式，压缩质量${a}%，最大宽度${l}px。预计可减少50%-80%的文件大小。`}),Da=K(()=>t.hasPermission("system:backup:edit")),Ua={systemName:[{required:!0,message:"请输入系统名称",trigger:"blur"}],companyName:[{required:!0,message:"请输入公司名称",trigger:"blur"}],contactEmail:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},Na={passwordMinLength:[{required:!0,message:"请设置密码最小长度",trigger:"blur"}],maxLoginFails:[{required:!0,message:"请设置最大失败次数",trigger:"blur"}],lockDuration:[{required:!0,message:"请设置锁定时间",trigger:"blur"}],sessionTimeout:[{required:!0,message:"请设置会话超时时间",trigger:"blur"}]},Ea={smtpHost:[{required:!0,message:"请输入SMTP服务器",trigger:"blur"}],smtpPort:[{required:!0,message:"请输入SMTP端口",trigger:"blur"}],senderEmail:[{required:!0,message:"请输入发件人邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],testEmail:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},$a={sipServer:[{required:!0,message:"请输入SIP服务器地址",trigger:"blur"}],sipPort:[{required:!0,message:"请输入SIP端口",trigger:"blur"},{type:"number",min:1,max:65535,message:"端口范围为1-65535",trigger:"blur"}],sipUsername:[{required:!0,message:"请输入SIP用户名",trigger:"blur"}],sipPassword:[{required:!0,message:"请输入SIP密码",trigger:"blur"}],recordPath:[{required:!0,message:"请输入录音保存路径",trigger:"blur"}],recordRetentionDays:[{required:!0,message:"请设置录音保留时间",trigger:"blur"},{type:"number",min:1,max:365,message:"保留时间范围为1-365天",trigger:"blur"}]},Ba={provider:[{required:!0,message:"请选择短信服务商",trigger:"change"}],accessKey:[{required:!0,message:"请输入AccessKey",trigger:"blur"}],secretKey:[{required:!0,message:"请输入SecretKey",trigger:"blur"}],signName:[{required:!0,message:"请输入短信签名",trigger:"blur"}],dailyLimit:[{required:!0,message:"请设置每日发送限制",trigger:"blur"}],monthlyLimit:[{required:!0,message:"请设置每月发送限制",trigger:"blur"}],testPhone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}]},Ra=K(()=>{const e={};return"local"===je.value.storageType?e.localPath=[{required:!0,message:"请输入存储路径",trigger:"blur"}]:"oss"===je.value.storageType&&(e.accessKey=[{required:!0,message:"请输入Access Key",trigger:"blur"}],e.secretKey=[{required:!0,message:"请输入Secret Key",trigger:"blur"}],e.bucketName=[{required:!0,message:"请输入存储桶名称",trigger:"blur"}],e.region=[{required:!0,message:"请选择存储区域",trigger:"change"}]),e}),Ma={maxDiscountPercent:[{required:!0,message:"请设置全局最大优惠比例",trigger:"blur"},{type:"number",min:0,max:100,message:"优惠比例应在0-100之间",trigger:"blur"}],adminMaxDiscount:[{required:!0,message:"请设置管理员最大优惠",trigger:"blur"},{type:"number",min:0,max:100,message:"优惠比例应在0-100之间",trigger:"blur"}],managerMaxDiscount:[{required:!0,message:"请设置经理最大优惠",trigger:"blur"},{type:"number",min:0,max:100,message:"优惠比例应在0-100之间",trigger:"blur"}],salesMaxDiscount:[{required:!0,message:"请设置销售员最大优惠",trigger:"blur"},{type:"number",min:0,max:100,message:"优惠比例应在0-100之间",trigger:"blur"}],discountApprovalThreshold:[{required:!0,message:"请设置优惠审批阈值",trigger:"blur"},{type:"number",min:0,max:100,message:"审批阈值应在0-100之间",trigger:"blur"}],lowStockThreshold:[{required:!0,message:"请设置低库存预警阈值",trigger:"blur"},{type:"number",min:0,message:"预警阈值不能为负数",trigger:"blur"}],defaultCategory:[{required:!0,message:"请输入默认分类名称",trigger:"blur"},{min:1,max:20,message:"分类名称长度在1-20个字符",trigger:"blur"}],maxCategoryLevel:[{required:!0,message:"请设置分类层级限制",trigger:"blur"},{type:"number",min:1,max:5,message:"分类层级应在1-5之间",trigger:"blur"}],costPriceViewRoles:[{required:!0,message:"请选择成本价格查看权限角色",trigger:"change"}],salesDataViewRoles:[{required:!0,message:"请选择销售数据查看权限角色",trigger:"change"}],stockInfoViewRoles:[{required:!0,message:"请选择库存信息查看权限角色",trigger:"change"}],operationLogsViewRoles:[{required:!0,message:"请选择操作日志查看权限角色",trigger:"change"}],sensitiveInfoHideMethod:[{required:!0,message:"请选择敏感信息隐藏方式",trigger:"change"}]},La={backupFrequency:[{required:!0,message:"请选择备份频率",trigger:"change"}],retentionDays:[{required:!0,message:"请设置保留天数",trigger:"blur"},{type:"number",min:1,max:365,message:"保留天数应在1-365之间",trigger:"blur"}]},qa=q(),Fa=q(),Ka=q(),ja=q(),Ja=q(),Wa=q(),Ha=q(),Qa=q(),Ga=K(()=>t.isAdmin),Za=K(()=>t.isAdmin),Ya=K(()=>t.isAdmin),Xa=K(()=>t.isAdmin),el=K(()=>t.isAdmin),al=K(()=>t.isAdmin),ll=K(()=>t.isAdmin||t.isManager),tl=K(()=>t.isAdmin||t.isManager),sl=K(()=>t.isAdmin),ol=e=>{const a="image/jpeg"===e.type||"image/png"===e.type,l=e.size/1024/1024<2;return a?!!l||(i.error("Logo大小不能超过 2MB!"),!1):(i.error("Logo只能是 JPG/PNG 格式!"),!1)},nl=(e,a)=>{ve.value.systemLogo=URL.createObjectURL(a.raw)},il=q(),rl=()=>{il.value?.click()},cl=e=>{const a=e.target,l=a.files;l&&l.length>0&&dl(l[0]),a.value=""},ul=async()=>{try{const e=await navigator.clipboard.read();for(const a of e)for(const e of a.types)if(e.startsWith("image/")){const l=await a.getType(e),t=new File([l],"qr-code.png",{type:e});return void dl(t)}i.warning("剪贴板中没有图片")}catch(e){i.error("粘贴图片失败，请检查浏览器权限")}},dl=async e=>{try{const{uploadImageWithMessage:a}=await n(async()=>{const{uploadImageWithMessage:e}=await import("./uploadService-CL6v6DXe.js");return{uploadImageWithMessage:e}},__vite__mapDeps([0,1,2,3,4,5])),l=await a(e,"system");l&&(s.updateSystemConfig({contactQRCode:l}),console.log("[Settings] 二维码URL已更新:",l))}catch(a){console.error("二维码上传失败:",a),i.error("上传失败，请重试")}},pl=()=>{ve.value.contactQRCode&&r.alert(`<div style="text-align: center; padding: 20px;">\n        <img src="${ve.value.contactQRCode}" alt="二维码" style="max-width: 400px; max-height: 400px; border: 1px solid #ddd; border-radius: 8px;" />\n      </div>`,"二维码预览",{confirmButtonText:"关闭",dangerouslyUseHTMLString:!0})},ml=async()=>{try{await r.confirm("确定要删除该二维码吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=ve.value.contactQRCode;if(a&&a.includes("/uploads/system/"))try{const e=a.split("/").pop(),{apiService:l}=await n(async()=>{const{apiService:e}=await import("./index-C4IdUW1A.js").then(e=>e.Q);return{apiService:e}},__vite__mapDeps([1,2,3,4,5]));await l.delete("/system/delete-image",{data:{filename:e}})}catch(e){console.warn("删除服务器文件失败:",e)}s.updateSystemConfig({contactQRCode:"",contactQRCodeLabel:""}),i.success("删除成功")}catch{}},gl=e=>e.replace(/<[^>]+>/g,"").replace(/\s+/g,"").length,fl=e=>{const a=e.replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim();return a.substring(0,50)+(a.length>50?"...":"")},vl=e=>{if(!Re.value)return;const a=Oe.value.findIndex(e=>e.id===Re.value.id);if(-1!==a)Oe.value[a].content=e,Oe.value[a].wordCount=gl(e),Oe.value[a].summary=fl(e),Oe.value[a].updateTime=(new Date).toLocaleString("zh-CN"),i.success("协议内容已更新");else{const a={...Re.value,content:e,wordCount:gl(e),summary:fl(e),updateTime:(new Date).toLocaleString("zh-CN")};Oe.value.push(a),i.success("协议已添加")}},yl=()=>{const e={id:Math.max(...Oe.value.map(e=>e.id),0)+1,type:"custom",title:"新协议",content:"<p>请输入协议内容...</p>",wordCount:0,summary:"暂无内容",updateTime:(new Date).toLocaleString("zh-CN"),enabled:!1};Re.value=e,Ee.value=!0},hl=async()=>{try{De.value=!0,(()=>{try{localStorage.setItem("crm_agreement_list",JSON.stringify(Oe.value));const e=Oe.value.find(e=>"user"===e.type),a=Oe.value.find(e=>"privacy"===e.type);e&&a&&s.updateSystemConfig({userAgreement:e.content,privacyPolicy:a.content}),console.log("[协议列表] 已保存")}catch(e){throw console.error("[协议列表] 保存失败:",e),e}})(),i.success("协议配置保存成功")}catch(e){console.error("[协议列表] 保存配置失败:",e),i.error("保存失败，请重试")}finally{De.value=!1}},bl=async()=>{try{await(qa.value?.validate()),p.value=!0,s.updateSystemConfig(ve.value),console.log("[基本设置] 已保存到localStorage:",ve.value);try{const{apiService:e}=await n(async()=>{const{apiService:e}=await import("./index-C4IdUW1A.js").then(e=>e.Q);return{apiService:e}},__vite__mapDeps([1,2,3,4,5]));await e.put("/system/basic-settings",ve.value),console.log("[基本设置] 已同步到后端API"),i.success("基本设置保存成功")}catch(e){const a=e;console.warn("[基本设置] API调用失败:",a?.message||a),"ECONNREFUSED"===a?.code||404===a?.response?.status?i.success("基本设置保存成功（本地模式）"):403===a?.response?.status?i.error("没有权限修改系统设置，请联系管理员"):500===a?.response?.status?i.error("服务器内部错误: "+(a?.response?.data?.message||"请稍后重试")):i.success("基本设置保存成功")}}catch(a){console.error("[基本设置] 表单验证失败:",a),i.error("保存基本设置失败，请重试")}finally{p.value=!1}},_l=async()=>{try{await(Fa.value?.validate()),m.value=!0,s.updateSecurityConfig(Te.value),console.log("[安全设置] 已保存到localStorage:",Te.value);try{const{apiService:e}=await n(async()=>{const{apiService:e}=await import("./index-C4IdUW1A.js").then(e=>e.Q);return{apiService:e}},__vite__mapDeps([1,2,3,4,5]));await e.put("/system/security-settings",Te.value),console.log("[安全设置] 已同步到后端API"),i.success("安全设置保存成功")}catch(e){console.warn("[安全设置] API调用失败，已保存到本地:",e.message||e),"ECONNREFUSED"===e.code||404===e.response?.status?i.success("安全设置保存成功（本地模式）"):i.warning("安全设置已保存到本地，但未能同步到服务器")}}catch(a){console.error("[安全设置] 表单验证失败:",a),i.error("保存安全设置失败，请重试")}finally{m.value=!1}},wl=async()=>{try{await(ja.value?.validate()),g.value=!0,s.updateEmailConfig(Me),console.log("[邮件设置] 已保存到localStorage:",Me);try{const{apiService:e}=await n(async()=>{const{apiService:e}=await import("./index-C4IdUW1A.js").then(e=>e.Q);return{apiService:e}},__vite__mapDeps([1,2,3,4,5]));await e.put("/system/email-settings",Me),console.log("[邮件设置] 已同步到后端API"),i.success("邮件设置保存成功")}catch(e){console.warn("[邮件设置] API调用失败，已保存到本地:",e),"ECONNREFUSED"===e.code||404===e.response?.status?i.success("邮件设置保存成功（本地模式）"):i.warning("邮件设置已保存到本地，但未能同步到服务器")}}catch(a){console.error("[邮件设置] 表单验证失败:",a),i.error("保存邮件设置失败，请重试")}finally{g.value=!1}},xl=async()=>{try{await(Ka.value?.validate()),pe.value=!0,s.updateCallConfig(Le),console.log("[通话设置] 已保存到localStorage:",Le);try{const{apiService:e}=await n(async()=>{const{apiService:e}=await import("./index-C4IdUW1A.js").then(e=>e.Q);return{apiService:e}},__vite__mapDeps([1,2,3,4,5]));await e.put("/system/call-settings",Le),console.log("[通话设置] 已同步到后端API"),i.success("通话设置保存成功")}catch(e){console.warn("[通话设置] API调用失败，已保存到本地:",e),"ECONNREFUSED"===e.code||404===e.response?.status?i.success("通话设置保存成功（本地模式）"):i.warning("通话设置已保存到本地，但未能同步到服务器")}}catch(a){console.error("[通话设置] 表单验证失败:",a),i.error("保存通话设置失败，请重试")}finally{pe.value=!1}},Sl=async()=>{try{ge.value=!0,await new Promise(e=>setTimeout(e,2e3)),i.success("SIP连接测试成功")}catch(e){i.error("SIP连接测试失败")}finally{ge.value=!1}},kl=async()=>{if(Me.testEmail)try{v.value=!0,await new Promise(e=>setTimeout(e,2e3)),i.success("测试邮件发送成功，请检查邮箱")}catch(e){i.error("测试邮件发送失败")}finally{v.value=!1}else i.warning("请先输入测试邮箱地址")},Cl=async()=>{try{await(Ja.value?.validate()),M.value=!0,s.updateSmsConfig(qe.value),console.log("[短信设置] 已保存到localStorage:",qe.value);try{const{apiService:e}=await n(async()=>{const{apiService:e}=await import("./index-C4IdUW1A.js").then(e=>e.Q);return{apiService:e}},__vite__mapDeps([1,2,3,4,5]));await e.put("/system/sms-settings",qe.value),console.log("[短信设置] 已同步到后端API"),i.success("短信设置保存成功")}catch(e){console.warn("[短信设置] API调用失败，已保存到本地:",e),"ECONNREFUSED"===e.code||404===e.response?.status?i.success("短信设置保存成功（本地模式）"):i.warning("短信设置已保存到本地，但未能同步到服务器")}}catch(a){console.error("[短信设置] 表单验证失败:",a),i.error("保存短信设置失败，请重试")}finally{M.value=!1}},Vl=async()=>{if(qe.value.testPhone)try{L.value=!0,await new Promise(e=>setTimeout(e,2e3)),i.success("测试短信发送成功，请检查手机")}catch(e){i.error("测试短信发送失败")}finally{L.value=!1}else i.warning("请先输入测试手机号")},zl=()=>{ue.value=!0},Al=async()=>{try{if(Ca.value=!0,ka.value.enabled)await he(),ka.value.enabled=!1,ka.value.pairingCode="",i.success("蓝牙服务已停止");else{const e=await be({deviceName:ka.value.deviceName});ka.value.enabled=!0,ka.value.pairingCode=e.data.pairingCode||Pl(6),i.success("蓝牙服务已启动")}await Dl()}catch(e){console.error("切换蓝牙连接失败:",e),i.error("操作失败，请重试")}finally{Ca.value=!1}},Il=async()=>{try{za.value=!0,Va.value.enabled?(await _e(),Va.value.enabled=!1,i.success("网络发现已停止")):(await we({port:Va.value.port,broadcastInterval:Va.value.broadcastInterval}),Va.value.enabled=!0,i.success(`网络发现已启动，端口: ${Va.value.port}`)),await Dl()}catch(e){console.error("切换网络连接失败:",e),i.error("操作失败，请重试")}finally{za.value=!1}},Tl=async()=>{try{if(Ia.value=!0,Aa.value.enabled)await xe(),Aa.value.enabled=!1,Aa.value.currentCode="",i.success("数字配对已停止");else{const e=await Se({expireTime:Aa.value.expireTime});Aa.value.enabled=!0,Aa.value.currentCode=e.data.pairingCode||Pl(6),i.success("数字配对已启动")}await Dl()}catch(e){console.error("切换数字配对失败:",e),i.error("操作失败，请重试")}finally{Ia.value=!1}},Ol=async()=>{try{Ta.value=!0;const e=await ke();Aa.value.currentCode=e.data.pairingCode||Pl(6),i.success("配对码已更新")}catch(e){console.error("生成配对码失败:",e),Aa.value.currentCode=Pl(6),i.error("生成配对码失败，使用本地生成的配对码")}finally{Ta.value=!1}},Pl=e=>{const a="0123456789";let l="";for(let t=0;t<e;t++)l+=a.charAt(Math.floor(10*Math.random()));return l},Dl=async()=>{try{const e=(await Ce()).data;Sa.value={qr:e.qr||Sa.value.qr,bluetooth:e.bluetooth||0,network:e.network||0,digital:e.digital||0,active:e.active||0}}catch(e){console.error("获取连接统计失败:",e),ka.value.enabled?Sa.value.bluetooth=Math.floor(5*Math.random())+1:Sa.value.bluetooth=0,Va.value.enabled?Sa.value.network=Math.floor(8*Math.random())+1:Sa.value.network=0,Aa.value.enabled?Sa.value.digital=Math.floor(3*Math.random())+1:Sa.value.digital=0,Sa.value.active=Sa.value.qr+Sa.value.bluetooth+Sa.value.network+Sa.value.digital}},Ul=async()=>{try{await(Wa.value?.validate()),J.value=!0,s.updateStorageConfig(je.value),console.log("[存储设置] 已保存到localStorage:",je.value);const{clearStorageConfigCache:a}=await n(async()=>{const{clearStorageConfigCache:e}=await import("./uploadService-CL6v6DXe.js");return{clearStorageConfigCache:e}},__vite__mapDeps([0,1,2,3,4,5]));if(a(),console.log("[存储设置] 已清除上传服务缓存"),"oss"===je.value.storageType){const{ossService:e}=await n(async()=>{const{ossService:e}=await Promise.resolve().then(()=>Pe);return{ossService:e}},void 0);await e.reinitialize()}try{const{apiService:e}=await n(async()=>{const{apiService:e}=await import("./index-C4IdUW1A.js").then(e=>e.Q);return{apiService:e}},__vite__mapDeps([1,2,3,4,5]));await e.put("/system/storage-settings",je.value),console.log("[存储设置] 已同步到后端API"),i.success("存储设置保存成功")}catch(e){console.warn("[存储设置] API调用失败，已保存到本地:",e),"ECONNREFUSED"===e.code||404===e.response?.status?i.success("存储设置保存成功（本地模式）"):i.warning("存储设置已保存到本地，但未能同步到服务器")}}catch(a){console.error("[存储设置] 表单验证失败:",a),i.error("保存存储设置失败，请重试")}finally{J.value=!1}},Nl=async()=>{try{if(await(Ha.value?.validate()),Je.value.salesMaxDiscount>Je.value.managerMaxDiscount)return void i.warning("销售员最大优惠不能超过经理最大优惠");if(Je.value.managerMaxDiscount>Je.value.adminMaxDiscount)return void i.warning("经理最大优惠不能超过管理员最大优惠");if(Je.value.discountApprovalThreshold>Je.value.maxDiscountPercent)return void i.warning("优惠审批阈值不能超过全局最大优惠比例");re.value=!0,s.updateProductConfig(Je.value),console.log("[商品设置] 已保存到localStorage:",Je.value);try{const{apiService:e}=await n(async()=>{const{apiService:e}=await import("./index-C4IdUW1A.js").then(e=>e.Q);return{apiService:e}},__vite__mapDeps([1,2,3,4,5]));await e.put("/system/product-settings",Je.value),console.log("[商品设置] 已同步到后端API"),i.success("商品设置保存成功")}catch(e){console.warn("[商品设置] API调用失败，已保存到本地:",e.message||e),"ECONNREFUSED"===e.code||404===e.response?.status?i.success("商品设置保存成功（本地模式）"):i.warning("商品设置已保存到本地，但未能同步到服务器")}}catch(a){console.error("[商品设置] 表单验证失败:",a),a.message?i.error(a.message):i.error("保存商品设置失败，请重试")}finally{re.value=!1}},El=()=>{r.confirm("确定要重置商品设置吗？这将恢复到默认配置。","重置确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.resetProductConfig(),Ha.value?.clearValidate(),i.success("商品设置已重置为默认配置")}).catch(()=>{})},$l=async()=>{try{ce.value=!0,Ge();try{const{apiService:e}=await n(async()=>{const{apiService:e}=await import("./index-C4IdUW1A.js").then(e=>e.Q);return{apiService:e}},__vite__mapDeps([1,2,3,4,5])),a=await e.get("/system/monitor");a.systemInfo&&(Qe.value.systemInfo={...Qe.value.systemInfo,...a.systemInfo}),a.performance&&(Qe.value.performance={...Qe.value.performance,...a.performance}),a.database&&(Qe.value.database={...Qe.value.database,...a.database}),a.services&&a.services.length>0&&(Qe.value.services=[...Qe.value.services,...a.services]),console.log("[系统监控] 已同步服务器监控数据"),i.success("监控数据刷新成功（包含服务器数据）")}catch(e){console.warn("[系统监控] API调用失败，使用前端数据:",e.message||e),"ECONNREFUSED"===e.code||404===e.response?.status?i.success("监控数据刷新成功（前端模式）"):i.warning("监控数据已刷新，但未能获取服务器数据")}}catch(a){console.error("[系统监控] 刷新失败:",a),i.error("刷新监控数据失败")}finally{ce.value=!1}},Bl=()=>{Ue.updateSyncConfig(We.value),i.success("同步配置已更新")},Rl=async()=>{try{i.info("开始同步数据到云端...");const e=await Ue.syncAllData();He.value=Ue.getSyncStatus(),e?i.success("数据同步完成"):i.warning("数据同步完成，但有部分失败项")}catch(e){console.error("手动同步失败:",e),i.error("数据同步失败，请检查网络连接和OSS配置")}},Ml=async()=>{try{await r.confirm("确定要从云端恢复数据吗？这将覆盖本地数据。","恢复数据确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),i.info("开始从云端恢复数据...");await Ue.restoreFromOSS()?(i.success("数据恢复完成"),location.reload()):i.error("数据恢复失败")}catch(e){"cancel"!==e&&(console.error("数据恢复失败:",e),i.error("数据恢复失败，请重试"))}},Ll=async()=>{try{i.info("正在检查数据完整性...");await Ue.checkDataIntegrity()?i.success("数据完整性检查通过"):i.warning("数据完整性检查发现问题，建议重新同步")}catch(e){console.error("数据完整性检查失败:",e),i.error("数据完整性检查失败")}},ql=e=>{try{return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(a){return e}},Fl=async()=>{de.value=!0;try{i.info("开始测试数据持久性功能...");const e=await $e(),a=e.length,l=e.filter(e=>e.passed).length,t=a-l;0===t?i.success(`所有测试通过！(${l}/${a})`):i.warning(`测试完成：${l}/${a} 通过，${t} 失败`),console.group("数据持久性测试结果"),e.forEach(e=>{e.passed?console.log(`✅ ${e.name}: ${e.message}`):(console.error(`❌ ${e.name}: ${e.message}`),e.error&&console.error("错误详情:",e.error))}),console.groupEnd();const s=e.filter(e=>!e.passed);if(s.length>0){const e=s.map(e=>`• ${e.name}: ${e.message}`).join("\n");r.alert(`失败的测试:\n${e}\n\n请查看控制台获取详细错误信息`,"测试结果",{type:"warning"})}}catch(e){console.error("测试执行失败:",e),i.error("测试执行失败，请查看控制台获取详细信息")}finally{de.value=!1}},Kl=async()=>{if(Oa.value)try{Ze.value=!0,await Be.performManualBackup(),i.success("备份成功"),await Hl(),await Ql()}catch(e){console.error("备份失败:",e),i.error("备份失败: "+e.message)}finally{Ze.value=!1}else i.warning("请先配置OSS存储")},jl=async()=>{try{await(Qa.value?.validate()),Ye.value=!0,await Be.setBackupConfig(la),console.log("[备份设置] 已保存到本地:",la);try{const{apiService:e}=await n(async()=>{const{apiService:e}=await import("./index-C4IdUW1A.js").then(e=>e.Q);return{apiService:e}},__vite__mapDeps([1,2,3,4,5]));await e.put("/system/backup-settings",la),console.log("[备份设置] 已同步到后端API"),i.success("备份设置保存成功")}catch(e){console.warn("[备份设置] API调用失败，已保存到本地:",e),"ECONNREFUSED"===e.code||404===e.response?.status?i.success("备份设置保存成功（本地模式）"):i.warning("备份设置已保存到本地，但未能同步到服务器")}}catch(a){console.error("[备份设置] 保存失败:",a),i.error("保存失败: "+a.message)}finally{Ye.value=!1}},Jl=async()=>{try{aa.value=!0,i.info("开始运行备份功能测试..."),await Fe()}catch(e){console.error("测试备份功能失败:",e),i.error("测试失败: "+e.message)}finally{aa.value=!1}},Hl=async()=>{try{Xe.value=!0,na.value=await Be.getBackupList()}catch(e){console.error("加载备份列表失败:",e)}finally{Xe.value=!1}},Ql=async()=>{try{const e=await Be.getBackupConfig();Object.assign(la,e);const a=await Be.getBackupList();if(a&&Array.isArray(a)){if(sa.value=a.length,oa.value=a.reduce((e,a)=>e+a.size,0),a.length>0){const e=a.sort((e,a)=>new Date(a.timestamp).getTime()-new Date(e.timestamp).getTime())[0];ta.value=e.timestamp}}else sa.value=0,oa.value=0}catch(e){console.error("加载备份状态失败:",e)}},Gl=e=>{if(0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB"][a]},Zl=async()=>{try{ia.value=!0;const e=new Ke,a=await e.exportAllData();a.success?(i.success("数据导出成功！"),ca.value=a.statistics,da.value=1):i.error(`数据导出失败：${a.error}`)}catch(e){console.error("导出数据失败:",e),i.error("导出数据失败，请检查控制台错误信息")}finally{ia.value=!1}},Yl=async()=>{try{ra.value=!0;const e=new Ke,a=await e.validateData();ua.value=a,0===a.issues.length?i.success("数据验证通过！"):i.warning(`发现 ${a.issues.length} 个数据问题`)}catch(e){console.error("验证数据失败:",e),i.error("验证数据失败，请检查控制台错误信息")}finally{ra.value=!1}},Xl=e=>{if(0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB"][a]},et=e=>{const a={database:"DATABASE_ARCHITECTURE.md",api:"BACKEND_API_ARCHITECTURE.md",migration:"DATA_MIGRATION_PLAN.md"}[e];a&&i.info(`请查看项目根目录下的 ${a} 文件`)},at=e=>{switch(e){case"ERROR":return"danger";case"WARN":return"warning";case"INFO":return"success";case"DEBUG":return"info";default:return""}},lt=async()=>{try{fe.value=!0;const a=await(e={limit:100},o({url:"/logs/system",method:"get",params:e}));a.success&&a.data?(pa.value=a.data,i.success(`已刷新 ${a.data.length} 条日志`)):i.error("获取日志失败")}catch(a){console.error("刷新日志失败:",a),i.error("刷新日志失败")}finally{fe.value=!1}var e},tt=async()=>{try{await r.confirm("确定要清空所有系统日志吗？此操作不可恢复。","确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await o({url:"/logs/clear",method:"delete"});e.success?(pa.value=[],i.success(e.message)):i.error("清空日志失败")}catch(e){"cancel"!==e&&(console.error("清空日志失败:",e),i.error("清空日志失败"))}},st=async()=>{ma.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),fa.value.android.updateTime=(new Date).toLocaleString(),fa.value.ios.updateTime=(new Date).toLocaleString(),Sa.value.active=Math.floor(10*Math.random())+1,Sa.value.today=Math.floor(50*Math.random())+10,Sa.value.lastConnection=(new Date).toLocaleString(),i.success("SDK信息已刷新")}catch(e){i.error("刷新SDK信息失败")}finally{ma.value=!1}},ot=()=>{if(!fa.value.android.available)return void i.warning("Android SDK暂不可用");const e=document.createElement("a");e.href="/downloads/CRM-Mobile-SDK-v2.1.3.apk",e.download="CRM-Mobile-SDK-v2.1.3.apk",document.body.appendChild(e),e.click(),document.body.removeChild(e),i.success("开始下载Android SDK v2.1.3 (6MB)")},it=()=>{if(!fa.value.ios.available)return void i.warning("iOS SDK暂不可用");const e=document.createElement("a");e.href="/downloads/crm-ios-v1.0.0.ipa",e.download="crm-ios-v1.0.0.ipa",document.body.appendChild(e),e.click(),document.body.removeChild(e),i.success("开始下载iOS SDK")},rt=e=>{ga.value=e;const a=document.querySelector(".usage-guide");a&&a.scrollIntoView({behavior:"smooth"})},ct=()=>{const e=`${window.location.origin}/mobile`;window.open(e,"_blank"),i.success("正在打开PWA应用")},ut=async()=>{const e=`${window.location.origin}/mobile`;try{const a=await dt(e);r.alert(`<div style="text-align: center; padding: 20px;">\n        <div style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">扫描二维码访问PWA应用</div>\n        <div style="margin-bottom: 16px;">\n          <img src="${a}" alt="PWA二维码" style="width: 200px; height: 200px; border: 1px solid #ddd; border-radius: 8px;" />\n        </div>\n        <div style="font-size: 14px; color: #666;">\n          或直接访问：<br>\n          <a href="${e}" target="_blank" style="color: #409eff;">${e}</a>\n        </div>\n      </div>`,"移动应用二维码",{confirmButtonText:"确定",dangerouslyUseHTMLString:!0})}catch(a){console.error("生成二维码失败:",a),i.error("生成二维码失败")}},dt=async e=>{try{const a=await n(()=>import("./browser-BKsVyEpb.js").then(e=>e.b),[]);return await a.toDataURL(e,{width:200,margin:2,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"M"})}catch(a){return console.error("生成二维码图片失败:",a),`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(e)}`}},pt=async()=>{va.value=!0;try{const e="qr_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),a=parseInt(_a.expireTime),l=new Date(Date.now()+60*a*1e3),t={connectionId:e,serverUrl:`${window.location.protocol}//${window.location.host}`,permissions:_a.permissions,expiresAt:l.getTime(),type:"system_connection"},s=await dt(JSON.stringify(t));ba.value={qrCodeUrl:s,connectionId:e,status:"active",expiresAt:l.toISOString(),connectedDevices:[]},i.success("二维码生成成功")}catch(e){console.error("生成二维码失败:",e),i.error("生成二维码失败")}finally{va.value=!1}},mt=async()=>{ba.value.connectionId?(await pt(),i.success("二维码已刷新")):i.warning("请先生成二维码")},gt=e=>{switch(e){case"active":return"success";case"connected":return"primary";case"expired":return"danger";default:return"info"}},ft=e=>{switch(e){case"active":return"等待连接";case"connected":return"已连接";case"expired":return"已过期";default:return"未激活"}},vt=async()=>{wa.value=!0;try{const e=await Ve();ya.value=e.data||[],i.success("设备列表已刷新")}catch(e){console.error("刷新设备列表失败:",e),i.error("刷新设备列表失败"),ya.value=[{id:"device_001",name:"iPhone 13 Pro",type:"iOS",connectionType:"QR Code",connectedAt:"2024-01-20 15:30:00",lastActivity:"2024-01-20 16:45:00",status:"online"},{id:"device_002",name:"Samsung Galaxy S21",type:"Android",connectionType:"Bluetooth",connectedAt:"2024-01-20 14:20:00",lastActivity:"2024-01-20 16:40:00",status:"online"}]}finally{wa.value=!1}},ht=e=>e?new Date(e).toLocaleString("zh-CN"):"";return j(()=>{Ql(),Hl(),lt(),(()=>{try{const e=localStorage.getItem("crm_agreement_list");e?(Oe.value=JSON.parse(e),console.log("[协议列表] 已加载:",Oe.value.length,"个协议")):console.log("[协议列表] 未找到保存的数据，使用默认空列表")}catch(e){console.error("[协议列表] 加载失败:",e)}})();(async()=>{try{const e=new Ke,a=await e.getDataStatistics();ca.value=a}catch(e){console.error("获取数据统计失败:",e)}})(),(async()=>{try{ha.value=!0;const{getConnectedDevices:e}=await n(async()=>{const{getConnectedDevices:e}=await import("./qr-connection-C28yXtL2.js");return{getConnectedDevices:e}},__vite__mapDeps([6,1,2,3,4,5])),a=await e();ya.value=a,i.success("设备列表刷新成功")}catch(e){console.error("刷新设备列表失败:",e),i.error("刷新设备列表失败，请重试")}finally{ha.value=!1}})();(async()=>{try{const e=await ze();e.data&&(ka.value.enabled=e.data.enabled||!1,ka.value.pairingCode=e.data.pairingCode||"");const a=await Ae();a.data&&(Va.value.enabled=a.data.enabled||!1);const l=await Ie();l.data&&(Aa.value.enabled=l.data.enabled||!1,Aa.value.currentCode=l.data.currentCode||""),await Dl()}catch(e){console.error("初始化替代连接状态失败:",e)}})();const e=setInterval(()=>{He.value=Ue.getSyncStatus()},5e3);me(()=>{clearInterval(e)})}),(e,a)=>{const l=W("el-button"),t=W("el-input"),s=W("el-form-item"),o=W("el-col"),n=W("el-row"),q=W("el-icon"),F=W("el-upload"),K=W("el-divider"),j=W("el-form"),me=W("el-card"),he=W("el-tab-pane"),be=W("el-input-number"),_e=W("el-checkbox"),we=W("el-checkbox-group"),xe=W("el-switch"),Se=W("el-radio"),ke=W("el-radio-group"),Ce=W("el-option"),Ve=W("el-select"),ze=W("el-slider"),Ae=W("el-alert"),Ie=W("el-tag"),Pe=W("el-descriptions-item"),Ue=W("el-descriptions"),$e=W("el-statistic"),Fe=W("el-table-column"),Ke=W("el-table"),Ge=W("el-step"),ha=W("el-steps"),dl=W("el-space"),gl=W("el-tooltip"),fl=W("el-empty"),Pl=W("el-tabs"),Dl=W("el-dialog"),dt=H("loading");return G(),Q("div",St,[a[342]||(a[342]=Z("div",{class:"page-header"},[Z("h2",null,"系统设置"),Z("p",null,"管理系统的基本配置和参数设置")],-1)),Z("div",kt,[Z("div",Ct,[Z("div",Vt,[Y(Pl,{modelValue:u.value,"onUpdate:modelValue":a[110]||(a[110]=e=>u.value=e),class:"settings-tabs",ref:"tabsRef"},{default:ee(()=>[Y(he,{label:"基本设置",name:"basic"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",zt,[a[114]||(a[114]=Z("span",null,"基本信息",-1)),Ga.value?(G(),te(l,{key:0,onClick:bl,type:"primary",loading:p.value},{default:ee(()=>[...a[113]||(a[113]=[ae(" 保存设置 ",-1)])]),_:1},8,["loading"])):se("",!0)])]),default:ee(()=>[Y(j,{ref_key:"basicFormRef",ref:qa,model:ve.value,rules:Ua,"label-width":"120px",class:"setting-form"},{default:ee(()=>[Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:12},{default:ee(()=>[Y(s,{label:"系统名称",prop:"systemName"},{default:ee(()=>[Y(t,{modelValue:ve.value.systemName,"onUpdate:modelValue":a[0]||(a[0]=e=>ve.value.systemName=e),placeholder:"请输入系统名称"},null,8,["modelValue"])]),_:1})]),_:1}),Y(o,{span:12},{default:ee(()=>[Y(s,{label:"系统版本",prop:"systemVersion"},{default:ee(()=>[Y(t,{modelValue:ve.value.systemVersion,"onUpdate:modelValue":a[1]||(a[1]=e=>ve.value.systemVersion=e),placeholder:"请输入系统版本"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:12},{default:ee(()=>[Y(s,{label:"公司名称",prop:"companyName"},{default:ee(()=>[Y(t,{modelValue:ve.value.companyName,"onUpdate:modelValue":a[2]||(a[2]=e=>ve.value.companyName=e),placeholder:"请输入公司名称"},null,8,["modelValue"])]),_:1})]),_:1}),Y(o,{span:12},{default:ee(()=>[Y(s,{label:"联系电话",prop:"contactPhone"},{default:ee(()=>[Y(t,{modelValue:ve.value.contactPhone,"onUpdate:modelValue":a[3]||(a[3]=e=>ve.value.contactPhone=e),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:12},{default:ee(()=>[Y(s,{label:"联系邮箱",prop:"contactEmail"},{default:ee(()=>[Y(t,{modelValue:ve.value.contactEmail,"onUpdate:modelValue":a[4]||(a[4]=e=>ve.value.contactEmail=e),placeholder:"请输入联系邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),Y(o,{span:12},{default:ee(()=>[Y(s,{label:"网站地址",prop:"websiteUrl"},{default:ee(()=>[Y(t,{modelValue:ve.value.websiteUrl,"onUpdate:modelValue":a[5]||(a[5]=e=>ve.value.websiteUrl=e),placeholder:"请输入网站地址"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Y(s,{label:"公司地址",prop:"companyAddress"},{default:ee(()=>[Y(t,{modelValue:ve.value.companyAddress,"onUpdate:modelValue":a[6]||(a[6]=e=>ve.value.companyAddress=e),placeholder:"请输入公司地址"},null,8,["modelValue"])]),_:1}),Y(s,{label:"系统描述",prop:"systemDescription"},{default:ee(()=>[Y(t,{modelValue:ve.value.systemDescription,"onUpdate:modelValue":a[7]||(a[7]=e=>ve.value.systemDescription=e),type:"textarea",rows:3,placeholder:"请输入系统描述"},null,8,["modelValue"])]),_:1}),Y(s,{label:"系统Logo",prop:"systemLogo"},{default:ee(()=>[Y(F,{class:"logo-uploader",action:"#","show-file-list":!1,"before-upload":ol,"on-success":nl},{default:ee(()=>[ve.value.systemLogo?(G(),Q("img",{key:0,src:ve.value.systemLogo,class:"logo"},null,8,At)):(G(),te(q,{key:1,class:"logo-uploader-icon"},{default:ee(()=>[Y(X(c))]),_:1}))]),_:1}),a[115]||(a[115]=Z("div",{class:"upload-tip"},"建议尺寸：200x60px，支持 jpg、png 格式",-1))]),_:1}),Y(K,{"content-position":"left"},{default:ee(()=>[...a[116]||(a[116]=[ae("联系二维码",-1)])]),_:1}),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:12},{default:ee(()=>[Y(s,{label:"二维码标签"},{default:ee(()=>[Y(t,{modelValue:ve.value.contactQRCodeLabel,"onUpdate:modelValue":a[8]||(a[8]=e=>ve.value.contactQRCodeLabel=e),placeholder:"请输入二维码标签（如：微信、企业微信、QQ等）"},null,8,["modelValue"]),a[117]||(a[117]=Z("div",{class:"upload-tip"},"用于说明二维码的用途",-1))]),_:1})]),_:1}),Y(o,{span:12},{default:ee(()=>[Y(s,{label:"上传二维码"},{default:ee(()=>[Z("div",It,[Y(l,{type:"primary",size:"small",icon:X(_),onClick:rl},{default:ee(()=>[...a[118]||(a[118]=[ae(" 点击上传 ",-1)])]),_:1},8,["icon"]),Y(l,{type:"success",size:"small",icon:X(w),onClick:ul},{default:ee(()=>[...a[119]||(a[119]=[ae(" 粘贴图片 ",-1)])]),_:1},8,["icon"])]),ve.value.contactQRCode?(G(),Q("div",Tt,[Z("div",{class:"qr-thumbnail",onClick:pl},[Z("img",{src:ve.value.contactQRCode,alt:"二维码"},null,8,Ot),Z("div",Pt,[Y(q,{class:"zoom-icon"},{default:ee(()=>[Y(X(x))]),_:1})])]),Y(l,{size:"small",type:"danger",text:"",icon:X(b),onClick:ml},{default:ee(()=>[...a[120]||(a[120]=[ae(" 删除 ",-1)])]),_:1},8,["icon"])])):(G(),Q("div",Dt,[Y(q,{size:"48",color:"#dcdfe6"},{default:ee(()=>[Y(X(S))]),_:1}),a[121]||(a[121]=Z("p",null,"点击上传或粘贴二维码图片",-1))])),a[122]||(a[122]=Z("div",{class:"upload-tip"},"建议尺寸：200x200px，支持 jpg、png 格式，大小不超过2MB",-1)),Z("input",{ref_key:"qrFileInput",ref:il,type:"file",accept:"image/*",style:{display:"none"},onChange:cl},null,544)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),Y(he,{label:"安全设置",name:"security"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",Ut,[a[124]||(a[124]=Z("span",null,"安全配置",-1)),Za.value?(G(),te(l,{key:0,onClick:_l,type:"primary",loading:m.value},{default:ee(()=>[...a[123]||(a[123]=[ae(" 保存设置 ",-1)])]),_:1},8,["loading"])):se("",!0)])]),default:ee(()=>[Y(j,{ref_key:"securityFormRef",ref:Fa,model:Te.value,rules:Na,"label-width":"150px",class:"setting-form"},{default:ee(()=>[Y(s,{label:"密码最小长度",prop:"passwordMinLength"},{default:ee(()=>[Y(be,{modelValue:Te.value.passwordMinLength,"onUpdate:modelValue":a[9]||(a[9]=e=>Te.value.passwordMinLength=e),min:6,max:20,placeholder:"密码最小长度"},null,8,["modelValue"]),a[125]||(a[125]=Z("span",{class:"form-tip"},"建议设置为6-20位",-1))]),_:1}),Y(s,{label:"密码复杂度要求",prop:"passwordComplexity"},{default:ee(()=>[Y(we,{modelValue:Te.value.passwordComplexity,"onUpdate:modelValue":a[10]||(a[10]=e=>Te.value.passwordComplexity=e)},{default:ee(()=>[Y(_e,{label:"uppercase"},{default:ee(()=>[...a[126]||(a[126]=[ae("包含大写字母",-1)])]),_:1}),Y(_e,{label:"lowercase"},{default:ee(()=>[...a[127]||(a[127]=[ae("包含小写字母",-1)])]),_:1}),Y(_e,{label:"number"},{default:ee(()=>[...a[128]||(a[128]=[ae("包含数字",-1)])]),_:1}),Y(_e,{label:"special"},{default:ee(()=>[...a[129]||(a[129]=[ae("包含特殊字符",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),Y(s,{label:"密码有效期",prop:"passwordExpireDays"},{default:ee(()=>[Y(be,{modelValue:Te.value.passwordExpireDays,"onUpdate:modelValue":a[11]||(a[11]=e=>Te.value.passwordExpireDays=e),min:0,max:365,placeholder:"密码有效期"},null,8,["modelValue"]),a[130]||(a[130]=Z("span",{class:"form-tip"},"天（0表示永不过期）",-1))]),_:1}),Y(s,{label:"登录失败锁定",prop:"loginFailLock"},{default:ee(()=>[Y(xe,{modelValue:Te.value.loginFailLock,"onUpdate:modelValue":a[12]||(a[12]=e=>Te.value.loginFailLock=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),Te.value.loginFailLock?(G(),te(s,{key:0,label:"最大失败次数",prop:"maxLoginFails"},{default:ee(()=>[Y(be,{modelValue:Te.value.maxLoginFails,"onUpdate:modelValue":a[13]||(a[13]=e=>Te.value.maxLoginFails=e),min:3,max:10,placeholder:"最大失败次数"},null,8,["modelValue"]),a[131]||(a[131]=Z("span",{class:"form-tip"},"次",-1))]),_:1})):se("",!0),Te.value.loginFailLock?(G(),te(s,{key:1,label:"锁定时间",prop:"lockDuration"},{default:ee(()=>[Y(be,{modelValue:Te.value.lockDuration,"onUpdate:modelValue":a[14]||(a[14]=e=>Te.value.lockDuration=e),min:5,max:1440,placeholder:"锁定时间"},null,8,["modelValue"]),a[132]||(a[132]=Z("span",{class:"form-tip"},"分钟",-1))]),_:1})):se("",!0),Y(s,{label:"会话超时时间",prop:"sessionTimeout"},{default:ee(()=>[Y(be,{modelValue:Te.value.sessionTimeout,"onUpdate:modelValue":a[15]||(a[15]=e=>Te.value.sessionTimeout=e),min:30,max:1440,placeholder:"会话超时时间"},null,8,["modelValue"]),a[133]||(a[133]=Z("span",{class:"form-tip"},"分钟",-1))]),_:1}),Y(s,{label:"强制HTTPS",prop:"forceHttps"},{default:ee(()=>[Y(xe,{modelValue:Te.value.forceHttps,"onUpdate:modelValue":a[16]||(a[16]=e=>Te.value.forceHttps=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),Y(s,{label:"IP白名单",prop:"ipWhitelist"},{default:ee(()=>[Y(t,{modelValue:Te.value.ipWhitelist,"onUpdate:modelValue":a[17]||(a[17]=e=>Te.value.ipWhitelist=e),type:"textarea",rows:3,placeholder:"请输入IP地址，多个IP用换行分隔"},null,8,["modelValue"]),a[134]||(a[134]=Z("div",{class:"form-tip"},"留空表示不限制IP访问",-1))]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),Y(he,{label:"通话设置",name:"call"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",Nt,[a[137]||(a[137]=Z("span",null,"通话配置",-1)),Z("div",Et,[Y(l,{onClick:Sl,type:"info",size:"small",loading:ge.value},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(A))]),_:1}),a[135]||(a[135]=ae(" 测试连接 ",-1))]),_:1},8,["loading"]),Ya.value?(G(),te(l,{key:0,onClick:xl,type:"primary",loading:pe.value},{default:ee(()=>[...a[136]||(a[136]=[ae(" 保存设置 ",-1)])]),_:1},8,["loading"])):se("",!0)])])]),default:ee(()=>[Y(j,{ref_key:"callFormRef",ref:Ka,model:Le,rules:$a,"label-width":"150px",class:"setting-form"},{default:ee(()=>[Z("div",$t,[Z("h4",Bt,[Y(q,null,{default:ee(()=>[Y(X(k))]),_:1}),a[138]||(a[138]=ae(" SIP服务器配置 ",-1))]),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:12},{default:ee(()=>[Y(s,{label:"SIP服务器地址",prop:"sipServer"},{default:ee(()=>[Y(t,{modelValue:Le.sipServer,"onUpdate:modelValue":a[18]||(a[18]=e=>Le.sipServer=e),placeholder:"请输入SIP服务器地址"},null,8,["modelValue"])]),_:1})]),_:1}),Y(o,{span:12},{default:ee(()=>[Y(s,{label:"SIP端口",prop:"sipPort"},{default:ee(()=>[Y(be,{modelValue:Le.sipPort,"onUpdate:modelValue":a[19]||(a[19]=e=>Le.sipPort=e),min:1,max:65535,placeholder:"SIP端口"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:12},{default:ee(()=>[Y(s,{label:"用户名",prop:"sipUsername"},{default:ee(()=>[Y(t,{modelValue:Le.sipUsername,"onUpdate:modelValue":a[20]||(a[20]=e=>Le.sipUsername=e),placeholder:"请输入SIP用户名"},null,8,["modelValue"])]),_:1})]),_:1}),Y(o,{span:12},{default:ee(()=>[Y(s,{label:"密码",prop:"sipPassword"},{default:ee(()=>[Y(t,{modelValue:Le.sipPassword,"onUpdate:modelValue":a[21]||(a[21]=e=>Le.sipPassword=e),type:"password",placeholder:"请输入SIP密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Y(s,{label:"传输协议",prop:"sipTransport"},{default:ee(()=>[Y(ke,{modelValue:Le.sipTransport,"onUpdate:modelValue":a[22]||(a[22]=e=>Le.sipTransport=e)},{default:ee(()=>[Y(Se,{label:"UDP"},{default:ee(()=>[...a[139]||(a[139]=[ae("UDP",-1)])]),_:1}),Y(Se,{label:"TCP"},{default:ee(()=>[...a[140]||(a[140]=[ae("TCP",-1)])]),_:1}),Y(Se,{label:"TLS"},{default:ee(()=>[...a[141]||(a[141]=[ae("TLS",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),Z("div",Rt,[Z("h4",Mt,[Y(q,null,{default:ee(()=>[Y(X(C))]),_:1}),a[142]||(a[142]=ae(" 通话功能配置 ",-1))]),Y(s,{label:"自动接听",prop:"autoAnswer"},{default:ee(()=>[Y(xe,{modelValue:Le.autoAnswer,"onUpdate:modelValue":a[23]||(a[23]=e=>Le.autoAnswer=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),a[143]||(a[143]=Z("span",{class:"form-tip"},"启用后将自动接听来电",-1))]),_:1}),Y(s,{label:"自动录音",prop:"autoRecord"},{default:ee(()=>[Y(xe,{modelValue:Le.autoRecord,"onUpdate:modelValue":a[24]||(a[24]=e=>Le.autoRecord=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),a[144]||(a[144]=Z("span",{class:"form-tip"},"启用后将自动录制通话",-1))]),_:1}),Y(s,{label:"通话质量监控",prop:"qualityMonitoring"},{default:ee(()=>[Y(xe,{modelValue:Le.qualityMonitoring,"onUpdate:modelValue":a[25]||(a[25]=e=>Le.qualityMonitoring=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),a[145]||(a[145]=Z("span",{class:"form-tip"},"启用后将监控通话质量",-1))]),_:1}),Y(s,{label:"呼入弹窗",prop:"incomingCallPopup"},{default:ee(()=>[Y(xe,{modelValue:Le.incomingCallPopup,"onUpdate:modelValue":a[26]||(a[26]=e=>Le.incomingCallPopup=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),a[146]||(a[146]=Z("span",{class:"form-tip"},"启用后来电时自动弹出客户详情",-1))]),_:1}),Y(s,{label:"最大通话时长",prop:"maxCallDuration"},{default:ee(()=>[Y(be,{modelValue:Le.maxCallDuration,"onUpdate:modelValue":a[27]||(a[27]=e=>Le.maxCallDuration=e),min:1,max:7200,placeholder:"最大通话时长"},null,8,["modelValue"]),a[147]||(a[147]=Z("span",{class:"form-tip"},"秒（1-7200秒，0表示不限制）",-1))]),_:1})]),Z("div",Lt,[Z("h4",qt,[Y(q,null,{default:ee(()=>[Y(X(V))]),_:1}),a[148]||(a[148]=ae(" 录音配置 ",-1))]),Y(s,{label:"录音格式",prop:"recordFormat"},{default:ee(()=>[Y(Ve,{modelValue:Le.recordFormat,"onUpdate:modelValue":a[28]||(a[28]=e=>Le.recordFormat=e),placeholder:"请选择录音格式"},{default:ee(()=>[Y(Ce,{label:"WAV",value:"wav"}),Y(Ce,{label:"MP3",value:"mp3"}),Y(Ce,{label:"AAC",value:"aac"})]),_:1},8,["modelValue"])]),_:1}),Y(s,{label:"录音质量",prop:"recordQuality"},{default:ee(()=>[Y(Ve,{modelValue:Le.recordQuality,"onUpdate:modelValue":a[29]||(a[29]=e=>Le.recordQuality=e),placeholder:"请选择录音质量"},{default:ee(()=>[Y(Ce,{label:"标准质量",value:"standard"}),Y(Ce,{label:"高质量",value:"high"}),Y(Ce,{label:"超高质量",value:"ultra"})]),_:1},8,["modelValue"])]),_:1}),Y(s,{label:"录音保存路径",prop:"recordPath"},{default:ee(()=>[Y(t,{modelValue:Le.recordPath,"onUpdate:modelValue":a[30]||(a[30]=e=>Le.recordPath=e),placeholder:"请输入录音保存路径"},null,8,["modelValue"]),a[149]||(a[149]=Z("span",{class:"form-tip"},"录音文件的存储路径",-1))]),_:1}),Y(s,{label:"录音保留时间",prop:"recordRetentionDays"},{default:ee(()=>[Y(be,{modelValue:Le.recordRetentionDays,"onUpdate:modelValue":a[31]||(a[31]=e=>Le.recordRetentionDays=e),min:1,max:365,placeholder:"录音保留时间"},null,8,["modelValue"]),a[150]||(a[150]=Z("span",{class:"form-tip"},"天（1-365天）",-1))]),_:1})]),Z("div",Ft,[Z("h4",Kt,[Y(q,null,{default:ee(()=>[Y(X(z))]),_:1}),a[151]||(a[151]=ae(" 权限管理 ",-1))]),Y(s,{label:"外呼权限",prop:"outboundPermission"},{default:ee(()=>[Y(we,{modelValue:Le.outboundPermission,"onUpdate:modelValue":a[32]||(a[32]=e=>Le.outboundPermission=e)},{default:ee(()=>[Y(_e,{label:"admin"},{default:ee(()=>[...a[152]||(a[152]=[ae("管理员",-1)])]),_:1}),Y(_e,{label:"manager"},{default:ee(()=>[...a[153]||(a[153]=[ae("经理",-1)])]),_:1}),Y(_e,{label:"sales"},{default:ee(()=>[...a[154]||(a[154]=[ae("销售",-1)])]),_:1}),Y(_e,{label:"service"},{default:ee(()=>[...a[155]||(a[155]=[ae("客服",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),Y(s,{label:"录音访问权限",prop:"recordAccessPermission"},{default:ee(()=>[Y(we,{modelValue:Le.recordAccessPermission,"onUpdate:modelValue":a[33]||(a[33]=e=>Le.recordAccessPermission=e)},{default:ee(()=>[Y(_e,{label:"admin"},{default:ee(()=>[...a[156]||(a[156]=[ae("管理员",-1)])]),_:1}),Y(_e,{label:"manager"},{default:ee(()=>[...a[157]||(a[157]=[ae("经理",-1)])]),_:1}),Y(_e,{label:"self"},{default:ee(()=>[...a[158]||(a[158]=[ae("仅本人",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),Y(s,{label:"通话统计权限",prop:"statisticsPermission"},{default:ee(()=>[Y(we,{modelValue:Le.statisticsPermission,"onUpdate:modelValue":a[34]||(a[34]=e=>Le.statisticsPermission=e)},{default:ee(()=>[Y(_e,{label:"admin"},{default:ee(()=>[...a[159]||(a[159]=[ae("管理员",-1)])]),_:1}),Y(_e,{label:"manager"},{default:ee(()=>[...a[160]||(a[160]=[ae("经理",-1)])]),_:1}),Y(_e,{label:"sales"},{default:ee(()=>[...a[161]||(a[161]=[ae("销售",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),Y(s,{label:"号码限制",prop:"numberRestriction"},{default:ee(()=>[Y(xe,{modelValue:Le.numberRestriction,"onUpdate:modelValue":a[35]||(a[35]=e=>Le.numberRestriction=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),a[162]||(a[162]=Z("span",{class:"form-tip"},"启用后将限制可拨打的号码范围",-1))]),_:1}),Le.numberRestriction?(G(),te(s,{key:0,label:"允许的号码前缀",prop:"allowedPrefixes"},{default:ee(()=>[Y(t,{modelValue:Le.allowedPrefixes,"onUpdate:modelValue":a[36]||(a[36]=e=>Le.allowedPrefixes=e),type:"textarea",rows:3,placeholder:"请输入允许的号码前缀，多个前缀用换行分隔"},null,8,["modelValue"]),a[163]||(a[163]=Z("span",{class:"form-tip"},"例如：138、139、186等",-1))]),_:1})):se("",!0)])]),_:1},8,["model"])]),_:1})]),_:1}),Y(he,{label:"邮件设置",name:"email"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",jt,[a[166]||(a[166]=Z("span",null,"邮件配置",-1)),Z("div",Jt,[Xa.value?(G(),te(l,{key:0,onClick:kl,loading:v.value},{default:ee(()=>[...a[164]||(a[164]=[ae(" 测试邮件 ",-1)])]),_:1},8,["loading"])):se("",!0),Xa.value?(G(),te(l,{key:1,onClick:wl,type:"primary",loading:g.value},{default:ee(()=>[...a[165]||(a[165]=[ae(" 保存设置 ",-1)])]),_:1},8,["loading"])):se("",!0)])])]),default:ee(()=>[Y(j,{ref_key:"emailFormRef",ref:ja,model:Me,rules:Ea,"label-width":"120px",class:"setting-form"},{default:ee(()=>[Y(s,{label:"SMTP服务器",prop:"smtpHost"},{default:ee(()=>[Y(t,{modelValue:Me.smtpHost,"onUpdate:modelValue":a[37]||(a[37]=e=>Me.smtpHost=e),placeholder:"请输入SMTP服务器地址"},null,8,["modelValue"])]),_:1}),Y(s,{label:"SMTP端口",prop:"smtpPort"},{default:ee(()=>[Y(be,{modelValue:Me.smtpPort,"onUpdate:modelValue":a[38]||(a[38]=e=>Me.smtpPort=e),min:1,max:65535,placeholder:"SMTP端口"},null,8,["modelValue"])]),_:1}),Y(s,{label:"发件人邮箱",prop:"senderEmail"},{default:ee(()=>[Y(t,{modelValue:Me.senderEmail,"onUpdate:modelValue":a[39]||(a[39]=e=>Me.senderEmail=e),placeholder:"请输入发件人邮箱"},null,8,["modelValue"])]),_:1}),Y(s,{label:"发件人名称",prop:"senderName"},{default:ee(()=>[Y(t,{modelValue:Me.senderName,"onUpdate:modelValue":a[40]||(a[40]=e=>Me.senderName=e),placeholder:"请输入发件人名称"},null,8,["modelValue"])]),_:1}),Y(s,{label:"邮箱密码",prop:"emailPassword"},{default:ee(()=>[Y(t,{modelValue:Me.emailPassword,"onUpdate:modelValue":a[41]||(a[41]=e=>Me.emailPassword=e),type:"password",placeholder:"请输入邮箱密码或授权码","show-password":""},null,8,["modelValue"])]),_:1}),Y(s,{label:"启用SSL",prop:"enableSsl"},{default:ee(()=>[Y(xe,{modelValue:Me.enableSsl,"onUpdate:modelValue":a[42]||(a[42]=e=>Me.enableSsl=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),Y(s,{label:"启用TLS",prop:"enableTls"},{default:ee(()=>[Y(xe,{modelValue:Me.enableTls,"onUpdate:modelValue":a[43]||(a[43]=e=>Me.enableTls=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),Y(s,{label:"测试邮箱",prop:"testEmail"},{default:ee(()=>[Y(t,{modelValue:Me.testEmail,"onUpdate:modelValue":a[44]||(a[44]=e=>Me.testEmail=e),placeholder:"请输入测试邮箱地址"},null,8,["modelValue"]),a[167]||(a[167]=Z("div",{class:"form-tip"},"用于测试邮件发送功能",-1))]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),Y(he,{label:"短信设置",name:"sms"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",Wt,[a[171]||(a[171]=Z("span",null,"短信配置",-1)),Z("div",Ht,[sl.value?(G(),te(l,{key:0,onClick:zl,type:"success",icon:X(C)},{default:ee(()=>[...a[168]||(a[168]=[ae(" 短信管理 ",-1)])]),_:1},8,["icon"])):se("",!0),el.value?(G(),te(l,{key:1,onClick:Vl,loading:L.value},{default:ee(()=>[...a[169]||(a[169]=[ae(" 测试短信 ",-1)])]),_:1},8,["loading"])):se("",!0),el.value?(G(),te(l,{key:2,onClick:Cl,type:"primary",loading:M.value},{default:ee(()=>[...a[170]||(a[170]=[ae(" 保存设置 ",-1)])]),_:1},8,["loading"])):se("",!0)])])]),default:ee(()=>[Y(j,{ref_key:"smsFormRef",ref:Ja,model:qe.value,rules:Ba,"label-width":"120px",class:"setting-form"},{default:ee(()=>[Y(s,{label:"短信服务商",prop:"provider"},{default:ee(()=>[Y(Ve,{modelValue:qe.value.provider,"onUpdate:modelValue":a[45]||(a[45]=e=>qe.value.provider=e),placeholder:"请选择短信服务商",style:{width:"100%"}},{default:ee(()=>[Y(Ce,{label:"阿里云短信",value:"aliyun"}),Y(Ce,{label:"腾讯云短信",value:"tencent"}),Y(Ce,{label:"华为云短信",value:"huawei"}),Y(Ce,{label:"网易云信",value:"netease"})]),_:1},8,["modelValue"])]),_:1}),Y(s,{label:"AccessKey",prop:"accessKey"},{default:ee(()=>[Y(t,{modelValue:qe.value.accessKey,"onUpdate:modelValue":a[46]||(a[46]=e=>qe.value.accessKey=e),placeholder:"请输入AccessKey","show-password":""},null,8,["modelValue"])]),_:1}),Y(s,{label:"SecretKey",prop:"secretKey"},{default:ee(()=>[Y(t,{modelValue:qe.value.secretKey,"onUpdate:modelValue":a[47]||(a[47]=e=>qe.value.secretKey=e),placeholder:"请输入SecretKey","show-password":""},null,8,["modelValue"])]),_:1}),Y(s,{label:"短信签名",prop:"signName"},{default:ee(()=>[Y(t,{modelValue:qe.value.signName,"onUpdate:modelValue":a[48]||(a[48]=e=>qe.value.signName=e),placeholder:"请输入短信签名"},null,8,["modelValue"]),a[172]||(a[172]=Z("div",{class:"form-tip"},"短信签名需要在服务商平台申请并审核通过",-1))]),_:1}),Y(s,{label:"每日发送限制",prop:"dailyLimit"},{default:ee(()=>[Y(be,{modelValue:qe.value.dailyLimit,"onUpdate:modelValue":a[49]||(a[49]=e=>qe.value.dailyLimit=e),min:1,max:1e4,placeholder:"每日发送限制",style:{width:"100%"}},null,8,["modelValue"]),a[173]||(a[173]=Z("div",{class:"form-tip"},"单个用户每日最大发送短信数量",-1))]),_:1}),Y(s,{label:"每月发送限制",prop:"monthlyLimit"},{default:ee(()=>[Y(be,{modelValue:qe.value.monthlyLimit,"onUpdate:modelValue":a[50]||(a[50]=e=>qe.value.monthlyLimit=e),min:1,max:1e5,placeholder:"每月发送限制",style:{width:"100%"}},null,8,["modelValue"]),a[174]||(a[174]=Z("div",{class:"form-tip"},"单个用户每月最大发送短信数量",-1))]),_:1}),Y(s,{label:"启用短信功能"},{default:ee(()=>[Y(xe,{modelValue:qe.value.enabled,"onUpdate:modelValue":a[51]||(a[51]=e=>qe.value.enabled=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),Y(s,{label:"需要审核"},{default:ee(()=>[Y(xe,{modelValue:qe.value.requireApproval,"onUpdate:modelValue":a[52]||(a[52]=e=>qe.value.requireApproval=e),"active-text":"需要","inactive-text":"不需要"},null,8,["modelValue"]),a[175]||(a[175]=Z("div",{class:"form-tip"},"开启后，短信发送需要管理员审核",-1))]),_:1}),Y(s,{label:"测试手机号",prop:"testPhone"},{default:ee(()=>[Y(t,{modelValue:qe.value.testPhone,"onUpdate:modelValue":a[53]||(a[53]=e=>qe.value.testPhone=e),placeholder:"请输入测试手机号"},null,8,["modelValue"]),a[176]||(a[176]=Z("div",{class:"form-tip"},"用于测试短信发送功能",-1))]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),Y(he,{label:"存储设置",name:"storage"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",Qt,[a[179]||(a[179]=Z("span",null,"存储配置",-1)),Z("div",Gt,[Y(l,{onClick:Fl,type:"info",size:"small",loading:de.value},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(C))]),_:1}),a[177]||(a[177]=ae(" 测试功能 ",-1))]),_:1},8,["loading"]),al.value?(G(),te(l,{key:0,onClick:Ul,type:"primary",loading:J.value},{default:ee(()=>[...a[178]||(a[178]=[ae(" 保存设置 ",-1)])]),_:1},8,["loading"])):se("",!0)])])]),default:ee(()=>[Y(j,{ref_key:"storageFormRef",ref:Wa,model:je.value,rules:Ra.value,"label-width":"120px",class:"setting-form"},{default:ee(()=>[Y(s,{label:"存储类型",prop:"storageType"},{default:ee(()=>[Y(ke,{modelValue:je.value.storageType,"onUpdate:modelValue":a[54]||(a[54]=e=>je.value.storageType=e)},{default:ee(()=>[Y(Se,{label:"local"},{default:ee(()=>[...a[180]||(a[180]=[ae("本地存储",-1)])]),_:1}),Y(Se,{label:"oss"},{default:ee(()=>[...a[181]||(a[181]=[ae("阿里云OSS",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"local"===je.value.storageType?(G(),Q(ne,{key:0},[Y(s,{label:"存储路径",prop:"localPath"},{default:ee(()=>[Y(t,{modelValue:je.value.localPath,"onUpdate:modelValue":a[55]||(a[55]=e=>je.value.localPath=e),placeholder:"请输入本地存储路径"},null,8,["modelValue"])]),_:1}),Y(s,{label:"访问域名",prop:"localDomain"},{default:ee(()=>[Y(t,{modelValue:je.value.localDomain,"onUpdate:modelValue":a[56]||(a[56]=e=>je.value.localDomain=e),placeholder:"请输入访问域名"},null,8,["modelValue"])]),_:1})],64)):se("",!0),"local"!==je.value.storageType?(G(),Q(ne,{key:1},[Y(s,{label:"Access Key",prop:"accessKey"},{default:ee(()=>[Y(t,{modelValue:je.value.accessKey,"onUpdate:modelValue":a[57]||(a[57]=e=>je.value.accessKey=e),placeholder:"请输入Access Key"},null,8,["modelValue"])]),_:1}),Y(s,{label:"Secret Key",prop:"secretKey"},{default:ee(()=>[Y(t,{modelValue:je.value.secretKey,"onUpdate:modelValue":a[58]||(a[58]=e=>je.value.secretKey=e),type:"password",placeholder:"请输入Secret Key","show-password":""},null,8,["modelValue"])]),_:1}),Y(s,{label:"存储桶名称",prop:"bucketName"},{default:ee(()=>[Y(t,{modelValue:je.value.bucketName,"onUpdate:modelValue":a[59]||(a[59]=e=>je.value.bucketName=e),placeholder:"请输入存储桶名称"},null,8,["modelValue"])]),_:1}),Y(s,{label:"存储区域",prop:"region"},{default:ee(()=>[Y(Ve,{modelValue:je.value.region,"onUpdate:modelValue":a[60]||(a[60]=e=>je.value.region=e),placeholder:"请选择存储区域",style:{width:"100%"}},{default:ee(()=>[Y(Ce,{label:"华东1（杭州）",value:"oss-cn-hangzhou"}),Y(Ce,{label:"华东2（上海）",value:"oss-cn-shanghai"}),Y(Ce,{label:"华北1（青岛）",value:"oss-cn-qingdao"}),Y(Ce,{label:"华北2（北京）",value:"oss-cn-beijing"}),Y(Ce,{label:"华北3（张家口）",value:"oss-cn-zhangjiakou"}),Y(Ce,{label:"华北5（呼和浩特）",value:"oss-cn-huhehaote"}),Y(Ce,{label:"华北6（乌兰察布）",value:"oss-cn-wulanchabu"}),Y(Ce,{label:"华南1（深圳）",value:"oss-cn-shenzhen"}),Y(Ce,{label:"华南2（河源）",value:"oss-cn-heyuan"}),Y(Ce,{label:"华南3（广州）",value:"oss-cn-guangzhou"}),Y(Ce,{label:"西南1（成都）",value:"oss-cn-chengdu"}),Y(Ce,{label:"中国（香港）",value:"oss-cn-hongkong"}),Y(Ce,{label:"美国西部1（硅谷）",value:"oss-us-west-1"}),Y(Ce,{label:"美国东部1（弗吉尼亚）",value:"oss-us-east-1"}),Y(Ce,{label:"亚太东南1（新加坡）",value:"oss-ap-southeast-1"}),Y(Ce,{label:"亚太东南2（悉尼）",value:"oss-ap-southeast-2"}),Y(Ce,{label:"亚太东南3（吉隆坡）",value:"oss-ap-southeast-3"}),Y(Ce,{label:"亚太东南5（雅加达）",value:"oss-ap-southeast-5"}),Y(Ce,{label:"亚太东北1（东京）",value:"oss-ap-northeast-1"}),Y(Ce,{label:"亚太南部1（孟买）",value:"oss-ap-south-1"}),Y(Ce,{label:"欧洲中部1（法兰克福）",value:"oss-eu-central-1"}),Y(Ce,{label:"英国（伦敦）",value:"oss-eu-west-1"}),Y(Ce,{label:"中东东部1（迪拜）",value:"oss-me-east-1"})]),_:1},8,["modelValue"]),a[182]||(a[182]=Z("div",{class:"form-tip"},"选择与您的Bucket相同的区域",-1))]),_:1}),Y(s,{label:"自定义域名",prop:"customDomain"},{default:ee(()=>[Y(t,{modelValue:je.value.customDomain,"onUpdate:modelValue":a[61]||(a[61]=e=>je.value.customDomain=e),placeholder:"请输入自定义域名（可选）"},null,8,["modelValue"])]),_:1})],64)):se("",!0),Y(s,{label:"最大文件大小",prop:"maxFileSize"},{default:ee(()=>[Y(be,{modelValue:je.value.maxFileSize,"onUpdate:modelValue":a[62]||(a[62]=e=>je.value.maxFileSize=e),min:1,max:100,placeholder:"最大文件大小"},null,8,["modelValue"]),a[183]||(a[183]=Z("span",{class:"form-tip"},"MB",-1))]),_:1}),Y(s,{label:"允许的文件类型",prop:"allowedTypes"},{default:ee(()=>[Y(t,{modelValue:je.value.allowedTypes,"onUpdate:modelValue":a[63]||(a[63]=e=>je.value.allowedTypes=e),placeholder:"请输入允许的文件类型，用逗号分隔"},null,8,["modelValue"]),a[184]||(a[184]=Z("div",{class:"form-tip"},"例如：jpg,png,gif,pdf,doc,docx",-1))]),_:1}),Y(K,{"content-position":"left"},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(S))]),_:1}),a[185]||(a[185]=ae(" 图片上传压缩配置 ",-1))]),_:1}),Y(s,{label:"启用压缩"},{default:ee(()=>[Y(xe,{modelValue:je.value.imageCompressEnabled,"onUpdate:modelValue":a[64]||(a[64]=e=>je.value.imageCompressEnabled=e)},null,8,["modelValue"]),a[186]||(a[186]=Z("div",{class:"form-tip"},"启用后上传的图片将自动压缩，减少存储空间和加载时间",-1))]),_:1}),je.value.imageCompressEnabled?(G(),Q(ne,{key:2},[Y(s,{label:"压缩质量"},{default:ee(()=>[Y(ke,{modelValue:je.value.imageCompressQuality,"onUpdate:modelValue":a[65]||(a[65]=e=>je.value.imageCompressQuality=e)},{default:ee(()=>[Y(Se,{label:"high"},{default:ee(()=>[...a[187]||(a[187]=[Z("span",{class:"quality-option"},[Z("span",{class:"quality-name"},"高清"),Z("span",{class:"quality-desc"},"（质量80%，最大宽度1920px）")],-1)])]),_:1}),Y(Se,{label:"medium"},{default:ee(()=>[...a[188]||(a[188]=[Z("span",{class:"quality-option"},[Z("span",{class:"quality-name"},"标准"),Z("span",{class:"quality-desc"},"（质量60%，最大宽度1200px）")],-1)])]),_:1}),Y(Se,{label:"low"},{default:ee(()=>[...a[189]||(a[189]=[Z("span",{class:"quality-option"},[Z("span",{class:"quality-name"},"省流"),Z("span",{class:"quality-desc"},"（质量40%，最大宽度800px）")],-1)])]),_:1}),Y(Se,{label:"custom"},{default:ee(()=>[...a[190]||(a[190]=[Z("span",{class:"quality-option"},[Z("span",{class:"quality-name"},"自定义")],-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"custom"===je.value.imageCompressQuality?(G(),Q(ne,{key:0},[Y(s,{label:"最大宽度"},{default:ee(()=>[Y(be,{modelValue:je.value.imageCompressMaxWidth,"onUpdate:modelValue":a[66]||(a[66]=e=>je.value.imageCompressMaxWidth=e),min:400,max:4096,step:100},null,8,["modelValue"]),a[191]||(a[191]=Z("span",{class:"form-tip"},"px（超过此宽度的图片将被等比缩放）",-1))]),_:1}),Y(s,{label:"压缩比例"},{default:ee(()=>[Y(ze,{modelValue:je.value.imageCompressCustomQuality,"onUpdate:modelValue":a[67]||(a[67]=e=>je.value.imageCompressCustomQuality=e),min:10,max:100,step:5,"show-input":"",style:{"max-width":"400px"}},null,8,["modelValue"]),a[192]||(a[192]=Z("div",{class:"form-tip"},"数值越低压缩越强，文件越小，但图片质量会下降",-1))]),_:1})],64)):se("",!0),Y(s,null,{default:ee(()=>[Y(Ae,{title:Pa.value,type:"info",closable:!1,"show-icon":""},null,8,["title"])]),_:1})],64)):se("",!0),"local"!==je.value.storageType?(G(),Q(ne,{key:3},[Y(K,{"content-position":"left"},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(_))]),_:1}),a[193]||(a[193]=ae(" 数据同步设置 ",-1))]),_:1}),Y(s,{label:"自动同步"},{default:ee(()=>[Y(xe,{modelValue:We.value.autoSync,"onUpdate:modelValue":a[68]||(a[68]=e=>We.value.autoSync=e),onChange:Bl},null,8,["modelValue"]),a[194]||(a[194]=Z("div",{class:"form-tip"},"启用后将定期自动同步数据到云端",-1))]),_:1}),We.value.autoSync?(G(),te(s,{key:0,label:"同步间隔"},{default:ee(()=>[Y(be,{modelValue:We.value.syncInterval,"onUpdate:modelValue":a[69]||(a[69]=e=>We.value.syncInterval=e),min:5,max:1440,onChange:Bl},null,8,["modelValue"]),a[195]||(a[195]=Z("span",{class:"form-tip"},"分钟（建议30-60分钟）",-1))]),_:1})):se("",!0),Y(s,{label:"实时同步"},{default:ee(()=>[Y(xe,{modelValue:We.value.syncOnDataChange,"onUpdate:modelValue":a[70]||(a[70]=e=>We.value.syncOnDataChange=e),onChange:Bl},null,8,["modelValue"]),a[196]||(a[196]=Z("div",{class:"form-tip"},"数据变更时立即同步到云端",-1))]),_:1}),Y(s,{label:"备份保留数量"},{default:ee(()=>[Y(be,{modelValue:We.value.backupRetention,"onUpdate:modelValue":a[71]||(a[71]=e=>We.value.backupRetention=e),min:1,max:20,onChange:Bl},null,8,["modelValue"]),a[197]||(a[197]=Z("span",{class:"form-tip"},"个（保留最近的备份文件数量）",-1))]),_:1}),Y(s,{label:"同步状态"},{default:ee(()=>[Z("div",Zt,[Y(Ie,{type:He.value.isEnabled?"success":"danger",class:"status-tag"},{default:ee(()=>[ae(le(He.value.isEnabled?"已启用":"未启用"),1)]),_:1},8,["type"]),He.value.syncInProgress?(G(),te(Ie,{key:0,type:"warning",class:"status-tag"},{default:ee(()=>[...a[198]||(a[198]=[ae(" 同步中... ",-1)])]),_:1})):se("",!0),He.value.lastSyncTime?(G(),Q("div",Yt," 最后同步: "+le(ql(He.value.lastSyncTime)),1)):se("",!0),He.value.totalItems>0?(G(),Q("div",Xt,[ae(" 已同步: "+le(He.value.syncedItems)+"/"+le(He.value.totalItems)+" ",1),He.value.failedItems>0?(G(),Q("span",es," (失败: "+le(He.value.failedItems)+") ",1)):se("",!0)])):se("",!0)])]),_:1}),Y(s,{label:"同步操作"},{default:ee(()=>[Z("div",as,[Y(l,{onClick:Rl,loading:He.value.syncInProgress,disabled:!He.value.isEnabled,type:"primary",size:"small"},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(_))]),_:1}),a[199]||(a[199]=ae(" 立即同步 ",-1))]),_:1},8,["loading","disabled"]),Y(l,{onClick:Ml,disabled:!He.value.isEnabled||He.value.syncInProgress,type:"warning",size:"small"},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(I))]),_:1}),a[200]||(a[200]=ae(" 恢复数据 ",-1))]),_:1},8,["disabled"]),Y(l,{onClick:Ll,disabled:He.value.syncInProgress,size:"small"},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(f))]),_:1}),a[201]||(a[201]=ae(" 检查完整性 ",-1))]),_:1},8,["disabled"])])]),_:1}),He.value.errors.length>0?(G(),te(s,{key:1,label:"同步错误"},{default:ee(()=>[(G(!0),Q(ne,null,ie(He.value.errors,(e,a)=>(G(),te(Ae,{key:a,title:e,type:"error",closable:!1,class:"sync-error"},null,8,["title"]))),128))]),_:1})):se("",!0)],64)):se("",!0)]),_:1},8,["model","rules"])]),_:1})]),_:1}),Y(he,{label:"商品设置",name:"product"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",ls,[a[203]||(a[203]=Z("span",null,"商品配置",-1)),ll.value?(G(),te(l,{key:0,onClick:Nl,type:"primary",loading:re.value},{default:ee(()=>[...a[202]||(a[202]=[ae(" 保存设置 ",-1)])]),_:1},8,["loading"])):se("",!0)])]),default:ee(()=>[Y(j,{ref_key:"productFormRef",ref:Ha,model:Je.value,rules:Ma,"label-width":"150px",class:"setting-form"},{default:ee(()=>[Z("div",ts,[Z("h4",ss,[Y(q,null,{default:ee(()=>[Y(X(T))]),_:1}),a[204]||(a[204]=ae(" 优惠折扣设置 ",-1))]),Y(s,{label:"全局最大优惠比例",prop:"maxDiscountPercent"},{default:ee(()=>[Y(be,{modelValue:Je.value.maxDiscountPercent,"onUpdate:modelValue":a[72]||(a[72]=e=>Je.value.maxDiscountPercent=e),min:0,max:100,precision:1,placeholder:"最大优惠比例"},null,8,["modelValue"]),a[205]||(a[205]=Z("span",{class:"form-tip"},"%（0-100，建议不超过50%）",-1))]),_:1}),Y(s,{label:"管理员最大优惠",prop:"adminMaxDiscount"},{default:ee(()=>[Y(be,{modelValue:Je.value.adminMaxDiscount,"onUpdate:modelValue":a[73]||(a[73]=e=>Je.value.adminMaxDiscount=e),min:0,max:100,precision:1,placeholder:"管理员最大优惠"},null,8,["modelValue"]),a[206]||(a[206]=Z("span",{class:"form-tip"},"%（管理员权限下的最大优惠比例）",-1))]),_:1}),Y(s,{label:"经理最大优惠",prop:"managerMaxDiscount"},{default:ee(()=>[Y(be,{modelValue:Je.value.managerMaxDiscount,"onUpdate:modelValue":a[74]||(a[74]=e=>Je.value.managerMaxDiscount=e),min:0,max:100,precision:1,placeholder:"经理最大优惠"},null,8,["modelValue"]),a[207]||(a[207]=Z("span",{class:"form-tip"},"%（经理权限下的最大优惠比例）",-1))]),_:1}),Y(s,{label:"销售员最大优惠",prop:"salesMaxDiscount"},{default:ee(()=>[Y(be,{modelValue:Je.value.salesMaxDiscount,"onUpdate:modelValue":a[75]||(a[75]=e=>Je.value.salesMaxDiscount=e),min:0,max:100,precision:1,placeholder:"销售员最大优惠"},null,8,["modelValue"]),a[208]||(a[208]=Z("span",{class:"form-tip"},"%（销售员权限下的最大优惠比例）",-1))]),_:1}),Y(s,{label:"优惠审批阈值",prop:"discountApprovalThreshold"},{default:ee(()=>[Y(be,{modelValue:Je.value.discountApprovalThreshold,"onUpdate:modelValue":a[76]||(a[76]=e=>Je.value.discountApprovalThreshold=e),min:0,max:100,precision:1,placeholder:"优惠审批阈值"},null,8,["modelValue"]),a[209]||(a[209]=Z("span",{class:"form-tip"},"%（超过此比例需要审批）",-1))]),_:1})]),Z("div",os,[Z("h4",ns,[Y(q,null,{default:ee(()=>[Y(X(O))]),_:1}),a[210]||(a[210]=ae(" 价格管理设置 ",-1))]),Y(s,{label:"允许价格修改",prop:"allowPriceModification"},{default:ee(()=>[Y(xe,{modelValue:Je.value.allowPriceModification,"onUpdate:modelValue":a[77]||(a[77]=e=>Je.value.allowPriceModification=e),"active-text":"允许","inactive-text":"禁止"},null,8,["modelValue"]),a[211]||(a[211]=Z("div",{class:"form-tip"},"是否允许在订单中修改商品价格",-1))]),_:1}),Y(s,{label:"价格修改权限",prop:"priceModificationRoles"},{default:ee(()=>[Y(we,{modelValue:Je.value.priceModificationRoles,"onUpdate:modelValue":a[78]||(a[78]=e=>Je.value.priceModificationRoles=e)},{default:ee(()=>[Y(_e,{label:"admin"},{default:ee(()=>[...a[212]||(a[212]=[ae("管理员",-1)])]),_:1}),Y(_e,{label:"manager"},{default:ee(()=>[...a[213]||(a[213]=[ae("经理",-1)])]),_:1}),Y(_e,{label:"sales"},{default:ee(()=>[...a[214]||(a[214]=[ae("销售员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),Y(s,{label:"价格变动记录",prop:"enablePriceHistory"},{default:ee(()=>[Y(xe,{modelValue:Je.value.enablePriceHistory,"onUpdate:modelValue":a[79]||(a[79]=e=>Je.value.enablePriceHistory=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),a[215]||(a[215]=Z("div",{class:"form-tip"},"记录商品价格变动历史",-1))]),_:1}),Y(s,{label:"价格显示精度",prop:"pricePrecision"},{default:ee(()=>[Y(Ve,{modelValue:Je.value.pricePrecision,"onUpdate:modelValue":a[80]||(a[80]=e=>Je.value.pricePrecision=e),placeholder:"选择价格精度"},{default:ee(()=>[Y(Ce,{label:"整数（如：100）",value:"0"}),Y(Ce,{label:"一位小数（如：100.0）",value:"1"}),Y(Ce,{label:"两位小数（如：100.00）",value:"2"})]),_:1},8,["modelValue"])]),_:1})]),Z("div",is,[Z("h4",rs,[Y(q,null,{default:ee(()=>[Y(X(P))]),_:1}),a[216]||(a[216]=ae(" 库存管理设置 ",-1))]),Y(s,{label:"启用库存管理",prop:"enableInventory"},{default:ee(()=>[Y(xe,{modelValue:Je.value.enableInventory,"onUpdate:modelValue":a[81]||(a[81]=e=>Je.value.enableInventory=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),a[217]||(a[217]=Z("div",{class:"form-tip"},"是否启用商品库存管理功能",-1))]),_:1}),Y(s,{label:"低库存预警阈值",prop:"lowStockThreshold"},{default:ee(()=>[Y(be,{modelValue:Je.value.lowStockThreshold,"onUpdate:modelValue":a[82]||(a[82]=e=>Je.value.lowStockThreshold=e),min:0,max:1e3,placeholder:"低库存预警阈值"},null,8,["modelValue"]),a[218]||(a[218]=Z("span",{class:"form-tip"},"件（库存低于此数量时预警）",-1))]),_:1}),Y(s,{label:"允许负库存销售",prop:"allowNegativeStock"},{default:ee(()=>[Y(xe,{modelValue:Je.value.allowNegativeStock,"onUpdate:modelValue":a[83]||(a[83]=e=>Je.value.allowNegativeStock=e),"active-text":"允许","inactive-text":"禁止"},null,8,["modelValue"]),a[219]||(a[219]=Z("div",{class:"form-tip"},"库存不足时是否允许继续销售",-1))]),_:1})]),Z("div",cs,[Z("h4",us,[Y(q,null,{default:ee(()=>[Y(X(D))]),_:1}),a[220]||(a[220]=ae(" 商品分类设置 ",-1))]),Y(s,{label:"默认分类",prop:"defaultCategory"},{default:ee(()=>[Y(t,{modelValue:Je.value.defaultCategory,"onUpdate:modelValue":a[84]||(a[84]=e=>Je.value.defaultCategory=e),placeholder:"请输入默认分类名称"},null,8,["modelValue"]),a[221]||(a[221]=Z("div",{class:"form-tip"},"新建商品时的默认分类",-1))]),_:1}),Y(s,{label:"分类层级限制",prop:"maxCategoryLevel"},{default:ee(()=>[Y(be,{modelValue:Je.value.maxCategoryLevel,"onUpdate:modelValue":a[85]||(a[85]=e=>Je.value.maxCategoryLevel=e),min:1,max:5,placeholder:"分类层级限制"},null,8,["modelValue"]),a[222]||(a[222]=Z("span",{class:"form-tip"},"级（最多支持的分类层级数）",-1))]),_:1}),Y(s,{label:"启用分类编码",prop:"enableCategoryCode"},{default:ee(()=>[Y(xe,{modelValue:Je.value.enableCategoryCode,"onUpdate:modelValue":a[86]||(a[86]=e=>Je.value.enableCategoryCode=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),a[223]||(a[223]=Z("div",{class:"form-tip"},"为商品分类生成唯一编码",-1))]),_:1})]),Z("div",ds,[Z("h4",ps,[Y(q,null,{default:ee(()=>[Y(X(z))]),_:1}),a[224]||(a[224]=ae(" 权限配置设置 ",-1))]),Y(s,{label:"成本价格查看权限",prop:"costPriceViewRoles"},{default:ee(()=>[Y(we,{modelValue:Je.value.costPriceViewRoles,"onUpdate:modelValue":a[87]||(a[87]=e=>Je.value.costPriceViewRoles=e)},{default:ee(()=>[Y(_e,{label:"super_admin"},{default:ee(()=>[...a[225]||(a[225]=[ae("超级管理员",-1)])]),_:1}),Y(_e,{label:"admin"},{default:ee(()=>[...a[226]||(a[226]=[ae("管理员",-1)])]),_:1}),Y(_e,{label:"manager"},{default:ee(()=>[...a[227]||(a[227]=[ae("经理",-1)])]),_:1}),Y(_e,{label:"finance"},{default:ee(()=>[...a[228]||(a[228]=[ae("财务人员",-1)])]),_:1})]),_:1},8,["modelValue"]),a[229]||(a[229]=Z("div",{class:"form-tip"},"选择可以查看商品成本价格的角色",-1))]),_:1}),Y(s,{label:"销售数据查看权限",prop:"salesDataViewRoles"},{default:ee(()=>[Y(we,{modelValue:Je.value.salesDataViewRoles,"onUpdate:modelValue":a[88]||(a[88]=e=>Je.value.salesDataViewRoles=e)},{default:ee(()=>[Y(_e,{label:"super_admin"},{default:ee(()=>[...a[230]||(a[230]=[ae("超级管理员",-1)])]),_:1}),Y(_e,{label:"admin"},{default:ee(()=>[...a[231]||(a[231]=[ae("管理员",-1)])]),_:1}),Y(_e,{label:"manager"},{default:ee(()=>[...a[232]||(a[232]=[ae("经理",-1)])]),_:1}),Y(_e,{label:"sales_manager"},{default:ee(()=>[...a[233]||(a[233]=[ae("销售经理",-1)])]),_:1})]),_:1},8,["modelValue"]),a[234]||(a[234]=Z("div",{class:"form-tip"},"选择可以查看销售数据的角色",-1))]),_:1}),Y(s,{label:"库存信息查看权限",prop:"stockInfoViewRoles"},{default:ee(()=>[Y(we,{modelValue:Je.value.stockInfoViewRoles,"onUpdate:modelValue":a[89]||(a[89]=e=>Je.value.stockInfoViewRoles=e)},{default:ee(()=>[Y(_e,{label:"super_admin"},{default:ee(()=>[...a[235]||(a[235]=[ae("超级管理员",-1)])]),_:1}),Y(_e,{label:"admin"},{default:ee(()=>[...a[236]||(a[236]=[ae("管理员",-1)])]),_:1}),Y(_e,{label:"manager"},{default:ee(()=>[...a[237]||(a[237]=[ae("经理",-1)])]),_:1}),Y(_e,{label:"warehouse"},{default:ee(()=>[...a[238]||(a[238]=[ae("仓库管理员",-1)])]),_:1})]),_:1},8,["modelValue"]),a[239]||(a[239]=Z("div",{class:"form-tip"},"选择可以查看库存信息的角色",-1))]),_:1}),Y(s,{label:"操作日志查看权限",prop:"operationLogsViewRoles"},{default:ee(()=>[Y(we,{modelValue:Je.value.operationLogsViewRoles,"onUpdate:modelValue":a[90]||(a[90]=e=>Je.value.operationLogsViewRoles=e)},{default:ee(()=>[Y(_e,{label:"super_admin"},{default:ee(()=>[...a[240]||(a[240]=[ae("超级管理员",-1)])]),_:1}),Y(_e,{label:"admin"},{default:ee(()=>[...a[241]||(a[241]=[ae("管理员",-1)])]),_:1}),Y(_e,{label:"audit"},{default:ee(()=>[...a[242]||(a[242]=[ae("审计人员",-1)])]),_:1})]),_:1},8,["modelValue"]),a[243]||(a[243]=Z("div",{class:"form-tip"},"选择可以查看操作日志的角色",-1))]),_:1}),Y(s,{label:"敏感信息隐藏方式",prop:"sensitiveInfoHideMethod"},{default:ee(()=>[Y(ke,{modelValue:Je.value.sensitiveInfoHideMethod,"onUpdate:modelValue":a[91]||(a[91]=e=>Je.value.sensitiveInfoHideMethod=e)},{default:ee(()=>[Y(Se,{label:"asterisk"},{default:ee(()=>[...a[244]||(a[244]=[ae("星号（****）",-1)])]),_:1}),Y(Se,{label:"eye_icon"},{default:ee(()=>[...a[245]||(a[245]=[ae("眼睛图标",-1)])]),_:1}),Y(Se,{label:"dash"},{default:ee(()=>[...a[246]||(a[246]=[ae("横线（----）",-1)])]),_:1})]),_:1},8,["modelValue"]),a[247]||(a[247]=Z("div",{class:"form-tip"},"选择敏感信息的隐藏显示方式",-1))]),_:1}),Y(s,{label:"启用权限控制",prop:"enablePermissionControl"},{default:ee(()=>[Y(xe,{modelValue:Je.value.enablePermissionControl,"onUpdate:modelValue":a[92]||(a[92]=e=>Je.value.enablePermissionControl=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),a[248]||(a[248]=Z("div",{class:"form-tip"},"是否启用商品信息权限控制功能",-1))]),_:1})]),ll.value?(G(),Q("div",ms,[Y(l,{onClick:El,disabled:re.value},{default:ee(()=>[...a[249]||(a[249]=[ae(" 重置默认 ",-1)])]),_:1},8,["disabled"]),Y(l,{type:"primary",onClick:Nl,loading:re.value},{default:ee(()=>[...a[250]||(a[250]=[ae(" 保存设置 ",-1)])]),_:1},8,["loading"])])):se("",!0)]),_:1},8,["model"])]),_:1})]),_:1}),tl.value?(G(),te(he,{key:0,label:"系统监控",name:"monitor"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",gs,[a[252]||(a[252]=Z("span",null,"系统状态",-1)),Y(l,{onClick:$l,loading:ce.value},{default:ee(()=>[...a[251]||(a[251]=[ae(" 刷新状态 ",-1)])]),_:1},8,["loading"])])]),default:ee(()=>[Z("div",fs,[Z("div",vs,[a[253]||(a[253]=Z("h4",null,"系统信息",-1)),Y(Ue,{column:2,border:""},{default:ee(()=>[Y(Pe,{label:"操作系统"},{default:ee(()=>[ae(le(Qe.value.systemInfo.os),1)]),_:1}),Y(Pe,{label:"系统架构"},{default:ee(()=>[ae(le(Qe.value.systemInfo.arch),1)]),_:1}),Y(Pe,{label:"CPU核心数"},{default:ee(()=>[ae(le(Qe.value.systemInfo.cpuCores),1)]),_:1}),Y(Pe,{label:"总内存"},{default:ee(()=>[ae(le(Qe.value.systemInfo.totalMemory),1)]),_:1}),Y(Pe,{label:"Node.js版本"},{default:ee(()=>[ae(le(Qe.value.systemInfo.nodeVersion),1)]),_:1}),Y(Pe,{label:"系统运行时间"},{default:ee(()=>[ae(le(Qe.value.systemInfo.uptime),1)]),_:1})]),_:1})]),Z("div",ys,[a[254]||(a[254]=Z("h4",null,"性能监控",-1)),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:6},{default:ee(()=>{return[Y($e,{title:"CPU使用率",value:Qe.value.performance.cpuUsage,suffix:"%","value-style":{color:(e=Qe.value.performance.cpuUsage,e<50?"#67c23a":e<80?"#e6a23c":"#f56c6c")}},null,8,["value","value-style"])];var e}),_:1}),Y(o,{span:6},{default:ee(()=>{return[Y($e,{title:"内存使用率",value:Qe.value.performance.memoryUsage,suffix:"%","value-style":{color:(e=Qe.value.performance.memoryUsage,e<60?"#67c23a":e<85?"#e6a23c":"#f56c6c")}},null,8,["value","value-style"])];var e}),_:1}),Y(o,{span:6},{default:ee(()=>{return[Y($e,{title:"磁盘使用率",value:Qe.value.performance.diskUsage,suffix:"%","value-style":{color:(e=Qe.value.performance.diskUsage,e<70?"#67c23a":e<90?"#e6a23c":"#f56c6c")}},null,8,["value","value-style"])];var e}),_:1}),Y(o,{span:6},{default:ee(()=>[Y($e,{title:"网络延迟",value:Qe.value.performance.networkLatency,suffix:"ms"},null,8,["value"])]),_:1})]),_:1})]),Z("div",hs,[a[255]||(a[255]=Z("h4",null,"数据库状态",-1)),Y(Ue,{column:2,border:""},{default:ee(()=>[Y(Pe,{label:"数据库类型"},{default:ee(()=>[ae(le(Qe.value.database.type),1)]),_:1}),Y(Pe,{label:"数据库版本"},{default:ee(()=>[ae(le(Qe.value.database.version),1)]),_:1}),Y(Pe,{label:"连接状态"},{default:ee(()=>[Y(Ie,{type:Qe.value.database.connected?"success":"danger"},{default:ee(()=>[ae(le(Qe.value.database.connected?"已连接":"未连接"),1)]),_:1},8,["type"])]),_:1}),Y(Pe,{label:"活跃连接数"},{default:ee(()=>[ae(le(Qe.value.database.activeConnections),1)]),_:1}),Y(Pe,{label:"数据库大小"},{default:ee(()=>[ae(le(Qe.value.database.size),1)]),_:1}),Y(Pe,{label:"最后备份时间"},{default:ee(()=>[ae(le(Qe.value.database.lastBackup),1)]),_:1})]),_:1})]),Z("div",bs,[a[256]||(a[256]=Z("h4",null,"服务状态",-1)),Y(Ke,{data:Qe.value.services,style:{width:"100%"}},{default:ee(()=>[Y(Fe,{prop:"name",label:"服务名称",width:"200"}),Y(Fe,{label:"状态",width:"100"},{default:ee(({row:e})=>[Y(Ie,{type:"running"===e.status?"success":"danger"},{default:ee(()=>[ae(le("running"===e.status?"运行中":"已停止"),1)]),_:2},1032,["type"])]),_:1}),Y(Fe,{prop:"port",label:"端口",width:"100"}),Y(Fe,{prop:"uptime",label:"运行时间"}),Y(Fe,{prop:"memory",label:"内存使用",width:"120"})]),_:1},8,["data"])])])]),_:1})]),_:1})):se("",!0),Y(he,{label:"订单设置",name:"order"},{default:ee(()=>[Y(yt)]),_:1}),Y(he,{label:"数据备份",name:"backup"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",_s,[a[260]||(a[260]=Z("span",null,"数据备份与恢复",-1)),Z("div",ws,[Y(l,{onClick:Kl,type:"primary",loading:Ze.value,disabled:!Oa.value},{default:ee(()=>[...a[257]||(a[257]=[ae(" 立即备份 ",-1)])]),_:1},8,["loading","disabled"]),Da.value?(G(),te(l,{key:0,onClick:jl,type:"success",loading:Ye.value},{default:ee(()=>[...a[258]||(a[258]=[ae(" 保存设置 ",-1)])]),_:1},8,["loading"])):se("",!0),Y(l,{onClick:Jl,type:"info",plain:"",loading:aa.value},{default:ee(()=>[...a[259]||(a[259]=[ae(" 测试功能 ",-1)])]),_:1},8,["loading"])])])]),default:ee(()=>[Y(j,{ref_key:"backupFormRef",ref:Qa,model:la,rules:La,"label-width":"120px",class:"setting-form"},{default:ee(()=>[Z("div",xs,[a[261]||(a[261]=Z("h4",null,"备份配置",-1)),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:12},{default:ee(()=>[Y(s,{label:"自动备份",prop:"autoBackupEnabled"},{default:ee(()=>[Y(xe,{modelValue:la.autoBackupEnabled,"onUpdate:modelValue":a[93]||(a[93]=e=>la.autoBackupEnabled=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1}),Y(o,{span:12},{default:ee(()=>[la.autoBackupEnabled?(G(),te(s,{key:0,label:"备份频率",prop:"backupFrequency"},{default:ee(()=>[Y(Ve,{modelValue:la.backupFrequency,"onUpdate:modelValue":a[94]||(a[94]=e=>la.backupFrequency=e),placeholder:"请选择备份频率"},{default:ee(()=>[Y(Ce,{label:"每小时",value:"hourly"}),Y(Ce,{label:"每天",value:"daily"}),Y(Ce,{label:"每周",value:"weekly"}),Y(Ce,{label:"每月",value:"monthly"})]),_:1},8,["modelValue"])]),_:1})):se("",!0)]),_:1})]),_:1}),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:12},{default:ee(()=>[Y(s,{label:"保留天数",prop:"retentionDays"},{default:ee(()=>[Y(be,{modelValue:la.retentionDays,"onUpdate:modelValue":a[95]||(a[95]=e=>la.retentionDays=e),min:1,max:365,placeholder:"备份文件保留天数"},null,8,["modelValue"])]),_:1})]),_:1}),Y(o,{span:12},{default:ee(()=>[Y(s,{label:"压缩备份",prop:"compression"},{default:ee(()=>[Y(xe,{modelValue:la.compression,"onUpdate:modelValue":a[96]||(a[96]=e=>la.compression=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),Z("div",Ss,[a[262]||(a[262]=Z("h4",null,"备份状态",-1)),Y(Ue,{column:2,border:""},{default:ee(()=>[Y(Pe,{label:"最后备份时间"},{default:ee(()=>[ae(le(ta.value||"暂无备份"),1)]),_:1}),Y(Pe,{label:"备份文件数量"},{default:ee(()=>[ae(le(sa.value)+" 个 ",1)]),_:1}),Y(Pe,{label:"总备份大小"},{default:ee(()=>[ae(le(Gl(oa.value)),1)]),_:1}),Y(Pe,{label:"自动备份状态"},{default:ee(()=>[Y(Ie,{type:la.autoBackupEnabled?"success":"info"},{default:ee(()=>[ae(le(la.autoBackupEnabled?"已启用":"已禁用"),1)]),_:1},8,["type"])]),_:1})]),_:1})]),Z("div",ks,[a[266]||(a[266]=Z("h4",null,"备份历史",-1)),oe((G(),te(Ke,{data:na.value,style:{width:"100%"}},{default:ee(()=>[Y(Fe,{prop:"filename",label:"备份文件"}),Y(Fe,{prop:"timestamp",label:"备份时间",width:"180"},{default:ee(({row:e})=>[ae(le(ht(e.timestamp)),1)]),_:1}),Y(Fe,{prop:"size",label:"文件大小",width:"120"},{default:ee(({row:e})=>[ae(le(Gl(e.size)),1)]),_:1}),Y(Fe,{prop:"type",label:"备份类型",width:"100"},{default:ee(({row:e})=>[Y(Ie,{type:"manual"===e.type?"primary":"success"},{default:ee(()=>[ae(le("manual"===e.type?"手动":"自动"),1)]),_:2},1032,["type"])]),_:1}),Y(Fe,{label:"操作",width:"200"},{default:ee(({row:e})=>[Y(l,{onClick:a=>(async e=>{try{await r.confirm(`确定要恢复备份 "${e.filename}" 吗？这将覆盖当前所有数据！`,"确认恢复",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),ea.value=e.filename,await Be.restoreFromBackup(e.filename),i.success("数据恢复成功，请刷新页面"),setTimeout(()=>{window.location.reload()},2e3)}catch(a){"cancel"!==a&&(console.error("恢复失败:",a),i.error("恢复失败: "+a.message))}finally{ea.value=""}})(e),type:"warning",size:"small",loading:ea.value===e.filename},{default:ee(()=>[...a[263]||(a[263]=[ae(" 恢复 ",-1)])]),_:1},8,["onClick","loading"]),Y(l,{onClick:a=>(async e=>{try{const a=await Be.getBackupDownloadUrl(e.filename),l=document.createElement("a");l.href=a,l.download=e.filename,document.body.appendChild(l),l.click(),document.body.removeChild(l),i.success("备份下载开始")}catch(a){console.error("下载失败:",a),i.error("下载失败: "+a.message)}})(e),type:"info",size:"small"},{default:ee(()=>[...a[264]||(a[264]=[ae(" 下载 ",-1)])]),_:1},8,["onClick"]),Y(l,{onClick:a=>(async e=>{try{await r.confirm(`确定要删除备份 "${e.filename}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Be.deleteBackup(e.filename),i.success("备份删除成功"),await Hl(),await Ql()}catch(a){"cancel"!==a&&(console.error("删除失败:",a),i.error("删除失败: "+a.message))}})(e),type:"danger",size:"small"},{default:ee(()=>[...a[265]||(a[265]=[ae(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[dt,Xe.value]])]),Oa.value?se("",!0):(G(),te(Ae,{key:0,title:"请先配置OSS存储",description:"数据备份功能需要先在存储设置中配置阿里云OSS，才能正常使用备份和恢复功能。",type:"warning",closable:!1,"show-icon":""}))]),_:1},8,["model"])]),_:1})]),_:1}),Y(he,{label:"数据迁移",name:"migration"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",Cs,[a[269]||(a[269]=Z("span",null,"数据迁移工具",-1)),Z("div",Vs,[Y(l,{onClick:Zl,type:"primary",loading:ia.value},{default:ee(()=>[...a[267]||(a[267]=[ae(" 导出数据 ",-1)])]),_:1},8,["loading"]),Y(l,{onClick:Yl,type:"success",plain:"",loading:ra.value},{default:ee(()=>[...a[268]||(a[268]=[ae(" 验证数据 ",-1)])]),_:1},8,["loading"])])])]),default:ee(()=>[Z("div",zs,[Y(Ae,{title:"数据迁移说明",type:"info",closable:!1,"show-icon":"",class:"migration-alert"},{default:ee(()=>[...a[270]||(a[270]=[Z("p",null,"当前系统使用浏览器本地存储(localStorage)保存数据，存在以下问题：",-1),Z("ul",null,[Z("li",null,"换电脑或浏览器数据会丢失"),Z("li",null,"清除浏览器缓存数据会消失"),Z("li",null,"无法实现多设备数据同步"),Z("li",null,"不同用户之间无法数据隔离")],-1),Z("p",null,[Z("strong",null,"建议："),ae("导出现有数据，然后部署数据库实现真正的数据持久化。")],-1)])]),_:1}),ca.value?(G(),Q("div",As,[a[271]||(a[271]=Z("h4",null,"当前数据统计",-1)),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:4},{default:ee(()=>[Y($e,{title:"客户数据",value:ca.value.customers,suffix:"条"},null,8,["value"])]),_:1}),Y(o,{span:4},{default:ee(()=>[Y($e,{title:"订单数据",value:ca.value.orders,suffix:"条"},null,8,["value"])]),_:1}),Y(o,{span:4},{default:ee(()=>[Y($e,{title:"产品数据",value:ca.value.products,suffix:"条"},null,8,["value"])]),_:1}),Y(o,{span:4},{default:ee(()=>[Y($e,{title:"部门数据",value:ca.value.departments,suffix:"条"},null,8,["value"])]),_:1}),Y(o,{span:4},{default:ee(()=>[Y($e,{title:"用户数据",value:ca.value.users,suffix:"条"},null,8,["value"])]),_:1}),Y(o,{span:4},{default:ee(()=>[Y($e,{title:"数据大小",value:Xl(ca.value.totalSize)},null,8,["value"])]),_:1})]),_:1})])):se("",!0),ua.value?(G(),Q("div",Is,[a[273]||(a[273]=Z("h4",null,"数据验证结果",-1)),0===ua.value.issues.length?(G(),te(Ae,{key:0,title:"数据验证通过",description:"所有数据完整性检查通过，可以安全迁移！",type:"success",closable:!1,"show-icon":""})):(G(),te(Ae,{key:1,title:`发现 ${ua.value.issues.length} 个数据问题`,type:"warning",closable:!1,"show-icon":""},{default:ee(()=>[a[272]||(a[272]=Z("p",null,"建议修复以下问题后再进行迁移：",-1)),Z("ul",null,[(G(!0),Q(ne,null,ie(ua.value.issues.slice(0,10),e=>(G(),Q("li",{key:e},le(e),1))),128)),ua.value.issues.length>10?(G(),Q("li",Ts," ... 还有 "+le(ua.value.issues.length-10)+" 个问题 ",1)):se("",!0)])]),_:1},8,["title"]))])):se("",!0),Z("div",Os,[a[274]||(a[274]=Z("h4",null,"数据迁移步骤",-1)),Y(ha,{active:da.value,direction:"vertical"},{default:ee(()=>[Y(Ge,{title:"导出现有数据",description:"将localStorage中的数据导出为JSON文件"}),Y(Ge,{title:"部署数据库",description:"在阿里云服务器使用宝塔面板创建MySQL数据库"}),Y(Ge,{title:"部署后端API",description:"部署Node.js后端服务，提供数据API接口"}),Y(Ge,{title:"导入数据",description:"将导出的数据导入到数据库中"}),Y(Ge,{title:"切换存储模式",description:"前端切换到API模式，实现真正的数据持久化"})]),_:1},8,["active"])]),Z("div",Ps,[a[278]||(a[278]=Z("h4",null,"技术文档",-1)),Y(dl,{wrap:""},{default:ee(()=>[Y(l,{onClick:a[97]||(a[97]=e=>et("database")),type:"primary",plain:"",icon:"Document"},{default:ee(()=>[...a[275]||(a[275]=[ae(" 数据库架构设计 ",-1)])]),_:1}),Y(l,{onClick:a[98]||(a[98]=e=>et("api")),type:"success",plain:"",icon:"Document"},{default:ee(()=>[...a[276]||(a[276]=[ae(" 后端API架构 ",-1)])]),_:1}),Y(l,{onClick:a[99]||(a[99]=e=>et("migration")),type:"warning",plain:"",icon:"Document"},{default:ee(()=>[...a[277]||(a[277]=[ae(" 数据迁移方案 ",-1)])]),_:1})]),_:1})])])]),_:1})]),_:1}),Y(he,{label:"通知设置",name:"notification"},{default:ee(()=>[Y(nt)]),_:1}),Y(he,{label:"用户协议",name:"agreement"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",Ds,[a[281]||(a[281]=Z("span",null,"用户协议管理",-1)),Z("div",Us,[Ne.value?(G(),te(l,{key:0,onClick:yl,type:"success",icon:X(c)},{default:ee(()=>[...a[279]||(a[279]=[ae(" 新增协议 ",-1)])]),_:1},8,["icon"])):se("",!0),Ne.value?(G(),te(l,{key:1,onClick:hl,type:"primary",loading:De.value},{default:ee(()=>[...a[280]||(a[280]=[ae(" 保存配置 ",-1)])]),_:1},8,["loading"])):se("",!0)])])]),default:ee(()=>[Y(Ae,{title:"协议说明",type:"info",closable:!1,style:{"margin-bottom":"20px"}},{default:ee(()=>[...a[282]||(a[282]=[Z("p",null,"用户协议将在登录页面显示，用户必须同意协议才能登录系统。",-1),Z("p",null,'点击"编辑"按钮可以使用富文本编辑器编辑协议内容，启用后的协议将在登录页面显示。',-1)])]),_:1}),Y(Ke,{data:Oe.value,border:"",stripe:"",style:{width:"100%"},class:"agreement-table"},{default:ee(()=>[Y(Fe,{type:"index",label:"序号",width:"60",align:"center"}),Y(Fe,{prop:"title",label:"标题",width:"180"},{default:ee(({row:e})=>[Z("div",Ns,["user"===e.type?(G(),te(q,{key:0,color:"#409EFF"},{default:ee(()=>[Y(X(U))]),_:1})):(G(),te(q,{key:1,color:"#67C23A"},{default:ee(()=>[Y(X(z))]),_:1})),Z("span",null,le(e.title),1)])]),_:1}),Y(Fe,{prop:"type",label:"类型",width:"120",align:"center"},{default:ee(({row:e})=>[Y(Ie,{type:"user"===e.type?"primary":"success",size:"small"},{default:ee(()=>[ae(le("user"===e.type?"使用协议":"隐私协议"),1)]),_:2},1032,["type"])]),_:1}),Y(Fe,{prop:"wordCount",label:"字数",width:"100",align:"center"},{default:ee(({row:e})=>[Z("span",Es,le(e.wordCount)+" 字",1)]),_:1}),Y(Fe,{prop:"summary",label:"内容概述","min-width":"200"},{default:ee(({row:e})=>[Z("div",$s,le(e.summary),1)]),_:1}),Y(Fe,{prop:"updateTime",label:"更新日期",width:"160",align:"center"},{default:ee(({row:e})=>[Z("div",Bs,[Y(q,null,{default:ee(()=>[Y(X(d))]),_:1}),Z("span",null,le(e.updateTime),1)])]),_:1}),Y(Fe,{label:"状态",width:"80",align:"center"},{default:ee(({row:e})=>[Y(gl,{content:e.enabled?"已启用":"已禁用",placement:"top"},{default:ee(()=>[Y(xe,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a,onChange:a=>{return l=e,void i.success(`${l.title}已${l.enabled?"启用":"禁用"}`);var l}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["content"])]),_:1}),Y(Fe,{label:"操作",width:"200",align:"center",fixed:"right"},{default:ee(({row:e})=>[Y(l,{type:"primary",size:"small",icon:X(N),onClick:a=>{return l=e,Re.value={...l},void(Ee.value=!0);var l}},{default:ee(()=>[...a[283]||(a[283]=[ae(" 编辑 ",-1)])]),_:1},8,["icon","onClick"]),Y(l,{type:"info",size:"small",icon:X(y),onClick:a=>{return l=e,void r.alert(`<div style="max-height: 500px; overflow-y: auto; padding: 10px; text-align: left; font-size: 14px; line-height: 1.8;">${l.content}</div>`,l.title,{confirmButtonText:"关闭",dangerouslyUseHTMLString:!0,customStyle:{width:"65%",maxWidth:"800px"}});var l}},{default:ee(()=>[...a[284]||(a[284]=[ae(" 预览 ",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),Y(he,{label:"移动应用",name:"mobile"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",Rs,[a[286]||(a[286]=Z("span",null,"移动应用管理",-1)),Z("div",Ms,[Y(l,{onClick:st,loading:ma.value,type:"primary",size:"small"},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(h))]),_:1}),a[285]||(a[285]=ae(" 刷新信息 ",-1))]),_:1},8,["loading"])])])]),default:ee(()=>[Z("div",Ls,[Z("div",qs,[Z("h4",Fs,[Y(q,null,{default:ee(()=>[Y(X(k))]),_:1}),a[287]||(a[287]=ae(" SDK 状态概览 ",-1))]),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:8},{default:ee(()=>[Y(me,{class:"status-card"},{default:ee(()=>[Y($e,{title:"Android SDK",value:fa.value.android.version},null,8,["value"]),Z("div",Ks,[Y(Ie,{type:fa.value.android.available?"success":"danger",size:"small"},{default:ee(()=>[ae(le(fa.value.android.available?"可用":"未构建"),1)]),_:1},8,["type"]),Z("span",js,le(fa.value.android.size),1)])]),_:1})]),_:1}),Y(o,{span:8},{default:ee(()=>[Y(me,{class:"status-card"},{default:ee(()=>[Y($e,{title:"iOS SDK",value:fa.value.ios.version},null,8,["value"]),Z("div",Js,[Y(Ie,{type:fa.value.ios.available?"success":"warning",size:"small"},{default:ee(()=>[ae(le(fa.value.ios.available?"可用":"开发中"),1)]),_:1},8,["type"]),Z("span",Ws,le(fa.value.ios.size),1)])]),_:1})]),_:1}),Y(o,{span:8},{default:ee(()=>[Y(me,{class:"status-card"},{default:ee(()=>[Y($e,{title:"PWA应用",value:"v1.0.0"}),Z("div",Hs,[Y(Ie,{type:"success",size:"small"},{default:ee(()=>[...a[288]||(a[288]=[ae("已部署",-1)])]),_:1}),a[289]||(a[289]=Z("span",{class:"file-size"},"轻量级",-1))])]),_:1})]),_:1})]),_:1})]),Z("div",Qs,[Z("h4",Gs,[Y(q,null,{default:ee(()=>[Y(X(I))]),_:1}),a[290]||(a[290]=ae(" SDK 下载和管理 ",-1))]),Z("div",Zs,[Z("div",Ys,[Z("div",Xs,[Z("div",eo,[Y(q,{size:"32"},{default:ee(()=>[Y(X(E))]),_:1})]),a[291]||(a[291]=Z("div",{class:"sdk-info"},[Z("h5",null,"Android SDK"),Z("p",null,"原生Android应用，支持完整CRM功能")],-1))]),Z("div",ao,[Z("div",lo,[a[292]||(a[292]=Z("span",{class:"label"},"版本:",-1)),Z("span",to,le(fa.value.android.version),1)]),Z("div",so,[a[293]||(a[293]=Z("span",{class:"label"},"大小:",-1)),Z("span",oo,le(fa.value.android.size),1)]),Z("div",no,[a[294]||(a[294]=Z("span",{class:"label"},"更新时间:",-1)),Z("span",io,le(fa.value.android.updateTime),1)])]),Z("div",ro,[Y(l,{onClick:ot,type:"primary",disabled:!fa.value.android.available,size:"small"},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(I))]),_:1}),a[295]||(a[295]=ae(" 下载APK ",-1))]),_:1},8,["disabled"]),Y(l,{onClick:a[100]||(a[100]=e=>rt("android")),type:"info",plain:"",size:"small"},{default:ee(()=>[...a[296]||(a[296]=[ae(" 安装说明 ",-1)])]),_:1})])]),Z("div",co,[Z("div",uo,[Z("div",po,[Y(q,{size:"32"},{default:ee(()=>[Y(X($))]),_:1})]),a[297]||(a[297]=Z("div",{class:"sdk-info"},[Z("h5",null,"iOS SDK"),Z("p",null,"适用于iPhone和iPad的CRM应用")],-1))]),Z("div",mo,[Z("div",go,[a[298]||(a[298]=Z("span",{class:"label"},"版本:",-1)),Z("span",fo,le(fa.value.ios.version),1)]),Z("div",vo,[a[299]||(a[299]=Z("span",{class:"label"},"大小:",-1)),Z("span",yo,le(fa.value.ios.size),1)]),Z("div",ho,[a[300]||(a[300]=Z("span",{class:"label"},"状态:",-1)),Z("span",bo,[Y(Ie,{type:fa.value.ios.available?"success":"warning",size:"small"},{default:ee(()=>[ae(le(fa.value.ios.available?"可用":"开发中"),1)]),_:1},8,["type"])])])]),Z("div",_o,[Y(l,{onClick:it,type:"primary",disabled:!fa.value.ios.available,size:"small"},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(I))]),_:1}),a[301]||(a[301]=ae(" 下载IPA ",-1))]),_:1},8,["disabled"]),Y(l,{onClick:a[101]||(a[101]=e=>rt("ios")),type:"info",plain:"",size:"small"},{default:ee(()=>[...a[302]||(a[302]=[ae(" 安装说明 ",-1)])]),_:1})])]),Z("div",wo,[Z("div",xo,[Z("div",So,[Y(q,{size:"32"},{default:ee(()=>[Y(X(B))]),_:1})]),a[303]||(a[303]=Z("div",{class:"sdk-info"},[Z("h5",null,"PWA 应用"),Z("p",null,"渐进式Web应用，无需安装")],-1))]),a[306]||(a[306]=Z("div",{class:"sdk-details"},[Z("div",{class:"detail-item"},[Z("span",{class:"label"},"版本:"),Z("span",{class:"value"},"v1.0.0")]),Z("div",{class:"detail-item"},[Z("span",{class:"label"},"类型:"),Z("span",{class:"value"},"Web应用")]),Z("div",{class:"detail-item"},[Z("span",{class:"label"},"状态:"),Z("span",{class:"value"},"已部署")])],-1)),Z("div",ko,[Y(l,{onClick:ct,type:"success",size:"small"},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(R))]),_:1}),a[304]||(a[304]=ae(" 打开应用 ",-1))]),_:1}),Y(l,{onClick:ut,type:"info",plain:"",size:"small"},{default:ee(()=>[...a[305]||(a[305]=[ae(" 二维码 ",-1)])]),_:1})])])])]),Z("div",Co,[Z("h4",Vo,[Y(q,null,{default:ee(()=>[Y(X(A))]),_:1}),a[307]||(a[307]=ae(" 连接状态和配置 ",-1))]),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:12},{default:ee(()=>[Y(me,{class:"config-card"},{header:ee(()=>[...a[308]||(a[308]=[Z("span",null,"服务器配置",-1)])]),default:ee(()=>[Y(Ue,{column:1,border:"",size:"small"},{default:ee(()=>[Y(Pe,{label:"服务器地址"},{default:ee(()=>[ae(le(xa.value.host)+":"+le(xa.value.port),1)]),_:1}),Y(Pe,{label:"WebSocket端口"},{default:ee(()=>[ae(le(xa.value.wsPort),1)]),_:1}),Y(Pe,{label:"SSL状态"},{default:ee(()=>[Y(Ie,{type:xa.value.ssl?"success":"warning",size:"small"},{default:ee(()=>[ae(le(xa.value.ssl?"已启用":"未启用"),1)]),_:1},8,["type"])]),_:1}),Y(Pe,{label:"API版本"},{default:ee(()=>[ae(le(xa.value.apiVersion),1)]),_:1})]),_:1})]),_:1})]),_:1}),Y(o,{span:12},{default:ee(()=>[Y(me,{class:"config-card"},{header:ee(()=>[...a[309]||(a[309]=[Z("span",null,"连接统计",-1)])]),default:ee(()=>[Y(Ue,{column:1,border:"",size:"small"},{default:ee(()=>[Y(Pe,{label:"活跃连接"},{default:ee(()=>[Y(Ie,{type:"success",size:"small"},{default:ee(()=>[ae(le(Sa.value.active),1)]),_:1})]),_:1}),Y(Pe,{label:"今日连接"},{default:ee(()=>[ae(le(Sa.value.today),1)]),_:1}),Y(Pe,{label:"总连接数"},{default:ee(()=>[ae(le(Sa.value.total),1)]),_:1}),Y(Pe,{label:"最后连接"},{default:ee(()=>[ae(le(Sa.value.lastConnection||"暂无"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),Z("div",zo,[Z("h4",Ao,[Y(q,null,{default:ee(()=>[Y(X(A))]),_:1}),a[310]||(a[310]=ae(" 二维码连接管理 ",-1))]),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:12},{default:ee(()=>[Y(me,{class:"qr-card"},{header:ee(()=>[...a[311]||(a[311]=[Z("span",null,"生成连接二维码",-1)])]),default:ee(()=>[Z("div",Io,[Y(j,{model:_a,"label-width":"100px",size:"small"},{default:ee(()=>[Y(s,{label:"用户权限"},{default:ee(()=>[Y(we,{modelValue:_a.permissions,"onUpdate:modelValue":a[102]||(a[102]=e=>_a.permissions=e)},{default:ee(()=>[Y(_e,{label:"call"},{default:ee(()=>[...a[312]||(a[312]=[ae("通话权限",-1)])]),_:1}),Y(_e,{label:"sms"},{default:ee(()=>[...a[313]||(a[313]=[ae("短信权限",-1)])]),_:1}),Y(_e,{label:"contacts"},{default:ee(()=>[...a[314]||(a[314]=[ae("联系人权限",-1)])]),_:1}),Y(_e,{label:"storage"},{default:ee(()=>[...a[315]||(a[315]=[ae("存储权限",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),Y(s,{label:"有效期"},{default:ee(()=>[Y(Ve,{modelValue:_a.expireTime,"onUpdate:modelValue":a[103]||(a[103]=e=>_a.expireTime=e),placeholder:"选择有效期"},{default:ee(()=>[Y(Ce,{label:"5分钟",value:"5"}),Y(Ce,{label:"10分钟",value:"10"}),Y(Ce,{label:"30分钟",value:"30"}),Y(Ce,{label:"1小时",value:"60"})]),_:1},8,["modelValue"])]),_:1}),Y(s,null,{default:ee(()=>[Y(l,{type:"primary",onClick:pt,loading:va.value},{default:ee(()=>[...a[316]||(a[316]=[ae(" 生成二维码 ",-1)])]),_:1},8,["loading"]),ba.value.connectionId?(G(),te(l,{key:0,onClick:mt,loading:va.value},{default:ee(()=>[...a[317]||(a[317]=[ae(" 刷新二维码 ",-1)])]),_:1},8,["loading"])):se("",!0)]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1}),Y(o,{span:12},{default:ee(()=>[Y(me,{class:"qr-display-card"},{header:ee(()=>[...a[318]||(a[318]=[Z("span",null,"扫码连接",-1)])]),default:ee(()=>[Z("div",To,[ba.value.qrCodeUrl?(G(),Q("div",Oo,[Z("img",{src:ba.value.qrCodeUrl,alt:"连接二维码",class:"qr-code-image"},null,8,Po),Z("div",Do,[Z("p",Uo,[Y(Ie,{type:gt(ba.value.status),size:"small"},{default:ee(()=>[ae(le(ft(ba.value.status)),1)]),_:1},8,["type"])]),ba.value.expiresAt?(G(),Q("p",No," 过期时间: "+le(ht(ba.value.expiresAt)),1)):se("",!0),ba.value.connectionId?(G(),Q("p",Eo," 连接ID: "+le(ba.value.connectionId.substring(0,8))+"... ",1)):se("",!0)])])):(G(),Q("div",$o,[Y(q,{size:"48",color:"#dcdfe6"},{default:ee(()=>[Y(X(A))]),_:1}),a[319]||(a[319]=Z("p",null,"点击生成二维码",-1))]))])]),_:1})]),_:1})]),_:1})]),Z("div",Bo,[Z("h4",Ro,[Y(q,null,{default:ee(()=>[Y(X(E))]),_:1}),a[320]||(a[320]=ae(" 替代连接方式 ",-1))]),Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:8},{default:ee(()=>[Y(me,{class:"connection-card"},{header:ee(()=>[Z("div",Mo,[Y(q,null,{default:ee(()=>[Y(X(A))]),_:1}),a[321]||(a[321]=Z("span",null,"蓝牙连接",-1))])]),default:ee(()=>[Z("div",Lo,[Z("div",qo,[Y(Ie,{type:ka.value.enabled?"success":"info",size:"small"},{default:ee(()=>[ae(le(ka.value.enabled?"已启用":"未启用"),1)]),_:1},8,["type"])]),a[322]||(a[322]=Z("div",{class:"connection-description"},[Z("p",null,"通过蓝牙配对连接移动设备，适用于近距离连接场景。")],-1)),Z("div",Fo,[Y(j,{size:"small"},{default:ee(()=>[Y(s,{label:"设备名称"},{default:ee(()=>[Y(t,{modelValue:ka.value.deviceName,"onUpdate:modelValue":a[104]||(a[104]=e=>ka.value.deviceName=e),placeholder:"CRM-Server"},null,8,["modelValue"])]),_:1}),Y(s,{label:"配对码"},{default:ee(()=>[Y(t,{modelValue:ka.value.pairingCode,"onUpdate:modelValue":a[105]||(a[105]=e=>ka.value.pairingCode=e),placeholder:"自动生成",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),Z("div",Ko,[Y(l,{type:ka.value.enabled?"danger":"primary",onClick:Al,loading:Ca.value,size:"small"},{default:ee(()=>[ae(le(ka.value.enabled?"停止":"启动")+"蓝牙服务 ",1)]),_:1},8,["type","loading"])])])]),_:1})]),_:1}),Y(o,{span:8},{default:ee(()=>[Y(me,{class:"connection-card"},{header:ee(()=>[Z("div",jo,[Y(q,null,{default:ee(()=>[Y(X(B))]),_:1}),a[323]||(a[323]=Z("span",null,"同网络连接",-1))])]),default:ee(()=>[Z("div",Jo,[Z("div",Wo,[Y(Ie,{type:Va.value.enabled?"success":"info",size:"small"},{default:ee(()=>[ae(le(Va.value.enabled?"已启用":"未启用"),1)]),_:1},8,["type"])]),a[324]||(a[324]=Z("div",{class:"connection-description"},[Z("p",null,"在同一局域网内自动发现并连接移动设备。")],-1)),Z("div",Ho,[Y(j,{size:"small"},{default:ee(()=>[Y(s,{label:"服务端口"},{default:ee(()=>[Y(be,{modelValue:Va.value.port,"onUpdate:modelValue":a[106]||(a[106]=e=>Va.value.port=e),min:1024,max:65535,placeholder:"8080"},null,8,["modelValue"])]),_:1}),Y(s,{label:"广播间隔"},{default:ee(()=>[Y(Ve,{modelValue:Va.value.broadcastInterval,"onUpdate:modelValue":a[107]||(a[107]=e=>Va.value.broadcastInterval=e)},{default:ee(()=>[Y(Ce,{label:"5秒",value:"5"}),Y(Ce,{label:"10秒",value:"10"}),Y(Ce,{label:"30秒",value:"30"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),Z("div",Qo,[Y(l,{type:Va.value.enabled?"danger":"primary",onClick:Il,loading:za.value,size:"small"},{default:ee(()=>[ae(le(Va.value.enabled?"停止":"启动")+"网络发现 ",1)]),_:1},8,["type","loading"])])])]),_:1})]),_:1}),Y(o,{span:8},{default:ee(()=>[Y(me,{class:"connection-card"},{header:ee(()=>[Z("div",Go,[Y(q,null,{default:ee(()=>[Y(X(z))]),_:1}),a[325]||(a[325]=Z("span",null,"数字配对",-1))])]),default:ee(()=>[Z("div",Zo,[Z("div",Yo,[Y(Ie,{type:Aa.value.enabled?"success":"info",size:"small"},{default:ee(()=>[ae(le(Aa.value.enabled?"已启用":"未启用"),1)]),_:1},8,["type"])]),a[326]||(a[326]=Z("div",{class:"connection-description"},[Z("p",null,"通过6位数字配对码连接，安全便捷。")],-1)),Z("div",Xo,[Y(j,{size:"small"},{default:ee(()=>[Y(s,{label:"当前配对码"},{default:ee(()=>[Z("div",en,[Z("span",an,le(Aa.value.currentCode||"------"),1),Y(l,{onClick:Ol,loading:Ta.value,size:"small",type:"text"},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(h))]),_:1})]),_:1},8,["loading"])])]),_:1}),Y(s,{label:"有效期"},{default:ee(()=>[Y(Ve,{modelValue:Aa.value.expireTime,"onUpdate:modelValue":a[108]||(a[108]=e=>Aa.value.expireTime=e)},{default:ee(()=>[Y(Ce,{label:"5分钟",value:"5"}),Y(Ce,{label:"10分钟",value:"10"}),Y(Ce,{label:"30分钟",value:"30"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),Z("div",ln,[Y(l,{type:Aa.value.enabled?"danger":"primary",onClick:Tl,loading:Ia.value,size:"small"},{default:ee(()=>[ae(le(Aa.value.enabled?"停止":"启动")+"数字配对 ",1)]),_:1},8,["type","loading"])])])]),_:1})]),_:1})]),_:1}),Y(me,{class:"connection-stats-card",style:{"margin-top":"20px"}},{header:ee(()=>[...a[327]||(a[327]=[Z("span",null,"连接统计",-1)])]),default:ee(()=>[Y(n,{gutter:20},{default:ee(()=>[Y(o,{span:6},{default:ee(()=>[Z("div",tn,[Z("div",sn,le(Sa.value.qr||0),1),a[328]||(a[328]=Z("div",{class:"stat-label"},"二维码连接",-1))])]),_:1}),Y(o,{span:6},{default:ee(()=>[Z("div",on,[Z("div",nn,le(Sa.value.bluetooth||0),1),a[329]||(a[329]=Z("div",{class:"stat-label"},"蓝牙连接",-1))])]),_:1}),Y(o,{span:6},{default:ee(()=>[Z("div",rn,[Z("div",cn,le(Sa.value.network||0),1),a[330]||(a[330]=Z("div",{class:"stat-label"},"网络连接",-1))])]),_:1}),Y(o,{span:6},{default:ee(()=>[Z("div",un,[Z("div",dn,le(Sa.value.digital||0),1),a[331]||(a[331]=Z("div",{class:"stat-label"},"数字配对",-1))])]),_:1})]),_:1})]),_:1})]),Z("div",pn,[Y(me,{class:"connected-devices-card",style:{"margin-top":"20px"}},{header:ee(()=>[Z("div",mn,[a[333]||(a[333]=Z("span",null,"已连接设备",-1)),Y(l,{onClick:vt,loading:wa.value,type:"primary",size:"small"},{default:ee(()=>[Y(q,null,{default:ee(()=>[Y(X(h))]),_:1}),a[332]||(a[332]=ae(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:ee(()=>[oe((G(),te(Ke,{data:ya.value,style:{width:"100%"}},{default:ee(()=>[Y(Fe,{prop:"deviceName",label:"设备名称",width:"200"}),Y(Fe,{prop:"deviceType",label:"设备类型",width:"120"},{default:ee(({row:e})=>[Y(Ie,{size:"small"},{default:ee(()=>[ae(le(e.deviceType),1)]),_:2},1024)]),_:1}),Y(Fe,{prop:"ipAddress",label:"IP地址",width:"150"}),Y(Fe,{prop:"connectedAt",label:"连接时间",width:"180"},{default:ee(({row:e})=>[ae(le(ht(e.connectedAt)),1)]),_:1}),Y(Fe,{prop:"lastActivity",label:"最后活动",width:"180"},{default:ee(({row:e})=>[ae(le(ht(e.lastActivity)),1)]),_:1}),Y(Fe,{prop:"status",label:"状态",width:"100"},{default:ee(({row:e})=>[Y(Ie,{type:"connected"===e.status?"success":"warning",size:"small"},{default:ee(()=>[ae(le("connected"===e.status?"在线":"离线"),1)]),_:2},1032,["type"])]),_:1}),Y(Fe,{label:"操作",width:"120"},{default:ee(({row:e})=>[Y(l,{type:"danger",size:"small",plain:"",onClick:a=>(async e=>{try{await r.confirm("确定要断开此设备的连接吗？","断开连接确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ye(e),await vt(),i.success("设备连接已断开")}catch(a){"cancel"!==a&&(console.error("断开设备连接失败:",a),i.error("断开设备连接失败，请重试"))}})(e.deviceId)},{default:ee(()=>[...a[334]||(a[334]=[ae(" 断开连接 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[dt,wa.value]]),0===ya.value.length?(G(),Q("div",gn,[Y(fl,{description:"暂无连接的设备"})])):se("",!0)]),_:1})]),Z("div",fn,[Z("h4",vn,[Y(q,null,{default:ee(()=>[Y(X(U))]),_:1}),a[335]||(a[335]=ae(" 使用说明 ",-1))]),Y(Pl,{modelValue:ga.value,"onUpdate:modelValue":a[109]||(a[109]=e=>ga.value=e),class:"guide-tabs"},{default:ee(()=>[Y(he,{label:"Android安装",name:"android"},{default:ee(()=>[...a[336]||(a[336]=[Z("div",{class:"guide-content"},[Z("ol",null,[Z("li",null,"下载APK文件到Android设备"),Z("li",null,'在设备设置中允许"未知来源"应用安装'),Z("li",null,"点击APK文件进行安装"),Z("li",null,"打开应用，扫描二维码或手动输入服务器地址"),Z("li",null,"授予必要的权限（通话、录音、网络等）"),Z("li",null,"完成连接配置，开始使用CRM功能")])],-1)])]),_:1}),Y(he,{label:"iOS安装",name:"ios"},{default:ee(()=>[Z("div",yn,[Y(Ae,{title:"iOS版本开发中",description:"iOS版本正在开发中，敬请期待。目前可以使用PWA版本在Safari浏览器中使用。",type:"info",closable:!1})])]),_:1}),Y(he,{label:"PWA使用",name:"pwa"},{default:ee(()=>[...a[337]||(a[337]=[Z("div",{class:"guide-content"},[Z("ol",null,[Z("li",null,"在手机浏览器中访问PWA应用链接"),Z("li",null,'点击浏览器菜单中的"添加到主屏幕"'),Z("li",null,"确认添加，应用图标将出现在桌面"),Z("li",null,"点击桌面图标打开应用"),Z("li",null,"享受类似原生应用的体验")])],-1)])]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1}),Y(he,{label:"系统日志",name:"logs"},{default:ee(()=>[Y(me,{class:"setting-card"},{header:ee(()=>[Z("div",hn,[a[340]||(a[340]=Z("span",null,"系统日志",-1)),Z("div",null,[Y(l,{onClick:lt,loading:fe.value,type:"primary"},{default:ee(()=>[...a[338]||(a[338]=[ae(" 刷新日志 ",-1)])]),_:1},8,["loading"]),Y(l,{onClick:tt,type:"danger",plain:""},{default:ee(()=>[...a[339]||(a[339]=[ae(" 清空日志 ",-1)])]),_:1})])])]),default:ee(()=>[Z("div",bn,[oe((G(),te(Ke,{data:pa.value,style:{width:"100%"},height:"500",stripe:""},{default:ee(()=>[Y(Fe,{prop:"timestamp",label:"时间",width:"180"},{default:ee(({row:e})=>{return[ae(le((a=e.timestamp,a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}))),1)];var a}),_:1}),Y(Fe,{prop:"level",label:"级别",width:"100"},{default:ee(({row:e})=>[Y(Ie,{type:at(e.level),size:"small"},{default:ee(()=>[ae(le(e.level),1)]),_:2},1032,["type"])]),_:1}),Y(Fe,{prop:"module",label:"模块",width:"120"}),Y(Fe,{prop:"message",label:"消息","show-overflow-tooltip":""}),Y(Fe,{prop:"details",label:"详情",width:"100"},{default:ee(({row:e})=>[e.details?(G(),te(l,{key:0,type:"text",size:"small",onClick:a=>{return l=e,void r.alert(l.details,`日志详情 - ${l.message}`,{confirmButtonText:"确定",type:"info"});var l}},{default:ee(()=>[...a[341]||(a[341]=[ae(" 查看详情 ",-1)])]),_:1},8,["onClick"])):se("",!0)]),_:1})]),_:1},8,["data"])),[[dt,fe.value]])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),Y(Dl,{modelValue:ue.value,"onUpdate:modelValue":a[111]||(a[111]=e=>ue.value=e),title:"短信管理",width:"90%","close-on-click-modal":!1,class:"sms-management-dialog"},{default:ee(()=>[Y(Wl)]),_:1},8,["modelValue"]),Y(xt,{modelValue:Ee.value,"onUpdate:modelValue":a[112]||(a[112]=e=>Ee.value=e),agreement:Re.value,onSave:vl},null,8,["modelValue","agreement"])])}}}),wn=a(_n,[["__scopeId","data-v-58067d47"]]);export{wn as default};
