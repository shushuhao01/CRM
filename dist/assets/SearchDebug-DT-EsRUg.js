import{u as e}from"./data-BOmuxtb8.js";import{E as r}from"./elementPlus-DxaqjplL.js";import{l as t,r as l,ag as o,m as a,q as s,p as d,U as c,O as n,Q as p,S as u}from"./vendor-BtukhyiH.js";import{_ as i}from"./index-C4IdUW1A.js";import"./env-DLalhsF6.js";import"./utils-DfI7e5Rl.js";const m={class:"search-debug-container"},g={class:"card-header"},h={key:0,class:"result-content"},y=["innerHTML"],f={key:0,class:"result-content"},v=["innerHTML"],b={class:"card-header"},x={key:0,class:"result-content"},N=["innerHTML"],$={class:"card-header"},_={key:0,class:"result-content"},S=["innerHTML"],k={key:0,class:"result-content"},I=["innerHTML"],T=i(t({__name:"SearchDebug",setup(t){const i=e(),T=l(""),O=l(""),J=l(""),L=l(""),H=l(""),M=l(""),C=l(""),w=()=>{console.log("[è°ƒè¯•å·¥å…·] å¼€å§‹æ£€æŸ¥æ•°æ®");try{const r=localStorage.getItem("customer-store"),t=localStorage.getItem("crm_store_order"),l=localStorage.getItem("userDatabase");let o="<h3>æ•°æ®æ£€æŸ¥ç»“æœ</h3>";if(r){const e=JSON.parse(r).customers||[];o+=`<p style="color: #67c23a;">âœ… å®¢æˆ·æ•°æ®: ${e.length} ä¸ªå®¢æˆ·</p>`,e.length>0&&(o+=`<p>ç¤ºä¾‹å®¢æˆ·: ${e[0].name} (${e[0].phone})</p>`)}else o+='<p style="color: #f56c6c;">âŒ ç¼ºå°‘å®¢æˆ·æ•°æ® (customer-store)</p>';if(t)try{const e=JSON.parse(t);let r=[];e.data&&e.data.orders?(r=e.data.orders,o+="<p>è®¢å•æ•°æ®æ ¼å¼: æ–°æ ¼å¼ { data: { orders: [...] } }</p>"):e.orders?(r=e.orders,o+="<p>è®¢å•æ•°æ®æ ¼å¼: æ—§æ ¼å¼ { orders: [...] }</p>"):Array.isArray(e)&&(r=e,o+="<p>è®¢å•æ•°æ®æ ¼å¼: æ•°ç»„æ ¼å¼ [...]</p>"),o+=`<p style="color: #67c23a;">âœ… è®¢å•æ•°æ®: ${r.length} ä¸ªè®¢å•</p>`,r.length>0&&(o+=`<p>ç¤ºä¾‹è®¢å•: ${r[0].orderNumber}</p>`,o+=`<pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; font-size: 12px;">${JSON.stringify(r[0],null,2)}</pre>`)}catch(e){o+=`<p style="color: #f56c6c;">âŒ è®¢å•æ•°æ®è§£æå¤±è´¥: ${e.message}</p>`}else o+='<p style="color: #f56c6c;">âŒ ç¼ºå°‘è®¢å•æ•°æ® (crm_store_order)</p>';if(l){o+=`<p style="color: #67c23a;">âœ… ç”¨æˆ·æ•°æ®: ${(JSON.parse(l)||[]).length} ä¸ªç”¨æˆ·</p>`}else o+='<p style="color: #f56c6c;">âŒ ç¼ºå°‘ç”¨æˆ·æ•°æ® (userDatabase)</p>';T.value=o,console.log("[è°ƒè¯•å·¥å…·] æ•°æ®æ£€æŸ¥å®Œæˆ")}catch(r){console.error("[è°ƒè¯•å·¥å…·] æ•°æ®æ£€æŸ¥å¤±è´¥:",r),T.value=`<p style="color: #f56c6c;">âŒ æ£€æŸ¥å¤±è´¥: ${r.message}</p>`}},A=()=>{if(M.value.trim()){console.log("[è°ƒè¯•å·¥å…·] å¼€å§‹æµ‹è¯•æœç´¢:",M.value);try{const e=localStorage.getItem("customer-store"),r=localStorage.getItem("crm_store_order"),t=localStorage.getItem("userDatabase");if(!e||!r||!t)return void(O.value='<p style="color: #f56c6c;">âŒ ç¼ºå°‘å¿…è¦æ•°æ®</p>');const l=JSON.parse(e).customers||[],o=JSON.parse(r);let a=[];o.data&&o.data.orders?a=o.data.orders:o.orders?a=o.orders:Array.isArray(o)&&(a=o);const s=JSON.parse(t)||[],d=M.value.trim();console.log("[è°ƒè¯•å·¥å…·] æ•°æ®åŠ è½½å®Œæˆ:",{customers:l.length,orders:a.length,users:s.length});const c=[];let n=0,p=0;for(let i=0;i<a.length;i++){const e=a[i];n++;const r=l.find(r=>r.id===e.customerId);if(!r){p++;continue}const t=s.find(r=>r.id===e.salesPersonId);let o=!1,u="";r.name&&r.name.includes(d)&&(o=!0,u="å®¢æˆ·å§“å"),r.phone&&r.phone===d&&(o=!0,u="å®¢æˆ·ç”µè¯"),r.code&&r.code===d&&(o=!0,u="å®¢æˆ·ç¼–ç "),e.orderNumber&&(e.orderNumber===d||e.orderNumber.includes(d))&&(o=!0,u="è®¢å•å·"),e.trackingNumber&&(e.trackingNumber===d||e.trackingNumber.includes(d))&&(o=!0,u="ç‰©æµå•å·"),o&&c.push({customerName:r.name||"æœªçŸ¥",phone:r.phone||"",orderNo:e.orderNumber||"",orderAmount:e.totalAmount||0,orderDate:e.createTime?e.createTime.split(" ")[0]:"",trackingNo:e.trackingNumber||"",ownerName:t&&(t.realName||t.name)||"æœªçŸ¥",ownerDepartment:t&&t.department||"æœªçŸ¥éƒ¨é—¨",matchType:u})}console.log("[è°ƒè¯•å·¥å…·] æœç´¢å®Œæˆ:",{processedCount:n,skippedCount:p,resultsCount:c.length});let u="<h3>æœç´¢æµ‹è¯•ç»“æœ</h3>";u+=`<p>æœç´¢å…³é”®è¯: <strong>${d}</strong></p>`,u+=`<p>å¤„ç†è®¢å•æ•°: ${n}</p>`,u+=`<p>è·³è¿‡è®¢å•æ•°: ${p}</p>`,u+=`<p>æœç´¢ç»“æœæ•°: ${c.length}</p>`,c.length>0?(u+='<p style="color: #67c23a;">âœ… æœç´¢æˆåŠŸï¼</p>',u+='<table style="width: 100%; border-collapse: collapse; margin-top: 15px;">',u+='<tr style="background: #f5f5f5;"><th style="padding: 10px; border: 1px solid #ddd;">å®¢æˆ·</th><th style="padding: 10px; border: 1px solid #ddd;">è®¢å•å·</th><th style="padding: 10px; border: 1px solid #ddd;">é‡‘é¢</th><th style="padding: 10px; border: 1px solid #ddd;">å½’å±äºº</th><th style="padding: 10px; border: 1px solid #ddd;">åŒ¹é…ç±»å‹</th></tr>',c.slice(0,10).forEach(e=>{u+=`<tr>\n          <td style="padding: 10px; border: 1px solid #ddd;">${e.customerName}</td>\n          <td style="padding: 10px; border: 1px solid #ddd;">${e.orderNo}</td>\n          <td style="padding: 10px; border: 1px solid #ddd;">Â¥${e.orderAmount.toLocaleString()}</td>\n          <td style="padding: 10px; border: 1px solid #ddd;">${e.ownerName}</td>\n          <td style="padding: 10px; border: 1px solid #ddd;">${e.matchType}</td>\n        </tr>`}),u+="</table>",c.length>10&&(u+=`<p style="margin-top: 10px;">åªæ˜¾ç¤ºå‰10æ¡ç»“æœï¼Œå…±${c.length}æ¡</p>`)):u+='<p style="color: #f56c6c;">âŒ æœªæ‰¾åˆ°åŒ¹é…ç»“æœ</p>',O.value=u}catch(e){console.error("[è°ƒè¯•å·¥å…·] æœç´¢æµ‹è¯•å¤±è´¥:",e),O.value=`<p style="color: #f56c6c;">âŒ æµ‹è¯•å¤±è´¥: ${e.message}</p>`}}else r.warning("è¯·è¾“å…¥æœç´¢å…³é”®è¯")},j=()=>{console.log("[è°ƒè¯•å·¥å…·] å¼€å§‹æ£€æŸ¥æ•°æ®å…³è”");try{const e=localStorage.getItem("customer-store"),r=localStorage.getItem("crm_store_order");if(!e||!r)return void(J.value='<p style="color: #f56c6c;">âŒ ç¼ºå°‘å¿…è¦æ•°æ®</p>');const t=JSON.parse(e).customers||[],l=JSON.parse(r);let o=[];l.data&&l.data.orders?o=l.data.orders:l.orders&&(o=l.orders);let a=0,s=0;const d=[];o.forEach(e=>{t.find(r=>r.id===e.customerId)?a++:(s++,d.push({orderNumber:e.orderNumber,customerId:e.customerId,customerName:e.customerName}))});let c="<h3>æ•°æ®å…³è”æ£€æŸ¥ç»“æœ</h3>";c+=`<p>æœ‰å®¢æˆ·çš„è®¢å•: ${a}</p>`,c+=`<p>æ— å®¢æˆ·çš„è®¢å•: ${s}</p>`,s>0?(c+='<p style="color: #e6a23c;">âš ï¸ å‘ç°é—®é¢˜è®¢å•ï¼</p>',c+="<p>é—®é¢˜è®¢å•åˆ—è¡¨ï¼ˆå‰10ä¸ªï¼‰:</p>",c+='<pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; font-size: 12px;">',c+=JSON.stringify(d.slice(0,10),null,2),c+="</pre>"):c+='<p style="color: #67c23a;">âœ… æ‰€æœ‰è®¢å•éƒ½æœ‰å¯¹åº”çš„å®¢æˆ·</p>',J.value=c,console.log("[è°ƒè¯•å·¥å…·] æ•°æ®å…³è”æ£€æŸ¥å®Œæˆ")}catch(e){console.error("[è°ƒè¯•å·¥å…·] æ•°æ®å…³è”æ£€æŸ¥å¤±è´¥:",e),J.value=`<p style="color: #f56c6c;">âŒ æ£€æŸ¥å¤±è´¥: ${e.message}</p>`}},D=()=>{console.log("[è°ƒè¯•å·¥å…·] å¼€å§‹å®Œæ•´è¯Šæ–­"),w(),j(),M.value&&A(),L.value='<p style="color: #67c23a;">âœ… å®Œæ•´è¯Šæ–­å·²å®Œæˆï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹å„é¡¹æ£€æŸ¥ç»“æœ</p>',r.success("å®Œæ•´è¯Šæ–­å·²å®Œæˆ")},V=async()=>{if(C.value.trim()){console.log("[è°ƒè¯•å·¥å…·] å¼€å§‹å®é™…æœç´¢æµ‹è¯•:",C.value);try{H.value="<p>æ­£åœ¨æœç´¢...</p>",await i.searchCustomer({phone:C.value,orderNo:C.value,trackingNo:C.value,customerName:C.value});const e=i.searchResults;let r="<h3>å®é™…æœç´¢ç»“æœï¼ˆä½¿ç”¨dataStoreï¼‰</h3>";r+=`<p>æœç´¢å…³é”®è¯: <strong>${C.value}</strong></p>`,r+=`<p>æœç´¢ç»“æœæ•°: ${e.length}</p>`,e.length>0?(r+='<p style="color: #67c23a;">âœ… æœç´¢æˆåŠŸï¼</p>',r+='<pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; font-size: 12px;">',r+=JSON.stringify(e.slice(0,5),null,2),r+="</pre>"):r+='<p style="color: #f56c6c;">âŒ æœªæ‰¾åˆ°åŒ¹é…ç»“æœ</p>',H.value=r,console.log("[è°ƒè¯•å·¥å…·] å®é™…æœç´¢å®Œæˆ:",e.length)}catch(e){console.error("[è°ƒè¯•å·¥å…·] å®é™…æœç´¢å¤±è´¥:",e),H.value=`<p style="color: #f56c6c;">âŒ æœç´¢å¤±è´¥: ${e.message}</p>`}}else r.warning("è¯·è¾“å…¥æœç´¢å…³é”®è¯")};return(e,r)=>{const t=o("el-button"),l=o("el-card"),i=o("el-input");return s(),a("div",m,[r[12]||(r[12]=d("div",{class:"page-header"},[d("h1",null,"ğŸ” å®¢æˆ·æŸ¥è¯¢æœç´¢è°ƒè¯•å·¥å…·"),d("p",null,"åœ¨ç³»ç»Ÿå†…éƒ¨è°ƒè¯•å®¢æˆ·æŸ¥è¯¢åŠŸèƒ½")],-1)),c(l,{class:"debug-card"},{header:n(()=>[d("div",g,[r[3]||(r[3]=d("span",null,"1. æ•°æ®æ£€æŸ¥",-1)),c(t,{type:"primary",onClick:w},{default:n(()=>[...r[2]||(r[2]=[u("æ£€æŸ¥æ•°æ®",-1)])]),_:1})])]),default:n(()=>[T.value?(s(),a("div",h,[d("div",{innerHTML:T.value},null,8,y)])):p("",!0)]),_:1}),c(l,{class:"debug-card"},{header:n(()=>[...r[4]||(r[4]=[d("div",{class:"card-header"},[d("span",null,"2. æœç´¢æµ‹è¯•")],-1)])]),default:n(()=>[c(i,{modelValue:M.value,"onUpdate:modelValue":r[0]||(r[0]=e=>M.value=e),placeholder:"è¾“å…¥æœç´¢å…³é”®è¯ï¼ˆè®¢å•å·ã€å®¢æˆ·å§“åç­‰ï¼‰",style:{"margin-bottom":"15px"}},{append:n(()=>[c(t,{type:"primary",onClick:A},{default:n(()=>[...r[5]||(r[5]=[u("æµ‹è¯•æœç´¢",-1)])]),_:1})]),_:1},8,["modelValue"]),O.value?(s(),a("div",f,[d("div",{innerHTML:O.value},null,8,v)])):p("",!0)]),_:1}),c(l,{class:"debug-card"},{header:n(()=>[d("div",b,[r[7]||(r[7]=d("span",null,"3. æ•°æ®å…³è”æ£€æŸ¥",-1)),c(t,{type:"warning",onClick:j},{default:n(()=>[...r[6]||(r[6]=[u("æ£€æŸ¥å…³è”",-1)])]),_:1})])]),default:n(()=>[J.value?(s(),a("div",x,[d("div",{innerHTML:J.value},null,8,N)])):p("",!0)]),_:1}),c(l,{class:"debug-card"},{header:n(()=>[d("div",$,[r[9]||(r[9]=d("span",null,"4. å®Œæ•´è¯Šæ–­",-1)),c(t,{type:"success",onClick:D},{default:n(()=>[...r[8]||(r[8]=[u("è¿è¡Œè¯Šæ–­",-1)])]),_:1})])]),default:n(()=>[L.value?(s(),a("div",_,[d("div",{innerHTML:L.value},null,8,S)])):p("",!0)]),_:1}),c(l,{class:"debug-card"},{header:n(()=>[...r[10]||(r[10]=[d("div",{class:"card-header"},[d("span",null,"5. å®é™…æœç´¢æµ‹è¯•ï¼ˆä½¿ç”¨dataStoreï¼‰")],-1)])]),default:n(()=>[c(i,{modelValue:C.value,"onUpdate:modelValue":r[1]||(r[1]=e=>C.value=e),placeholder:"è¾“å…¥æœç´¢å…³é”®è¯",style:{"margin-bottom":"15px"}},{append:n(()=>[c(t,{type:"primary",onClick:V},{default:n(()=>[...r[11]||(r[11]=[u("å®é™…æœç´¢",-1)])]),_:1})]),_:1},8,["modelValue"]),H.value?(s(),a("div",k,[d("div",{innerHTML:H.value},null,8,I)])):p("",!0)]),_:1})])}}}),[["__scopeId","data-v-5e751486"]]);export{T as default};
