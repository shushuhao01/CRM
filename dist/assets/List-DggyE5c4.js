var $t=Object.defineProperty,It=Object.defineProperties;var Ot=Object.getOwnPropertyDescriptors;var De=Object.getOwnPropertySymbols;var Ht=Object.prototype.hasOwnProperty,jt=Object.prototype.propertyIsEnumerable;var Ue=(L,C,b)=>C in L?$t(L,C,{enumerable:!0,configurable:!0,writable:!0,value:b}):L[C]=b,x=(L,C)=>{for(var b in C||(C={}))Ht.call(C,b)&&Ue(L,b,C[b]);if(De)for(var b of De(C))jt.call(C,b)&&Ue(L,b,C[b]);return L},V=(L,C)=>It(L,Ot(C));var $=(L,C,b)=>new Promise((j,D)=>{var f=S=>{try{M(b.next(S))}catch(z){D(z)}},ae=S=>{try{M(b.throw(S))}catch(z){D(z)}},M=S=>S.done?j(S.value):Promise.resolve(S.value).then(f,ae);M((b=b.apply(L,C)).next())});import{l as Ft,az as qt,aC as Bt,r as k,Z as ve,e as q,c as Wt,w as Qt,Y as Jt,ag as v,aq as Kt,m as A,p as m,q as c,U as a,F as te,a9 as oe,M as N,O as n,S as d,T as h,a7 as Pe,P as Me,V as Gt,Q as I,u as H,a2 as Yt}from"./vendor-D8Vxqhr-.js";import{j as Zt,u as Xt,h as ea,y as ta,g as aa,c as la,z as na,_ as sa}from"./settings-CuxbDWOu.js";import{E as _,p as ra,n as oa,f as ia,ab as da,r as ua,T as ca,ac as pa,b as ze}from"./elementPlus-Bmwh7Rh8.js";import{a as Re}from"./export-CTEZNzGJ.js";import{o as Ee}from"./order-BYWArVux.js";import{m as $e}from"./phone-DsAzMHsn.js";import"./utils-ywHRn0uI.js";const ma={class:"order-list"},fa={class:"quick-filters"},ga={class:"search-header"},va={class:"search-actions"},ha={class:"advanced-search"},_a={class:"table-card-container"},ba={class:"table-header"},ya={class:"table-title"},ka={key:0,class:"selected-info"},Aa={class:"table-actions"},Ca={class:"column-settings-container"},Sa={class:"column-settings-header"},Na=["onDragstart","onDrop"],wa={key:3,class:"amount-text"},Ta={key:4},xa={key:5,class:"product-list"},Va={key:6},La={key:0,class:"deposit-text"},Da={key:1,class:"no-deposit"},Ua={key:7},Pa={key:8},Ma={class:"operation-buttons"},za={class:"pagination-container"},Ra={class:"pagination-info"},Ea={class:"pagination"},$a={class:"cancel-order-form"},Ia={class:"order-info"},Oa={class:"dialog-footer"},Ha={class:"audit-footer",style:{"margin-top":"20px","text-align":"right"}},ja={class:"audit-footer",style:{"margin-top":"20px","text-align":"right"}},Fa=Ft({name:"OrderList",__name:"List",setup(L){const C=qt(),b=Bt(),j=la(C),D=Zt(),f=Xt(),ae=ea();ta();const M=aa(),S=k(!1),z=k(!1),F=k("all"),w=k([]),Ie=k({prop:"createTime",order:"descending"}),ie=k({}),G=k(!1),de=k(!1),Y=k(),B=k({id:"",orderNumber:"",customerName:"",totalAmount:0}),P=ve({reason:"",description:""}),Oe={reason:[{required:!0,message:"请选择取消原因",trigger:"change"}]},le=k(!1),ne=k("pending"),U=k([]),W=k(!1),r=ve({orderNumber:"",customerName:"",status:[],markType:"",dateRange:[],minAmount:void 0,maxAmount:void 0,operator:"",productName:"",customerPhone:"",paymentMethod:""}),T=ve({page:1,size:20,total:0}),he=k([{key:"all",label:"全部",count:0},{key:"pending",label:"待审核",count:0},{key:"approved",label:"已审核",count:0},{key:"shipped",label:"已发货",count:0},{key:"delivered",label:"已签收",count:0},{key:"pending_deposit",label:"待付定金",count:0},{key:"pending_payment",label:"待付尾款",count:0}]),O=k([{prop:"orderNumber",label:"订单号",visible:!0},{prop:"customerName",label:"客户姓名",visible:!0},{prop:"status",label:"状态",visible:!0},{prop:"markType",label:"标记",visible:!0},{prop:"totalAmount",label:"订单金额",visible:!0},{prop:"salesPersonName",label:"负责销售",visible:!0},{prop:"products",label:"商品",visible:!0},{prop:"depositAmount",label:"定金",visible:!0},{prop:"collectAmount",label:"代收金额",visible:!0},{prop:"receiverPhone",label:"收货电话",visible:!0},{prop:"paymentMethod",label:"支付方式",visible:!1},{prop:"createTime",label:"创建时间",visible:!0}]),He=k([{id:"sales1",name:"张销售",department:"销售一部"},{id:"sales2",name:"李销售",department:"销售二部"},{id:"sales3",name:"王销售",department:"销售一部"},{id:"admin",name:"管理员",department:"管理部"},{id:"sales001",name:"销售员工",department:"销售部"},{id:"service001",name:"客服员工",department:"客服部"},{id:"manager",name:"部门经理",department:"管理部"}]),R=q(()=>D.orders),je=t=>({reserved:"warning",normal:"success",return:"danger"})[t]||"success",_e=t=>({reserved:"预留单",normal:"正常发货单",return:"退单"})[t]||"正常发货单",be=(t,e,o)=>t==="pending"?o?"待审核":"待流转":{pending_transfer:"待流转",pending_audit:"待审核",audit_rejected:"审核拒绝",pending_shipment:"待发货",shipped:"已发货",delivered:"已签收",package_exception:"包裹异常",rejected:"拒收",rejected_returned:"物流部退回",logistics_returned:"物流部退回",logistics_cancelled:"物流部取消",after_sales_created:"已建售后",pending_cancel:"待取消",cancel_failed:"取消失败",cancelled:"已取消",draft:"草稿",approved:"已审核",confirmed:"已确认",refunded:"退货退款"}[t]||"未知",Fe=(t,e)=>e==="return"?"warning":{pending_transfer:"info",pending_audit:"warning",audit_rejected:"danger",pending_shipment:"primary",shipped:"primary",delivered:"success",package_exception:"warning",rejected:"danger",rejected_returned:"info",after_sales_created:"warning",pending_cancel:"warning",cancel_failed:"danger",cancelled:"info",draft:"info",pending:"warning",approved:"success",confirmed:"success",refunded:"info"}[t]||"info",ue=t=>{const e=f.currentUser;if(!e)return[];if(f.isSuperAdmin)return t;if(f.isDepartmentManager){const o=f.accessibleDepartments;return t.filter(s=>{if(s.departmentId)return o.includes(s.departmentId);const i=He.value.find(g=>g.id===s.salesPersonId);return i&&o.includes(i.department)})}if(f.isSalesStaff)return t.filter(o=>o.salesPersonId===e.id);if(f.isCustomerService){const o=e.customerServiceType;return o?t.filter(s=>{switch(o){case"after_sales":return s.markType==="return"||s.status==="after_sales_created";case"audit":return s.status==="pending_audit"||s.auditStatus==="pending";case"general":return!0;default:return!1}}):[]}return t.filter(o=>o.createdBy===e.id)},ce=q(()=>{let t=ue(R.value);if(F.value!=="all"&&(t=t.filter(e=>{switch(F.value){case"pending_deposit":return e.status==="pending"&&e.depositAmount>0;case"pending_payment":return e.status==="approved"&&e.depositAmount>0;default:return e.status===F.value}})),r.orderNumber&&(t=t.filter(e=>e.orderNumber.toLowerCase().includes(r.orderNumber.toLowerCase()))),r.customerName&&(t=t.filter(e=>e.customerName.toLowerCase().includes(r.customerName.toLowerCase()))),r.customerPhone&&(t=t.filter(e=>e.customerPhone.includes(r.customerPhone))),r.status.length>0&&(t=t.filter(e=>r.status.includes(e.status))),r.markType&&(t=t.filter(e=>(e.markType||"normal")===r.markType)),r.operator&&(t=t.filter(e=>e.operator.toLowerCase().includes(r.operator.toLowerCase()))),r.productName&&(t=t.filter(e=>Array.isArray(e.products)&&e.products.some(o=>o.name.toLowerCase().includes(r.productName.toLowerCase())))),r.paymentMethod&&(t=t.filter(e=>e.paymentMethod===r.paymentMethod)),r.minAmount!==void 0&&(t=t.filter(e=>e.totalAmount>=r.minAmount)),r.maxAmount!==void 0&&(t=t.filter(e=>e.totalAmount<=r.maxAmount)),r.dateRange&&r.dateRange.length===2){const[e,o]=r.dateRange;t=t.filter(s=>{const i=new Date(s.createTime);return i>=e&&i<=o})}return t}),qe=q(()=>f.isDepartmentHead||f.isManager||f.isSuperAdmin),Be=q(()=>ue(R.value).filter(e=>e.status==="pending_cancel")),We=q(()=>ue(R.value).filter(e=>e.status==="cancelled"||e.status==="cancel_failed")),ye=t=>({customer_cancel:"客户主动取消",out_of_stock:"商品缺货",price_change:"价格调整",order_error:"订单信息错误",other:"其他原因",客户要求取消:"客户要求取消",商品缺货:"商品缺货",价格争议:"价格争议"})[t]||t,Qe=q(()=>window.innerHeight-60-60-120-60-40),Je=q(()=>O.value.filter(t=>t.visible).map(t=>{const e={prop:t.prop,label:t.label,visible:t.visible};switch(t.prop){case"orderNumber":return V(x({},e),{width:180,sortable:"custom"});case"customerName":return V(x({},e),{width:120,sortable:"custom"});case"salesPersonName":return V(x({},e),{width:100,sortable:"custom"});case"status":return V(x({},e),{width:100,sortable:"custom"});case"markType":return V(x({},e),{width:100,align:"center"});case"totalAmount":return V(x({},e),{width:120,sortable:"custom"});case"customerPhone":return V(x({},e),{width:130});case"products":return V(x({},e),{minWidth:200});case"depositAmount":return V(x({},e),{width:120});case"paymentMethod":return V(x({},e),{width:100});case"createTime":return V(x({},e),{width:180,sortable:"custom"});case"operator":return V(x({},e),{width:100,sortable:"custom"});default:return e}})),Ke=(t,e)=>{switch(e.prop){case"orderNumber":return t.orderNumber;case"customerName":return t.customerName;case"salesPersonName":return t.createdBy||"系统用户";case"status":return be(t.status);case"markType":return _e(t.markType||"normal");case"totalAmount":return`¥${(t.totalAmount||0).toLocaleString()}`;case"receiverPhone":return t.receiverPhone?$e(t.receiverPhone):"-";case"products":return Array.isArray(t.products)?t.products.map(o=>`${o.name} × ${o.quantity}`).join(", "):t.products||"-";case"depositAmount":return t.depositAmount?`¥${t.depositAmount.toLocaleString()}`:"-";case"collectAmount":return t.collectAmount?`¥${t.collectAmount.toLocaleString()}`:"-";case"paymentMethod":return ke(t.paymentMethod);case"createTime":return t.createTime;case"operator":return t.operator;default:return t[e.prop]||"-"}},ke=t=>({cash:"现金",bank_transfer:"银行转账",alipay:"支付宝",wechat:"微信支付",card:"刷卡"})[t]||"-",Ge=(t,e,o,s,i)=>["pending_transfer","audit_rejected","logistics_returned","cancel_failed"].includes(t)?f.isSuperAdmin||f.isManager?!0:e===f.user.id:!1,Ye=(t,e)=>!["pending_transfer","pending_audit","audit_rejected","pending_shipment","logistics_returned","cancel_failed"].includes(t)||t==="cancelled"?!1:f.isSuperAdmin||f.isManager?!0:e===f.user.id,Ze=t=>["shipped","delivered","rejected","package_exception","rejected_returned"].includes(t),Xe=(t,e,o,s)=>["pending_transfer","audit_rejected","logistics_returned","cancel_failed"].includes(t)?f.isSuperAdmin||f.isManager?!0:s===f.user.id:!1,et=t=>$(this,null,function*(){var e,o;try{yield ze.confirm(`确定要提审订单 ${t.orderNumber} 吗？${t.markType==="normal"?"正常发货单将直接流转到审核环节。":""}`,"提审确认",{confirmButtonText:"确定提审",cancelButtonText:"取消",type:"warning"}),ie.value[t.id]=!0,yield Ee.submitAudit(t.id,{operatorId:f.user.id,markType:t.markType});const s=R.value.find(g=>g.id===t.id),i=D.getOrderById(t.id);s&&i&&(s.auditStatus="pending",i.auditStatus="pending",i.status="pending_audit",s.markType==="normal"&&(s.isAuditTransferred=!0,s.auditTransferTime=new Date().toLocaleString("zh-CN"),i.isAuditTransferred=!0,i.auditTransferTime=new Date().toLocaleString("zh-CN")),i.statusHistory||(i.statusHistory=[]),i.statusHistory.push({status:"pending_audit",time:new Date().toLocaleString("zh-CN"),operator:((e=f.user)==null?void 0:e.name)||"系统",description:"订单已提交审核",remark:"手动提审"}),M.sendMessage(M.MessageType.AUDIT_PENDING,`订单 ${s.orderNumber} (客户: ${s.customerName}, 金额: ¥${(o=s.totalAmount)==null?void 0:o.toLocaleString()}) 已提交审核`,{relatedId:s.id,relatedType:"order",actionUrl:`/order/detail/${s.id}`})),_.success("订单已提审"),Z()}catch(s){s!=="cancel"&&_.error("提审失败，请重试")}finally{ie.value[t.id]=!1}}),tt=t=>{F.value=t,T.page=1,Z()},at=()=>{z.value=!z.value},lt=({prop:t,order:e})=>{Ie.value={prop:t,order:e}},nt=t=>{w.value=t},st=t=>{t||se()},se=()=>{const t=O.value.map(e=>({prop:e.prop,label:e.label,visible:e.visible}));localStorage.setItem("orderListColumnSettings",JSON.stringify(t))},rt=()=>{const t=localStorage.getItem("orderListColumnSettings");if(t)try{JSON.parse(t).forEach(o=>{const s=O.value.find(i=>i.prop===o.prop);s&&(s.visible=o.visible)})}catch(e){console.warn("Failed to load column settings:",e)}},ot=()=>{O.value.forEach(t=>{t.visible=["orderNumber","customerName","status","markType","products","totalAmount","createTime","operator"].includes(t.prop)}),se()};let Q=-1;const it=(t,e)=>{Q=e,t.dataTransfer&&(t.dataTransfer.effectAllowed="move")},dt=t=>{t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move")},ut=(t,e)=>{if(t.preventDefault(),Q!==-1&&Q!==e){const o=O.value[Q];O.value.splice(Q,1),O.value.splice(e,0,o),se()}Q=-1},ct=()=>$(this,null,function*(){if(w.value.length===0){_.warning("请先选择要取消的订单");return}try{yield ze.confirm(`确定要取消选中的 ${w.value.length} 个订单吗？`,"批量取消",{type:"warning"}),S.value=!0,yield na.post("/api/orders/batch-cancel",{orderIds:w.value.map(t=>t.id),operatorId:f.user.id}),w.value.forEach(t=>{var o;const e=R.value.find(s=>s.id===t.id);e&&(e.status="cancelled",M.sendMessage(M.MessageType.ORDER_CANCELLED,`订单 ${e.orderNumber} (客户: ${e.customerName}, 金额: ¥${(o=e.totalAmount)==null?void 0:o.toLocaleString()}) 已取消`,{relatedId:e.id,relatedType:"order",actionUrl:`/order/detail/${e.id}`}))}),w.value=[],_.success("批量取消成功"),Z()}catch(t){t!=="cancel"&&_.error("批量取消失败，请重试")}finally{S.value=!1}}),pt=()=>$(this,null,function*(){if(w.value.length===0){_.warning("请先选择要导出的订单");return}try{S.value=!0;const t=w.value.map(e=>({orderNumber:e.orderNumber||"",customerName:e.customerName||"",customerPhone:e.customerPhone||"",receiverName:e.receiverName||"",receiverPhone:e.receiverPhone||"",receiverAddress:e.receiverAddress||"",products:e.products||[],totalQuantity:e.totalQuantity||0,totalAmount:e.totalAmount||0,depositAmount:e.depositAmount||0,codAmount:e.codAmount||0,customerAge:e.customerAge||0,customerHeight:e.customerHeight||0,customerWeight:e.customerWeight||0,medicalHistory:e.medicalHistory||"",serviceWechat:e.serviceWechat||"",remark:e.remark||"",createTime:e.createTime||"",status:e.status||"",shippingStatus:e.shippingStatus||""}));yield Re(t,f.isAdmin),_.success(`成功导出 ${w.value.length} 条订单数据`)}catch(t){_.error("导出失败，请重试")}finally{S.value=!1}}),mt=()=>$(this,null,function*(){try{S.value=!0;const t=ce.value.map(e=>({orderNumber:e.orderNumber||"",customerName:e.customerName||"",customerPhone:e.customerPhone||"",receiverName:e.receiverName||"",receiverPhone:e.receiverPhone||"",receiverAddress:e.receiverAddress||"",products:e.products||[],totalQuantity:e.totalQuantity||0,totalAmount:e.totalAmount||0,depositAmount:e.depositAmount||0,codAmount:e.codAmount||0,customerAge:e.customerAge||0,customerHeight:e.customerHeight||0,customerWeight:e.customerWeight||0,medicalHistory:e.medicalHistory||"",serviceWechat:e.serviceWechat||"",remark:e.remark||"",createTime:e.createTime||"",status:e.status||"",shippingStatus:e.shippingStatus||""}));yield Re(t,f.isAdmin),_.success(`成功导出 ${t.length} 条订单数据`)}catch(t){_.error("导出失败，请重试")}finally{S.value=!1}}),Z=()=>{he.value.forEach(t=>{t.key==="all"?t.count=R.value.length:t.key==="pending_deposit"?t.count=R.value.filter(e=>e.status==="pending"&&e.depositAmount>0).length:t.key==="pending_payment"?t.count=R.value.filter(e=>e.status==="approved"&&e.depositAmount>0).length:t.count=R.value.filter(e=>e.status===t.key).length})},ft=()=>{j.push("/order/add")},Ae=t=>{j.push(`/order/detail/${t.id}`)},gt=t=>{j.push(`/order/edit/${t.id}`)},vt=t=>{B.value={id:t.id,orderNumber:t.orderNumber,customerName:t.customerName,totalAmount:t.totalAmount},P.reason="",P.description="",G.value=!0},Ce=()=>{G.value=!1,Y.value&&Y.value.clearValidate()},ht=()=>$(this,null,function*(){var t,e,o,s;if(Y.value)try{yield Y.value.validate(),de.value=!0,yield Ee.cancelRequest({orderId:B.value.id,reason:P.reason,description:P.description,operatorId:((t=f.user)==null?void 0:t.id)||"current_user"});const i=R.value.find(g=>g.id===B.value.id);i&&(i.status="pending_cancel",i.cancelStatus="pending",i.cancelReason=P.reason,i.cancelDescription=P.description,i.cancelRequestTime=new Date().toLocaleString("zh-CN"),i.updateTime=new Date().toLocaleString("zh-CN"),M.sendMessage(M.MessageType.ORDER_CANCEL_REQUEST,`订单 ${i.orderNumber} 的取消申请已提交，等待管理员审核`,{relatedId:i.id,relatedType:"order",actionUrl:`/order/detail/${i.id}`})),_.success("取消申请已提交，等待管理员审核"),G.value=!1,Z()}catch(i){console.error("取消订单申请失败:",i);let g="提交取消申请失败，请重试";i&&typeof i=="object"&&((o=(e=i.response)==null?void 0:e.data)!=null&&o.message?g=i.response.data.message:(s=i.data)!=null&&s.message?g=i.data.message:i.message&&(g=i.message)),_.error(g)}finally{de.value=!1}}),_t=t=>{j.push({path:"/service/add",query:{orderNumber:t.orderNumber,customerId:t.customerId,customerName:t.customerName,customerPhone:t.customerPhone,products:JSON.stringify(t.products)}})},bt=()=>{le.value=!0,ne.value="pending",U.value=[]},re=()=>{le.value=!1,U.value=[]},yt=t=>{ne.value=t,U.value=[]},kt=t=>{U.value=t},At=()=>$(this,null,function*(){if(U.value.length===0){_.warning("请选择要审核的订单");return}try{W.value=!0;const t=U.value.map(e=>e.id);yield D.approveCancelOrders(t),_.success("审核通过成功"),U.value=[],yield loadOrders(),re()}catch(t){console.error("审核通过失败:",t),_.error("审核通过失败，请重试")}finally{W.value=!1}}),Ct=()=>$(this,null,function*(){if(U.value.length===0){_.warning("请选择要审核的订单");return}try{W.value=!0;const t=U.value.map(e=>e.id);yield D.rejectCancelOrders(t),_.success("审核拒绝成功"),U.value=[],yield loadOrders(),re()}catch(t){console.error("审核拒绝失败:",t),_.error("审核拒绝失败，请重试")}finally{W.value=!1}}),pe=()=>{T.page=1,X()},St=()=>{r.orderNumber="",r.customerName="",r.status=[],r.markType="",r.dateRange=[],r.minAmount=void 0,r.maxAmount=void 0,r.operator="",r.productName="",r.customerPhone="",r.paymentMethod="",F.value="all",z.value=!1,T.page=1,X()},Nt=t=>{T.size=t,T.page=1,X()},wt=t=>{T.page=t,X()},X=()=>{T.total=ce.value.length},J=()=>$(this,null,function*(){try{const t=yield ae.withLoading(()=>$(this,null,function*(){return yield new Promise(e=>setTimeout(e,800)),{data:D.orders,total:150}}),"正在加载订单列表...");D.orders.length===0&&D.initializeWithMockData(),X(),Z()}catch(t){ae.showError("加载订单列表失败",t)}}),Se=()=>{};Wt(()=>{rt(),J(),D.setupLogisticsEventListener(),D.startLogisticsAutoSync(),window.addEventListener("resize",Se),window.addEventListener("orderStatusUpdated",Ne),window.addEventListener("orderUpdated",Tt),window.addEventListener("todoStatusUpdated",we)});const Ne=t=>{console.log("订单状态已更新，刷新订单列表",t.detail),J(),_.success("订单状态已同步更新")},Tt=t=>{console.log("订单数据已更新，刷新订单列表",t.detail),J(),_.success("订单数据已同步更新")},we=t=>{console.log("待办状态已更新，刷新订单列表",t.detail),J(),_.success("待办状态已同步更新")};return Qt(()=>b.query,t=>{t.refresh==="true"&&(J(),_.success("订单列表已刷新"),j.replace({path:"/order/list"}))},{immediate:!1}),Jt(()=>{window.removeEventListener("resize",Se),window.removeEventListener("orderStatusUpdated",Ne),window.removeEventListener("todoStatusUpdated",we),document.querySelectorAll('a[href^="blob:"]').forEach(e=>{const o=e.getAttribute("href");o&&o.startsWith("blob:")&&(URL.revokeObjectURL(o),e.parentNode&&e.parentNode.removeChild(e))})}),(t,e)=>{const o=v("el-tag"),s=v("el-button"),i=v("el-input"),g=v("el-form-item"),p=v("el-option"),ee=v("el-select"),me=v("el-form"),xt=v("el-date-picker"),K=v("el-col"),Te=v("el-input-number"),xe=v("el-row"),Vt=v("el-collapse-transition"),Lt=v("el-card"),fe=v("el-icon"),Dt=v("el-checkbox"),Ut=v("el-dropdown-menu"),Pt=v("el-dropdown"),y=v("el-table-column"),Mt=v("el-link"),ge=v("el-table"),zt=v("el-pagination"),Ve=v("el-dialog"),Le=v("el-tab-pane"),Rt=v("el-tabs"),Et=Kt("loading");return m(),A("div",ma,[e[50]||(e[50]=c("div",{class:"page-header"},[c("h2",null,"订单管理")],-1)),c("div",fa,[(m(!0),A(te,null,oe(he.value,l=>(m(),N(o,{key:l.key,type:F.value===l.key?"primary":"",effect:F.value===l.key?"dark":"plain",onClick:u=>tt(l.key),class:"filter-tag"},{default:n(()=>[d(h(l.label),1)]),_:2},1032,["type","effect","onClick"]))),128))]),a(Lt,{class:"search-card"},{default:n(()=>[c("div",ga,[e[20]||(e[20]=c("span",{class:"search-title"},"筛选条件",-1)),c("div",va,[a(s,{text:"",type:"primary",onClick:at,icon:z.value?"ArrowUp":"ArrowDown"},{default:n(()=>[d(h(z.value?"收起":"高级筛选"),1)]),_:1},8,["icon"]),a(s,{text:"",type:"primary",onClick:mt,icon:"Download"},{default:n(()=>[...e[19]||(e[19]=[d(" 导出 ",-1)])]),_:1})])]),a(me,{model:r,inline:"",class:"basic-search"},{default:n(()=>[a(g,{label:"订单号"},{default:n(()=>[a(i,{modelValue:r.orderNumber,"onUpdate:modelValue":e[0]||(e[0]=l=>r.orderNumber=l),placeholder:"请输入订单号",clearable:"",onKeyup:Pe(pe,["enter"])},null,8,["modelValue"])]),_:1}),a(g,{label:"客户姓名"},{default:n(()=>[a(i,{modelValue:r.customerName,"onUpdate:modelValue":e[1]||(e[1]=l=>r.customerName=l),placeholder:"请输入客户姓名",clearable:"",onKeyup:Pe(pe,["enter"])},null,8,["modelValue"])]),_:1}),a(g,{label:"订单状态"},{default:n(()=>[a(ee,{modelValue:r.status,"onUpdate:modelValue":e[2]||(e[2]=l=>r.status=l),placeholder:"请选择状态",clearable:"",multiple:"","collapse-tags":"",style:{"min-width":"200px",width:"auto"}},{default:n(()=>[a(p,{label:"待流转",value:"pending_transfer"}),a(p,{label:"待审核",value:"pending_audit"}),a(p,{label:"审核拒绝",value:"audit_rejected"}),a(p,{label:"待发货",value:"pending_shipment"}),a(p,{label:"已发货",value:"shipped"}),a(p,{label:"已签收",value:"delivered"}),a(p,{label:"物流部退回",value:"logistics_returned"}),a(p,{label:"物流部取消",value:"logistics_cancelled"}),a(p,{label:"待取消",value:"pending_cancel"}),a(p,{label:"取消失败",value:"cancel_failed"}),a(p,{label:"已取消",value:"cancelled"}),a(p,{label:"草稿",value:"draft"}),a(p,{label:"已审核",value:"approved"}),a(p,{label:"审核退回",value:"rejected"}),a(p,{label:"待付定金",value:"pending_deposit"}),a(p,{label:"待付尾款",value:"pending_payment"})]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"标记"},{default:n(()=>[a(ee,{modelValue:r.markType,"onUpdate:modelValue":e[3]||(e[3]=l=>r.markType=l),placeholder:"请选择标记",clearable:"",style:{"min-width":"140px",width:"auto"}},{default:n(()=>[a(p,{label:"正常发货单",value:"normal"}),a(p,{label:"预留单",value:"reserved"}),a(p,{label:"退单",value:"return"})]),_:1},8,["modelValue"])]),_:1}),a(g,null,{default:n(()=>[a(s,{type:"primary",onClick:pe,icon:"Search"},{default:n(()=>[...e[21]||(e[21]=[d("搜索",-1)])]),_:1}),a(s,{onClick:St,icon:"Refresh"},{default:n(()=>[...e[22]||(e[22]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),a(Vt,null,{default:n(()=>[Me(c("div",ha,[a(me,{model:r,inline:!1,"label-width":"100px"},{default:n(()=>[a(xe,{gutter:20},{default:n(()=>[a(K,{span:8},{default:n(()=>[a(g,{label:"创建时间"},{default:n(()=>[a(xt,{modelValue:r.dateRange,"onUpdate:modelValue":e[4]||(e[4]=l=>r.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(K,{span:8},{default:n(()=>[a(g,{label:"金额范围"},{default:n(()=>[a(Te,{modelValue:r.minAmount,"onUpdate:modelValue":e[5]||(e[5]=l=>r.minAmount=l),placeholder:"最小金额",min:0,precision:2,style:{width:"48%"}},null,8,["modelValue"]),e[23]||(e[23]=c("span",{style:{margin:"0 2%"}},"-",-1)),a(Te,{modelValue:r.maxAmount,"onUpdate:modelValue":e[6]||(e[6]=l=>r.maxAmount=l),placeholder:"最大金额",min:0,precision:2,style:{width:"48%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(K,{span:8},{default:n(()=>[a(g,{label:"操作人"},{default:n(()=>[a(ee,{modelValue:r.operator,"onUpdate:modelValue":e[7]||(e[7]=l=>r.operator=l),placeholder:"请选择操作人",clearable:""},{default:n(()=>[a(p,{label:"李销售",value:"李销售"}),a(p,{label:"王销售",value:"王销售"}),a(p,{label:"赵销售",value:"赵销售"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(xe,{gutter:20},{default:n(()=>[a(K,{span:8},{default:n(()=>[a(g,{label:"商品名称"},{default:n(()=>[a(i,{modelValue:r.productName,"onUpdate:modelValue":e[8]||(e[8]=l=>r.productName=l),placeholder:"请输入商品名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(K,{span:8},{default:n(()=>[a(g,{label:"客户电话"},{default:n(()=>[a(i,{modelValue:r.customerPhone,"onUpdate:modelValue":e[9]||(e[9]=l=>r.customerPhone=l),placeholder:"请输入客户电话",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(K,{span:8},{default:n(()=>[a(g,{label:"支付方式"},{default:n(()=>[a(ee,{modelValue:r.paymentMethod,"onUpdate:modelValue":e[10]||(e[10]=l=>r.paymentMethod=l),placeholder:"请选择支付方式",clearable:""},{default:n(()=>[a(p,{label:"现金",value:"cash"}),a(p,{label:"银行转账",value:"bank_transfer"}),a(p,{label:"支付宝",value:"alipay"}),a(p,{label:"微信支付",value:"wechat"}),a(p,{label:"刷卡",value:"card"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])],512),[[Gt,z.value]])]),_:1})]),_:1}),c("div",_a,[c("div",ba,[c("div",ya,[e[24]||(e[24]=c("span",null,"订单列表",-1)),w.value.length>0?(m(),A("span",ka," （已选择 "+h(w.value.length)+" 项） ",1)):I("",!0)]),c("div",Aa,[a(s,{type:"primary",onClick:ft,size:"small"},{default:n(()=>[a(fe,null,{default:n(()=>[a(H(ra))]),_:1}),e[25]||(e[25]=d(" 新建订单 ",-1))]),_:1}),w.value.length>0?(m(),N(s,{key:0,type:"primary",size:"small",onClick:pt,icon:H(oa)},{default:n(()=>[...e[26]||(e[26]=[d(" 批量导出 ",-1)])]),_:1},8,["icon"])):I("",!0),w.value.length>0?(m(),N(s,{key:1,type:"danger",size:"small",onClick:ct,icon:H(ia)},{default:n(()=>[...e[27]||(e[27]=[d(" 批量取消 ",-1)])]),_:1},8,["icon"])):I("",!0),qe.value?(m(),N(s,{key:2,onClick:bt,size:"small",icon:H(da),type:"warning"},{default:n(()=>[...e[28]||(e[28]=[d(" 取消订单审核 ",-1)])]),_:1},8,["icon"])):I("",!0),a(s,{onClick:J,size:"small",icon:H(ua)},{default:n(()=>[...e[29]||(e[29]=[d(" 刷新 ",-1)])]),_:1},8,["icon"]),a(Pt,{trigger:"click",onVisibleChange:st},{dropdown:n(()=>[a(Ut,null,{default:n(()=>[c("div",Ca,[c("div",Sa,[e[32]||(e[32]=c("span",null,"列显示设置",-1)),a(s,{size:"small",text:"",onClick:ot},{default:n(()=>[...e[31]||(e[31]=[d("重置",-1)])]),_:1})]),(m(!0),A(te,null,oe(O.value,(l,u)=>(m(),A("div",{class:"column-item",key:l.prop,draggable:"true",onDragstart:E=>it(E,u),onDragover:dt,onDrop:E=>ut(E,u)},[a(fe,{class:"drag-handle"},{default:n(()=>[a(H(pa))]),_:1}),a(Dt,{modelValue:l.visible,"onUpdate:modelValue":E=>l.visible=E,onClick:e[11]||(e[11]=Yt(()=>{},["stop"])),onChange:se},{default:n(()=>[d(h(l.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])],40,Na))),128))])]),_:1})]),default:n(()=>[a(s,{size:"small"},{default:n(()=>[e[30]||(e[30]=d(" 列设置 ",-1)),a(fe,null,{default:n(()=>[a(H(ca))]),_:1})]),_:1})]),_:1})])]),Me((m(),N(ge,{data:ce.value,onSelectionChange:nt,onSortChange:lt,"default-sort":{prop:"createTime",order:"descending"},stripe:"",border:"",height:Qe.value,style:{width:"100%"}},{default:n(()=>[a(y,{type:"selection",width:"55"}),(m(!0),A(te,null,oe(Je.value,l=>(m(),N(y,{key:l.prop,prop:l.prop,label:l.label,width:l.width,"min-width":l.minWidth,sortable:l.sortable,align:l.align},{default:n(({row:u})=>[l.prop==="orderNumber"?(m(),N(Mt,{key:0,onClick:E=>Ae(u),type:"primary"},{default:n(()=>[d(h(u.orderNumber),1)]),_:2},1032,["onClick"])):l.prop==="status"?(m(),N(o,{key:1,type:Fe(u.status,u.markType)},{default:n(()=>[d(h(be(u.status,u.markType,u.isAuditTransferred)),1)]),_:2},1032,["type"])):l.prop==="markType"?(m(),N(o,{key:2,type:je(u.markType||"normal"),size:"small",effect:"dark"},{default:n(()=>[d(h(_e(u.markType||"normal")),1)]),_:2},1032,["type"])):l.prop==="totalAmount"?(m(),A("span",wa," ¥"+h((u.totalAmount||0).toLocaleString()),1)):l.prop==="customerPhone"?(m(),A("span",Ta,h(u.customerPhone?H($e)(u.customerPhone):"-"),1)):l.prop==="products"?(m(),A("div",xa,[(m(!0),A(te,null,oe(u.products,E=>(m(),A("div",{key:E.id,class:"product-item"},h(E.name)+" × "+h(E.quantity),1))),128))])):l.prop==="depositAmount"?(m(),A("span",Va,[u.depositAmount?(m(),A("span",La," ¥"+h(u.depositAmount.toLocaleString()),1)):(m(),A("span",Da,"-"))])):l.prop==="paymentMethod"?(m(),A("span",Ua,h(ke(u.paymentMethod)),1)):(m(),A("span",Pa,h(Ke(u,l)),1))]),_:2},1032,["prop","label","width","min-width","sortable","align"]))),128)),a(y,{label:"操作","min-width":"200",fixed:"right"},{default:n(({row:l})=>[c("div",Ma,[a(s,{type:"text",size:"small",onClick:u=>Ae(l)},{default:n(()=>[...e[33]||(e[33]=[d("详情",-1)])]),_:1},8,["onClick"]),l.status!=="cancelled"&&l.status!=="after_sales_created"?(m(),A(te,{key:0},[Ge(l.status,l.operatorId,l.markType,l.auditStatus,l.isAuditTransferred)?(m(),N(s,{key:0,type:"text",size:"small",onClick:u=>gt(l)},{default:n(()=>[...e[34]||(e[34]=[d(" 编辑 ",-1)])]),_:1},8,["onClick"])):I("",!0),Xe(l.status,l.auditStatus,l.isAuditTransferred,l.operatorId)?(m(),N(s,{key:1,type:"text",size:"small",onClick:u=>et(l),loading:ie.value[l.id]},{default:n(()=>[...e[35]||(e[35]=[d(" 提审 ",-1)])]),_:1},8,["onClick","loading"])):I("",!0),Ye(l.status,l.operatorId)?(m(),N(s,{key:2,type:"text",size:"small",onClick:u=>vt(l)},{default:n(()=>[...e[36]||(e[36]=[d(" 取消 ",-1)])]),_:1},8,["onClick"])):I("",!0),Ze(l.status)?(m(),N(s,{key:3,type:"text",size:"small",onClick:u=>_t(l)},{default:n(()=>[...e[37]||(e[37]=[d(" 售后 ",-1)])]),_:1},8,["onClick"])):I("",!0)],64)):I("",!0)])]),_:1})]),_:1},8,["data","height"])),[[Et,S.value]]),c("div",za,[c("div",Ra,[c("span",null,"共 "+h(T.total)+" 条记录",1)]),c("div",Ea,[a(zt,{"current-page":T.page,"onUpdate:currentPage":e[12]||(e[12]=l=>T.page=l),"page-size":T.size,"onUpdate:pageSize":e[13]||(e[13]=l=>T.size=l),"page-sizes":[10,20,50,100],total:T.total,layout:"sizes, prev, pager, next, jumper",onSizeChange:Nt,onCurrentChange:wt},null,8,["current-page","page-size","total"])])])]),a(Ve,{modelValue:G.value,"onUpdate:modelValue":e[16]||(e[16]=l=>G.value=l),title:"申请取消订单",width:"500px","before-close":Ce},{footer:n(()=>[c("div",Oa,[a(s,{onClick:Ce},{default:n(()=>[...e[42]||(e[42]=[d("取消",-1)])]),_:1}),a(s,{type:"primary",onClick:ht,loading:de.value},{default:n(()=>[...e[43]||(e[43]=[d(" 提交审核 ",-1)])]),_:1},8,["loading"])])]),default:n(()=>{var l;return[c("div",$a,[c("div",Ia,[e[41]||(e[41]=c("h4",null,"订单信息",-1)),c("p",null,[e[38]||(e[38]=c("strong",null,"订单号：",-1)),d(h(B.value.orderNumber),1)]),c("p",null,[e[39]||(e[39]=c("strong",null,"客户：",-1)),d(h(B.value.customerName),1)]),c("p",null,[e[40]||(e[40]=c("strong",null,"金额：",-1)),d("¥"+h((l=B.value.totalAmount)==null?void 0:l.toLocaleString()),1)])]),a(me,{model:P,rules:Oe,ref_key:"cancelFormRef",ref:Y,"label-width":"100px"},{default:n(()=>[a(g,{label:"取消原因",prop:"reason"},{default:n(()=>[a(ee,{modelValue:P.reason,"onUpdate:modelValue":e[14]||(e[14]=u=>P.reason=u),placeholder:"请选择取消原因",style:{width:"100%"}},{default:n(()=>[a(p,{label:"客户主动取消",value:"customer_cancel"}),a(p,{label:"商品缺货",value:"out_of_stock"}),a(p,{label:"价格调整",value:"price_change"}),a(p,{label:"订单信息错误",value:"order_error"}),a(p,{label:"其他原因",value:"other"})]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"详细说明"},{default:n(()=>[a(i,{modelValue:P.description,"onUpdate:modelValue":e[15]||(e[15]=u=>P.description=u),type:"textarea",rows:4,placeholder:"请详细说明取消原因（选填）...",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]}),_:1},8,["modelValue"]),a(Ve,{modelValue:le.value,"onUpdate:modelValue":e[18]||(e[18]=l=>le.value=l),title:"取消订单审核",width:"1200px","close-on-click-modal":!1},{default:n(()=>[a(Rt,{modelValue:ne.value,"onUpdate:modelValue":e[17]||(e[17]=l=>ne.value=l),onTabChange:yt},{default:n(()=>[a(Le,{label:"待审核",name:"pending"},{default:n(()=>[a(ge,{data:Be.value,onSelectionChange:kt,style:{width:"100%"},"max-height":"400"},{default:n(()=>[a(y,{type:"selection",width:"55"}),a(y,{prop:"orderNumber",label:"订单号",width:"180"}),a(y,{prop:"customerName",label:"客户姓名",width:"120"}),a(y,{label:"负责销售",width:"100"},{default:n(({row:l})=>[d(h(l.createdBy||"系统用户"),1)]),_:1}),a(y,{prop:"totalAmount",label:"金额",width:"120"},{default:n(({row:l})=>{var u;return[d(" ¥"+h(((u=l.totalAmount)==null?void 0:u.toFixed(2))||"0.00"),1)]}),_:1}),a(y,{prop:"cancelRequestTime",label:"申请时间",width:"180"}),a(y,{label:"取消原因","min-width":"150"},{default:n(({row:l})=>[d(h(ye(l.cancelReason)),1)]),_:1})]),_:1},8,["data"]),c("div",Ha,[a(s,{onClick:re},{default:n(()=>[...e[44]||(e[44]=[d("关闭",-1)])]),_:1}),a(s,{type:"success",onClick:At,loading:W.value,disabled:U.value.length===0},{default:n(()=>[...e[45]||(e[45]=[d(" 审核取消通过 ",-1)])]),_:1},8,["loading","disabled"]),a(s,{type:"danger",onClick:Ct,loading:W.value,disabled:U.value.length===0},{default:n(()=>[...e[46]||(e[46]=[d(" 审核取消拒绝 ",-1)])]),_:1},8,["loading","disabled"])])]),_:1}),a(Le,{label:"已审核",name:"audited"},{default:n(()=>[a(ge,{data:We.value,style:{width:"100%"},"max-height":"400"},{default:n(()=>[a(y,{prop:"orderNumber",label:"订单号",width:"180"}),a(y,{prop:"customerName",label:"客户姓名",width:"120"}),a(y,{label:"负责销售",width:"100"},{default:n(({row:l})=>[d(h(l.createdBy||"系统用户"),1)]),_:1}),a(y,{prop:"totalAmount",label:"金额",width:"120"},{default:n(({row:l})=>{var u;return[d(" ¥"+h(((u=l.totalAmount)==null?void 0:u.toFixed(2))||"0.00"),1)]}),_:1}),a(y,{prop:"cancelRequestTime",label:"申请时间",width:"180"}),a(y,{label:"取消原因",width:"150"},{default:n(({row:l})=>[d(h(ye(l.cancelReason)),1)]),_:1}),a(y,{prop:"status",label:"审核结果",width:"100"},{default:n(({row:l})=>[l.status==="cancelled"?(m(),N(o,{key:0,type:"success"},{default:n(()=>[...e[47]||(e[47]=[d("已取消",-1)])]),_:1})):l.status==="cancel_failed"?(m(),N(o,{key:1,type:"danger"},{default:n(()=>[...e[48]||(e[48]=[d("取消失败",-1)])]),_:1})):I("",!0)]),_:1})]),_:1},8,["data"]),c("div",ja,[a(s,{onClick:re},{default:n(()=>[...e[49]||(e[49]=[d("关闭",-1)])]),_:1})])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}}}),Za=sa(Fa,[["__scopeId","data-v-8992e5ad"]]);export{Za as default};
