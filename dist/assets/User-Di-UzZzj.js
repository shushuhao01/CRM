import{i as e,d as a,f as l,u as t,S as s,p as r,z as o,B as n,_ as i}from"./index-BGtT17ll.js";import{useDepartmentStore as d}from"./department-BMF6-9dP.js";import{a as u}from"./sensitiveInfo-PTigg6SS.js";import{userApiService as c}from"./userApiService-Cdjvhk7i.js";import{r as m}from"./roleApiService-BgDvTssF.js";import{u as p}from"./service-CQY3-CML.js";import{u as v}from"./data-B0qxgWDq.js";import{k as g,w as h,r as f}from"./utils-DfI7e5Rl.js";import{D as y}from"./DynamicTable-BXyvPHDr.js";import{C as w,e as b,G as _,B as k,z as I,al as N,t as S,F as U,r as V,d as x,u as C,A as $,H as A,j as E,K as T,w as z,af as P,aD as D,E as M,b as O}from"./elementPlus-DxaqjplL.js";import{l as B,r as L,Z as j,e as R,b as q,ag as F,m as K,q as J,p as Z,U as G,M as H,Q as Y,O as Q,S as W,u as X,T as ee,F as ae,a9 as le,I as te}from"./vendor-BtukhyiH.js";import"./env-DLalhsF6.js";import"./TableColumnSettings-CpY_V997.js";class se{static async syncUserData(e){console.log("开始同步用户数据:",e);try{await this.syncCustomerModule(e),await this.syncOrderModule(e),await this.syncPerformanceModule(e),await this.syncServiceModule(e),await this.syncDepartmentModule(e),await this.syncDataModule(e),console.log("用户数据同步完成:",e.id)}catch(a){throw console.error("用户数据同步失败:",a),a}}static async syncCustomerModule(a){e().customers.forEach(e=>{e.salesPersonId===a.id&&console.log(`更新客户 ${e.name} 的销售人员信息`),e.createdBy===a.id&&console.log(`更新客户 ${e.name} 的创建者信息`)})}static async syncOrderModule(e){a().orders.forEach(a=>{a.salesPersonId===e.id&&console.log(`更新订单 ${a.orderNumber} 的销售人员信息`),a.createdBy===e.id&&console.log(`更新订单 ${a.orderNumber} 的创建者信息`)})}static async syncPerformanceModule(e){const a=l();a.teamMembers.forEach(a=>{a.id===e.id&&(e.realName&&(a.name=e.realName),e.departmentName&&(a.department=e.departmentName),console.log(`更新团队成员 ${a.name} 的信息`))}),a.performanceShares.forEach(a=>{a.createdById===e.id&&(e.realName&&(a.createdBy=e.realName),console.log(`更新业绩分享 ${a.id} 的创建者信息`)),a.shareMembers.forEach(a=>{a.userId===e.id&&(e.realName&&(a.userName=e.realName),console.log(`更新业绩分享成员 ${a.userName} 的信息`))})})}static async syncServiceModule(e){p().services.forEach(a=>{a.createdBy===e.id&&console.log(`更新服务记录 ${a.id} 的创建者信息`),a.assignedTo===e.id&&console.log(`更新服务记录 ${a.id} 的分配者信息`)})}static async syncDepartmentModule(e){const a=d();a.departmentMembers.forEach(a=>{a.userId===e.id&&(e.realName&&(a.userName=e.realName),e.departmentId&&(a.departmentId=e.departmentId),console.log(`更新部门成员 ${a.userName} 的信息`))}),a.roleUsers.forEach(a=>{a.userId===e.id&&(e.realName&&(a.userName=e.realName),console.log(`更新角色用户 ${a.userName} 的信息`))})}static async syncDataModule(e){v(),console.log("同步数据模块中的用户信息")}static async batchSyncUserData(e){console.log("开始批量同步用户数据:",e.length,"个用户");for(const a of e)await this.syncUserData(a);console.log("批量用户数据同步完成")}static async cleanupUserData(t){console.log("开始清理用户关联数据:",t);try{const s=e(),r=a(),o=l(),n=p(),i=d();s.customers.forEach(e=>{e.salesPersonId===t&&(e.salesPersonId=""),e.createdBy===t&&(e.createdBy="deleted_user")}),r.orders.forEach(e=>{e.salesPersonId===t&&(e.salesPersonId=""),e.createdBy===t&&(e.createdBy="deleted_user")}),o.teamMembers=o.teamMembers.filter(e=>e.id!==t),o.performanceShares.forEach(e=>{e.createdById===t&&(e.createdBy="deleted_user",e.createdById="deleted_user"),e.shareMembers=e.shareMembers.filter(e=>e.userId!==t)}),n.services.forEach(e=>{e.createdBy===t&&(e.createdBy="deleted_user"),e.assignedTo===t&&(e.assignedTo="")}),i.departmentMembers=i.departmentMembers.filter(e=>e.userId!==t),i.roleUsers=i.roleUsers.filter(e=>e.userId!==t),console.log("用户关联数据清理完成:",t)}catch(s){throw console.error("清理用户关联数据失败:",s),s}}static async batchCleanupUserData(e){console.log("开始批量清理用户关联数据:",e);try{await Promise.all(e.map(e=>this.cleanupUserData(e))),console.log("批量清理用户关联数据完成")}catch(a){throw console.error("批量清理用户关联数据失败:",a),a}}}const re={class:"user-management"},oe={class:"page-header"},ne={class:"header-actions"},ie={class:"stats-section"},de={class:"stat-content"},ue={class:"stat-icon primary-icon"},ce={class:"stat-info"},me={class:"stat-number primary-number"},pe={class:"stat-content"},ve={class:"stat-icon success-icon"},ge={class:"stat-info"},he={class:"stat-number success-number"},fe={class:"stat-content"},ye={class:"stat-icon warning-icon"},we={class:"stat-info"},be={class:"stat-number warning-number"},_e={class:"stat-content"},ke={class:"stat-icon info-icon"},Ie={class:"stat-info"},Ne={class:"stat-number info-number"},Se={class:"table-section"},Ue={class:"batch-actions"},Ve={key:1,class:"text-gray-400"},xe={class:"dialog-footer"},Ce={key:0,class:"user-detail"},$e={key:1,class:"text-gray-400"},Ae={key:0,class:"permission-setting"},Ee={class:"user-info"},Te={class:"permission-content"},ze={key:0},Pe={key:1},De={class:"role-permissions"},Me={class:"permission-note"},Oe={class:"personal-permissions"},Be={class:"permission-note"},Le={key:0},je={key:1},Re={class:"permission-actions"},qe={key:0,class:"logs-content"},Fe={class:"logs-header"},Ke={class:"user-info"},Je={class:"logs-actions"},Ze={class:"logs-pagination"},Ge={class:"batch-import-container"},He={key:0,class:"import-step"},Ye={class:"step-content"},Qe={key:1,class:"import-step"},We={class:"step-content"},Xe={key:2,class:"import-step"},ea={class:"step-content"},aa={class:"upload-area"},la={key:0,class:"file-info"},ta={key:3,class:"import-step"},sa={class:"step-content"},ra={class:"preview-info"},oa={class:"preview-table"},na={key:0},ia={key:0,class:"error-container"},da={class:"error-text"},ua={key:1,class:"success-container"},ca={class:"validation-summary"},ma={class:"summary-item valid"},pa={class:"summary-number"},va={class:"summary-item invalid"},ga={class:"summary-number"},ha={class:"dialog-footer"},fa={class:"footer-left"},ya={key:0},wa={class:"footer-right"},ba=i(B({__name:"User",setup(e){const a=t(),l=d(),i=L(!1),p=L(!1),v=L(!1),B=L(!1),ba=L(!1),_a=L([]),ka=L(null),Ia=L({total:0,active:0,resigned:0,monthNew:0}),Na=j({username:"",realName:"",roleId:"",departmentId:"",status:"",createTimeRange:[]}),Sa=j({id:"",username:"",realName:"",email:"",phone:"",roleId:"",departmentId:"",position:"",employeeNumber:"",status:"active",password:"",remark:""}),Ua=L([]),Va=L([]),xa=j({page:1,size:20,total:0}),Ca={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],roleId:[{required:!0,message:"请选择角色",trigger:"change"}],departmentId:[{required:!0,message:"请选择部门",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},$a=L(),Aa=L(!1),Ea=L(0),Ta=L(),za=L(null),Pa=L(!1),Da=L(!1),Ma=L([]),Oa=L([]),Ba=L([]),La=L(!1),ja=L(!1),Ra=L("role"),qa=L([]),Fa=L([]),Ka=L(null),Ja=L([]),Za=L([]),Ga=L(null),Ha=L(!1),Ya=L(!1),Qa=L([]),Wa=L([]),Xa=j({page:1,size:20,total:0}),el=R(()=>ba.value?"编辑用户":"新增用户"),al=R(()=>a.isAdmin||a.isManager),ll=R(()=>a.isAdmin||a.isManager),tl=R(()=>a.isAdmin),sl=R(()=>a.isAdmin||a.isManager),rl=R(()=>a.isAdmin),ol=R(()=>a.isAdmin||a.isManager),nl=R(()=>a.isAdmin||a.isManager),il=R(()=>{try{return["总经理","副总经理","部门经理","主管","组长","专员","助理","秘书","销售经理","销售专员","客服主管","客服专员","财务经理","会计","出纳","物流主管","物流专员","审核员","质检员"]}catch(e){return console.error("获取职位列表失败:",e),["总经理","副总经理","部门经理","主管","组长","专员","助理","秘书"]}}),dl=R(()=>[{prop:"enableStatus",label:"启用状态",width:100,visible:!0,slot:!0,align:"center"},{prop:"employmentStatus",label:"在职状态",width:90,visible:!0,slot:!0,align:"center"},{prop:"avatar",label:"头像",width:80,visible:!0,slot:!0},{prop:"username",label:"用户名",width:120,visible:!0,sortable:!0},{prop:"realName",label:"姓名",width:100,visible:!0,sortable:!0},{prop:"role",label:"角色",width:120,visible:!0,slot:!0},{prop:"department",label:"部门",width:120,visible:!0,slot:!0},{prop:"employeeNumber",label:"工号",width:120,visible:!0},{prop:"position",label:"职位",width:120,visible:!0},{prop:"email",label:"邮箱",width:180,visible:!0,showOverflowTooltip:!0},{prop:"phone",label:"手机号",width:120,visible:!0,slot:!0},{prop:"isOnline",label:"在线状态",width:100,visible:!0,slot:!0},{prop:"lastLoginTime",label:"最后登录",width:160,visible:!0,sortable:!0},{prop:"createTime",label:"创建时间",width:160,visible:!0,sortable:!0}]),ul=e=>{if(!e)return"未知";const a=Va.value.find(a=>a.id===e||a.code===e||String(a.id)===String(e));return a?.name||"未知"},cl=e=>{if(!e)return;const a=Va.value.find(a=>a.code===e);a&&(console.log(`角色变更为: ${a.name} (${a.code})`),La.value&&ka.value&&(ka.value.role=a.code,ka.value.roleId=e,Promise.all([hl(e),fl(),yl(ka.value.id)]).then(()=>{console.log("权限数据已根据新角色重新加载"),M.success(`已切换到${a.name}角色的预设权限`)}).catch(e=>{console.error("重新加载权限数据失败:",e)})))},ml=e=>{if(!e)return"";const a=Va.value.find(a=>a.id===e||a.code===e||String(a.id)===String(e));return a?.color||""},pl=()=>{ba.value=!1,jl(),v.value=!0},vl=async e=>{ka.value=e,Ra.value="role";try{await Promise.all([hl(e.roleId),fl(),yl(e.id)]),La.value=!0,setTimeout(()=>{if(console.log("[User] 设置角色权限树选中状态"),console.log("[User] 角色权限数量:",Fa.value.length),console.log("[User] 角色权限列表:",Fa.value),Ka.value&&Fa.value.length>0)try{Ka.value.setCheckedKeys(Fa.value),console.log("[User] ✅ 角色权限树选中状态设置成功");const e=Ka.value.getCheckedKeys();console.log("[User] ✅ 验证选中结果:",e)}catch(e){console.error("[User] ❌ 设置角色权限树选中状态失败:",e)}else console.warn("[User] ⚠️ 角色权限树引用未找到或权限列表为空")},500)}catch(a){console.error("[User] 加载权限数据失败:",a),M.error("加载权限数据失败")}},gl=async e=>{ka.value=e,Wa.value=[],Xa.page=1,Xa.size=20;try{await bl(e.id),Ha.value=!0}catch(a){console.error("加载操作日志失败:",a),M.error("加载操作日志失败")}},hl=async e=>{try{console.log("[User] 加载角色权限:",e);const a=o.getAllPermissions(),l=o.getRoleDefaultPermissions(e);console.log("[User] 角色默认权限:",l),qa.value=a,Fa.value=l,console.log("[User] 角色权限加载成功,权限数:",l.length)}catch(a){console.error("[User] 加载角色权限失败:",a);const e=o.getAllPermissions();qa.value=e,Fa.value=[]}},fl=async()=>{try{const e=o.getAllPermissions();if(ka.value&&ka.value.role){const a=o.getRoleDefaultPermissions(ka.value.role);Ja.value=wl(e,a)}else Ja.value=e;console.log("个人权限选项加载成功")}catch(e){console.error("加载个人权限选项失败:",e);const a=o.getAllPermissions();Ja.value=a}},yl=async e=>{try{const a=await o.getUserPersonalPermissions(parseInt(e));Za.value=a.permissions.map(e=>e.id),console.log("用户个人权限加载成功:",e)}catch(a){console.error("加载用户个人权限失败:",a);const l=users.value.find(a=>a.id===parseInt(e));if(l&&l.role){const e=o.getRoleDefaultPermissions(l.role);Za.value=e,console.log(`为角色 ${l.role} 设置预设权限:`,e)}else Za.value=[]}},wl=(e,a)=>{if(!e||!Array.isArray(e))return[];const l=e=>{const t=a.includes(e.id),s={...e,disabled:t};return e.children&&e.children.length>0&&(s.children=e.children.map(l)),s};return e.map(l)},bl=async e=>{Ya.value=!0;try{const a=await n.getUserOperationLogs(parseInt(e),{page:Xa.page,pageSize:Xa.size,startDate:Wa.value?.[0],endDate:Wa.value?.[1]});Qa.value=a.data.map(e=>({time:e.createdAt,action:e.action,module:e.module,description:e.description,ip:e.ip,userAgent:e.userAgent,result:"success"})),Xa.total=a.total,console.log("用户操作日志加载成功:",e)}catch(a){console.error("加载操作日志失败:",a);const e=[{time:"2024-01-15 14:30:25",action:"login",module:"系统登录",description:"用户登录系统",ip:"192.168.1.100",userAgent:"Chrome 120.0.0.0",result:"success"},{time:"2024-01-15 14:25:10",action:"create",module:"客户管理",description:"新增客户：张三",ip:"192.168.1.100",userAgent:"Chrome 120.0.0.0",result:"success"},{time:"2024-01-15 14:20:05",action:"update",module:"订单管理",description:"修改订单：ORD20240115001",ip:"192.168.1.100",userAgent:"Chrome 120.0.0.0",result:"success"},{time:"2024-01-15 14:15:30",action:"delete",module:"产品管理",description:"删除产品：PRD001",ip:"192.168.1.100",userAgent:"Chrome 120.0.0.0",result:"failed"}];Qa.value=e,Xa.total=e.length}finally{Ya.value=!1}},_l=(e,l)=>{if(!a.isSuperAdmin)return void M.warning("只有超级管理员可以修改个人权限设置");console.log("权限选择变化:",e,l);const t=l.checkedKeys||[],s=l.halfCheckedKeys||[];if(ka.value&&ka.value.role){o.getRoleDefaultPermissions(ka.value.role).filter(e=>!t.includes(e)&&!s.includes(e)).length>0&&(M.warning("不能移除角色默认权限，这些权限将自动保留"),setTimeout(()=>{yl(ka.value.id)},100))}Za.value=[...t]},kl=()=>{if(a.isSuperAdmin){if(ka.value){const e=o.getRoleDefaultPermissions(ka.value.role);Za.value=[...e],M.success("权限已重置为角色默认权限"),console.log(`用户 ${ka.value.realName} 权限已重置为角色 ${ka.value.role} 的默认权限`)}}else M.warning("只有超级管理员可以修改个人权限设置")},Il=async()=>{if(ka.value)if(a.isSuperAdmin){ja.value=!0;try{const e=document.querySelector(".personal-permissions .el-tree")?.getCheckedKeys()||[],a=o.getRoleDefaultPermissions(ka.value.role),l=[...new Set([...a,...e])];await o.saveUserPersonalPermissions(parseInt(ka.value.id),l),M.success("权限保存成功"),La.value=!1,console.log("用户权限保存成功:",ka.value.id,"最终权限:",l),await loadUsers()}catch(e){console.error("保存权限失败:",e),M.error("保存权限失败")}finally{ja.value=!1}}else M.warning("只有超级管理员可以修改个人权限设置")},Nl=e=>({login:"登录",logout:"登出",create:"新增",update:"修改",delete:"删除",view:"查看"}[e]||e),Sl=e=>{ka.value&&bl(ka.value.id)},Ul=()=>{ka.value&&bl(ka.value.id)},Vl=async()=>{if(ka.value)try{M.info("正在导出日志，请稍候...");const e=await n.exportUserOperationLogs(parseInt(ka.value.id),{startDate:Wa.value?.[0],endDate:Wa.value?.[1],format:"excel"}),a=window.URL.createObjectURL(e),l=document.createElement("a");l.href=a,l.download=`用户操作日志_${ka.value.username}_${(new Date).toISOString().split("T")[0]}.xlsx`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(a),M.success("日志导出成功"),console.log("用户操作日志导出成功:",ka.value.id)}catch(e){console.error("导出日志失败:",e),M.error("导出日志失败，请稍后重试")}},xl=e=>{Xa.size=e,ka.value&&bl(ka.value.id)},Cl=e=>{Xa.page=e,ka.value&&bl(ka.value.id)},$l=async e=>{const a=e.realName||e.name||e.username||"该用户";try{await O.confirm(`确定要删除用户"${a}"吗？删除后不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),console.log("[User] 开始删除用户:",e.id,a),console.log("[User] 生产环境：应通过API删除用户"),M.success("删除成功"),await ql(),console.log("[User] 用户列表已重新加载")}catch(l){"cancel"!==l&&(console.error("[User] 删除用户失败:",l),M.error("删除失败"))}},Al=async()=>{if(_a.value&&0!==_a.value.length)try{await O.confirm(`确定要删除选中的 ${_a.value.length} 个用户吗？删除后不可恢复！`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=_a.value.map(e=>e.id);try{await c.batchDeleteUsers(a),await se.batchCleanupUserData(a.map(e=>e.toString())),M.success("批量删除成功")}catch(e){return console.error("批量删除用户失败:",e),void M.error("批量删除用户失败，请稍后重试")}_a.value=[],await ql()}catch(a){}else M.warning("请先选择要删除的用户")},El=async e=>{if(!_a.value||0===_a.value.length)return void M.warning("请先选择要操作的用户");const a="active"===e?"启用":"禁用";try{await O.confirm(`确定要${a}选中的 ${_a.value.length} 个用户吗？`,`确认批量${a}`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=_a.value.map(e=>e.id);try{await c.batchUpdateUserStatus(t,e),M.success(`批量${a}成功`)}catch(l){return console.error("批量更新用户状态失败:",l),void M.error(`批量${a}失败，请稍后重试`)}_a.value=[],await ql()}catch(t){}},Tl=async()=>{try{M.info("正在导出用户数据...");const e=Ua.value.map(e=>({"用户名":e.username,"姓名":e.realName,"工号":e.employeeNumber||"","邮箱":e.email,"手机号":e.phone,"部门":e.departmentName||"未分配","职位":e.position||"","角色":e.roleName,"账号状态":"active"===e.status?"启用":"禁用","在职状态":"active"===(e.employmentStatus||"active")?"在职":"离职","离职日期":e.resignedDate||"","在线状态":e.isOnline?"在线":"离线","最后登录时间":e.lastLoginTime||"从未登录","登录次数":e.loginCount||0,"创建时间":e.createTime,"备注":e.remark||""})),a=g.json_to_sheet(e),l=g.book_new();g.book_append_sheet(l,a,"用户列表");const t=[{wch:15},{wch:12},{wch:12},{wch:25},{wch:15},{wch:15},{wch:12},{wch:12},{wch:10},{wch:10},{wch:12},{wch:10},{wch:20},{wch:10},{wch:20},{wch:20}];a["!cols"]=t;const s=(new Date).toISOString().slice(0,19).replace(/[:-]/g,"").replace("T","_");h(l,`用户列表_${s}.xlsx`),M.success("用户数据导出成功")}catch(e){console.error("导出失败:",e),M.error("导出失败，请稍后重试")}},zl=()=>{xa.page=1,ql()},Pl=()=>{Object.assign(Na,{username:"",realName:"",roleId:"",departmentId:"",status:"",createTimeRange:[]}),zl()},Dl=e=>{_a.value=e},Ml=e=>{xa.size=e,ql()},Ol=e=>{xa.page=e,ql()},Bl=async()=>{try{if(await($a.value?.validate()),p.value=!0,ba.value){const a=Sa.roleId,l={realName:Sa.realName,name:Sa.realName,email:Sa.email,phone:Sa.phone,roleId:a,role:a,departmentId:Sa.departmentId,position:Sa.position,employeeNumber:Sa.employeeNumber,status:Sa.status,remark:Sa.remark};console.log("[User] 更新用户数据:",l);try{console.log("[User] 调用API更新用户，ID:",Sa.id),await c.updateUser(Sa.id,l),console.log("[User] 用户更新API调用成功"),M.success("用户更新成功")}catch(e){return console.error("[User] 更新用户失败:",e),M.error("更新失败"),void(p.value=!1)}}else{const a=l.departmentList.find(e=>e.id===Sa.departmentId),t=Sa.roleId,s={username:Sa.username,password:Sa.password,realName:Sa.realName,name:Sa.realName,email:Sa.email,phone:Sa.phone,role:t,roleId:t,departmentId:Sa.departmentId,department:a?.name||"",position:Sa.position,employeeNumber:Sa.employeeNumber,status:Sa.status,employmentStatus:"active",remark:Sa.remark,createTime:(new Date).toLocaleString(),isOnline:!1,lastLoginTime:null,loginCount:0};console.log("[User] 创建用户数据:",s);try{await c.createUser(s),console.log("[User] 用户创建API调用成功"),M.success("用户创建成功"),Sa.departmentId&&await(async a=>{try{console.log("[用户管理] 更新部门成员数，部门ID:",a);const e=localStorage.getItem("users");if(!e)return;const s=JSON.parse(e),r=new Map;s.forEach(e=>{const a=e.departmentId;a&&r.set(a,(r.get(a)||0)+1)});const o=["departments","department-store","crm_store_department"];for(const a of o){const e=localStorage.getItem(a);if(e)try{const t=JSON.parse(e),s=t.departments||t.data?.departments||(Array.isArray(t)?t:[]);if(s.length>0){s.forEach(e=>{e.memberCount=r.get(e.id)||0}),Array.isArray(t)?localStorage.setItem(a,JSON.stringify(s)):t.departments?(t.departments=s,localStorage.setItem(a,JSON.stringify(t))):t.data?.departments&&(t.data.departments=s,localStorage.setItem(a,JSON.stringify(t))),console.log("[用户管理] 部门成员数已更新"),await l.loadDepartments();break}}catch(t){console.error(`[用户管理] 更新${a}失败:`,t)}}}catch(e){console.error("[用户管理] 更新部门成员数失败:",e)}})(Sa.departmentId)}catch(e){return console.error("[User] 创建用户失败:",e),M.error("创建用户失败，请检查输入信息"),void(p.value=!1)}}await ql(),console.log("[User] 用户列表已刷新,新用户应该可见"),Ll()}catch(e){console.error("表单验证失败:",e)}finally{p.value=!1}},Ll=()=>{v.value=!1,$a.value?.clearValidate(),jl()},jl=()=>{Object.assign(Sa,{id:"",username:"",realName:"",email:"",phone:"",roleId:"",departmentId:"",position:"",employeeNumber:"",status:"active",password:"123456",remark:""})},Rl=async()=>{try{throw new Error("使用本地计算")}catch(e){const a=new Date,l=a.getMonth(),t=a.getFullYear(),s=Ua.value.length,r=Ua.value.filter(e=>"active"===(e.employmentStatus||"active")).length,o=Ua.value.filter(e=>"resigned"===e.employmentStatus).length,n=Ua.value.filter(e=>{if(!e.createTime)return!1;const a=new Date(e.createTime);return a.getMonth()===l&&a.getFullYear()===t}).length;Ia.value={total:s,active:r,resigned:o,monthNew:n}}},ql=async()=>{try{i.value=!0;let a=[];console.log("[User] 生产环境：调用API获取用户数据");try{const e=await c.getUsers({page:xa.page,limit:xa.size});a=e.data||[],xa.total=e.total||a.length,console.log("[User] 生产环境：API返回用户数量:",a.length)}catch(e){console.error("[User] 生产环境：API获取用户失败:",e),a=[]}const t={data:a,total:xa.total||a.length},s=t.data.map(e=>{const a=l.getDepartmentById(e.departmentId),t=e.username||"user_"+e.id,s=e.realName||e.name||t;return{id:e.id.toString(),username:t,realName:s,name:s,email:e.email||"",phone:e.phone||"",roleId:e.role||e.roleId||"",role:e.role||e.roleId||"",departmentId:e.departmentId?.toString()||"",departmentName:e.department?.name||a?.name||"",position:e.position||e.roleName||"",employeeNumber:e.employeeNumber||"",status:e.status||"active",employmentStatus:e.employmentStatus||"active",resignedDate:e.resignedDate||"",createTime:e.createTime||e.createdAt||"",lastLoginTime:e.lastLoginTime||e.lastLoginAt||"",avatar:e.avatar||"",remark:e.remark||"",roleName:e.roleName||"",isOnline:e.isOnline||!1,loginCount:e.loginCount||0,statusLoading:!1,employmentStatusLoading:!1}});s.sort((e,a)=>{const l=new Date(e.createTime||0).getTime();return new Date(a.createTime||0).getTime()-l}),Ua.value=s,xa.total=t.total,await Rl()}catch(a){console.error("加载用户列表失败:",a),M.error("加载用户列表失败，请检查网络连接"),Ua.value=[],xa.total=0}finally{i.value=!1}},Fl=()=>{Aa.value=!0,Ea.value=0,Kl()},Kl=()=>{za.value=null,Ma.value=[],Oa.value=[],Ba.value=[],Pa.value=!1,Da.value=!1},Jl=e=>e.includes("用户名不能为空")?"请在Excel中填写用户名，建议使用字母、数字和下划线组合":e.includes("用户名长度应在3-20个字符之间")?"用户名长度需要在3-20个字符之间，请调整用户名长度":e.includes("用户名只能包含字母、数字和下划线")?"用户名格式错误，只能使用a-z、A-Z、0-9和下划线(_)，不能包含空格或特殊字符":e.includes("用户名已存在于系统中")?"该用户名已被使用，请更换一个新的用户名":e.includes("用户名在导入数据中重复")?"在Excel中发现重复的用户名，请检查并修改重复的行":e.includes("姓名不能为空")?"请在Excel中填写真实姓名":e.includes("姓名长度不能超过50个字符")?"姓名过长，请缩短至50个字符以内":e.includes("姓名只能包含中文、英文字母和空格")?"姓名格式错误，只能包含中文、英文字母和空格，不能包含数字或特殊字符":e.includes("邮箱不能为空")?"请在Excel中填写邮箱地址":e.includes("邮箱格式不正确")?"邮箱格式错误，请使用正确格式，如：zhangsan@example.com":e.includes("邮箱已存在于系统中")?"该邮箱已被使用，请更换一个新的邮箱地址":e.includes("邮箱在导入数据中重复")?"在Excel中发现重复的邮箱，请检查并修改重复的行":e.includes("手机号不能为空")?"请在Excel中填写手机号码":e.includes("手机号格式不正确")?"手机号格式错误，请输入11位中国大陆手机号，如：13812345678":e.includes("手机号已存在于系统中")?"该手机号已被使用，请更换一个新的手机号":e.includes("手机号在导入数据中重复")?"在Excel中发现重复的手机号，请检查并修改重复的行":e.includes("角色不能为空")?"请在Excel中选择用户角色":e.includes("角色")&&e.includes("不存在")?"角色名称错误，请使用系统中已存在的角色名称":e.includes("部门")&&e.includes("不存在")?"部门名称错误，请使用系统中已存在的部门名称，或留空使用默认部门":e.includes("密码长度不能少于6位")?"密码太短，请设置至少6位密码，或留空使用默认密码123456":e.includes("密码长度不能超过20位")?"密码太长，请设置不超过20位的密码":e.includes("备注长度不能超过200个字符")?"备注内容过长，请缩短至200个字符以内":"",Zl=()=>{Ea.value<3&&Ea.value++},Gl=()=>{Ea.value>0&&Ea.value--},Hl=()=>{const e=g.aoa_to_sheet([["用户名","姓名","邮箱","手机号","角色","部门","职位","工号","密码","备注"],["zhangsan","张三","zhangsan@example.com","13800138001","销售员","销售部","销售专员","EMP0001","123456","示例用户1"],["lisi","李四","lisi@example.com","13800138002","客服","客服部","客服专员","EMP0002","123456","示例用户2"]]),a=g.book_new();g.book_append_sheet(a,e,"用户导入模板");e["!cols"]=[{wch:15},{wch:12},{wch:25},{wch:15},{wch:12},{wch:12},{wch:15},{wch:12},{wch:12},{wch:20}],h(a,"用户导入模板.xlsx"),M.success("模板下载成功")},Yl=e=>{za.value=e.raw},Ql=e=>{const a="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type||"application/vnd.ms-excel"===e.type,l=e.size/1024/1024<10;return a?(l||M.error("文件大小不能超过10MB!"),!1):(M.error("只能上传Excel文件!"),!1)},Wl=()=>{M.warning("只能上传一个文件")},Xl=async()=>{if(za.value){Pa.value=!0;try{const e=new FileReader;e.onload=e=>{try{const a=new Uint8Array(e.target?.result),l=f(a,{type:"array",cellDates:!0,cellNF:!1,cellText:!1});if(!l.SheetNames||0===l.SheetNames.length)throw new Error("Excel文件中没有找到工作表");const t=l.SheetNames[0],s=l.Sheets[t];if(!s)throw new Error("无法读取工作表内容");const r=g.sheet_to_json(s,{header:1,defval:"",blankrows:!1});if(!r||r.length<2)throw new Error("Excel文件内容为空或格式不正确，请确保至少有标题行和一行数据");const o=r[0],n=["用户名","姓名","邮箱","手机号","角色","部门","密码","备注"];if(!n.every((e,a)=>{const l=o[a];return l&&l.toString().trim()===e}))throw new Error(`Excel文件标题行不正确。期望的标题行为：${n.join("、")}`);const i=r.slice(1);if(0===i.length)throw new Error("Excel文件中没有数据行");const d=i.filter(e=>e&&e.some(e=>null!=e&&""!==e.toString().trim())).map((e,a)=>({rowIndex:a+2,username:(e[0]||"").toString().trim(),realName:(e[1]||"").toString().trim(),email:(e[2]||"").toString().trim(),phone:(e[3]||"").toString().trim(),role:(e[4]||"").toString().trim(),department:(e[5]||"").toString().trim(),position:(e[6]||"").toString().trim(),employeeNumber:(e[7]||"").toString().trim(),password:(e[8]||"").toString().trim(),remark:(e[9]||"").toString().trim(),errors:[]}));if(0===d.length)throw new Error("Excel文件中没有有效的数据行");et(d),M.success(`解析完成，共${d.length}条数据`),Zl()}catch(a){console.error("Excel解析错误:",a),M.error(a.message||"文件解析失败，请检查文件格式")}finally{Pa.value=!1}},e.onerror=()=>{M.error("文件读取失败，请重新选择文件"),Pa.value=!1},e.readAsArrayBuffer(za.value)}catch(e){console.error("文件读取错误:",e),M.error("文件读取失败，请重新选择文件"),Pa.value=!1}}else M.error("请先选择文件")},et=e=>{const a=[],t=[],s=new Map,r=new Set(Ua.value.map(e=>e.username)),o=new Set(Ua.value.map(e=>e.email)),n=new Set(Ua.value.map(e=>e.phone));e.forEach((e,i)=>{const d=[];if(e.username.trim()?e.username.length<3||e.username.length>20?d.push("用户名长度应在3-20个字符之间"):/^[a-zA-Z0-9_]+$/.test(e.username)?r.has(e.username)?d.push("用户名已存在于系统中"):s.has(`username:${e.username}`)?d.push(`用户名在导入数据中重复（第${s.get(`username:${e.username}`)}行）`):s.set(`username:${e.username}`,i+1):d.push("用户名只能包含字母、数字和下划线"):d.push("用户名不能为空"),e.realName.trim()?e.realName.length>50?d.push("姓名长度不能超过50个字符"):/^[\u4e00-\u9fa5a-zA-Z\s]+$/.test(e.realName)||d.push("姓名只能包含中文、英文字母和空格"):d.push("姓名不能为空"),e.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)?o.has(e.email)?d.push("邮箱已存在于系统中"):s.has(`email:${e.email}`)?d.push(`邮箱在导入数据中重复（第${s.get(`email:${e.email}`)}行）`):s.set(`email:${e.email}`,i+1):d.push("邮箱格式不正确，请检查格式（如：user@example.com）"):d.push("邮箱不能为空"),e.phone.trim()?/^1[3-9]\d{9}$/.test(e.phone)?n.has(e.phone)?d.push("手机号已存在于系统中"):s.has(`phone:${e.phone}`)?d.push(`手机号在导入数据中重复（第${s.get(`phone:${e.phone}`)}行）`):s.set(`phone:${e.phone}`,i+1):d.push("手机号格式不正确，请输入11位有效的中国大陆手机号"):d.push("手机号不能为空"),e.role.trim()){if(Va.value&&Va.value.some(a=>a.name===e.role||a.code===e.role)){const a=Va.value.find(a=>a.name===e.role||a.code===e.role);e.roleId=a?.code,e.role=a?.code}else{const a=Va.value&&Va.value.length>0?Va.value.map(e=>`${e.name}(${e.code})`).join("、"):"暂无可用角色";d.push(`角色"${e.role}"不存在。可选角色：${a}`)}}else d.push("角色不能为空");if(e.department&&e.department.trim()){if(l.departmentList.some(a=>a.name===e.department)){const a=l.departmentList.find(a=>a.name===e.department);e.departmentId=a?.id}else d.push(`部门"${e.department}"不存在。可选部门：${l.departmentList.map(e=>e.name).join("、")}`)}e.password.trim()?e.password.length<6?d.push("密码长度不能少于6位"):e.password.length>20?d.push("密码长度不能超过20位"):e.needChangePassword=!1:(e.password="123456",e.needChangePassword=!0),e.remark&&e.remark.length>200&&d.push("备注长度不能超过200个字符"),e.errors=d,0===d.length?a.push(e):t.push(e)}),Ma.value=e,Oa.value=a,Ba.value=t,t.length>0?M.warning(`数据验证完成：${a.length}条有效，${t.length}条无效。请修复错误后重新导入。`):M.success(`数据验证通过：共${a.length}条有效数据`)},at=async()=>{if(0!==Oa.value.length){Da.value=!0;try{const e=Oa.value.map(e=>({username:e.username,password:e.password,realName:e.realName,email:e.email,phone:e.phone,role:e.roleId,departmentId:e.departmentId?parseInt(e.departmentId):void 0,position:e.position||"",employeeNumber:e.employeeNumber||""})),a=await c.importUsers(e);M.success(`导入成功：共${a.successCount||Oa.value.length}条用户数据`),Aa.value=!1,ql()}catch(e){console.error("导入失败:",e),M.error("导入失败，请检查数据格式或稍后重试")}finally{Da.value=!1}}else M.error("没有有效数据可导入")},lt=()=>{Aa.value=!1,Kl()},tt=({prop:e,order:a})=>{console.log("排序变化:",e,a)},st=e=>{console.log("列设置变化:",e)};return q(async()=>{try{Rl(),ql(),(async()=>{try{const e=await m.getRoles();Va.value=e.filter(e=>"active"===e.status),console.log("角色数据加载成功:",Va.value.length)}catch(e){console.warn("加载角色数据失败，使用本地数据:",e);try{const e=JSON.parse(localStorage.getItem("crm_roles")||"[]");Va.value=e.filter(e=>"active"===e.status),console.log("从localStorage加载角色数据:",Va.value.length)}catch(a){console.error("从localStorage加载角色数据也失败:",a)}}})(),await l.initData()}catch(e){console.error("初始化数据失败:",e)}}),(e,t)=>{const o=F("el-button"),n=F("el-icon"),d=F("el-card"),m=F("el-col"),g=F("el-row"),h=F("el-input"),f=F("el-form-item"),L=F("el-option"),j=F("el-select"),R=F("el-date-picker"),q=F("el-form"),se=F("el-switch"),hl=F("el-tooltip"),fl=F("el-avatar"),yl=F("el-tag"),wl=F("el-dropdown-item"),bl=F("el-dropdown-menu"),jl=F("el-dropdown"),Kl=F("el-radio"),et=F("el-radio-group"),rt=F("el-dialog"),ot=F("el-descriptions-item"),nt=F("el-descriptions"),it=F("el-divider"),dt=F("el-alert"),ut=F("el-tree"),ct=F("el-tab-pane"),mt=F("el-tabs"),pt=F("el-table-column"),vt=F("el-table"),gt=F("el-pagination"),ht=F("el-step"),ft=F("el-steps"),yt=F("el-upload");return J(),K("div",re,[Z("div",oe,[t[31]||(t[31]=Z("div",{class:"header-left"},[Z("h2",null,"用户管理")],-1)),Z("div",ne,[al.value?(J(),H(o,{key:0,onClick:pl,type:"primary",icon:X(w)},{default:Q(()=>[...t[28]||(t[28]=[W(" 新增用户 ",-1)])]),_:1},8,["icon"])):Y("",!0),al.value?(J(),H(o,{key:1,onClick:Fl,type:"success",icon:X(b)},{default:Q(()=>[...t[29]||(t[29]=[W(" 批量导入 ",-1)])]),_:1},8,["icon"])):Y("",!0),G(o,{onClick:Tl,icon:X(_)},{default:Q(()=>[...t[30]||(t[30]=[W(" 导出用户 ",-1)])]),_:1},8,["icon"])])]),Z("div",ie,[G(g,{gutter:20},{default:Q(()=>[G(m,{span:6},{default:Q(()=>[G(d,{class:"stat-card"},{default:Q(()=>[Z("div",de,[Z("div",ue,[G(n,null,{default:Q(()=>[G(X(k))]),_:1})]),Z("div",ce,[Z("div",me,ee(Ia.value.total),1),t[32]||(t[32]=Z("div",{class:"stat-title"},"总用户数",-1)),t[33]||(t[33]=Z("div",{class:"stat-desc"},"系统中的用户总数量",-1))])])]),_:1})]),_:1}),G(m,{span:6},{default:Q(()=>[G(d,{class:"stat-card"},{default:Q(()=>[Z("div",pe,[Z("div",ve,[G(n,null,{default:Q(()=>[G(X(I))]),_:1})]),Z("div",ge,[Z("div",he,ee(Ia.value.active),1),t[34]||(t[34]=Z("div",{class:"stat-title"},"在职人数",-1)),t[35]||(t[35]=Z("div",{class:"stat-desc"},"当前在职员工数量",-1))])])]),_:1})]),_:1}),G(m,{span:6},{default:Q(()=>[G(d,{class:"stat-card"},{default:Q(()=>[Z("div",fe,[Z("div",ye,[G(n,null,{default:Q(()=>[G(X(N))]),_:1})]),Z("div",we,[Z("div",be,ee(Ia.value.resigned),1),t[36]||(t[36]=Z("div",{class:"stat-title"},"离职人数",-1)),t[37]||(t[37]=Z("div",{class:"stat-desc"},"已离职员工数量",-1))])])]),_:1})]),_:1}),G(m,{span:6},{default:Q(()=>[G(d,{class:"stat-card"},{default:Q(()=>[Z("div",_e,[Z("div",ke,[G(n,null,{default:Q(()=>[G(X(S))]),_:1})]),Z("div",Ie,[Z("div",Ne,ee(Ia.value.monthNew),1),t[38]||(t[38]=Z("div",{class:"stat-title"},"本月新增",-1)),t[39]||(t[39]=Z("div",{class:"stat-desc"},"本月新增用户数量",-1))])])]),_:1})]),_:1})]),_:1})]),G(d,{class:"search-card"},{default:Q(()=>[G(q,{model:Na,inline:""},{default:Q(()=>[G(f,{label:"用户名"},{default:Q(()=>[G(h,{modelValue:Na.username,"onUpdate:modelValue":t[0]||(t[0]=e=>Na.username=e),placeholder:"请输入用户名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),G(f,{label:"姓名"},{default:Q(()=>[G(h,{modelValue:Na.realName,"onUpdate:modelValue":t[1]||(t[1]=e=>Na.realName=e),placeholder:"请输入姓名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),G(f,{label:"角色"},{default:Q(()=>[G(j,{modelValue:Na.roleId,"onUpdate:modelValue":t[2]||(t[2]=e=>Na.roleId=e),placeholder:"请选择角色",clearable:"",style:{width:"150px"}},{default:Q(()=>[(J(!0),K(ae,null,le(Va.value,e=>(J(),H(L,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),G(f,{label:"部门"},{default:Q(()=>[G(j,{modelValue:Na.departmentId,"onUpdate:modelValue":t[3]||(t[3]=e=>Na.departmentId=e),placeholder:"请选择部门",clearable:"",style:{width:"150px"}},{default:Q(()=>[(J(!0),K(ae,null,le(X(l).departmentList,e=>(J(),H(L,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),G(f,{label:"状态"},{default:Q(()=>[G(j,{modelValue:Na.status,"onUpdate:modelValue":t[4]||(t[4]=e=>Na.status=e),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:Q(()=>[G(L,{label:"启用",value:"active"}),G(L,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),G(f,{label:"创建时间"},{default:Q(()=>[G(R,{modelValue:Na.createTimeRange,"onUpdate:modelValue":t[5]||(t[5]=e=>Na.createTimeRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),G(f,null,{default:Q(()=>[G(o,{onClick:zl,type:"primary",icon:X(U)},{default:Q(()=>[...t[40]||(t[40]=[W(" 搜索 ",-1)])]),_:1},8,["icon"]),G(o,{onClick:Pl,icon:X(V)},{default:Q(()=>[...t[41]||(t[41]=[W(" 重置 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),Z("div",Se,[G(y,{data:Ua.value,columns:dl.value,loading:i.value,"storage-key":"user-management-columns",title:"用户列表","show-selection":!0,"show-pagination":!0,total:xa.total,onSelectionChange:Dl,onSortChange:tt,onSizeChange:Ml,onCurrentChange:Ol,onColumnSettingsChange:st},{"table-header-actions":Q(()=>[Z("div",Ue,[tl.value?(J(),H(o,{key:0,onClick:Al,disabled:!_a.value.length,type:"danger",size:"small",icon:X($)},{default:Q(()=>[...t[42]||(t[42]=[W(" 批量删除 ",-1)])]),_:1},8,["disabled","icon"])):Y("",!0),nl.value?(J(),H(o,{key:1,onClick:t[6]||(t[6]=e=>El("active")),disabled:!_a.value.length,size:"small",icon:X(A)},{default:Q(()=>[...t[43]||(t[43]=[W(" 批量启用 ",-1)])]),_:1},8,["disabled","icon"])):Y("",!0),nl.value?(J(),H(o,{key:2,onClick:t[7]||(t[7]=e=>El("inactive")),disabled:!_a.value.length,size:"small",icon:X(E)},{default:Q(()=>[...t[44]||(t[44]=[W(" 批量禁用 ",-1)])]),_:1},8,["disabled","icon"])):Y("",!0)])]),"column-enableStatus":Q(({row:e})=>[G(se,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,"active-value":"active","inactive-value":"inactive",loading:e.statusLoading,"before-change":()=>(async e=>{const a="active"===e.status?"inactive":"active",l="active"===a?"启用":"禁用";try{return e.statusLoading=!0,await c.updateUserStatus(e.id,a),M.success(`${l}用户成功`),await Rl(),!0}catch(t){return console.error("更新用户状态失败:",t),M.error(`${l}用户失败，请稍后重试`),!1}finally{e.statusLoading=!1}})(e)},null,8,["modelValue","onUpdate:modelValue","loading","before-change"])]),"column-employmentStatus":Q(({row:e})=>[G(hl,{content:"active"===e.employmentStatus?"当前：在职，点击设为离职":"当前：离职，点击设为在职",placement:"top"},{default:Q(()=>[G(se,{modelValue:e.employmentStatus,"onUpdate:modelValue":a=>e.employmentStatus=a,"active-value":"active","inactive-value":"resigned",loading:e.employmentStatusLoading,"before-change":()=>(async e=>{const a="active"===(e.employmentStatus||"active")?"resigned":"active",l="active"===a?"设为在职":"设为离职";try{return await O.confirm("resigned"===a?`确定要将用户 ${e.realName||e.username} 设为离职状态吗？离职后该账号将无法登录，但历史数据仍然可见。`:`确定要将用户 ${e.realName||e.username} 设为在职状态吗？`,`确认${l}`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),e.employmentStatusLoading=!0,await c.updateEmploymentStatus(e.id,a),e.resignedDate="resigned"===a?(new Date).toISOString().split("T")[0]:void 0,M.success(`${l}成功`),await Rl(),!0}catch(t){return"cancel"!==t&&(console.error("更新在职状态失败:",t),M.error(`${l}失败，请稍后重试`)),!1}finally{e.employmentStatusLoading=!1}})(e),class:"employment-status-switch"},null,8,["modelValue","onUpdate:modelValue","loading","before-change"])]),_:2},1032,["content"])]),"column-avatar":Q(({row:e})=>[G(fl,{src:e.avatar,size:40,style:te({backgroundColor:e.avatar?"transparent":"#409eff"})},{default:Q(()=>[e.avatar?Y("",!0):(J(),H(n,{key:0},{default:Q(()=>[G(X(C))]),_:1}))]),_:2},1032,["src","style"])]),"column-department":Q(({row:e})=>[e.departmentName?(J(),H(yl,{key:0,type:"info",size:"small"},{default:Q(()=>[W(ee(e.departmentName),1)]),_:2},1024)):(J(),K("span",Ve,"未分配"))]),"column-phone":Q(({row:e})=>[W(ee(X(u)(e.phone,"phone")),1)]),"column-role":Q(({row:e})=>[G(yl,{type:ml(e.roleId),size:"small"},{default:Q(()=>[W(ee(ul(e.roleId)),1)]),_:2},1032,["type"])]),"column-isOnline":Q(({row:e})=>[G(yl,{type:e.isOnline?"success":"info",size:"small"},{default:Q(()=>[W(ee(e.isOnline?"在线":"离线"),1)]),_:2},1032,["type"])]),"table-actions":Q(({row:e})=>[G(o,{onClick:a=>(e=>{ka.value=e,B.value=!0})(e),type:"primary",size:"small",link:""},{default:Q(()=>[...t[45]||(t[45]=[W(" 查看 ",-1)])]),_:1},8,["onClick"]),ll.value?(J(),H(o,{key:0,onClick:a=>(e=>{console.log("[User] 编辑用户:",e),ba.value=!0,Object.assign(Sa,{id:e.id,username:e.username||e.name||"",realName:e.realName||e.name||e.username||"",email:e.email||"",phone:e.phone||"",roleId:e.roleId||e.role||"",departmentId:e.departmentId||"",position:e.position||"",employeeNumber:e.employeeNumber||"",status:e.status||"active",remark:e.remark||""}),console.log("[User] 编辑表单数据:",Sa),v.value=!0})(e),type:"primary",size:"small",link:""},{default:Q(()=>[...t[46]||(t[46]=[W(" 编辑 ",-1)])]),_:1},8,["onClick"])):Y("",!0),sl.value?(J(),H(o,{key:1,onClick:l=>(async e=>{try{await O.confirm(`确定要重置用户"${e.realName}"的密码吗？重置后将生成新的临时密码。`,"确认重置",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=await r.resetPasswordByAdmin(e.id,a.currentUser?.id||"");l.success?(await O.alert(`用户"${e.realName}"的密码已重置成功！\n\n新的临时密码：${l.tempPassword}\n\n请将此密码安全地告知用户，用户首次登录时将被要求修改密码。`,"密码重置成功",{confirmButtonText:"我已记录",type:"success",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1}),M.success("密码重置成功"),await ql()):M.error(l.message||"密码重置失败")}catch(l){"cancel"!==l&&M.error("密码重置失败，请稍后重试")}})(e),type:"warning",size:"small",link:""},{default:Q(()=>[...t[47]||(t[47]=[W(" 重置密码 ",-1)])]),_:1},8,["onClick"])):Y("",!0),ll.value||rl.value||ol.value||tl.value?(J(),H(jl,{key:2,onCommand:a=>((e,a)=>{switch(e){case"permissions":vl(a);break;case"logs":gl(a);break;case"delete":$l(a)}})(a,e)},{dropdown:Q(()=>[G(bl,null,{default:Q(()=>[rl.value?(J(),H(wl,{key:0,command:"permissions"},{default:Q(()=>[...t[49]||(t[49]=[W(" 权限设置 ",-1)])]),_:1})):Y("",!0),ol.value?(J(),H(wl,{key:1,command:"logs"},{default:Q(()=>[...t[50]||(t[50]=[W(" 操作日志 ",-1)])]),_:1})):Y("",!0),tl.value?(J(),H(wl,{key:2,command:"delete",divided:"",class:"danger-item"},{default:Q(()=>[...t[51]||(t[51]=[W(" 删除 ",-1)])]),_:1})):Y("",!0)]),_:1})]),default:Q(()=>[G(o,{type:"primary",size:"small",link:""},{default:Q(()=>[t[48]||(t[48]=W(" 更多",-1)),G(n,{class:"el-icon--right"},{default:Q(()=>[G(X(x))]),_:1})]),_:1})]),_:1},8,["onCommand"])):Y("",!0)]),_:1},8,["data","columns","loading","total"])]),G(rt,{modelValue:v.value,"onUpdate:modelValue":t[19]||(t[19]=e=>v.value=e),title:el.value,width:"600px","before-close":Ll},{footer:Q(()=>[Z("span",xe,[G(o,{onClick:Ll},{default:Q(()=>[...t[54]||(t[54]=[W("取消",-1)])]),_:1}),G(o,{onClick:Bl,type:"primary",loading:p.value},{default:Q(()=>[...t[55]||(t[55]=[W(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:Q(()=>[G(q,{ref_key:"userFormRef",ref:$a,model:Sa,rules:Ca,"label-width":"100px"},{default:Q(()=>[G(g,{gutter:20},{default:Q(()=>[G(m,{span:12},{default:Q(()=>[G(f,{label:"用户名",prop:"username"},{default:Q(()=>[G(h,{modelValue:Sa.username,"onUpdate:modelValue":t[8]||(t[8]=e=>Sa.username=e),placeholder:"请输入用户名",disabled:ba.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),G(m,{span:12},{default:Q(()=>[G(f,{label:"姓名",prop:"realName"},{default:Q(()=>[G(h,{modelValue:Sa.realName,"onUpdate:modelValue":t[9]||(t[9]=e=>Sa.realName=e),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),G(g,{gutter:20},{default:Q(()=>[G(m,{span:12},{default:Q(()=>[G(f,{label:"邮箱",prop:"email"},{default:Q(()=>[G(h,{modelValue:Sa.email,"onUpdate:modelValue":t[10]||(t[10]=e=>Sa.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),G(m,{span:12},{default:Q(()=>[G(f,{label:"手机号",prop:"phone"},{default:Q(()=>[G(h,{modelValue:Sa.phone,"onUpdate:modelValue":t[11]||(t[11]=e=>Sa.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),G(g,{gutter:20},{default:Q(()=>[G(m,{span:12},{default:Q(()=>[G(f,{label:"角色",prop:"roleId"},{default:Q(()=>[G(j,{modelValue:Sa.roleId,"onUpdate:modelValue":t[12]||(t[12]=e=>Sa.roleId=e),placeholder:"请选择角色",style:{width:"100%"},onChange:cl},{default:Q(()=>[(J(!0),K(ae,null,le(Va.value,e=>(J(),H(L,{key:e.id,label:e.name,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),G(m,{span:12},{default:Q(()=>[G(f,{label:"部门",prop:"departmentId"},{default:Q(()=>[G(j,{modelValue:Sa.departmentId,"onUpdate:modelValue":t[13]||(t[13]=e=>Sa.departmentId=e),placeholder:"请选择部门",style:{width:"100%"},clearable:""},{default:Q(()=>[(J(!0),K(ae,null,le(X(l).departmentList,e=>(J(),H(L,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),G(g,{gutter:20},{default:Q(()=>[G(m,{span:12},{default:Q(()=>[G(f,{label:"职位",prop:"position"},{default:Q(()=>[G(j,{modelValue:Sa.position,"onUpdate:modelValue":t[14]||(t[14]=e=>Sa.position=e),placeholder:"请选择或输入职位",filterable:"","allow-create":"",style:{width:"100%"}},{default:Q(()=>[(J(!0),K(ae,null,le(il.value,e=>(J(),H(L,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),G(m,{span:12},{default:Q(()=>[G(f,{label:"工号",prop:"employeeNumber"},{default:Q(()=>[G(h,{modelValue:Sa.employeeNumber,"onUpdate:modelValue":t[15]||(t[15]=e=>Sa.employeeNumber=e),placeholder:"请输入工号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),G(g,{gutter:20},{default:Q(()=>[G(m,{span:12},{default:Q(()=>[G(f,{label:"状态",prop:"status"},{default:Q(()=>[G(et,{modelValue:Sa.status,"onUpdate:modelValue":t[16]||(t[16]=e=>Sa.status=e)},{default:Q(()=>[G(Kl,{label:"active"},{default:Q(()=>[...t[52]||(t[52]=[W("启用",-1)])]),_:1}),G(Kl,{label:"inactive"},{default:Q(()=>[...t[53]||(t[53]=[W("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),ba.value?Y("",!0):(J(),H(f,{key:0,label:"密码",prop:"password"},{default:Q(()=>[G(h,{modelValue:Sa.password,"onUpdate:modelValue":t[17]||(t[17]=e=>Sa.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),G(f,{label:"备注",prop:"remark"},{default:Q(()=>[G(h,{modelValue:Sa.remark,"onUpdate:modelValue":t[18]||(t[18]=e=>Sa.remark=e),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),G(rt,{modelValue:B.value,"onUpdate:modelValue":t[20]||(t[20]=e=>B.value=e),title:"用户详情",width:"800px"},{default:Q(()=>[ka.value?(J(),K("div",Ce,[G(nt,{column:2,border:""},{default:Q(()=>[G(ot,{label:"头像"},{default:Q(()=>[G(fl,{src:ka.value.avatar,size:60},{default:Q(()=>[W(ee(ka.value.realName?.charAt(0)),1)]),_:1},8,["src"])]),_:1}),G(ot,{label:"用户名"},{default:Q(()=>[W(ee(ka.value.username),1)]),_:1}),G(ot,{label:"姓名"},{default:Q(()=>[W(ee(ka.value.realName),1)]),_:1}),G(ot,{label:"邮箱"},{default:Q(()=>[W(ee(X(u)(ka.value.email,X(s).EMAIL)),1)]),_:1}),G(ot,{label:"手机号"},{default:Q(()=>[W(ee(X(u)(ka.value.phone,"phone")),1)]),_:1}),G(ot,{label:"部门"},{default:Q(()=>[ka.value.departmentName?(J(),H(yl,{key:0,type:"primary"},{default:Q(()=>[W(ee(ka.value.departmentName),1)]),_:1})):(J(),K("span",$e,"未分配"))]),_:1}),G(ot,{label:"角色"},{default:Q(()=>[G(yl,{type:ml(ka.value.roleId)},{default:Q(()=>[W(ee(ul(ka.value.roleId)),1)]),_:1},8,["type"])]),_:1}),G(ot,{label:"状态"},{default:Q(()=>[G(yl,{type:"active"===ka.value.status?"success":"danger"},{default:Q(()=>[W(ee("active"===ka.value.status?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1}),G(ot,{label:"在线状态"},{default:Q(()=>[G(yl,{type:ka.value.isOnline?"success":"info"},{default:Q(()=>[W(ee(ka.value.isOnline?"在线":"离线"),1)]),_:1},8,["type"])]),_:1}),G(ot,{label:"创建时间"},{default:Q(()=>[W(ee(ka.value.createTime),1)]),_:1}),G(ot,{label:"最后登录"},{default:Q(()=>[W(ee(ka.value.lastLoginTime),1)]),_:1}),G(ot,{label:"登录次数"},{default:Q(()=>[W(ee(ka.value.loginCount),1)]),_:1}),G(ot,{label:"备注",span:2},{default:Q(()=>[W(ee(ka.value.remark||"无"),1)]),_:1})]),_:1})])):Y("",!0)]),_:1},8,["modelValue"]),G(rt,{modelValue:La.value,"onUpdate:modelValue":t[22]||(t[22]=e=>La.value=e),title:"权限设置",width:"800px"},{default:Q(()=>[ka.value?(J(),K("div",Ae,[Z("div",Ee,[G(nt,{column:3,size:"small"},{default:Q(()=>[G(ot,{label:"用户"},{default:Q(()=>[W(ee(ka.value.realName),1)]),_:1}),G(ot,{label:"角色"},{default:Q(()=>[W(ee(ul(ka.value.roleId)),1)]),_:1}),G(ot,{label:"状态"},{default:Q(()=>[G(yl,{type:"active"===ka.value.status?"success":"danger",size:"small"},{default:Q(()=>[W(ee("active"===ka.value.status?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1})]),_:1})]),G(it),Z("div",Te,[G(dt,{title:"权限同步机制说明",type:"info",closable:!1,"show-icon":""},{default:Q(()=>[t[56]||(t[56]=Z("p",null,"• 用户权限由角色权限和个人权限组成",-1)),t[57]||(t[57]=Z("p",null,"• 角色权限是基础权限，不能被移除，与系统管理中的角色权限保持同步",-1)),t[58]||(t[58]=Z("p",null,"• 个人权限可以在角色权限基础上进行额外授权",-1)),X(a).isSuperAdmin?(J(),K("p",ze,"• 作为超级管理员，您可以为用户授予任何额外权限")):(J(),K("p",Pe,"• 只有超级管理员可以修改个人权限设置")),t[59]||(t[59]=Z("p",null,"• 保存时会自动合并角色权限和个人权限，确保权限一致性",-1))]),_:1}),G(mt,{modelValue:Ra.value,"onUpdate:modelValue":t[21]||(t[21]=e=>Ra.value=e),class:"permission-tabs"},{default:Q(()=>[G(ct,{label:"角色权限",name:"role"},{default:Q(()=>[Z("div",De,[G(ut,{ref_key:"rolePermissionTreeRef",ref:Ka,data:qa.value,"show-checkbox":"","node-key":"id","default-checked-keys":Fa.value,props:{children:"children",label:"name"},"check-strictly":!1,disabled:""},null,8,["data","default-checked-keys"]),Z("div",Me,[G(n,null,{default:Q(()=>[G(X(T))]),_:1}),t[60]||(t[60]=W(" 角色权限由系统管理员在角色管理中配置，此处仅供查看,与系统管理-角色权限保持同步 ",-1))])])]),_:1}),G(ct,{label:"个人权限",name:"personal"},{default:Q(()=>[Z("div",Oe,[Z("div",Be,[G(n,null,{default:Q(()=>[G(X(T))]),_:1}),X(a).isSuperAdmin?(J(),K("span",Le,"灰色选项为角色默认权限，不可取消；可额外勾选其他权限进行授权")):(J(),K("span",je,"只有超级管理员可以修改个人权限设置"))]),G(ut,{ref_key:"personalPermissionTree",ref:Ga,data:Ja.value,"show-checkbox":"","node-key":"id","default-checked-keys":Za.value,props:{children:"children",label:"name",disabled:"disabled"},"check-strictly":!1,disabled:!X(a).isSuperAdmin,onCheck:_l},null,8,["data","default-checked-keys","disabled"]),Z("div",Re,[G(o,{onClick:kl,disabled:!X(a).isSuperAdmin},{default:Q(()=>[...t[61]||(t[61]=[W(" 重置到角色默认权限 ",-1)])]),_:1},8,["disabled"]),G(o,{type:"primary",onClick:Il,loading:ja.value,disabled:!X(a).isSuperAdmin},{default:Q(()=>[...t[62]||(t[62]=[W(" 保存权限 ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1})]),_:1},8,["modelValue"])])])):Y("",!0)]),_:1},8,["modelValue"]),G(rt,{modelValue:Ha.value,"onUpdate:modelValue":t[26]||(t[26]=e=>Ha.value=e),title:"操作日志",width:"1000px"},{default:Q(()=>[ka.value?(J(),K("div",qe,[Z("div",Fe,[Z("div",Ke,[Z("span",null,"用户："+ee(ka.value.realName)+"（"+ee(ka.value.username)+"）",1)]),Z("div",Je,[G(R,{modelValue:Wa.value,"onUpdate:modelValue":t[23]||(t[23]=e=>Wa.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small",onChange:Sl},null,8,["modelValue"]),G(o,{size:"small",onClick:Ul,icon:X(V)},{default:Q(()=>[...t[63]||(t[63]=[W("刷新",-1)])]),_:1},8,["icon"]),G(o,{size:"small",onClick:Vl,icon:X(_)},{default:Q(()=>[...t[64]||(t[64]=[W("导出",-1)])]),_:1},8,["icon"])])]),G(vt,{data:Qa.value,loading:Ya.value,stripe:"",height:"400"},{default:Q(()=>[G(pt,{prop:"time",label:"操作时间",width:"160"}),G(pt,{prop:"action",label:"操作类型",width:"120"},{default:Q(({row:e})=>{return[G(yl,{type:(a=e.action,{login:"success",logout:"info",create:"primary",update:"warning",delete:"danger",view:"info"}[a]||"info"),size:"small"},{default:Q(()=>[W(ee(Nl(e.action)),1)]),_:2},1032,["type"])];var a}),_:1}),G(pt,{prop:"module",label:"操作模块",width:"120"}),G(pt,{prop:"description",label:"操作描述","show-overflow-tooltip":""}),G(pt,{prop:"ip",label:"IP地址",width:"120"}),G(pt,{prop:"userAgent",label:"设备信息",width:"200","show-overflow-tooltip":""}),G(pt,{prop:"result",label:"操作结果",width:"100"},{default:Q(({row:e})=>[G(yl,{type:"success"===e.result?"success":"danger",size:"small"},{default:Q(()=>[W(ee("success"===e.result?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data","loading"]),Z("div",Ze,[G(gt,{"current-page":Xa.page,"onUpdate:currentPage":t[24]||(t[24]=e=>Xa.page=e),"page-size":Xa.size,"onUpdate:pageSize":t[25]||(t[25]=e=>Xa.size=e),"page-sizes":[10,20,50,100],total:Xa.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:xl,onCurrentChange:Cl},null,8,["current-page","page-size","total"])])])):Y("",!0)]),_:1},8,["modelValue"]),G(rt,{modelValue:Aa.value,"onUpdate:modelValue":t[27]||(t[27]=e=>Aa.value=e),title:"批量导入用户",width:"800px","before-close":lt,class:"batch-import-dialog"},{footer:Q(()=>[Z("div",ha,[Z("div",fa,[3===Ea.value?(J(),K("span",ya," 共 "+ee(Ma.value.length)+" 条数据，其中 "+ee(Oa.value.length)+" 条有效 ",1)):Y("",!0)]),Z("div",wa,[G(o,{onClick:lt},{default:Q(()=>[...t[84]||(t[84]=[W("取消",-1)])]),_:1}),Ea.value>0?(J(),H(o,{key:0,onClick:Gl},{default:Q(()=>[...t[85]||(t[85]=[W("上一步",-1)])]),_:1})):Y("",!0),Ea.value<3?(J(),H(o,{key:1,type:"primary",onClick:Zl,disabled:2===Ea.value&&!za.value},{default:Q(()=>[...t[86]||(t[86]=[W(" 下一步 ",-1)])]),_:1},8,["disabled"])):Y("",!0),3===Ea.value?(J(),H(o,{key:2,type:"primary",onClick:at,loading:Da.value,disabled:0===Oa.value.length},{default:Q(()=>[...t[87]||(t[87]=[W(" 确认导入 ",-1)])]),_:1},8,["loading","disabled"])):Y("",!0)])])]),default:Q(()=>[Z("div",Ge,[G(ft,{active:Ea.value,"finish-status":"success","align-center":""},{default:Q(()=>[G(ht,{title:"下载模板",description:"下载Excel模板文件"}),G(ht,{title:"填写数据",description:"按模板格式填写用户数据"}),G(ht,{title:"上传文件",description:"上传填写好的Excel文件"}),G(ht,{title:"预览确认",description:"预览导入数据并确认"})]),_:1},8,["active"]),0===Ea.value?(J(),K("div",He,[Z("div",Ye,[t[66]||(t[66]=Z("div",{class:"step-title"},"下载导入模板",-1)),t[67]||(t[67]=Z("div",{class:"step-description"}," 请先下载用户导入模板，按照模板格式填写用户数据。 ",-1)),t[68]||(t[68]=Z("div",{class:"template-info"},[Z("h4",null,"模板说明："),Z("ul",null,[Z("li",null,"用户名：3-20个字符，不能重复"),Z("li",null,"姓名：真实姓名，不能为空"),Z("li",null,"邮箱：有效的邮箱地址"),Z("li",null,"手机号：11位手机号码"),Z("li",null,"角色：超级管理员、管理员、销售员、客服"),Z("li",null,"部门：部门名称，可选"),Z("li",null,"职位：用户职位，可选"),Z("li",null,"工号：员工工号，可选"),Z("li",null,"密码：登录密码，6-20个字符"),Z("li",null,"备注：可选，用户备注信息")])],-1)),G(o,{type:"primary",onClick:Hl},{default:Q(()=>[G(n,null,{default:Q(()=>[G(X(_))]),_:1}),t[65]||(t[65]=W(" 下载模板 ",-1))]),_:1})])])):Y("",!0),1===Ea.value?(J(),K("div",Qe,[Z("div",We,[t[70]||(t[70]=Z("div",{class:"step-title"},"填写用户数据",-1)),t[71]||(t[71]=Z("div",{class:"step-description"}," 请在下载的模板中填写用户数据，注意以下要点： ",-1)),G(dt,{title:"重要提示",type:"warning",closable:!1,"show-icon":""},{default:Q(()=>[...t[69]||(t[69]=[Z("ul",null,[Z("li",null,"请严格按照模板格式填写，不要修改表头"),Z("li",null,"用户名不能重复，系统会自动检查"),Z("li",null,"角色名称必须准确，区分大小写"),Z("li",null,"手机号和邮箱格式必须正确"),Z("li",null,"建议先少量测试，确认无误后再批量导入")],-1)])]),_:1})])])):Y("",!0),2===Ea.value?(J(),K("div",Xe,[Z("div",ea,[Z("div",aa,[G(yt,{ref_key:"uploadRef",ref:Ta,class:"upload-demo",drag:"","auto-upload":!1,"on-change":Yl,"before-upload":Ql,accept:".xlsx,.xls",limit:1,"on-exceed":Wl},{tip:Q(()=>[...t[72]||(t[72]=[Z("div",{class:"el-upload__tip"}," 只能上传xlsx/xls文件，且不超过10MB ",-1)])]),default:Q(()=>[G(n,{class:"el-icon--upload"},{default:Q(()=>[G(X(b))]),_:1}),t[73]||(t[73]=Z("div",{class:"el-upload__text"},[W(" 将Excel文件拖到此处，或"),Z("em",null,"点击上传")],-1))]),_:1},512)]),za.value?(J(),K("div",la,[Z("p",null,"已选择文件："+ee(za.value.name),1),G(o,{type:"primary",onClick:Xl,loading:Pa.value},{default:Q(()=>[...t[74]||(t[74]=[W(" 解析文件 ",-1)])]),_:1},8,["loading"])])):Y("",!0)])])):Y("",!0),3===Ea.value?(J(),K("div",ta,[Z("div",sa,[Z("div",ra,[t[77]||(t[77]=Z("h4",null,"数据预览",-1)),Z("p",null,[t[75]||(t[75]=W("共解析到 ",-1)),Z("strong",null,ee(Ma.value.length),1),t[76]||(t[76]=W(" 条用户数据，请确认后导入：",-1))])]),Z("div",oa,[G(vt,{data:Ma.value,border:"","max-height":"400"},{default:Q(()=>[G(pt,{prop:"username",label:"用户名",width:"120"}),G(pt,{prop:"realName",label:"姓名",width:"100"}),G(pt,{label:"邮箱",width:"180"},{default:Q(({row:e})=>[W(ee(X(u)(e.email,X(s).EMAIL)),1)]),_:1}),G(pt,{label:"手机号",width:"120"},{default:Q(({row:e})=>[W(ee(X(u)(e.phone,X(s).PHONE)),1)]),_:1}),G(pt,{prop:"role",label:"角色",width:"80"}),G(pt,{prop:"department",label:"部门",width:"100"}),G(pt,{prop:"position",label:"职位",width:"120"}),G(pt,{prop:"employeeNumber",label:"工号",width:"120"}),G(pt,{label:"密码",width:"100"},{default:Q(({row:e})=>[e.password?(J(),K("span",na,ee(e.password.replace(/./g,"*")),1)):(J(),H(yl,{key:1,type:"info",size:"small"},{default:Q(()=>[...t[78]||(t[78]=[W("默认密码",-1)])]),_:1}))]),_:1}),G(pt,{prop:"remark",label:"备注","show-overflow-tooltip":""}),G(pt,{label:"验证结果",width:"100"},{default:Q(({row:e})=>[e.errors&&0===e.errors.length?(J(),H(yl,{key:0,type:"success"},{default:Q(()=>[...t[79]||(t[79]=[W("有效",-1)])]),_:1})):(J(),H(yl,{key:1,type:"danger"},{default:Q(()=>[...t[80]||(t[80]=[W("无效",-1)])]),_:1}))]),_:1}),G(pt,{label:"错误信息","min-width":"300"},{default:Q(({row:e})=>[e.errors&&e.errors.length>0?(J(),K("div",ia,[(J(!0),K(ae,null,le(e.errors,(e,a)=>(J(),K("div",{key:a,class:"error-item"},[G(n,{class:"error-icon"},{default:Q(()=>[G(X(z))]),_:1}),Z("span",da,ee(e),1),Jl(e)?(J(),H(hl,{key:0,placement:"top",content:Jl(e)},{default:Q(()=>[G(n,{class:"suggestion-icon"},{default:Q(()=>[G(X(P))]),_:1})]),_:1},8,["content"])):Y("",!0)]))),128))])):(J(),K("div",ua,[G(n,{class:"success-icon"},{default:Q(()=>[G(X(D))]),_:1}),t[81]||(t[81]=Z("span",{class:"success-text"},"数据有效",-1))]))]),_:1})]),_:1},8,["data"])]),Z("div",ca,[Z("div",ma,[Z("div",pa,ee(Oa.value.length),1),t[82]||(t[82]=Z("div",{class:"summary-label"},"有效数据",-1))]),Z("div",va,[Z("div",ga,ee(Ba.value.length),1),t[83]||(t[83]=Z("div",{class:"summary-label"},"无效数据",-1))])])])])):Y("",!0)])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-96357800"]]);export{ba as default};
