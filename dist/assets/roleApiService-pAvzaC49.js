import{D as e}from"./index-DkAJPKqn.js";const o=new class{async getRoles(){try{console.log("[RoleAPI] 开始获取角色列表...");const o=await e.get("/roles");return console.log("[RoleAPI] 获取角色列表成功:",o),o.data.roles||[]}catch(o){console.warn("[RoleAPI] API获取失败，尝试从localStorage获取"),console.warn("[RoleAPI] 错误详情:",{message:o?.message,status:o?.response?.status,statusText:o?.response?.statusText,data:o?.response?.data});try{const e=localStorage.getItem("crm_roles");if(e){const o=JSON.parse(e);return console.log("[RoleAPI] 从localStorage获取角色成功:",o.length),o}}catch(t){console.warn("[RoleAPI] localStorage读取失败:",t)}console.log("[RoleAPI] 使用默认角色数据");const e=this.getDefaultRoles();try{localStorage.setItem("crm_roles",JSON.stringify(e)),console.log("[RoleAPI] 默认角色已保存到localStorage")}catch(s){console.warn("[RoleAPI] 保存默认角色到localStorage失败:",s)}return e}}async getRoleById(o){try{const t=await e.get(`/roles/${o}`);return console.log(`[RoleAPI] 获取角色详情成功: ${o}`),t.data}catch(t){throw console.error(`[RoleAPI] 获取角色详情失败: ${o}`,t),t}}async createRole(o){try{const t=await e.post("/roles",o);return console.log("[RoleAPI] 创建角色成功"),t.data}catch(t){console.warn("[RoleAPI] API创建失败，使用localStorage创建角色",t);try{const e=JSON.parse(localStorage.getItem("crm_roles")||"[]"),t=e.reduce((e,o)=>{const t=parseInt(o.id);return t>e?t:e},0),s={id:String(t+1),name:o.name,code:o.code,description:o.description||"",status:"active",roleType:o.roleType||"custom",permissions:o.permissions||[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};return e.push(s),localStorage.setItem("crm_roles",JSON.stringify(e)),console.log("[RoleAPI] localStorage创建角色成功:",s),s}catch(s){throw console.error("[RoleAPI] localStorage创建角色也失败",s),s}}}async updateRole(o){try{const t=await e.put(`/roles/${o.id}`,o);return console.log(`[RoleAPI] 更新角色成功: ${o.id}`),t.data}catch(t){console.warn(`[RoleAPI] API更新失败，使用localStorage更新角色: ${o.id}`,t);try{const e=JSON.parse(localStorage.getItem("crm_roles")||"[]"),t=e.findIndex(e=>e.id===o.id);if(-1===t)throw new Error(`未找到角色 ID: ${o.id}`);const s={...e[t],name:o.name||e[t].name,code:o.code||e[t].code,description:void 0!==o.description?o.description:e[t].description,status:o.status||e[t].status,roleType:o.roleType||e[t].roleType,permissions:o.permissions||e[t].permissions,updatedAt:(new Date).toISOString()};return e[t]=s,localStorage.setItem("crm_roles",JSON.stringify(e)),console.log("[RoleAPI] localStorage更新角色成功:",s),s}catch(s){throw console.error("[RoleAPI] localStorage更新角色也失败",s),s}}}async deleteRole(o){try{await e.delete(`/roles/${o}`),console.log(`[RoleAPI] 删除角色成功: ${o}`)}catch(t){console.warn(`[RoleAPI] API删除失败，使用localStorage删除角色: ${o}`,t);try{const e=JSON.parse(localStorage.getItem("crm_roles")||"[]"),t=e.filter(e=>e.id!==o);if(t.length===e.length)throw new Error(`未找到角色 ID: ${o}`);localStorage.setItem("crm_roles",JSON.stringify(t)),console.log("[RoleAPI] localStorage删除角色成功:",o)}catch(s){throw console.error("[RoleAPI] localStorage删除角色也失败",s),s}}}async batchDeleteRoles(o){try{await e.post("/roles/batch-delete",{ids:o}),console.log("[RoleAPI] 批量删除角色成功")}catch(t){throw console.error("[RoleAPI] 批量删除角色失败",t),t}}async batchUpdateRoleStatus(o,t){try{await e.post("/roles/batch-status",{ids:o,status:t}),console.log("[RoleAPI] 批量更新角色状态成功")}catch(s){throw console.error("[RoleAPI] 批量更新角色状态失败",s),s}}async getRoleStats(){try{console.log("[RoleAPI] 开始获取角色统计...");const o=await e.get("/roles/stats");return console.log("[RoleAPI] 获取角色统计成功:",o),o.data}catch(o){return console.warn("[RoleAPI] 获取角色统计失败，使用默认数据"),console.warn("[RoleAPI] 错误详情:",{message:o?.message,status:o?.response?.status,statusText:o?.response?.statusText,data:o?.response?.data}),this.getDefaultRoleStats()}}getDefaultRoles(){return[{id:"1",name:"超级管理员",code:"super_admin",description:"系统超级管理员，拥有所有权限",color:"danger",level:1,status:"active",roleType:"system",permissions:[],createdAt:"2024-01-01T00:00:00Z",updatedAt:"2024-01-01T00:00:00Z"},{id:"2",name:"管理员",code:"admin",description:"系统管理员，拥有所有权限",color:"warning",level:2,status:"active",roleType:"system",permissions:[],createdAt:"2024-01-01T00:00:00Z",updatedAt:"2024-01-01T00:00:00Z"},{id:"3",name:"部门经理",code:"department_manager",description:"部门经理，拥有部门管理权限",color:"primary",level:3,status:"active",roleType:"business",permissions:[],createdAt:"2024-01-01T00:00:00Z",updatedAt:"2024-01-01T00:00:00Z"},{id:"4",name:"销售员",code:"sales_staff",description:"销售人员，负责客户和订单管理",color:"success",level:4,status:"active",roleType:"business",permissions:[],createdAt:"2024-01-01T00:00:00Z",updatedAt:"2024-01-01T00:00:00Z"},{id:"5",name:"客服",code:"customer_service",description:"客户服务人员，负责客户支持",color:"info",level:5,status:"active",roleType:"business",permissions:[],createdAt:"2024-01-01T00:00:00Z",updatedAt:"2024-01-01T00:00:00Z"}]}getDefaultRoleStats(){return{total:6,active:5,inactive:1,byLevel:{1:1,2:1,3:1,4:2,5:1},distribution:[{name:"超级管理员",count:1,percentage:16.7},{name:"管理员",count:1,percentage:16.7},{name:"经理",count:1,percentage:16.7},{name:"销售员",count:2,percentage:33.3},{name:"客服",count:1,percentage:16.7}]}}};export{o as r};
