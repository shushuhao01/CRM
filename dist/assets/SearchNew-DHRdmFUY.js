import{l as e,aC as s,r as a,Z as l,w as t,b as r,ag as o,m as n,q as d,p as c,Q as i,U as u,S as m,O as v,u as p,a7 as h,T as g,F as w,a9 as f,M as y}from"./vendor-BtukhyiH.js";import{E as k,F as N,S as b,u as _,av as C,v as T,B as P,aw as z}from"./elementPlus-DxaqjplL.js";import{i as O,u as L,d as S,S as j,_ as I}from"./index-DkAJPKqn.js";import{a as q}from"./sensitiveInfo-DVfrBLrU.js";import"./utils-DfI7e5Rl.js";const x={class:"customer-search-container"},D={class:"page-header"},E={class:"header-content"},V={class:"page-title"},A={class:"search-section"},F={class:"search-form"},H={class:"search-input-group"},U={class:"input-item"},B={class:"search-actions"},K={key:0,class:"result-section"},M={class:"result-header"},Q={class:"result-stats"},Z={key:0},$={key:1,class:"no-result"},G={key:0,class:"result-list"},J={class:"result-card-new"},R={class:"customer-section"},W={class:"section-header"},X={class:"customer-main"},Y={class:"customer-avatar"},ee={class:"customer-basic"},se={class:"customer-name"},ae={class:"customer-tags"},le={key:0,class:"matched-order-info"},te={key:0,class:"order-tag"},re={key:1,class:"tracking-tag"},oe={class:"customer-details-grid"},ne={class:"detail-item"},de={class:"detail-value"},ce={key:0,class:"detail-item"},ie={class:"detail-value"},ue={key:1,class:"detail-item"},me={class:"detail-value"},ve={key:2,class:"detail-item"},pe={key:3,class:"detail-item full-width"},he={class:"detail-value address"},ge={class:"detail-item"},we={class:"detail-value"},fe={class:"detail-item"},ye={class:"detail-value"},ke={class:"owner-section"},Ne={class:"section-header"},be={class:"owner-card-new"},_e={class:"owner-avatar"},Ce={class:"owner-info-new"},Te={class:"owner-name"},Pe={class:"owner-department"},ze={key:0,class:"owner-phone"},Oe={class:"owner-status-badge"},Le={key:1,class:"no-result-state"},Se={class:"no-result-icon"},je=I(e({__name:"SearchNew",setup(e){const I=s(),je=O(),Ie=L(),qe=S(),xe=a(!1),De=a(!1),Ee=a([]),Ve=l({keyword:""});t(()=>I.query.keyword,e=>{e&&"string"==typeof e&&(Ve.keyword=e,Ae())},{immediate:!0}),r(()=>{const e=I.query.keyword;e&&"string"==typeof e&&(Ve.keyword=e,Ae())});const Ae=async()=>{if(console.log("[客户查询] ========== 开始搜索 =========="),console.log("[客户查询] 搜索关键词:",Ve.keyword),!Ve.keyword.trim())return void k.warning("请输入搜索关键词");De.value=!0,xe.value=!0;const e=Ve.keyword.trim().toLowerCase();try{0===je.customers.length&&await je.loadCustomers();const s=je.customers,a=Ie.users,l=qe.getOrders();console.log("[客户查询] 从store获取数据:"),console.log("  - 客户数:",s.length),console.log("  - 用户数:",a.length),console.log("  - 订单数:",l.length);const t=[],r=new Set;for(const o of s){let s=!1,l="";if(o.name?.toLowerCase().includes(e)?(s=!0,l="客户姓名"):o.phone?.includes(e)?(s=!0,l="手机号"):o.code?.toLowerCase().includes(e)&&(s=!0,l="客户编码"),s&&!r.has(o.id)){r.add(o.id);const e=a.find(e=>e.id===o.salesPersonId);t.push({customerName:o.name||"未知",phone:o.phone||"",customerCode:o.code||"",gender:o.gender||"",age:o.age||0,level:o.level||"",address:o.address||"",createTime:o.createTime||"",orderCount:o.orderCount||0,ownerName:e?.name||"未分配",ownerPhone:"",ownerDepartment:e?.department||"未知部门",matchType:l})}}for(const o of l){let l=!1,n="";if(o.orderNumber?.toLowerCase().includes(e)?(l=!0,n="订单号"):o.trackingNumber?.toLowerCase().includes(e)?(l=!0,n="物流单号"):o.afterSaleNumber?.toLowerCase().includes(e)&&(l=!0,n="售后单号"),l){const e=s.find(e=>e.id===o.customerId);if(e&&!r.has(e.id)){r.add(e.id);const s=a.find(s=>s.id===e.salesPersonId);t.push({customerName:e.name||"未知",phone:e.phone||"",customerCode:e.code||"",gender:e.gender||"",age:e.age||0,level:e.level||"",address:e.address||"",createTime:e.createTime||"",orderCount:e.orderCount||0,ownerName:s?.name||"未分配",ownerPhone:"",ownerDepartment:s?.department||"未知部门",matchType:n,matchedOrderNo:o.orderNumber,matchedTrackingNo:o.trackingNumber})}}}Ee.value=t,console.log("[客户查询] 搜索完成，结果数:",t.length),t.length>0?k.success(`找到 ${t.length} 条匹配记录`):k.info("未找到匹配的客户信息")}catch(s){console.error("[客户查询] 搜索失败:",s),k.error("搜索失败，请重试")}finally{xe.value=!1}},Fe=()=>{Ve.keyword="",De.value=!1,Ee.value=[]},He=e=>({diamond:"钻石客户",gold:"金牌客户",silver:"银牌客户",bronze:"铜牌客户",normal:"普通客户"}[e]||e||"普通客户");return(e,s)=>{const a=o("el-icon"),l=o("el-input"),t=o("el-button"),r=o("el-tag");return d(),n("div",x,[c("div",D,[c("div",E,[c("h1",V,[u(a,{class:"title-icon"},{default:v(()=>[u(p(N))]),_:1}),s[1]||(s[1]=m(" 客户查询 ",-1))]),s[2]||(s[2]=c("p",{class:"page-description"},"支持精确匹配和模糊搜索，输入关键信息即可快速定位客户",-1))])]),c("div",A,[s[5]||(s[5]=c("div",{class:"search-header"},[c("h3",null,"查询条件"),c("p",{class:"search-tip"},"支持：客户姓名、手机号、客户编码、订单号、物流单号、售后单号")],-1)),c("div",F,[c("div",H,[c("div",U,[u(l,{modelValue:Ve.keyword,"onUpdate:modelValue":s[0]||(s[0]=e=>Ve.keyword=e),placeholder:"请输入客户姓名、手机号、客户编码、订单号、物流单号或售后单号",clearable:"",onKeyup:h(Ae,["enter"]),class:"search-input"},{prefix:v(()=>[u(a,null,{default:v(()=>[u(p(N))]),_:1})]),_:1},8,["modelValue"])])]),c("div",B,[u(t,{type:"primary",onClick:Ae,loading:xe.value,size:"large",class:"search-btn"},{default:v(()=>[u(a,null,{default:v(()=>[u(p(N))]),_:1}),s[3]||(s[3]=m(" 搜索 ",-1))]),_:1},8,["loading"]),u(t,{onClick:Fe,size:"large",class:"reset-btn"},{default:v(()=>[u(a,null,{default:v(()=>[u(p(b))]),_:1}),s[4]||(s[4]=m(" 重置 ",-1))]),_:1})])])]),De.value?(d(),n("div",K,[c("div",M,[s[8]||(s[8]=c("h3",null,"查询结果",-1)),c("div",Q,[Ee.value.length>0?(d(),n("span",Z,[s[6]||(s[6]=m(" 找到 ",-1)),c("strong",null,g(Ee.value.length),1),s[7]||(s[7]=m(" 条匹配记录 ",-1))])):(d(),n("span",$," 未找到匹配的客户信息 "))])]),Ee.value.length>0?(d(),n("div",G,[(d(!0),n(w,null,f(Ee.value,(e,l)=>{return d(),n("div",{key:l,class:"result-item"},[c("div",J,[c("div",R,[c("div",W,[u(a,{class:"section-icon"},{default:v(()=>[u(p(_))]),_:1}),s[9]||(s[9]=c("span",null,"客户信息",-1))]),c("div",X,[c("div",Y,g(e.customerName?.charAt(0)||"客"),1),c("div",ee,[c("h4",se,g(e.customerName||"未知客户"),1),c("div",ae,[e.customerCode?(d(),y(r,{key:0,size:"small",type:"info"},{default:v(()=>[m(g(e.customerCode),1)]),_:2},1024)):i("",!0),e.matchType?(d(),y(r,{key:1,size:"small",type:"success"},{default:v(()=>[m("匹配："+g(e.matchType),1)]),_:2},1024)):i("",!0)])])]),e.matchedOrderNo||e.matchedTrackingNo?(d(),n("div",le,[e.matchedOrderNo?(d(),n("span",te,[u(a,null,{default:v(()=>[u(p(C))]),_:1}),m(" 订单号："+g(e.matchedOrderNo),1)])):i("",!0),e.matchedTrackingNo?(d(),n("span",re,[u(a,null,{default:v(()=>[u(p(T))]),_:1}),m(" 物流单号："+g(e.matchedTrackingNo),1)])):i("",!0)])):i("",!0),c("div",oe,[c("div",ne,[s[10]||(s[10]=c("span",{class:"detail-label"},"手机号",-1)),c("span",de,g(p(q)(e.phone,p(j).PHONE)),1)]),e.gender?(d(),n("div",ce,[s[11]||(s[11]=c("span",{class:"detail-label"},"性别",-1)),c("span",ie,g("male"===e.gender?"男":"女"),1)])):i("",!0),e.age?(d(),n("div",ue,[s[12]||(s[12]=c("span",{class:"detail-label"},"年龄",-1)),c("span",me,g(e.age)+"岁",1)])):i("",!0),e.level?(d(),n("div",ve,[s[13]||(s[13]=c("span",{class:"detail-label"},"等级",-1)),u(r,{size:"small",type:(t=e.level,{diamond:"danger",gold:"warning",silver:"success",bronze:"info",normal:""}[t]||"info")},{default:v(()=>[m(g(He(e.level)),1)]),_:2},1032,["type"])])):i("",!0),e.address?(d(),n("div",pe,[s[14]||(s[14]=c("span",{class:"detail-label"},"地址",-1)),c("span",he,g(e.address),1)])):i("",!0),c("div",ge,[s[15]||(s[15]=c("span",{class:"detail-label"},"创建时间",-1)),c("span",we,g(e.createTime),1)]),c("div",fe,[s[16]||(s[16]=c("span",{class:"detail-label"},"订单数",-1)),c("span",ye,g(e.orderCount||0)+"单",1)])])]),c("div",ke,[c("div",Ne,[u(a,{class:"section-icon owner"},{default:v(()=>[u(p(P))]),_:1}),s[17]||(s[17]=c("span",null,"当前归属人",-1))]),c("div",be,[c("div",_e,g(e.ownerName?.charAt(0)||"未"),1),c("div",Ce,[c("div",Te,g(e.ownerName||"未分配"),1),c("div",Pe,g(e.ownerDepartment||"未知部门"),1),e.ownerPhone?(d(),n("div",ze,g(p(q)(e.ownerPhone,p(j).PHONE)),1)):i("",!0)]),c("div",Oe,[u(r,{type:e.ownerName?"success":"info",size:"small"},{default:v(()=>[m(g(e.ownerName?"已分配":"待分配"),1)]),_:2},1032,["type"])])])])])]);var t}),128))])):(d(),n("div",Le,[c("div",Se,[u(a,null,{default:v(()=>[u(p(z))]),_:1})]),s[18]||(s[18]=c("h3",null,"未找到匹配的客户信息",-1)),s[19]||(s[19]=c("p",null,"请检查输入的信息是否正确，或尝试其他搜索条件",-1))]))])):i("",!0)])}}}),[["__scopeId","data-v-de6ffb7e"]]);export{je as default};
