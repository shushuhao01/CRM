import{l as e,aA as a,aC as t,r as s,Z as i,e as r,b as l,Y as d,ag as n,m as o,q as c,p as u,Q as m,U as p,u as v,T as f,M as g,O as y,S as h,F as _,a9 as w,P as k,V as b}from"./vendor-BtukhyiH.js";import{L as T,a1 as x,d as N,l as S,M as A,m as D,J as C,u as I,a2 as $,T as j,a3 as E,v as z,$ as M,a4 as O,R as P,a5 as R,a6 as L,N as F,a7 as B,P as q,a8 as H,C as W,j as K,H as U,E as V,b as J,I as Y}from"./elementPlus-DxaqjplL.js";import{d as Z,i as Q,b as G,u as X,S as ee,c as ae,_ as te}from"./index-C4IdUW1A.js";import{orderApi as se}from"./order-DOc9fodO.js";import{u as ie}from"./service-BjC45aOM.js";import{d as re}from"./sensitiveInfo-CTSC2tj2.js";import"./utils-DfI7e5Rl.js";import"./env-DLalhsF6.js";const le={class:"order-detail"},de={class:"page-header"},ne={class:"header-left"},oe={class:"header-info"},ce={class:"order-number"},ue={class:"header-actions"},me={key:1,class:"mark-status"},pe={class:"row-layout full-width"},ve={class:"card-header-modern"},fe={class:"header-left"},ge={class:"header-right"},ye={class:"customer-info-modern"},he={class:"customer-main"},_e={class:"customer-avatar-section"},we={class:"customer-details-modern"},ke={class:"customer-name-modern"},be={class:"customer-contact-modern"},Te={class:"contact-text"},xe={class:"contact-item-modern"},Ne={class:"contact-text"},Se={class:"contact-item-modern address-item"},Ae={class:"contact-text"},De={class:"row-layout full-width"},Ce={class:"status-header-horizontal"},Ie={class:"status-title"},$e={class:"status-right-section"},je={key:0,class:"countdown-section"},Ee={class:"countdown-timer"},ze={class:"countdown-text"},Me={class:"status-timeline-horizontal"},Oe={class:"timeline-item-horizontal"},Pe={class:"timeline-content"},Re={class:"timeline-value"},Le={class:"timeline-item-horizontal"},Fe={class:"timeline-content"},Be={class:"timeline-value"},qe={key:0,class:"timeline-item-horizontal countdown-timeline"},He={class:"timeline-content"},We={class:"timeline-value countdown-value"},Ke={key:1,class:"status-tip-horizontal"},Ue={class:"row-layout full-width"},Ve={class:"card-header-modern"},Je={class:"header-left"},Ye={class:"delivery-info-modern"},Ze={class:"delivery-grid-modern"},Qe={class:"delivery-field-modern"},Ge={class:"field-value-modern"},Xe={class:"delivery-field-modern"},ea={class:"delivery-field-modern address-field-modern"},aa={class:"field-value-modern address-value-modern"},ta={class:"row-layout full-width"},sa={class:"card-header-modern"},ia={class:"header-left"},ra={class:"order-info-modern"},la={class:"order-basic-info"},da={class:"info-grid"},na={class:"info-item"},oa={class:"info-value order-number-value"},ca={class:"info-item"},ua={class:"info-value"},ma={class:"info-item"},pa={class:"info-value"},va={class:"info-item"},fa={class:"info-value"},ga={class:"logistics-section"},ya={class:"section-title"},ha={key:0,class:"logistics-info-grid"},_a={class:"logistics-item highlight"},wa={class:"logistics-value"},ka={class:"logistics-item highlight"},ba={class:"logistics-value tracking-number-modern"},Ta={class:"logistics-item"},xa={class:"logistics-value"},Na={class:"logistics-item"},Sa={class:"logistics-value estimated-delivery"},Aa={key:1,class:"logistics-info-grid pending"},Da={class:"logistics-item"},Ca={class:"logistics-value"},Ia={class:"logistics-item"},$a={class:"logistics-value"},ja={class:"logistics-item"},Ea={class:"logistics-value"},za={key:0,class:"order-remark-modern"},Ma={class:"remark-title"},Oa={class:"remark-content"},Pa={class:"row-layout full-width"},Ra={class:"card-header"},La={class:"products-list"},Fa={class:"product-info"},Ba={class:"product-image"},qa=["src","alt"],Ha={class:"product-details"},Wa={class:"product-name"},Ka={class:"product-sku"},Ua={class:"amount-summary-modern"},Va={class:"amount-cards-modern"},Ja={class:"amount-card-modern total-modern"},Ya={class:"amount-icon-modern"},Za={class:"amount-content-modern"},Qa={class:"amount-value-modern"},Ga={key:0,class:"amount-card-modern deposit-modern"},Xa={class:"amount-icon-modern"},et={class:"amount-content-modern"},at={class:"amount-value-modern"},tt={key:1,class:"amount-card-modern collect-modern"},st={class:"amount-icon-modern"},it={class:"amount-content-modern"},rt={class:"amount-value-modern"},lt={key:2,class:"amount-card-modern payment-modern"},dt={class:"amount-icon-modern"},nt={class:"amount-content-modern"},ot={class:"amount-value-modern payment-text"},ct={class:"amount-row-detail"},ut={class:"amount-detail-item subtotal-item"},mt={class:"detail-value subtotal"},pt={key:0,class:"amount-detail-item discount-item"},vt={class:"detail-value discount"},ft={key:1,class:"amount-detail-item discount-item"},gt={class:"detail-value discount"},yt={key:2,class:"amount-detail-item payment-item"},ht={class:"detail-value payment"},_t={key:0,class:"deposit-screenshot-horizontal"},wt={class:"screenshots-container"},kt=["onClick"],bt={class:"screenshot-overlay"},Tt={key:0,class:"screenshot-count"},xt={class:"row-layout full-width"},Nt={class:"card-header"},St={class:"logistics-timeline"},At={class:"logistics-content"},Dt={class:"logistics-status"},Ct={class:"logistics-description"},It={key:0,class:"logistics-location"},$t={class:"row-layout full-width"},jt={class:"card-header"},Et={class:"row-layout full-width"},zt={class:"card-header"},Mt={class:"timeline-content"},Ot={class:"timeline-title"},Pt={class:"timeline-description"},Rt={key:0,class:"timeline-operator"},Lt={key:0,class:"row-layout full-width"},Ft={class:"card-header"},Bt={class:"logistics-header-info"},qt={key:1,class:"tracking-number"},Ht={key:0,class:"logistics-loading"},Wt={class:"logistics-content"},Kt={class:"logistics-status"},Ut={class:"logistics-description"},Vt={key:0,class:"logistics-location"},Jt={class:"logistics-actions"},Yt={class:"row-layout full-width"},Zt={class:"card-header"},Qt={class:"after-sales-content"},Gt={class:"after-sales-title"},Xt={class:"after-sales-description"},es={key:0,class:"after-sales-operator"},as={key:1,class:"after-sales-amount"},ts=te(e({__name:"Detail",setup(e){const te=a(),ts=t(),ss=ae(te),is=Z(),rs=Q(),ls=G(),ds=ie(),ns=X(),os=s(!1),cs=ts.params.id,us=s(180),ms=s(null),ps=s("03:00"),vs=i({id:"",orderNumber:"",status:"pending",auditStatus:"pending",markType:"",createTime:"",updateTime:"",auditTransferTime:"",isAuditTransferred:!1,customer:{id:"",name:"",phone:"",wechat:"",address:"",level:"normal",avatar:""},receiverName:"",receiverPhone:"",receiverAddress:"",expressCompany:"",trackingNumber:"",serviceWechat:"",orderSource:"",expectedShipDate:"",expectedDeliveryDate:"",products:[],subtotal:0,discount:0,totalAmount:0,depositAmount:0,depositScreenshot:"",depositScreenshots:[],paymentMethod:"",paymentMethodOther:"",remark:""}),fs=s([]),gs=s([]),ys=s([]),hs=s([]),_s=s(!0),ws=s(!0),ks=s(!0),bs=s(!1),Ts=s(!1),xs=e=>{const{orderId:a,log:t}=e.detail;a===ts.params.id&&ys.value.unshift(t)},Ns=e=>{const{orderId:a,newStatus:t}=e.detail;a===ts.params.id&&(vs.status=t,Cs(),js())},Ss=e=>{const a=e.detail;vs.trackingNumber===a.trackingNumber&&ti()},As=e=>{const{orderId:a,serviceId:t}=e.detail;a===ts.params.id&&Is()},Ds=e=>{const{orderId:a,serviceId:t,newStatus:s}=e.detail;a===ts.params.id&&Is()},Cs=()=>{ys.value=is.getOperationLogs(cs)},Is=async()=>{try{const e=ds.getServicesByOrderId(vs.id);hs.value=e.map(e=>({timestamp:e.createTime,type:e.serviceType,title:$s(e.serviceType,e.status),description:e.description||e.reason,operator:e.createdBy,amount:e.price||0,status:e.status,serviceNumber:e.serviceNumber})),hs.value.sort((e,a)=>new Date(a.timestamp).getTime()-new Date(e.timestamp).getTime())}catch(e){console.error("加载售后历史失败:",e)}},$s=(e,a)=>`${{return:"退货申请",exchange:"换货申请",repair:"维修申请",refund:"退款申请"}[e]||"售后申请"} - ${{pending:"已提交",processing:"处理中",resolved:"已解决",closed:"已关闭"}[a]||a}`,js=()=>{const e=is.getOrderStatusHistory(cs);e&&e.length>0?fs.value=e.map(e=>({timestamp:e.timestamp,type:Es(e.status),icon:zs(e.status),color:Ms(e.status),title:e.title||ii(e.status),description:e.description||`订单状态变更为：${ii(e.status)}`,operator:e.operator||"系统"})):fs.value=[{timestamp:vs.createTime,type:"info",icon:W,color:"#909399",title:"订单创建",description:`订单创建成功，订单号：${vs.orderNumber}`,operator:"系统"}],fs.value.sort((e,a)=>new Date(a.timestamp).getTime()-new Date(e.timestamp).getTime())},Es=e=>({pending:"info",pending_approval:"warning",approved:"success",rejected:"danger",pending_shipment:"warning",shipped:"primary",delivered:"success",completed:"success",cancelled:"danger"}[e]||"info"),zs=e=>({pending:j,pending_approval:j,approved:U,rejected:K,pending_shipment:j,shipped:z,delivered:U,completed:U,cancelled:K}[e]||j),Ms=e=>({pending:"#909399",pending_approval:"#e6a23c",approved:"#67c23a",rejected:"#f56c6c",pending_shipment:"#e6a23c",shipped:"#409eff",delivered:"#67c23a",completed:"#67c23a",cancelled:"#f56c6c"}[e]||"#909399"),Os=r(()=>"pending_transfer"===vs.status&&"normal"===vs.markType&&vs.auditTransferTime&&!vs.isAuditTransferred),Ps=r(()=>["shipped","delivered","completed","abnormal","rejected","rejected_returned"].includes(vs.status)),Rs=r(()=>"pending_approval"===vs.status),Ls=r(()=>"pending_approval"===vs.status),Fs=r(()=>"approved"!==vs.auditStatus&&("pending_cancel"!==vs.status&&"cancelled"!==vs.status&&"cancel_failed"!==vs.status&&("pending"!==vs.auditStatus||"normal"!==vs.markType||!vs.isAuditTransferred))),Bs=r(()=>"pending"===vs.auditStatus&&"normal"===vs.markType&&vs.isAuditTransferred),qs=s(!1),Hs=s(0),Ws=r(()=>["shipped","delivered","completed","package_exception","rejected","rejected_returned"].includes(vs.status)&&vs.trackingNumber),Ks=r(()=>vs.products&&0!==vs.products.length?vs.products.reduce((e,a)=>e+a.price*a.quantity,0):0),Us=r(()=>"normal"===vs.markType&&"pending"===vs.auditStatus&&!vs.isAuditTransferred),Vs=r(()=>vs.depositScreenshots&&vs.depositScreenshots.length>0?vs.depositScreenshots:vs.depositScreenshot?[vs.depositScreenshot]:[]),Js=()=>{te.back()},Ys=async()=>{try{const e=await(async e=>await ds.checkExistingAfterSales(e))(vs.id);e?(ss.push(`/service/detail/${e.id}`),V.info("该订单已有售后记录，已跳转到售后详情页")):ss.push({path:"/service/add",query:{orderId:vs.id,orderNumber:vs.orderNumber,customerId:vs.customer.id,customerName:vs.customer.name,customerPhone:vs.customer.phone}})}catch(e){console.error("检查售后记录失败:",e),ss.push({path:"/service/add",query:{orderId:vs.id,orderNumber:vs.orderNumber,customerId:vs.customer.id,customerName:vs.customer.name,customerPhone:vs.customer.phone}})}},Zs=e=>{if(e===vs.markType)return void V.warning("订单已经是该标记状态");if("reserved"===e&&Us.value){const a={reserved:"预留单",normal:"正常发货单",return:"退单"};return void J.confirm(`确认将此订单标记为"${a[e]}"？\n注意：修改为预留单后，订单将不会流转到审核，信息将保留在系统中。`,"确认标记",{type:"warning"}).then(()=>{ms.value&&(clearInterval(ms.value),ms.value=null),vs.markType=e,vs.isAuditTransferred=!0;is.updateOrder(cs,{markType:e,isAuditTransferred:!0})?(V.success(`订单已标记为${a[e]}，信息已保留在系统中`),ls.sendMessage({type:"ORDER_MARKED",title:"订单标记更新",content:`订单 ${vs.orderNumber} 已标记为${a[e]}`,link:`/order/detail/${cs}`,metadata:{orderId:vs.id,orderNumber:vs.orderNumber,markType:e,previousMarkType:"normal"}})):(V.error("更新订单标记失败"),mi())}).catch(()=>{})}if(!Fs.value)return void(Bs.value?V.warning("订单正在审核中，无法修改标记。如需修改，请等待审核完成或联系审核员退回订单。"):"approved"===vs.auditStatus?V.warning("订单已审核通过，无法修改标记"):V.warning("当前状态下无法修改订单标记"));const a={reserved:"预留单",normal:"正常发货单",return:"退单"};J.confirm(`确认将此订单标记为"${a[e]}"？`,"确认标记",{type:"warning"}).then(async()=>{try{(await se.updateMarkType(cs,{markType:e})).success?(vs.markType=e,is.updateOrder(cs,{markType:e}),"return"===e?V.success("订单已标记为退单，信息已保留在系统中"):"normal"===e?V.success("订单已标记为正常发货单"):"reserved"===e?V.success("订单已标记为预留单"):V.success(`订单已标记为${a[e]}`),ls.sendMessage({type:"ORDER_MARKED",title:"订单标记更新",content:`订单 ${vs.orderNumber} 已标记为${a[e]}`,link:`/order/detail/${cs}`,metadata:{orderId:vs.id,orderNumber:vs.orderNumber,markType:e}})):V.error("更新订单标记失败")}catch(t){console.error("更新订单标记失败:",t),V.error("更新订单标记失败，请重试")}}).catch(()=>{})},Qs=async()=>{try{await J.confirm("确认审核通过此订单？","审核确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await new Promise(e=>setTimeout(e,1e3)),is.syncOrderStatus(cs,"pending_shipment","审核员","订单审核通过，等待发货"),vs.status="pending_shipment",ls.sendMessage({type:"ORDER_APPROVED",title:"订单审核通过",content:`订单 ${vs.orderNumber} (客户: ${vs.customer.name}, 金额: ¥${vs.totalAmount?.toLocaleString()}) 已审核通过`,link:`/order/detail/${cs}`,metadata:{orderId:cs,orderNo:vs.orderNumber,customerName:vs.customer.name,totalAmount:vs.totalAmount,auditResult:"approved"}}),V.success("订单审核通过")}catch(e){}},Gs=async()=>{try{const{value:e}=await J.prompt("请输入拒绝原因","审核拒绝",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"请输入拒绝原因"});await new Promise(e=>setTimeout(e,1e3)),is.syncOrderStatus(cs,"audit_rejected","审核员",`订单审核拒绝：${e}`),vs.status="audit_rejected",ls.sendMessage({type:"ORDER_REJECTED",title:"订单审核拒绝",content:`订单 ${vs.orderNumber} (客户: ${vs.customer.name}, 金额: ¥${vs.totalAmount?.toLocaleString()}) 已审核拒绝，原因: ${e}`,link:`/order/detail/${cs}`,metadata:{orderId:cs,orderNo:vs.orderNumber,customerName:vs.customer.name,totalAmount:vs.totalAmount,auditResult:"rejected",auditRemark:e}}),V.success("订单已拒绝")}catch(e){}},Xs=()=>{window.open(`tel:${vs.customer.phone}`)},ei=()=>{console.log("goToCustomerDetail called"),console.log("orderDetail.customer:",vs.customer),console.log("customer id:",vs.customer.id),console.log("跳转路径:",`/customer/detail/${vs.customer.id}`),ss.push(`/customer/detail/${vs.customer.id}`)},ai=async()=>{if(vs.trackingNumber){try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(vs.trackingNumber),V.success("物流单号已复制到剪贴板");else{const e=document.createElement("textarea");e.value=vs.trackingNumber,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const a=document.execCommand("copy");if(document.body.removeChild(e),!a)return void V.error("复制失败，请手动复制");V.success("物流单号已复制到剪贴板")}}catch(e){return console.error("复制失败:",e),void V.error("复制失败，请手动复制")}J.confirm("请选择要跳转的查询网站","选择查询网站",{confirmButtonText:"顺丰官网",cancelButtonText:"快递100",distinguishCancelAndClose:!0,type:"info"}).then(()=>{window.open("https://www.sf-express.com/chn/sc/waybill/list","_blank")}).catch(e=>{"cancel"===e&&window.open("https://www.kuaidi100.com/","_blank")})}else V.warning("物流单号不存在")},ti=async()=>{if(!vs.trackingNumber||!vs.expressCompany)return V.warning("缺少快递单号或快递公司信息"),void(gs.value=[]);try{Ts.value=!0;const e=await is.queryLogisticsTrack(cs);e&&e.tracks&&e.tracks.length>0?(gs.value=e.tracks.map(e=>({time:e.time,status:e.status,statusText:e.statusText||e.description||e.status,description:e.description||e.statusText||"状态更新",location:e.location||""})),e.estimatedDeliveryTime&&(e=>{try{const a=(e.tracks||[])[0];if(!a)return;const t=new Date;let s=0;const i=a.status||a.statusText||"",r=vs.expressCompany;if(i.includes("已签收")||i.includes("delivered"))return;s=i.includes("派送中")||i.includes("out_for_delivery")?.5:i.includes("到达")||i.includes("arrived")?1:i.includes("运输中")||i.includes("in_transit")?"SF"===r?1:"YTO"===r||"ZTO"===r?2:3:3;const l=new Date(t.getTime()+24*s*60*60*1e3);vs.expectedDeliveryDate=l.toISOString().split("T")[0]}catch(a){console.error("更新预计到达时间失败:",a)}})(e),V.success("物流信息已更新")):(gs.value=[],V.warning("暂无物流信息，可能是单号未录入系统或查询失败"))}catch(e){console.error("获取物流信息失败:",e),gs.value=[],V.error("获取物流信息失败，请检查网络连接或稍后重试")}finally{Ts.value=!1}},si=e=>{if(!e)return"info";const a={delivered:"success",out_for_delivery:"primary",in_transit:"primary",picked_up:"info",pending:"info",exception:"warning",rejected:"danger","已签收":"success","已送达":"success","派送中":"primary","运输中":"primary","在途":"primary","已揽收":"info","已发货":"info","待发货":"info","异常":"warning","拒收":"danger","退回":"danger"};return a[e]?a[e]:e.includes("签收")||e.includes("送达")?"success":e.includes("派送")||e.includes("运输")||e.includes("在途")?"primary":e.includes("揽收")||e.includes("发货")?"info":e.includes("异常")||e.includes("问题")?"warning":e.includes("拒收")||e.includes("退回")?"danger":"info"},ii=e=>({pending_transfer:"待流转",pending_audit:"待审核",audit_rejected:"审核拒绝",pending_shipment:"待发货",shipped:"已发货",delivered:"已签收",package_exception:"包裹异常",rejected:"拒收",rejected_returned:"拒收已退回",after_sales_created:"已建售后",cancelled:"已取消",draft:"草稿",pending:"待处理",pending_approval:"待审核",approved:"已审核",paid:"已付款",completed:"已完成",confirmed:"已确认"}[e]||e),ri=e=>{if(!e)return"-";if("other"===e&&vs.paymentMethodOther)return vs.paymentMethodOther;return{wechat:"微信支付",alipay:"支付宝",bank_transfer:"银行转账",unionpay:"云闪付",cod:"货到付款",cash:"现金",card:"刷卡",other:"其他"}[e]||e},li=e=>({vip:"VIP客户",premium:"高级客户",normal:"普通客户"}[e]||"普通客户"),di=e=>({sf:"顺丰速运",yt:"圆通速递",zt:"中通快递",st:"申通快递",yd:"韵达速递",bs:"百世快递",db:"德邦快递",jd:"京东物流"}[e]||e),ni=e=>({reserved:"预留单",normal:"正常发货单",return:"退单"}[e]||e),oi=()=>{if(!vs.markType)return"default";return{reserved:"warning",normal:"success",return:"danger"}[vs.markType]||"default"},ci=e=>e?new Date(e).toLocaleString("zh-CN"):"",ui=e=>e?new Date(e).toLocaleDateString("zh-CN"):"",mi=async()=>{try{os.value=!0,0===rs.customers.length&&await rs.loadCustomers();let a=null;try{console.log("[订单详情] 正在从API加载订单:",cs);const e=await se.getDetail(cs);e.success&&e.data&&(a=e.data,console.log("[订单详情] API加载成功:",a.orderNumber))}catch(e){console.warn("[订单详情] API加载失败，尝试从本地store获取:",e)}if(a||(a=is.getOrderById(cs)),!a)return V.error("订单不存在"),void ss.push("/order/list");const t=rs.getCustomerById(a.customerId);Object.assign(vs,{id:a.id,orderNumber:a.orderNumber,status:a.status,auditStatus:a.auditStatus||"pending",markType:a.markType||"normal",createTime:a.createTime,updateTime:a.createTime,auditTransferTime:a.auditTransferTime||"",isAuditTransferred:a.isAuditTransferred||!1,customer:t?{id:t.id,name:t.name,phone:t.phone,wechat:t.wechatId||"",address:t.address,level:t.level,avatar:""}:{id:a.customerId,name:a.customerName,phone:a.customerPhone,wechat:"",address:"",level:"normal",avatar:""},receiverName:a.receiverName,receiverPhone:a.receiverPhone,receiverAddress:a.receiverAddress,expressCompany:a.expressCompany||"",trackingNumber:a.trackingNumber||"",serviceWechat:a.serviceWechat||"",orderSource:a.orderSource||"",expectedShipDate:a.expectedShipDate||"",expectedDeliveryDate:a.expectedDeliveryDate||"",products:a.products,subtotal:a.subtotal,discount:a.discount,totalAmount:a.totalAmount,depositAmount:a.depositAmount,depositScreenshot:a.depositScreenshot||"",depositScreenshots:a.depositScreenshots||[],paymentMethod:a.paymentMethod||"",paymentMethodOther:a.paymentMethodOther||"",remark:a.remark}),js(),Cs(),Is(),vs.trackingNumber&&vs.expressCompany&&ti(),window.addEventListener("operation-log-update",xs),window.addEventListener("order-status-update",Ns),window.addEventListener("logistics-status-update",Ss),window.addEventListener("after-sales-update",As),window.addEventListener("service-status-update",Ds),pi()}catch(a){V.error("加载订单详情失败"),ss.push("/order/list")}finally{os.value=!1}},pi=()=>{console.log("[倒计时] 初始化倒计时",{markType:vs.markType,status:vs.status,auditStatus:vs.auditStatus,isAuditTransferred:vs.isAuditTransferred,auditTransferTime:vs.auditTransferTime}),ms.value&&(clearInterval(ms.value),ms.value=null),"normal"===vs.markType&&"pending_transfer"===vs.status?vs.isAuditTransferred?console.log("[倒计时] 订单已流转，跳过"):vs.auditTransferTime?(vi(),ms.value=setInterval(vi,1e3),console.log("[倒计时] 倒计时已启动")):console.log("[倒计时] 没有流转时间，无法启动倒计时"):console.log("[倒计时] 不满足倒计时条件，跳过")},vi=()=>{if(!vs.auditTransferTime)return;const e=new Date(vs.auditTransferTime).getTime(),a=Date.now(),t=Math.max(0,e-a);if(console.log("[倒计时] 更新倒计时",{"流转时间字符串":vs.auditTransferTime,"流转时间戳":e,"当前时间戳":a,"剩余毫秒":t,"剩余秒数":Math.floor(t/1e3)}),t<=0)return us.value=0,ps.value="正在流转...",ms.value&&(clearInterval(ms.value),ms.value=null),void fi();us.value=Math.floor(t/1e3);const s=Math.floor(us.value/60),i=us.value%60;ps.value=`${s}分${i.toString().padStart(2,"0")}秒`},fi=()=>{vs.isAuditTransferred=!0,vs.status="pending_audit",vs.auditStatus="pending",is.updateOrder(cs,{isAuditTransferred:!0,status:"pending_audit",auditStatus:"pending"}),is.checkAndTransferOrders(),V.info("订单已自动流转到审核"),ls.sendMessage({type:"ORDER_TRANSFERRED",title:"订单流转审核",content:`订单 ${vs.orderNumber} 已自动流转到审核`,link:`/order/detail/${cs}`,metadata:{orderId:vs.id,orderNumber:vs.orderNumber}})};return l(()=>{mi()}),d(()=>{ms.value&&(clearInterval(ms.value),ms.value=null),window.removeEventListener("operation-log-update",xs),window.removeEventListener("order-status-update",Ns),window.removeEventListener("logistics-status-update",Ss),window.removeEventListener("after-sales-update",As),window.removeEventListener("service-status-update",Ds)}),(e,a)=>{const t=n("el-button"),s=n("el-tooltip"),i=n("el-icon"),r=n("el-dropdown-item"),l=n("el-dropdown-menu"),d=n("el-dropdown"),W=n("el-tag"),V=n("el-avatar"),J=n("el-card"),Z=n("InfoFilled"),Q=n("el-table-column"),G=n("el-table"),X=n("el-image"),ae=n("el-image-viewer"),te=n("el-timeline-item"),se=n("el-timeline"),ie=n("el-empty"),ts=n("el-collapse-transition"),ss=n("el-skeleton");return c(),o("div",le,[u("div",de,[u("div",ne,[p(t,{onClick:Js,icon:v(T),circle:""},null,8,["icon"]),u("div",oe,[a[6]||(a[6]=u("h2",null,"订单详情",-1)),u("div",ce,"订单号："+f(vs.orderNumber),1)])]),u("div",ue,[p(s,{content:Ps.value?"点击创建售后服务":"订单需要发货后才能建立售后",placement:"bottom"},{default:y(()=>[p(t,{type:"primary",disabled:!Ps.value,onClick:Ys},{default:y(()=>[...a[7]||(a[7]=[h(" 建立售后 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["content"]),p(d,{onCommand:Zs,class:"mark-dropdown",disabled:!Fs.value},{dropdown:y(()=>[p(l,null,{default:y(()=>[p(r,{command:"reserved",disabled:"reserved"===vs.markType},{default:y(()=>[...a[9]||(a[9]=[h("预留单",-1)])]),_:1},8,["disabled"]),p(r,{command:"normal",disabled:"normal"===vs.markType},{default:y(()=>[...a[10]||(a[10]=[h("正常发货单",-1)])]),_:1},8,["disabled"]),p(r,{command:"return",disabled:"return"===vs.markType},{default:y(()=>[...a[11]||(a[11]=[h("退单",-1)])]),_:1},8,["disabled"])]),_:1})]),default:y(()=>[p(t,{icon:v(x),type:oi(),disabled:!Fs.value},{default:y(()=>[a[8]||(a[8]=h(" 标记 ",-1)),p(i,{class:"el-icon--right"},{default:y(()=>[p(v(N))]),_:1})]),_:1},8,["icon","type","disabled"])]),_:1},8,["disabled"]),!Fs.value&&Bs.value?(c(),g(s,{key:0,content:"订单正在审核中，无法修改标记",placement:"top"},{default:y(()=>[p(i,{class:"audit-lock-icon"},{default:y(()=>[p(v(S))]),_:1})]),_:1})):m("",!0),vs.markType?(c(),o("div",me,[p(W,{type:(is=vs.markType,{reserved:"warning",normal:"success",return:"danger"}[is]||"info"),size:"default",effect:"dark"},{default:y(()=>[h(f(ni(vs.markType)),1)]),_:1},8,["type"])])):m("",!0),Rs.value?(c(),g(t,{key:2,type:"success",onClick:Qs},{default:y(()=>[...a[12]||(a[12]=[h("审核通过",-1)])]),_:1})):m("",!0),Ls.value?(c(),g(t,{key:3,type:"danger",onClick:Gs},{default:y(()=>[...a[13]||(a[13]=[h("审核拒绝",-1)])]),_:1})):m("",!0)])]),u("div",pe,[p(J,{class:"customer-info-card modern-card"},{header:y(()=>[u("div",ve,[u("div",fe,[p(i,{class:"header-icon"},{default:y(()=>[p(v(I))]),_:1}),a[14]||(a[14]=u("span",{class:"header-title"},"客户信息",-1))]),u("div",ge,[p(t,{type:"text",size:"small",onClick:ei,class:"view-more-btn"},{default:y(()=>[a[15]||(a[15]=h(" 查看更多 ",-1)),p(i,{class:"ml-1"},{default:y(()=>[p(v($))]),_:1})]),_:1})])])]),default:y(()=>{return[u("div",ye,[u("div",he,[u("div",_e,[p(V,{size:64,src:vs.customer.avatar,class:"customer-avatar-modern"},{default:y(()=>[h(f(vs.customer.name.charAt(0)),1)]),_:1},8,["src"]),p(W,{type:(e=vs.customer.level,{vip:"warning",premium:"danger",normal:"info"}[e]||"info"),size:"small",class:"customer-level-tag",effect:"light"},{default:y(()=>[h(f(li(vs.customer.level)),1)]),_:1},8,["type"])]),u("div",we,[u("div",ke,f(vs.customer.name),1),u("div",be,[u("div",{class:"contact-item-modern phone-item-modern",onClick:Xs},[p(i,{class:"contact-icon"},{default:y(()=>[p(v(A))]),_:1}),u("span",Te,f(v(re)(vs.customer.phone,v(ee).PHONE,v(ns).currentUser?.id||"")),1),p(i,{class:"call-icon"},{default:y(()=>[p(v(A))]),_:1})]),u("div",xe,[p(i,{class:"contact-icon"},{default:y(()=>[p(v(D))]),_:1}),u("span",Ne,f(vs.customer.wechat||"未设置微信"),1)]),u("div",Se,[p(i,{class:"contact-icon"},{default:y(()=>[p(v(C))]),_:1}),u("span",Ae,f(vs.customer.address),1)])])])])])];var e}),_:1})]),u("div",De,[p(J,{class:"modern-card order-status-modern order-status-horizontal"},{default:y(()=>{return[u("div",Ce,[u("div",Ie,[p(i,{class:"status-icon"},{default:y(()=>[p(v(j))]),_:1}),a[16]||(a[16]=u("span",{class:"title-text"},"订单状态",-1))]),u("div",$e,[p(W,{type:(e=vs.status,{pending_transfer:"info",pending_audit:"warning",audit_rejected:"danger",pending_shipment:"primary",shipped:"primary",delivered:"success",package_exception:"warning",rejected:"danger",rejected_returned:"info",after_sales_created:"warning",cancelled:"info",draft:"info",pending:"warning",pending_approval:"warning",approved:"success",paid:"success",completed:"success",confirmed:"success"}[e]||"info"),class:"status-tag-modern",effect:"light"},{default:y(()=>[h(f(ii(vs.status)),1)]),_:1},8,["type"]),Os.value?(c(),o("div",je,[u("div",Ee,[p(i,{class:"countdown-icon"},{default:y(()=>[p(v(E))]),_:1}),u("span",ze,f(ps.value),1)]),a[17]||(a[17]=u("div",{class:"countdown-tip"},"请在倒计时结束前完成审核",-1))])):m("",!0)])]),u("div",Me,[u("div",Oe,[a[19]||(a[19]=u("div",{class:"timeline-dot"},null,-1)),u("div",Pe,[a[18]||(a[18]=u("div",{class:"timeline-label"},"创建时间",-1)),u("div",Re,f(ci(vs.createTime)),1)])]),u("div",Le,[a[21]||(a[21]=u("div",{class:"timeline-dot"},null,-1)),u("div",Fe,[a[20]||(a[20]=u("div",{class:"timeline-label"},"更新时间",-1)),u("div",Be,f(ci(vs.updateTime)),1)])]),Os.value?(c(),o("div",qe,[a[24]||(a[24]=u("div",{class:"timeline-dot countdown-dot"},null,-1)),u("div",He,[a[23]||(a[23]=u("div",{class:"timeline-label"},"流转审核倒计时",-1)),u("div",We,[h(f(ps.value)+" ",1),p(W,{type:"warning",size:"small",class:"countdown-badge"},{default:y(()=>[p(i,null,{default:y(()=>[p(v(E))]),_:1}),a[22]||(a[22]=h(" 自动流转中 ",-1))]),_:1})])])])):m("",!0),Us.value?(c(),o("div",Ke,[p(i,{class:"tip-icon"},{default:y(()=>[p(Z)]),_:1}),a[25]||(a[25]=u("span",{class:"tip-text"},"流转前可修改为预留单，修改后将不会流转到审核",-1))])):m("",!0)])];var e}),_:1})]),u("div",Ue,[p(J,{class:"modern-card delivery-info-card"},{header:y(()=>[u("div",Ve,[u("div",Je,[p(i,{class:"header-icon"},{default:y(()=>[p(v(z))]),_:1}),a[26]||(a[26]=u("span",{class:"header-title"},"收货信息",-1))])])]),default:y(()=>[u("div",Ye,[u("div",Ze,[u("div",Qe,[a[27]||(a[27]=u("div",{class:"field-label-modern"},"收货人",-1)),u("div",Ge,f(vs.receiverName),1)]),u("div",Xe,[a[28]||(a[28]=u("div",{class:"field-label-modern"},"联系电话",-1)),u("div",{class:"field-value-modern phone-clickable",onClick:a[0]||(a[0]=e=>Xs(vs.receiverPhone))},f(v(re)(vs.receiverPhone,v(ee).PHONE)),1)]),u("div",ea,[a[29]||(a[29]=u("div",{class:"field-label-modern"},"收货地址",-1)),u("div",aa,f(vs.receiverAddress),1)])])])]),_:1})]),u("div",ta,[p(J,{class:"order-info-card modern-card"},{header:y(()=>[u("div",sa,[u("div",ia,[p(i,{class:"header-icon"},{default:y(()=>[p(v(O))]),_:1}),a[30]||(a[30]=u("span",{class:"header-title"},"订单信息",-1))])])]),default:y(()=>{return[u("div",ra,[u("div",la,[u("div",da,[u("div",na,[a[31]||(a[31]=u("div",{class:"info-label"},"订单号",-1)),u("div",oa,f(vs.orderNumber),1)]),u("div",ca,[a[32]||(a[32]=u("div",{class:"info-label"},"下单时间",-1)),u("div",ua,f(ci(vs.createTime)),1)]),u("div",ma,[a[33]||(a[33]=u("div",{class:"info-label"},"客服微信",-1)),u("div",pa,f(vs.serviceWechat),1)]),u("div",va,[a[34]||(a[34]=u("div",{class:"info-label"},"订单来源",-1)),u("div",fa,f((e=vs.orderSource,{online_store:"线上商城",wechat_mini:"微信小程序",wechat_service:"微信客服",phone_call:"电话咨询",offline_store:"线下门店",referral:"客户推荐",advertisement:"广告投放",other:"其他渠道"}[e]||e)),1)])])]),u("div",ga,[u("div",ya,[p(i,null,{default:y(()=>[p(v(z))]),_:1}),a[37]||(a[37]=u("span",null,"物流信息",-1)),"shipped"===vs.status?(c(),g(W,{key:0,type:"success",size:"small",effect:"light",class:"status-indicator"},{default:y(()=>[...a[35]||(a[35]=[h(" 已发货 ",-1)])]),_:1})):"pending_shipment"===vs.status?(c(),g(W,{key:1,type:"warning",size:"small",effect:"light",class:"status-indicator"},{default:y(()=>[...a[36]||(a[36]=[h(" 待发货 ",-1)])]),_:1})):(c(),g(W,{key:2,type:"info",size:"small",effect:"light",class:"status-indicator"},{default:y(()=>[h(f(ii(vs.status)),1)]),_:1}))]),"shipped"===vs.status&&vs.trackingNumber?(c(),o("div",ha,[u("div",_a,[a[38]||(a[38]=u("div",{class:"logistics-label"},"快递公司",-1)),u("div",wa,f(di(vs.expressCompany)),1)]),u("div",ka,[a[40]||(a[40]=u("div",{class:"logistics-label"},"物流单号",-1)),u("div",ba,[h(f(vs.trackingNumber)+" ",1),p(t,{size:"small",type:"primary",text:"",onClick:ai,class:"track-btn"},{default:y(()=>[p(i,null,{default:y(()=>[p(v(M))]),_:1}),a[39]||(a[39]=h(" 查询 ",-1))]),_:1})])]),u("div",Ta,[a[41]||(a[41]=u("div",{class:"logistics-label"},"预计发货",-1)),u("div",xa,f(ui(vs.expectedShipDate)||"已发货"),1)]),u("div",Na,[a[42]||(a[42]=u("div",{class:"logistics-label"},"预计到达",-1)),u("div",Sa,f(ui(vs.expectedDeliveryDate)||"计算中..."),1)])])):(c(),o("div",Aa,[u("div",Da,[a[43]||(a[43]=u("div",{class:"logistics-label"},"预计发货",-1)),u("div",Ca,f(ui(vs.expectedShipDate)||"待确定"),1)]),u("div",Ia,[a[44]||(a[44]=u("div",{class:"logistics-label"},"预计到达",-1)),u("div",$a,f(ui(vs.expectedDeliveryDate)||"待确定"),1)]),u("div",ja,[a[45]||(a[45]=u("div",{class:"logistics-label"},"快递公司",-1)),u("div",Ea,f(di(vs.expressCompany)||"待确定"),1)]),a[46]||(a[46]=u("div",{class:"logistics-item"},[u("div",{class:"logistics-label"},"物流单号"),u("div",{class:"logistics-value pending-text"},"待发货后生成")],-1))]))]),vs.remark?(c(),o("div",za,[u("div",Ma,[p(i,null,{default:y(()=>[p(v(O))]),_:1}),a[47]||(a[47]=u("span",null,"订单备注",-1))]),u("div",Oa,f(vs.remark),1)])):m("",!0)])];var e}),_:1})]),u("div",Pa,[p(J,{class:"products-card"},{header:y(()=>[u("div",Ra,[p(i,null,{default:y(()=>[p(v(F))]),_:1}),a[48]||(a[48]=u("span",null,"商品清单",-1))])]),default:y(()=>[u("div",La,[p(G,{data:vs.products,style:{width:"100%"}},{default:y(()=>[p(Q,{label:"商品信息","min-width":"200"},{default:y(({row:e})=>[u("div",Fa,[u("div",Ba,[u("img",{src:e.image||"/default-product.png",alt:e.name},null,8,qa)]),u("div",Ha,[u("div",Wa,f(e.name),1),u("div",Ka,"SKU: "+f(e.sku||e.id),1)])])]),_:1}),p(Q,{prop:"price",label:"单价",width:"100"},{default:y(({row:e})=>[h(" ¥"+f(e.price.toFixed(2)),1)]),_:1}),p(Q,{prop:"quantity",label:"数量",width:"80"}),p(Q,{label:"小计",width:"120"},{default:y(({row:e})=>[h(" ¥"+f((e.price*e.quantity).toFixed(2)),1)]),_:1})]),_:1},8,["data"]),u("div",Ua,[u("div",Va,[u("div",Ja,[u("div",Ya,[p(i,null,{default:y(()=>[p(v(P))]),_:1})]),u("div",Za,[a[49]||(a[49]=u("div",{class:"amount-label-modern"},"订单总额",-1)),u("div",Qa,"¥"+f((vs.totalAmount||0).toFixed(2)),1)])]),(vs.depositAmount||0)>0?(c(),o("div",Ga,[u("div",Xa,[p(i,null,{default:y(()=>[p(v(R))]),_:1})]),u("div",et,[a[50]||(a[50]=u("div",{class:"amount-label-modern"},"定金",-1)),u("div",at,"¥"+f((vs.depositAmount||0).toFixed(2)),1)])])):m("",!0),(vs.depositAmount||0)>0?(c(),o("div",tt,[u("div",st,[p(i,null,{default:y(()=>[p(v(L))]),_:1})]),u("div",it,[a[51]||(a[51]=u("div",{class:"amount-label-modern"},"代收",-1)),u("div",rt,"¥"+f(((vs.totalAmount||0)-(vs.depositAmount||0)).toFixed(2)),1)])])):m("",!0),vs.paymentMethod?(c(),o("div",lt,[u("div",dt,[p(i,null,{default:y(()=>[p(v(R))]),_:1})]),u("div",nt,[a[52]||(a[52]=u("div",{class:"amount-label-modern"},"支付方式",-1)),u("div",ot,f(ri(vs.paymentMethod)),1)])])):m("",!0)]),u("div",ct,[u("div",ut,[a[53]||(a[53]=u("span",{class:"detail-label"},"商品总额：",-1)),u("span",mt,"¥"+f(Ks.value.toFixed(2)),1)]),(vs.discount||0)>0?(c(),o("div",pt,[a[54]||(a[54]=u("span",{class:"detail-label"},"优惠金额：",-1)),u("span",vt,"-¥"+f((vs.discount||0).toFixed(2)),1)])):m("",!0),Ks.value>(vs.totalAmount||0)?(c(),o("div",ft,[a[55]||(a[55]=u("span",{class:"detail-label"},"已优惠：",-1)),u("span",gt,"-¥"+f((Ks.value-(vs.totalAmount||0)).toFixed(2)),1)])):m("",!0),vs.paymentMethod?(c(),o("div",yt,[a[56]||(a[56]=u("span",{class:"detail-label"},"支付方式：",-1)),u("span",ht,f(ri(vs.paymentMethod)),1)])):m("",!0)]),Vs.value.length>0?(c(),o("div",_t,[a[57]||(a[57]=u("span",{class:"label"},"定金截图：",-1)),u("div",wt,[(c(!0),o(_,null,w(Vs.value,(e,a)=>(c(),o("div",{key:a,class:"screenshot-container",onClick:e=>(e=>{Hs.value=e,qs.value=!0})(a)},[p(X,{src:e,fit:"cover",style:{width:"60px",height:"45px","border-radius":"4px","margin-left":"8px"}},null,8,["src"]),u("div",bt,[p(i,{class:"zoom-icon"},{default:y(()=>[p(v(M))]),_:1})])],8,kt))),128)),Vs.value.length>1?(c(),o("div",Tt," 共"+f(Vs.value.length)+"张 ",1)):m("",!0)])])):m("",!0),qs.value?(c(),g(ae,{key:1,"url-list":Vs.value,"initial-index":Hs.value,onClose:a[1]||(a[1]=e=>qs.value=!1)},null,8,["url-list","initial-index"])):m("",!0)])])]),_:1})]),u("div",xt,[p(J,{class:"logistics-card"},{header:y(()=>[u("div",Nt,[p(i,null,{default:y(()=>[p(v(z))]),_:1}),a[59]||(a[59]=u("span",null,"物流信息跟踪",-1)),p(t,{size:"small",onClick:ti},{default:y(()=>[...a[58]||(a[58]=[h("刷新",-1)])]),_:1})])]),default:y(()=>[u("div",St,[gs.value.length>0?(c(),g(se,{key:0},{default:y(()=>[(c(!0),o(_,null,w(gs.value,(e,a)=>(c(),g(te,{key:a,timestamp:e.time,type:si(e.statusText),placement:"top"},{default:y(()=>[u("div",At,[u("div",Dt,[p(W,{type:si(e.statusText)},{default:y(()=>[h(f(e.statusText||e.status),1)]),_:2},1032,["type"])]),u("div",Ct,f(e.description),1),e.location?(c(),o("div",It,[p(i,null,{default:y(()=>[p(v(C))]),_:1}),h(" "+f(e.location),1)])):m("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(c(),g(ie,{key:1,description:"暂无物流信息"}))])]),_:1})]),u("div",$t,[p(J,{class:"operation-log-card"},{header:y(()=>[u("div",jt,[p(i,null,{default:y(()=>[p(v(B))]),_:1}),a[60]||(a[60]=u("span",null,"操作记录",-1)),p(t,{size:"small",type:"text",onClick:a[2]||(a[2]=e=>_s.value=!_s.value),icon:_s.value?v(N):v(q)},{default:y(()=>[h(f(_s.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),default:y(()=>[p(ts,null,{default:y(()=>[k(u("div",null,[p(G,{data:ys.value,style:{width:"100%"}},{default:y(()=>[p(Q,{prop:"time",label:"操作时间",width:"180"},{default:y(({row:e})=>[h(f(ci(e.time)),1)]),_:1}),p(Q,{prop:"operator",label:"操作人",width:"120"}),p(Q,{prop:"action",label:"操作类型",width:"120"}),p(Q,{prop:"description",label:"操作描述"}),p(Q,{prop:"remark",label:"备注",width:"200"})]),_:1},8,["data"])],512),[[b,!_s.value]])]),_:1})]),_:1})]),u("div",Et,[p(J,{class:"status-timeline-card"},{header:y(()=>[u("div",zt,[p(i,null,{default:y(()=>[p(v(j))]),_:1}),a[61]||(a[61]=u("span",null,"订单状态和轨迹",-1)),p(t,{size:"small",type:"text",onClick:a[3]||(a[3]=e=>ws.value=!ws.value),icon:ws.value?v(N):v(q)},{default:y(()=>[h(f(ws.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),default:y(()=>[p(ts,null,{default:y(()=>[k(u("div",null,[p(se,null,{default:y(()=>[(c(!0),o(_,null,w(fs.value,(e,a)=>(c(),g(te,{key:a,timestamp:e.timestamp,type:e.type,icon:e.icon,color:e.color},{default:y(()=>[u("div",Mt,[u("div",Ot,f(e.title),1),u("div",Pt,f(e.description),1),e.operator?(c(),o("div",Rt,"操作人："+f(e.operator),1)):m("",!0)])]),_:2},1032,["timestamp","type","icon","color"]))),128))]),_:1})],512),[[b,!ws.value]])]),_:1})]),_:1})]),Ws.value?(c(),o("div",Lt,[p(J,{class:"logistics-track-card"},{header:y(()=>[u("div",Ft,[p(i,null,{default:y(()=>[p(v(z))]),_:1}),a[62]||(a[62]=u("span",null,"物流轨迹",-1)),u("div",Bt,[vs.expressCompany?(c(),g(W,{key:0,type:"info",size:"small"},{default:y(()=>[h(f(vs.expressCompany),1)]),_:1})):m("",!0),vs.trackingNumber?(c(),o("span",qt,f(vs.trackingNumber),1)):m("",!0)]),p(t,{size:"small",type:"text",onClick:a[4]||(a[4]=e=>bs.value=!bs.value),icon:bs.value?v(N):v(q)},{default:y(()=>[h(f(bs.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),default:y(()=>[p(ts,null,{default:y(()=>[k(u("div",null,[Ts.value?(c(),o("div",Ht,[p(ss,{rows:3,animated:""})])):gs.value.length>0?(c(),g(se,{key:1},{default:y(()=>[(c(!0),o(_,null,w(gs.value,(e,a)=>{return c(),g(te,{key:a,timestamp:e.time,type:si(e.status),icon:(t=e.status,{delivered:U,out_for_delivery:z,in_transit:z,picked_up:z,pending:j,exception:Y,rejected:K}[t]||j)},{default:y(()=>[u("div",Wt,[u("div",Kt,f(e.statusText),1),u("div",Ut,f(e.description),1),e.location?(c(),o("div",Vt,[p(i,null,{default:y(()=>[p(v(C))]),_:1}),h(" "+f(e.location),1)])):m("",!0)])]),_:2},1032,["timestamp","type","icon"]);var t}),128))]),_:1})):(c(),g(ie,{key:2,description:"暂无物流信息"})),u("div",Jt,[p(t,{size:"small",type:"primary",loading:Ts.value,onClick:ti},{default:y(()=>[...a[63]||(a[63]=[h(" 刷新物流信息 ",-1)])]),_:1},8,["loading"])])],512),[[b,!bs.value]])]),_:1})]),_:1})])):m("",!0),u("div",Yt,[p(J,{class:"after-sales-card"},{header:y(()=>[u("div",Zt,[p(i,null,{default:y(()=>[p(v(H))]),_:1}),a[64]||(a[64]=u("span",null,"售后历史轨迹",-1)),p(t,{size:"small",type:"text",onClick:a[5]||(a[5]=e=>ks.value=!ks.value),icon:ks.value?v(N):v(q)},{default:y(()=>[h(f(ks.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),default:y(()=>[p(ts,null,{default:y(()=>[k(u("div",null,[hs.value.length>0?(c(),g(se,{key:0},{default:y(()=>[(c(!0),o(_,null,w(hs.value,(e,a)=>{return c(),g(te,{key:a,timestamp:e.timestamp,type:(t=e.type,{refund:"warning",return:"danger",exchange:"primary",repair:"info",complaint:"danger"}[t]||"info")},{default:y(()=>[u("div",Qt,[u("div",Gt,f(e.title),1),u("div",Xt,f(e.description),1),e.operator?(c(),o("div",es,"处理人："+f(e.operator),1)):m("",!0),e.amount?(c(),o("div",as,"金额：¥"+f(e.amount.toFixed(2)),1)):m("",!0)])]),_:2},1032,["timestamp","type"]);var t}),128))]),_:1})):(c(),g(ie,{key:1,description:"暂无售后记录"}))],512),[[b,!ks.value]])]),_:1})]),_:1})])]);var is}}}),[["__scopeId","data-v-c7fb3670"]]);export{ts as default};
