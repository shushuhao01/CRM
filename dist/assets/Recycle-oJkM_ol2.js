import{A as e,T as a,I as l,F as t,at as s,a3 as n,w as u,E as d,b as o}from"./elementPlus-DxaqjplL.js";import{u as r}from"./data-CMMX0NjI.js";import{a as i}from"./sensitiveInfo-DVfrBLrU.js";import{S as c,_ as v}from"./index-DkAJPKqn.js";import{l as p,r as m,e as f,b as g,ag as w,aq as h,m as b,q as _,p as y,U as D,S as C,O as x,u as A,T as k,F as T,a9 as V,M as N,P as B,J as z}from"./vendor-BtukhyiH.js";import"./env-DLalhsF6.js";import"./utils-DfI7e5Rl.js";const S={class:"recycle-container"},j={class:"page-header"},U={class:"header-content"},P={class:"page-title"},R={class:"summary-cards"},L={class:"card-item"},I={class:"card-icon total"},$={class:"card-content"},F={class:"card-number"},q={class:"card-item"},E={class:"card-icon recent"},M={class:"card-content"},O={class:"card-number"},G={class:"card-item"},H={class:"card-icon warning"},J={class:"card-content"},Y={class:"card-number"},K={class:"filter-section"},Q={class:"filter-row"},W={class:"search-group"},X={class:"filter-group"},Z={class:"list-section"},ee={class:"list-header"},ae={class:"list-info"},le={class:"total-count"},te={class:"list-actions"},se={class:"table-container"},ne={class:"amount"},ue={class:"delete-reason"},de={class:"pagination-container"},oe={class:"delete-warning"},re={class:"warning-content"},ie=v(p({__name:"Recycle",setup(v){const p=r(),ie=m(!1),ce=m(""),ve=m(""),pe=m(""),me=m([]),fe=m(1),ge=m(20),we=m(!1),he=m(!1),be=m([{id:"1",customerName:"张三",phone:"13800138001",orderAmount:5e3,orderDate:"2024-01-15",deletedAt:"2024-01-20T10:30:00",deletedBy:"user1",deletedByName:"李经理",deleteReason:"重复资料",expiresAt:"2024-02-20T10:30:00"},{id:"2",customerName:"李四",phone:"13800138002",orderAmount:3e3,orderDate:"2024-01-10",deletedAt:"2024-01-18T14:20:00",deletedBy:"user2",deletedByName:"王主管",deleteReason:"客户要求删除",expiresAt:"2024-02-18T14:20:00"},{id:"3",customerName:"王五",phone:"13800138003",orderAmount:8e3,orderDate:"2024-01-05",deletedAt:"2024-01-25T09:15:00",deletedBy:"user1",deletedByName:"李经理",deleteReason:"无效订单",expiresAt:"2024-02-25T09:15:00"}]),_e=m([{id:"user1",name:"李经理"},{id:"user2",name:"王主管"},{id:"user3",name:"张组长"}]),ye=f(()=>{const e=new Date,a=new Date(e.getTime()-6048e5),l=new Date(e.getTime()+2592e5);return{totalCount:be.value.length,recentCount:be.value.filter(e=>new Date(e.deletedAt)>=a).length,expiringSoonCount:be.value.filter(e=>new Date(e.expiresAt)<=l).length}}),De=f(()=>{let e=be.value;if(ce.value){const a=ce.value.toLowerCase();e=e.filter(e=>e.customerName.toLowerCase().includes(a)||e.phone.includes(a))}if(ve.value){const a=new Date;let l;switch(ve.value){case"today":l=new Date(a.getFullYear(),a.getMonth(),a.getDate());break;case"week":l=new Date(a.getTime()-6048e5);break;case"month":l=new Date(a.getTime()-2592e6);break;default:l=new Date(0)}e=e.filter(e=>new Date(e.deletedAt)>=l)}return pe.value&&(e=e.filter(e=>e.deletedBy===pe.value)),e}),Ce=f(()=>{const e=(fe.value-1)*ge.value,a=e+ge.value;return De.value.slice(e,a)}),xe=()=>{fe.value=1},Ae=e=>{me.value=e},ke=e=>{ge.value=e,fe.value=1},Te=e=>{fe.value=e},Ve=e=>e?new Date(e).toLocaleString("zh-CN"):"-",Ne=e=>{const a=new Date,l=new Date(e),t=new Date(a.getTime()+2592e5);return l<=a?"expired":l<=t?"expiring-soon":""},Be=()=>{me.value&&0!==me.value.length?we.value=!0:d.warning("请选择要恢复的记录")},ze=async()=>{try{ie.value=!0;for(const a of me.value)await p.recoverData(a.id,"从回收站恢复");const e=me.value.map(e=>e.id);be.value=be.value.filter(a=>!e.includes(a.id)),d.success(`成功恢复 ${me.value.length} 条记录到已回收列表`),we.value=!1,me.value=[]}catch(e){d.error("恢复失败，请重试")}finally{ie.value=!1}},Se=()=>{me.value&&0!==me.value.length?he.value=!0:d.warning("请选择要删除的记录")},je=async()=>{try{ie.value=!0,await new Promise(e=>setTimeout(e,1e3));const e=me.value.map(e=>e.id);be.value=be.value.filter(a=>!e.includes(a.id)),d.success(`成功删除 ${me.value.length} 条记录`),he.value=!1,me.value=[]}catch(e){d.error("删除失败，请重试")}finally{ie.value=!1}},Ue=async()=>{const e=new Date,a=be.value.filter(a=>new Date(a.expiresAt)<=e);if(0!==a.length)try{await o.confirm(`发现 ${a.length} 条过期记录，确定要清理吗？`,"清理过期记录",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),ie.value=!0,await new Promise(e=>setTimeout(e,1e3)),be.value=be.value.filter(a=>new Date(a.expiresAt)>e),d.success(`成功清理 ${a.length} 条过期记录`)}catch{}finally{ie.value=!1}else d.info("没有过期的记录")};return g(()=>{}),(d,o)=>{const r=w("el-icon"),v=w("el-input"),p=w("el-option"),m=w("el-select"),f=w("el-button"),g=w("el-table-column"),be=w("el-table"),Pe=w("el-pagination"),Re=w("el-dialog"),Le=h("loading");return _(),b("div",S,[y("div",j,[y("div",U,[y("h1",P,[D(r,{class:"title-icon"},{default:x(()=>[D(A(e))]),_:1}),o[9]||(o[9]=C(" 回收站 ",-1))]),o[10]||(o[10]=y("p",{class:"page-description"},"管理已删除的客户资料，支持恢复和永久删除操作",-1))])]),y("div",R,[y("div",L,[y("div",I,[D(r,null,{default:x(()=>[D(A(e))]),_:1})]),y("div",$,[y("div",F,k(ye.value.totalCount),1),o[11]||(o[11]=y("div",{class:"card-label"},"回收总数",-1))])]),y("div",q,[y("div",E,[D(r,null,{default:x(()=>[D(A(a))]),_:1})]),y("div",M,[y("div",O,k(ye.value.recentCount),1),o[12]||(o[12]=y("div",{class:"card-label"},"近7天删除",-1))])]),y("div",G,[y("div",H,[D(r,null,{default:x(()=>[D(A(l))]),_:1})]),y("div",J,[y("div",Y,k(ye.value.expiringSoonCount),1),o[13]||(o[13]=y("div",{class:"card-label"},"即将过期",-1))])])]),y("div",K,[y("div",Q,[y("div",W,[D(v,{modelValue:ce.value,"onUpdate:modelValue":o[0]||(o[0]=e=>ce.value=e),placeholder:"搜索客户姓名、电话...",clearable:"",onInput:xe,class:"search-input"},{prefix:x(()=>[D(r,null,{default:x(()=>[D(A(t))]),_:1})]),_:1},8,["modelValue"])]),y("div",X,[D(m,{modelValue:ve.value,"onUpdate:modelValue":o[1]||(o[1]=e=>ve.value=e),placeholder:"删除时间",clearable:"",class:"filter-select"},{default:x(()=>[D(p,{label:"全部时间",value:""}),D(p,{label:"今天",value:"today"}),D(p,{label:"近7天",value:"week"}),D(p,{label:"近30天",value:"month"})]),_:1},8,["modelValue"]),D(m,{modelValue:pe.value,"onUpdate:modelValue":o[2]||(o[2]=e=>pe.value=e),placeholder:"删除人",clearable:"",class:"filter-select"},{default:x(()=>[D(p,{label:"全部删除人",value:""}),(_(!0),b(T,null,V(_e.value,e=>(_(),N(p,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),y("div",Z,[y("div",ee,[y("div",ae,[y("span",le,"共 "+k(De.value.length)+" 条记录",1)]),y("div",te,[D(f,{type:"success",disabled:0===me.value.length,onClick:Be},{default:x(()=>[D(r,null,{default:x(()=>[D(A(s))]),_:1}),C(" 批量恢复 ("+k(me.value.length)+") ",1)]),_:1},8,["disabled"]),D(f,{type:"danger",disabled:0===me.value.length,onClick:Se},{default:x(()=>[D(r,null,{default:x(()=>[D(A(e))]),_:1}),o[14]||(o[14]=C(" 永久删除 ",-1))]),_:1},8,["disabled"]),D(f,{type:"warning",onClick:Ue},{default:x(()=>[D(r,null,{default:x(()=>[D(A(n))]),_:1}),o[15]||(o[15]=C(" 清理过期 ",-1))]),_:1})])]),y("div",se,[B((_(),N(be,{data:Ce.value,onSelectionChange:Ae,stripe:"",class:"data-table"},{default:x(()=>[D(g,{type:"selection",width:"55"}),D(g,{prop:"customerName",label:"客户姓名",width:"120"}),D(g,{prop:"phone",label:"联系电话",width:"130"},{default:x(({row:e})=>[C(k(A(i)(e.phone,A(c).PHONE)),1)]),_:1}),D(g,{prop:"orderAmount",label:"订单金额",width:"120"},{default:x(({row:e})=>[y("span",ne,"¥"+k(e.orderAmount?.toLocaleString()||0),1)]),_:1}),D(g,{prop:"orderDate",label:"下单日期",width:"120"},{default:x(({row:e})=>{return[C(k((a=e.orderDate,a?new Date(a).toLocaleDateString("zh-CN"):"-")),1)];var a}),_:1}),D(g,{prop:"deletedAt",label:"删除时间",width:"150"},{default:x(({row:e})=>[C(k(Ve(e.deletedAt)),1)]),_:1}),D(g,{prop:"deletedBy",label:"删除人",width:"100"},{default:x(({row:e})=>[C(k(e.deletedByName),1)]),_:1}),D(g,{prop:"deleteReason",label:"删除原因","min-width":"150"},{default:x(({row:e})=>[y("span",ue,k(e.deleteReason||"无"),1)]),_:1}),D(g,{prop:"expiresAt",label:"过期时间",width:"150"},{default:x(({row:e})=>[y("span",{class:z(Ne(e.expiresAt))},k(Ve(e.expiresAt)),3)]),_:1}),D(g,{label:"操作",width:"180",fixed:"right"},{default:x(({row:a})=>[D(f,{type:"success",size:"small",onClick:e=>(e=>{me.value=[e],we.value=!0})(a)},{default:x(()=>[D(r,null,{default:x(()=>[D(A(s))]),_:1}),o[16]||(o[16]=C(" 恢复 ",-1))]),_:1},8,["onClick"]),D(f,{type:"danger",size:"small",onClick:e=>(e=>{me.value=[e],he.value=!0})(a)},{default:x(()=>[D(r,null,{default:x(()=>[D(A(e))]),_:1}),o[17]||(o[17]=C(" 永久删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Le,ie.value]])]),y("div",de,[D(Pe,{"current-page":fe.value,"onUpdate:currentPage":o[3]||(o[3]=e=>fe.value=e),"page-size":ge.value,"onUpdate:pageSize":o[4]||(o[4]=e=>ge.value=e),"page-sizes":[10,20,50,100],total:De.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ke,onCurrentChange:Te},null,8,["current-page","page-size","total"])])]),D(Re,{modelValue:we.value,"onUpdate:modelValue":o[6]||(o[6]=e=>we.value=e),title:"确认恢复",width:"500px"},{footer:x(()=>[D(f,{onClick:o[5]||(o[5]=e=>we.value=!1)},{default:x(()=>[...o[18]||(o[18]=[C("取消",-1)])]),_:1}),D(f,{type:"primary",onClick:ze},{default:x(()=>[...o[19]||(o[19]=[C("确认恢复",-1)])]),_:1})]),default:x(()=>[y("p",null,"确定要恢复选中的 "+k(me.value.length)+" 条记录吗？",1),o[20]||(o[20]=y("p",{class:"warning-text"},"恢复后，这些记录将重新出现在资料列表中。",-1))]),_:1},8,["modelValue"]),D(Re,{modelValue:he.value,"onUpdate:modelValue":o[8]||(o[8]=e=>he.value=e),title:"永久删除确认",width:"500px"},{footer:x(()=>[D(f,{onClick:o[7]||(o[7]=e=>he.value=!1)},{default:x(()=>[...o[23]||(o[23]=[C("取消",-1)])]),_:1}),D(f,{type:"danger",onClick:je},{default:x(()=>[...o[24]||(o[24]=[C("永久删除",-1)])]),_:1})]),default:x(()=>[y("div",oe,[D(r,{class:"warning-icon"},{default:x(()=>[D(A(u))]),_:1}),y("div",re,[o[21]||(o[21]=y("p",null,[y("strong",null,"警告：此操作不可恢复！")],-1)),y("p",null,"确定要永久删除选中的 "+k(me.value.length)+" 条记录吗？",1),o[22]||(o[22]=y("p",null,"删除后将无法恢复这些数据。",-1))])])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-292cac81"]]);export{ie as default};
