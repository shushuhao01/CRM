import{l as e,aC as t,aA as a,r as l,Z as r,e as s,b as n,Y as o,ag as i,m as d,q as u,p as c,Q as m,U as p,O as f,S as v,u as g,T as h,F as b,a9 as _,M as w,n as y}from"./vendor-BtukhyiH.js";import{u as A,d as R,c as k,_ as C}from"./index-DkAJPKqn.js";import{useDepartmentStore as x}from"./department-DPqzaatc.js";import{i as D,L as S}from"./utils-DfI7e5Rl.js";import{E as T,L as j,F as V,G as F,s as L,t as U,a4 as O,U as M,z as I,ab as P,ad as z,ae as Y}from"./elementPlus-DxaqjplL.js";const E={class:"analysis-container"},$={class:"page-header"},q={class:"header-left"},J={key:0,class:"member-info-card"},N={class:"member-avatar"},Q={class:"member-details"},B={class:"quick-filter-section"},W={class:"quick-filter-buttons"},G={class:"filter-section"},X={class:"filter-left"},Z={class:"filter-right"},H={class:"metrics-grid"},K={class:"metrics-row"},ee={class:"metric-card"},te={class:"metric-icon total-performance"},ae={class:"metric-content"},le={class:"metric-value"},re={class:"metric-card"},se={class:"metric-icon total-orders"},ne={class:"metric-content"},oe={class:"metric-value"},ie={class:"metric-card"},de={class:"metric-icon avg-performance"},ue={class:"metric-content"},ce={class:"metric-value"},me={class:"metrics-row"},pe={class:"metric-card"},fe={class:"metric-icon sign-orders"},ve={class:"metric-content"},ge={class:"metric-value"},he={class:"metric-card"},be={class:"metric-icon sign-rate"},_e={class:"metric-content"},we={class:"metric-value"},ye={class:"metric-card"},Ae={class:"metric-icon sign-performance"},Re={class:"metric-content"},ke={class:"metric-value"},Ce={class:"charts-section"},xe={class:"chart-row"},De={class:"chart-card"},Se={class:"chart-card"},Te={class:"table-section"},je={class:"table-header"},Ve={class:"amount"},Fe={class:"amount"},Le={class:"amount"},Ue={class:"amount"},Oe={class:"amount"},Me={class:"amount"},Ie={class:"export-stats"},Pe={class:"stat-item"},ze={class:"stat-value"},Ye={class:"stat-item"},Ee={class:"stat-value"},$e={class:"stat-item"},qe={class:"stat-value"},Je={class:"dialog-footer"},Ne={class:"amount"},Qe={class:"amount"},Be={class:"amount"},We={class:"amount"},Ge={class:"amount"},Xe={class:"amount"},Ze=C(e({__name:"Analysis",setup(e){t();const C=a(),Ze=k(C),He=A(),Ke=x(),et=R(),tt=l(),at=l(),lt=new Date,rt=e=>e.toISOString().split("T")[0],st=l([rt(lt),rt(lt)]),nt=l(He.isAdmin?"":He.currentUser?.departmentId||""),ot=l("performance"),it=l("today"),dt=l({id:"",name:"张三",department:"销售一部",joinDate:"2023-01-15",avatar:""}),ut=l({totalPerformance:0,totalOrders:0,avgPerformance:0,signOrders:0,signRate:0,signPerformance:0}),ct=l([]),mt=l([{key:"all",label:"全部"},{key:"today",label:"今日"},{key:"yesterday",label:"昨日"},{key:"thisWeek",label:"本周"},{key:"thisMonth",label:"本月"},{key:"thisQuarter",label:"本季"},{key:"thisYear",label:"本年"}]),pt=l(!1),ft=r({enabled:!0,permissionType:"all",allowedRoles:["super_admin","admin","department_manager","sales_staff"],dailyLimit:0}),vt=l({todayCount:0,monthCount:0,totalCount:0}),gt=l(!1),ht=s(()=>!He.isAdmin&&!He.isManager),bt=s(()=>He.isAdmin?Ke.departmentList:He.isManager?Ke.departmentList.filter(e=>e.id===He.currentUser?.departmentId):[]),_t=e=>e.toLocaleString(),wt=()=>{Ze.push("/performance/team")},yt=()=>{console.log("查询数据",{dateRange:st.value,selectedDepartment:nt.value,sortBy:ot.value}),Mt()},At=()=>{console.log("导出数据")},Rt=s(()=>{const e=He.currentUser;return"super_admin"===e?.role||"admin"===e?.role}),kt=()=>{Ct(),xt(),pt.value=!0},Ct=()=>{const e=localStorage.getItem("crm_performance_export_config");if(e)try{const t=JSON.parse(e);ft.enabled=t.enabled??!0,ft.permissionType=t.permissionType||"all",ft.allowedRoles=t.allowedRoles||["super_admin","admin","department_manager","sales_staff"],ft.dailyLimit=t.dailyLimit||0}catch(t){console.error("加载导出配置失败:",t)}},xt=()=>{const e=localStorage.getItem("crm_performance_export_stats");if(e)try{const t=JSON.parse(e);vt.value={todayCount:t.todayCount||0,monthCount:t.monthCount||0,totalCount:t.totalCount||0}}catch(t){console.error("加载导出统计失败:",t)}},Dt=()=>{const e={enabled:ft.enabled,permissionType:ft.permissionType,allowedRoles:ft.allowedRoles,dailyLimit:ft.dailyLimit};localStorage.setItem("crm_performance_export_config",JSON.stringify(e)),T.success("导出权限设置已保存并全局生效"),pt.value=!1},St=()=>{ft.enabled=!0,ft.permissionType="all",ft.allowedRoles=["super_admin","admin","department_manager","sales_staff"],ft.dailyLimit=0,Dt(),T.success("已恢复默认设置")},Tt=()=>{gt.value=!0},jt=e=>e>=90?"success":e>=80?"warning":e>=70?"info":"danger",Vt=e=>e<=3?"success":e<=5?"warning":e<=8?"info":"danger",Ft=e=>e<=2?"success":e<=4?"warning":e<=6?"info":"danger",Lt=l({performanceTrend:{xAxis:[],data:[]},orderStatus:[]}),Ut=()=>{y(()=>{if(tt.value){const e=D(tt.value);Lt.value.performanceTrend.data.length>0?e.setOption({tooltip:{trigger:"axis",formatter:e=>{const t=e[0].value;return`${e[0].axisValue}<br/>业绩: ¥${t.toLocaleString()}`}},xAxis:{type:"category",data:Lt.value.performanceTrend.xAxis},yAxis:{type:"value",axisLabel:{formatter:e=>`¥${e.toLocaleString()}`}},series:[{data:Lt.value.performanceTrend.data,type:"line",smooth:!0,itemStyle:{color:"#409eff"},areaStyle:{color:new S(0,0,0,1,[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}])}}]}):e.setOption({title:{text:"暂无数据",left:"center",top:"middle",textStyle:{color:"#999",fontSize:14}}})}if(at.value){const e=D(at.value);Lt.value.orderStatus.length>0?e.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:"订单状态",type:"pie",radius:"60%",data:Lt.value.orderStatus,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}):e.setOption({title:{text:"",left:"center",top:"middle"}})}})},Ot=()=>!(!He.isManager&&!He.isAdmin)||(T.error("您没有权限查看业绩分析数据"),C.push("/performance"),!1),Mt=()=>{if(Ot())try{He.isAdmin?nt.value?It():Pt():He.isManager&&It(),zt(),(()=>{try{let e=et.orders.filter(e=>"approved"===e.auditStatus);if(nt.value){const t=He.users?.filter(e=>e.departmentId===nt.value).map(e=>e.id)||[];e=e.filter(e=>t.includes(e.salesPersonId))}if(st.value&&2===st.value.length&&st.value[0]&&st.value[1]){const t=new Date(st.value[0]).getTime(),a=new Date(st.value[1]).getTime()+864e5-1;e=e.filter(e=>{const l=new Date(e.createTime).getTime();return l>=t&&l<=a})}const t=new Map,a=new Date;for(let n=6;n>=0;n--){const e=new Date(a);e.setDate(a.getDate()-n);const l=e.toISOString().split("T")[0];t.set(l,0)}e.forEach(e=>{const a=e.createTime.split(" ")[0];t.has(a)&&t.set(a,t.get(a)+e.totalAmount)}),Lt.value.performanceTrend={xAxis:Array.from(t.keys()).map(e=>{const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()}`}),data:Array.from(t.values())};const l=new Map,r={pending_transfer:"待流转",pending_audit:"待审核",audit_rejected:"审核拒绝",pending_shipment:"待发货",shipped:"已发货",delivered:"已签收",logistics_returned:"物流部退回",logistics_cancelled:"物流部取消",package_exception:"包裹异常",rejected:"拒收",rejected_returned:"拒收已退回",after_sales_created:"已建售后",pending_cancel:"待取消",cancel_failed:"取消失败",cancelled:"已取消",draft:"草稿",refunded:"已退款",pending:"待审核",paid:"已付款",completed:"已完成",signed:"已签收"};e.forEach(e=>{const t=r[e.status]||e.status;if(l.has(t)){const a=l.get(t);l.set(t,{count:a.count+1,amount:a.amount+(e.totalAmount||0)})}else l.set(t,{count:1,amount:e.totalAmount||0})});const s=[];l.forEach((e,t)=>{s.push({value:e.count,name:`${t}(${e.count}单/¥${e.amount.toLocaleString()})`})}),Lt.value.orderStatus=s,Ut()}catch(e){console.error("加载图表数据失败:",e),Lt.value.performanceTrend={xAxis:[],data:[]},Lt.value.orderStatus=[],Ut()}})()}catch(e){console.error("加载业绩分析数据失败:",e),T.error("加载数据失败，请稍后重试")}},It=()=>{try{const e=nt.value||He.currentUser?.departmentId;if(!He.isAdmin&&e!==He.currentUser?.departmentId)return T.error("您只能查看自己部门的数据"),void(nt.value=He.currentUser?.departmentId||"");let t=et.orders.filter(e=>"approved"===e.auditStatus);if(e){const a=He.users?.filter(t=>t.departmentId===e).map(e=>e.id)||[];t=t.filter(e=>a.includes(e.salesPersonId))}if(st.value&&2===st.value.length&&st.value[0]&&st.value[1]){const e=new Date(st.value[0]).getTime(),a=new Date(st.value[1]).getTime()+864e5-1;t=t.filter(t=>{const l=new Date(t.createTime).getTime();return l>=e&&l<=a})}const a=t.length,l=t.reduce((e,t)=>e+t.totalAmount,0),r=t.filter(e=>"shipped"===e.status||"delivered"===e.status),s=r.length,n=r.reduce((e,t)=>e+t.totalAmount,0),o=a>0?parseFloat((s/a*100).toFixed(1)):0,i=t.filter(e=>"delivered"===e.status),d=i.length,u=i.reduce((e,t)=>e+t.totalAmount,0),c=a>0?parseFloat((d/a*100).toFixed(1)):0,m=t.filter(e=>"shipped"===e.status),p=m.length,f=m.reduce((e,t)=>e+t.totalAmount,0),v=a>0?parseFloat((p/a*100).toFixed(1)):0,g=t.filter(e=>"rejected"===e.status||"rejected_returned"===e.status),h=g.length,b=g.reduce((e,t)=>e+t.totalAmount,0),_=a>0?parseFloat((h/a*100).toFixed(1)):0,w=t.filter(e=>"after_sales_created"===e.status),y=w.length,A=w.reduce((e,t)=>e+t.totalAmount,0),R=a>0?parseFloat((y/a*100).toFixed(1)):0;ct.value=[{id:"部门数据",name:"部门数据",orderCount:a,orderAmount:l,shipCount:s,shipAmount:n,shipRate:o,signCount:d,signAmount:u,signRate:c,transitCount:p,transitAmount:f,transitRate:v,rejectCount:h,rejectAmount:b,rejectRate:_,returnCount:y,returnAmount:A,returnRate:R,status:"active"}]}catch(e){console.error("加载部门业绩数据失败:",e)}},Pt=()=>{try{if(!He.isAdmin)return T.error("您没有权限查看全公司数据"),void It();let e=et.orders.filter(e=>"approved"===e.auditStatus);if(st.value&&2===st.value.length&&st.value[0]&&st.value[1]){const t=new Date(st.value[0]).getTime(),a=new Date(st.value[1]).getTime()+864e5-1;e=e.filter(e=>{const l=new Date(e.createTime).getTime();return l>=t&&l<=a})}const t=e.length,a=e.reduce((e,t)=>e+t.totalAmount,0),l=e.filter(e=>"shipped"===e.status||"delivered"===e.status),r=l.length,s=l.reduce((e,t)=>e+t.totalAmount,0),n=t>0?parseFloat((r/t*100).toFixed(1)):0,o=e.filter(e=>"delivered"===e.status),i=o.length,d=o.reduce((e,t)=>e+t.totalAmount,0),u=t>0?parseFloat((i/t*100).toFixed(1)):0,c=e.filter(e=>"shipped"===e.status),m=c.length,p=c.reduce((e,t)=>e+t.totalAmount,0),f=t>0?parseFloat((m/t*100).toFixed(1)):0,v=e.filter(e=>"rejected"===e.status||"rejected_returned"===e.status),g=v.length,h=v.reduce((e,t)=>e+t.totalAmount,0),b=t>0?parseFloat((g/t*100).toFixed(1)):0,_=e.filter(e=>"after_sales_created"===e.status),w=_.length,y=_.reduce((e,t)=>e+t.totalAmount,0),A=t>0?parseFloat((w/t*100).toFixed(1)):0;ct.value=[{id:"公司总体",name:"公司总体",orderCount:t,orderAmount:a,shipCount:r,shipAmount:s,shipRate:n,signCount:i,signAmount:d,signRate:u,transitCount:m,transitAmount:p,transitRate:f,rejectCount:g,rejectAmount:h,rejectRate:b,returnCount:w,returnAmount:y,returnRate:A,status:"active"}]}catch(e){console.error("加载公司业绩数据失败:",e)}},zt=()=>{try{let e=et.orders.filter(e=>"approved"===e.auditStatus);if(nt.value){const t=He.users?.filter(e=>e.departmentId===nt.value).map(e=>e.id)||[];e=e.filter(e=>t.includes(e.salesPersonId))}if(st.value&&2===st.value.length&&st.value[0]&&st.value[1]){const t=new Date(st.value[0]).getTime(),a=new Date(st.value[1]).getTime()+864e5-1;e=e.filter(e=>{const l=new Date(e.createTime).getTime();return l>=t&&l<=a})}ut.value.totalOrders=e.length,ut.value.totalPerformance=e.reduce((e,t)=>e+t.totalAmount,0),ut.value.avgPerformance=e.length>0?Math.round(ut.value.totalPerformance/e.length):0;const t=e.filter(e=>"delivered"===e.status);ut.value.signOrders=t.length,ut.value.signPerformance=t.reduce((e,t)=>e+t.totalAmount,0),ut.value.signRate=e.length>0?parseFloat((t.length/e.length*100).toFixed(1)):0}catch(e){console.error("加载统计指标失败:",e),ut.value.totalPerformance=0,ut.value.totalOrders=0,ut.value.avgPerformance=0,ut.value.signOrders=0,ut.value.signRate=0,ut.value.signPerformance=0}};n(()=>{Ot()&&(Ke.initData(),Mt(),window.addEventListener("orderStatusUpdated",Yt),window.addEventListener("todoStatusUpdated",Et))});const Yt=e=>{const t=e;console.log("订单状态已更新，刷新业绩数据",t.detail),Mt(),T.success("业绩数据已同步更新")},Et=e=>{const t=e;console.log("待办状态已更新，刷新业绩数据",t.detail),Mt(),T.success("业绩数据已同步更新")};return o(()=>{window.removeEventListener("orderStatusUpdated",Yt),window.removeEventListener("todoStatusUpdated",Et)}),(e,t)=>{const a=i("el-button"),l=i("el-avatar"),r=i("el-date-picker"),s=i("el-option"),n=i("el-select"),o=i("el-icon"),y=i("el-table-column"),A=i("el-tag"),R=i("el-table"),k=i("el-switch"),C=i("el-form-item"),x=i("el-radio"),D=i("el-radio-group"),S=i("el-checkbox"),T=i("el-checkbox-group"),Ze=i("el-input-number"),Ke=i("el-divider"),et=i("el-form"),lt=i("el-dialog");return u(),d("div",E,[c("div",$,[c("div",q,[p(a,{type:"primary",icon:g(j),onClick:wt,class:"back-btn"},{default:f(()=>[...t[11]||(t[11]=[v(" 返回团队业绩 ",-1)])]),_:1},8,["icon"]),t[12]||(t[12]=c("h1",{class:"page-title"},"业绩分析",-1))])]),ht.value?(u(),d("div",J,[c("div",N,[p(l,{size:60,src:dt.value.avatar},{default:f(()=>[v(h(dt.value.name.charAt(0)),1)]),_:1},8,["src"])]),c("div",Q,[c("h3",null,h(dt.value.name),1),c("p",null,h(dt.value.department)+" | 入职时间："+h(dt.value.joinDate),1)])])):m("",!0),c("div",B,[t[13]||(t[13]=c("div",{class:"quick-filter-label"},"快速筛选：",-1)),c("div",W,[(u(!0),d(b,null,_(mt.value,e=>(u(),w(a,{key:e.key,type:it.value===e.key?"primary":"default",size:"small",onClick:t=>(e=>{it.value=e;const t=new Date,a=e=>e.toISOString().split("T")[0];switch(e){case"all":st.value=["",""];break;case"today":st.value=[a(t),a(t)];break;case"yesterday":const e=new Date(t);e.setDate(t.getDate()-1),st.value=[a(e),a(e)];break;case"thisWeek":const l=new Date(t);l.setDate(t.getDate()-t.getDay()+1),st.value=[a(l),a(t)];break;case"thisMonth":const r=new Date(t.getFullYear(),t.getMonth(),1);st.value=[a(r),a(t)];break;case"thisQuarter":const s=Math.floor(t.getMonth()/3),n=new Date(t.getFullYear(),3*s,1);st.value=[a(n),a(t)];break;case"thisYear":const o=new Date(t.getFullYear(),0,1);st.value=[a(o),a(t)]}Mt()})(e.key),class:"quick-filter-btn"},{default:f(()=>[v(h(e.label),1)]),_:2},1032,["type","onClick"]))),128))])]),c("div",G,[c("div",X,[p(r,{modelValue:st.value,"onUpdate:modelValue":t[0]||(t[0]=e=>st.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"date-picker"},null,8,["modelValue"]),g(He).isAdmin||g(He).isManager?(u(),w(n,{key:0,modelValue:nt.value,"onUpdate:modelValue":t[1]||(t[1]=e=>nt.value=e),placeholder:"选择部门",class:"department-select",size:"default",disabled:!g(He).isAdmin},{default:f(()=>[g(He).isAdmin?(u(),w(s,{key:0,label:"全部部门",value:""})):m("",!0),(u(!0),d(b,null,_(bt.value,e=>(u(),w(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])):m("",!0),p(n,{modelValue:ot.value,"onUpdate:modelValue":t[2]||(t[2]=e=>ot.value=e),placeholder:"排序方式",class:"sort-select",size:"default"},{default:f(()=>[p(s,{label:"按业绩排序",value:"performance"}),p(s,{label:"按订单数排序",value:"orders"}),p(s,{label:"按签收率排序",value:"signRate"})]),_:1},8,["modelValue"])]),c("div",Z,[p(a,{type:"primary",onClick:yt,class:"query-btn"},{default:f(()=>[p(o,null,{default:f(()=>[p(g(V))]),_:1}),t[14]||(t[14]=v(" 查询 ",-1))]),_:1}),p(a,{onClick:At,class:"export-btn"},{default:f(()=>[p(o,null,{default:f(()=>[p(g(F))]),_:1}),t[15]||(t[15]=v(" 导出数据 ",-1))]),_:1}),Rt.value?(u(),w(a,{key:0,onClick:kt,class:"export-settings-btn",title:"导出权限设置"},{default:f(()=>[p(o,null,{default:f(()=>[p(g(L))]),_:1})]),_:1})):m("",!0)])]),c("div",H,[c("div",K,[c("div",ee,[c("div",te,[p(o,null,{default:f(()=>[p(g(U))]),_:1})]),c("div",ae,[c("div",le,"¥"+h(_t(ut.value.totalPerformance)),1),t[16]||(t[16]=c("div",{class:"metric-label"},"总业绩",-1))])]),c("div",re,[c("div",se,[p(o,null,{default:f(()=>[p(g(O))]),_:1})]),c("div",ne,[c("div",oe,h(ut.value.totalOrders),1),t[17]||(t[17]=c("div",{class:"metric-label"},"总订单",-1))])]),c("div",ie,[c("div",de,[p(o,null,{default:f(()=>[p(g(M))]),_:1})]),c("div",ue,[c("div",ce,"¥"+h(_t(ut.value.avgPerformance)),1),t[18]||(t[18]=c("div",{class:"metric-label"},"平均业绩",-1))])])]),c("div",me,[c("div",pe,[c("div",fe,[p(o,null,{default:f(()=>[p(g(I))]),_:1})]),c("div",ve,[c("div",ge,h(ut.value.signOrders),1),t[19]||(t[19]=c("div",{class:"metric-label"},"签收单数",-1))])]),c("div",he,[c("div",be,[p(o,null,{default:f(()=>[p(g(P))]),_:1})]),c("div",_e,[c("div",we,h(ut.value.signRate)+"%",1),t[20]||(t[20]=c("div",{class:"metric-label"},"签收率",-1))])]),c("div",ye,[c("div",Ae,[p(o,null,{default:f(()=>[p(g(z))]),_:1})]),c("div",Re,[c("div",ke,"¥"+h(_t(ut.value.signPerformance)),1),t[21]||(t[21]=c("div",{class:"metric-label"},"签收业绩",-1))])])])]),c("div",Ce,[c("div",xe,[c("div",De,[t[22]||(t[22]=c("div",{class:"chart-header"},[c("h3",null,"业绩趋势")],-1)),c("div",{class:"chart-content",ref_key:"performanceChartRef",ref:tt},null,512)]),c("div",Se,[t[23]||(t[23]=c("div",{class:"chart-header"},[c("h3",null,"订单状态分布")],-1)),c("div",{class:"chart-content",ref_key:"orderStatusChartRef",ref:at},null,512)])])]),c("div",Te,[c("div",je,[t[25]||(t[25]=c("h3",null,"业绩数据",-1)),p(a,{onClick:Tt,icon:g(Y),class:"fullscreen-btn",title:"全屏查看"},{default:f(()=>[...t[24]||(t[24]=[v(" 全屏查看 ",-1)])]),_:1},8,["icon"])]),p(R,{data:ct.value,stripe:"",class:"data-table",border:""},{default:f(()=>[p(y,{type:"index",label:"序号",width:"60",align:"center"}),p(y,{prop:"name",label:"部门（或成员）",width:"120",align:"center"}),p(y,{prop:"orderCount",label:"下单单数",width:"100",align:"center"}),p(y,{prop:"orderAmount",label:"下单业绩",width:"120",align:"center"},{default:f(({row:e})=>[c("span",Ve,"¥"+h(_t(e.orderAmount)),1)]),_:1}),p(y,{prop:"shipCount",label:"发货单数",width:"100",align:"center"}),p(y,{prop:"shipAmount",label:"发货业绩",width:"120",align:"center"},{default:f(({row:e})=>[c("span",Fe,"¥"+h(_t(e.shipAmount)),1)]),_:1}),p(y,{prop:"shipRate",label:"发货率",width:"100",align:"center"},{default:f(({row:e})=>[p(A,{type:jt(e.shipRate),size:"small"},{default:f(()=>[v(h(e.shipRate)+"% ",1)]),_:2},1032,["type"])]),_:1}),p(y,{prop:"signCount",label:"签收单数",width:"100",align:"center"}),p(y,{prop:"signAmount",label:"签收业绩",width:"120",align:"center"},{default:f(({row:e})=>[c("span",Le,"¥"+h(_t(e.signAmount)),1)]),_:1}),p(y,{prop:"signRate",label:"签收率",width:"100",align:"center"},{default:f(({row:e})=>[p(A,{type:jt(e.signRate),size:"small"},{default:f(()=>[v(h(e.signRate)+"% ",1)]),_:2},1032,["type"])]),_:1}),p(y,{prop:"transitCount",label:"在途单数",width:"100",align:"center"}),p(y,{prop:"transitAmount",label:"在途业绩",width:"120",align:"center"},{default:f(({row:e})=>[c("span",Ue,"¥"+h(_t(e.transitAmount)),1)]),_:1}),p(y,{prop:"transitRate",label:"在途率",width:"100",align:"center"},{default:f(({row:e})=>[p(A,{type:jt(e.transitRate),size:"small"},{default:f(()=>[v(h(e.transitRate)+"% ",1)]),_:2},1032,["type"])]),_:1}),p(y,{prop:"rejectCount",label:"拒收单数",width:"100",align:"center"}),p(y,{prop:"rejectAmount",label:"拒收业绩",width:"120",align:"center"},{default:f(({row:e})=>[c("span",Oe,"¥"+h(_t(e.rejectAmount)),1)]),_:1}),p(y,{prop:"rejectRate",label:"拒收率",width:"100",align:"center"},{default:f(({row:e})=>[p(A,{type:Vt(e.rejectRate),size:"small"},{default:f(()=>[v(h(e.rejectRate)+"% ",1)]),_:2},1032,["type"])]),_:1}),p(y,{prop:"returnCount",label:"退货单数",width:"100",align:"center"}),p(y,{prop:"returnAmount",label:"退货业绩",width:"120",align:"center"},{default:f(({row:e})=>[c("span",Me,"¥"+h(_t(e.returnAmount)),1)]),_:1}),p(y,{prop:"returnRate",label:"退货率",width:"100",align:"center"},{default:f(({row:e})=>[p(A,{type:Ft(e.returnRate),size:"small"},{default:f(()=>[v(h(e.returnRate)+"% ",1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),p(lt,{modelValue:pt.value,"onUpdate:modelValue":t[8]||(t[8]=e=>pt.value=e),title:"导出权限设置",width:"700px","close-on-click-modal":!1},{footer:f(()=>[c("div",Je,[p(a,{onClick:t[7]||(t[7]=e=>pt.value=!1)},{default:f(()=>[...t[38]||(t[38]=[v("取消",-1)])]),_:1}),p(a,{type:"primary",onClick:Dt},{default:f(()=>[...t[39]||(t[39]=[v("保存设置",-1)])]),_:1}),p(a,{onClick:St},{default:f(()=>[...t[40]||(t[40]=[v("恢复默认",-1)])]),_:1})])]),default:f(()=>[p(et,{model:ft,"label-width":"120px"},{default:f(()=>[p(C,{label:"启用导出功能"},{default:f(()=>[p(k,{modelValue:ft.enabled,"onUpdate:modelValue":t[3]||(t[3]=e=>ft.enabled=e)},null,8,["modelValue"]),t[26]||(t[26]=c("span",{class:"form-item-tip"},"关闭后所有用户将无法导出业绩数据",-1))]),_:1}),p(C,{label:"导出权限"},{default:f(()=>[p(D,{modelValue:ft.permissionType,"onUpdate:modelValue":t[4]||(t[4]=e=>ft.permissionType=e)},{default:f(()=>[p(x,{label:"all"},{default:f(()=>[...t[27]||(t[27]=[v("所有人可导出",-1)])]),_:1}),p(x,{label:"admin_only"},{default:f(()=>[...t[28]||(t[28]=[v("仅管理员可导出",-1)])]),_:1}),p(x,{label:"custom"},{default:f(()=>[...t[29]||(t[29]=[v("自定义权限",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"custom"===ft.permissionType?(u(),w(C,{key:0,label:"允许导出的角色"},{default:f(()=>[p(T,{modelValue:ft.allowedRoles,"onUpdate:modelValue":t[5]||(t[5]=e=>ft.allowedRoles=e)},{default:f(()=>[p(S,{label:"super_admin"},{default:f(()=>[...t[30]||(t[30]=[v("超级管理员",-1)])]),_:1}),p(S,{label:"admin"},{default:f(()=>[...t[31]||(t[31]=[v("管理员",-1)])]),_:1}),p(S,{label:"department_manager"},{default:f(()=>[...t[32]||(t[32]=[v("部门经理",-1)])]),_:1}),p(S,{label:"sales_staff"},{default:f(()=>[...t[33]||(t[33]=[v("销售员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):m("",!0),p(C,{label:"每日导出限制"},{default:f(()=>[p(Ze,{modelValue:ft.dailyLimit,"onUpdate:modelValue":t[6]||(t[6]=e=>ft.dailyLimit=e),min:0,max:100,placeholder:"0表示不限制"},null,8,["modelValue"]),t[34]||(t[34]=c("span",{class:"form-item-tip"},"每个用户每天最多可导出的次数，0表示不限制",-1))]),_:1}),p(Ke),p(C,{label:"导出统计"},{default:f(()=>[c("div",Ie,[c("div",Pe,[t[35]||(t[35]=c("span",{class:"stat-label"},"今日导出次数：",-1)),c("span",ze,h(vt.value.todayCount),1)]),c("div",Ye,[t[36]||(t[36]=c("span",{class:"stat-label"},"本月导出次数：",-1)),c("span",Ee,h(vt.value.monthCount),1)]),c("div",$e,[t[37]||(t[37]=c("span",{class:"stat-label"},"总导出次数：",-1)),c("span",qe,h(vt.value.totalCount),1)])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),p(lt,{modelValue:gt.value,"onUpdate:modelValue":t[10]||(t[10]=e=>gt.value=e),title:"业绩数据 - 全屏查看",fullscreen:"","close-on-click-modal":!1},{footer:f(()=>[p(a,{onClick:t[9]||(t[9]=e=>gt.value=!1)},{default:f(()=>[...t[41]||(t[41]=[v("关闭",-1)])]),_:1}),p(a,{type:"primary",onClick:At,icon:g(F)},{default:f(()=>[...t[42]||(t[42]=[v(" 导出数据 ",-1)])]),_:1},8,["icon"])]),default:f(()=>[p(R,{data:ct.value,stripe:"",border:"",class:"fullscreen-table",height:"calc(100vh - 200px)"},{default:f(()=>[p(y,{type:"index",label:"序号",width:"60",align:"center",fixed:""}),p(y,{prop:"name",label:"部门（或成员）",width:"120",align:"center",fixed:""}),p(y,{prop:"orderCount",label:"下单单数",width:"100",align:"center"}),p(y,{prop:"orderAmount",label:"下单业绩",width:"120",align:"center"},{default:f(({row:e})=>[c("span",Ne,"¥"+h(_t(e.orderAmount)),1)]),_:1}),p(y,{prop:"shipCount",label:"发货单数",width:"100",align:"center"}),p(y,{prop:"shipAmount",label:"发货业绩",width:"120",align:"center"},{default:f(({row:e})=>[c("span",Qe,"¥"+h(_t(e.shipAmount)),1)]),_:1}),p(y,{prop:"shipRate",label:"发货率",width:"100",align:"center"},{default:f(({row:e})=>[p(A,{type:"info",size:"small"},{default:f(()=>[v(h(e.shipRate)+"% ",1)]),_:2},1024)]),_:1}),p(y,{prop:"signCount",label:"签收单数",width:"100",align:"center"}),p(y,{prop:"signAmount",label:"签收业绩",width:"120",align:"center"},{default:f(({row:e})=>[c("span",Be,"¥"+h(_t(e.signAmount)),1)]),_:1}),p(y,{prop:"signRate",label:"签收率",width:"100",align:"center"},{default:f(({row:e})=>[p(A,{type:e.signRate>=80?"success":e.signRate>=70?"info":"danger",size:"small"},{default:f(()=>[v(h(e.signRate)+"% ",1)]),_:2},1032,["type"])]),_:1}),p(y,{prop:"transitCount",label:"在途单数",width:"100",align:"center"}),p(y,{prop:"transitAmount",label:"在途业绩",width:"120",align:"center"},{default:f(({row:e})=>[c("span",We,"¥"+h(_t(e.transitAmount)),1)]),_:1}),p(y,{prop:"transitRate",label:"在途率",width:"100",align:"center"},{default:f(({row:e})=>[p(A,{type:"info",size:"small"},{default:f(()=>[v(h(e.transitRate)+"% ",1)]),_:2},1024)]),_:1}),p(y,{prop:"rejectCount",label:"拒收单数",width:"100",align:"center"}),p(y,{prop:"rejectAmount",label:"拒收业绩",width:"120",align:"center"},{default:f(({row:e})=>[c("span",Ge,"¥"+h(_t(e.rejectAmount)),1)]),_:1}),p(y,{prop:"rejectRate",label:"拒收率",width:"100",align:"center"},{default:f(({row:e})=>[p(A,{type:Vt(e.rejectRate),size:"small"},{default:f(()=>[v(h(e.rejectRate)+"% ",1)]),_:2},1032,["type"])]),_:1}),p(y,{prop:"returnCount",label:"退货单数",width:"100",align:"center"}),p(y,{prop:"returnAmount",label:"退货业绩",width:"120",align:"center"},{default:f(({row:e})=>[c("span",Xe,"¥"+h(_t(e.returnAmount)),1)]),_:1}),p(y,{prop:"returnRate",label:"退货率",width:"100",align:"center"},{default:f(({row:e})=>[p(A,{type:Ft(e.returnRate),size:"small"},{default:f(()=>[v(h(e.returnRate)+"% ",1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-a17fc5fa"]]);export{Ze as default};
