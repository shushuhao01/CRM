import{l as e,aA as s,r,Z as a,e as o,ag as l,m as n,q as t,p as d,U as u,O as i,Q as c,I as w,J as p,T as m,S as g}from"./vendor-BtukhyiH.js";import{u as f,p as h,c as P,_ as v}from"./index-DkAJPKqn.js";import{E as b}from"./elementPlus-DxaqjplL.js";import"./utils-DfI7e5Rl.js";const y={class:"change-password-container"},_={class:"change-password-box"},V={key:0,class:"password-strength"},q={class:"strength-bar"},L={class:"strength-text"},k=v(e({__name:"ChangePassword",setup(e){const v=s(),k=P(v),x=f(),z=r(!1),U=r(),j=a({currentPassword:"",newPassword:"",confirmPassword:""}),C=o(()=>h.getCurrentPolicy()),E=o(()=>{const e=j.newPassword;if(!e)return 0;const s=C.value;let r=0;return e.length>=s.minLength&&(r+=25),e.length>=12&&(r+=25),s.requireLowercase&&/[a-z]/.test(e)&&(r+=12.5),s.requireUppercase&&/[A-Z]/.test(e)&&(r+=12.5),s.requireNumbers&&/[0-9]/.test(e)&&(r+=12.5),s.requireSpecialChars&&/[^A-Za-z0-9]/.test(e)&&(r+=12.5),Math.min(100,r)}),A=o(()=>{const e=E.value;return e<30?"weak":e<60?"medium":e<80?"good":"strong"}),I=o(()=>{const e=E.value;return e<30?"弱":e<60?"中等":e<80?"良好":"强"}),Z=o(()=>`${E.value}%`),$=(e,s,r)=>{""===s?r(new Error("请再次输入新密码")):s!==j.newPassword?r(new Error("两次输入的密码不一致")):r()},S=o(()=>({currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:C.value.minLength,message:`密码长度不能少于${C.value.minLength}位`,trigger:"blur"},{validator:(e,s,r)=>{s&&s===j.currentPassword?r(new Error("新密码不能与当前密码相同")):r()},trigger:"blur"}],confirmPassword:[{required:!0,validator:$,trigger:"blur"}]})),F=async()=>{U.value&&await U.value.validate(async e=>{if(e){z.value=!0;try{const e=await h.changePassword({userId:x.user?.id||"current",currentPassword:j.currentPassword,newPassword:j.newPassword,confirmPassword:j.confirmPassword});e.success?(b.success("密码修改成功"),k.push("/")):b.error(e.message||"密码修改失败")}catch(s){b.error(s.message||"密码修改失败")}finally{z.value=!1}}})};return(e,s)=>{const r=l("el-input"),a=l("el-form-item"),o=l("el-button"),f=l("el-form");return t(),n("div",y,[d("div",_,[s[4]||(s[4]=d("div",{class:"change-password-header"},[d("h1",null,"修改密码"),d("p",null,"为了您的账户安全，请修改默认密码")],-1)),u(f,{model:j,rules:S.value,ref_key:"passwordFormRef",ref:U,class:"change-password-form"},{default:i(()=>[u(a,{label:"当前密码",prop:"currentPassword"},{default:i(()=>[u(r,{modelValue:j.currentPassword,"onUpdate:modelValue":s[0]||(s[0]=e=>j.currentPassword=e),type:"password",placeholder:"请输入当前密码",size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),u(a,{label:"新密码",prop:"newPassword"},{default:i(()=>[u(r,{modelValue:j.newPassword,"onUpdate:modelValue":s[1]||(s[1]=e=>j.newPassword=e),type:"password",placeholder:`请输入新密码（至少${C.value.minLength}位）`,size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue","placeholder"]),j.newPassword?(t(),n("div",V,[d("div",q,[d("div",{class:p(["strength-fill",A.value]),style:w({width:Z.value})},null,6)]),d("span",L,"密码强度："+m(I.value),1)])):c("",!0)]),_:1}),u(a,{label:"确认新密码",prop:"confirmPassword"},{default:i(()=>[u(r,{modelValue:j.confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=e=>j.confirmPassword=e),type:"password",placeholder:"请再次输入新密码",size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),u(a,null,{default:i(()=>[u(o,{type:"primary",size:"large",class:"change-password-button",loading:z.value,onClick:F},{default:i(()=>[...s[3]||(s[3]=[g(" 修改密码 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])])}}}),[["__scopeId","data-v-b6f2564e"]]);export{k as default};
