import{s as e,Y as a}from"./elementPlus-DxaqjplL.js";import{l,r as s,e as o,b as n,ag as t,M as r,q as u,O as c,U as p,S as i,u as m,p as d,m as v,F as f,a9 as g,T as b}from"./vendor-BtukhyiH.js";import{_ as h}from"./index-DkAJPKqn.js";const _={class:"column-settings-header"},y={class:"column-settings-container"},S=["onDragstart","onDrop"],C=h(l({__name:"TableColumnSettings",props:{columns:{},storageKey:{}},emits:["update:columns","columns-change"],setup(l,{expose:h,emit:C}){const D=l,T=C,x=s([]),k=s(-1),w=()=>{D.columns&&Array.isArray(D.columns)?x.value=D.columns.map(e=>({...e})):x.value=[]},K=o(()=>x.value.filter(e=>e.visible)),V=()=>{const e={columns:x.value.map(e=>({prop:e.prop,visible:e.visible})),order:x.value.map(e=>e.prop)};localStorage.setItem(D.storageKey,JSON.stringify(e)),T("update:columns",[...x.value]),T("columns-change",[...x.value])},E=()=>{try{const e=localStorage.getItem(D.storageKey);if(e){const a=JSON.parse(e);if(a.columns&&a.columns.forEach(e=>{const a=x.value.find(a=>a.prop===e.prop);a&&(a.visible=e.visible)}),a.order){const e=[];if("customer-list-columns"===D.storageKey){const a=x.value.find(e=>"code"===e.prop);a&&(e.push(a),a.visible=!0)}a.order.forEach(a=>{const l=x.value.find(e=>e.prop===a);l&&!e.find(e=>e.prop===a)&&e.push(l)}),x.value.forEach(a=>{e.find(e=>e.prop===a.prop)||e.push(a)}),x.value=e}T("update:columns",[...x.value]),T("columns-change",[...x.value])}}catch(e){console.error("加载列设置失败:",e)}},I=()=>{w(),localStorage.removeItem(D.storageKey),T("update:columns",[...x.value]),T("columns-change",[...x.value])},j=e=>{e||V()},A=e=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move")};return n(()=>{w(),E()}),h({loadColumnSettings:E,resetColumns:I,visibleColumns:K}),(l,s)=>{const o=t("el-icon"),n=t("el-button"),h=t("el-checkbox"),C=t("el-dropdown-menu"),D=t("el-dropdown");return u(),r(D,{trigger:"click",onVisibleChange:j,placement:"bottom-end"},{dropdown:c(()=>[p(C,{class:"column-settings-dropdown"},{default:c(()=>[d("div",_,[s[2]||(s[2]=d("span",null,"列设置",-1)),p(n,{type:"text",size:"small",onClick:I,class:"reset-btn"},{default:c(()=>[...s[1]||(s[1]=[i(" 重置 ",-1)])]),_:1})]),d("div",y,[(u(!0),v(f,null,g(x.value,(e,l)=>(u(),v("div",{key:e.prop,class:"column-item",draggable:!0,onDragstart:e=>((e,a)=>{k.value=a,e.dataTransfer&&(e.dataTransfer.effectAllowed="move")})(e,l),onDragover:A,onDrop:e=>((e,a)=>{if(e.preventDefault(),-1!==k.value&&k.value!==a){const e=x.value[k.value],l=[...x.value];l.splice(k.value,1),l.splice(a,0,e),x.value=l,V()}k.value=-1})(e,l)},[p(o,{class:"drag-handle"},{default:c(()=>[p(m(a))]),_:1}),p(h,{modelValue:e.visible,"onUpdate:modelValue":a=>e.visible=a,onChange:V,class:"column-checkbox"},{default:c(()=>[i(b(e.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])],40,S))),128))])]),_:1})]),default:c(()=>[p(n,{size:"small"},{default:c(()=>[p(o,null,{default:c(()=>[p(m(e))]),_:1}),s[0]||(s[0]=i(" 列设置 ",-1))]),_:1})]),_:1})}}}),[["__scopeId","data-v-aac2745a"]]);export{C as T};
