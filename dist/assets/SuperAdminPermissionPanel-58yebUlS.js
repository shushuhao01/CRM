const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/department-DPqzaatc.js","assets/index-DkAJPKqn.js","assets/vendor-BtukhyiH.js","assets/elementPlus-DxaqjplL.js","assets/utils-DfI7e5Rl.js","assets/index-Cj-RrGL6.css"])))=>i.map(i=>d[i]);
import{_ as e,u as l,S as a,l as t,B as u}from"./index-DkAJPKqn.js";import{E as s,af as o,C as r,A as n,F as i,b as d,H as m,j as c,ak as p,e as v,G as f,aq as g,s as _,r as y}from"./elementPlus-DxaqjplL.js";import{l as b,r as h,e as w,w as V,ag as k,M as C,q as x,O as U,U as S,Q as P,S as I,m as T,F as D,a9 as L,T as R,p as z,u as A,aq as $,P as B,b as j}from"./vendor-BtukhyiH.js";import{a as O}from"./sensitiveInfo-DVfrBLrU.js";import{userApiService as E}from"./userApiService-CEBmH0Pk.js";import{r as M}from"./roleApiService-pAvzaC49.js";import q from"./departmentPermissionService-BriqDnjF.js";import"./utils-DfI7e5Rl.js";const F={class:"dialog-footer"},Y=e(b({__name:"UserPermissionDialog",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","confirm"],setup(e,{emit:l}){const a=e,t=l,u=h(),o=h(!1),r=w({get:()=>a.modelValue,set:e=>t("update:modelValue",e)}),n=w(()=>!!a.user?.id),i=h({name:"",email:"",password:"",confirmPassword:"",departmentId:"",role:"",dataScope:"",permissionLevel:"",status:"active",permissions:[],remark:""}),d=[{label:"客户查看",value:"customer_view"},{label:"客户编辑",value:"customer_edit"},{label:"客户删除",value:"customer_delete"},{label:"订单查看",value:"order_view"},{label:"订单编辑",value:"order_edit"},{label:"订单删除",value:"order_delete"},{label:"报表查看",value:"report_view"},{label:"报表导出",value:"report_export"},{label:"系统设置",value:"system_setting"},{label:"用户管理",value:"user_management"},{label:"权限管理",value:"permission_management"},{label:"数据导入",value:"data_import"}],m={name:[{required:!0,message:"请输入用户姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入默认密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{6,}$/,message:"密码必须包含大小写字母和数字",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,l,a)=>{l!==i.value.password?a(new Error("两次输入的密码不一致")):a()},trigger:"blur"}],departmentId:[{required:!0,message:"请选择所属部门",trigger:"change"}],role:[{required:!0,message:"请选择用户角色",trigger:"change"}],dataScope:[{required:!0,message:"请选择数据权限",trigger:"change"}],permissionLevel:[{required:!0,message:"请选择权限级别",trigger:"change"}]},c=()=>{i.value={name:"",email:"",password:"",confirmPassword:"",departmentId:"",role:"",dataScope:"",permissionLevel:"",status:"active",permissions:[],remark:""},u.value?.clearValidate()};V(()=>a.user,e=>{e?i.value={...e,password:"",confirmPassword:""}:c()},{immediate:!0});const p=()=>{r.value=!1,c()},v=async()=>{try{await u.value.validate(),o.value=!0,await new Promise(e=>setTimeout(e,1e3));const e={...i.value};n.value?(delete e.password,delete e.confirmPassword):delete e.confirmPassword,t("confirm",e),p(),s.success(n.value?"用户权限更新成功":"用户创建成功")}catch(e){console.error("表单验证失败:",e)}finally{o.value=!1}};return(e,l)=>{const a=k("el-input"),t=k("el-form-item"),s=k("el-col"),c=k("el-row"),f=k("el-option"),g=k("el-select"),_=k("el-radio"),y=k("el-radio-group"),b=k("el-checkbox"),h=k("el-checkbox-group"),w=k("el-form"),V=k("el-button"),A=k("el-dialog");return x(),C(A,{modelValue:r.value,"onUpdate:modelValue":l[11]||(l[11]=e=>r.value=e),title:n.value?"编辑用户权限":"新增用户",width:"800px",onClose:p},{footer:U(()=>[z("div",F,[S(V,{onClick:p},{default:U(()=>[...l[14]||(l[14]=[I("取消",-1)])]),_:1}),S(V,{type:"primary",onClick:v,loading:o.value},{default:U(()=>[I(R(n.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:U(()=>[S(w,{ref_key:"formRef",ref:u,model:i.value,rules:m,"label-width":"120px"},{default:U(()=>[S(c,{gutter:20},{default:U(()=>[S(s,{span:12},{default:U(()=>[S(t,{label:"用户姓名",prop:"name"},{default:U(()=>[S(a,{modelValue:i.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value.name=e),placeholder:"请输入用户姓名"},null,8,["modelValue"])]),_:1})]),_:1}),S(s,{span:12},{default:U(()=>[S(t,{label:"邮箱地址",prop:"email"},{default:U(()=>[S(a,{modelValue:i.value.email,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value.email=e),placeholder:"请输入邮箱地址"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n.value?P("",!0):(x(),C(c,{key:0,gutter:20},{default:U(()=>[S(s,{span:12},{default:U(()=>[S(t,{label:"默认密码",prop:"password"},{default:U(()=>[S(a,{modelValue:i.value.password,"onUpdate:modelValue":l[2]||(l[2]=e=>i.value.password=e),type:"password",placeholder:"请输入默认密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1}),S(s,{span:12},{default:U(()=>[S(t,{label:"确认密码",prop:"confirmPassword"},{default:U(()=>[S(a,{modelValue:i.value.confirmPassword,"onUpdate:modelValue":l[3]||(l[3]=e=>i.value.confirmPassword=e),type:"password",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})),S(c,{gutter:20},{default:U(()=>[S(s,{span:12},{default:U(()=>[S(t,{label:"所属部门",prop:"departmentId"},{default:U(()=>[S(g,{modelValue:i.value.departmentId,"onUpdate:modelValue":l[4]||(l[4]=e=>i.value.departmentId=e),placeholder:"请选择部门"},{default:U(()=>[S(f,{label:"管理部",value:"admin"}),S(f,{label:"销售一部",value:"sales_1"}),S(f,{label:"销售二部",value:"sales_2"}),S(f,{label:"客服部",value:"service"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),S(s,{span:12},{default:U(()=>[S(t,{label:"用户角色",prop:"role"},{default:U(()=>[S(g,{modelValue:i.value.role,"onUpdate:modelValue":l[5]||(l[5]=e=>i.value.role=e),placeholder:"请选择角色"},{default:U(()=>[S(f,{label:"超级管理员",value:"super_admin"}),S(f,{label:"部门负责人",value:"department_manager"}),S(f,{label:"销售员",value:"sales_staff"}),S(f,{label:"客服",value:"customer_service"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(c,{gutter:20},{default:U(()=>[S(s,{span:12},{default:U(()=>[S(t,{label:"数据权限",prop:"dataScope"},{default:U(()=>[S(g,{modelValue:i.value.dataScope,"onUpdate:modelValue":l[6]||(l[6]=e=>i.value.dataScope=e),placeholder:"请选择数据权限"},{default:U(()=>[S(f,{label:"全部数据",value:"all"}),S(f,{label:"部门数据",value:"department"}),S(f,{label:"个人数据",value:"personal"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),S(s,{span:12},{default:U(()=>[S(t,{label:"权限级别",prop:"permissionLevel"},{default:U(()=>[S(g,{modelValue:i.value.permissionLevel,"onUpdate:modelValue":l[7]||(l[7]=e=>i.value.permissionLevel=e),placeholder:"请选择权限级别"},{default:U(()=>[S(f,{label:"完全权限",value:"full_access"}),S(f,{label:"部分权限",value:"partial_access"}),S(f,{label:"只读权限",value:"read_only"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(t,{label:"用户状态",prop:"status"},{default:U(()=>[S(y,{modelValue:i.value.status,"onUpdate:modelValue":l[8]||(l[8]=e=>i.value.status=e)},{default:U(()=>[S(_,{label:"active"},{default:U(()=>[...l[12]||(l[12]=[I("启用",-1)])]),_:1}),S(_,{label:"inactive"},{default:U(()=>[...l[13]||(l[13]=[I("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(t,{label:"功能权限"},{default:U(()=>[S(h,{modelValue:i.value.permissions,"onUpdate:modelValue":l[9]||(l[9]=e=>i.value.permissions=e)},{default:U(()=>[S(c,{gutter:20},{default:U(()=>[(x(),T(D,null,L(d,e=>S(s,{span:8,key:e.value},{default:U(()=>[S(b,{label:e.value},{default:U(()=>[I(R(e.label),1)]),_:2},1032,["label"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(t,{label:"备注"},{default:U(()=>[S(a,{modelValue:i.value.remark,"onUpdate:modelValue":l[10]||(l[10]=e=>i.value.remark=e),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-f7ead4f3"]]),N={class:"dialog-footer"},H={class:"permission-preview"},J={key:0,class:"no-permissions"},Z=e(b({__name:"RoleTemplateDialog",props:{modelValue:{type:Boolean},template:{}},emits:["update:modelValue","confirm"],setup(e,{emit:l}){const a=e,t=l,u=h(),r=h(!1),n=h(!1),i=h("customer"),d=w({get:()=>a.modelValue,set:e=>t("update:modelValue",e)}),m=w(()=>!!a.template?.id),c=h({name:"",description:"",targetRole:"",permissions:[],dataScope:"department",isActive:!0}),p=[{label:"客户查看",value:"customer_view",description:"查看客户基本信息和联系方式"},{label:"客户新增",value:"customer_create",description:"创建新的客户档案"},{label:"客户编辑",value:"customer_edit",description:"修改客户信息"},{label:"客户删除",value:"customer_delete",description:"删除客户档案"},{label:"客户导入",value:"customer_import",description:"批量导入客户数据"},{label:"客户导出",value:"customer_export",description:"导出客户数据"}],v=[{label:"订单查看",value:"order_view",description:"查看订单详情和状态"},{label:"订单创建",value:"order_create",description:"创建新订单"},{label:"订单编辑",value:"order_edit",description:"修改订单信息"},{label:"订单删除",value:"order_delete",description:"删除订单记录"},{label:"订单审核",value:"order_approve",description:"审核订单状态"},{label:"订单发货",value:"order_ship",description:"处理订单发货"}],f=[{label:"销售报表",value:"report_sales",description:"查看销售数据报表"},{label:"客户报表",value:"report_customer",description:"查看客户分析报表"},{label:"业绩报表",value:"report_performance",description:"查看业绩统计报表"},{label:"财务报表",value:"report_finance",description:"查看财务数据报表"},{label:"报表导出",value:"report_export",description:"导出各类报表数据"},{label:"报表打印",value:"report_print",description:"打印报表文档"}],g=[{label:"用户管理",value:"user_management",description:"管理系统用户账户"},{label:"角色管理",value:"role_management",description:"管理用户角色权限"},{label:"部门管理",value:"department_management",description:"管理组织架构"},{label:"系统设置",value:"system_setting",description:"配置系统参数"},{label:"日志查看",value:"log_view",description:"查看系统操作日志"},{label:"数据备份",value:"data_backup",description:"执行数据备份操作"}],_=[...p,...v,...f,...g],y=w(()=>c.value.permissions.map(e=>{const l=_.find(l=>l.value===e);return l?l.label:e})),b={name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],description:[{required:!0,message:"请输入模板描述",trigger:"blur"}],targetRole:[{required:!0,message:"请选择适用角色",trigger:"change"}],permissions:[{required:!0,message:"请至少选择一个权限",trigger:"change"}]},$=()=>{c.value={name:"",description:"",targetRole:"",permissions:[],dataScope:"department",isActive:!0},u.value?.clearValidate()};V(()=>a.template,e=>{e?c.value={...e}:$()},{immediate:!0});const B=()=>{d.value=!1,$()},j=()=>{n.value=!0},O=async()=>{try{if(await u.value.validate(),0===c.value.permissions.length)return void s.warning("请至少选择一个权限");r.value=!0,await new Promise(e=>setTimeout(e,1e3)),t("confirm",{...c.value}),B(),s.success(m.value?"角色模板更新成功":"角色模板创建成功")}catch(e){console.error("表单验证失败:",e)}finally{r.value=!1}};return(e,l)=>{const a=k("el-input"),t=k("el-form-item"),s=k("el-col"),_=k("el-option"),h=k("el-select"),w=k("el-row"),V=k("el-icon"),$=k("el-tooltip"),E=k("el-checkbox"),M=k("el-checkbox-group"),q=k("el-tab-pane"),F=k("el-tabs"),Y=k("el-radio"),Z=k("el-radio-group"),G=k("el-switch"),K=k("el-form"),Q=k("el-button"),W=k("el-tag"),X=k("el-dialog");return x(),C(X,{modelValue:d.value,"onUpdate:modelValue":l[11]||(l[11]=e=>d.value=e),title:m.value?"编辑角色模板":"创建角色模板",width:"900px",onClose:B},{footer:U(()=>[z("div",N,[S(Q,{onClick:B},{default:U(()=>[...l[15]||(l[15]=[I("取消",-1)])]),_:1}),S(Q,{onClick:j,type:"info"},{default:U(()=>[...l[16]||(l[16]=[I("预览权限",-1)])]),_:1}),S(Q,{type:"primary",onClick:O,loading:r.value},{default:U(()=>[I(R(m.value?"更新模板":"创建模板"),1)]),_:1},8,["loading"])])]),default:U(()=>[S(K,{ref_key:"formRef",ref:u,model:c.value,rules:b,"label-width":"120px"},{default:U(()=>[S(w,{gutter:20},{default:U(()=>[S(s,{span:12},{default:U(()=>[S(t,{label:"模板名称",prop:"name"},{default:U(()=>[S(a,{modelValue:c.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>c.value.name=e),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1})]),_:1}),S(s,{span:12},{default:U(()=>[S(t,{label:"适用角色",prop:"targetRole"},{default:U(()=>[S(h,{modelValue:c.value.targetRole,"onUpdate:modelValue":l[1]||(l[1]=e=>c.value.targetRole=e),placeholder:"请选择适用角色"},{default:U(()=>[S(_,{label:"部门负责人",value:"department_manager"}),S(_,{label:"销售员",value:"sales_staff"}),S(_,{label:"客服",value:"customer_service"}),S(_,{label:"财务",value:"finance"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),S(t,{label:"模板描述",prop:"description"},{default:U(()=>[S(a,{modelValue:c.value.description,"onUpdate:modelValue":l[2]||(l[2]=e=>c.value.description=e),type:"textarea",rows:3,placeholder:"请输入模板描述"},null,8,["modelValue"])]),_:1}),S(t,{label:"权限配置",prop:"permissions"},{default:U(()=>[S(F,{modelValue:i.value,"onUpdate:modelValue":l[7]||(l[7]=e=>i.value=e),type:"border-card"},{default:U(()=>[S(q,{label:"客户管理",name:"customer"},{default:U(()=>[S(M,{modelValue:c.value.permissions,"onUpdate:modelValue":l[3]||(l[3]=e=>c.value.permissions=e)},{default:U(()=>[S(w,{gutter:20},{default:U(()=>[(x(),T(D,null,L(p,e=>S(s,{span:8,key:e.value},{default:U(()=>[S(E,{label:e.value},{default:U(()=>[z("span",null,R(e.label),1),S($,{content:e.description,placement:"top"},{default:U(()=>[S(V,{style:{"margin-left":"5px",color:"#909399"}},{default:U(()=>[S(A(o))]),_:1})]),_:1},8,["content"])]),_:2},1032,["label"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(q,{label:"订单管理",name:"order"},{default:U(()=>[S(M,{modelValue:c.value.permissions,"onUpdate:modelValue":l[4]||(l[4]=e=>c.value.permissions=e)},{default:U(()=>[S(w,{gutter:20},{default:U(()=>[(x(),T(D,null,L(v,e=>S(s,{span:8,key:e.value},{default:U(()=>[S(E,{label:e.value},{default:U(()=>[z("span",null,R(e.label),1),S($,{content:e.description,placement:"top"},{default:U(()=>[S(V,{style:{"margin-left":"5px",color:"#909399"}},{default:U(()=>[S(A(o))]),_:1})]),_:1},8,["content"])]),_:2},1032,["label"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(q,{label:"报表分析",name:"report"},{default:U(()=>[S(M,{modelValue:c.value.permissions,"onUpdate:modelValue":l[5]||(l[5]=e=>c.value.permissions=e)},{default:U(()=>[S(w,{gutter:20},{default:U(()=>[(x(),T(D,null,L(f,e=>S(s,{span:8,key:e.value},{default:U(()=>[S(E,{label:e.value},{default:U(()=>[z("span",null,R(e.label),1),S($,{content:e.description,placement:"top"},{default:U(()=>[S(V,{style:{"margin-left":"5px",color:"#909399"}},{default:U(()=>[S(A(o))]),_:1})]),_:1},8,["content"])]),_:2},1032,["label"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(q,{label:"系统管理",name:"system"},{default:U(()=>[S(M,{modelValue:c.value.permissions,"onUpdate:modelValue":l[6]||(l[6]=e=>c.value.permissions=e)},{default:U(()=>[S(w,{gutter:20},{default:U(()=>[(x(),T(D,null,L(g,e=>S(s,{span:8,key:e.value},{default:U(()=>[S(E,{label:e.value},{default:U(()=>[z("span",null,R(e.label),1),S($,{content:e.description,placement:"top"},{default:U(()=>[S(V,{style:{"margin-left":"5px",color:"#909399"}},{default:U(()=>[S(A(o))]),_:1})]),_:1},8,["content"])]),_:2},1032,["label"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(t,{label:"数据范围"},{default:U(()=>[S(Z,{modelValue:c.value.dataScope,"onUpdate:modelValue":l[8]||(l[8]=e=>c.value.dataScope=e)},{default:U(()=>[S(Y,{label:"all"},{default:U(()=>[...l[12]||(l[12]=[I("全部数据",-1)])]),_:1}),S(Y,{label:"department"},{default:U(()=>[...l[13]||(l[13]=[I("部门数据",-1)])]),_:1}),S(Y,{label:"personal"},{default:U(()=>[...l[14]||(l[14]=[I("个人数据",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(t,{label:"模板状态"},{default:U(()=>[S(G,{modelValue:c.value.isActive,"onUpdate:modelValue":l[9]||(l[9]=e=>c.value.isActive=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),S(X,{modelValue:n.value,"onUpdate:modelValue":l[10]||(l[10]=e=>n.value=e),title:"权限预览",width:"600px","append-to-body":""},{default:U(()=>[z("div",H,[l[17]||(l[17]=z("h4",null,"已选择的权限：",-1)),(x(!0),T(D,null,L(y.value,e=>(x(),C(W,{key:e,style:{margin:"5px"},type:"success"},{default:U(()=>[I(R(e),1)]),_:2},1024))),128)),0===y.value.length?(x(),T("div",J," 暂未选择任何权限 ")):P("",!0)])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-09651bfd"]]),G={class:"dialog-footer"},K=e(b({__name:"DepartmentDialog",props:{modelValue:{type:Boolean},department:{},parentDepartments:{default:()=>[]},availableManagers:{default:()=>[]}},emits:["update:modelValue","confirm"],setup(e,{emit:l}){const a=e,t=l,u=h(),o=h(!1),r=w({get:()=>a.modelValue,set:e=>t("update:modelValue",e)}),n=w(()=>!!a.department?.id),i=h({name:"",parentId:"",managerId:"",permissionLevel:"basic",dataScope:"department",description:"",isActive:!0}),d={name:[{required:!0,message:"请输入部门名称",trigger:"blur"},{min:2,max:50,message:"部门名称长度在 2 到 50 个字符",trigger:"blur"}],permissionLevel:[{required:!0,message:"请选择权限级别",trigger:"change"}],dataScope:[{required:!0,message:"请选择数据范围",trigger:"change"}]},m=()=>{i.value={name:"",parentId:"",managerId:"",permissionLevel:"basic",dataScope:"department",description:"",isActive:!0},u.value?.clearValidate()};V(()=>a.department,e=>{e?i.value={...e}:m()},{immediate:!0});const c=()=>{m(),t("update:modelValue",!1)},p=async()=>{try{await u.value.validate(),o.value=!0,await new Promise(e=>setTimeout(e,1e3)),t("confirm",{...i.value}),c(),s.success(n.value?"部门更新成功":"部门创建成功")}catch(e){console.error("表单验证失败:",e)}finally{o.value=!1}};return(l,a)=>{const t=k("el-input"),s=k("el-form-item"),m=k("el-option"),v=k("el-select"),f=k("el-radio"),g=k("el-radio-group"),_=k("el-switch"),y=k("el-form"),b=k("el-button"),h=k("el-dialog");return x(),C(h,{modelValue:r.value,"onUpdate:modelValue":a[7]||(a[7]=e=>r.value=e),title:n.value?"编辑部门":"新增部门",width:"600px",onClose:c},{footer:U(()=>[z("div",G,[S(b,{onClick:c},{default:U(()=>[...a[11]||(a[11]=[I("取消",-1)])]),_:1}),S(b,{type:"primary",onClick:p,loading:o.value},{default:U(()=>[I(R(n.value?"更新部门":"创建部门"),1)]),_:1},8,["loading"])])]),default:U(()=>[S(y,{ref_key:"formRef",ref:u,model:i.value,rules:d,"label-width":"120px"},{default:U(()=>[S(s,{label:"部门名称",prop:"name"},{default:U(()=>[S(t,{modelValue:i.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value.name=e),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),S(s,{label:"上级部门",prop:"parentId"},{default:U(()=>[S(v,{modelValue:i.value.parentId,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value.parentId=e),placeholder:"请选择上级部门",clearable:""},{default:U(()=>[S(m,{label:"无上级部门",value:""}),(x(!0),T(D,null,L(e.parentDepartments,e=>(x(),C(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),S(s,{label:"部门负责人",prop:"managerId"},{default:U(()=>[S(v,{modelValue:i.value.managerId,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value.managerId=e),placeholder:"请选择部门负责人",clearable:"",filterable:""},{default:U(()=>[(x(!0),T(D,null,L(e.availableManagers,e=>(x(),C(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),S(s,{label:"权限级别",prop:"permissionLevel"},{default:U(()=>[S(v,{modelValue:i.value.permissionLevel,"onUpdate:modelValue":a[3]||(a[3]=e=>i.value.permissionLevel=e),placeholder:"请选择权限级别"},{default:U(()=>[S(m,{label:"高级权限",value:"high"}),S(m,{label:"中级权限",value:"medium"}),S(m,{label:"基础权限",value:"basic"})]),_:1},8,["modelValue"])]),_:1}),S(s,{label:"数据范围",prop:"dataScope"},{default:U(()=>[S(g,{modelValue:i.value.dataScope,"onUpdate:modelValue":a[4]||(a[4]=e=>i.value.dataScope=e)},{default:U(()=>[S(f,{label:"all"},{default:U(()=>[...a[8]||(a[8]=[I("全部数据",-1)])]),_:1}),S(f,{label:"department"},{default:U(()=>[...a[9]||(a[9]=[I("部门数据",-1)])]),_:1}),S(f,{label:"personal"},{default:U(()=>[...a[10]||(a[10]=[I("个人数据",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(s,{label:"部门描述",prop:"description"},{default:U(()=>[S(t,{modelValue:i.value.description,"onUpdate:modelValue":a[5]||(a[5]=e=>i.value.description=e),type:"textarea",rows:3,placeholder:"请输入部门描述"},null,8,["modelValue"])]),_:1}),S(s,{label:"部门状态"},{default:U(()=>[S(_,{modelValue:i.value.isActive,"onUpdate:modelValue":a[6]||(a[6]=e=>i.value.isActive=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-c253f218"]]),Q={class:"member-management"},W={class:"actions"},X={class:"dialog-footer"},ee=e(b({__name:"DepartmentMembersDialog",props:{modelValue:{type:Boolean},department:{}},emits:["update:modelValue"],setup(e,{emit:l}){const a=e,t=l,u=h(!1),o=h(!1),m=h(!1),c=h(""),p=h([]),v=w({get:()=>a.modelValue,set:e=>t("update:modelValue",e)}),f=h([{id:"1",name:"张三",email:"zhangsan@example.com",role:"department_manager",joinDate:"2024-01-15",status:"active"},{id:"2",name:"李四",email:"lisi@example.com",role:"sales_staff",joinDate:"2024-02-01",status:"active"}]),g=h([{id:"3",name:"王五",email:"wangwu@example.com"},{id:"4",name:"赵六",email:"zhaoliu@example.com"}]),_=h({userIds:[],defaultRole:"sales_staff"}),y=w(()=>c.value?f.value.filter(e=>e.name.includes(c.value)||e.email.includes(c.value)):f.value),b=e=>({department_manager:"部门负责人",sales_staff:"销售员",customer_service:"客服",finance:"财务"}[e]||e),V=e=>{p.value=e},P=async()=>{try{await d.confirm(`确定要移除选中的 ${p.value.length} 个成员吗？`,"批量移除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=p.value.map(e=>e.id);f.value=f.value.filter(l=>!e.includes(l.id)),p.value=[],s.success("批量移除成功")}catch{}},j=async()=>{if(0!==_.value.userIds.length){o.value=!0;try{await new Promise(e=>setTimeout(e,1e3));const e=_.value.userIds.map(e=>{const l=g.value.find(l=>l.id===e);return{id:e,name:l?.name||"",email:l?.email||"",role:_.value.defaultRole,joinDate:(new Date).toISOString().split("T")[0],status:"active"}});f.value.push(...e),g.value=g.value.filter(e=>!_.value.userIds.includes(e.id)),m.value=!1,_.value.userIds=[],_.value.defaultRole="sales_staff",s.success("成员添加成功")}catch(e){s.error("添加成员失败")}finally{o.value=!1}}else s.warning("请选择要添加的用户")},O=()=>{t("update:modelValue",!1)};return(l,a)=>{const t=k("el-icon"),h=k("el-button"),w=k("el-input"),E=k("el-table-column"),M=k("el-tag"),q=k("el-table"),F=k("el-option"),Y=k("el-select"),N=k("el-form-item"),H=k("el-form"),J=k("el-dialog"),Z=$("loading");return x(),C(J,{modelValue:v.value,"onUpdate:modelValue":a[6]||(a[6]=e=>v.value=e),title:`管理部门成员 - ${e.department?.name}`,width:"800px",onClose:O},{footer:U(()=>[z("div",X,[S(h,{onClick:O},{default:U(()=>[...a[13]||(a[13]=[I("关闭",-1)])]),_:1})])]),default:U(()=>[z("div",Q,[z("div",W,[S(h,{onClick:a[0]||(a[0]=e=>m.value=!0),type:"primary"},{default:U(()=>[S(t,null,{default:U(()=>[S(A(r))]),_:1}),a[7]||(a[7]=I(" 添加成员 ",-1))]),_:1}),S(h,{onClick:P,type:"danger",disabled:0===p.value.length},{default:U(()=>[S(t,null,{default:U(()=>[S(A(n))]),_:1}),a[8]||(a[8]=I(" 批量移除 ",-1))]),_:1},8,["disabled"]),S(w,{modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value=e),placeholder:"搜索成员",style:{width:"200px","margin-left":"10px"},clearable:""},{prefix:U(()=>[S(t,null,{default:U(()=>[S(A(i))]),_:1})]),_:1},8,["modelValue"])]),B((x(),C(q,{data:y.value,style:{width:"100%","margin-top":"20px"},onSelectionChange:V},{default:U(()=>[S(E,{type:"selection",width:"55"}),S(E,{prop:"name",label:"姓名",width:"120"}),S(E,{prop:"email",label:"邮箱",width:"200"}),S(E,{prop:"role",label:"角色",width:"120"},{default:U(({row:e})=>{return[S(M,{type:(l=e.role,{department_manager:"danger",sales_staff:"primary",customer_service:"success",finance:"warning"}[l]||"info")},{default:U(()=>[I(R(b(e.role)),1)]),_:2},1032,["type"])];var l}),_:1}),S(E,{prop:"joinDate",label:"加入时间",width:"120"}),S(E,{label:"状态",width:"100"},{default:U(({row:e})=>[S(M,{type:"active"===e.status?"success":"danger"},{default:U(()=>[I(R("active"===e.status?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),S(E,{label:"操作",width:"150"},{default:U(({row:e})=>[S(h,{onClick:l=>{return a=e,void s.info(`编辑 ${a.name} 的角色`);var a},size:"small",type:"primary"},{default:U(()=>[...a[9]||(a[9]=[I("编辑角色",-1)])]),_:1},8,["onClick"]),S(h,{onClick:l=>(async e=>{try{await d.confirm(`确定要将 ${e.name} 从部门中移除吗？`,"确认移除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.value=f.value.filter(l=>l.id!==e.id),s.success("成员移除成功")}catch{}})(e),size:"small",type:"danger"},{default:U(()=>[...a[10]||(a[10]=[I("移除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,u.value]])]),S(J,{modelValue:m.value,"onUpdate:modelValue":a[5]||(a[5]=e=>m.value=e),title:"添加部门成员",width:"500px","append-to-body":""},{footer:U(()=>[S(h,{onClick:a[4]||(a[4]=e=>m.value=!1)},{default:U(()=>[...a[11]||(a[11]=[I("取消",-1)])]),_:1}),S(h,{type:"primary",onClick:j,loading:o.value},{default:U(()=>[...a[12]||(a[12]=[I("确定",-1)])]),_:1},8,["loading"])]),default:U(()=>[S(H,{model:_.value,"label-width":"100px"},{default:U(()=>[S(N,{label:"选择用户"},{default:U(()=>[S(Y,{modelValue:_.value.userIds,"onUpdate:modelValue":a[2]||(a[2]=e=>_.value.userIds=e),placeholder:"请选择要添加的用户",multiple:"",filterable:"",style:{width:"100%"}},{default:U(()=>[(x(!0),T(D,null,L(g.value,e=>(x(),C(F,{key:e.id,label:`${e.name} (${e.email})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),S(N,{label:"默认角色"},{default:U(()=>[S(Y,{modelValue:_.value.defaultRole,"onUpdate:modelValue":a[3]||(a[3]=e=>_.value.defaultRole=e),placeholder:"请选择默认角色"},{default:U(()=>[S(F,{label:"部门负责人",value:"department_manager"}),S(F,{label:"销售员",value:"sales_staff"}),S(F,{label:"客服",value:"customer_service"}),S(F,{label:"财务",value:"finance"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-3b2855bd"]]),le={class:"permission-details"},ae={class:"permission-section"},te={class:"section-header"},ue={class:"permission-section"},se={class:"section-header"},oe={class:"permission-section"},re={class:"section-header"},ne={class:"data-permission"},ie={class:"inheritance-info"},de={class:"inheritance-tree"},me={class:"dialog-footer"},ce=e(b({__name:"DepartmentPermissionsDialog",props:{modelValue:{type:Boolean},department:{}},emits:["update:modelValue","update"],setup(e,{emit:l}){const a=e,t=l,u=h("functional"),o=h(!1),r=h(!1),n=w({get:()=>a.modelValue,set:e=>t("update:modelValue",e)}),i=h([]),d=h("department"),m=h({customer:["view","create"],order:["view"],report:["view"]}),c=[{key:"customer.view",label:"查看客户"},{key:"customer.create",label:"创建客户"},{key:"customer.edit",label:"编辑客户"},{key:"customer.delete",label:"删除客户"},{key:"customer.export",label:"导出客户"},{key:"customer.import",label:"导入客户"}],p=[{key:"order.view",label:"查看订单"},{key:"order.create",label:"创建订单"},{key:"order.edit",label:"编辑订单"},{key:"order.delete",label:"删除订单"},{key:"order.export",label:"导出订单"},{key:"order.audit",label:"审核订单"}],v=[{key:"system.user",label:"用户管理"},{key:"system.role",label:"角色管理"},{key:"system.permission",label:"权限管理"},{key:"system.config",label:"系统配置"}],f=h([{label:"销售部",children:[{label:"客户管理权限"},{label:"订单管理权限"},{label:"报表查看权限"}]}]),g=h(["customer.view","customer.create","order.view"]);V(()=>a.department,e=>{e&&(i.value=e.permissions||[],d.value=e.dataScope||"department")},{immediate:!0});const _=e=>i.value.includes(e),y=(e,l)=>{if(l)i.value.includes(e)||i.value.push(e);else{const l=i.value.indexOf(e);l>-1&&i.value.splice(l,1)}},b=e=>{o.value=!0,s.info(`编辑${e}权限组`)},A=()=>{o.value=!1,a.department&&(i.value=a.department.permissions||[],d.value=a.department.dataScope||"department")},$=async()=>{r.value=!0;try{if(await new Promise(e=>setTimeout(e,1e3)),a.department){const e={...a.department,permissions:[...i.value],dataScope:d.value};t("update",e)}o.value=!1,s.success("权限保存成功")}catch(e){s.error("权限保存失败")}finally{r.value=!1}},B=()=>{o.value=!1,t("update:modelValue",!1)};return(l,a)=>{const t=k("el-button"),s=k("el-checkbox"),i=k("el-col"),h=k("el-row"),w=k("el-tab-pane"),V=k("el-radio"),j=k("el-radio-group"),O=k("el-form-item"),E=k("el-checkbox-group"),M=k("el-form"),q=k("el-alert"),F=k("el-tree"),Y=k("el-tabs"),N=k("el-dialog");return x(),C(N,{modelValue:n.value,"onUpdate:modelValue":a[9]||(a[9]=e=>n.value=e),title:`部门权限详情 - ${e.department?.name}`,width:"900px",onClose:B},{footer:U(()=>[z("div",me,[S(t,{onClick:B},{default:U(()=>[...a[35]||(a[35]=[I("关闭",-1)])]),_:1}),o.value?(x(),T(D,{key:1},[S(t,{onClick:A},{default:U(()=>[...a[37]||(a[37]=[I("取消",-1)])]),_:1}),S(t,{onClick:$,type:"primary",loading:r.value},{default:U(()=>[...a[38]||(a[38]=[I("保存",-1)])]),_:1},8,["loading"])],64)):(x(),C(t,{key:0,onClick:a[8]||(a[8]=e=>o.value=!0),type:"primary"},{default:U(()=>[...a[36]||(a[36]=[I("编辑权限",-1)])]),_:1}))])]),default:U(()=>[z("div",le,[S(Y,{modelValue:u.value,"onUpdate:modelValue":a[7]||(a[7]=e=>u.value=e),type:"border-card"},{default:U(()=>[S(w,{label:"功能权限",name:"functional"},{default:U(()=>[z("div",ae,[z("div",te,[a[11]||(a[11]=z("h4",null,"客户管理权限",-1)),S(t,{onClick:a[0]||(a[0]=e=>b("customer")),size:"small",type:"primary"},{default:U(()=>[...a[10]||(a[10]=[I("编辑",-1)])]),_:1})]),S(h,{gutter:20},{default:U(()=>[(x(),T(D,null,L(c,e=>S(i,{span:6,key:e.key},{default:U(()=>[S(s,{"model-value":_(e.key),onChange:l=>y(e.key,l),disabled:!o.value},{default:U(()=>[I(R(e.label),1)]),_:2},1032,["model-value","onChange","disabled"])]),_:2},1024)),64))]),_:1})]),z("div",ue,[z("div",se,[a[13]||(a[13]=z("h4",null,"订单管理权限",-1)),S(t,{onClick:a[1]||(a[1]=e=>b("order")),size:"small",type:"primary"},{default:U(()=>[...a[12]||(a[12]=[I("编辑",-1)])]),_:1})]),S(h,{gutter:20},{default:U(()=>[(x(),T(D,null,L(p,e=>S(i,{span:6,key:e.key},{default:U(()=>[S(s,{"model-value":_(e.key),onChange:l=>y(e.key,l),disabled:!o.value},{default:U(()=>[I(R(e.label),1)]),_:2},1032,["model-value","onChange","disabled"])]),_:2},1024)),64))]),_:1})]),z("div",oe,[z("div",re,[a[15]||(a[15]=z("h4",null,"系统管理权限",-1)),S(t,{onClick:a[2]||(a[2]=e=>b("system")),size:"small",type:"primary"},{default:U(()=>[...a[14]||(a[14]=[I("编辑",-1)])]),_:1})]),S(h,{gutter:20},{default:U(()=>[(x(),T(D,null,L(v,e=>S(i,{span:6,key:e.key},{default:U(()=>[S(s,{"model-value":_(e.key),onChange:l=>y(e.key,l),disabled:!o.value},{default:U(()=>[I(R(e.label),1)]),_:2},1032,["model-value","onChange","disabled"])]),_:2},1024)),64))]),_:1})])]),_:1}),S(w,{label:"数据权限",name:"data"},{default:U(()=>[z("div",ne,[S(M,{"label-width":"120px"},{default:U(()=>[S(O,{label:"数据范围"},{default:U(()=>[S(j,{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=e=>d.value=e),disabled:!o.value},{default:U(()=>[S(V,{label:"all"},{default:U(()=>[...a[16]||(a[16]=[I("全部数据",-1)])]),_:1}),S(V,{label:"department"},{default:U(()=>[...a[17]||(a[17]=[I("本部门数据",-1)])]),_:1}),S(V,{label:"personal"},{default:U(()=>[...a[18]||(a[18]=[I("个人数据",-1)])]),_:1}),S(V,{label:"custom"},{default:U(()=>[...a[19]||(a[19]=[I("自定义范围",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),"custom"===d.value?(x(),C(O,{key:0,label:"客户数据权限"},{default:U(()=>[S(E,{modelValue:m.value.customer,"onUpdate:modelValue":a[4]||(a[4]=e=>m.value.customer=e),disabled:!o.value},{default:U(()=>[S(s,{label:"view"},{default:U(()=>[...a[20]||(a[20]=[I("查看",-1)])]),_:1}),S(s,{label:"create"},{default:U(()=>[...a[21]||(a[21]=[I("创建",-1)])]),_:1}),S(s,{label:"edit"},{default:U(()=>[...a[22]||(a[22]=[I("编辑",-1)])]),_:1}),S(s,{label:"delete"},{default:U(()=>[...a[23]||(a[23]=[I("删除",-1)])]),_:1}),S(s,{label:"export"},{default:U(()=>[...a[24]||(a[24]=[I("导出",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})):P("",!0),"custom"===d.value?(x(),C(O,{key:1,label:"订单数据权限"},{default:U(()=>[S(E,{modelValue:m.value.order,"onUpdate:modelValue":a[5]||(a[5]=e=>m.value.order=e),disabled:!o.value},{default:U(()=>[S(s,{label:"view"},{default:U(()=>[...a[25]||(a[25]=[I("查看",-1)])]),_:1}),S(s,{label:"create"},{default:U(()=>[...a[26]||(a[26]=[I("创建",-1)])]),_:1}),S(s,{label:"edit"},{default:U(()=>[...a[27]||(a[27]=[I("编辑",-1)])]),_:1}),S(s,{label:"delete"},{default:U(()=>[...a[28]||(a[28]=[I("删除",-1)])]),_:1}),S(s,{label:"export"},{default:U(()=>[...a[29]||(a[29]=[I("导出",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})):P("",!0),"custom"===d.value?(x(),C(O,{key:2,label:"报表权限"},{default:U(()=>[S(E,{modelValue:m.value.report,"onUpdate:modelValue":a[6]||(a[6]=e=>m.value.report=e),disabled:!o.value},{default:U(()=>[S(s,{label:"view"},{default:U(()=>[...a[30]||(a[30]=[I("查看",-1)])]),_:1}),S(s,{label:"export"},{default:U(()=>[...a[31]||(a[31]=[I("导出",-1)])]),_:1}),S(s,{label:"share"},{default:U(()=>[...a[32]||(a[32]=[I("分享",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})):P("",!0)]),_:1})])]),_:1}),S(w,{label:"权限继承",name:"inheritance"},{default:U(()=>[z("div",ie,[S(q,{title:"权限继承说明",type:"info",closable:!1,style:{"margin-bottom":"20px"}},{default:U(()=>[...a[33]||(a[33]=[z("p",null,"部门权限会自动继承给部门内的所有成员，成员的个人权限不能超过部门权限范围。",-1)])]),_:1}),z("div",de,[a[34]||(a[34]=z("h4",null,"权限继承关系",-1)),S(F,{data:f.value,props:{children:"children",label:"label"},"default-expand-all":"","show-checkbox":"","check-strictly":!0,"default-checked-keys":g.value},null,8,["data","default-checked-keys"])])])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-8a46cb27"]]),pe={class:"batch-assign"},ve={key:0,class:"step-content"},fe={key:1,class:"step-content"},ge={class:"permission-group"},_e={class:"permission-group"},ye={class:"permission-group"},be={class:"template-actions"},he={key:2,class:"step-content"},we={class:"confirm-info"},Ve={class:"selected-departments"},ke={class:"selected-permissions"},Ce={class:"permission-summary"},xe={key:0},Ue={key:1},Se={key:2},Pe={class:"dialog-footer"},Ie=e(b({__name:"BatchAssignPermissionsDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","assigned"],setup(e,{emit:l}){const a=e,t=l,u=h(0),o=h("functional"),r=h(!1),n=w({get:()=>a.modelValue,set:e=>t("update:modelValue",e)}),i=h([{key:"1",label:"销售部",disabled:!1},{key:"2",label:"市场部",disabled:!1},{key:"3",label:"技术部",disabled:!1},{key:"4",label:"客服部",disabled:!1},{key:"5",label:"财务部",disabled:!1},{key:"6",label:"人事部",disabled:!1}]),m=h([]),c=h({customer:["view"],order:["view"],system:[]}),p=h("department"),v=h("readonly"),f=h(null),g=w(()=>i.value.filter(e=>m.value.includes(e.key)).map(e=>e.label)),_=w(()=>({readonly:"只读",edit:"编辑",manage:"管理",super:"超级管理员"}[v.value]||"未设置")),y=w(()=>({all:"全部数据",department:"本部门数据",personal:"个人数据",custom:"自定义范围"}[p.value]||"未设置")),b=w(()=>f.value?`${f.value[0]} 至 ${f.value[1]}`:"立即生效"),V={customer:{view:"查看客户",create:"创建客户",edit:"编辑客户",delete:"删除客户",export:"导出客户"},order:{view:"查看订单",create:"创建订单",edit:"编辑订单",delete:"删除订单",audit:"审核订单"},system:{user:"用户管理",role:"角色管理",permission:"权限管理",config:"系统配置"}},A=(e,l)=>V[e]?.[l]||l,$=()=>{if(0!==u.value||0!==m.value.length){if(1===u.value){if(!(c.value.customer.length>0||c.value.order.length>0||c.value.system.length>0))return void s.warning("请至少选择一个权限")}u.value<2&&u.value++}else s.warning("请至少选择一个部门")},B=()=>{u.value>0&&u.value--},j=()=>{s.info("加载权限模板功能开发中")},O=()=>{s.info("保存权限模板功能开发中")},E=()=>{c.value={customer:[],order:[],system:[]},s.success("权限已清空")},M=async()=>{try{await d.confirm(`确定要为 ${g.value.length} 个部门分配权限吗？`,"确认分配",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.value=!0,await new Promise(e=>setTimeout(e,2e3)),s.success("权限分配成功"),t("assigned"),q()}catch(e){"cancel"!==e&&s.error("权限分配失败")}finally{r.value=!1}},q=()=>{u.value=0,m.value=[],c.value={customer:["view"],order:["view"],system:[]},p.value="department",v.value="readonly",f.value=null,t("update:modelValue",!1)};return(e,l)=>{const a=k("el-step"),t=k("el-steps"),s=k("el-transfer"),d=k("el-checkbox"),h=k("el-checkbox-group"),w=k("el-tab-pane"),V=k("el-radio"),F=k("el-radio-group"),Y=k("el-form-item"),N=k("el-option"),H=k("el-select"),J=k("el-date-picker"),Z=k("el-form"),G=k("el-tabs"),K=k("el-button"),Q=k("el-descriptions-item"),W=k("el-descriptions"),X=k("el-tag"),ee=k("el-dialog");return x(),C(ee,{modelValue:n.value,"onUpdate:modelValue":l[8]||(l[8]=e=>n.value=e),title:"批量分配权限",width:"800px",onClose:q},{footer:U(()=>[z("div",Pe,[S(K,{onClick:q},{default:U(()=>[...l[41]||(l[41]=[I("取消",-1)])]),_:1}),u.value>0?(x(),C(K,{key:0,onClick:B},{default:U(()=>[...l[42]||(l[42]=[I("上一步",-1)])]),_:1})):P("",!0),u.value<2?(x(),C(K,{key:1,onClick:$,type:"primary"},{default:U(()=>[...l[43]||(l[43]=[I("下一步",-1)])]),_:1})):P("",!0),2===u.value?(x(),C(K,{key:2,onClick:M,type:"primary",loading:r.value},{default:U(()=>[...l[44]||(l[44]=[I(" 确认分配 ",-1)])]),_:1},8,["loading"])):P("",!0)])]),default:U(()=>[z("div",pe,[S(t,{active:u.value,"finish-status":"success","align-center":""},{default:U(()=>[S(a,{title:"选择部门"}),S(a,{title:"配置权限"}),S(a,{title:"确认分配"})]),_:1},8,["active"]),0===u.value?(x(),T("div",ve,[l[9]||(l[9]=z("h4",null,"选择要分配权限的部门",-1)),S(s,{modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value=e),data:i.value,titles:["可选部门","已选部门"],"button-texts":["移除","添加"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},filterable:"","filter-placeholder":"搜索部门"},null,8,["modelValue","data"])])):P("",!0),1===u.value?(x(),T("div",fe,[l[34]||(l[34]=z("h4",null,"配置权限模板",-1)),S(G,{modelValue:o.value,"onUpdate:modelValue":l[7]||(l[7]=e=>o.value=e),type:"border-card"},{default:U(()=>[S(w,{label:"功能权限",name:"functional"},{default:U(()=>[z("div",ge,[l[15]||(l[15]=z("h5",null,"客户管理",-1)),S(h,{modelValue:c.value.customer,"onUpdate:modelValue":l[1]||(l[1]=e=>c.value.customer=e)},{default:U(()=>[S(d,{label:"view"},{default:U(()=>[...l[10]||(l[10]=[I("查看客户",-1)])]),_:1}),S(d,{label:"create"},{default:U(()=>[...l[11]||(l[11]=[I("创建客户",-1)])]),_:1}),S(d,{label:"edit"},{default:U(()=>[...l[12]||(l[12]=[I("编辑客户",-1)])]),_:1}),S(d,{label:"delete"},{default:U(()=>[...l[13]||(l[13]=[I("删除客户",-1)])]),_:1}),S(d,{label:"export"},{default:U(()=>[...l[14]||(l[14]=[I("导出客户",-1)])]),_:1})]),_:1},8,["modelValue"])]),z("div",_e,[l[21]||(l[21]=z("h5",null,"订单管理",-1)),S(h,{modelValue:c.value.order,"onUpdate:modelValue":l[2]||(l[2]=e=>c.value.order=e)},{default:U(()=>[S(d,{label:"view"},{default:U(()=>[...l[16]||(l[16]=[I("查看订单",-1)])]),_:1}),S(d,{label:"create"},{default:U(()=>[...l[17]||(l[17]=[I("创建订单",-1)])]),_:1}),S(d,{label:"edit"},{default:U(()=>[...l[18]||(l[18]=[I("编辑订单",-1)])]),_:1}),S(d,{label:"delete"},{default:U(()=>[...l[19]||(l[19]=[I("删除订单",-1)])]),_:1}),S(d,{label:"audit"},{default:U(()=>[...l[20]||(l[20]=[I("审核订单",-1)])]),_:1})]),_:1},8,["modelValue"])]),z("div",ye,[l[26]||(l[26]=z("h5",null,"系统管理",-1)),S(h,{modelValue:c.value.system,"onUpdate:modelValue":l[3]||(l[3]=e=>c.value.system=e)},{default:U(()=>[S(d,{label:"user"},{default:U(()=>[...l[22]||(l[22]=[I("用户管理",-1)])]),_:1}),S(d,{label:"role"},{default:U(()=>[...l[23]||(l[23]=[I("角色管理",-1)])]),_:1}),S(d,{label:"permission"},{default:U(()=>[...l[24]||(l[24]=[I("权限管理",-1)])]),_:1}),S(d,{label:"config"},{default:U(()=>[...l[25]||(l[25]=[I("系统配置",-1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1}),S(w,{label:"数据权限",name:"data"},{default:U(()=>[S(Z,{"label-width":"120px"},{default:U(()=>[S(Y,{label:"数据范围"},{default:U(()=>[S(F,{modelValue:p.value,"onUpdate:modelValue":l[4]||(l[4]=e=>p.value=e)},{default:U(()=>[S(V,{value:"all"},{default:U(()=>[...l[27]||(l[27]=[I("全部数据",-1)])]),_:1}),S(V,{value:"department"},{default:U(()=>[...l[28]||(l[28]=[I("本部门数据",-1)])]),_:1}),S(V,{value:"personal"},{default:U(()=>[...l[29]||(l[29]=[I("个人数据",-1)])]),_:1}),S(V,{value:"custom"},{default:U(()=>[...l[30]||(l[30]=[I("自定义范围",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(Y,{label:"权限级别"},{default:U(()=>[S(H,{modelValue:v.value,"onUpdate:modelValue":l[5]||(l[5]=e=>v.value=e),placeholder:"选择权限级别"},{default:U(()=>[S(N,{label:"只读",value:"readonly"}),S(N,{label:"编辑",value:"edit"}),S(N,{label:"管理",value:"manage"}),S(N,{label:"超级管理员",value:"super"})]),_:1},8,["modelValue"])]),_:1}),S(Y,{label:"生效时间"},{default:U(()=>[S(J,{modelValue:f.value,"onUpdate:modelValue":l[6]||(l[6]=e=>f.value=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),z("div",be,[S(K,{onClick:j,type:"primary",plain:""},{default:U(()=>[...l[31]||(l[31]=[I("加载权限模板",-1)])]),_:1}),S(K,{onClick:O,type:"success",plain:""},{default:U(()=>[...l[32]||(l[32]=[I("保存为模板",-1)])]),_:1}),S(K,{onClick:E,type:"danger",plain:""},{default:U(()=>[...l[33]||(l[33]=[I("清空权限",-1)])]),_:1})])])):P("",!0),2===u.value?(x(),T("div",he,[l[40]||(l[40]=z("h4",null,"确认分配信息",-1)),z("div",we,[S(W,{column:2,border:""},{default:U(()=>[S(Q,{label:"选择部门数量"},{default:U(()=>[I(R(g.value.length),1)]),_:1}),S(Q,{label:"权限级别"},{default:U(()=>[I(R(_.value),1)]),_:1}),S(Q,{label:"数据范围"},{default:U(()=>[I(R(y.value),1)]),_:1}),S(Q,{label:"生效时间"},{default:U(()=>[I(R(b.value),1)]),_:1})]),_:1}),z("div",Ve,[l[35]||(l[35]=z("h5",null,"选择的部门：",-1)),(x(!0),T(D,null,L(g.value,e=>(x(),C(X,{key:e,style:{margin:"5px"},type:"primary"},{default:U(()=>[I(R(e),1)]),_:2},1024))),128))]),z("div",ke,[l[39]||(l[39]=z("h5",null,"分配的权限：",-1)),z("div",Ce,[c.value.customer.length>0?(x(),T("div",xe,[l[36]||(l[36]=z("strong",null,"客户管理：",-1)),(x(!0),T(D,null,L(c.value.customer,e=>(x(),C(X,{key:e,size:"small",style:{margin:"2px"}},{default:U(()=>[I(R(A("customer",e)),1)]),_:2},1024))),128))])):P("",!0),c.value.order.length>0?(x(),T("div",Ue,[l[37]||(l[37]=z("strong",null,"订单管理：",-1)),(x(!0),T(D,null,L(c.value.order,e=>(x(),C(X,{key:e,size:"small",style:{margin:"2px"}},{default:U(()=>[I(R(A("order",e)),1)]),_:2},1024))),128))])):P("",!0),c.value.system.length>0?(x(),T("div",Se,[l[38]||(l[38]=z("strong",null,"系统管理：",-1)),(x(!0),T(D,null,L(c.value.system,e=>(x(),C(X,{key:e,size:"small",style:{margin:"2px"}},{default:U(()=>[I(R(A("system",e)),1)]),_:2},1024))),128))])):P("",!0)])])])])):P("",!0)])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-9767c990"]]),Te={key:0,class:"user-detail"},De={class:"basic-info"},Le={class:"user-avatar"},Re={class:"user-status"},ze={class:"permissions-detail"},Ae={class:"permission-section"},$e={class:"permission-group"},Be={class:"permission-list"},je={class:"permission-group"},Oe={class:"permission-list"},Ee={class:"permission-group"},Me={class:"permission-list"},qe={class:"permission-section"},Fe={class:"operation-logs"},Ye={class:"logs-filter"},Ne={class:"pagination"},He={class:"security-settings"},Je={class:"security-actions",style:{"margin-top":"20px"}},Ze={class:"dialog-footer"},Ge=e(b({__name:"UserDetailDialog",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","edit"],setup(e,{emit:t}){const u=e,o=t,r=l(),n=h("basic"),i=h(75),p=w({get:()=>u.modelValue,set:e=>o("update:modelValue",e)}),v=h({customer:[{key:"view",name:"查看客户",granted:!0},{key:"create",name:"创建客户",granted:!0},{key:"edit",name:"编辑客户",granted:!1},{key:"delete",name:"删除客户",granted:!1},{key:"export",name:"导出客户",granted:!0}],order:[{key:"view",name:"查看订单",granted:!0},{key:"create",name:"创建订单",granted:!0},{key:"edit",name:"编辑订单",granted:!0},{key:"delete",name:"删除订单",granted:!1},{key:"audit",name:"审核订单",granted:!1}],system:[{key:"user",name:"用户管理",granted:!1},{key:"role",name:"角色管理",granted:!1},{key:"permission",name:"权限管理",granted:!1},{key:"config",name:"系统配置",granted:!1}]}),f=h({scope:"本部门数据",customer:"可查看、编辑",order:"可查看、创建",report:"仅查看",canExport:!0,canAudit:!1}),g=h({type:"",dateRange:null}),_=h([{time:"2024-01-15 14:30:25",type:"登录",action:"用户登录系统",ip:"192.168.1.100",userAgent:"Chrome 120.0.0.0",result:"成功"},{time:"2024-01-15 14:25:10",type:"数据操作",action:"查看客户列表",ip:"192.168.1.100",userAgent:"Chrome 120.0.0.0",result:"成功"},{time:"2024-01-15 14:20:05",type:"权限变更",action:"权限被管理员修改",ip:"192.168.1.1",userAgent:"Chrome 120.0.0.0",result:"成功"}]),y=h({currentPage:1,pageSize:10,total:50}),b=()=>{s.info("搜索操作记录")},$=()=>{g.value={type:"",dateRange:null}},B=e=>{y.value.pageSize=e},j=e=>{y.value.currentPage=e},E=async()=>{try{await d.confirm("确定要重置该用户的密码吗？","确认重置",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),s.success("密码重置成功，新密码已发送到用户邮箱")}catch(e){}},M=async()=>{const e=u.user?.twoFactorEnabled?"禁用":"启用";try{await d.confirm(`确定要${e}双因子认证吗？`,`确认${e}`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),s.success(`双因子认证${e}成功`)}catch(l){}},q=async()=>{try{await d.confirm("确定要解锁该用户账户吗？","确认解锁",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),s.success("账户解锁成功")}catch(e){}},F=async()=>{try{await d.confirm("确定要强制该用户下线吗？","确认下线",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),s.success("用户已强制下线")}catch(e){}},Y=()=>{u.user&&(o("edit",u.user),H())},N=()=>{s.success("用户信息导出成功")},H=()=>{n.value="basic",o("update:modelValue",!1)};return V(()=>u.user,e=>{},{immediate:!0}),(l,t)=>{const u=k("el-avatar"),s=k("el-tag"),o=k("el-col"),d=k("el-descriptions-item"),h=k("el-descriptions"),w=k("el-row"),V=k("el-tab-pane"),J=k("el-icon"),Z=k("el-option"),G=k("el-select"),K=k("el-date-picker"),Q=k("el-button"),W=k("el-table-column"),X=k("el-table"),ee=k("el-pagination"),le=k("el-progress"),ae=k("el-tabs"),te=k("el-dialog");return x(),C(te,{modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=e=>p.value=e),title:`用户详情 - ${e.user?.name}`,width:"1000px",onClose:H},{footer:U(()=>[z("div",Ze,[S(Q,{onClick:H},{default:U(()=>[...t[16]||(t[16]=[I("关闭",-1)])]),_:1}),S(Q,{onClick:Y,type:"primary"},{default:U(()=>[...t[17]||(t[17]=[I("编辑用户",-1)])]),_:1}),S(Q,{onClick:N,type:"success"},{default:U(()=>[...t[18]||(t[18]=[I("导出信息",-1)])]),_:1})])]),default:U(()=>[e.user?(x(),T("div",Te,[S(ae,{modelValue:n.value,"onUpdate:modelValue":t[4]||(t[4]=e=>n.value=e),type:"border-card"},{default:U(()=>[S(V,{label:"基本信息",name:"basic"},{default:U(()=>[z("div",De,[S(w,{gutter:20},{default:U(()=>[S(o,{span:8},{default:U(()=>[z("div",Le,[S(u,{size:120,src:e.user.avatar},{default:U(()=>[I(R(e.user.name.charAt(0)),1)]),_:1},8,["src"]),z("div",Re,[S(s,{type:"正常"===e.user.status?"success":"danger"},{default:U(()=>[I(R(e.user.status),1)]),_:1},8,["type"])])])]),_:1}),S(o,{span:16},{default:U(()=>[S(h,{column:2,border:""},{default:U(()=>[S(d,{label:"用户名"},{default:U(()=>[I(R(e.user.username),1)]),_:1}),S(d,{label:"姓名"},{default:U(()=>[I(R(e.user.name),1)]),_:1}),S(d,{label:"邮箱"},{default:U(()=>[I(R(A(O)(e.user.email,A(a).EMAIL,A(r).currentUser?.id)),1)]),_:1}),S(d,{label:"手机号"},{default:U(()=>[I(R(e.user.phone?A(O)(e.user.phone,A(a).PHONE,A(r).currentUser?.id):"未设置"),1)]),_:1}),S(d,{label:"部门"},{default:U(()=>[I(R(e.user.department),1)]),_:1}),S(d,{label:"职位"},{default:U(()=>[I(R(e.user.position||"未设置"),1)]),_:1}),S(d,{label:"角色"},{default:U(()=>[(x(!0),T(D,null,L(e.user.roles,e=>(x(),C(s,{key:e,size:"small",style:{"margin-right":"5px"}},{default:U(()=>[I(R(e),1)]),_:2},1024))),128))]),_:1}),S(d,{label:"权限级别"},{default:U(()=>{return[S(s,{type:(l=e.user.permissionLevel,{"超级管理员":"danger","管理员":"warning","普通用户":"primary","只读用户":"info"}[l]||"info")},{default:U(()=>[I(R(e.user.permissionLevel),1)]),_:1},8,["type"])];var l}),_:1}),S(d,{label:"创建时间"},{default:U(()=>[I(R(e.user.createTime),1)]),_:1}),S(d,{label:"最后登录"},{default:U(()=>[I(R(e.user.lastLogin||"从未登录"),1)]),_:1}),S(d,{label:"登录次数"},{default:U(()=>[I(R(e.user.loginCount||0),1)]),_:1}),S(d,{label:"账户状态"},{default:U(()=>[S(s,{type:"正常"===e.user.status?"success":"danger"},{default:U(()=>[I(R(e.user.status),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),S(V,{label:"权限详情",name:"permissions"},{default:U(()=>[z("div",ze,[z("div",Ae,[t[9]||(t[9]=z("h4",null,"功能权限",-1)),S(w,{gutter:20},{default:U(()=>[S(o,{span:8},{default:U(()=>[z("div",$e,[t[6]||(t[6]=z("h5",null,"客户管理",-1)),z("div",Be,[(x(!0),T(D,null,L(v.value.customer,e=>(x(),T("div",{key:e.key,class:"permission-item"},[S(J,{color:e.granted?"#67C23A":"#F56C6C"},{default:U(()=>[e.granted?(x(),C(A(m),{key:0})):(x(),C(A(c),{key:1}))]),_:2},1032,["color"]),z("span",null,R(e.name),1)]))),128))])])]),_:1}),S(o,{span:8},{default:U(()=>[z("div",je,[t[7]||(t[7]=z("h5",null,"订单管理",-1)),z("div",Oe,[(x(!0),T(D,null,L(v.value.order,e=>(x(),T("div",{key:e.key,class:"permission-item"},[S(J,{color:e.granted?"#67C23A":"#F56C6C"},{default:U(()=>[e.granted?(x(),C(A(m),{key:0})):(x(),C(A(c),{key:1}))]),_:2},1032,["color"]),z("span",null,R(e.name),1)]))),128))])])]),_:1}),S(o,{span:8},{default:U(()=>[z("div",Ee,[t[8]||(t[8]=z("h5",null,"系统管理",-1)),z("div",Me,[(x(!0),T(D,null,L(v.value.system,e=>(x(),T("div",{key:e.key,class:"permission-item"},[S(J,{color:e.granted?"#67C23A":"#F56C6C"},{default:U(()=>[e.granted?(x(),C(A(m),{key:0})):(x(),C(A(c),{key:1}))]),_:2},1032,["color"]),z("span",null,R(e.name),1)]))),128))])])]),_:1})]),_:1})]),z("div",qe,[t[10]||(t[10]=z("h4",null,"数据权限",-1)),S(h,{column:3,border:""},{default:U(()=>[S(d,{label:"数据范围"},{default:U(()=>[I(R(f.value.scope),1)]),_:1}),S(d,{label:"客户数据"},{default:U(()=>[I(R(f.value.customer),1)]),_:1}),S(d,{label:"订单数据"},{default:U(()=>[I(R(f.value.order),1)]),_:1}),S(d,{label:"报表数据"},{default:U(()=>[I(R(f.value.report),1)]),_:1}),S(d,{label:"导出权限"},{default:U(()=>[S(s,{type:f.value.canExport?"success":"danger"},{default:U(()=>[I(R(f.value.canExport?"允许":"禁止"),1)]),_:1},8,["type"])]),_:1}),S(d,{label:"审计权限"},{default:U(()=>[S(s,{type:f.value.canAudit?"success":"danger"},{default:U(()=>[I(R(f.value.canAudit?"允许":"禁止"),1)]),_:1},8,["type"])]),_:1})]),_:1})])])]),_:1}),S(V,{label:"操作记录",name:"logs"},{default:U(()=>[z("div",Fe,[z("div",Ye,[S(w,{gutter:20},{default:U(()=>[S(o,{span:6},{default:U(()=>[S(G,{modelValue:g.value.type,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value.type=e),placeholder:"操作类型",clearable:""},{default:U(()=>[S(Z,{label:"登录",value:"login"}),S(Z,{label:"权限变更",value:"permission"}),S(Z,{label:"数据操作",value:"data"}),S(Z,{label:"系统操作",value:"system"})]),_:1},8,["modelValue"])]),_:1}),S(o,{span:8},{default:U(()=>[S(K,{modelValue:g.value.dateRange,"onUpdate:modelValue":t[1]||(t[1]=e=>g.value.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),S(o,{span:6},{default:U(()=>[S(Q,{onClick:b,type:"primary"},{default:U(()=>[...t[11]||(t[11]=[I("搜索",-1)])]),_:1}),S(Q,{onClick:$},{default:U(()=>[...t[12]||(t[12]=[I("重置",-1)])]),_:1})]),_:1})]),_:1})]),S(X,{data:_.value,style:{width:"100%","margin-top":"20px"}},{default:U(()=>[S(W,{prop:"time",label:"操作时间",width:"180"}),S(W,{prop:"type",label:"操作类型",width:"120"},{default:U(({row:e})=>{return[S(s,{type:(l=e.type,{"登录":"primary","权限变更":"warning","数据操作":"success","系统操作":"info"}[l]||"info")},{default:U(()=>[I(R(e.type),1)]),_:2},1032,["type"])];var l}),_:1}),S(W,{prop:"action",label:"操作内容"}),S(W,{prop:"ip",label:"IP地址",width:"140"}),S(W,{prop:"userAgent",label:"设备信息",width:"200","show-overflow-tooltip":""}),S(W,{prop:"result",label:"操作结果",width:"100"},{default:U(({row:e})=>[S(s,{type:"成功"===e.result?"success":"danger"},{default:U(()=>[I(R(e.result),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"]),z("div",Ne,[S(ee,{"current-page":y.value.currentPage,"onUpdate:currentPage":t[2]||(t[2]=e=>y.value.currentPage=e),"page-size":y.value.pageSize,"onUpdate:pageSize":t[3]||(t[3]=e=>y.value.pageSize=e),"page-sizes":[10,20,50,100],total:y.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:B,onCurrentChange:j},null,8,["current-page","page-size","total"])])])]),_:1}),S(V,{label:"安全设置",name:"security"},{default:U(()=>[z("div",He,[S(h,{column:2,border:""},{default:U(()=>[S(d,{label:"密码强度"},{default:U(()=>[S(le,{percentage:i.value,color:i.value>=80?"#67C23A":i.value>=60?"#E6A23C":"#F56C6C"},null,8,["percentage","color"])]),_:1}),S(d,{label:"双因子认证"},{default:U(()=>[S(s,{type:e.user.twoFactorEnabled?"success":"warning"},{default:U(()=>[I(R(e.user.twoFactorEnabled?"已启用":"未启用"),1)]),_:1},8,["type"])]),_:1}),S(d,{label:"密码最后修改"},{default:U(()=>[I(R(e.user.passwordLastChanged||"从未修改"),1)]),_:1}),S(d,{label:"登录失败次数"},{default:U(()=>[I(R(e.user.failedLoginAttempts||0),1)]),_:1}),S(d,{label:"账户锁定状态"},{default:U(()=>[S(s,{type:e.user.isLocked?"danger":"success"},{default:U(()=>[I(R(e.user.isLocked?"已锁定":"正常"),1)]),_:1},8,["type"])]),_:1}),S(d,{label:"会话超时设置"},{default:U(()=>[I(R(e.user.sessionTimeout||"30分钟"),1)]),_:1})]),_:1}),z("div",Je,[S(Q,{onClick:E,type:"warning"},{default:U(()=>[...t[13]||(t[13]=[I("重置密码",-1)])]),_:1}),S(Q,{onClick:M,type:e.user.twoFactorEnabled?"danger":"primary"},{default:U(()=>[I(R(e.user.twoFactorEnabled?"禁用":"启用")+"双因子认证 ",1)]),_:1},8,["type"]),e.user.isLocked?(x(),C(Q,{key:0,onClick:q,type:"success"},{default:U(()=>[...t[14]||(t[14]=[I("解锁账户",-1)])]),_:1})):P("",!0),S(Q,{onClick:F,type:"danger"},{default:U(()=>[...t[15]||(t[15]=[I("强制下线",-1)])]),_:1})])])]),_:1})]),_:1},8,["modelValue"])])):P("",!0)]),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-3a57ba92"]]),Ke={class:"import-content"},Qe={key:0,class:"step-content"},We={class:"upload-section"},Xe={key:0,class:"template-options"},el={key:1,class:"step-content"},ll={class:"preview-section"},al={class:"preview-summary"},tl={key:0,class:"validation-results"},ul={key:2,class:"step-content"},sl={class:"confirm-section"},ol={class:"import-summary"},rl={class:"selected-templates"},nl={class:"dialog-footer"},il={class:"permission-preview"},dl=e(b({__name:"RoleTemplateImportDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","imported"],setup(e,{emit:l}){const a=e,t=l,u=h(0),o=h(!1),r=h(),n=h(null),i=h(!1),m=h(null),c=w({get:()=>a.modelValue,set:e=>t("update:modelValue",e)}),v=h({mode:"merge",conflictResolution:"skip",validatePermissions:!0}),f=h([{id:"1",name:"销售经理模板",description:"销售经理角色权限模板",permissionCount:18,status:"valid",permissions:{customer:["查看客户","创建客户","编辑客户","分配客户","导出客户"],order:["查看订单","创建订单","编辑订单","审核订单","导出订单"],product:["查看商品","编辑商品"],report:["查看报表","导出报表","自定义报表"]},dataPermissions:{customer:{level:"department",scopes:["所属部门及下级部门"]},order:{level:"department",scopes:["所属部门及下级部门"]}},systemPermissions:{config:["基础配置"],security:["密码策略"]}},{id:"2",name:"客服专员模板",description:"客服专员角色权限模板",permissionCount:12,status:"conflict",permissions:{customer:["查看客户","编辑客户"],order:["查看订单"],service:["查看服务","创建服务","编辑服务","处理服务"],logistics:["查看物流","跟踪物流"]},dataPermissions:{customer:{level:"personal",scopes:["本人负责"]},service:{level:"department",scopes:["所属部门"]}},systemPermissions:{config:[],security:[]}},{id:"3",name:"仓库管理员模板",description:"仓库管理员角色权限模板",permissionCount:10,status:"valid",permissions:{product:["查看商品","编辑商品","库存管理"],order:["查看订单","处理订单"],logistics:["查看物流","更新物流","物流管理"]},dataPermissions:{product:{level:"category",scopes:["负责分类"]},logistics:{level:"region",scopes:["负责区域"]}},systemPermissions:{config:["库存配置"],security:[]}}]),g=h([{id:"1",message:'模板"客服专员模板"与现有模板名称冲突'},{id:"2",message:'权限配置"删除客户"超出当前用户权限范围'},{id:"3",message:'数据权限级别"全部"需要超级管理员权限'},{id:"4",message:'系统权限"数据备份"仅限系统管理员使用'}]),_=h([]),y=w(()=>0===u.value?null!==n.value:1!==u.value||_.value.length>0),b=w(()=>"merge"===v.value.mode?"合并模式":"替换模式"),V=w(()=>({skip:"跳过冲突项",rename:"自动重命名",overwrite:"覆盖现有项"}[v.value.conflictResolution])),$=e=>{n.value=e.raw,setTimeout(()=>{s.success("文件解析成功")},1e3)},B=e=>{const l=["application/json","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(e.type),a=e.size/1024/1024<10;return l?(a||s.error("文件大小不能超过 10MB!"),!1):(s.error("只支持 JSON、Excel、CSV 格式文件!"),!1)},j=e=>({valid:"有效",conflict:"冲突",error:"错误"}[e]||"未知"),O=e=>({customer:"客户管理",order:"订单管理",report:"报表管理",service:"客服管理"}[e]||e),E=()=>{0===u.value&&(_.value=f.value.filter(e=>"valid"===e.status)),u.value<2&&u.value++},M=()=>{u.value>0&&u.value--},q=async()=>{try{await d.confirm(`确定要导入 ${_.value.length} 个角色模板吗？`,"确认导入",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),o.value=!0,await new Promise(e=>setTimeout(e,2e3)),s.success("角色模板导入成功"),t("imported",_.value),F()}catch(e){"cancel"!==e&&s.error("导入失败")}finally{o.value=!1}},F=()=>{u.value=0,n.value=null,_.value=[],i.value=!1,m.value=null,t("update:modelValue",!1)};return(e,l)=>{const a=k("el-step"),t=k("el-steps"),s=k("el-icon"),d=k("el-upload"),h=k("el-radio"),w=k("el-radio-group"),Y=k("el-form-item"),N=k("el-option"),H=k("el-select"),J=k("el-switch"),Z=k("el-form"),G=k("el-alert"),K=k("el-table-column"),Q=k("el-tag"),W=k("el-button"),X=k("el-table"),ee=k("el-result"),le=k("el-descriptions-item"),ae=k("el-descriptions"),te=k("el-dialog");return x(),C(te,{modelValue:c.value,"onUpdate:modelValue":l[4]||(l[4]=e=>c.value=e),title:"导入角色模板",width:"700px",onClose:F},{footer:U(()=>[z("div",nl,[S(W,{onClick:F},{default:U(()=>[...l[14]||(l[14]=[I("取消",-1)])]),_:1}),u.value>0?(x(),C(W,{key:0,onClick:M},{default:U(()=>[...l[15]||(l[15]=[I("上一步",-1)])]),_:1})):P("",!0),u.value<2?(x(),C(W,{key:1,onClick:E,type:"primary",disabled:!y.value},{default:U(()=>[...l[16]||(l[16]=[I(" 下一步 ",-1)])]),_:1},8,["disabled"])):P("",!0),2===u.value?(x(),C(W,{key:2,onClick:q,type:"primary",loading:o.value},{default:U(()=>[...l[17]||(l[17]=[I(" 确认导入 ",-1)])]),_:1},8,["loading"])):P("",!0)])]),default:U(()=>[z("div",Ke,[S(t,{active:u.value,"finish-status":"success","align-center":""},{default:U(()=>[S(a,{title:"选择文件"}),S(a,{title:"预览数据"}),S(a,{title:"确认导入"})]),_:1},8,["active"]),0===u.value?(x(),T("div",Qe,[z("div",We,[S(d,{ref_key:"uploadRef",ref:r,class:"upload-demo",drag:"","auto-upload":!1,"on-change":$,"before-upload":B,accept:".json,.xlsx,.csv",limit:1},{tip:U(()=>[...l[5]||(l[5]=[z("div",{class:"el-upload__tip"}," 支持 JSON、Excel、CSV 格式文件，文件大小不超过 10MB ",-1)])]),default:U(()=>[S(s,{class:"el-icon--upload"},{default:U(()=>[S(A(p))]),_:1}),l[6]||(l[6]=z("div",{class:"el-upload__text"},[I(" 将文件拖到此处，或"),z("em",null,"点击上传")],-1))]),_:1},512),n.value?(x(),T("div",Xe,[l[10]||(l[10]=z("h4",null,"导入选项",-1)),S(Z,{model:v.value,"label-width":"120px"},{default:U(()=>[S(Y,{label:"导入模式"},{default:U(()=>[S(w,{modelValue:v.value.mode,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value.mode=e)},{default:U(()=>[S(h,{label:"merge"},{default:U(()=>[...l[7]||(l[7]=[I("合并模式（保留现有模板）",-1)])]),_:1}),S(h,{label:"replace"},{default:U(()=>[...l[8]||(l[8]=[I("替换模式（覆盖同名模板）",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),S(Y,{label:"冲突处理"},{default:U(()=>[S(H,{modelValue:v.value.conflictResolution,"onUpdate:modelValue":l[1]||(l[1]=e=>v.value.conflictResolution=e),placeholder:"选择冲突处理方式"},{default:U(()=>[S(N,{label:"跳过冲突项",value:"skip"}),S(N,{label:"自动重命名",value:"rename"}),S(N,{label:"覆盖现有项",value:"overwrite"})]),_:1},8,["modelValue"])]),_:1}),S(Y,{label:"验证权限"},{default:U(()=>[S(J,{modelValue:v.value.validatePermissions,"onUpdate:modelValue":l[2]||(l[2]=e=>v.value.validatePermissions=e)},null,8,["modelValue"]),l[9]||(l[9]=z("span",{class:"form-tip"},"验证导入的权限是否在系统中存在",-1))]),_:1})]),_:1},8,["model"])])):P("",!0)])])):P("",!0),1===u.value?(x(),T("div",el,[z("div",ll,[z("div",al,[S(G,{title:`共解析到 ${f.value.length} 个角色模板`,type:"info",closable:!1,style:{"margin-bottom":"20px"}},null,8,["title"])]),S(X,{data:f.value,style:{width:"100%"},"max-height":"400"},{default:U(()=>[S(K,{type:"selection",width:"55"}),S(K,{prop:"name",label:"模板名称",width:"150"}),S(K,{prop:"description",label:"描述"}),S(K,{prop:"permissionCount",label:"权限数量",width:"100"}),S(K,{label:"状态",width:"120"},{default:U(({row:e})=>{return[S(Q,{type:(l=e.status,{valid:"success",conflict:"warning",error:"danger"}[l]||"info")},{default:U(()=>[I(R(j(e.status)),1)]),_:2},1032,["type"])];var l}),_:1}),S(K,{label:"操作",width:"100"},{default:U(({row:e})=>[S(W,{onClick:l=>{return a=e,m.value=a,void(i.value=!0);var a},size:"small",type:"primary",link:""},{default:U(()=>[...l[11]||(l[11]=[I(" 查看权限 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),g.value.length>0?(x(),T("div",tl,[l[12]||(l[12]=z("h4",null,"验证结果",-1)),(x(!0),T(D,null,L(g.value,e=>(x(),C(G,{key:e.id,title:e.message,type:"warning",closable:!1,style:{"margin-bottom":"10px"}},null,8,["title"]))),128))])):P("",!0)])])):P("",!0),2===u.value?(x(),T("div",ul,[z("div",sl,[S(ee,{icon:"success",title:"准备导入","sub-title":`将导入 ${_.value.length} 个角色模板`},null,8,["sub-title"]),z("div",ol,[S(ae,{column:2,border:""},{default:U(()=>[S(le,{label:"导入模式"},{default:U(()=>[I(R(b.value),1)]),_:1}),S(le,{label:"冲突处理"},{default:U(()=>[I(R(V.value),1)]),_:1}),S(le,{label:"模板数量"},{default:U(()=>[I(R(_.value.length),1)]),_:1}),S(le,{label:"权限验证"},{default:U(()=>[I(R(v.value.validatePermissions?"已启用":"已禁用"),1)]),_:1})]),_:1})]),z("div",rl,[l[13]||(l[13]=z("h4",null,"将要导入的模板：",-1)),(x(!0),T(D,null,L(_.value,e=>(x(),C(Q,{key:e.id,style:{margin:"5px"},type:"primary"},{default:U(()=>[I(R(e.name),1)]),_:2},1024))),128))])])])):P("",!0)]),S(te,{modelValue:i.value,"onUpdate:modelValue":l[3]||(l[3]=e=>i.value=e),title:`权限预览 - ${m.value?.name}`,width:"500px"},{default:U(()=>[z("div",il,[(x(!0),T(D,null,L(m.value?.permissions,(e,l)=>(x(),T("div",{key:l},[z("h5",null,R(O(l)),1),(x(!0),T(D,null,L(e,e=>(x(),C(Q,{key:e,size:"small",style:{margin:"2px"}},{default:U(()=>[I(R(e),1)]),_:2},1024))),128))]))),128))])]),_:1},8,["modelValue","title"])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-7f369f9c"]]),ml={class:"super-admin-panel"},cl={class:"header"},pl={class:"header-title"},vl={class:"header-stats"},fl={class:"header-actions"},gl={class:"tab-content"},_l={class:"filters"},yl={class:"pagination"},bl={class:"tab-content"},hl={class:"template-actions"},wl={class:"card-header"},Vl={class:"template-info"},kl={class:"template-actions-bottom"},Cl={class:"tab-content"},xl={class:"department-actions"},Ul={class:"tab-content"},Sl={class:"audit-filters"},Pl={class:"pagination"},Il={class:"tab-content"},Tl={class:"config-actions"},Dl=e(b({__name:"SuperAdminPermissionPanel",setup(e){const l=h("users"),a=h({users:!1,departments:!1,audit:!1}),o=h({userPermission:!1,roleTemplate:!1,department:!1,departmentMembers:!1,departmentPermissions:!1,batchAssignPermissions:!1,userDetail:!1,roleTemplateImport:!1,roleTemplatePreview:!1}),n=h(null),m=h(null),c=h(null),p=h([]),b=h(""),V=h(""),P=h(""),O=h([]),F=h(null),N=h(""),H=h(""),J=h({startDate:"",endDate:"",user:"",action:"",resource:"",result:""}),G=h({currentPage:1,pageSize:20,total:0}),Q=h([]),W=h([]),X=h({currentPage:1,pageSize:20,total:0}),le=h({defaultPermissionLevel:"read_only",enforcePasswordPolicy:!0,requireTwoFactor:!1,sessionTimeout:120,enableAuditLog:!0,auditLogRetentionDays:90,notifySensitiveOperations:!0,autoBackupConfig:!0}),ae=h({total:0,activeRoles:0,todayChanges:0}),te=w(()=>p.value.filter(e=>{const l=!b.value||e.name.includes(b.value)||e.email.includes(b.value),a=!V.value||e.role===V.value,t=!P.value||e.departmentId===P.value;return l&&a&&t})),ue=async()=>{await Promise.all([se(),oe(),re(),ne()]),ie()},se=async()=>{try{a.value.users=!0;const e=await E.getUsers({page:G.value.currentPage,pageSize:G.value.pageSize,departmentId:We.value.department||void 0,role:We.value.role||void 0,status:We.value.status||void 0});p.value=e.data.map(e=>({id:e.id.toString(),name:e.realName,email:e.email,department:e.department?.name||"未分配",departmentId:e.department?.id||"",role:e.role,dataScope:Ke(e.role),permissionLevel:Qe(e.role),status:"active"===e.status?"active":"inactive",lastLogin:e.lastLoginAt||"从未登录",createdAt:e.createdAt||(new Date).toISOString(),permissions:e.permissions||[]})),G.value.total=e.total}catch(e){console.error("加载用户数据失败:",e),s.error("加载用户数据失败"),p.value=[]}finally{a.value.users=!1}},oe=async()=>{try{a.value.roles=!0;const l=await M.getRoles();Q.value=l.map(e=>({id:e.id,name:e.name,description:e.description||"暂无描述",permissions:e.permissions||[],userCount:0,createdAt:e.createdAt,color:e.color||"primary"}));for(const a of Q.value)try{const e=(await E.getUserStatistics()).byRole;a.userCount=e[a.name.toLowerCase()]||0}catch(e){console.warn(`获取角色 ${a.name} 使用人数失败:`,e),a.userCount=0}}catch(e){console.error("加载角色模板数据失败:",e),s.error("加载角色模板数据失败"),Q.value=[]}finally{a.value.roles=!1}},re=async()=>{try{a.value.departments=!0;const e=(await t(()=>import("./department-DPqzaatc.js"),__vite__mapDeps([0,1,2,3,4,5]))).default.getAllDepartments();W.value=e.map(e=>{const l=q.getDepartmentPermissions(e.id);return{id:e.id,name:e.name,manager:e.managerName||`负责人${e.managerId}`,memberCount:e.memberCount||0,permissionLevel:ve(l.dataScope),dataScope:me(l.dataScope),description:`${e.name}的权限配置`}})}catch(e){console.error("加载部门数据失败:",e),s.error("加载部门数据失败"),W.value=[]}finally{a.value.departments=!1}},ne=async()=>{try{a.value.audit=!0;const e=await u.getOperationLogs({page:X.value.currentPage,pageSize:X.value.pageSize,startDate:J.value.startDate,endDate:J.value.endDate,userId:J.value.user,action:J.value.action});O.value=e.data.map(e=>({id:e.id,timestamp:e.createdAt,user:e.username,operator:e.username,action:e.action,target:e.targetUser||e.module,resource:e.module,details:e.description,description:e.description,ip:e.ip,ipAddress:e.ip,result:"success",status:"success"})),X.value.total=e.total}catch(e){console.error("加载审计日志数据失败:",e),s.error("加载审计日志数据失败"),O.value=[]}finally{a.value.audit=!1}},ie=()=>{ae.value={total:p.value.length,activeRoles:new Set(p.value.map(e=>e.role)).size,todayChanges:Math.floor(10*Math.random())+1}},de=e=>({super_admin:"超级管理员",department_manager:"部门负责人",sales_staff:"销售员",customer_service:"客服"}[e]||"未知"),me=e=>({all:"全部数据",department:"部门数据",personal:"个人数据"}[e]||"未知"),pe=e=>({all:"danger",department:"warning",personal:"info"}[e]||""),ve=e=>({full_access:"完全权限",partial_access:"部分权限",read_only:"只读权限"}[e]||"未知"),fe=e=>({assign:"权限分配",revoke:"权限撤销",role_change:"角色变更",user_create:"用户创建",user_delete:"用户删除"}[e]||"未知操作"),ge=e=>new Date(e).toLocaleDateString(),_e=async()=>{await ue(),s.success("数据刷新成功")},ye=()=>{try{const e={exportInfo:{exportTime:(new Date).toISOString(),exportBy:"超级管理员",version:"1.0",description:"系统权限配置完整导出"},users:p.value.map(e=>({id:e.id,username:e.username,name:e.name,email:e.email,role:e.role,department:e.department,status:e.status,permissions:e.permissions||[],createTime:e.createTime,lastLogin:e.lastLogin})),departments:W.value.map(e=>({id:e.id,name:e.name,description:e.description,parentId:e.parentId,permissions:e.permissions||[],members:e.members||[],createTime:e.createTime})),roleTemplates:Q.value.map(e=>({id:e.id,name:e.name,description:e.description,permissions:e.permissions||[],applicableRoles:e.applicableRoles||[],createTime:e.createTime,usageCount:e.usageCount||0})),systemPermissions:{functionalPermissions:[{module:"customer",permissions:["查看","创建","编辑","删除","导出","分配"]},{module:"order",permissions:["查看","创建","编辑","取消","审核","导出"]},{module:"product",permissions:["查看","创建","编辑","删除","上架","下架"]},{module:"report",permissions:["查看","导出","自定义","分享"]},{module:"system",permissions:["用户管理","权限管理","系统配置","日志查看"]}],dataPermissions:[{resource:"customer",scopes:["全部","部门","个人"]},{resource:"order",scopes:["全部","部门","个人"]},{resource:"product",scopes:["全部","分类"]},{resource:"report",scopes:["全部","部门","个人"]}]},auditLogs:O.value.slice(0,100).map(e=>({id:e.id,user:e.user,action:e.action,resource:e.resource,details:e.details,timestamp:e.timestamp,ip:e.ip,result:e.result}))},l=new Blob([JSON.stringify(e,null,2)],{type:"application/json;charset=utf-8"}),a=URL.createObjectURL(l),t=document.createElement("a");t.href=a,t.download=`permission-config-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a),s.success("权限配置导出成功");const u={id:Date.now().toString(),user:"超级管理员",action:"导出权限配置",resource:"系统配置",details:`导出了包含 ${p.value.length} 个用户、${W.value.length} 个部门、${Q.value.length} 个角色模板的完整权限配置`,timestamp:(new Date).toISOString(),ip:"127.0.0.1",result:"成功"};O.value.unshift(u)}catch(e){console.error("导出权限配置失败:",e),s.error("导出权限配置失败，请重试")}},be=async()=>{G.value.currentPage=1,await se()},he=()=>{n.value=null,o.value.userPermission=!0},we=()=>{s.info("批量导入功能开发中...")},Ve=async e=>{try{n.value?.id?(await E.updateUser(parseInt(n.value.id),{realName:e.name,email:e.email,role:e.role,departmentId:e.departmentId?parseInt(e.departmentId):void 0,permissions:e.permissions}),s.success("用户信息更新成功")):(await E.createUser({username:e.email.split("@")[0],email:e.email,realName:e.name,role:e.role,departmentId:e.departmentId?parseInt(e.departmentId):void 0,permissions:e.permissions,password:"123456"}),s.success("用户创建成功")),o.value.userPermission=!1,await se()}catch(l){console.error("保存用户信息失败:",l),s.error("保存用户信息失败")}},ke=e=>{G.value.pageSize=e,G.value.currentPage=1,se()},Ce=e=>{G.value.currentPage=e,se()},xe=()=>{m.value=null,o.value.roleTemplate=!0},Ue=()=>{o.value.roleTemplateImport=!0},Se=async()=>{try{const e=await M.getAllRoles(),l={exportTime:(new Date).toISOString(),roleTemplates:e.map(e=>({name:e.name,description:e.description,permissions:e.permissions,userCount:e.userCount||0,createdAt:e.createdAt}))},a=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),u=document.createElement("a");u.href=t,u.download=`role_templates_${(new Date).toISOString().split("T")[0]}.json`,u.click(),URL.revokeObjectURL(t),s.success("角色模板导出成功")}catch(e){console.error("导出角色模板失败:",e),s.error("导出角色模板失败")}},Pe=async e=>{const{action:l,template:a}=e;switch(l){case"edit":m.value=a,o.value.roleTemplate=!0;break;case"copy":try{const e={...a,name:`${a.name}_副本`,id:void 0};await M.createRole(e),s.success(`模板 ${a.name} 复制成功`),await oe()}catch(t){console.error("复制模板失败:",t),s.error("复制模板失败")}break;case"delete":try{await d.confirm(`确定要删除模板 ${a.name} 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await M.deleteRole(a.id),s.success("删除成功"),await oe()}catch(t){"cancel"!==t?(console.error("删除模板失败:",t),s.error("删除模板失败")):s.info("已取消删除")}}},Te=async e=>{try{m.value?.id?(await M.updateRole(m.value.id,e),s.success("角色模板更新成功")):(await M.createRole(e),s.success("角色模板创建成功")),o.value.roleTemplate=!1,await oe()}catch(l){console.error("保存角色模板失败:",l),s.error("保存角色模板失败")}},De=()=>{c.value=null,o.value.department=!0},Le=()=>{o.value.batchAssignPermissions=!0},Re=async()=>{try{s.info("正在同步部门数据...");const e=await t(()=>import("./department-DPqzaatc.js"),__vite__mapDeps([0,1,2,3,4,5]));await e.default.syncDepartments(),s.success("部门数据同步成功"),await re()}catch(e){console.error("部门数据同步失败:",e),s.error("部门数据同步失败")}},ze=async e=>{o.value.department=!1;try{e.permissions&&await q.setDepartmentPermissions(e.id,{permissions:e.permissions,inheritFromParent:e.inheritFromParent||!1,dataScope:e.dataScope||"department"}),await re(),s.success("部门信息保存成功")}catch(l){console.error("保存部门权限失败:",l),s.error("保存部门权限失败")}},Ae=async()=>{o.value.departmentMembers=!1;try{await re(),s.success("部门成员更新成功")}catch(e){console.error("更新部门成员失败:",e),s.error("更新部门成员失败")}},$e=async e=>{try{await q.setDepartmentPermissions(e.id,{permissions:e.permissions,inheritFromParent:e.inheritFromParent,dataScope:e.dataScope,managerExtraPermissions:e.managerExtraPermissions});const l=W.value.findIndex(l=>l.id===e.id);l>-1&&(W.value[l]={...W.value[l],permissionLevel:ve(e.dataScope),dataScope:me(e.dataScope)}),s.success("部门权限更新成功")}catch(l){console.error("更新部门权限失败:",l),s.error("更新部门权限失败")}},Be=async()=>{o.value.batchAssignPermissions=!1;try{await re(),s.success("批量权限分配成功")}catch(e){console.error("批量权限分配失败:",e),s.error("批量权限分配失败")}},je=e=>{o.value.userDetail=!1,n.value=e,o.value.userPermission=!0},Oe=e=>{s.success(`成功导入 ${e.length} 个角色模板`),oe()},Ee=e=>{s.success(`角色模板 "${e.name}" 应用成功`)},Me=e=>{const l={template:e,exportTime:(new Date).toISOString(),version:"1.0"},a=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),u=document.createElement("a");u.href=t,u.download=`role-template-${e.name}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(t),s.success(`角色模板 "${e.name}" 导出成功`)},qe=async()=>{try{a.value.audit=!0;const e={exportInfo:{title:"权限审计日志导出",exportTime:(new Date).toISOString(),exportUser:"当前用户",totalRecords:O.value.length,dateRange:{start:J.value.startDate||"全部",end:J.value.endDate||"全部"},filters:{user:J.value.user||"全部用户",action:J.value.action||"全部操作",resource:J.value.resource||"全部资源",result:J.value.result||"全部结果"}},auditLogs:O.value.map(e=>({id:e.id,timestamp:e.timestamp,user:e.user,action:e.action,resource:e.resource,details:e.details,ip:e.ip,userAgent:e.userAgent||"Unknown",result:e.result,duration:e.duration||0,errorMessage:e.errorMessage||"",sessionId:e.sessionId||"",requestId:e.requestId||""})),summary:{totalActions:O.value.length,successfulActions:O.value.filter(e=>"success"===e.result).length,failedActions:O.value.filter(e=>"failure"===e.result).length,uniqueUsers:[...new Set(O.value.map(e=>e.user))].length,actionTypes:[...new Set(O.value.map(e=>e.action))],resourceTypes:[...new Set(O.value.map(e=>e.resource))],timeRange:{earliest:O.value.length>0?Math.min(...O.value.map(e=>new Date(e.timestamp).getTime())):null,latest:O.value.length>0?Math.max(...O.value.map(e=>new Date(e.timestamp).getTime())):null}},statistics:{actionsByType:O.value.reduce((e,l)=>(e[l.action]=(e[l.action]||0)+1,e),{}),actionsByUser:O.value.reduce((e,l)=>(e[l.user]=(e[l.user]||0)+1,e),{}),actionsByResource:O.value.reduce((e,l)=>(e[l.resource]=(e[l.resource]||0)+1,e),{}),actionsByResult:O.value.reduce((e,l)=>(e[l.result]=(e[l.result]||0)+1,e),{})}},l=new Blob([JSON.stringify(e,null,2)],{type:"application/json;charset=utf-8"}),t=URL.createObjectURL(l),u=document.createElement("a");u.href=t,u.download=`audit-logs-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(t);const o=["时间","用户","操作","资源","详情","IP地址","结果","持续时间(ms)","错误信息"],r=O.value.map(e=>[e.timestamp,e.user,e.action,e.resource,e.details.replace(/,/g,";"),e.ip,e.result,e.duration||0,(e.errorMessage||"").replace(/,/g,";")]),n=[o.join(","),...r.map(e=>e.join(","))].join("\n"),i=new Blob(["\ufeff"+n],{type:"text/csv;charset=utf-8"}),d=URL.createObjectURL(i),m=document.createElement("a");m.href=d,m.download=`audit-logs-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(d);const c={id:Date.now().toString(),timestamp:(new Date).toISOString(),user:"当前用户",action:"导出审计日志",resource:"审计日志",details:`导出了 ${O.value.length} 条审计日志记录`,ip:"127.0.0.1",result:"success",duration:1e3};O.value.unshift(c),s.success(`审计日志导出成功！已导出 ${O.value.length} 条记录`)}catch(e){console.error("导出审计日志失败:",e),s.error("导出审计日志失败，请重试")}finally{a.value.audit=!1}},Fe=()=>{J.value={startDate:F.value?.[0]?.toISOString().split("T")[0]||"",endDate:F.value?.[1]?.toISOString().split("T")[0]||"",user:H.value,action:N.value,resource:"",result:""},ne(),s.success("搜索完成")},Ye=e=>{X.value.pageSize=e,ne()},Ne=e=>{X.value.currentPage=e,ne()},He=async()=>{try{a.value.system=!0;const e=useConfigStore();await e.updateSystemConfig(le.value),await e.updateSecurityConfig(securityConfig.value),await e.updateProductConfig(productConfig.value),await e.updateThemeConfig(themeConfig.value),s.success("系统配置保存成功")}catch(e){console.error("保存系统配置失败:",e),s.error("保存系统配置失败")}finally{a.value.system=!1}},Je=async()=>{try{a.value.system=!0;const e=useConfigStore();await e.resetSystemConfig(),await e.resetSecurityConfig(),await e.resetProductConfig(),e.loadConfigFromStorage(),s.success("系统配置重置成功")}catch(e){console.error("重置系统配置失败:",e),s.error("重置系统配置失败")}finally{a.value.system=!1}},Ze=async()=>{try{a.value.system=!0;const e=useConfigStore(),l={exportInfo:{title:"系统配置导出",exportTime:(new Date).toISOString().split("T")[0],exportUser:"当前用户",version:"1.0"},systemConfig:e.systemConfig,securityConfig:e.securityConfig,productConfig:e.productConfig,themeConfig:e.themeConfig,smsConfig:e.smsConfig,storageConfig:e.storageConfig},t=new Blob([JSON.stringify(l,null,2)],{type:"application/json;charset=utf-8"}),u=URL.createObjectURL(t),o=document.createElement("a");o.href=u,o.download=`system-config-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(u),s.success("系统配置导出成功")}catch(e){console.error("导出系统配置失败:",e),s.error("导出系统配置失败")}finally{a.value.system=!1}},Ke=e=>({super_admin:"all",department_manager:"department",sales_staff:"personal",customer_service:"personal"}[e]||"personal"),Qe=e=>({super_admin:"full_access",department_manager:"partial_access",sales_staff:"partial_access",customer_service:"read_only"}[e]||"read_only"),We=h({department:"",role:"",status:""});return j(()=>{ue()}),(e,t)=>{const u=k("el-statistic"),p=k("el-button"),h=k("el-icon"),w=k("el-input"),j=k("el-option"),M=k("el-select"),q=k("el-table-column"),J=k("el-tag"),ue=k("el-switch"),se=k("el-table"),oe=k("el-pagination"),re=k("el-tab-pane"),ne=k("el-dropdown-item"),ie=k("el-dropdown-menu"),Ke=k("el-dropdown"),Qe=k("el-card"),We=k("el-col"),Xe=k("el-row"),el=k("el-date-picker"),ll=k("el-form-item"),al=k("el-input-number"),tl=k("el-form"),ul=k("el-tabs"),sl=k("el-alert"),ol=k("RoleTemplatePreviewDialog"),rl=$("loading");return x(),T("div",ml,[z("div",cl,[z("div",pl,[t[28]||(t[28]=z("h1",{class:"page-title"},"超级管理员权限配置面板",-1)),z("div",vl,[S(u,{title:"管理用户总数",value:ae.value.total},null,8,["value"]),S(u,{title:"活跃角色数",value:ae.value.activeRoles},null,8,["value"]),S(u,{title:"今日权限变更",value:ae.value.todayChanges},null,8,["value"])])]),z("div",fl,[S(p,{onClick:_e,type:"primary"},{default:U(()=>[...t[29]||(t[29]=[I("刷新数据",-1)])]),_:1}),S(p,{onClick:ye,type:"success"},{default:U(()=>[...t[30]||(t[30]=[I("导出权限配置",-1)])]),_:1})])]),S(ul,{modelValue:l.value,"onUpdate:modelValue":t[18]||(t[18]=e=>l.value=e),type:"card",class:"admin-tabs"},{default:U(()=>[S(re,{label:"用户权限管理",name:"users"},{default:U(()=>[z("div",gl,[z("div",_l,[S(w,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=e=>b.value=e),placeholder:"搜索用户姓名或邮箱",style:{width:"200px","margin-right":"10px"},clearable:""},{prefix:U(()=>[S(h,null,{default:U(()=>[S(A(i))]),_:1})]),_:1},8,["modelValue"]),S(M,{modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=e=>V.value=e),placeholder:"用户角色",style:{width:"150px","margin-right":"10px"},clearable:""},{default:U(()=>[S(j,{label:"全部",value:""}),S(j,{label:"超级管理员",value:"super_admin"}),S(j,{label:"部门负责人",value:"department_manager"}),S(j,{label:"销售员",value:"sales_staff"}),S(j,{label:"客服",value:"customer_service"})]),_:1},8,["modelValue"]),S(M,{modelValue:P.value,"onUpdate:modelValue":t[2]||(t[2]=e=>P.value=e),placeholder:"部门",style:{width:"150px","margin-right":"10px"},clearable:""},{default:U(()=>[S(j,{label:"全部",value:""}),S(j,{label:"管理部",value:"admin"}),S(j,{label:"销售一部",value:"sales_1"}),S(j,{label:"销售二部",value:"sales_2"}),S(j,{label:"客服部",value:"service"})]),_:1},8,["modelValue"]),S(p,{onClick:be,type:"primary"},{default:U(()=>[S(h,null,{default:U(()=>[S(A(i))]),_:1}),t[31]||(t[31]=I(" 搜索 ",-1))]),_:1}),S(p,{onClick:he,type:"success"},{default:U(()=>[S(h,null,{default:U(()=>[S(A(r))]),_:1}),t[32]||(t[32]=I(" 新增用户 ",-1))]),_:1}),S(p,{onClick:we,type:"warning"},{default:U(()=>[S(h,null,{default:U(()=>[S(A(v))]),_:1}),t[33]||(t[33]=I(" 批量导入 ",-1))]),_:1})]),B((x(),C(se,{data:te.value,style:{width:"100%"}},{default:U(()=>[S(q,{type:"selection",width:"55"}),S(q,{prop:"name",label:"姓名",width:"120"}),S(q,{prop:"email",label:"邮箱",width:"200"}),S(q,{prop:"department",label:"部门",width:"120"}),S(q,{label:"角色",width:"120"},{default:U(({row:e})=>{return[S(J,{type:(l=e.role,{super_admin:"danger",department_manager:"warning",sales_staff:"primary",customer_service:"info"}[l]||"")},{default:U(()=>[I(R(de(e.role)),1)]),_:2},1032,["type"])];var l}),_:1}),S(q,{label:"数据权限",width:"120"},{default:U(({row:e})=>[S(J,{type:pe(e.dataScope),size:"small"},{default:U(()=>[I(R(me(e.dataScope)),1)]),_:2},1032,["type"])]),_:1}),S(q,{label:"状态",width:"100"},{default:U(({row:e})=>[S(ue,{modelValue:e.status,"onUpdate:modelValue":l=>e.status=l,"active-value":"active","inactive-value":"inactive",onChange:l=>(async e=>{try{const l="active"===e.status?"inactive":"active",a="active"===l?"启用":"禁用";await d.confirm(`确定要${a}用户 ${e.name} 吗？`,`确认${a}`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await E.updateUser(parseInt(e.id),{status:l}),e.status=l,s.success(`用户${a}成功`)}catch(l){"cancel"!==l&&(console.error("更新用户状态失败:",l),s.error("更新用户状态失败"))}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),S(q,{label:"最后登录",width:"150"},{default:U(({row:e})=>[I(R(ge(e.lastLogin)),1)]),_:1}),S(q,{label:"操作",width:"280"},{default:U(({row:e})=>[S(p,{onClick:l=>{return a=e,n.value={...a},void(o.value.userPermission=!0);var a},size:"small",type:"primary"},{default:U(()=>[...t[34]||(t[34]=[I(" 编辑权限 ",-1)])]),_:1},8,["onClick"]),S(p,{onClick:l=>{return a=e,n.value={...a},void(o.value.userDetail=!0);var a},size:"small"},{default:U(()=>[...t[35]||(t[35]=[I(" 查看详情 ",-1)])]),_:1},8,["onClick"]),S(p,{onClick:l=>(async e=>{try{await d.confirm(`确定要重置用户 ${e.name} 的密码吗？`,"确认重置",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await E.resetPassword(parseInt(e.id)),s.success("密码重置成功")}catch(l){"cancel"!==l&&(console.error("重置密码失败:",l),s.error("重置密码失败"))}})(e),size:"small",type:"warning"},{default:U(()=>[...t[36]||(t[36]=[I(" 重置密码 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[rl,a.value.users]]),z("div",yl,[S(oe,{"current-page":G.value.currentPage,"onUpdate:currentPage":t[3]||(t[3]=e=>G.value.currentPage=e),"page-size":G.value.pageSize,"onUpdate:pageSize":t[4]||(t[4]=e=>G.value.pageSize=e),"page-sizes":[10,20,50,100],total:G.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ke,onCurrentChange:Ce},null,8,["current-page","page-size","total"])])])]),_:1}),S(re,{label:"角色权限模板",name:"roles"},{default:U(()=>[z("div",bl,[z("div",hl,[S(p,{onClick:xe,type:"primary"},{default:U(()=>[S(h,null,{default:U(()=>[S(A(r))]),_:1}),t[37]||(t[37]=I(" 创建角色模板 ",-1))]),_:1}),S(p,{onClick:Ue,type:"success"},{default:U(()=>[S(h,null,{default:U(()=>[S(A(v))]),_:1}),t[38]||(t[38]=I(" 导入模板 ",-1))]),_:1}),S(p,{onClick:Se,type:"warning"},{default:U(()=>[S(h,null,{default:U(()=>[S(A(f))]),_:1}),t[39]||(t[39]=I(" 导出模板 ",-1))]),_:1})]),S(Xe,{gutter:20},{default:U(()=>[(x(!0),T(D,null,L(Q.value,e=>(x(),C(We,{span:8,key:e.id},{default:U(()=>[S(Qe,{class:"role-template-card"},{header:U(()=>[z("div",wl,[z("span",null,R(e.name),1),S(Ke,{onCommand:Pe},{dropdown:U(()=>[S(ie,null,{default:U(()=>[S(ne,{command:{action:"edit",template:e}},{default:U(()=>[...t[40]||(t[40]=[I("编辑",-1)])]),_:1},8,["command"]),S(ne,{command:{action:"copy",template:e}},{default:U(()=>[...t[41]||(t[41]=[I("复制",-1)])]),_:1},8,["command"]),S(ne,{command:{action:"delete",template:e},divided:""},{default:U(()=>[...t[42]||(t[42]=[I("删除",-1)])]),_:1},8,["command"])]),_:2},1024)]),default:U(()=>[S(p,{type:"text"},{default:U(()=>[S(h,null,{default:U(()=>[S(A(g))]),_:1})]),_:1})]),_:2},1024)])]),default:U(()=>[z("div",Vl,[z("p",null,[t[43]||(t[43]=z("strong",null,"描述：",-1)),I(R(e.description),1)]),z("p",null,[t[44]||(t[44]=z("strong",null,"权限数量：",-1)),I(R(e.permissions.length),1)]),z("p",null,[t[45]||(t[45]=z("strong",null,"使用人数：",-1)),I(R(e.userCount),1)]),z("p",null,[t[46]||(t[46]=z("strong",null,"创建时间：",-1)),I(R(ge(e.createdAt)),1)])]),z("div",kl,[S(p,{onClick:l=>(async e=>{try{s.success(`模板 ${e.name} 应用成功`)}catch(l){console.error("应用模板失败:",l),s.error("应用模板失败")}})(e),type:"primary",size:"small"},{default:U(()=>[...t[47]||(t[47]=[I("应用模板",-1)])]),_:1},8,["onClick"]),S(p,{onClick:l=>(e=>{m.value=e,o.value.roleTemplatePreview=!0})(e),size:"small"},{default:U(()=>[...t[48]||(t[48]=[I("预览权限",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1}),S(re,{label:"部门权限管理",name:"departments"},{default:U(()=>[z("div",Cl,[z("div",xl,[S(p,{onClick:De,type:"primary"},{default:U(()=>[S(h,null,{default:U(()=>[S(A(r))]),_:1}),t[49]||(t[49]=I(" 新增部门 ",-1))]),_:1}),S(p,{onClick:Le,type:"success"},{default:U(()=>[S(h,null,{default:U(()=>[S(A(_))]),_:1}),t[50]||(t[50]=I(" 批量分配权限 ",-1))]),_:1}),S(p,{onClick:Re,type:"warning"},{default:U(()=>[S(h,null,{default:U(()=>[S(A(y))]),_:1}),t[51]||(t[51]=I(" 同步部门数据 ",-1))]),_:1})]),B((x(),C(se,{data:W.value,style:{width:"100%"}},{default:U(()=>[S(q,{prop:"name",label:"部门名称",width:"200"}),S(q,{prop:"manager",label:"部门负责人",width:"150"}),S(q,{prop:"memberCount",label:"成员数量",width:"120"}),S(q,{label:"权限级别",width:"150"},{default:U(({row:e})=>{return[S(J,{type:(l=e.permissionLevel,{full_access:"danger",partial_access:"warning",read_only:"info"}[l]||"")},{default:U(()=>[I(R(ve(e.permissionLevel)),1)]),_:2},1032,["type"])];var l}),_:1}),S(q,{label:"数据范围",width:"150"},{default:U(({row:e})=>[S(J,{type:pe(e.dataScope),size:"small"},{default:U(()=>[I(R(me(e.dataScope)),1)]),_:2},1032,["type"])]),_:1}),S(q,{prop:"description",label:"描述"}),S(q,{label:"操作",width:"250"},{default:U(({row:e})=>[S(p,{onClick:l=>{return a=e,c.value=a,void(o.value.department=!0);var a},size:"small",type:"primary"},{default:U(()=>[...t[52]||(t[52]=[I("编辑",-1)])]),_:1},8,["onClick"]),S(p,{onClick:l=>{return a=e,c.value=a,void(o.value.departmentMembers=!0);var a},size:"small"},{default:U(()=>[...t[53]||(t[53]=[I("成员管理",-1)])]),_:1},8,["onClick"]),S(p,{onClick:l=>{return a=e,c.value=a,void(o.value.departmentPermissions=!0);var a},size:"small"},{default:U(()=>[...t[54]||(t[54]=[I("权限详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[rl,a.value.departments]])])]),_:1}),S(re,{label:"权限审计日志",name:"audit"},{default:U(()=>[z("div",Ul,[z("div",Sl,[S(el,{modelValue:F.value,"onUpdate:modelValue":t[5]||(t[5]=e=>F.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{"margin-right":"10px"}},null,8,["modelValue"]),S(M,{modelValue:N.value,"onUpdate:modelValue":t[6]||(t[6]=e=>N.value=e),placeholder:"操作类型",style:{width:"150px","margin-right":"10px"},clearable:""},{default:U(()=>[S(j,{label:"全部",value:""}),S(j,{label:"权限分配",value:"assign"}),S(j,{label:"权限撤销",value:"revoke"}),S(j,{label:"角色变更",value:"role_change"}),S(j,{label:"用户创建",value:"user_create"}),S(j,{label:"用户删除",value:"user_delete"})]),_:1},8,["modelValue"]),S(w,{modelValue:H.value,"onUpdate:modelValue":t[7]||(t[7]=e=>H.value=e),placeholder:"操作人员",style:{width:"150px","margin-right":"10px"},clearable:""},null,8,["modelValue"]),S(p,{onClick:Fe,type:"primary"},{default:U(()=>[S(h,null,{default:U(()=>[S(A(i))]),_:1}),t[55]||(t[55]=I(" 搜索 ",-1))]),_:1}),S(p,{onClick:qe,type:"success"},{default:U(()=>[S(h,null,{default:U(()=>[S(A(f))]),_:1}),t[56]||(t[56]=I(" 导出日志 ",-1))]),_:1})]),B((x(),C(se,{data:O.value,style:{width:"100%"}},{default:U(()=>[S(q,{prop:"timestamp",label:"时间",width:"180"},{default:U(({row:e})=>{return[I(R((l=e.timestamp,new Date(l).toLocaleString())),1)];var l}),_:1}),S(q,{prop:"operator",label:"操作人员",width:"120"}),S(q,{label:"操作类型",width:"120"},{default:U(({row:e})=>{return[S(J,{type:(l=e.action,{assign:"success",revoke:"warning",role_change:"primary",user_create:"info",user_delete:"danger"}[l]||"")},{default:U(()=>[I(R(fe(e.action)),1)]),_:2},1032,["type"])];var l}),_:1}),S(q,{prop:"target",label:"操作对象",width:"150"}),S(q,{prop:"description",label:"操作描述"}),S(q,{prop:"ipAddress",label:"IP地址",width:"130"}),S(q,{label:"状态",width:"100"},{default:U(({row:e})=>[S(J,{type:"success"===e.status?"success":"danger",size:"small"},{default:U(()=>[I(R("success"===e.status?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[rl,a.value.audit]]),z("div",Pl,[S(oe,{"current-page":X.value.currentPage,"onUpdate:currentPage":t[8]||(t[8]=e=>X.value.currentPage=e),"page-size":X.value.pageSize,"onUpdate:pageSize":t[9]||(t[9]=e=>X.value.pageSize=e),"page-sizes":[10,20,50,100],total:X.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Ye,onCurrentChange:Ne},null,8,["current-page","page-size","total"])])])]),_:1}),S(re,{label:"系统配置",name:"system"},{default:U(()=>[z("div",Il,[S(Xe,{gutter:20},{default:U(()=>[S(We,{span:12},{default:U(()=>[S(Qe,{title:"权限配置"},{header:U(()=>[...t[57]||(t[57]=[z("span",null,"权限配置",-1)])]),default:U(()=>[S(tl,{model:le.value,"label-width":"120px"},{default:U(()=>[S(ll,{label:"默认权限级别"},{default:U(()=>[S(M,{modelValue:le.value.defaultPermissionLevel,"onUpdate:modelValue":t[10]||(t[10]=e=>le.value.defaultPermissionLevel=e)},{default:U(()=>[S(j,{label:"只读权限",value:"read_only"}),S(j,{label:"部分权限",value:"partial_access"}),S(j,{label:"完全权限",value:"full_access"})]),_:1},8,["modelValue"])]),_:1}),S(ll,{label:"密码策略"},{default:U(()=>[S(ue,{modelValue:le.value.enforcePasswordPolicy,"onUpdate:modelValue":t[11]||(t[11]=e=>le.value.enforcePasswordPolicy=e)},null,8,["modelValue"])]),_:1}),S(ll,{label:"双因子认证"},{default:U(()=>[S(ue,{modelValue:le.value.requireTwoFactor,"onUpdate:modelValue":t[12]||(t[12]=e=>le.value.requireTwoFactor=e)},null,8,["modelValue"])]),_:1}),S(ll,{label:"会话超时(分钟)"},{default:U(()=>[S(al,{modelValue:le.value.sessionTimeout,"onUpdate:modelValue":t[13]||(t[13]=e=>le.value.sessionTimeout=e),min:5,max:480},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),S(We,{span:12},{default:U(()=>[S(Qe,{title:"审计配置"},{header:U(()=>[...t[58]||(t[58]=[z("span",null,"审计配置",-1)])]),default:U(()=>[S(tl,{model:le.value,"label-width":"120px"},{default:U(()=>[S(ll,{label:"启用审计日志"},{default:U(()=>[S(ue,{modelValue:le.value.enableAuditLog,"onUpdate:modelValue":t[14]||(t[14]=e=>le.value.enableAuditLog=e)},null,8,["modelValue"])]),_:1}),S(ll,{label:"日志保留天数"},{default:U(()=>[S(al,{modelValue:le.value.auditLogRetentionDays,"onUpdate:modelValue":t[15]||(t[15]=e=>le.value.auditLogRetentionDays=e),min:30,max:365},null,8,["modelValue"])]),_:1}),S(ll,{label:"敏感操作通知"},{default:U(()=>[S(ue,{modelValue:le.value.notifySensitiveOperations,"onUpdate:modelValue":t[16]||(t[16]=e=>le.value.notifySensitiveOperations=e)},null,8,["modelValue"])]),_:1}),S(ll,{label:"自动备份配置"},{default:U(()=>[S(ue,{modelValue:le.value.autoBackupConfig,"onUpdate:modelValue":t[17]||(t[17]=e=>le.value.autoBackupConfig=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),z("div",Tl,[S(p,{onClick:He,type:"primary"},{default:U(()=>[...t[59]||(t[59]=[I("保存配置",-1)])]),_:1}),S(p,{onClick:Je,type:"warning"},{default:U(()=>[...t[60]||(t[60]=[I("重置配置",-1)])]),_:1}),S(p,{onClick:Ze,type:"success"},{default:U(()=>[...t[61]||(t[61]=[I("导出配置",-1)])]),_:1})])])]),_:1})]),_:1},8,["modelValue"]),S(sl,{title:"超级管理员权限面板说明",type:"info",closable:!1,"show-icon":"",style:{"margin-top":"20px"}},{default:U(()=>[...t[62]||(t[62]=[z("div",{class:"panel-description"},[z("p",null,[z("strong",null,"功能说明："),I("此面板专为超级管理员设计，提供高级权限管理功能")]),z("p",null,[z("strong",null,"与角色权限页面的区别：")]),z("ul",null,[z("li",null,[I("• "),z("strong",null,"角色权限页面"),I("：管理基础角色和权限分配，适用于日常权限管理")]),z("li",null,[I("• "),z("strong",null,"超级管理员面板"),I("：提供批量管理、模板配置、审计监控等高级功能")]),z("li",null,[I("• "),z("strong",null,"客服权限管理"),I("：专门针对客服业务场景的权限配置")])]),z("p",null,[z("strong",null,"使用场景："),I("系统初始化、批量用户导入、权限模板管理、安全审计等")])],-1)])]),_:1}),S(Y,{modelValue:o.value.userPermission,"onUpdate:modelValue":t[19]||(t[19]=e=>o.value.userPermission=e),user:n.value,onConfirm:Ve},null,8,["modelValue","user"]),S(Z,{modelValue:o.value.roleTemplate,"onUpdate:modelValue":t[20]||(t[20]=e=>o.value.roleTemplate=e),template:m.value,onConfirm:Te},null,8,["modelValue","template"]),S(K,{modelValue:o.value.department,"onUpdate:modelValue":t[21]||(t[21]=e=>o.value.department=e),department:c.value,onSaved:ze},null,8,["modelValue","department"]),S(ee,{modelValue:o.value.departmentMembers,"onUpdate:modelValue":t[22]||(t[22]=e=>o.value.departmentMembers=e),department:c.value,onUpdated:Ae},null,8,["modelValue","department"]),S(ce,{modelValue:o.value.departmentPermissions,"onUpdate:modelValue":t[23]||(t[23]=e=>o.value.departmentPermissions=e),department:c.value,onUpdate:$e},null,8,["modelValue","department"]),S(Ie,{modelValue:o.value.batchAssignPermissions,"onUpdate:modelValue":t[24]||(t[24]=e=>o.value.batchAssignPermissions=e),onAssigned:Be},null,8,["modelValue"]),S(Ge,{modelValue:o.value.userDetail,"onUpdate:modelValue":t[25]||(t[25]=e=>o.value.userDetail=e),user:n.value,onEdit:je},null,8,["modelValue","user"]),S(dl,{modelValue:o.value.roleTemplateImport,"onUpdate:modelValue":t[26]||(t[26]=e=>o.value.roleTemplateImport=e),onImported:Oe},null,8,["modelValue"]),S(ol,{modelValue:o.value.roleTemplatePreview,"onUpdate:modelValue":t[27]||(t[27]=e=>o.value.roleTemplatePreview=e),template:m.value,onApply:Ee,onExport:Me},null,8,["modelValue","template"])])}}}),[["__scopeId","data-v-da45128a"]]);export{Dl as default};
