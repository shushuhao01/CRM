import{l as e,r as a,b as l,Z as t,e as s,w as o,ag as i,M as r,q as n,O as u,U as d,Q as c,m,F as p,a9 as v,p as f,S as g,T as b,n as h,u as _,aC as y,aA as w,aq as I,P as D}from"./vendor-BtukhyiH.js";import{u as V,_ as k,c as N}from"./index-C4IdUW1A.js";import{E as j,G as x,ak as S,L as C,C as M,e as E,u as Y,H as z,aO as U,T as O,F as $,r as A}from"./elementPlus-DxaqjplL.js";import{useDepartmentStore as B}from"./department-CMDKNhTn.js";import{k as q,w as J,r as T}from"./utils-DfI7e5Rl.js";const L={class:"user-option"},F={class:"user-name"},R={class:"user-id"},P={class:"dialog-footer"},G=k(e({__name:"MemberDialog",props:{modelValue:{type:Boolean},member:{default:null},departmentId:{},isEdit:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(e,{emit:_}){const y=e,w=_,I=B(),D=V(),k=a(),N=a(!1);l(async()=>{0===D.users.length&&await D.loadUsers()});const x=t({userId:"",userIds:[],userName:"",position:"",joinDate:"",status:"active"}),S={userId:[{required:!0,message:"请选择用户",trigger:"change"}],userIds:[{required:!0,message:"请至少选择一个用户",trigger:"change",validator:(e,a,l)=>{a&&0!==a.length?l():l(new Error("请至少选择一个用户"))}}],position:[{required:!0,message:"请输入职位",trigger:"blur"},{min:2,max:50,message:"职位长度在 2 到 50 个字符",trigger:"blur"}],joinDate:[{required:!0,message:"请选择加入时间",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},C=s(()=>{try{const e=D.users;if(!e||0===e.length)return console.log("[成员对话框] userStore中没有用户数据"),[];console.log("[成员对话框] 原始用户数据:",e.length);const a=e.filter(e=>{const a="active"===e.status;return a||console.log("[成员对话框] 过滤非活跃用户:",e.username||e.name),a}).map(e=>({id:e.id,name:e.realName||e.name||e.username,account:e.username||e.id,department:e.departmentName||e.department||"",departmentId:e.departmentId,phone:e.phone||""}));if(console.log("[成员对话框] 活跃用户总数:",a.length),console.log("[成员对话框] 活跃用户列表:",a.map(e=>`${e.name}(${e.id})`).join(", ")),y.isEdit)return console.log("[成员对话框] 编辑模式，返回所有活跃用户"),a;const l=I.getDepartmentMembers(y.departmentId).map(e=>e.userId);console.log("[成员对话框] 当前部门ID:",y.departmentId),console.log("[成员对话框] 当前部门已有成员:",l.length),console.log("[成员对话框] 已有成员ID列表:",l.join(", "));const t=a.filter(e=>!l.includes(e.id)||(console.log("[成员对话框] 过滤已在部门的用户:",e.name),!1));return console.log("[成员对话框] 可添加用户数:",t.length),console.log("[成员对话框] 可添加用户列表:",t.map(e=>`${e.name}(${e.id}, 部门:${e.departmentId||"未分配"})`).join(", ")),t}catch(e){return console.error("[成员对话框] 获取可用用户失败:",e),console.error("[成员对话框] 错误详情:",e),[]}}),M=s(()=>{try{const e=["总经理","副总经理","部门经理","主管","组长","专员","助理","秘书","销售经理","销售专员","客服主管","客服专员","财务经理","会计","出纳","物流主管","物流专员","审核员","质检员"],a=localStorage.getItem("crm_mock_users");if(a){const l=JSON.parse(a).map(e=>e.roleName||e.role||e.position).filter(e=>e&&e.trim()).filter((e,a,l)=>l.indexOf(e)===a),t=[...new Set([...e,...l])];return console.log("[成员对话框] 可用职位列表:",t),t}return e}catch(e){return console.error("[成员对话框] 获取职位列表失败:",e),["总经理","副总经理","部门经理","主管","组长","专员","助理","秘书"]}}),E=()=>{Object.assign(x,{userId:"",userIds:[],userName:"",position:"",joinDate:(new Date).toISOString().split("T")[0],status:"active"}),h(()=>{k.value?.clearValidate()})},Y=()=>{y.isEdit&&y.member?Object.assign(x,{userId:y.member.userId,userName:y.member.userName,position:y.member.position,joinDate:y.member.joinDate,status:y.member.status}):E()},z=e=>{if(y.isEdit){const a=e,l=C.value.find(e=>e.id===a);l&&(x.userName=l.name)}};o(()=>y.modelValue,e=>{e&&Y()}),o(()=>y.member,()=>{y.modelValue&&Y()});const U=()=>{w("update:modelValue",!1),E()},O=async()=>{if(k.value)try{if(!(await k.value.validate()))return;if(N.value=!0,y.isEdit&&y.member){const e=localStorage.getItem("crm_mock_users");if(e){const a=JSON.parse(e),l=a.findIndex(e=>e.id===y.member.userId);-1!==l&&(a[l].position=x.position,a[l].status=x.status,localStorage.setItem("crm_mock_users",JSON.stringify(a)),console.log("[成员对话框] 已更新用户信息:",a[l]))}I.syncAllDepartmentMemberCounts()}else{const e=localStorage.getItem("crm_mock_users");if(e){const a=JSON.parse(e);if(x.userIds&&x.userIds.length>0)for(const e of x.userIds){const l=a.findIndex(a=>a.id===e);-1!==l&&(a[l].departmentId=y.departmentId,a[l].position=x.position,a[l].status=x.status,console.log("[成员对话框] 已添加用户到部门:",a[l].username))}localStorage.setItem("crm_mock_users",JSON.stringify(a))}I.syncAllDepartmentMemberCounts()}j.success(y.isEdit?"成员更新成功":"成员添加成功"),U(),w("success")}catch(e){j.error(e instanceof Error?e.message:"操作失败")}finally{N.value=!1}};return(a,l)=>{const t=i("el-avatar"),s=i("el-option"),o=i("el-select"),h=i("el-form-item"),_=i("el-input"),y=i("el-date-picker"),w=i("el-radio"),I=i("el-radio-group"),D=i("el-form"),V=i("el-button"),j=i("el-dialog");return n(),r(j,{"model-value":e.modelValue,title:e.isEdit?"编辑成员":"添加成员",width:"500px","before-close":U,class:"member-dialog"},{footer:u(()=>[f("div",P,[d(V,{onClick:U,class:"cancel-btn"},{default:u(()=>[...l[7]||(l[7]=[g("取消",-1)])]),_:1}),d(V,{type:"primary",onClick:O,loading:N.value,class:"submit-btn"},{default:u(()=>[g(b(e.isEdit?"更新":"添加"),1)]),_:1},8,["loading"])])]),default:u(()=>[d(D,{ref_key:"formRef",ref:k,model:x,rules:S,"label-width":"80px",class:"member-form"},{default:u(()=>[e.isEdit?c("",!0):(n(),r(h,{key:0,label:"选择用户",prop:"userIds"},{default:u(()=>[d(o,{modelValue:x.userIds,"onUpdate:modelValue":l[0]||(l[0]=e=>x.userIds=e),placeholder:"请选择要添加的用户（支持多选）",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"100%"},onChange:z},{default:u(()=>[(n(!0),m(p,null,v(C.value,e=>(n(),r(s,{key:e.id,label:e.name,value:e.id},{default:u(()=>[f("div",L,[d(t,{size:24,class:"user-avatar"},{default:u(()=>[g(b(e.name.charAt(0)),1)]),_:2},1024),f("span",F,b(e.name),1),f("span",R,"ID: "+b(e.id),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),e.isEdit?(n(),r(h,{key:1,label:"用户姓名"},{default:u(()=>[d(_,{modelValue:x.userName,"onUpdate:modelValue":l[1]||(l[1]=e=>x.userName=e),disabled:""},null,8,["modelValue"])]),_:1})):c("",!0),d(h,{label:"职位",prop:"position"},{default:u(()=>[d(o,{modelValue:x.position,"onUpdate:modelValue":l[2]||(l[2]=e=>x.position=e),placeholder:"请选择或输入职位",filterable:"","allow-create":"",style:{width:"100%"}},{default:u(()=>[(n(!0),m(p,null,v(M.value,e=>(n(),r(s,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(h,{label:"加入时间",prop:"joinDate"},{default:u(()=>[d(y,{modelValue:x.joinDate,"onUpdate:modelValue":l[3]||(l[3]=e=>x.joinDate=e),type:"date",placeholder:"选择加入时间",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),d(h,{label:"状态",prop:"status"},{default:u(()=>[d(I,{modelValue:x.status,"onUpdate:modelValue":l[4]||(l[4]=e=>x.status=e)},{default:u(()=>[d(w,{label:"active"},{default:u(()=>[...l[5]||(l[5]=[g("活跃",-1)])]),_:1}),d(w,{label:"inactive"},{default:u(()=>[...l[6]||(l[6]=[g("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","title"])}}}),[["__scopeId","data-v-5a6031d2"]]),H={class:"import-container"},Q={class:"step-content"},Z={key:0,class:"step-panel"},K={class:"template-info"},W={class:"template-preview"},X={key:1,class:"step-panel"},ee={class:"upload-area"},ae={key:2,class:"step-panel"},le={class:"preview-info"},te={class:"dialog-footer"},se=k(e({__name:"BatchImportDialog",props:{modelValue:{type:Boolean},departmentId:{}},emits:["update:modelValue","success"],setup(e,{emit:l}){const t=e,p=l,v=B(),h=s({get:()=>t.modelValue,set:e=>p("update:modelValue",e)}),y=a(0),w=a(),I=a([]),D=a("valid"),V=a(!1),k=a([{userName:"张三",userId:"1",position:"销售专员",joinDate:"2024-01-15",status:"active"},{userName:"李四",userId:"2",position:"客服专员",joinDate:"2024-01-16",status:"active"}]),N=s(()=>I.value.filter(e=>!e.error)),C=s(()=>I.value.filter(e=>e.error)),M=s(()=>0===y.value||1===y.value&&I.value.length>0),E=()=>{h.value=!1,Y()},Y=()=>{y.value=0,I.value=[],D.value="valid",V.value=!1,w.value&&w.value.clearFiles()},z=()=>{const e=q.book_new(),a=q.aoa_to_sheet([["姓名","用户ID","职位","加入日期","状态"],["张三","1","销售专员","2024-01-15","active"],["李四","2","客服专员","2024-01-16","active"]]);a["!cols"]=[{wch:10},{wch:10},{wch:15},{wch:12},{wch:10}],q.book_append_sheet(e,a,"成员导入模板"),J(e,"部门成员导入模板.xlsx"),j.success("模板下载成功")},U=e=>{const a="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type||"application/vnd.ms-excel"===e.type,l=e.size/1024/1024<10;return a?(l||j.error("文件大小不能超过10MB!"),!1):(j.error("只能上传Excel文件!"),!1)},O=e=>{e.raw&&$(e.raw)},$=e=>{const a=new FileReader;a.onload=e=>{try{const a=new Uint8Array(e.target?.result),l=T(a,{type:"array"}),t=l.SheetNames[0],s=l.Sheets[t],o=q.sheet_to_json(s,{header:1}),i=[];for(let e=1;e<o.length;e++){const a=o[e];if(0===a.length||!a[0])continue;const l={userName:a[0]?.toString().trim()||"",userId:a[1]?.toString().trim()||"",position:a[2]?.toString().trim()||"",joinDate:a[3]?.toString().trim()||"",status:a[4]?.toString().trim()||"active"};A(l),i.push(l)}I.value=i,j.success(`成功解析 ${i.length} 条数据`)}catch(a){j.error("文件解析失败，请检查文件格式")}},a.readAsArrayBuffer(e)},A=e=>{const a=[];if(e.userName||a.push("姓名不能为空"),e.userId||a.push("用户ID不能为空"),e.position||a.push("职位不能为空"),e.userId){(()=>{const e=localStorage.getItem("userDatabase");return e?JSON.parse(e):[{id:"1",username:"admin",realName:"超级管理员"},{id:"2",username:"manager",realName:"张经理"},{id:"3",username:"sales001",realName:"李销售"},{id:"4",username:"service001",realName:"王客服"},{id:"5",username:"finance001",realName:"赵会计"},{id:"6",username:"logistics001",realName:"刘主管"},{id:"7",username:"service002",realName:"陈主管"},{id:"8",username:"sales002",realName:"孙组长"}]})().find(a=>a.id===e.userId)||a.push("用户ID不存在")}e.status&&!["active","inactive"].includes(e.status)&&a.push("状态只能是active或inactive"),e.joinDate&&!/^\d{4}-\d{2}-\d{2}$/.test(e.joinDate)&&a.push("日期格式错误，应为YYYY-MM-DD"),a.length>0&&(e.error=a.join("; "))},L=()=>{y.value<2&&y.value++},F=()=>{y.value>0&&y.value--},R=async()=>{if(0!==N.value.length){V.value=!0;try{for(const e of N.value)await v.addDepartmentMember({userId:e.userId,userName:e.userName,departmentId:t.departmentId,position:e.position,joinDate:e.joinDate||(new Date).toISOString().split("T")[0],status:e.status});j.success(`成功导入 ${N.value.length} 个成员`),p("success")}catch(e){j.error("导入失败，请重试")}finally{V.value=!1}}else j.warning("没有有效数据可导入")};return o(h,e=>{e||Y()}),(e,a)=>{const l=i("el-step"),t=i("el-steps"),s=i("el-icon"),o=i("el-button"),p=i("el-table-column"),v=i("el-table"),j=i("el-upload"),Y=i("el-alert"),$=i("el-tag"),A=i("el-tab-pane"),B=i("el-text"),q=i("el-tabs"),J=i("el-dialog");return n(),r(J,{modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=e=>h.value=e),title:"批量导入成员",width:"600px","close-on-click-modal":!1,onClose:E},{footer:u(()=>[f("div",te,[d(o,{onClick:E},{default:u(()=>[...a[9]||(a[9]=[g("取消",-1)])]),_:1}),y.value>0?(n(),r(o,{key:0,onClick:F},{default:u(()=>[...a[10]||(a[10]=[g("上一步",-1)])]),_:1})):c("",!0),y.value<2?(n(),r(o,{key:1,type:"primary",onClick:L,disabled:!M.value},{default:u(()=>[...a[11]||(a[11]=[g(" 下一步 ",-1)])]),_:1},8,["disabled"])):c("",!0),2===y.value?(n(),r(o,{key:2,type:"primary",onClick:R,disabled:0===N.value.length,loading:V.value},{default:u(()=>[...a[12]||(a[12]=[g(" 确认导入 ",-1)])]),_:1},8,["disabled","loading"])):c("",!0)])]),default:u(()=>[f("div",H,[d(t,{active:y.value,"finish-status":"success",class:"import-steps"},{default:u(()=>[d(l,{title:"下载模板",description:"下载Excel模板文件"}),d(l,{title:"填写数据",description:"按模板格式填写成员信息"}),d(l,{title:"上传文件",description:"上传填写好的Excel文件"}),d(l,{title:"确认导入",description:"预览并确认导入数据"})]),_:1},8,["active"]),f("div",Q,[0===y.value?(n(),m("div",Z,[f("div",K,[d(s,{class:"info-icon"},{default:u(()=>[d(_(x))]),_:1}),a[3]||(a[3]=f("h3",null,"下载导入模板",-1)),a[4]||(a[4]=f("p",null,"请先下载Excel模板文件，按照模板格式填写成员信息",-1)),d(o,{type:"primary",icon:_(x),onClick:z},{default:u(()=>[...a[2]||(a[2]=[g(" 下载模板文件 ",-1)])]),_:1},8,["icon"])]),f("div",W,[a[5]||(a[5]=f("h4",null,"模板格式说明：",-1)),d(v,{data:k.value,size:"small",border:""},{default:u(()=>[d(p,{prop:"userName",label:"姓名*",width:"100"}),d(p,{prop:"userId",label:"用户ID*",width:"100"}),d(p,{prop:"position",label:"职位*",width:"120"}),d(p,{prop:"joinDate",label:"加入日期",width:"120"}),d(p,{prop:"status",label:"状态",width:"80"})]),_:1},8,["data"]),a[6]||(a[6]=f("div",{class:"template-notes"},[f("p",null,[f("strong",null,"注意事项：")]),f("ul",null,[f("li",null,"带*号的字段为必填项"),f("li",null,"用户ID必须是系统中已存在的用户"),f("li",null,"加入日期格式：YYYY-MM-DD"),f("li",null,"状态只能填写：active（活跃）或 inactive（停用）")])],-1))])])):c("",!0),1===y.value?(n(),m("div",X,[f("div",ee,[d(j,{ref_key:"uploadRef",ref:w,class:"upload-demo",drag:"","auto-upload":!1,"on-change":O,"before-upload":U,accept:".xlsx,.xls",limit:1},{tip:u(()=>[...a[7]||(a[7]=[f("div",{class:"el-upload__tip"}," 只能上传xlsx/xls文件，且不超过10MB ",-1)])]),default:u(()=>[d(s,{class:"el-icon--upload"},{default:u(()=>[d(_(S))]),_:1}),a[8]||(a[8]=f("div",{class:"el-upload__text"},[g(" 将Excel文件拖拽到此处，或"),f("em",null,"点击上传")],-1))]),_:1},512)])])):c("",!0),2===y.value?(n(),m("div",ae,[f("div",le,[d(Y,{title:`共解析到 ${I.value.length} 条数据，其中 ${N.value.length} 条有效，${C.value.length} 条有误`,type:C.value.length>0?"warning":"success","show-icon":"",closable:!1},null,8,["title","type"])]),d(q,{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value=e),class:"preview-tabs"},{default:u(()=>[d(A,{label:"有效数据",name:"valid",badge:N.value.length},{default:u(()=>[d(v,{data:N.value,size:"small","max-height":"300"},{default:u(()=>[d(p,{prop:"userName",label:"姓名",width:"100"}),d(p,{prop:"userId",label:"用户ID",width:"100"}),d(p,{prop:"position",label:"职位",width:"120"}),d(p,{prop:"joinDate",label:"加入日期",width:"120"}),d(p,{prop:"status",label:"状态",width:"80"},{default:u(({row:e})=>[d($,{type:"active"===e.status?"success":"danger",size:"small"},{default:u(()=>[g(b("active"===e.status?"活跃":"停用"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["badge"]),C.value.length>0?(n(),r(A,{key:0,label:"错误数据",name:"error",badge:C.value.length},{default:u(()=>[d(v,{data:C.value,size:"small","max-height":"300"},{default:u(()=>[d(p,{prop:"userName",label:"姓名",width:"100"}),d(p,{prop:"userId",label:"用户ID",width:"100"}),d(p,{prop:"position",label:"职位",width:"120"}),d(p,{prop:"joinDate",label:"加入日期",width:"120"}),d(p,{prop:"status",label:"状态",width:"80"}),d(p,{prop:"error",label:"错误信息","min-width":"200"},{default:u(({row:e})=>[d(B,{type:"danger",size:"small"},{default:u(()=>[g(b(e.error),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1},8,["badge"])):c("",!0)]),_:1},8,["modelValue"])])):c("",!0)])])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-35677cb0"]]),oe={class:"department-members-container"},ie={class:"page-header"},re={class:"header-left"},ne={class:"title-section"},ue={class:"page-title"},de={class:"department-info"},ce={class:"level-info"},me={key:0,class:"manager-info"},pe={class:"action-buttons"},ve={class:"stats-section"},fe={class:"stat-card"},ge={class:"stat-icon total"},be={class:"stat-content"},he={class:"stat-number"},_e={class:"stat-card"},ye={class:"stat-icon active"},we={class:"stat-content"},Ie={class:"stat-number"},De={class:"stat-card"},Ve={class:"stat-icon positions"},ke={class:"stat-content"},Ne={class:"stat-number"},je={class:"stat-card"},xe={class:"stat-icon recent"},Se={class:"stat-content"},Ce={class:"stat-number"},Me={class:"search-section"},Ee={class:"table-section"},Ye={class:"member-info"},ze={class:"member-details"},Ue={class:"member-name"},Oe={class:"member-id"},$e={class:"action-buttons"},Ae=k(e({__name:"DepartmentMembers",setup(e){const t=y(),h=w(),V=N(h),k=B(),x=a(t.params.id),S=a(""),q=a(""),J=a(""),T=a(!1),L=a(null),F=a(!1),R=a(!1),P=s(()=>k.getDepartmentById(x.value)),H=s(()=>k.getDepartmentMembers(x.value)),Q=s(()=>H.value.filter(e=>"active"===e.status)),Z=s(()=>{const e=H.value.map(e=>e.position);return[...new Set(e)]}),K=s(()=>{const e=new Date;return e.setMonth(e.getMonth()-1),H.value.filter(a=>new Date(a.joinDate)>=e).length}),W=s(()=>{let e=H.value;if(S.value){const a=S.value.toLowerCase();e=e.filter(e=>e.userName.toLowerCase().includes(a)||e.userId.toLowerCase().includes(a))}return q.value&&(e=e.filter(e=>e.status===q.value)),J.value&&(e=e.filter(e=>e.position===J.value)),e}),X=()=>{V.push("/system/departments")},ee=e=>{const a=new Date(e),l=new Date,t=Math.abs(l.getTime()-a.getTime());return Math.ceil(t/864e5)},ae=()=>{},le=()=>{},te=()=>{S.value="",q.value="",J.value="",j.success("数据已刷新")},Ae=()=>{L.value=null,F.value=!1,T.value=!0},Be=()=>{R.value=!0},qe=()=>{T.value=!1,j.success(F.value?"成员信息已更新":"成员已添加")},Je=()=>{R.value=!1,j.success("批量导入成功")};return o(()=>t.params.id,e=>{e&&(x.value=e)},{immediate:!0}),l(()=>{P.value||(j.error("部门不存在"),V.push("/system/departments"))}),(e,a)=>{const l=i("el-button"),t=i("el-tag"),s=i("el-icon"),o=i("el-col"),h=i("el-row"),y=i("el-input"),w=i("el-option"),V=i("el-select"),N=i("el-avatar"),B=i("el-table-column"),Te=i("el-popconfirm"),Le=i("el-table"),Fe=I("loading");return n(),m("div",oe,[f("div",ie,[f("div",re,[d(l,{icon:_(C),onClick:X,class:"back-btn"},{default:u(()=>[...a[5]||(a[5]=[g("返回",-1)])]),_:1},8,["icon"]),f("div",ne,[f("h2",ue,b(P.value?.name)+" - 成员配置",1),f("div",de,[d(t,{type:"primary",size:"small"},{default:u(()=>[g(b(P.value?.code),1)]),_:1}),f("span",ce,b(P.value?.level)+"级部门",1),P.value?.managerName?(n(),m("span",me," 负责人："+b(P.value.managerName),1)):c("",!0)])])]),f("div",pe,[d(l,{type:"primary",icon:_(M),onClick:Ae,class:"add-btn"},{default:u(()=>[...a[6]||(a[6]=[g(" 添加成员 ",-1)])]),_:1},8,["icon"]),d(l,{type:"success",icon:_(E),onClick:Be,class:"import-btn"},{default:u(()=>[...a[7]||(a[7]=[g(" 批量导入 ",-1)])]),_:1},8,["icon"])])]),f("div",ve,[d(h,{gutter:20},{default:u(()=>[d(o,{span:6},{default:u(()=>[f("div",fe,[f("div",ge,[d(s,null,{default:u(()=>[d(_(Y))]),_:1})]),f("div",be,[f("div",he,b(H.value.length),1),a[8]||(a[8]=f("div",{class:"stat-label"},"总成员数",-1))])])]),_:1}),d(o,{span:6},{default:u(()=>[f("div",_e,[f("div",ye,[d(s,null,{default:u(()=>[d(_(z))]),_:1})]),f("div",we,[f("div",Ie,b(Q.value.length),1),a[9]||(a[9]=f("div",{class:"stat-label"},"活跃成员",-1))])])]),_:1}),d(o,{span:6},{default:u(()=>[f("div",De,[f("div",Ve,[d(s,null,{default:u(()=>[d(_(U))]),_:1})]),f("div",ke,[f("div",Ne,b(Z.value.length),1),a[10]||(a[10]=f("div",{class:"stat-label"},"职位类型",-1))])])]),_:1}),d(o,{span:6},{default:u(()=>[f("div",je,[f("div",xe,[d(s,null,{default:u(()=>[d(_(O))]),_:1})]),f("div",Se,[f("div",Ce,b(K.value),1),a[11]||(a[11]=f("div",{class:"stat-label"},"本月新增",-1))])])]),_:1})]),_:1})]),f("div",Me,[d(h,{gutter:20,align:"middle"},{default:u(()=>[d(o,{span:8},{default:u(()=>[d(y,{modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=e=>S.value=e),placeholder:"搜索成员姓名或用户ID","prefix-icon":_($),clearable:"",onInput:ae},null,8,["modelValue","prefix-icon"])]),_:1}),d(o,{span:6},{default:u(()=>[d(V,{modelValue:q.value,"onUpdate:modelValue":a[1]||(a[1]=e=>q.value=e),placeholder:"成员状态",clearable:"",onChange:le},{default:u(()=>[d(w,{label:"全部",value:""}),d(w,{label:"活跃",value:"active"}),d(w,{label:"停用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),d(o,{span:6},{default:u(()=>[d(V,{modelValue:J.value,"onUpdate:modelValue":a[2]||(a[2]=e=>J.value=e),placeholder:"职位筛选",clearable:"",onChange:le},{default:u(()=>[d(w,{label:"全部",value:""}),(n(!0),m(p,null,v(Z.value,e=>(n(),r(w,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(o,{span:4},{default:u(()=>[d(l,{icon:_(A),onClick:te,class:"refresh-btn"},{default:u(()=>[...a[12]||(a[12]=[g(" 刷新 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1})]),f("div",Ee,[D((n(),r(Le,{data:W.value,class:"members-table"},{default:u(()=>[d(B,{prop:"userName",label:"成员姓名","min-width":"120"},{default:u(({row:e})=>[f("div",Ye,[d(N,{size:32,src:e.userAvatar,class:"member-avatar"},{default:u(()=>[g(b(e.userName.charAt(0)),1)]),_:2},1032,["src"]),f("div",ze,[f("div",Ue,b(e.userName),1),f("div",Oe,"ID: "+b(e.userId),1)])])]),_:1}),d(B,{prop:"position",label:"职位",width:"150"},{default:u(({row:e})=>[d(t,{type:"info",size:"small"},{default:u(()=>[g(b(e.position),1)]),_:2},1024)]),_:1}),d(B,{prop:"joinDate",label:"加入时间",width:"120"},{default:u(({row:e})=>{return[g(b((a=e.joinDate,new Date(a).toLocaleDateString("zh-CN"))),1)];var a}),_:1}),d(B,{prop:"status",label:"状态",width:"100",align:"center"},{default:u(({row:e})=>[d(t,{type:"active"===e.status?"success":"danger",size:"small"},{default:u(()=>[g(b("active"===e.status?"活跃":"停用"),1)]),_:2},1032,["type"])]),_:1}),d(B,{label:"在职天数",width:"100",align:"center"},{default:u(({row:e})=>[g(b(ee(e.joinDate))+"天 ",1)]),_:1}),d(B,{label:"操作",width:"200",fixed:"right"},{default:u(({row:e})=>[f("div",$e,[d(l,{size:"small",type:"primary",link:"",onClick:a=>{return l=e,L.value=l,F.value=!0,void(T.value=!0);var l}},{default:u(()=>[...a[13]||(a[13]=[g(" 编辑 ",-1)])]),_:1},8,["onClick"]),d(l,{size:"small",type:"active"===e.status?"warning":"success",link:"",onClick:a=>(async e=>{try{const a="active"===e.status?"inactive":"active";e.status=a,j.success("成员已"+("active"===a?"启用":"停用"))}catch(a){j.error("操作失败")}})(e)},{default:u(()=>[g(b("active"===e.status?"停用":"启用"),1)]),_:2},1032,["type","onClick"]),d(Te,{title:"确定要移除这个成员吗？",onConfirm:a=>(async e=>{try{await k.removeDepartmentMember(e.id),j.success("成员已移除")}catch(a){j.error("移除失败")}})(e)},{reference:u(()=>[d(l,{size:"small",type:"danger",link:""},{default:u(()=>[...a[14]||(a[14]=[g(" 移除 ",-1)])]),_:1})]),_:1},8,["onConfirm"])])]),_:1})]),_:1},8,["data"])),[[Fe,_(k).loading]])]),d(G,{modelValue:T.value,"onUpdate:modelValue":a[3]||(a[3]=e=>T.value=e),member:L.value,"department-id":x.value,"is-edit":F.value,onSuccess:qe},null,8,["modelValue","member","department-id","is-edit"]),d(se,{modelValue:R.value,"onUpdate:modelValue":a[4]||(a[4]=e=>R.value=e),"department-id":x.value,onSuccess:Je},null,8,["modelValue","department-id"])])}}}),[["__scopeId","data-v-70a985c7"]]);export{Ae as default};
