import{l as e,aA as t,aC as a,r as s,Z as i,e as l,b as r,Y as d,ag as n,m as o,q as c,p as u,Q as m,U as p,u as v,T as f,M as y,O as g,S as h,F as _,a9 as k,P as w,V as b}from"./vendor-BtukhyiH.js";import{L as T,a1 as x,d as N,l as S,M as A,m as C,J as D,u as I,a2 as $,T as M,a3 as j,v as O,$ as E,a4 as z,R as P,a5 as F,a6 as R,N as L,a7 as B,P as q,a8 as K,C as H,j as W,H as U,E as V,b as J,I as Y}from"./elementPlus-DxaqjplL.js";import{d as Z,i as Q,b as G,u as X,S as ee,c as te,_ as ae}from"./index-BGtT17ll.js";import{orderApi as se}from"./order-CdFdv0YM.js";import{u as ie}from"./service-CQY3-CML.js";import{d as le}from"./sensitiveInfo-PTigg6SS.js";import{u as re}from"./orderFieldConfig-DyZNi40x.js";import"./utils-DfI7e5Rl.js";import"./env-DLalhsF6.js";const de={class:"order-detail"},ne={class:"page-header"},oe={class:"header-left"},ce={class:"header-info"},ue={class:"order-number"},me={class:"header-actions"},pe={key:1,class:"mark-status"},ve={class:"row-layout full-width"},fe={class:"card-header-modern"},ye={class:"header-left"},ge={class:"header-right"},he={class:"customer-info-modern"},_e={class:"customer-main"},ke={class:"customer-avatar-section"},we={class:"customer-details-modern"},be={class:"customer-name-modern"},Te={class:"customer-contact-modern"},xe={class:"contact-text"},Ne={class:"contact-item-modern"},Se={class:"contact-text"},Ae={class:"contact-item-modern address-item"},Ce={class:"contact-text"},De={class:"row-layout full-width"},Ie={class:"status-header-horizontal"},$e={class:"status-title"},Me={class:"status-right-section"},je={key:0,class:"countdown-section"},Oe={class:"countdown-timer"},Ee={class:"countdown-text"},ze={class:"status-timeline-horizontal"},Pe={class:"timeline-item-horizontal"},Fe={class:"timeline-content"},Re={class:"timeline-value"},Le={class:"timeline-item-horizontal"},Be={class:"timeline-content"},qe={class:"timeline-value"},Ke={key:0,class:"timeline-item-horizontal countdown-timeline"},He={class:"timeline-content"},We={class:"timeline-value countdown-value"},Ue={key:1,class:"status-tip-horizontal"},Ve={class:"row-layout full-width"},Je={class:"card-header-modern"},Ye={class:"header-left"},Ze={class:"delivery-info-modern"},Qe={class:"delivery-grid-modern"},Ge={class:"delivery-field-modern"},Xe={class:"field-value-modern"},et={class:"delivery-field-modern"},tt={class:"delivery-field-modern address-field-modern"},at={class:"field-value-modern address-value-modern"},st={class:"row-layout full-width"},it={class:"card-header-modern"},lt={class:"header-left"},rt={class:"order-info-modern"},dt={class:"order-basic-info"},nt={class:"info-grid"},ot={class:"info-item"},ct={class:"info-value order-number-value"},ut={class:"info-item"},mt={class:"info-value"},pt={class:"info-item"},vt={class:"info-value"},ft={class:"info-item"},yt={class:"info-value"},gt={key:0,class:"info-item"},ht={class:"info-value"},_t={key:0,class:"info-item"},kt={class:"info-label"},wt={class:"info-value"},bt={class:"logistics-section"},Tt={class:"section-title"},xt={key:0,class:"logistics-info-grid"},Nt={class:"logistics-item highlight"},St={class:"logistics-value"},At={class:"logistics-item highlight"},Ct={class:"logistics-value tracking-number-modern"},Dt={class:"logistics-item"},It={class:"logistics-value"},$t={class:"logistics-item"},Mt={class:"logistics-value estimated-delivery"},jt={key:1,class:"logistics-info-grid pending"},Ot={class:"logistics-item"},Et={class:"logistics-value"},zt={class:"logistics-item"},Pt={class:"logistics-value"},Ft={class:"logistics-item"},Rt={class:"logistics-value"},Lt={key:0,class:"order-remark-modern"},Bt={class:"remark-title"},qt={class:"remark-content"},Kt={class:"row-layout full-width"},Ht={class:"card-header"},Wt={class:"products-list"},Ut={class:"product-info"},Vt={class:"product-image"},Jt=["src","alt"],Yt={class:"product-details"},Zt={class:"product-name"},Qt={class:"product-sku"},Gt={class:"amount-summary-modern"},Xt={class:"amount-cards-modern"},ea={class:"amount-card-modern total-modern"},ta={class:"amount-icon-modern"},aa={class:"amount-content-modern"},sa={class:"amount-value-modern"},ia={key:0,class:"amount-card-modern deposit-modern"},la={class:"amount-icon-modern"},ra={class:"amount-content-modern"},da={class:"amount-value-modern"},na={key:1,class:"amount-card-modern collect-modern"},oa={class:"amount-icon-modern"},ca={class:"amount-content-modern"},ua={class:"amount-value-modern"},ma={key:2,class:"amount-card-modern payment-modern"},pa={class:"amount-icon-modern"},va={class:"amount-content-modern"},fa={class:"amount-value-modern payment-text"},ya={class:"amount-row-detail"},ga={class:"amount-detail-item subtotal-item"},ha={class:"detail-value subtotal"},_a={key:0,class:"amount-detail-item discount-item"},ka={class:"detail-value discount"},wa={key:1,class:"amount-detail-item discount-item"},ba={class:"detail-value discount"},Ta={key:2,class:"amount-detail-item payment-item"},xa={class:"detail-value payment"},Na={key:0,class:"deposit-screenshot-horizontal"},Sa={class:"screenshots-container"},Aa=["onClick"],Ca={class:"screenshot-overlay"},Da={key:0,class:"screenshot-count"},Ia={class:"row-layout full-width"},$a={class:"card-header"},Ma={class:"logistics-timeline"},ja={class:"logistics-content"},Oa={class:"logistics-status"},Ea={class:"logistics-description"},za={key:0,class:"logistics-location"},Pa={class:"row-layout full-width"},Fa={class:"card-header"},Ra={class:"row-layout full-width"},La={class:"card-header"},Ba={class:"timeline-content"},qa={class:"timeline-title"},Ka={class:"timeline-description"},Ha={key:0,class:"timeline-operator"},Wa={key:0,class:"row-layout full-width"},Ua={class:"card-header"},Va={class:"logistics-header-info"},Ja={key:1,class:"tracking-number"},Ya={key:0,class:"logistics-loading"},Za={class:"logistics-content"},Qa={class:"logistics-status"},Ga={class:"logistics-description"},Xa={key:0,class:"logistics-location"},es={class:"logistics-actions"},ts={class:"row-layout full-width"},as={class:"card-header"},ss={class:"after-sales-content"},is={class:"after-sales-title"},ls={class:"after-sales-description"},rs={key:0,class:"after-sales-operator"},ds={key:1,class:"after-sales-amount"},ns=ae(e({__name:"Detail",setup(e){const ae=t(),ns=a(),os=te(ae),cs=Z(),us=Q(),ms=G(),ps=ie(),vs=X(),fs=re(),ys=s(!1),gs=ns.params.id,hs=s(180),_s=s(null),ks=s("03:00"),ws=i({id:"",orderNumber:"",status:"pending",auditStatus:"pending",markType:"",createTime:"",updateTime:"",auditTransferTime:"",isAuditTransferred:!1,customer:{id:"",name:"",phone:"",wechat:"",address:"",level:"normal",avatar:""},receiverName:"",receiverPhone:"",receiverAddress:"",expressCompany:"",trackingNumber:"",serviceWechat:"",orderSource:"",expectedShipDate:"",expectedDeliveryDate:"",products:[],subtotal:0,discount:0,totalAmount:0,depositAmount:0,depositScreenshot:"",depositScreenshots:[],paymentMethod:"",paymentMethodOther:"",remark:"",customFields:{}}),bs=s([]),Ts=s([]),xs=s([]),Ns=s([]),Ss=s(!0),As=s(!0),Cs=s(!0),Ds=s(!1),Is=s(!1),$s=e=>{const{orderId:t,log:a}=e.detail;t===ns.params.id&&xs.value.unshift(a)},Ms=e=>{const{orderId:t,newStatus:a}=e.detail;t===ns.params.id&&(ws.status=a,zs(),Rs())},js=e=>{const t=e.detail;ws.trackingNumber===t.trackingNumber&&oi()},Os=e=>{const{orderId:t,serviceId:a}=e.detail;t===ns.params.id&&Ps()},Es=e=>{const{orderId:t,serviceId:a,newStatus:s}=e.detail;t===ns.params.id&&Ps()},zs=()=>{xs.value=cs.getOperationLogs(gs)},Ps=async()=>{try{const e=ps.getServicesByOrderId(ws.id);Ns.value=e.map(e=>({timestamp:e.createTime,type:e.serviceType,title:Fs(e.serviceType,e.status),description:e.description||e.reason,operator:e.createdBy,amount:e.price||0,status:e.status,serviceNumber:e.serviceNumber})),Ns.value.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())}catch(e){console.error("加载售后历史失败:",e)}},Fs=(e,t)=>`${{return:"退货申请",exchange:"换货申请",repair:"维修申请",refund:"退款申请"}[e]||"售后申请"} - ${{pending:"已提交",processing:"处理中",resolved:"已解决",closed:"已关闭"}[t]||t}`,Rs=()=>{const e=cs.getOrderStatusHistory(gs);e&&e.length>0?bs.value=e.map(e=>({timestamp:e.timestamp,type:Ls(e.status),icon:Bs(e.status),color:qs(e.status),title:e.title||ui(e.status),description:e.description||`订单状态变更为：${ui(e.status)}`,operator:e.operator||"系统"})):bs.value=[{timestamp:ws.createTime,type:"info",icon:H,color:"#909399",title:"订单创建",description:`订单创建成功，订单号：${ws.orderNumber}`,operator:"系统"}],bs.value.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())},Ls=e=>({pending:"info",pending_approval:"warning",approved:"success",rejected:"danger",pending_shipment:"warning",shipped:"primary",delivered:"success",completed:"success",cancelled:"danger"}[e]||"info"),Bs=e=>({pending:M,pending_approval:M,approved:U,rejected:W,pending_shipment:M,shipped:O,delivered:U,completed:U,cancelled:W}[e]||M),qs=e=>({pending:"#909399",pending_approval:"#e6a23c",approved:"#67c23a",rejected:"#f56c6c",pending_shipment:"#e6a23c",shipped:"#409eff",delivered:"#67c23a",completed:"#67c23a",cancelled:"#f56c6c"}[e]||"#909399"),Ks=l(()=>"pending_transfer"===ws.status&&"normal"===ws.markType&&ws.auditTransferTime&&!ws.isAuditTransferred),Hs=l(()=>["shipped","delivered","completed","abnormal","rejected","rejected_returned"].includes(ws.status)),Ws=l(()=>"pending_approval"===ws.status),Us=l(()=>"pending_approval"===ws.status),Vs=l(()=>"approved"!==ws.auditStatus&&("pending_cancel"!==ws.status&&"cancelled"!==ws.status&&"cancel_failed"!==ws.status&&("pending"!==ws.auditStatus||"normal"!==ws.markType||!ws.isAuditTransferred))),Js=l(()=>"pending"===ws.auditStatus&&"normal"===ws.markType&&ws.isAuditTransferred),Ys=s(!1),Zs=s(0),Qs=l(()=>["shipped","delivered","completed","package_exception","rejected","rejected_returned"].includes(ws.status)&&ws.trackingNumber),Gs=l(()=>ws.products&&0!==ws.products.length?ws.products.reduce((e,t)=>e+t.price*t.quantity,0):0),Xs=l(()=>"normal"===ws.markType&&"pending"===ws.auditStatus&&!ws.isAuditTransferred),ei=l(()=>ws.depositScreenshots&&ws.depositScreenshots.length>0?ws.depositScreenshots:ws.depositScreenshot?[ws.depositScreenshot]:[]),ti=()=>{ae.back()},ai=async()=>{try{const e=await(async e=>await ps.checkExistingAfterSales(e))(ws.id);e?(os.push(`/service/detail/${e.id}`),V.info("该订单已有售后记录，已跳转到售后详情页")):os.push({path:"/service/add",query:{orderId:ws.id,orderNumber:ws.orderNumber,customerId:ws.customer.id,customerName:ws.customer.name,customerPhone:ws.customer.phone}})}catch(e){console.error("检查售后记录失败:",e),os.push({path:"/service/add",query:{orderId:ws.id,orderNumber:ws.orderNumber,customerId:ws.customer.id,customerName:ws.customer.name,customerPhone:ws.customer.phone}})}},si=e=>{if(e===ws.markType)return void V.warning("订单已经是该标记状态");if("reserved"===e&&Xs.value){const t={reserved:"预留单",normal:"正常发货单",return:"退单"};return void J.confirm(`确认将此订单标记为"${t[e]}"？\n注意：修改为预留单后，订单将不会流转到审核，信息将保留在系统中。`,"确认标记",{type:"warning"}).then(()=>{_s.value&&(clearInterval(_s.value),_s.value=null),ws.markType=e,ws.isAuditTransferred=!0;cs.updateOrder(gs,{markType:e,isAuditTransferred:!0})?(V.success(`订单已标记为${t[e]}，信息已保留在系统中`),ms.sendMessage({type:"ORDER_MARKED",title:"订单标记更新",content:`订单 ${ws.orderNumber} 已标记为${t[e]}`,link:`/order/detail/${gs}`,metadata:{orderId:ws.id,orderNumber:ws.orderNumber,markType:e,previousMarkType:"normal"}})):(V.error("更新订单标记失败"),ki())}).catch(()=>{})}if(!Vs.value)return void(Js.value?V.warning("订单正在审核中，无法修改标记。如需修改，请等待审核完成或联系审核员退回订单。"):"approved"===ws.auditStatus?V.warning("订单已审核通过，无法修改标记"):V.warning("当前状态下无法修改订单标记"));const t={reserved:"预留单",normal:"正常发货单",return:"退单"};J.confirm(`确认将此订单标记为"${t[e]}"？`,"确认标记",{type:"warning"}).then(async()=>{try{(await se.updateMarkType(gs,{markType:e})).success?(ws.markType=e,cs.updateOrder(gs,{markType:e}),"return"===e?V.success("订单已标记为退单，信息已保留在系统中"):"normal"===e?V.success("订单已标记为正常发货单"):"reserved"===e?V.success("订单已标记为预留单"):V.success(`订单已标记为${t[e]}`),ms.sendMessage({type:"ORDER_MARKED",title:"订单标记更新",content:`订单 ${ws.orderNumber} 已标记为${t[e]}`,link:`/order/detail/${gs}`,metadata:{orderId:ws.id,orderNumber:ws.orderNumber,markType:e}})):V.error("更新订单标记失败")}catch(a){console.error("更新订单标记失败:",a),V.error("更新订单标记失败，请重试")}}).catch(()=>{})},ii=async()=>{try{await J.confirm("确认审核通过此订单？","审核确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await new Promise(e=>setTimeout(e,1e3)),cs.syncOrderStatus(gs,"pending_shipment","审核员","订单审核通过，等待发货"),ws.status="pending_shipment",ms.sendMessage({type:"ORDER_APPROVED",title:"订单审核通过",content:`订单 ${ws.orderNumber} (客户: ${ws.customer.name}, 金额: ¥${ws.totalAmount?.toLocaleString()}) 已审核通过`,link:`/order/detail/${gs}`,metadata:{orderId:gs,orderNo:ws.orderNumber,customerName:ws.customer.name,totalAmount:ws.totalAmount,auditResult:"approved"}}),V.success("订单审核通过")}catch(e){}},li=async()=>{try{const{value:e}=await J.prompt("请输入拒绝原因","审核拒绝",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"请输入拒绝原因"});await new Promise(e=>setTimeout(e,1e3)),cs.syncOrderStatus(gs,"audit_rejected","审核员",`订单审核拒绝：${e}`),ws.status="audit_rejected",ms.sendMessage({type:"ORDER_REJECTED",title:"订单审核拒绝",content:`订单 ${ws.orderNumber} (客户: ${ws.customer.name}, 金额: ¥${ws.totalAmount?.toLocaleString()}) 已审核拒绝，原因: ${e}`,link:`/order/detail/${gs}`,metadata:{orderId:gs,orderNo:ws.orderNumber,customerName:ws.customer.name,totalAmount:ws.totalAmount,auditResult:"rejected",auditRemark:e}}),V.success("订单已拒绝")}catch(e){}},ri=()=>{window.open(`tel:${ws.customer.phone}`)},di=()=>{console.log("goToCustomerDetail called"),console.log("orderDetail.customer:",ws.customer),console.log("customer id:",ws.customer.id),console.log("跳转路径:",`/customer/detail/${ws.customer.id}`),os.push(`/customer/detail/${ws.customer.id}`)},ni=async()=>{if(ws.trackingNumber){try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(ws.trackingNumber),V.success("物流单号已复制到剪贴板");else{const e=document.createElement("textarea");e.value=ws.trackingNumber,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const t=document.execCommand("copy");if(document.body.removeChild(e),!t)return void V.error("复制失败，请手动复制");V.success("物流单号已复制到剪贴板")}}catch(e){return console.error("复制失败:",e),void V.error("复制失败，请手动复制")}J.confirm("请选择要跳转的查询网站","选择查询网站",{confirmButtonText:"顺丰官网",cancelButtonText:"快递100",distinguishCancelAndClose:!0,type:"info"}).then(()=>{window.open("https://www.sf-express.com/chn/sc/waybill/list","_blank")}).catch(e=>{"cancel"===e&&window.open("https://www.kuaidi100.com/","_blank")})}else V.warning("物流单号不存在")},oi=async()=>{if(!ws.trackingNumber||!ws.expressCompany)return V.warning("缺少快递单号或快递公司信息"),void(Ts.value=[]);try{Is.value=!0;const e=await cs.queryLogisticsTrack(gs);e&&e.tracks&&e.tracks.length>0?(Ts.value=e.tracks.map(e=>({time:e.time,status:e.status,statusText:e.statusText||e.description||e.status,description:e.description||e.statusText||"状态更新",location:e.location||""})),e.estimatedDeliveryTime&&(e=>{try{const t=(e.tracks||[])[0];if(!t)return;const a=new Date;let s=0;const i=t.status||t.statusText||"",l=ws.expressCompany;if(i.includes("已签收")||i.includes("delivered"))return;s=i.includes("派送中")||i.includes("out_for_delivery")?.5:i.includes("到达")||i.includes("arrived")?1:i.includes("运输中")||i.includes("in_transit")?"SF"===l?1:"YTO"===l||"ZTO"===l?2:3:3;const r=new Date(a.getTime()+24*s*60*60*1e3);ws.expectedDeliveryDate=r.toISOString().split("T")[0]}catch(t){console.error("更新预计到达时间失败:",t)}})(e),V.success("物流信息已更新")):(Ts.value=[],V.warning("暂无物流信息，可能是单号未录入系统或查询失败"))}catch(e){console.error("获取物流信息失败:",e),Ts.value=[],V.error("获取物流信息失败，请检查网络连接或稍后重试")}finally{Is.value=!1}},ci=e=>{if(!e)return"info";const t={delivered:"success",out_for_delivery:"primary",in_transit:"primary",picked_up:"info",pending:"info",exception:"warning",rejected:"danger","已签收":"success","已送达":"success","派送中":"primary","运输中":"primary","在途":"primary","已揽收":"info","已发货":"info","待发货":"info","异常":"warning","拒收":"danger","退回":"danger"};return t[e]?t[e]:e.includes("签收")||e.includes("送达")?"success":e.includes("派送")||e.includes("运输")||e.includes("在途")?"primary":e.includes("揽收")||e.includes("发货")?"info":e.includes("异常")||e.includes("问题")?"warning":e.includes("拒收")||e.includes("退回")?"danger":"info"},ui=e=>({pending_transfer:"待流转",pending_audit:"待审核",audit_rejected:"审核拒绝",pending_shipment:"待发货",shipped:"已发货",delivered:"已签收",package_exception:"包裹异常",rejected:"拒收",rejected_returned:"拒收已退回",after_sales_created:"已建售后",cancelled:"已取消",draft:"草稿",pending:"待处理",pending_approval:"待审核",approved:"已审核",paid:"已付款",completed:"已完成",confirmed:"已确认"}[e]||e),mi=e=>{if(!e)return"-";if("other"===e&&ws.paymentMethodOther)return ws.paymentMethodOther;return{wechat:"微信支付",alipay:"支付宝",bank_transfer:"银行转账",unionpay:"云闪付",cod:"货到付款",cash:"现金",card:"刷卡",other:"其他"}[e]||e},pi=e=>({vip:"VIP客户",premium:"高级客户",normal:"普通客户"}[e]||"普通客户"),vi=e=>({sf:"顺丰速运",yt:"圆通速递",zt:"中通快递",st:"申通快递",yd:"韵达速递",bs:"百世快递",db:"德邦快递",jd:"京东物流"}[e]||e),fi=(e,t)=>{if(null==t)return"-";if("select"===e.fieldType||"radio"===e.fieldType){const a=e.options?.find(e=>e.value===t);return a?.label||t}return"checkbox"===e.fieldType&&Array.isArray(t)?t.map(t=>{const a=e.options?.find(e=>e.value===t);return a?.label||t}).join(", "):"date"===e.fieldType||"datetime"===e.fieldType?hi(t):String(t)},yi=e=>({reserved:"预留单",normal:"正常发货单",return:"退单"}[e]||e),gi=()=>{if(!ws.markType)return"default";return{reserved:"warning",normal:"success",return:"danger"}[ws.markType]||"default"},hi=e=>e?new Date(e).toLocaleString("zh-CN"):"",_i=e=>e?new Date(e).toLocaleDateString("zh-CN"):"",ki=async()=>{try{ys.value=!0,0===us.customers.length&&await us.loadCustomers();let t=null;try{console.log("[订单详情] 正在从API加载订单:",gs);const e=await se.getDetail(gs);e.success&&e.data&&(t=e.data,console.log("[订单详情] API加载成功:",t.orderNumber))}catch(e){console.warn("[订单详情] API加载失败，尝试从本地store获取:",e)}if(t||(t=cs.getOrderById(gs)),!t)return V.error("订单不存在"),void os.push("/order/list");const a=us.getCustomerById(t.customerId);Object.assign(ws,{id:t.id,orderNumber:t.orderNumber,status:t.status,auditStatus:t.auditStatus||"pending",markType:t.markType||"normal",createTime:t.createTime,updateTime:t.createTime,auditTransferTime:t.auditTransferTime||"",isAuditTransferred:t.isAuditTransferred||!1,customer:a?{id:a.id,name:a.name,phone:a.phone,wechat:a.wechatId||"",address:a.address,level:a.level,avatar:""}:{id:t.customerId,name:t.customerName,phone:t.customerPhone,wechat:"",address:"",level:"normal",avatar:""},receiverName:t.receiverName,receiverPhone:t.receiverPhone,receiverAddress:t.receiverAddress,expressCompany:t.expressCompany||"",trackingNumber:t.trackingNumber||"",serviceWechat:t.serviceWechat||"",orderSource:t.orderSource||"",expectedShipDate:t.expectedShipDate||"",expectedDeliveryDate:t.expectedDeliveryDate||"",products:t.products,subtotal:t.subtotal,discount:t.discount,totalAmount:t.totalAmount,depositAmount:t.depositAmount,depositScreenshot:t.depositScreenshot||"",depositScreenshots:t.depositScreenshots||[],paymentMethod:t.paymentMethod||"",paymentMethodOther:t.paymentMethodOther||"",remark:t.remark,customFields:t.customFields||{}}),Rs(),zs(),Ps(),ws.trackingNumber&&ws.expressCompany&&oi(),window.addEventListener("operation-log-update",$s),window.addEventListener("order-status-update",Ms),window.addEventListener("logistics-status-update",js),window.addEventListener("after-sales-update",Os),window.addEventListener("service-status-update",Es),wi()}catch(t){V.error("加载订单详情失败"),os.push("/order/list")}finally{ys.value=!1}},wi=()=>{console.log("[倒计时] 初始化倒计时",{markType:ws.markType,status:ws.status,auditStatus:ws.auditStatus,isAuditTransferred:ws.isAuditTransferred,auditTransferTime:ws.auditTransferTime}),_s.value&&(clearInterval(_s.value),_s.value=null),"normal"===ws.markType&&"pending_transfer"===ws.status?ws.isAuditTransferred?console.log("[倒计时] 订单已流转，跳过"):ws.auditTransferTime?(bi(),_s.value=setInterval(bi,1e3),console.log("[倒计时] 倒计时已启动")):console.log("[倒计时] 没有流转时间，无法启动倒计时"):console.log("[倒计时] 不满足倒计时条件，跳过")},bi=()=>{if(!ws.auditTransferTime)return;const e=new Date(ws.auditTransferTime).getTime(),t=Date.now(),a=Math.max(0,e-t);if(console.log("[倒计时] 更新倒计时",{"流转时间字符串":ws.auditTransferTime,"流转时间戳":e,"当前时间戳":t,"剩余毫秒":a,"剩余秒数":Math.floor(a/1e3)}),a<=0)return hs.value=0,ks.value="正在流转...",_s.value&&(clearInterval(_s.value),_s.value=null),void Ti();hs.value=Math.floor(a/1e3);const s=Math.floor(hs.value/60),i=hs.value%60;ks.value=`${s}分${i.toString().padStart(2,"0")}秒`},Ti=()=>{ws.isAuditTransferred=!0,ws.status="pending_audit",ws.auditStatus="pending",cs.updateOrder(gs,{isAuditTransferred:!0,status:"pending_audit",auditStatus:"pending"}),cs.checkAndTransferOrders(),V.info("订单已自动流转到审核"),ms.sendMessage({type:"ORDER_TRANSFERRED",title:"订单流转审核",content:`订单 ${ws.orderNumber} 已自动流转到审核`,link:`/order/detail/${gs}`,metadata:{orderId:ws.id,orderNumber:ws.orderNumber}})};return r(()=>{ki()}),d(()=>{_s.value&&(clearInterval(_s.value),_s.value=null),window.removeEventListener("operation-log-update",$s),window.removeEventListener("order-status-update",Ms),window.removeEventListener("logistics-status-update",js),window.removeEventListener("after-sales-update",Os),window.removeEventListener("service-status-update",Es)}),(e,t)=>{const a=n("el-button"),s=n("el-tooltip"),i=n("el-icon"),l=n("el-dropdown-item"),r=n("el-dropdown-menu"),d=n("el-dropdown"),H=n("el-tag"),V=n("el-avatar"),J=n("el-card"),Z=n("InfoFilled"),Q=n("el-table-column"),G=n("el-table"),X=n("el-image"),te=n("el-image-viewer"),ae=n("el-timeline-item"),se=n("el-timeline"),ie=n("el-empty"),re=n("el-collapse-transition"),ns=n("el-skeleton");return c(),o("div",de,[u("div",ne,[u("div",oe,[p(a,{onClick:ti,icon:v(T),circle:""},null,8,["icon"]),u("div",ce,[t[6]||(t[6]=u("h2",null,"订单详情",-1)),u("div",ue,"订单号："+f(ws.orderNumber),1)])]),u("div",me,[p(s,{content:Hs.value?"点击创建售后服务":"订单需要发货后才能建立售后",placement:"bottom"},{default:g(()=>[p(a,{type:"primary",disabled:!Hs.value,onClick:ai},{default:g(()=>[...t[7]||(t[7]=[h(" 建立售后 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["content"]),p(d,{onCommand:si,class:"mark-dropdown",disabled:!Vs.value},{dropdown:g(()=>[p(r,null,{default:g(()=>[p(l,{command:"reserved",disabled:"reserved"===ws.markType},{default:g(()=>[...t[9]||(t[9]=[h("预留单",-1)])]),_:1},8,["disabled"]),p(l,{command:"normal",disabled:"normal"===ws.markType},{default:g(()=>[...t[10]||(t[10]=[h("正常发货单",-1)])]),_:1},8,["disabled"]),p(l,{command:"return",disabled:"return"===ws.markType},{default:g(()=>[...t[11]||(t[11]=[h("退单",-1)])]),_:1},8,["disabled"])]),_:1})]),default:g(()=>[p(a,{icon:v(x),type:gi(),disabled:!Vs.value},{default:g(()=>[t[8]||(t[8]=h(" 标记 ",-1)),p(i,{class:"el-icon--right"},{default:g(()=>[p(v(N))]),_:1})]),_:1},8,["icon","type","disabled"])]),_:1},8,["disabled"]),!Vs.value&&Js.value?(c(),y(s,{key:0,content:"订单正在审核中，无法修改标记",placement:"top"},{default:g(()=>[p(i,{class:"audit-lock-icon"},{default:g(()=>[p(v(S))]),_:1})]),_:1})):m("",!0),ws.markType?(c(),o("div",pe,[p(H,{type:(os=ws.markType,{reserved:"warning",normal:"success",return:"danger"}[os]||"info"),size:"default",effect:"dark"},{default:g(()=>[h(f(yi(ws.markType)),1)]),_:1},8,["type"])])):m("",!0),Ws.value?(c(),y(a,{key:2,type:"success",onClick:ii},{default:g(()=>[...t[12]||(t[12]=[h("审核通过",-1)])]),_:1})):m("",!0),Us.value?(c(),y(a,{key:3,type:"danger",onClick:li},{default:g(()=>[...t[13]||(t[13]=[h("审核拒绝",-1)])]),_:1})):m("",!0)])]),u("div",ve,[p(J,{class:"customer-info-card modern-card"},{header:g(()=>[u("div",fe,[u("div",ye,[p(i,{class:"header-icon"},{default:g(()=>[p(v(I))]),_:1}),t[14]||(t[14]=u("span",{class:"header-title"},"客户信息",-1))]),u("div",ge,[p(a,{type:"text",size:"small",onClick:di,class:"view-more-btn"},{default:g(()=>[t[15]||(t[15]=h(" 查看更多 ",-1)),p(i,{class:"ml-1"},{default:g(()=>[p(v($))]),_:1})]),_:1})])])]),default:g(()=>{return[u("div",he,[u("div",_e,[u("div",ke,[p(V,{size:64,src:ws.customer.avatar,class:"customer-avatar-modern"},{default:g(()=>[h(f(ws.customer.name.charAt(0)),1)]),_:1},8,["src"]),p(H,{type:(e=ws.customer.level,{vip:"warning",premium:"danger",normal:"info"}[e]||"info"),size:"small",class:"customer-level-tag",effect:"light"},{default:g(()=>[h(f(pi(ws.customer.level)),1)]),_:1},8,["type"])]),u("div",we,[u("div",be,f(ws.customer.name),1),u("div",Te,[u("div",{class:"contact-item-modern phone-item-modern",onClick:ri},[p(i,{class:"contact-icon"},{default:g(()=>[p(v(A))]),_:1}),u("span",xe,f(v(le)(ws.customer.phone,v(ee).PHONE,v(vs).currentUser?.id||"")),1),p(i,{class:"call-icon"},{default:g(()=>[p(v(A))]),_:1})]),u("div",Ne,[p(i,{class:"contact-icon"},{default:g(()=>[p(v(C))]),_:1}),u("span",Se,f(ws.customer.wechat||"未设置微信"),1)]),u("div",Ae,[p(i,{class:"contact-icon"},{default:g(()=>[p(v(D))]),_:1}),u("span",Ce,f(ws.customer.address),1)])])])])])];var e}),_:1})]),u("div",De,[p(J,{class:"modern-card order-status-modern order-status-horizontal"},{default:g(()=>{return[u("div",Ie,[u("div",$e,[p(i,{class:"status-icon"},{default:g(()=>[p(v(M))]),_:1}),t[16]||(t[16]=u("span",{class:"title-text"},"订单状态",-1))]),u("div",Me,[p(H,{type:(e=ws.status,{pending_transfer:"info",pending_audit:"warning",audit_rejected:"danger",pending_shipment:"primary",shipped:"primary",delivered:"success",package_exception:"warning",rejected:"danger",rejected_returned:"info",after_sales_created:"warning",cancelled:"info",draft:"info",pending:"warning",pending_approval:"warning",approved:"success",paid:"success",completed:"success",confirmed:"success"}[e]||"info"),class:"status-tag-modern",effect:"light"},{default:g(()=>[h(f(ui(ws.status)),1)]),_:1},8,["type"]),Ks.value?(c(),o("div",je,[u("div",Oe,[p(i,{class:"countdown-icon"},{default:g(()=>[p(v(j))]),_:1}),u("span",Ee,f(ks.value),1)]),t[17]||(t[17]=u("div",{class:"countdown-tip"},"请在倒计时结束前完成审核",-1))])):m("",!0)])]),u("div",ze,[u("div",Pe,[t[19]||(t[19]=u("div",{class:"timeline-dot"},null,-1)),u("div",Fe,[t[18]||(t[18]=u("div",{class:"timeline-label"},"创建时间",-1)),u("div",Re,f(hi(ws.createTime)),1)])]),u("div",Le,[t[21]||(t[21]=u("div",{class:"timeline-dot"},null,-1)),u("div",Be,[t[20]||(t[20]=u("div",{class:"timeline-label"},"更新时间",-1)),u("div",qe,f(hi(ws.updateTime)),1)])]),Ks.value?(c(),o("div",Ke,[t[24]||(t[24]=u("div",{class:"timeline-dot countdown-dot"},null,-1)),u("div",He,[t[23]||(t[23]=u("div",{class:"timeline-label"},"流转审核倒计时",-1)),u("div",We,[h(f(ks.value)+" ",1),p(H,{type:"warning",size:"small",class:"countdown-badge"},{default:g(()=>[p(i,null,{default:g(()=>[p(v(j))]),_:1}),t[22]||(t[22]=h(" 自动流转中 ",-1))]),_:1})])])])):m("",!0),Xs.value?(c(),o("div",Ue,[p(i,{class:"tip-icon"},{default:g(()=>[p(Z)]),_:1}),t[25]||(t[25]=u("span",{class:"tip-text"},"流转前可修改为预留单，修改后将不会流转到审核",-1))])):m("",!0)])];var e}),_:1})]),u("div",Ve,[p(J,{class:"modern-card delivery-info-card"},{header:g(()=>[u("div",Je,[u("div",Ye,[p(i,{class:"header-icon"},{default:g(()=>[p(v(O))]),_:1}),t[26]||(t[26]=u("span",{class:"header-title"},"收货信息",-1))])])]),default:g(()=>[u("div",Ze,[u("div",Qe,[u("div",Ge,[t[27]||(t[27]=u("div",{class:"field-label-modern"},"收货人",-1)),u("div",Xe,f(ws.receiverName),1)]),u("div",et,[t[28]||(t[28]=u("div",{class:"field-label-modern"},"联系电话",-1)),u("div",{class:"field-value-modern phone-clickable",onClick:t[0]||(t[0]=e=>ri(ws.receiverPhone))},f(v(le)(ws.receiverPhone,v(ee).PHONE)),1)]),u("div",tt,[t[29]||(t[29]=u("div",{class:"field-label-modern"},"收货地址",-1)),u("div",at,f(ws.receiverAddress),1)])])])]),_:1})]),u("div",st,[p(J,{class:"order-info-card modern-card"},{header:g(()=>[u("div",it,[u("div",lt,[p(i,{class:"header-icon"},{default:g(()=>[p(v(z))]),_:1}),t[30]||(t[30]=u("span",{class:"header-title"},"订单信息",-1))])])]),default:g(()=>{return[u("div",rt,[u("div",dt,[u("div",nt,[u("div",ot,[t[31]||(t[31]=u("div",{class:"info-label"},"订单号",-1)),u("div",ct,f(ws.orderNumber),1)]),u("div",ut,[t[32]||(t[32]=u("div",{class:"info-label"},"下单时间",-1)),u("div",mt,f(hi(ws.createTime)),1)]),u("div",pt,[t[33]||(t[33]=u("div",{class:"info-label"},"客服微信",-1)),u("div",vt,f(ws.serviceWechat),1)]),u("div",ft,[t[34]||(t[34]=u("div",{class:"info-label"},"订单来源",-1)),u("div",yt,f((e=ws.orderSource,{online_store:"线上商城",wechat_mini:"微信小程序",wechat_service:"微信客服",phone_call:"电话咨询",offline_store:"线下门店",referral:"客户推荐",advertisement:"广告投放",other:"其他渠道"}[e]||e)),1)]),ws.paymentMethod?(c(),o("div",gt,[t[35]||(t[35]=u("div",{class:"info-label"},"支付方式",-1)),u("div",ht,f(mi(ws.paymentMethod))+f(ws.paymentMethodOther?` (${ws.paymentMethodOther})`:""),1)])):m("",!0),(c(!0),o(_,null,k(v(fs).customFields,e=>(c(),o(_,{key:e.fieldKey},[ws.customFields&&ws.customFields[e.fieldKey]?(c(),o("div",_t,[u("div",kt,f(e.fieldName),1),u("div",wt,f(fi(e,ws.customFields[e.fieldKey])),1)])):m("",!0)],64))),128))])]),u("div",bt,[u("div",Tt,[p(i,null,{default:g(()=>[p(v(O))]),_:1}),t[38]||(t[38]=u("span",null,"物流信息",-1)),"shipped"===ws.status?(c(),y(H,{key:0,type:"success",size:"small",effect:"light",class:"status-indicator"},{default:g(()=>[...t[36]||(t[36]=[h(" 已发货 ",-1)])]),_:1})):"pending_shipment"===ws.status?(c(),y(H,{key:1,type:"warning",size:"small",effect:"light",class:"status-indicator"},{default:g(()=>[...t[37]||(t[37]=[h(" 待发货 ",-1)])]),_:1})):(c(),y(H,{key:2,type:"info",size:"small",effect:"light",class:"status-indicator"},{default:g(()=>[h(f(ui(ws.status)),1)]),_:1}))]),"shipped"===ws.status&&ws.trackingNumber?(c(),o("div",xt,[u("div",Nt,[t[39]||(t[39]=u("div",{class:"logistics-label"},"快递公司",-1)),u("div",St,f(vi(ws.expressCompany)),1)]),u("div",At,[t[41]||(t[41]=u("div",{class:"logistics-label"},"物流单号",-1)),u("div",Ct,[h(f(ws.trackingNumber)+" ",1),p(a,{size:"small",type:"primary",text:"",onClick:ni,class:"track-btn"},{default:g(()=>[p(i,null,{default:g(()=>[p(v(E))]),_:1}),t[40]||(t[40]=h(" 查询 ",-1))]),_:1})])]),u("div",Dt,[t[42]||(t[42]=u("div",{class:"logistics-label"},"预计发货",-1)),u("div",It,f(_i(ws.expectedShipDate)||"已发货"),1)]),u("div",$t,[t[43]||(t[43]=u("div",{class:"logistics-label"},"预计到达",-1)),u("div",Mt,f(_i(ws.expectedDeliveryDate)||"计算中..."),1)])])):(c(),o("div",jt,[u("div",Ot,[t[44]||(t[44]=u("div",{class:"logistics-label"},"预计发货",-1)),u("div",Et,f(_i(ws.expectedShipDate)||"待确定"),1)]),u("div",zt,[t[45]||(t[45]=u("div",{class:"logistics-label"},"预计到达",-1)),u("div",Pt,f(_i(ws.expectedDeliveryDate)||"待确定"),1)]),u("div",Ft,[t[46]||(t[46]=u("div",{class:"logistics-label"},"快递公司",-1)),u("div",Rt,f(vi(ws.expressCompany)||"待确定"),1)]),t[47]||(t[47]=u("div",{class:"logistics-item"},[u("div",{class:"logistics-label"},"物流单号"),u("div",{class:"logistics-value pending-text"},"待发货后生成")],-1))]))]),ws.remark?(c(),o("div",Lt,[u("div",Bt,[p(i,null,{default:g(()=>[p(v(z))]),_:1}),t[48]||(t[48]=u("span",null,"订单备注",-1))]),u("div",qt,f(ws.remark),1)])):m("",!0)])];var e}),_:1})]),u("div",Kt,[p(J,{class:"products-card"},{header:g(()=>[u("div",Ht,[p(i,null,{default:g(()=>[p(v(L))]),_:1}),t[49]||(t[49]=u("span",null,"商品清单",-1))])]),default:g(()=>[u("div",Wt,[p(G,{data:ws.products,style:{width:"100%"}},{default:g(()=>[p(Q,{label:"商品信息","min-width":"200"},{default:g(({row:e})=>[u("div",Ut,[u("div",Vt,[u("img",{src:e.image||"/default-product.png",alt:e.name},null,8,Jt)]),u("div",Yt,[u("div",Zt,f(e.name),1),u("div",Qt,"SKU: "+f(e.sku||e.id),1)])])]),_:1}),p(Q,{prop:"price",label:"单价",width:"100"},{default:g(({row:e})=>[h(" ¥"+f(e.price.toFixed(2)),1)]),_:1}),p(Q,{prop:"quantity",label:"数量",width:"80"}),p(Q,{label:"小计",width:"120"},{default:g(({row:e})=>[h(" ¥"+f((e.price*e.quantity).toFixed(2)),1)]),_:1})]),_:1},8,["data"]),u("div",Gt,[u("div",Xt,[u("div",ea,[u("div",ta,[p(i,null,{default:g(()=>[p(v(P))]),_:1})]),u("div",aa,[t[50]||(t[50]=u("div",{class:"amount-label-modern"},"订单总额",-1)),u("div",sa,"¥"+f((ws.totalAmount||0).toFixed(2)),1)])]),(ws.depositAmount||0)>0?(c(),o("div",ia,[u("div",la,[p(i,null,{default:g(()=>[p(v(F))]),_:1})]),u("div",ra,[t[51]||(t[51]=u("div",{class:"amount-label-modern"},"定金",-1)),u("div",da,"¥"+f((ws.depositAmount||0).toFixed(2)),1)])])):m("",!0),(ws.depositAmount||0)>0?(c(),o("div",na,[u("div",oa,[p(i,null,{default:g(()=>[p(v(R))]),_:1})]),u("div",ca,[t[52]||(t[52]=u("div",{class:"amount-label-modern"},"代收",-1)),u("div",ua,"¥"+f(((ws.totalAmount||0)-(ws.depositAmount||0)).toFixed(2)),1)])])):m("",!0),ws.paymentMethod?(c(),o("div",ma,[u("div",pa,[p(i,null,{default:g(()=>[p(v(F))]),_:1})]),u("div",va,[t[53]||(t[53]=u("div",{class:"amount-label-modern"},"支付方式",-1)),u("div",fa,f(mi(ws.paymentMethod)),1)])])):m("",!0)]),u("div",ya,[u("div",ga,[t[54]||(t[54]=u("span",{class:"detail-label"},"商品总额：",-1)),u("span",ha,"¥"+f(Gs.value.toFixed(2)),1)]),(ws.discount||0)>0?(c(),o("div",_a,[t[55]||(t[55]=u("span",{class:"detail-label"},"优惠金额：",-1)),u("span",ka,"-¥"+f((ws.discount||0).toFixed(2)),1)])):m("",!0),Gs.value>(ws.totalAmount||0)?(c(),o("div",wa,[t[56]||(t[56]=u("span",{class:"detail-label"},"已优惠：",-1)),u("span",ba,"-¥"+f((Gs.value-(ws.totalAmount||0)).toFixed(2)),1)])):m("",!0),ws.paymentMethod?(c(),o("div",Ta,[t[57]||(t[57]=u("span",{class:"detail-label"},"支付方式：",-1)),u("span",xa,f(mi(ws.paymentMethod)),1)])):m("",!0)]),ei.value.length>0?(c(),o("div",Na,[t[58]||(t[58]=u("span",{class:"label"},"定金截图：",-1)),u("div",Sa,[(c(!0),o(_,null,k(ei.value,(e,t)=>(c(),o("div",{key:t,class:"screenshot-container",onClick:e=>(e=>{Zs.value=e,Ys.value=!0})(t)},[p(X,{src:e,fit:"cover",style:{width:"60px",height:"45px","border-radius":"4px","margin-left":"8px"}},null,8,["src"]),u("div",Ca,[p(i,{class:"zoom-icon"},{default:g(()=>[p(v(E))]),_:1})])],8,Aa))),128)),ei.value.length>1?(c(),o("div",Da," 共"+f(ei.value.length)+"张 ",1)):m("",!0)])])):m("",!0),Ys.value?(c(),y(te,{key:1,"url-list":ei.value,"initial-index":Zs.value,onClose:t[1]||(t[1]=e=>Ys.value=!1)},null,8,["url-list","initial-index"])):m("",!0)])])]),_:1})]),u("div",Ia,[p(J,{class:"logistics-card"},{header:g(()=>[u("div",$a,[p(i,null,{default:g(()=>[p(v(O))]),_:1}),t[60]||(t[60]=u("span",null,"物流信息跟踪",-1)),p(a,{size:"small",onClick:oi},{default:g(()=>[...t[59]||(t[59]=[h("刷新",-1)])]),_:1})])]),default:g(()=>[u("div",Ma,[Ts.value.length>0?(c(),y(se,{key:0},{default:g(()=>[(c(!0),o(_,null,k(Ts.value,(e,t)=>(c(),y(ae,{key:t,timestamp:e.time,type:ci(e.statusText),placement:"top"},{default:g(()=>[u("div",ja,[u("div",Oa,[p(H,{type:ci(e.statusText)},{default:g(()=>[h(f(e.statusText||e.status),1)]),_:2},1032,["type"])]),u("div",Ea,f(e.description),1),e.location?(c(),o("div",za,[p(i,null,{default:g(()=>[p(v(D))]),_:1}),h(" "+f(e.location),1)])):m("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(c(),y(ie,{key:1,description:"暂无物流信息"}))])]),_:1})]),u("div",Pa,[p(J,{class:"operation-log-card"},{header:g(()=>[u("div",Fa,[p(i,null,{default:g(()=>[p(v(B))]),_:1}),t[61]||(t[61]=u("span",null,"操作记录",-1)),p(a,{size:"small",type:"text",onClick:t[2]||(t[2]=e=>Ss.value=!Ss.value),icon:Ss.value?v(N):v(q)},{default:g(()=>[h(f(Ss.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),default:g(()=>[p(re,null,{default:g(()=>[w(u("div",null,[p(G,{data:xs.value,style:{width:"100%"}},{default:g(()=>[p(Q,{prop:"time",label:"操作时间",width:"180"},{default:g(({row:e})=>[h(f(hi(e.time)),1)]),_:1}),p(Q,{prop:"operator",label:"操作人",width:"120"}),p(Q,{prop:"action",label:"操作类型",width:"120"}),p(Q,{prop:"description",label:"操作描述"}),p(Q,{prop:"remark",label:"备注",width:"200"})]),_:1},8,["data"])],512),[[b,!Ss.value]])]),_:1})]),_:1})]),u("div",Ra,[p(J,{class:"status-timeline-card"},{header:g(()=>[u("div",La,[p(i,null,{default:g(()=>[p(v(M))]),_:1}),t[62]||(t[62]=u("span",null,"订单状态和轨迹",-1)),p(a,{size:"small",type:"text",onClick:t[3]||(t[3]=e=>As.value=!As.value),icon:As.value?v(N):v(q)},{default:g(()=>[h(f(As.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),default:g(()=>[p(re,null,{default:g(()=>[w(u("div",null,[p(se,null,{default:g(()=>[(c(!0),o(_,null,k(bs.value,(e,t)=>(c(),y(ae,{key:t,timestamp:e.timestamp,type:e.type,icon:e.icon,color:e.color},{default:g(()=>[u("div",Ba,[u("div",qa,f(e.title),1),u("div",Ka,f(e.description),1),e.operator?(c(),o("div",Ha,"操作人："+f(e.operator),1)):m("",!0)])]),_:2},1032,["timestamp","type","icon","color"]))),128))]),_:1})],512),[[b,!As.value]])]),_:1})]),_:1})]),Qs.value?(c(),o("div",Wa,[p(J,{class:"logistics-track-card"},{header:g(()=>[u("div",Ua,[p(i,null,{default:g(()=>[p(v(O))]),_:1}),t[63]||(t[63]=u("span",null,"物流轨迹",-1)),u("div",Va,[ws.expressCompany?(c(),y(H,{key:0,type:"info",size:"small"},{default:g(()=>[h(f(ws.expressCompany),1)]),_:1})):m("",!0),ws.trackingNumber?(c(),o("span",Ja,f(ws.trackingNumber),1)):m("",!0)]),p(a,{size:"small",type:"text",onClick:t[4]||(t[4]=e=>Ds.value=!Ds.value),icon:Ds.value?v(N):v(q)},{default:g(()=>[h(f(Ds.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),default:g(()=>[p(re,null,{default:g(()=>[w(u("div",null,[Is.value?(c(),o("div",Ya,[p(ns,{rows:3,animated:""})])):Ts.value.length>0?(c(),y(se,{key:1},{default:g(()=>[(c(!0),o(_,null,k(Ts.value,(e,t)=>{return c(),y(ae,{key:t,timestamp:e.time,type:ci(e.status),icon:(a=e.status,{delivered:U,out_for_delivery:O,in_transit:O,picked_up:O,pending:M,exception:Y,rejected:W}[a]||M)},{default:g(()=>[u("div",Za,[u("div",Qa,f(e.statusText),1),u("div",Ga,f(e.description),1),e.location?(c(),o("div",Xa,[p(i,null,{default:g(()=>[p(v(D))]),_:1}),h(" "+f(e.location),1)])):m("",!0)])]),_:2},1032,["timestamp","type","icon"]);var a}),128))]),_:1})):(c(),y(ie,{key:2,description:"暂无物流信息"})),u("div",es,[p(a,{size:"small",type:"primary",loading:Is.value,onClick:oi},{default:g(()=>[...t[64]||(t[64]=[h(" 刷新物流信息 ",-1)])]),_:1},8,["loading"])])],512),[[b,!Ds.value]])]),_:1})]),_:1})])):m("",!0),u("div",ts,[p(J,{class:"after-sales-card"},{header:g(()=>[u("div",as,[p(i,null,{default:g(()=>[p(v(K))]),_:1}),t[65]||(t[65]=u("span",null,"售后历史轨迹",-1)),p(a,{size:"small",type:"text",onClick:t[5]||(t[5]=e=>Cs.value=!Cs.value),icon:Cs.value?v(N):v(q)},{default:g(()=>[h(f(Cs.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),default:g(()=>[p(re,null,{default:g(()=>[w(u("div",null,[Ns.value.length>0?(c(),y(se,{key:0},{default:g(()=>[(c(!0),o(_,null,k(Ns.value,(e,t)=>{return c(),y(ae,{key:t,timestamp:e.timestamp,type:(a=e.type,{refund:"warning",return:"danger",exchange:"primary",repair:"info",complaint:"danger"}[a]||"info")},{default:g(()=>[u("div",ss,[u("div",is,f(e.title),1),u("div",ls,f(e.description),1),e.operator?(c(),o("div",rs,"处理人："+f(e.operator),1)):m("",!0),e.amount?(c(),o("div",ds,"金额：¥"+f(e.amount.toFixed(2)),1)):m("",!0)])]),_:2},1032,["timestamp","type"]);var a}),128))]),_:1})):(c(),y(ie,{key:1,description:"暂无售后记录"}))],512),[[b,!Cs.value]])]),_:1})]),_:1})])]);var os}}}),[["__scopeId","data-v-6e259b09"]]);export{ns as default};
