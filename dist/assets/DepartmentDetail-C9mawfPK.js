import{l as a,aC as e,aA as s,r as l,e as t,w as i,b as c,ag as n,aq as r,m as d,q as o,p as u,Q as m,U as v,O as p,S as f,u as h,T as g,F as y,a9 as _,M as b,P as w}from"./vendor-BtukhyiH.js";import{c as k,_ as D}from"./index-DkAJPKqn.js";import{E as C,L as z,Q as I,u as j,K as N,U as x,au as A,ah as S,aN as M,l as B,s as $,aM as L,a2 as P,C as T,Y as U,A as V,b as q}from"./elementPlus-DxaqjplL.js";import{useDepartmentStore as E}from"./department-DPqzaatc.js";import{D as Q}from"./DepartmentDialog-fDfd_Rre.js";import"./utils-DfI7e5Rl.js";import"./departmentPermissionService-BriqDnjF.js";const F={class:"department-detail-container"},K={class:"page-header"},O={class:"header-left"},Y={class:"title-section"},G={class:"page-title"},H={class:"department-meta"},J={class:"level-info"},R={class:"header-actions"},W={class:"info-section"},X={class:"info-card"},Z={class:"card-header"},aa={class:"info-grid"},ea={class:"info-item"},sa={class:"value"},la={class:"info-item"},ta={class:"value"},ia={class:"info-item"},ca={class:"value"},na={class:"info-item"},ra={class:"value"},da={class:"info-item"},oa={class:"value"},ua={class:"info-item"},ma={class:"info-item"},va={class:"value"},pa={class:"info-item"},fa={class:"value"},ha={key:0,class:"description-section"},ga={class:"description-text"},ya={class:"stats-card"},_a={class:"card-header"},ba={class:"stats-list"},wa={class:"stat-item"},ka={class:"stat-icon members"},Da={class:"stat-content"},Ca={class:"stat-number"},za={class:"stat-item"},Ia={class:"stat-icon children"},ja={class:"stat-content"},Na={class:"stat-number"},xa={class:"stat-item"},Aa={class:"stat-icon permissions"},Sa={class:"stat-content"},Ma={class:"stat-number"},Ba={key:0,class:"manager-section"},$a={class:"section-card"},La={class:"card-header"},Pa={class:"manager-info"},Ta={class:"manager-details"},Ua={class:"manager-name"},Va={class:"manager-id"},qa={class:"manager-actions"},Ea={class:"permissions-section"},Qa={class:"section-card"},Fa={class:"card-header"},Ka={class:"permissions-grid"},Oa={class:"category-header"},Ya={class:"category-name"},Ga={class:"permission-list"},Ha={key:1,class:"children-section"},Ja={class:"section-card"},Ra={class:"card-header"},Wa={class:"children-list"},Xa=["onClick"],Za={class:"child-info"},ae={class:"child-details"},ee={class:"child-name"},se={class:"child-code"},le={class:"child-stats"},te={class:"member-count"},ie={class:"members-section"},ce={class:"section-card"},ne={class:"card-header"},re={class:"header-actions-inline"},de={class:"member-name-cell"},oe={key:0,class:"empty-members"},ue=D(a({__name:"DepartmentDetail",setup(a){const D=e(),ue=s(),me=k(ue),ve=E(),pe=l(D.params.id),fe=l(!1),he=l(!1),ge=l([]),ye=t(()=>ve.getDepartmentById(pe.value)),_e=t(()=>{if(!ye.value?.parentId)return null;const a=ve.getDepartmentById(ye.value.parentId);return a?.name}),be=t(()=>ve.departmentList.filter(a=>a.parentId===pe.value)),we=t(()=>{if(!ye.value?.permissions)return{};const a={};return ye.value.permissions.forEach(e=>{const[s]=e.split(":");a[s]||(a[s]=[]),a[s].push(e)}),a}),ke=()=>{me.push("/system/departments")},De=()=>{fe.value=!0},Ce=()=>{me.push(`/system/department/members/${pe.value}`)},ze=()=>{fe.value=!1,C.success("部门信息已更新")},Ie=async()=>{he.value=!0;try{console.log("[DepartmentDetail] 加载部门成员，部门ID:",pe.value),console.log("[DepartmentDetail] 当前部门信息:",ye.value);const a=ve.getDepartmentMembers(pe.value);console.log("[DepartmentDetail] 获取到的成员数:",a.length),console.log("[DepartmentDetail] 成员列表:",a),ge.value=a}catch(a){console.error("加载部门成员失败:",a),C.error("加载部门成员失败")}finally{he.value=!1}},je=()=>{me.push(`/system/department/members/${pe.value}`)},Ne=a=>a?new Date(a).toLocaleString("zh-CN"):"-",xe=a=>({customer:"客户管理",order:"订单管理",finance:"财务管理",logistics:"物流管理",service:"客服管理",performance:"绩效管理",system:"系统管理",all:"全部权限"}[a]||a),Ae=a=>({"customer:read":"查看客户","customer:write":"编辑客户","customer:delete":"删除客户","order:read":"查看订单","order:write":"编辑订单","order:audit":"审核订单","order:delete":"删除订单","finance:read":"查看财务","finance:write":"编辑财务","logistics:read":"查看物流","logistics:write":"编辑物流","service:read":"查看客服","service:write":"编辑客服","performance:read":"查看绩效","performance:write":"编辑绩效","system:read":"查看系统","system:write":"编辑系统",all:"全部权限"}[a]||a);return i(()=>D.params.id,a=>{a&&(pe.value=a,Ie())},{immediate:!0}),c(()=>{ye.value?Ie():(C.error("部门不存在"),me.push("/system/departments"))}),(a,e)=>{const s=n("el-button"),l=n("el-tag"),t=n("el-icon"),i=n("el-col"),c=n("el-row"),k=n("el-avatar"),D=n("el-table-column"),E=n("el-table"),ue=n("el-empty"),Se=r("loading");return o(),d("div",F,[u("div",K,[u("div",O,[v(s,{icon:h(z),onClick:ke,class:"back-btn"},{default:p(()=>[...e[1]||(e[1]=[f("返回",-1)])]),_:1},8,["icon"]),u("div",Y,[u("h2",G,g(ye.value?.name),1),u("div",H,[v(l,{type:"primary",size:"small"},{default:p(()=>[f(g(ye.value?.code),1)]),_:1}),u("span",J,g(ye.value?.level)+"级部门",1),v(l,{type:"active"===ye.value?.status?"success":"danger",size:"small"},{default:p(()=>[f(g("active"===ye.value?.status?"活跃":"停用"),1)]),_:1},8,["type"])])])]),u("div",R,[v(s,{type:"primary",icon:h(I),onClick:De,class:"edit-btn"},{default:p(()=>[...e[2]||(e[2]=[f(" 编辑部门 ",-1)])]),_:1},8,["icon"]),v(s,{type:"success",icon:h(j),onClick:Ce,class:"members-btn"},{default:p(()=>[...e[3]||(e[3]=[f(" 成员管理 ",-1)])]),_:1},8,["icon"])])]),u("div",W,[v(c,{gutter:24},{default:p(()=>[v(i,{span:16},{default:p(()=>[u("div",X,[u("div",Z,[e[4]||(e[4]=u("h3",null,"基本信息",-1)),v(t,{class:"header-icon"},{default:p(()=>[v(h(N))]),_:1})]),u("div",aa,[u("div",ea,[e[5]||(e[5]=u("span",{class:"label"},"部门名称",-1)),u("span",sa,g(ye.value?.name),1)]),u("div",la,[e[6]||(e[6]=u("span",{class:"label"},"部门编码",-1)),u("span",ta,g(ye.value?.code),1)]),u("div",ia,[e[7]||(e[7]=u("span",{class:"label"},"部门层级",-1)),u("span",ca,g(ye.value?.level)+"级",1)]),u("div",na,[e[8]||(e[8]=u("span",{class:"label"},"排序位置",-1)),u("span",ra,"第"+g(ye.value?.sort)+"位",1)]),u("div",da,[e[9]||(e[9]=u("span",{class:"label"},"上级部门",-1)),u("span",oa,g(_e.value||"无（顶级部门）"),1)]),u("div",ua,[e[10]||(e[10]=u("span",{class:"label"},"部门状态",-1)),v(l,{type:"active"===ye.value?.status?"success":"danger",size:"small"},{default:p(()=>[f(g("active"===ye.value?.status?"活跃":"停用"),1)]),_:1},8,["type"])]),u("div",ma,[e[11]||(e[11]=u("span",{class:"label"},"创建时间",-1)),u("span",va,g(Ne(ye.value?.createdAt)),1)]),u("div",pa,[e[12]||(e[12]=u("span",{class:"label"},"更新时间",-1)),u("span",fa,g(Ne(ye.value?.updatedAt)),1)])]),ye.value?.description?(o(),d("div",ha,[e[13]||(e[13]=u("h4",null,"部门描述",-1)),u("p",ga,g(ye.value.description),1)])):m("",!0)])]),_:1}),v(i,{span:8},{default:p(()=>[u("div",ya,[u("div",_a,[e[14]||(e[14]=u("h3",null,"统计信息",-1)),v(t,{class:"header-icon"},{default:p(()=>[v(h(x))]),_:1})]),u("div",ba,[u("div",wa,[u("div",ka,[v(t,null,{default:p(()=>[v(h(j))]),_:1})]),u("div",Da,[u("div",Ca,g(ye.value?.memberCount||0),1),e[15]||(e[15]=u("div",{class:"stat-label"},"部门成员",-1))])]),u("div",za,[u("div",Ia,[v(t,null,{default:p(()=>[v(h(A))]),_:1})]),u("div",ja,[u("div",Na,g(be.value.length),1),e[16]||(e[16]=u("div",{class:"stat-label"},"子部门",-1))])]),u("div",xa,[u("div",Aa,[v(t,null,{default:p(()=>[v(h(S))]),_:1})]),u("div",Sa,[u("div",Ma,g(ye.value?.permissions?.length||0),1),e[17]||(e[17]=u("div",{class:"stat-label"},"权限数量",-1))])])])])]),_:1})]),_:1})]),ye.value?.managerId?(o(),d("div",Ba,[u("div",$a,[u("div",La,[e[18]||(e[18]=u("h3",null,"部门负责人",-1)),v(t,{class:"header-icon"},{default:p(()=>[v(h(M))]),_:1})]),u("div",Pa,[v(k,{size:60,class:"manager-avatar"},{default:p(()=>[f(g(ye.value.managerName?.charAt(0)),1)]),_:1}),u("div",Ta,[u("div",Ua,g(ye.value.managerName),1),u("div",Va,"用户ID: "+g(ye.value.managerId),1),e[19]||(e[19]=u("div",{class:"manager-role"},"部门负责人",-1))]),u("div",qa,[v(s,{size:"small",type:"primary",link:""},{default:p(()=>[...e[20]||(e[20]=[f(" 查看详情 ",-1)])]),_:1}),v(s,{size:"small",type:"primary",link:""},{default:p(()=>[...e[21]||(e[21]=[f(" 发送消息 ",-1)])]),_:1})])])])])):m("",!0),u("div",Ea,[u("div",Qa,[u("div",Fa,[e[22]||(e[22]=u("h3",null,"部门权限",-1)),v(t,{class:"header-icon"},{default:p(()=>[v(h(B))]),_:1})]),u("div",Ka,[(o(!0),d(y,null,_(we.value,(a,e)=>(o(),d("div",{key:e,class:"permission-category"},[u("div",Oa,[v(t,{class:"category-icon"},{default:p(()=>[v(h($))]),_:1}),u("span",Ya,g(xe(e)),1)]),u("div",Ga,[(o(!0),d(y,null,_(a,a=>(o(),b(l,{key:a,type:"info",size:"small",class:"permission-tag"},{default:p(()=>[f(g(Ae(a)),1)]),_:2},1024))),128))])]))),128))])])]),be.value.length>0?(o(),d("div",Ha,[u("div",Ja,[u("div",Ra,[e[23]||(e[23]=u("h3",null,"子部门",-1)),v(t,{class:"header-icon"},{default:p(()=>[v(h(L))]),_:1})]),u("div",Wa,[(o(!0),d(y,null,_(be.value,a=>(o(),d("div",{key:a.id,class:"child-item",onClick:e=>(a=>{me.push(`/system/department/detail/${a.id}`)})(a)},[u("div",Za,[v(t,{class:"child-icon"},{default:p(()=>[v(h(A))]),_:1}),u("div",ae,[u("div",ee,g(a.name),1),u("div",se,g(a.code),1)])]),u("div",le,[u("span",te,g(a.memberCount)+"人",1),v(l,{type:"active"===a.status?"success":"danger",size:"small"},{default:p(()=>[f(g("active"===a.status?"活跃":"停用"),1)]),_:2},1032,["type"])]),v(t,{class:"arrow-icon"},{default:p(()=>[v(h(P))]),_:1})],8,Xa))),128))])])])):m("",!0),u("div",ie,[u("div",ce,[u("div",ne,[e[25]||(e[25]=u("h3",null,"部门成员",-1)),u("div",re,[v(s,{type:"primary",size:"small",icon:h(T),onClick:je},{default:p(()=>[...e[24]||(e[24]=[f(" 添加成员 ",-1)])]),_:1},8,["icon"])])]),w((o(),b(E,{data:ge.value,style:{width:"100%"}},{default:p(()=>[v(D,{type:"index",label:"序号",width:"60"}),v(D,{prop:"userName",label:"姓名",width:"180"},{default:p(({row:a})=>[u("div",de,[v(k,{size:32,class:"member-avatar"},{default:p(()=>[f(g(a.userName?.charAt(0)),1)]),_:2},1024),u("span",null,g(a.userName),1),ye.value?.managerId&&String(a.userId)===String(ye.value.managerId)?(o(),b(l,{key:0,type:"warning",size:"small",class:"manager-badge"},{default:p(()=>[...e[26]||(e[26]=[f(" 负责人 ",-1)])]),_:1})):m("",!0)])]),_:1}),v(D,{prop:"position",label:"职位",width:"150"}),v(D,{prop:"userId",label:"用户ID",width:"200"}),v(D,{prop:"joinDate",label:"加入时间",width:"180"},{default:p(({row:a})=>[f(g(Ne(a.joinDate)),1)]),_:1}),v(D,{prop:"status",label:"状态",width:"100"},{default:p(({row:a})=>[v(l,{type:"active"===a.status?"success":"danger",size:"small"},{default:p(()=>[f(g("active"===a.status?"在职":"离职"),1)]),_:2},1032,["type"])]),_:1}),v(D,{label:"操作",width:"250",fixed:"right"},{default:p(({row:a})=>[v(s,{type:"primary",link:"",size:"small",onClick:a=>{C.info("编辑成员功能开发中")}},{default:p(()=>[v(t,null,{default:p(()=>[v(h(I))]),_:1}),e[27]||(e[27]=f(" 编辑 ",-1))]),_:1},8,["onClick"]),v(s,{type:"warning",link:"",size:"small",onClick:a=>{C.info("移动成员功能开发中")}},{default:p(()=>[v(t,null,{default:p(()=>[v(h(U))]),_:1}),e[28]||(e[28]=f(" 移动 ",-1))]),_:1},8,["onClick"]),v(s,{type:"danger",link:"",size:"small",onClick:e=>(async a=>{try{await q.confirm(`确定要将 ${a.userName} 从该部门移除吗？`,"确认移除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ve.removeDepartmentMember(pe.value,a.userId),C.success("成员已移除"),Ie()}catch(e){"cancel"!==e&&(console.error("移除成员失败:",e),C.error("移除成员失败"))}})(a)},{default:p(()=>[v(t,null,{default:p(()=>[v(h(V))]),_:1}),e[29]||(e[29]=f(" 移除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Se,he.value]]),0!==ge.value.length||he.value?m("",!0):(o(),d("div",oe,[v(ue,{description:"暂无成员数据"})]))])]),v(Q,{modelValue:fe.value,"onUpdate:modelValue":e[0]||(e[0]=a=>fe.value=a),department:ye.value,"is-edit":!0,onSuccess:ze},null,8,["modelValue","department"])])}}}),[["__scopeId","data-v-627cd677"]]);export{ue as default};
