const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/uploadService-C3xZb1GB.js","assets/index-DkAJPKqn.js","assets/vendor-BtukhyiH.js","assets/elementPlus-DxaqjplL.js","assets/utils-DfI7e5Rl.js","assets/index-Cj-RrGL6.css"])))=>i.map(i=>d[i]);
import{x as e,l as a,c as t,_ as l}from"./index-DkAJPKqn.js";import{l as i,aA as o,aC as r,r as s,e as d,Z as n,b as c,ag as u,m,q as p,p as g,U as f,u as b,T as h,Q as _,O as y,S as V}from"./vendor-BtukhyiH.js";import{L as w,C as v,E as k,b as P}from"./elementPlus-DxaqjplL.js";import{u as x}from"./product-BDuYhoXd.js";import"./utils-DfI7e5Rl.js";import"./env-DLalhsF6.js";const S={class:"product-edit"},I={class:"page-header"},U={class:"header-left"},T={class:"header-info"},N={class:"header-meta"},O={key:0,class:"product-code"},E={class:"form-content"},q={class:"profit-info"},j={class:"image-upload-section"},A={class:"upload-tip"},D={class:"tips-content"},B={class:"form-footer"},C={class:"footer-actions"},R=l(i({__name:"Edit",setup(l){const i=o(),R=r(),$=t(i),G=x(),H=e(),K=s(!1),z=s(),F=d(()=>!!R.params.id),L=n({id:"",code:"",name:"",categoryId:[],brand:"",specification:"",unit:"",weight:0,dimensions:"",description:"",price:0,costPrice:0,marketPrice:0,stock:0,minStock:0,maxStock:0,status:"active",isRecommended:!1,isNew:!1,isHot:!1,seoTitle:"",seoKeywords:"",seoDescription:"",mainImage:"",images:[]}),M=s([]),J=d(()=>(G.categories||[]).map(e=>({value:e.id,label:e.name,children:e.children?.map(e=>({value:e.id,label:e.name}))||[]}))),Z={value:"value",label:"label",children:"children",emitPath:!1},Q=e=>{if(!e)return"未分类";for(const a of G.categories||[]){if(a.id===e)return a.name;if(a.children)for(const t of a.children)if(t.id===e)return t.name}return"未分类"},W={name:[{required:!0,message:"请输入商品名称",trigger:"blur"},{min:2,max:100,message:"商品名称长度在 2 到 100 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入商品编码",trigger:"blur"},{pattern:/^[A-Z0-9]{3,20}$/,message:"商品编码只能包含大写字母和数字，长度3-20位",trigger:"blur"}],categoryId:[{required:!0,message:"请选择商品分类",trigger:"change"}],unit:[{required:!0,message:"请选择商品单位",trigger:"change"}],price:[{required:!0,message:"请输入销售价格",trigger:"blur"},{type:"number",min:.01,message:"销售价格必须大于0",trigger:"blur"}],costPrice:[{type:"number",min:0,message:"成本价格不能小于0",trigger:"blur"}],stock:[{required:!0,message:"请输入当前库存",trigger:"blur"},{type:"number",min:0,message:"库存不能小于0",trigger:"blur"}],minStock:[{type:"number",min:0,message:"最低库存不能小于0",trigger:"blur"}],maxStock:[{type:"number",min:0,message:"最高库存不能小于0",trigger:"blur"}]},X=()=>{i.back()},Y=()=>{const e=Date.now().toString().slice(-8),a=Math.random().toString(36).substring(2,6).toUpperCase();L.code=`P${e}${a}`},ee=()=>{if(0===L.costPrice)return"0.00";return((L.price-L.costPrice)/L.costPrice*100).toFixed(2)},ae=e=>{const a="image/jpeg"===e.type||"image/png"===e.type,t=e.size/1024/1024<2;return a?!!t||(k.error("图片大小不能超过 2MB!"),!1):(k.error("只能上传 JPG/PNG 格式的图片!"),!1)},te=async(e,t)=>{if(e.raw)try{const{uploadImage:l}=await a(async()=>{const{uploadImage:e}=await import("./uploadService-C3xZb1GB.js");return{uploadImage:e}},__vite__mapDeps([0,1,2,3,4,5])),i=await l(e.raw,"product");if(!i.success||!i.url){const a=t.indexOf(e);return a>-1&&t.splice(a,1),void k.error(i.message||"图片上传失败")}e.url=i.url,k.success("图片上传成功")}catch(i){console.error("图片上传失败:",i);const a=t.indexOf(e);return a>-1&&t.splice(a,1),void k.error("图片上传失败，请重试")}const l=t.filter(e=>e.url&&!e.url.startsWith("data:")).map(e=>e.url);L.images=l,l.length>0&&(L.mainImage=l[0])},le=(e,a)=>{const t=a.filter(e=>e.url).map(e=>e.url);L.images=t,t.length>0?L.mainImage=t[0]:L.mainImage=""},ie=async()=>{try{await P.confirm("确定要取消吗？未保存的数据将丢失！","确认取消",{confirmButtonText:"确定",cancelButtonText:"继续编辑",type:"warning"}),X()}catch(e){}},oe=async()=>{try{if(!(await(z.value?.validate())))return void k.error("请完善商品信息");if(L.minStock>L.maxStock)return void k.error("最低库存不能大于最高库存");if(L.costPrice>L.price)try{await P.confirm("成本价格高于销售价格，确定要保存吗？","价格提醒",{confirmButtonText:"确定保存",cancelButtonText:"重新设置",type:"warning"})}catch(e){return}K.value=!0,await new Promise(e=>setTimeout(e,1500));const a=!F.value;if(a){const e=G.addProduct({code:L.code,name:L.name,categoryId:L.categoryId,categoryName:Q(L.categoryId),brand:L.brand,specification:L.specification,unit:L.unit,weight:L.weight,dimensions:L.dimensions,description:L.description,price:L.price,costPrice:L.costPrice,marketPrice:L.marketPrice,stock:L.stock,minStock:L.minStock,maxStock:L.maxStock,salesCount:0,status:L.status,image:L.mainImage||"/src/assets/images/product-placeholder.svg",images:Array.isArray(L.images)?L.images:[]});e&&e.id&&(L.id=e.id.toString())}else G.updateProduct(L.id,{code:L.code,name:L.name,categoryId:L.categoryId,categoryName:Q(L.categoryId),brand:L.brand,specification:L.specification,unit:L.unit,weight:L.weight,dimensions:L.dimensions,description:L.description,price:L.price,costPrice:L.costPrice,marketPrice:L.marketPrice,stock:L.stock,minStock:L.minStock,maxStock:L.maxStock,status:L.status,image:L.mainImage||"/src/assets/images/product-placeholder.svg",images:Array.isArray(L.images)?L.images:[]});k.success(F.value?"商品更新成功":"商品创建成功"),setTimeout(()=>{if(a){const e=R.path;H.removeTab(e),$.push({path:"/product/list",query:{refresh:"true"}})}else $.push(`/product/detail/${L.id}`)},1e3)}catch(e){console.error("保存商品失败:",e),k.error("保存失败，请检查网络连接或稍后重试")}finally{K.value=!1}};return c(()=>{F.value?(async()=>{if(F.value)try{const e=R.params.id;if(!e)return k.error("商品ID不存在"),void $.push("/product/list");await new Promise(e=>setTimeout(e,800));let a=G.getProductById(e);a||isNaN(Number(e))||(a=G.getProductById(Number(e))),a?(Object.assign(L,{id:a.id,code:a.code,name:a.name,categoryId:a.categoryId,categoryName:a.categoryName,brand:a.brand,specification:a.specification,unit:a.unit,weight:a.weight,dimensions:a.dimensions,description:a.description,price:a.price,costPrice:a.costPrice,marketPrice:a.marketPrice,stock:a.stock,minStock:a.minStock,maxStock:a.maxStock,status:a.status,isRecommended:!1,isNew:!1,isHot:!1,seoTitle:"",seoKeywords:"",seoDescription:"",mainImage:a.image,images:a.images||[]}),M.value=(a.images||[]).map((e,a)=>({uid:Date.now()+a,name:`image-${a+1}`,status:"done",url:e}))):(k.error("商品不存在"),$.push("/product/list"))}catch(e){k.error("加载商品信息失败")}})():R.query.copy?(async()=>{if(R.query.copy)try{await new Promise(e=>setTimeout(e,500)),Object.assign(L,{name:"iPhone 15 Pro (复制)",categoryId:"1-1",brand:"Apple",specification:"256GB 深空黑色",unit:"台",weight:.187,dimensions:"146.6×70.6×7.8",description:"iPhone 15 Pro 采用钛金属设计，搭载 A17 Pro 芯片，配备专业级摄像头系统，支持 5G 网络。",price:8999,costPrice:7200,marketPrice:9999,stock:0,minStock:10,maxStock:200,status:"inactive",isRecommended:!1,isNew:!1,isHot:!1,seoTitle:"",seoKeywords:"",seoDescription:"",images:[]}),Y(),k.success("商品信息已复制，请修改后保存")}catch(e){k.error("复制商品信息失败")}})():Y()}),(e,a)=>{const t=u("el-button"),l=u("el-input"),i=u("el-form-item"),o=u("el-col"),r=u("el-row"),s=u("el-cascader"),d=u("el-option"),n=u("el-select"),c=u("el-input-number"),k=u("el-card"),P=u("el-alert"),x=u("el-icon"),R=u("el-upload"),$=u("el-radio"),G=u("el-radio-group"),H=u("el-switch"),Q=u("el-form");return p(),m("div",S,[g("div",I,[g("div",U,[f(t,{onClick:X,icon:b(w),circle:""},null,8,["icon"]),g("div",T,[g("h2",null,h(F.value?"编辑商品":"新增商品"),1),g("div",N,[F.value?(p(),m("span",O,"商品编码："+h(L.code),1)):_("",!0)])])])]),g("div",E,[f(Q,{ref_key:"productFormRef",ref:z,model:L,rules:W,"label-width":"120px",size:"default"},{default:y(()=>[f(r,{gutter:20},{default:y(()=>[f(o,{span:16},{default:y(()=>[f(k,{class:"form-card",title:"基本信息"},{header:y(()=>[...a[23]||(a[23]=[g("span",null,"基本信息",-1)])]),default:y(()=>[f(r,{gutter:20},{default:y(()=>[f(o,{span:12},{default:y(()=>[f(i,{label:"商品名称",prop:"name"},{default:y(()=>[f(l,{modelValue:L.name,"onUpdate:modelValue":a[0]||(a[0]=e=>L.name=e),placeholder:"请输入商品名称",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),f(o,{span:12},{default:y(()=>[f(i,{label:"商品编码",prop:"code"},{default:y(()=>[f(l,{modelValue:L.code,"onUpdate:modelValue":a[1]||(a[1]=e=>L.code=e),placeholder:"请输入商品编码",disabled:F.value},{append:y(()=>[f(t,{onClick:Y,disabled:F.value},{default:y(()=>[...a[24]||(a[24]=[V(" 生成 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),f(r,{gutter:20},{default:y(()=>[f(o,{span:12},{default:y(()=>[f(i,{label:"商品分类",prop:"categoryId"},{default:y(()=>[f(s,{modelValue:L.categoryId,"onUpdate:modelValue":a[2]||(a[2]=e=>L.categoryId=e),options:J.value,props:Z,placeholder:"请选择商品分类",style:{width:"100%"},clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1}),f(o,{span:12},{default:y(()=>[f(i,{label:"商品品牌",prop:"brand"},{default:y(()=>[f(l,{modelValue:L.brand,"onUpdate:modelValue":a[3]||(a[3]=e=>L.brand=e),placeholder:"请输入商品品牌"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),f(r,{gutter:20},{default:y(()=>[f(o,{span:12},{default:y(()=>[f(i,{label:"商品规格",prop:"specification"},{default:y(()=>[f(l,{modelValue:L.specification,"onUpdate:modelValue":a[4]||(a[4]=e=>L.specification=e),placeholder:"请输入商品规格"},null,8,["modelValue"])]),_:1})]),_:1}),f(o,{span:12},{default:y(()=>[f(i,{label:"商品单位",prop:"unit"},{default:y(()=>[f(n,{modelValue:L.unit,"onUpdate:modelValue":a[5]||(a[5]=e=>L.unit=e),placeholder:"请选择商品单位",style:{width:"100%"}},{default:y(()=>[f(d,{label:"件",value:"件"}),f(d,{label:"台",value:"台"}),f(d,{label:"个",value:"个"}),f(d,{label:"盒",value:"盒"}),f(d,{label:"包",value:"包"}),f(d,{label:"瓶",value:"瓶"}),f(d,{label:"袋",value:"袋"}),f(d,{label:"套",value:"套"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),f(r,{gutter:20},{default:y(()=>[f(o,{span:12},{default:y(()=>[f(i,{label:"商品重量",prop:"weight"},{default:y(()=>[f(c,{modelValue:L.weight,"onUpdate:modelValue":a[6]||(a[6]=e=>L.weight=e),precision:3,step:.1,min:0,style:{width:"100%"}},null,8,["modelValue"]),a[25]||(a[25]=g("span",{class:"unit-text"},"kg",-1))]),_:1})]),_:1}),f(o,{span:12},{default:y(()=>[f(i,{label:"商品尺寸",prop:"dimensions"},{default:y(()=>[f(l,{modelValue:L.dimensions,"onUpdate:modelValue":a[7]||(a[7]=e=>L.dimensions=e),placeholder:"长×宽×高 (cm)"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),f(i,{label:"商品描述",prop:"description"},{default:y(()=>[f(l,{modelValue:L.description,"onUpdate:modelValue":a[8]||(a[8]=e=>L.description=e),type:"textarea",rows:4,placeholder:"请输入商品描述",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),f(k,{class:"form-card",title:"价格库存"},{header:y(()=>[...a[26]||(a[26]=[g("span",null,"价格库存",-1)])]),default:y(()=>[f(r,{gutter:20},{default:y(()=>[f(o,{span:12},{default:y(()=>[f(i,{label:"销售价格",prop:"price"},{default:y(()=>[f(c,{modelValue:L.price,"onUpdate:modelValue":a[9]||(a[9]=e=>L.price=e),precision:2,step:.01,min:0,style:{width:"100%"}},null,8,["modelValue"]),a[27]||(a[27]=g("span",{class:"unit-text"},"元",-1))]),_:1})]),_:1}),f(o,{span:12},{default:y(()=>[f(i,{label:"成本价格",prop:"costPrice"},{default:y(()=>[f(c,{modelValue:L.costPrice,"onUpdate:modelValue":a[10]||(a[10]=e=>L.costPrice=e),precision:2,step:.01,min:0,style:{width:"100%"}},null,8,["modelValue"]),a[28]||(a[28]=g("span",{class:"unit-text"},"元",-1))]),_:1})]),_:1})]),_:1}),f(r,{gutter:20},{default:y(()=>[f(o,{span:12},{default:y(()=>[f(i,{label:"市场价格",prop:"marketPrice"},{default:y(()=>[f(c,{modelValue:L.marketPrice,"onUpdate:modelValue":a[11]||(a[11]=e=>L.marketPrice=e),precision:2,step:.01,min:0,style:{width:"100%"}},null,8,["modelValue"]),a[29]||(a[29]=g("span",{class:"unit-text"},"元",-1))]),_:1})]),_:1}),f(o,{span:12},{default:y(()=>[f(i,{label:"当前库存",prop:"stock"},{default:y(()=>[f(c,{modelValue:L.stock,"onUpdate:modelValue":a[12]||(a[12]=e=>L.stock=e),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),f(r,{gutter:20},{default:y(()=>[f(o,{span:12},{default:y(()=>[f(i,{label:"最低库存",prop:"minStock"},{default:y(()=>[f(c,{modelValue:L.minStock,"onUpdate:modelValue":a[13]||(a[13]=e=>L.minStock=e),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),f(o,{span:12},{default:y(()=>[f(i,{label:"最高库存",prop:"maxStock"},{default:y(()=>[f(c,{modelValue:L.maxStock,"onUpdate:modelValue":a[14]||(a[14]=e=>L.maxStock=e),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),g("div",q,[f(P,{title:`预计利润：¥${(L.price-L.costPrice).toFixed(2)} (${ee()}%)`,type:"info",closable:!1,"show-icon":""},null,8,["title"])])]),_:1}),f(k,{class:"form-card",title:"商品图片"},{header:y(()=>[...a[30]||(a[30]=[g("span",null,"商品图片",-1)])]),default:y(()=>[g("div",j,[g("div",A,[f(P,{title:"图片要求：支持 JPG、PNG 格式，单张图片不超过 2MB，建议尺寸 800x800px",type:"info",closable:!1})]),f(R,{"file-list":M.value,"onUpdate:fileList":a[15]||(a[15]=e=>M.value=e),action:"#","list-type":"picture-card","auto-upload":!1,"on-change":te,"on-remove":le,"before-upload":ae,multiple:"",limit:5},{tip:y(()=>[...a[31]||(a[31]=[g("div",{class:"el-upload__tip"}," 最多上传5张图片，第一张为主图 ",-1)])]),default:y(()=>[f(x,null,{default:y(()=>[f(b(v))]),_:1})]),_:1},8,["file-list"])])]),_:1})]),_:1}),f(o,{span:8},{default:y(()=>[f(k,{class:"form-card",title:"商品状态"},{header:y(()=>[...a[32]||(a[32]=[g("span",null,"商品状态",-1)])]),default:y(()=>[f(i,{label:"商品状态",prop:"status"},{default:y(()=>[f(G,{modelValue:L.status,"onUpdate:modelValue":a[16]||(a[16]=e=>L.status=e)},{default:y(()=>[f($,{label:"active"},{default:y(()=>[...a[33]||(a[33]=[V("上架",-1)])]),_:1}),f($,{label:"inactive"},{default:y(()=>[...a[34]||(a[34]=[V("下架",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),f(i,{label:"是否推荐",prop:"isRecommended"},{default:y(()=>[f(H,{modelValue:L.isRecommended,"onUpdate:modelValue":a[17]||(a[17]=e=>L.isRecommended=e),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),f(i,{label:"是否新品",prop:"isNew"},{default:y(()=>[f(H,{modelValue:L.isNew,"onUpdate:modelValue":a[18]||(a[18]=e=>L.isNew=e),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),f(i,{label:"是否热销",prop:"isHot"},{default:y(()=>[f(H,{modelValue:L.isHot,"onUpdate:modelValue":a[19]||(a[19]=e=>L.isHot=e),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})]),_:1}),f(k,{class:"form-card",title:"SEO设置"},{header:y(()=>[...a[35]||(a[35]=[g("span",null,"SEO设置",-1)])]),default:y(()=>[f(i,{label:"SEO标题",prop:"seoTitle"},{default:y(()=>[f(l,{modelValue:L.seoTitle,"onUpdate:modelValue":a[20]||(a[20]=e=>L.seoTitle=e),placeholder:"请输入SEO标题",maxlength:"60","show-word-limit":""},null,8,["modelValue"])]),_:1}),f(i,{label:"SEO关键词",prop:"seoKeywords"},{default:y(()=>[f(l,{modelValue:L.seoKeywords,"onUpdate:modelValue":a[21]||(a[21]=e=>L.seoKeywords=e),placeholder:"请输入SEO关键词，用逗号分隔"},null,8,["modelValue"])]),_:1}),f(i,{label:"SEO描述",prop:"seoDescription"},{default:y(()=>[f(l,{modelValue:L.seoDescription,"onUpdate:modelValue":a[22]||(a[22]=e=>L.seoDescription=e),type:"textarea",rows:3,placeholder:"请输入SEO描述",maxlength:"160","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),f(k,{class:"form-card",title:"操作提示"},{header:y(()=>[...a[36]||(a[36]=[g("span",null,"操作提示",-1)])]),default:y(()=>[g("div",D,[f(P,{title:"保存提示",type:"warning",closable:!1,"show-icon":""},{default:y(()=>[...a[37]||(a[37]=[g("ul",null,[g("li",null,"商品编码一旦保存不可修改"),g("li",null,"价格变动会影响现有订单"),g("li",null,"库存调整请谨慎操作"),g("li",null,"图片建议使用高清图片")],-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),g("div",B,[g("div",C,[f(t,{onClick:ie,size:"large"},{default:y(()=>[...a[38]||(a[38]=[V("取消",-1)])]),_:1}),f(t,{onClick:oe,type:"primary",size:"large",loading:K.value},{default:y(()=>[...a[39]||(a[39]=[V(" 保存 ",-1)])]),_:1},8,["loading"])])])])}}}),[["__scopeId","data-v-db87f7ba"]]);export{R as default};
