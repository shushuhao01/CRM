var P=(ge,oe,E)=>new Promise((R,K)=>{var T=V=>{try{z(E.next(V))}catch(I){K(I)}},p=V=>{try{z(E.throw(V))}catch(I){K(I)}},z=V=>V.done?R(V.value):Promise.resolve(V.value).then(T,p);z((E=E.apply(ge,oe)).next())});import{l as Dt,az as $t,aC as Ot,r as g,Z as Q,e as Y,w as Ve,c as Ut,ag as u,m as J,p as N,q as n,U as a,M as Pe,Q as Te,O as l,S as i,u as D,T as k,F as xe,a9 as Et,J as Rt,af as F}from"./vendor-D8Vxqhr-.js";import{i as zt,u as It,n as Nt,p as De,w as Ft,a1 as Bt,at as At,s as qt,r as $e,T as Mt,b as U,E as m}from"./elementPlus-Bmwh7Rh8.js";import{i as Lt,g as jt,c as Ht,_ as Gt}from"./settings-CuxbDWOu.js";import{u as Qt}from"./product-DLyzXkG9.js";import{D as Yt}from"./DynamicTable-CiyMIP8-.js";import"./utils-ywHRn0uI.js";const Jt={class:"product-list"},Kt={class:"page-header"},Wt={class:"header-actions"},Zt={class:"stats-section"},Xt={class:"stat-content"},ea={class:"stat-icon primary-icon"},ta={class:"stat-info"},aa={class:"stat-number primary-number"},la={class:"stat-content"},oa={class:"stat-icon warning-icon"},sa={class:"stat-info"},na={class:"stat-number warning-number"},ia={class:"stat-content"},ra={class:"stat-icon danger-icon"},da={class:"stat-info"},ua={class:"stat-number danger-number"},ca={class:"price-range-wrapper"},pa={class:"table-header"},ma={class:"header-left"},fa={class:"status-tabs"},ga={class:"header-right"},va={class:"price"},ya={class:"action-buttons"},ba={key:1,class:"deleted-actions"},_a={class:"pagination-container"},ka={class:"table-count"},Ca={class:"dialog-footer"},wa={key:0},ha={class:"dialog-footer"},Sa={class:"category-management"},Va={class:"category-actions"},Pa={class:"dialog-footer"},Ta=Dt({__name:"List",setup(ge){const oe=$t(),E=Ot(),R=Ht(oe),K=Lt(),T=jt(),p=Qt(),z=g(!1),V=g(!1),I=g(!1),Oe=g(),W=g(!1),Z=g(!1),X=g(!1),M=g(!1),ee=g("add"),d=Q({name:"",code:"",categoryId:"",status:"",stockStatus:"",minPrice:null,maxPrice:null}),B=g("all"),C=Q({currentPage:1,pageSize:20,total:0}),ve=g([]),v=g([]),w=g(null),se=g(!1),ne=g([]),ie=g(0),y=Q({type:"increase",quantity:0,reason:"",remark:""}),f=Q({originalPrice:0,newPrice:0,reason:"",remark:""}),Ue=Y(()=>p.categories.map(t=>({id:t.id,name:t.name}))),ye=g([]),r=Q({name:"",code:"",sort:0,status:"active",description:""}),Ee={type:[{required:!0,message:"请选择调整类型",trigger:"change"}],quantity:[{required:!0,message:"请输入调整数量",trigger:"blur"}],reason:[{required:!0,message:"请选择调整原因",trigger:"change"}]},Re={newPrice:[{required:!0,message:"请输入新价格",trigger:"blur"},{type:"number",min:.01,message:"价格必须大于0",trigger:"blur"}],reason:[{required:!0,message:"请选择改价原因",trigger:"change"}]},ze={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],code:[{required:!0,message:"请输入分类编码",trigger:"blur"}],sort:[{required:!0,message:"请输入排序",trigger:"blur"}]},re=g(),de=g(),ue=g(),Ie=Y(()=>p.stats.totalProducts),Ne=Y(()=>p.stats.lowStockCount),Fe=Y(()=>p.stats.outOfStockCount),Be=Y(()=>[{prop:"image",label:"商品图片",width:100,visible:!0,sortable:!1,showOverflowTooltip:!1},{prop:"code",label:"商品编码",width:120,visible:!0,sortable:!0,showOverflowTooltip:!0},{prop:"name",label:"商品名称",minWidth:200,visible:!0,sortable:!0,showOverflowTooltip:!0},{prop:"categoryName",label:"分类",width:120,visible:!0,sortable:!0,showOverflowTooltip:!0},{prop:"specification",label:"规格",width:120,visible:!0,sortable:!1,showOverflowTooltip:!0},{prop:"price",label:"价格",width:120,visible:!0,sortable:!0,showOverflowTooltip:!1},{prop:"stock",label:"库存",width:100,visible:!0,sortable:!0,showOverflowTooltip:!1},{prop:"salesCount",label:"销量",width:100,visible:!0,sortable:!0,showOverflowTooltip:!1},{prop:"status",label:"状态",width:100,visible:!0,sortable:!1,showOverflowTooltip:!1},{prop:"createTime",label:"创建时间",width:180,visible:!0,sortable:!0,showOverflowTooltip:!0}]),Ae=(t,e)=>{const s=K.productConfig.lowStockThreshold;return t===0?"stock-out":t<=s?"stock-warning":"stock-normal"},qe=t=>({active:"success",inactive:"info",out_of_stock:"danger"})[t]||"",Me=t=>({active:"上架",inactive:"下架",out_of_stock:"缺货"})[t]||t,be=()=>{C.currentPage=1,h()},Le=()=>{Object.assign(d,{name:"",code:"",categoryId:"",status:"",stockStatus:"",minPrice:null,maxPrice:null}),be()},je=t=>{v.value=t},He=({column:t,prop:e,order:s})=>{console.log("排序变化:",{column:t,prop:e,order:s}),s?(searchParams.sortField=e,searchParams.sortOrder=s==="ascending"?"asc":"desc"):(searchParams.sortField="",searchParams.sortOrder=""),h()},_e=t=>{C.pageSize=t,h()},ke=t=>{C.currentPage=t,h()},Ge=t=>{ne.value=[t],ie.value=0,se.value=!0},Qe=()=>{se.value=!1,ne.value=[],ie.value=0},Ye=({row:t})=>t.deleted?"deleted-row":"",Je=()=>{R.push("/product/add")},Ce=t=>{R.push(`/product/detail/${t.id}`)},Ke=t=>{R.push(`/product/edit/${t.id}`)},We=t=>{w.value=t,Object.assign(y,{type:"increase",quantity:0,reason:"",remark:""}),W.value=!0},Ze=t=>{w.value=t,Object.assign(f,{originalPrice:t.price,newPrice:t.price,reason:"",remark:""}),X.value=!0},Xe=(t,e)=>{switch(t){case"copy":et(e);break;case"toggle":we(e);break;case"delete":tt(e);break}},et=t=>{R.push(`/product/add?copy=${t.id}`)},we=t=>P(this,null,function*(){const e=t.status==="active"?"下架":"上架";try{yield U.confirm(`确定要${e}商品"${t.name}"吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield new Promise(s=>setTimeout(s,500)),t.status=t.status==="active"?"inactive":"active",m.success(`${e}成功`),T.addNotification({type:"PRODUCT_STATUS_CHANGED",title:`商品${e}`,content:`商品"${t.name}"已${e}`,data:{productId:t.id,productName:t.name,productCode:t.code,status:t.status,action:e,timestamp:new Date().toISOString()},link:`/product/detail/${t.id}`})}catch(s){}}),tt=t=>P(this,null,function*(){try{if(yield U.confirm(`确定要删除商品"${t.name}"吗？删除后不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),p.deleteProduct(t.id))m.success("删除成功");else{m.error("删除失败");return}T.addNotification({type:"PRODUCT_DELETED",title:"商品删除",content:`商品"${t.name}"已删除`,data:{productId:t.id,productName:t.name,productCode:t.code,timestamp:new Date().toISOString()},link:"/product/list"}),h()}catch(e){}}),at=()=>P(this,null,function*(){try{yield U.confirm(`确定要删除选中的 ${v.value.length} 个商品吗？删除后不可恢复！`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),v.value.forEach(t=>{p.deleteProduct(t.id)}),yield new Promise(t=>setTimeout(t,500)),m.success("批量删除成功"),T.addNotification({type:"PRODUCT_BATCH_DELETED",title:"批量删除商品",content:`已批量删除 ${v.value.length} 个商品`,data:{count:v.value.length,productNames:v.value.map(t=>t.name),timestamp:new Date().toISOString()},link:"/product/list"}),h()}catch(t){}}),lt=t=>P(this,null,function*(){try{if(yield U.confirm(`确定要恢复商品"${t.name}"吗？`,"确认恢复",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),p.restoreProduct(t.id))m.success("恢复成功");else{m.error("恢复失败");return}T.addNotification({type:"PRODUCT_RESTORED",title:"商品恢复",content:`商品"${t.name}"已恢复`,data:{productId:t.id,productName:t.name,productCode:t.code,timestamp:new Date().toISOString()},link:`/product/detail/${t.id}`}),h()}catch(e){}}),ot=t=>P(this,null,function*(){try{if(yield U.confirm(`确定要彻底删除商品"${t.name}"吗？彻底删除后将无法恢复，且不会在任何列表中显示！`,"确认彻底删除",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error",dangerouslyUseHTMLString:!0,message:`<div style="color: #f56c6c; font-weight: bold;">⚠️ 警告：此操作不可逆！</div><br/>确定要彻底删除商品"${t.name}"吗？<br/><br/>彻底删除后：<br/>• 商品将从所有列表中移除<br/>• 无法通过任何方式恢复<br/>• 相关数据将被永久清除`}),p.permanentDeleteProduct(t.id))m.success("彻底删除成功");else{m.error("彻底删除失败");return}T.addNotification({type:"PRODUCT_PERMANENT_DELETED",title:"商品彻底删除",content:`商品"${t.name}"已彻底删除`,data:{productId:t.id,productName:t.name,productCode:t.code,timestamp:new Date().toISOString()},link:"/product/list"}),h()}catch(e){}}),st=()=>P(this,null,function*(){try{const{value:t}=yield U({title:"批量状态更新",message:F("div",[F("p",{style:"margin-bottom: 10px;"},`确定要批量更新选中的 ${v.value.length} 个商品的状态吗？`),F("div",{style:"margin-bottom: 10px;"},[F("label",{style:"display: block; margin-bottom: 5px;"},"请选择状态："),F("select",{id:"status-select",style:"width: 100%; padding: 8px; border: 1px solid #dcdfe6; border-radius: 4px;",onChange:s=>{const b=s.target;U.inputValue=b.value}},[F("option",{value:"active"},"上架"),F("option",{value:"inactive"},"下架")])])]),showInput:!0,inputValue:"active",confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:(s,b,x)=>{if(s==="confirm"){const $=document.getElementById("status-select");$&&(b.inputValue=$.value)}x()}});v.value.forEach(s=>{p.updateProduct(s.id,{status:t})}),yield new Promise(s=>setTimeout(s,500)),m.success("批量状态更新成功");const e=t==="active"?"上架":"下架";T.addNotification({type:"PRODUCT_BATCH_STATUS_CHANGED",title:"批量状态更新",content:`已批量${e} ${v.value.length} 个商品`,data:{count:v.value.length,status:t,statusText:e,productNames:v.value.map(s=>s.name),timestamp:new Date().toISOString()},link:"/product/list"}),h()}catch(t){}}),nt=()=>{m.info("批量库存调整功能开发中...")},it=()=>{fe(),Z.value=!0},rt=()=>{m.info("批量导入功能开发中...")},dt=()=>{m.info("数据导出功能开发中...")},L=t=>{switch(B.value=t,d.status="",d.stockStatus="",d.showDeleted=!1,d.onlyDeleted=!1,t){case"all":d.showDeleted=!0;break;case"active":d.status="active";break;case"inactive":d.status="inactive";break;case"deleted":d.onlyDeleted=!0;break;case"low_stock":d.stockStatus="warning";break;case"out_of_stock":d.stockStatus="out_of_stock";break}C.currentPage=1,h()},ut=()=>{h(),m.success("数据已刷新")},ct=()=>P(this,null,function*(){try{yield U.confirm(`确定要将选中的 ${v.value.length} 个商品设为推荐商品吗？`,"确认批量推荐",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),yield new Promise(t=>setTimeout(t,1e3)),m.success("批量推荐设置成功"),T.addNotification({type:"PRODUCT_BATCH_RECOMMENDED",title:"批量推荐设置",content:`已将 ${v.value.length} 个商品设为推荐商品`,data:{count:v.value.length,productNames:v.value.map(t=>t.name),timestamp:new Date().toISOString()},link:"/product/list"}),h()}catch(t){}}),pt=()=>P(this,null,function*(){var t;try{yield(t=re.value)==null?void 0:t.validate(),V.value=!0,yield new Promise(O=>setTimeout(O,1e3));const e=w.value,s=e.stock,b=y.quantity,x=y.type==="increase"?s+b:s-b,$=Math.max(0,x);p.updateProduct(e.id,{stock:$}),m.success("库存调整成功");const A=y.type==="increase"?"增加":"减少";T.addNotification({type:"PRODUCT_STOCK_ADJUSTED",title:"库存调整",content:`商品"${w.value.name}"库存已${A} ${y.quantity} 件`,data:{productId:w.value.id,productName:w.value.name,productCode:w.value.code,adjustType:A,quantity:y.quantity,reason:y.reason,remark:y.remark,timestamp:new Date().toISOString()},link:`/product/detail/${w.value.id}`}),ce(),h()}catch(e){console.error("表单验证失败:",e)}finally{V.value=!1}}),ce=()=>{var t;W.value=!1,(t=re.value)==null||t.clearValidate(),w.value=null},mt=()=>P(this,null,function*(){var t;try{yield(t=de.value)==null?void 0:t.validate(),V.value=!0,yield new Promise(A=>setTimeout(A,1e3));const e=w.value,s=e.price,b=f.newPrice;p.updateProduct(e.id,{price:b}),m.success("改价成功");const x=b-s,$=x>0?"上调":"下调";T.addNotification({type:"PRODUCT_PRICE_CHANGED",title:"商品改价",content:`商品"${e.name}"价格已${$}，从¥${s.toFixed(2)}调整为¥${b.toFixed(2)}`,data:{productId:e.id,productName:e.name,productCode:e.code,oldPrice:s,newPrice:b,priceChange:x,changeType:$,reason:f.reason,remark:f.remark,timestamp:new Date().toISOString()},link:`/product/detail/${e.id}`}),pe(),h()}catch(e){console.error("表单验证失败:",e)}finally{V.value=!1}}),pe=()=>{var t;X.value=!1,(t=de.value)==null||t.clearValidate(),w.value=null},ft=()=>{ee.value="add",Object.assign(r,{name:"",code:"",sort:0,status:"active",description:""}),M.value=!0},gt=t=>{ee.value="edit",Object.assign(r,{id:t.id,name:t.name,code:t.code,sort:t.sort,status:t.status,description:t.description}),M.value=!0},vt=t=>P(this,null,function*(){if(t.productCount>0){m.warning("该分类下还有商品，无法删除");return}try{yield U.confirm(`确定要删除分类"${t.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield p.deleteCategory(t.id),m.success("删除成功"),T.addNotification({type:"PRODUCT_CATEGORY_DELETED",title:"分类删除",content:`商品分类"${t.name}"已删除`,data:{categoryId:t.id,categoryName:t.name,categoryCode:t.code,timestamp:new Date().toISOString()},link:"/product/list"}),yield fe()}catch(e){e!=="cancel"&&(console.error("删除分类失败:",e),m.error("删除失败，请重试"))}}),yt=()=>P(this,null,function*(){var t;try{yield(t=ue.value)==null?void 0:t.validate(),I.value=!0;const e=ee.value==="add";e?yield p.addCategory({name:r.name,code:r.code,level:1,parentId:"0",sort:r.sort,status:r.status==="active"?1:0,description:r.description,productCount:0}):yield p.updateCategory(r.id,{name:r.name,code:r.code,sort:r.sort,status:r.status==="active"?1:0,description:r.description}),m.success(e?"添加成功":"更新成功"),T.addNotification({type:e?"PRODUCT_CATEGORY_CREATED":"PRODUCT_CATEGORY_UPDATED",title:e?"分类添加":"分类更新",content:`商品分类"${r.name}"已${e?"添加":"更新"}`,data:{categoryId:r.id,categoryName:r.name,categoryCode:r.code,action:e?"添加":"更新",timestamp:new Date().toISOString()},link:"/product/list"}),me(),yield fe()}catch(e){console.error("操作失败:",e),m.error("操作失败，请重试")}finally{I.value=!1}}),bt=()=>{Z.value=!1},me=()=>{var t;M.value=!1,(t=ue.value)==null||t.clearValidate()},h=()=>P(this,null,function*(){z.value=!0;try{yield new Promise(x=>setTimeout(x,300)),p.setSearchForm(d);const t=p.getFilteredProducts,e=(C.currentPage-1)*C.pageSize,s=e+C.pageSize,b=t.slice(e,s);ve.value=b,C.total=t.length}catch(t){m.error("加载数据失败")}finally{z.value=!1}}),fe=()=>P(this,null,function*(){try{yield p.loadCategories(),ye.value=p.categories.map(t=>{const e=p.products.filter(s=>s.categoryId===t.id).length;return{id:t.id,name:t.name,code:t.code,sort:t.sort||1,productCount:e,status:t.status===1?"active":"inactive",description:t.description||t.name}})}catch(t){console.error("加载分类列表失败:",t),m.error("加载分类列表失败")}}),_t=t=>{console.log("列设置变化:",t)};return Ve(()=>E.path,(t,e)=>{t==="/product/list"&&e&&e!=="/product/list"&&(console.log("路由变化，刷新商品列表数据",{newPath:t,oldPath:e}),h())},{immediate:!1}),Ve(()=>E.query,(t,e)=>{E.path==="/product/list"&&t.refresh==="true"&&(console.log("检测到刷新参数，重新加载数据"),h(),R.replace({path:"/product/list"}))},{immediate:!1}),Ut(()=>{p.products.length===0&&p.initMockData(),h()}),(t,e)=>{const s=u("el-button"),b=u("el-icon"),x=u("el-card"),$=u("el-col"),A=u("el-row"),O=u("el-input"),c=u("el-form-item"),_=u("el-option"),j=u("el-select"),H=u("el-input-number"),te=u("el-form"),kt=u("el-button-group"),Ct=u("el-divider"),wt=u("el-image"),ht=u("el-link"),ae=u("el-tag"),he=u("el-dropdown-item"),St=u("el-dropdown-menu"),Vt=u("el-dropdown"),Pt=u("el-pagination"),G=u("el-radio"),Se=u("el-radio-group"),le=u("el-dialog"),q=u("el-table-column"),Tt=u("el-table"),xt=u("el-image-viewer");return N(),J("div",Jt,[n("div",Kt,[e[34]||(e[34]=n("div",{class:"header-left"},[n("h2",null,"商品管理")],-1)),n("div",Wt,[a(s,{onClick:it,icon:D(zt)},{default:l(()=>[...e[30]||(e[30]=[i(" 分类管理 ",-1)])]),_:1},8,["icon"]),a(s,{onClick:rt,icon:D(It)},{default:l(()=>[...e[31]||(e[31]=[i(" 批量导入 ",-1)])]),_:1},8,["icon"]),a(s,{onClick:dt,icon:D(Nt)},{default:l(()=>[...e[32]||(e[32]=[i(" 导出数据 ",-1)])]),_:1},8,["icon"]),a(s,{onClick:Je,type:"primary",icon:D(De)},{default:l(()=>[...e[33]||(e[33]=[i(" 添加商品 ",-1)])]),_:1},8,["icon"])])]),n("div",Zt,[a(A,{gutter:20},{default:l(()=>[a($,{span:8},{default:l(()=>[a(x,{class:"stat-card primary-stat",shadow:"hover"},{default:l(()=>[n("div",Xt,[n("div",ea,[a(b,null,{default:l(()=>[a(D(Ft))]),_:1})]),n("div",ta,[n("div",aa,k(Ie.value),1),e[35]||(e[35]=n("div",{class:"stat-title"},"总商品数",-1)),e[36]||(e[36]=n("div",{class:"stat-desc"},"当前系统中的商品总数量",-1))])])]),_:1})]),_:1}),a($,{span:8},{default:l(()=>[a(x,{class:"stat-card warning-stat",shadow:"hover"},{default:l(()=>[n("div",la,[n("div",oa,[a(b,null,{default:l(()=>[a(D(Bt))]),_:1})]),n("div",sa,[n("div",na,k(Ne.value),1),e[37]||(e[37]=n("div",{class:"stat-title"},"库存预警",-1)),e[38]||(e[38]=n("div",{class:"stat-desc"},"库存低于预警线的商品",-1))])])]),_:1})]),_:1}),a($,{span:8},{default:l(()=>[a(x,{class:"stat-card danger-stat",shadow:"hover"},{default:l(()=>[n("div",ia,[n("div",ra,[a(b,null,{default:l(()=>[a(D(At))]),_:1})]),n("div",da,[n("div",ua,k(Fe.value),1),e[39]||(e[39]=n("div",{class:"stat-title"},"缺货商品",-1)),e[40]||(e[40]=n("div",{class:"stat-desc"},"当前库存为零的商品",-1))])])]),_:1})]),_:1})]),_:1})]),a(x,{class:"search-card"},{default:l(()=>[a(te,{model:d,inline:""},{default:l(()=>[a(c,{label:"商品名称"},{default:l(()=>[a(O,{modelValue:d.name,"onUpdate:modelValue":e[0]||(e[0]=o=>d.name=o),placeholder:"请输入商品名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a(c,{label:"商品编码"},{default:l(()=>[a(O,{modelValue:d.code,"onUpdate:modelValue":e[1]||(e[1]=o=>d.code=o),placeholder:"请输入商品编码",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a(c,{label:"商品分类"},{default:l(()=>[a(j,{modelValue:d.categoryId,"onUpdate:modelValue":e[2]||(e[2]=o=>d.categoryId=o),placeholder:"请选择分类",clearable:"",style:{width:"200px"}},{default:l(()=>[(N(!0),J(xe,null,Et(Ue.value,o=>(N(),Pe(_,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"商品状态"},{default:l(()=>[a(j,{modelValue:d.status,"onUpdate:modelValue":e[3]||(e[3]=o=>d.status=o),placeholder:"请选择状态",clearable:"",style:{width:"150px"}},{default:l(()=>[a(_,{label:"上架",value:"active"}),a(_,{label:"下架",value:"inactive"}),a(_,{label:"缺货",value:"out_of_stock"})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"库存状态"},{default:l(()=>[a(j,{modelValue:d.stockStatus,"onUpdate:modelValue":e[4]||(e[4]=o=>d.stockStatus=o),placeholder:"请选择库存状态",clearable:"",style:{width:"150px"}},{default:l(()=>[a(_,{label:"正常",value:"normal"}),a(_,{label:"预警",value:"warning"}),a(_,{label:"缺货",value:"out_of_stock"})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"价格范围",class:"price-range-item"},{default:l(()=>[n("div",ca,[a(H,{modelValue:d.minPrice,"onUpdate:modelValue":e[5]||(e[5]=o=>d.minPrice=o),placeholder:"最低价",min:0,precision:2,style:{width:"160px"},"controls-position":"right"},null,8,["modelValue"]),e[41]||(e[41]=n("span",{class:"price-separator"},"至",-1)),a(H,{modelValue:d.maxPrice,"onUpdate:modelValue":e[6]||(e[6]=o=>d.maxPrice=o),placeholder:"最高价",min:0,precision:2,style:{width:"160px"},"controls-position":"right"},null,8,["modelValue"])])]),_:1}),a(c,null,{default:l(()=>[a(s,{onClick:be,type:"primary",icon:D(qt)},{default:l(()=>[...e[42]||(e[42]=[i(" 搜索 ",-1)])]),_:1},8,["icon"]),a(s,{onClick:Le,icon:D($e)},{default:l(()=>[...e[43]||(e[43]=[i(" 重置 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),a(Yt,{data:ve.value,columns:Be.value,"storage-key":"product-list-columns",loading:z.value,"show-selection":!0,"show-header":!0,"show-column-settings":!0,"show-actions":!0,"row-class-name":Ye,pagination:{currentPage:C.currentPage,pageSize:C.pageSize,total:C.total,pageSizes:[10,20,50,100]},onSelectionChange:je,onSortChange:He,onSizeChange:_e,onCurrentChange:ke,onColumnSettingsChange:_t,ref_key:"dynamicTableRef",ref:Oe},{"header-actions":l(()=>[n("div",pa,[n("div",ma,[n("div",fa,[a(kt,{size:"small"},{default:l(()=>[a(s,{onClick:e[7]||(e[7]=o=>L("all")),type:B.value==="all"?"primary":""},{default:l(()=>[...e[44]||(e[44]=[i(" 全部 ",-1)])]),_:1},8,["type"]),a(s,{onClick:e[8]||(e[8]=o=>L("active")),type:B.value==="active"?"primary":""},{default:l(()=>[...e[45]||(e[45]=[i(" 在售 ",-1)])]),_:1},8,["type"]),a(s,{onClick:e[9]||(e[9]=o=>L("inactive")),type:B.value==="inactive"?"primary":""},{default:l(()=>[...e[46]||(e[46]=[i(" 下架 ",-1)])]),_:1},8,["type"]),a(s,{onClick:e[10]||(e[10]=o=>L("out_of_stock")),type:B.value==="out_of_stock"?"primary":""},{default:l(()=>[...e[47]||(e[47]=[i(" 缺货 ",-1)])]),_:1},8,["type"]),a(s,{onClick:e[11]||(e[11]=o=>L("deleted")),type:B.value==="deleted"?"primary":""},{default:l(()=>[...e[48]||(e[48]=[i(" 删除 ",-1)])]),_:1},8,["type"])]),_:1})])]),n("div",ga,[a(s,{onClick:ct,disabled:!v.value.length,type:"success",size:"small"},{default:l(()=>[...e[49]||(e[49]=[i(" 批量推荐 ",-1)])]),_:1},8,["disabled"]),a(s,{onClick:at,type:"danger",disabled:!v.value.length,size:"small"},{default:l(()=>[...e[50]||(e[50]=[i(" 批量删除 ",-1)])]),_:1},8,["disabled"]),a(s,{onClick:st,disabled:!v.value.length,size:"small"},{default:l(()=>[...e[51]||(e[51]=[i(" 批量上下架 ",-1)])]),_:1},8,["disabled"]),a(s,{onClick:nt,disabled:!v.value.length,size:"small"},{default:l(()=>[...e[52]||(e[52]=[i(" 批量调库存 ",-1)])]),_:1},8,["disabled"]),a(Ct,{direction:"vertical"}),a(s,{onClick:ut,icon:D($e),size:"small",title:"刷新数据"},null,8,["icon"])])])]),"column-image":l(({row:o})=>[a(wt,{src:o.image,style:{width:"60px",height:"60px","border-radius":"4px",cursor:"pointer"},fit:"cover",onClick:S=>Ge(o.image)},null,8,["src","onClick"])]),"column-code":l(({row:o})=>[a(ht,{onClick:S=>Ce(o),type:"primary",underline:!1,class:"product-code-link"},{default:l(()=>[i(k(o.code),1)]),_:2},1032,["onClick"])]),"column-price":l(({row:o})=>[n("span",va,"¥"+k(o.price),1)]),"column-stock":l(({row:o})=>[n("span",{class:Rt(Ae(o.stock,o.minStock))},k(o.stock),3)]),"column-status":l(({row:o})=>[a(ae,{type:qe(o.status),size:"small"},{default:l(()=>[i(k(Me(o.status)),1)]),_:2},1032,["type"])]),"table-actions":l(({row:o})=>[n("div",ya,[a(s,{onClick:S=>Ce(o),type:"primary",link:"",size:"small"},{default:l(()=>[...e[53]||(e[53]=[i(" 查看 ",-1)])]),_:1},8,["onClick"]),o.deleted?(N(),J("div",ba,[a(ae,{type:"danger",size:"small"},{default:l(()=>[...e[60]||(e[60]=[i("已删除",-1)])]),_:1}),a(s,{onClick:S=>lt(o),type:"success",link:"",size:"small",style:{"margin-left":"8px"}},{default:l(()=>[...e[61]||(e[61]=[i(" 恢复 ",-1)])]),_:1},8,["onClick"]),a(s,{onClick:S=>ot(o),type:"danger",link:"",size:"small"},{default:l(()=>[...e[62]||(e[62]=[i(" 彻底删除 ",-1)])]),_:1},8,["onClick"])])):(N(),J(xe,{key:0},[a(s,{onClick:S=>Ke(o),type:"primary",link:"",size:"small"},{default:l(()=>[...e[54]||(e[54]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(s,{onClick:S=>Ze(o),type:"success",link:"",size:"small"},{default:l(()=>[...e[55]||(e[55]=[i(" 改价 ",-1)])]),_:1},8,["onClick"]),a(s,{onClick:S=>We(o),type:"warning",link:"",size:"small"},{default:l(()=>[...e[56]||(e[56]=[i(" 调库存 ",-1)])]),_:1},8,["onClick"]),a(s,{onClick:S=>we(o),type:o.status==="active"?"info":"success",link:"",size:"small"},{default:l(()=>[i(k(o.status==="active"?"下架":"上架"),1)]),_:2},1032,["onClick","type"]),a(Vt,{onCommand:S=>Xe(S,o),trigger:"click"},{dropdown:l(()=>[a(St,null,{default:l(()=>[a(he,{command:"copy"},{default:l(()=>[...e[58]||(e[58]=[i("复制商品",-1)])]),_:1}),a(he,{command:"delete",class:"danger-item",divided:!0},{default:l(()=>[...e[59]||(e[59]=[i(" 删除 ",-1)])]),_:1})]),_:1})]),default:l(()=>[a(s,{type:"primary",link:"",size:"small"},{default:l(()=>[e[57]||(e[57]=i(" 更多",-1)),a(b,{class:"el-icon--right"},{default:l(()=>[a(D(Mt))]),_:1})]),_:1})]),_:1},8,["onCommand"])],64))])]),pagination:l(()=>[n("div",_a,[n("span",ka,"共 "+k(C.total)+" 条记录",1),a(Pt,{"current-page":C.currentPage,"onUpdate:currentPage":e[12]||(e[12]=o=>C.currentPage=o),"page-size":C.pageSize,"onUpdate:pageSize":e[13]||(e[13]=o=>C.pageSize=o),"page-sizes":[10,20,50,100],total:C.total,layout:"sizes, prev, pager, next, jumper",onSizeChange:_e,onCurrentChange:ke},null,8,["current-page","page-size","total"])])]),_:1},8,["data","columns","loading","pagination"]),a(le,{modelValue:W.value,"onUpdate:modelValue":e[18]||(e[18]=o=>W.value=o),title:"库存调整",width:"500px","before-close":ce},{footer:l(()=>[n("span",Ca,[a(s,{onClick:ce},{default:l(()=>[...e[66]||(e[66]=[i("取消",-1)])]),_:1}),a(s,{onClick:pt,type:"primary",loading:V.value},{default:l(()=>[...e[67]||(e[67]=[i(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[a(te,{ref_key:"stockFormRef",ref:re,model:y,rules:Ee,"label-width":"100px"},{default:l(()=>[a(c,{label:"商品名称"},{default:l(()=>{var o;return[n("span",null,k((o=w.value)==null?void 0:o.name),1)]}),_:1}),a(c,{label:"当前库存"},{default:l(()=>{var o;return[n("span",null,k((o=w.value)==null?void 0:o.stock),1)]}),_:1}),a(c,{label:"调整类型",prop:"type"},{default:l(()=>[a(Se,{modelValue:y.type,"onUpdate:modelValue":e[14]||(e[14]=o=>y.type=o)},{default:l(()=>[a(G,{value:"increase"},{default:l(()=>[...e[63]||(e[63]=[i("增加",-1)])]),_:1}),a(G,{value:"decrease"},{default:l(()=>[...e[64]||(e[64]=[i("减少",-1)])]),_:1}),a(G,{value:"set"},{default:l(()=>[...e[65]||(e[65]=[i("设置",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"调整数量",prop:"quantity"},{default:l(()=>{var o;return[a(H,{modelValue:y.quantity,"onUpdate:modelValue":e[15]||(e[15]=S=>y.quantity=S),min:y.type==="decrease"?1:0,max:y.type==="decrease"?(o=w.value)==null?void 0:o.stock:99999,style:{width:"100%"}},null,8,["modelValue","min","max"])]}),_:1}),a(c,{label:"调整原因",prop:"reason"},{default:l(()=>[a(j,{modelValue:y.reason,"onUpdate:modelValue":e[16]||(e[16]=o=>y.reason=o),placeholder:"请选择调整原因",style:{width:"100%"}},{default:l(()=>[a(_,{label:"采购入库",value:"purchase"}),a(_,{label:"销售出库",value:"sale"}),a(_,{label:"盘点调整",value:"inventory"}),a(_,{label:"损耗报废",value:"loss"}),a(_,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"备注",prop:"remark"},{default:l(()=>[a(O,{modelValue:y.remark,"onUpdate:modelValue":e[17]||(e[17]=o=>y.remark=o),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(le,{modelValue:X.value,"onUpdate:modelValue":e[22]||(e[22]=o=>X.value=o),title:"商品改价",width:"500px","before-close":pe},{footer:l(()=>[n("span",ha,[a(s,{onClick:pe},{default:l(()=>[...e[68]||(e[68]=[i("取消",-1)])]),_:1}),a(s,{onClick:mt,type:"primary",loading:V.value},{default:l(()=>[...e[69]||(e[69]=[i(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[a(te,{ref_key:"priceFormRef",ref:de,model:f,rules:Re,"label-width":"100px"},{default:l(()=>[a(c,{label:"商品名称"},{default:l(()=>{var o;return[n("span",null,k((o=w.value)==null?void 0:o.name),1)]}),_:1}),a(c,{label:"商品编码"},{default:l(()=>{var o;return[n("span",null,k((o=w.value)==null?void 0:o.code),1)]}),_:1}),a(c,{label:"当前价格"},{default:l(()=>{var o,S;return[n("span",null,"¥"+k((S=(o=w.value)==null?void 0:o.price)==null?void 0:S.toFixed(2)),1)]}),_:1}),a(c,{label:"新价格",prop:"newPrice"},{default:l(()=>[a(H,{modelValue:f.newPrice,"onUpdate:modelValue":e[19]||(e[19]=o=>f.newPrice=o),min:.01,precision:2,style:{width:"100%"},placeholder:"请输入新价格"},null,8,["modelValue"])]),_:1}),a(c,{label:"价格变化"},{default:l(()=>[f.newPrice&&f.originalPrice?(N(),J("span",wa,[a(ae,{type:f.newPrice>f.originalPrice?"success":"danger",size:"small"},{default:l(()=>[i(k(f.newPrice>f.originalPrice?"+":"")+" ¥"+k((f.newPrice-f.originalPrice).toFixed(2))+" ("+k(((f.newPrice-f.originalPrice)/f.originalPrice*100).toFixed(1))+"%) ",1)]),_:1},8,["type"])])):Te("",!0)]),_:1}),a(c,{label:"改价原因",prop:"reason"},{default:l(()=>[a(j,{modelValue:f.reason,"onUpdate:modelValue":e[20]||(e[20]=o=>f.reason=o),placeholder:"请选择改价原因",style:{width:"100%"}},{default:l(()=>[a(_,{label:"成本变化",value:"cost_change"}),a(_,{label:"市场调价",value:"market_adjust"}),a(_,{label:"促销活动",value:"promotion"}),a(_,{label:"竞争调价",value:"competition"}),a(_,{label:"季节调整",value:"seasonal"}),a(_,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"备注",prop:"remark"},{default:l(()=>[a(O,{modelValue:f.remark,"onUpdate:modelValue":e[21]||(e[21]=o=>f.remark=o),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(le,{modelValue:Z.value,"onUpdate:modelValue":e[23]||(e[23]=o=>Z.value=o),title:"分类管理",width:"800px","before-close":bt},{default:l(()=>[n("div",Sa,[n("div",Va,[a(s,{onClick:ft,type:"primary",icon:D(De)},{default:l(()=>[...e[70]||(e[70]=[i(" 添加分类 ",-1)])]),_:1},8,["icon"])]),a(Tt,{data:ye.value,style:{width:"100%"}},{default:l(()=>[a(q,{prop:"name",label:"分类名称"}),a(q,{prop:"code",label:"分类编码"}),a(q,{prop:"sort",label:"排序",width:"80"}),a(q,{prop:"productCount",label:"商品数量",width:"100"}),a(q,{label:"状态",width:"100"},{default:l(({row:o})=>[a(ae,{type:o.status==="active"?"success":"info",size:"small"},{default:l(()=>[i(k(o.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(q,{label:"操作",width:"150"},{default:l(({row:o})=>[a(s,{onClick:S=>gt(o),type:"primary",link:"",size:"small"},{default:l(()=>[...e[71]||(e[71]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(s,{onClick:S=>vt(o),type:"danger",link:"",size:"small"},{default:l(()=>[...e[72]||(e[72]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1},8,["modelValue"]),a(le,{modelValue:M.value,"onUpdate:modelValue":e[29]||(e[29]=o=>M.value=o),title:ee.value==="add"?"添加分类":"编辑分类",width:"500px","before-close":me},{footer:l(()=>[n("span",Pa,[a(s,{onClick:me},{default:l(()=>[...e[75]||(e[75]=[i("取消",-1)])]),_:1}),a(s,{onClick:yt,type:"primary",loading:I.value},{default:l(()=>[...e[76]||(e[76]=[i(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[a(te,{ref_key:"categoryFormRef",ref:ue,model:r,rules:ze,"label-width":"100px"},{default:l(()=>[a(c,{label:"分类名称",prop:"name"},{default:l(()=>[a(O,{modelValue:r.name,"onUpdate:modelValue":e[24]||(e[24]=o=>r.name=o),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),a(c,{label:"分类编码",prop:"code"},{default:l(()=>[a(O,{modelValue:r.code,"onUpdate:modelValue":e[25]||(e[25]=o=>r.code=o),placeholder:"请输入分类编码"},null,8,["modelValue"])]),_:1}),a(c,{label:"排序",prop:"sort"},{default:l(()=>[a(H,{modelValue:r.sort,"onUpdate:modelValue":e[26]||(e[26]=o=>r.sort=o),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(c,{label:"状态",prop:"status"},{default:l(()=>[a(Se,{modelValue:r.status,"onUpdate:modelValue":e[27]||(e[27]=o=>r.status=o)},{default:l(()=>[a(G,{value:"active"},{default:l(()=>[...e[73]||(e[73]=[i("启用",-1)])]),_:1}),a(G,{value:"inactive"},{default:l(()=>[...e[74]||(e[74]=[i("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"描述",prop:"description"},{default:l(()=>[a(O,{modelValue:r.description,"onUpdate:modelValue":e[28]||(e[28]=o=>r.description=o),type:"textarea",rows:3,placeholder:"请输入分类描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),se.value?(N(),Pe(xt,{key:0,"url-list":ne.value,"initial-index":ie.value,onClose:Qe},null,8,["url-list","initial-index"])):Te("",!0)])}}}),za=Gt(Ta,[["__scopeId","data-v-1c9a3b36"]]);export{za as default};
