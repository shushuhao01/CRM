var w=(me,G,P)=>new Promise((F,O)=>{var U=g=>{try{V(P.next(g))}catch(L){O(L)}},E=g=>{try{V(P.throw(g))}catch(L){O(L)}},V=g=>g.done?F(g.value):Promise.resolve(g.value).then(U,E);V((P=P.apply(me,G)).next())});import{aC as dt,az as ut,r as v,Z as Ce,e as N,c as ct,Y as mt,ag as u,m as h,p as m,q as s,U as t,M as q,Q as T,O as a,u as y,F as Q,a9 as Y,J as pt,P as ke,S as c,V as Ve,T as i,a2 as Ae}from"./vendor-D8Vxqhr-.js";import{E as p,F as vt,m as ft,ad as _t,T as ht,p as Se,a4 as yt,r as Ie,s as Pe,K as Ue,af as bt,b as gt}from"./elementPlus-Bmwh7Rh8.js";import{_ as wt,j as Ct,t as kt,c as Vt}from"./settings-CuxbDWOu.js";import{u as At}from"./product-DLyzXkG9.js";import"./utils-ywHRn0uI.js";const St={class:"order-edit-page"},It={class:"form-section"},Pt={class:"section-header"},Ut={key:0,class:"form-section"},xt={class:"header-left"},Nt={class:"header-right"},Tt={class:"phone-management"},zt={class:"form-section"},Mt={class:"section-header"},$t={class:"header-left"},qt={class:"header-right"},Ft={class:"product-search"},Ot={class:"product-container"},Et={class:"product-list"},Lt=["onClick"],Bt={class:"product-image"},Dt=["src","alt"],Wt={class:"product-info"},Rt={class:"product-name"},Kt={class:"product-price"},jt={class:"product-stock"},Zt={class:"product-actions"},Jt={class:"form-section"},Qt={class:"section-header"},Yt={key:0,class:"selected-products"},Gt={key:1,class:"empty-products"},Ht={class:"amount-summary-modern"},Xt={class:"amount-row"},eo={class:"amount-field"},to={class:"field-amount subtotal"},oo={class:"amount-field"},so={class:"field-label"},lo={class:"amount-field"},ao={class:"amount-row"},no={class:"amount-field"},ro={class:"field-amount collect"},io={class:"amount-field"},uo={class:"discount-horizontal"},co={class:"field-amount discount"},mo={key:0,class:"discount-percent"},po={class:"amount-field screenshot-field"},vo={class:"screenshot-buttons"},fo={class:"screenshot-content"},_o={key:0,class:"screenshot-thumbnails"},ho=["onMouseenter","onClick"],yo=["src"],bo={class:"thumbnail-overlay"},go=["onClick"],wo={class:"mark-section"},Co={class:"mark-description"},ko={class:"remark-section"},Vo={class:"form-footer"},Ao={class:"customer-search"},So={class:"customer-list"},Io={class:"dialog-footer"},Po={class:"confirm-content"},Uo={class:"confirm-section"},xo={class:"info-grid"},No={class:"info-item"},To={class:"value"},zo={class:"info-item"},Mo={class:"value"},$o={class:"info-item"},qo={class:"value"},Fo={class:"info-item"},Oo={class:"value"},Eo={class:"info-item"},Lo={key:0,class:"info-item"},Bo={class:"value"},Do={class:"confirm-section"},Wo={class:"amount-summary-two-columns"},Ro={class:"amount-column basic-amounts"},Ko={class:"amount-item"},jo={class:"value"},Zo={class:"amount-item"},Jo={class:"discount-info"},Qo={class:"value discount"},Yo={key:0,class:"discount-percent"},Go={class:"amount-column important-amounts"},Ho={class:"amount-item total-amount"},Xo={class:"value"},es={class:"amount-item deposit-amount"},ts={class:"value"},os={class:"amount-item collect-amount"},ss={class:"value"},ls={class:"confirm-section"},as={class:"dialog-footer"},ns={__name:"Edit",setup(me){const G=dt(),P=ut(),F=Vt(P),O=Ct(),U=kt(),E=At(),V=G.params.id,g=v(!1),L=v(""),xe=v([]),B=v(""),D=v(""),W=v([]),R=v([]),Z=v(!1),K=v(!1),z=v(!1),H=v(!1),pe=v([]);v("");const X=v(null),b=v([]),ee=v(-1),te=v(null),M=v(!1),l=Ce({id:null,customerId:null,customerName:"",customerPhone:"",deliveryAddress:"",deliveryTime:"",receiverName:"",receiverPhone:"",expressCompany:"",serviceWechat:"",orderSource:"",products:[],subtotal:0,totalAmount:0,depositAmount:0,collectedAmount:0,discountAmount:0,depositScreenshot:"",orderType:"normal",remarks:""}),A=Ce({phone:""}),x=N(()=>l.products.reduce((o,e)=>o+(e.price||0)*(e.quantity||0),0)),Ne=N(()=>(l.totalAmount||0)-(l.depositAmount||0)),J=N(()=>x.value-(l.totalAmount||0)),oe=N(()=>x.value>0&&J.value>0?J.value/x.value*100:0),Te=N(()=>B.value?E.products.filter(o=>{var e;return o.status==="active"&&(o.name.toLowerCase().includes(B.value.toLowerCase())||((e=o.code)==null?void 0:e.toLowerCase().includes(B.value.toLowerCase())))}):E.products.filter(o=>o.status==="active")),ze=N(()=>U.customers.filter(o=>!o.deleted));ct(()=>w(this,null,function*(){yield se(),window.addEventListener("orderUpdated",ve),window.addEventListener("orderStatusUpdated",fe)})),mt(()=>{window.removeEventListener("orderUpdated",ve),window.removeEventListener("orderStatusUpdated",fe)});const ve=o=>{const{orderId:e}=o.detail;e===V&&(se(),p.success("订单数据已同步更新"))},fe=o=>{const{orderId:e}=o.detail;e===V&&(se(),p.info("订单状态已更新"))},se=()=>w(this,null,function*(){try{const o=O.getOrderById(V);o&&(Object.assign(l,{id:o.id,customerId:o.customerId,customerName:o.customerName,customerPhone:o.customerPhone,receiverName:o.receiverName||"",receiverPhone:o.receiverPhone||"",deliveryAddress:o.deliveryAddress||"",deliveryTime:o.deliveryTime||"",expressCompany:o.expressCompany||"",serviceWechat:o.serviceWechat||"",orderSource:o.orderSource||"",products:o.products||[],subtotal:o.subtotal||0,totalAmount:o.totalAmount||0,depositAmount:o.depositAmount||0,collectedAmount:o.collectedAmount||0,discountAmount:o.discountAmount||0,depositScreenshot:o.depositScreenshot||"",orderType:o.orderType||"normal",remarks:o.remarks||""}),o.customerId&&(yield ne(o.customerId)),o.depositScreenshots&&Array.isArray(o.depositScreenshots)?b.value=[...o.depositScreenshots]:o.depositScreenshot?b.value=[o.depositScreenshot]:b.value=[],le())}catch(o){console.error("加载订单数据失败:",o),p.error("加载订单数据失败"),et()}}),Me=o=>{const e=l.products.find(r=>r.productId===o.id);e?(e.quantity+=1,e.subtotal=e.quantity*e.price):l.products.push({productId:o.id,productName:o.name,productCode:o.code,specification:o.specification,price:o.price,quantity:1,subtotal:o.price}),le(),L.value="",xe.value=[]},$e=o=>{l.products.splice(o,1),le()},le=()=>{l.products.forEach(o=>{o.subtotal=o.quantity*o.price}),l.subtotal=l.products.reduce((o,e)=>o+e.subtotal,0),_e()},_e=()=>{l.totalAmount=l.subtotal-l.discountAmount,l.collectedAmount=l.depositAmount},qe=()=>{},Fe=o=>w(this,null,function*(){if(o){const e=U.getCustomerById(o);e&&(te.value=e,l.customerName=e.name,l.customerPhone=e.phone,l.deliveryAddress=e.address||"",l.receiverName=e.name,l.receiverPhone=e.phone,l.serviceWechat=e.wechatId||"",l.orderSource=e.source||"",M.value=!1,yield ne(o))}else te.value=null,l.customerName="",l.customerPhone="",l.deliveryAddress="",l.receiverName="",l.receiverPhone="",l.serviceWechat="",l.orderSource="",R.value=[]}),Oe=()=>{E.refreshProducts(),p.success("产品列表已刷新")},Ee=o=>{F.push(`/product/detail/${o.id}`)},Le=()=>{ae()},ae=()=>{l.collectedAmount=(l.totalAmount||0)-(l.depositAmount||0)},Be=()=>{l.totalAmount=x.value,ae()},De=N(()=>Math.abs((l.totalAmount||0)-x.value)>.01),We=()=>w(this,null,function*(){if(D.value.trim())try{W.value=yield U.searchCustomers(D.value)}catch(o){console.error("搜索客户失败:",o),W.value=[]}else W.value=[]}),Re=o=>w(this,null,function*(){l.customerId=o.id,l.customerName=o.name,l.customerPhone=o.phone,l.deliveryAddress=o.address||"",l.receiverName=o.name,l.receiverPhone=o.phone,l.serviceWechat=o.wechatId||"",l.orderSource=o.source||"",M.value=!1,yield ne(o.id),Z.value=!1}),ne=o=>w(this,null,function*(){try{const e=yield U.getCustomerPhones(o);R.value=e||[]}catch(e){console.error("加载客户电话失败:",e),R.value=[]}}),Ke=()=>w(this,null,function*(){if(!A.phone.trim()){p.warning("请输入电话号码");return}try{yield U.addCustomerPhone(l.customerId,A.phone),R.value.push(A.phone),l.customerPhone=A.phone,A.phone="",K.value=!1,p.success("添加电话号码成功")}catch(o){console.error("添加电话号码失败:",o),p.error("添加电话号码失败")}}),je=()=>{var o;(o=X.value)==null||o.click()},he=o=>{const e=o.target.files;if(e&&e.length>0){for(let r=0;r<e.length;r++){if(b.value.length>=3){p.warning("最多只能上传3张图片");break}ye(e[r])}o.target.value=""}},Ze=()=>w(this,null,function*(){if(b.value.length>=3){p.warning("最多只能上传3张图片");return}try{const o=yield navigator.clipboard.read();for(const e of o)for(const r of e.types)if(r.startsWith("image/")){const d=yield e.getType(r),C=new File([d],"pasted-image.png",{type:r});ye(C);return}p.warning("剪贴板中没有图片")}catch(o){p.error("粘贴图片失败，请检查浏览器权限")}}),ye=o=>{if(!Je(o))return;if(b.value.length>=3){p.warning("最多只能上传3张图片");return}const e=new FileReader;e.onload=r=>{var C;const d=(C=r.target)==null?void 0:C.result;b.value.push(d),l.depositScreenshot=b.value[0]||"",p.success("图片已添加")},e.readAsDataURL(o)},Je=o=>{const e=o.type.startsWith("image/"),r=o.size/1024/1024<2;return e?r?!0:(p.error("图片大小不能超过 2MB!"),!1):(p.error("只能上传图片文件!"),!1)},Qe=o=>{const e=o||l.depositScreenshot;e&&(pe.value=[e],H.value=!0)},Ye=o=>{typeof o=="number"?(b.value.splice(o,1),l.depositScreenshot=b.value[0]||"",p.success("图片已删除")):(b.value=[],l.depositScreenshot="")},Ge=()=>{if(!l.customerName){p.warning("请选择客户");return}if(l.products.length===0){p.warning("请至少选择一个产品");return}z.value=!0},He=()=>w(this,null,function*(){g.value=!0;try{yield O.updateOrder(V,l),p.success("订单更新成功"),z.value=!1,setTimeout(()=>{F.push("/order/list")},1e3)}catch(o){console.error("更新订单失败:",o),p.error("更新订单失败")}finally{g.value=!1}}),Xe=()=>w(this,null,function*(){try{yield gt.confirm("确定要取消吗？未保存的数据将丢失","提示",{confirmButtonText:"确定",cancelButtonText:"继续编辑",type:"warning"}),F.push("/order/list")}catch(o){}}),et=()=>{P.back()},tt=()=>{Z.value=!1,D.value="",W.value=[]},ot=()=>{z.value=!1};return(o,e)=>{const r=u("el-icon"),d=u("el-option"),C=u("el-select"),k=u("el-form-item"),S=u("el-col"),$=u("el-input"),re=u("el-row"),f=u("el-button"),st=u("el-collapse-transition"),lt=u("Money"),_=u("el-table-column"),ie=u("el-input-number"),de=u("el-table"),at=u("el-empty"),nt=u("el-tooltip"),ue=u("el-tag"),be=u("el-radio"),rt=u("el-radio-group"),ge=u("el-alert"),we=u("el-form"),ce=u("el-dialog"),it=u("el-image-viewer");return m(),h("div",St,[e[63]||(e[63]=s("div",{class:"page-header"},[s("h2",{class:"page-title"},"编辑订单")],-1)),t(we,{model:l,rules:o.formRules,ref:"orderFormRef","label-width":"120px",class:"order-form"},{default:a(()=>[s("div",It,[s("div",Pt,[t(r,null,{default:a(()=>[t(y(vt))]),_:1}),e[22]||(e[22]=s("span",null,"客户信息",-1))]),t(re,{gutter:20},{default:a(()=>[t(S,{span:8},{default:a(()=>[t(k,{label:"选择客户",prop:"customerId",required:""},{default:a(()=>[t(C,{modelValue:l.customerId,"onUpdate:modelValue":e[0]||(e[0]=n=>l.customerId=n),placeholder:"请选择客户",style:{width:"100%"},filterable:"",onChange:Fe,size:"large"},{default:a(()=>[(m(!0),h(Q,null,Y(ze.value,n=>(m(),q(d,{key:n.id,label:`${n.name} (${n.phone})`,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(S,{span:8},{default:a(()=>[t(k,{label:"客服微信号",prop:"serviceWechat",required:""},{default:a(()=>[t($,{modelValue:l.serviceWechat,"onUpdate:modelValue":e[1]||(e[1]=n=>l.serviceWechat=n),placeholder:"请输入负责客服的微信号",clearable:""},{prefix:a(()=>[t(r,null,{default:a(()=>[t(y(ft))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(S,{span:8},{default:a(()=>[t(k,{label:"订单来源",prop:"orderSource",required:""},{default:a(()=>[t(C,{modelValue:l.orderSource,"onUpdate:modelValue":e[2]||(e[2]=n=>l.orderSource=n),placeholder:"请选择订单来源",style:{width:"100%"}},{default:a(()=>[t(d,{label:"🛒 线上商城",value:"online_store"}),t(d,{label:"📱 微信小程序",value:"wechat_mini"}),t(d,{label:"💬 微信客服",value:"wechat_service"}),t(d,{label:"📞 电话咨询",value:"phone_call"}),t(d,{label:"🏪 线下门店",value:"offline_store"}),t(d,{label:"👥 客户推荐",value:"referral"}),t(d,{label:"📺 广告投放",value:"advertisement"}),t(d,{label:"🎯 其他渠道",value:"other"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),te.value?(m(),h("div",Ut,[s("div",{class:"section-header",onClick:e[3]||(e[3]=n=>M.value=!M.value),style:{cursor:"pointer"}},[s("div",xt,[t(r,null,{default:a(()=>[t(y(_t))]),_:1}),e[23]||(e[23]=s("span",null,"收货信息",-1))]),s("div",Nt,[t(r,{class:pt(["collapse-icon",{collapsed:M.value}])},{default:a(()=>[t(y(ht))]),_:1},8,["class"])])]),t(st,null,{default:a(()=>[ke(s("div",null,[t(re,{gutter:20},{default:a(()=>[t(S,{span:6},{default:a(()=>[t(k,{label:"收货人",prop:"receiverName"},{default:a(()=>[t($,{modelValue:l.receiverName,"onUpdate:modelValue":e[4]||(e[4]=n=>l.receiverName=n),placeholder:"请输入收货人姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(S,{span:12},{default:a(()=>[t(k,{label:"收货电话",prop:"receiverPhone"},{default:a(()=>[s("div",Tt,[t(C,{modelValue:l.receiverPhone,"onUpdate:modelValue":e[5]||(e[5]=n=>l.receiverPhone=n),placeholder:"请选择收货电话",style:{width:"100%"},clearable:""},{default:a(()=>[(m(!0),h(Q,null,Y(R.value,n=>(m(),q(d,{key:n.id,label:n.number,value:n.number},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(f,{type:"primary",size:"small",onClick:e[6]||(e[6]=n=>K.value=!0),style:{"margin-left":"8px"},icon:y(Se)},{default:a(()=>[...e[24]||(e[24]=[c(" 新增 ",-1)])]),_:1},8,["icon"])])]),_:1})]),_:1}),t(S,{span:6},{default:a(()=>[t(k,{label:"指定快递",prop:"expressCompany",required:""},{default:a(()=>[t(C,{modelValue:l.expressCompany,"onUpdate:modelValue":e[7]||(e[7]=n=>l.expressCompany=n),placeholder:"请选择快递公司",style:{width:"100%"}},{default:a(()=>[t(d,{label:"🚚 顺丰速运",value:"sf"}),t(d,{label:"📦 中通快递",value:"zt"}),t(d,{label:"🚛 圆通速递",value:"yt"}),t(d,{label:"📮 申通快递",value:"st"}),t(d,{label:"🚐 韵达速递",value:"yd"}),t(d,{label:"🚚 德邦快递",value:"db"}),t(d,{label:"📦 京东物流",value:"jd"}),t(d,{label:"🚛 邮政EMS",value:"ems"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})],512),[[Ve,!M.value]])]),_:1})])):T("",!0),s("div",zt,[s("div",Mt,[s("div",$t,[t(r,null,{default:a(()=>[t(y(yt))]),_:1}),e[25]||(e[25]=s("span",null,"产品选择",-1))]),s("div",qt,[t(f,{type:"primary",size:"small",icon:y(Ie),onClick:Oe,title:"刷新商品列表"},{default:a(()=>[...e[26]||(e[26]=[c(" 刷新 ",-1)])]),_:1},8,["icon"])])]),s("div",Ft,[t($,{modelValue:B.value,"onUpdate:modelValue":e[8]||(e[8]=n=>B.value=n),placeholder:"搜索产品名称、编号...",size:"large",clearable:"",onInput:qe},{prefix:a(()=>[t(r,null,{default:a(()=>[t(y(Pe))]),_:1})]),_:1},8,["modelValue"])]),s("div",Ot,[s("div",Et,[(m(!0),h(Q,null,Y(Te.value,n=>(m(),h("div",{key:n.id,class:"product-item",onClick:I=>Me(n)},[s("div",Bt,[s("img",{src:n.image||"/default-product.png",alt:n.name},null,8,Dt)]),s("div",Wt,[s("div",Rt,i(n.name),1),s("div",Kt,"¥"+i(n.price),1),s("div",jt,"库存: "+i(n.stock),1)]),s("div",Zt,[t(f,{type:"info",size:"small",icon:o.View,onClick:Ae(I=>Ee(n),["stop"]),title:"查看商品详情"},{default:a(()=>[...e[27]||(e[27]=[c(" 详情 ",-1)])]),_:1},8,["icon","onClick"]),t(f,{type:"primary",size:"small",icon:y(Se)},{default:a(()=>[...e[28]||(e[28]=[c("添加",-1)])]),_:1},8,["icon"])])],8,Lt))),128))])])]),s("div",Jt,[s("div",Qt,[t(r,null,{default:a(()=>[t(lt)]),_:1}),e[29]||(e[29]=s("span",null,"订单汇总",-1))]),l.products.length>0?(m(),h("div",Yt,[e[31]||(e[31]=s("h4",null,"已选商品",-1)),t(de,{data:l.products,style:{width:"100%"}},{default:a(()=>[t(_,{prop:"productName",label:"商品名称"}),t(_,{prop:"price",label:"单价",width:"100"},{default:a(({row:n})=>[c(" ¥"+i(n.price),1)]),_:1}),t(_,{label:"数量",width:"150"},{default:a(({row:n,$index:I})=>[t(ie,{modelValue:n.quantity,"onUpdate:modelValue":j=>n.quantity=j,min:1,max:n.stock,size:"small",onChange:_e},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1}),t(_,{label:"小计",width:"100"},{default:a(({row:n})=>[c(" ¥"+i(((n.price||0)*(n.quantity||0)).toFixed(2)),1)]),_:1}),t(_,{label:"操作",width:"80"},{default:a(({$index:n})=>[t(f,{type:"danger",size:"small",icon:y(Ue),onClick:I=>$e(n)},{default:a(()=>[...e[30]||(e[30]=[c(" 删除 ",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])])):(m(),h("div",Gt,[t(at,{description:"暂无选择商品"})])),s("div",Ht,[s("div",Xt,[s("div",eo,[e[32]||(e[32]=s("span",{class:"field-label"},"商品小计",-1)),s("span",to,"¥"+i(x.value.toFixed(2)),1)]),s("div",oo,[s("span",so,[e[33]||(e[33]=c(" 订单总额 ",-1)),De.value?(m(),q(nt,{key:0,content:"点击同步商品小计",placement:"top"},{default:a(()=>[t(f,{type:"text",size:"small",icon:y(Ie),onClick:Be,class:"sync-button"},null,8,["icon"])]),_:1})):T("",!0)]),t(ie,{modelValue:l.totalAmount,"onUpdate:modelValue":e[9]||(e[9]=n=>l.totalAmount=n),min:0,max:x.value,precision:2,placeholder:"订单总额",class:"field-input",onChange:Le},null,8,["modelValue","max"])]),s("div",lo,[e[34]||(e[34]=s("span",{class:"field-label"},"定金",-1)),t(ie,{modelValue:l.depositAmount,"onUpdate:modelValue":e[10]||(e[10]=n=>l.depositAmount=n),min:0,max:l.totalAmount||0,precision:2,placeholder:"定金金额",class:"field-input",onChange:ae},null,8,["modelValue","max"])])]),s("div",ao,[s("div",no,[e[35]||(e[35]=s("span",{class:"field-label"},"代收金额",-1)),s("span",ro,"¥"+i(Ne.value.toFixed(2)),1)]),s("div",io,[e[36]||(e[36]=s("span",{class:"field-label"},"优惠金额",-1)),s("div",uo,[s("span",co,"¥"+i(J.value.toFixed(2)),1),J.value>0?(m(),h("span",mo," ("+i(oe.value.toFixed(1))+"%) ",1)):T("",!0)])]),s("div",po,[e[39]||(e[39]=s("span",{class:"field-label"},"定金截图",-1)),s("div",vo,[t(f,{type:"primary",size:"small",icon:o.Upload,onClick:je},{default:a(()=>[...e[37]||(e[37]=[c(" 上传截图 ",-1)])]),_:1},8,["icon"]),t(f,{type:"success",size:"small",icon:o.DocumentCopy,onClick:Ze},{default:a(()=>[...e[38]||(e[38]=[c(" 粘贴图片 ",-1)])]),_:1},8,["icon"])]),s("div",fo,[b.value.length>0?(m(),h("div",_o,[(m(!0),h(Q,null,Y(b.value,(n,I)=>(m(),h("div",{key:I,class:"thumbnail-item",onMouseenter:j=>ee.value=I,onMouseleave:e[11]||(e[11]=j=>ee.value=-1),onClick:j=>Qe(n)},[s("img",{src:n,alt:"定金截图"},null,8,yo),ke(s("div",bo,[t(r,{class:"zoom-icon"},{default:a(()=>[t(y(bt))]),_:1})],512),[[Ve,ee.value===I]]),s("div",{class:"thumbnail-delete",onClick:Ae(j=>Ye(I),["stop"])},[t(r,null,{default:a(()=>[t(y(Ue))]),_:1})],8,go)],40,ho))),128))])):T("",!0)]),s("input",{ref_key:"fileInput",ref:X,type:"file",accept:"image/*",multiple:"",style:{display:"none"},onChange:he},null,544)])])]),s("div",wo,[e[42]||(e[42]=s("h4",null,"订单标记",-1)),t(re,{gutter:20},{default:a(()=>[t(S,{span:12},{default:a(()=>[t(k,{label:"订单类型",prop:"markType",required:""},{default:a(()=>[t(rt,{modelValue:l.markType,"onUpdate:modelValue":e[12]||(e[12]=n=>l.markType=n),onChange:o.handleMarkTypeChange},{default:a(()=>[t(be,{value:"normal"},{default:a(()=>[t(ue,{type:"success",size:"small"},{default:a(()=>[...e[40]||(e[40]=[c("正常发货单",-1)])]),_:1})]),_:1}),t(be,{value:"reserved"},{default:a(()=>[t(ue,{type:"warning",size:"small"},{default:a(()=>[...e[41]||(e[41]=[c("预留单",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1}),t(S,{span:12},{default:a(()=>[s("div",Co,[l.markType==="reserved"?(m(),q(ge,{key:0,title:"预留单说明",description:"预留单将保留在下单人处，不会流转到审核员。需要修改为正常发货单后才会进入审核流程。",type:"warning",closable:!1,"show-icon":""})):(m(),q(ge,{key:1,title:"正常发货单",description:"订单将按正常流程进行审核和发货处理。",type:"success",closable:!1,"show-icon":""}))])]),_:1})]),_:1})]),s("div",ko,[t(k,{label:"订单备注"},{default:a(()=>[t($,{modelValue:l.remark,"onUpdate:modelValue":e[13]||(e[13]=n=>l.remark=n),type:"textarea",rows:3,placeholder:"请输入订单备注信息"},null,8,["modelValue"])]),_:1})]),s("div",Vo,[t(f,{onClick:Xe,size:"large"},{default:a(()=>[...e[43]||(e[43]=[c("取消",-1)])]),_:1}),t(f,{onClick:Ge,type:"primary",size:"large",loading:g.value},{default:a(()=>[...e[44]||(e[44]=[c(" 保存更新 ",-1)])]),_:1},8,["loading"])])])]),_:1},8,["model","rules"]),t(ce,{modelValue:Z.value,"onUpdate:modelValue":e[15]||(e[15]=n=>Z.value=n),title:"选择客户",width:"800px","before-close":tt},{default:a(()=>[s("div",Ao,[t($,{modelValue:D.value,"onUpdate:modelValue":e[14]||(e[14]=n=>D.value=n),placeholder:"搜索客户姓名或电话...",onInput:We,clearable:""},{prefix:a(()=>[t(r,null,{default:a(()=>[t(y(Pe))]),_:1})]),_:1},8,["modelValue"])]),s("div",So,[t(de,{data:W.value,onRowClick:Re,"highlight-current-row":"",style:{width:"100%"}},{default:a(()=>[t(_,{prop:"name",label:"客户姓名"}),t(_,{prop:"phone",label:"联系电话"}),t(_,{prop:"address",label:"地址"})]),_:1},8,["data"])])]),_:1},8,["modelValue"]),t(ce,{modelValue:K.value,"onUpdate:modelValue":e[18]||(e[18]=n=>K.value=n),title:"添加电话号码",width:"400px"},{footer:a(()=>[s("span",Io,[t(f,{onClick:e[17]||(e[17]=n=>K.value=!1)},{default:a(()=>[...e[45]||(e[45]=[c("取消",-1)])]),_:1}),t(f,{type:"primary",onClick:Ke},{default:a(()=>[...e[46]||(e[46]=[c("确定",-1)])]),_:1})])]),default:a(()=>[t(we,{model:A,"label-width":"80px"},{default:a(()=>[t(k,{label:"电话号码"},{default:a(()=>[t($,{modelValue:A.phone,"onUpdate:modelValue":e[16]||(e[16]=n=>A.phone=n),placeholder:"请输入电话号码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(ce,{modelValue:z.value,"onUpdate:modelValue":e[20]||(e[20]=n=>z.value=n),title:"订单确认",width:"900px","before-close":ot},{footer:a(()=>[s("span",as,[t(f,{onClick:e[19]||(e[19]=n=>z.value=!1)},{default:a(()=>[...e[61]||(e[61]=[c("取消",-1)])]),_:1}),t(f,{type:"primary",onClick:He,loading:g.value},{default:a(()=>[...e[62]||(e[62]=[c(" 确认保存 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[s("div",Po,[s("div",Uo,[e[53]||(e[53]=s("h4",{class:"confirm-title"},"客户信息",-1)),s("div",xo,[s("div",No,[e[47]||(e[47]=s("span",{class:"label"},"客户姓名:",-1)),s("span",To,i(l.customerName),1)]),s("div",zo,[e[48]||(e[48]=s("span",{class:"label"},"联系电话:",-1)),s("span",Mo,i(l.customerPhone),1)]),s("div",$o,[e[49]||(e[49]=s("span",{class:"label"},"配送地址:",-1)),s("span",qo,i(l.deliveryAddress||"无"),1)]),s("div",Fo,[e[50]||(e[50]=s("span",{class:"label"},"配送时间:",-1)),s("span",Oo,i(l.deliveryTime||"无"),1)]),s("div",Eo,[e[51]||(e[51]=s("span",{class:"label"},"订单类型:",-1)),t(ue,{type:l.orderType==="normal"?"success":"warning"},{default:a(()=>[c(i(l.orderType==="normal"?"正常订单":"预留订单"),1)]),_:1},8,["type"])]),l.remarks?(m(),h("div",Lo,[e[52]||(e[52]=s("span",{class:"label"},"备注:",-1)),s("span",Bo,i(l.remarks),1)])):T("",!0)])]),s("div",Do,[e[59]||(e[59]=s("h4",{class:"confirm-title"},"金额汇总",-1)),s("div",Wo,[s("div",Ro,[s("div",Ko,[e[54]||(e[54]=s("span",{class:"label"},"商品小计",-1)),s("span",jo,"¥"+i(l.subtotal),1)]),s("div",Zo,[e[55]||(e[55]=s("span",{class:"label"},"优惠金额",-1)),s("div",Jo,[s("span",Qo,"-¥"+i(l.discountAmount),1),oe.value>0?(m(),h("span",Yo,i(oe.value)+"%",1)):T("",!0)])])]),s("div",Go,[s("div",Ho,[e[56]||(e[56]=s("span",{class:"label"},"订单总额",-1)),s("span",Xo,"¥"+i(l.totalAmount),1)]),s("div",es,[e[57]||(e[57]=s("span",{class:"label"},"定金金额",-1)),s("span",ts,"¥"+i(l.depositAmount),1)]),s("div",os,[e[58]||(e[58]=s("span",{class:"label"},"已收金额",-1)),s("span",ss,"¥"+i(l.collectedAmount),1)])])])]),s("div",ls,[e[60]||(e[60]=s("h4",{class:"confirm-title"},"产品信息",-1)),t(de,{data:l.products,style:{width:"100%"}},{default:a(()=>[t(_,{prop:"productName",label:"产品名称"}),t(_,{prop:"productCode",label:"产品编号",width:"120"}),t(_,{prop:"specification",label:"规格",width:"120"}),t(_,{prop:"price",label:"单价",width:"100"},{default:a(n=>[c(" ¥"+i(n.row.price),1)]),_:1}),t(_,{prop:"quantity",label:"数量",width:"80"}),t(_,{prop:"subtotal",label:"小计",width:"100"},{default:a(n=>[c(" ¥"+i(n.row.subtotal),1)]),_:1})]),_:1},8,["data"])])])]),_:1},8,["modelValue"]),H.value?(m(),q(it,{key:0,"url-list":pe.value,"initial-index":0,onClose:e[21]||(e[21]=n=>H.value=!1)},null,8,["url-list"])):T("",!0),s("input",{ref_key:"fileInput",ref:X,type:"file",accept:"image/*",style:{display:"none"},onChange:he},null,544)])}}},ps=wt(ns,[["__scopeId","data-v-fcafe148"]]);export{ps as default};
