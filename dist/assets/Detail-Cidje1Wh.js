const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DkAJPKqn.js","assets/vendor-BtukhyiH.js","assets/elementPlus-DxaqjplL.js","assets/utils-DfI7e5Rl.js","assets/index-Cj-RrGL6.css"])))=>i.map(i=>d[i]);
import{r as e,u as a,d as l,i as t,S as s,n as o,o as n,C as i,c as r,l as u,_ as d}from"./index-DkAJPKqn.js";import{l as c,aC as m,aA as p,r as v,Z as f,e as h,w as y,b as g,Y as _,ag as w,aq as b,m as k,q as C,p as V,U as I,u as T,T as P,O as N,S as x,M as S,F as E,Q as A,a9 as O,P as U,V as D}from"./vendor-BtukhyiH.js";import{L as z,M as $,m as L,N as R,i as j,O as B,d as G,P as J,C as H,Q as M,K as F,u as q,R as W,S as Z,T as K,U as Y,F as Q,G as X,V as ee,W as ae,E as le,b as te}from"./elementPlus-DxaqjplL.js";import{u as se}from"./service-LZ3f5P50.js";import{u as oe}from"./call-BZy2xjj5.js";import{d as ne}from"./sensitiveInfo-DVfrBLrU.js";import{C as ie}from"./CreateTemplateDialog-DU-rKNj1.js";import{isDevelopment as re}from"./env-DLalhsF6.js";import"./utils-DfI7e5Rl.js";const ue=async(a,l,t=[])=>{try{return await e(a,l)}catch(s){if(s?.message?.includes("404")||s?.message?.includes("APIç«¯ç‚¹ä¸å­˜åœ¨")||s?.message?.includes("Not Found"))return console.log(`[API] ${a} è¿”å›žç©ºæ•°æ®ï¼ˆ404ï¼‰`),t;throw s}},de=async e=>{if(re()){return JSON.parse(localStorage.getItem("crm_orders")||"[]").filter(a=>a.customerId===e)}return ue(`/api/customers/${e}/orders`,{method:"GET"},[])},ce=async e=>{if(re()){return JSON.parse(localStorage.getItem("crm_services")||"[]").filter(a=>a.customerId===e)}return ue(`/api/customers/${e}/services`,{method:"GET"},[])},me=async e=>{if(re()){return JSON.parse(localStorage.getItem("crm_calls")||"[]").filter(a=>a.customerId===e)}return ue(`/api/customers/${e}/calls`,{method:"GET"},[])},pe=async e=>{if(re()){return JSON.parse(localStorage.getItem("crm_followups")||"[]").filter(a=>a.customerId===e)}return ue(`/api/customers/${e}/followups`,{method:"GET"},[])},ve=async e=>{if(re()){const a=JSON.parse(localStorage.getItem("crm_customers")||"[]").find(a=>a.id===e);return a?.tags||[]}return ue(`/api/customers/${e}/tags`,{method:"GET"},[])},fe=async(a,l)=>{if(re()){const e=JSON.parse(localStorage.getItem("crm_followups")||"[]"),t={id:`followup_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,customerId:a,...l,createTime:(new Date).toISOString(),updateTime:(new Date).toISOString()};return e.push(t),localStorage.setItem("crm_followups",JSON.stringify(e)),t}return e(`/api/customers/${a}/followups`,{method:"POST",data:l})},he=async(a,l,t)=>{if(re()){const e=JSON.parse(localStorage.getItem("crm_followups")||"[]"),a=e.findIndex(e=>e.id===l);if(a>-1)return e[a]={...e[a],...t,updateTime:(new Date).toISOString()},localStorage.setItem("crm_followups",JSON.stringify(e)),e[a];throw new Error("è·Ÿè¿›è®°å½•ä¸å­˜åœ¨")}return e(`/api/customers/${a}/followups/${l}`,{method:"PUT",data:t})},ye=async(a,l)=>{if(re()){const e=JSON.parse(localStorage.getItem("crm_followups")||"[]").filter(e=>e.id!==l);return localStorage.setItem("crm_followups",JSON.stringify(e)),{success:!0}}return e(`/api/customers/${a}/followups/${l}`,{method:"DELETE"})},ge=async(a,l)=>{if(re()){const e=JSON.parse(localStorage.getItem("crm_customers")||"[]"),t=e.findIndex(e=>e.id===a);if(t>-1){e[t].tags||(e[t].tags=[]);const a={id:`tag_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,...l};return e[t].tags.push(a),localStorage.setItem("crm_customers",JSON.stringify(e)),a}throw new Error("å®¢æˆ·ä¸å­˜åœ¨")}return e(`/api/customers/${a}/tags`,{method:"POST",data:l})},_e=async(a,l)=>{if(re()){const e=JSON.parse(localStorage.getItem("crm_customers")||"[]"),t=e.findIndex(e=>e.id===a);if(t>-1&&e[t].tags)return e[t].tags=e[t].tags.filter(e=>e.id!==l),localStorage.setItem("crm_customers",JSON.stringify(e)),{success:!0};throw new Error("å®¢æˆ·æˆ–æ ‡ç­¾ä¸å­˜åœ¨")}return e(`/api/customers/${a}/tags/${l}`,{method:"DELETE"})},we={class:"customer-detail"},be={class:"page-header"},ke={class:"header-left"},Ce={class:"customer-title"},Ve={class:"header-actions"},Ie={class:"first-row"},Te={class:"card-header"},Pe={class:"card-title"},Ne={key:1,class:"edit-actions"},xe={key:0,class:"info-display"},Se={class:"customer-info-row"},Ee={class:"info-item name-section"},Ae={class:"customer-name-display"},Oe={class:"info-item code-section"},Ue=["title"],De={class:"info-item phone-section"},ze={class:"phone-container-horizontal"},$e=["onClick"],Le={key:1,class:"field-value"},Re={class:"customer-info-row"},je={class:"info-item"},Be={key:1,class:"field-value"},Ge={class:"info-item"},Je={class:"field-value"},He={class:"info-item"},Me={class:"field-value"},Fe={class:"info-item"},qe={class:"field-value"},We={class:"info-item"},Ze={class:"field-value"},Ke={class:"customer-info-row tags-row"},Ye={class:"info-item tags-section"},Qe={key:0,class:"customer-tags"},Xe={key:1,class:"field-value"},ea={class:"info-group-right"},aa={class:"info-item compact"},la={class:"field-value"},ta={class:"info-item compact"},sa={class:"field-value"},oa={class:"info-item compact"},na={class:"field-value improvement-goals"},ia={key:0},ra={key:1,class:"no-goals"},ua={class:"customer-info-row create-time-row"},da={class:"info-item"},ca={class:"field-value"},ma={class:"info-item"},pa={class:"field-value"},va={class:"info-item"},fa={class:"field-value"},ha={class:"info-item"},ya={class:"field-value"},ga={class:"customer-info-row"},_a={class:"info-item address-item"},wa={class:"address-content"},ba={class:"customer-info-row"},ka={class:"info-item medical-item"},Ca={class:"medical-history-section"},Va={key:0,class:"latest-medical-info"},Ia={class:"medical-record"},Ta={class:"medical-content"},Pa={class:"medical-date"},Na={class:"medical-operator"},xa={key:1,class:"medical-history-toggle"},Sa={class:"medical-history-list"},Ea={class:"medical-content"},Aa={class:"medical-date"},Oa={class:"medical-operator"},Ua={class:"add-medical-section"},Da={class:"add-medical-form"},za={class:"form-actions"},$a={key:2,class:"no-medical-info"},La={class:"customer-info-row"},Ra={class:"info-item notes-item"},ja={key:0,class:"notes-content"},Ba={class:"notes-text"},Ga={key:1,class:"notes-edit"},Ja={class:"notes-actions"},Ha={class:"phone-management"},Ma={class:"phone-list"},Fa={key:0,class:"add-phone"},qa={class:"second-row"},Wa={class:"card-header"},Za={class:"card-title"},Ka={class:"stat-item consumption"},Ya={class:"stat-icon"},Qa={class:"stat-content"},Xa={class:"stat-value"},el={class:"stat-item orders"},al={class:"stat-icon"},ll={class:"stat-content"},tl={class:"stat-value"},sl={class:"stat-item returns"},ol={class:"stat-icon"},nl={class:"stat-content"},il={class:"stat-value"},rl={class:"stat-item last-order"},ul={class:"stat-icon"},dl={class:"stat-content"},cl={class:"stat-value"},ml={class:"tab-content"},pl={class:"tab-header"},vl={class:"amount"},fl={class:"tab-content"},hl={class:"tab-header"},yl={key:0,class:"amount"},gl={key:1},_l={class:"tab-content"},wl={class:"tab-header"},bl={class:"tab-content"},kl={class:"tab-header"},Cl={class:"timeline-container"},Vl={class:"timeline-header"},Il={class:"timeline-title"},Tl={class:"timeline-content"},Pl={class:"timeline-footer"},Nl={class:"timeline-author"},xl={key:0,class:"timeline-actions"},Sl={class:"tab-content"},El={class:"tab-header"},Al={class:"tags-container"},Ol={class:"template-select-wrapper"},Ul={class:"template-preview"},Dl={class:"preview-title"},zl={class:"preview-content"},$l={class:"template-variables"},Ll={class:"send-limit-info"},Rl=d(c({__name:"Detail",setup(e){const d=m(),c=p(),re=a(),ue=l(),Rl=se(),jl=t(),Bl=oe(),Gl=r(c),Jl=e=>{const a=re.currentUser;return a?"admin"===a.role?e:"department_manager"===a.role?e.filter(e=>{const l=re.getUserById(e.createdBy);return l?.department===a.department}):"sales_staff"===a.role?e.filter(e=>e.createdBy===a.id):"customer_service"===a.role?e.filter(e=>e.servicePersonId===a.id):e.filter(e=>e.createdBy===a.id):[]},Hl=v("orders"),Ml=v(!1),Fl=v(!1),ql=v(!1),Wl=v(!1),Zl=v(!1),Kl=v(""),Yl=v(!1),Ql=v(!1),Xl=v(!1),et=v(!1),at=v(!1),lt=v(!1),tt=v(!1),st=v(!1),ot=v(!1),nt=v([]),it=v({todayCount:0,monthCount:0}),rt=f({phone:"",templateId:"",variables:{}}),ut={phone:[{required:!0,message:"è¯·é€‰æ‹©æŽ¥æ”¶å·ç ",trigger:"change"}],templateId:[{required:!0,message:"è¯·é€‰æ‹©çŸ­ä¿¡æ¨¡æ¿",trigger:"change"}]},dt=v({id:"",code:"",name:"",phone:"",email:"",address:"",level:"",gender:"",birthday:"",salesPerson:"",createdAt:"",improvementGoals:[]}),ct=v({totalConsumption:0,orderCount:0,returnCount:0,lastOrderDate:""}),mt=f({code:"",name:"",phone:"",email:"",address:"",level:"",gender:"",birthday:"",salesperson:"",age:null,height:null,weight:null,wechatId:"",source:""}),pt=v([]),vt=v(""),ft=v(!1),ht=v([]),yt=v(!1),gt=v(!1),_t=v(""),wt=v(!1),bt=v(!1),kt=v(""),Ct=v(!1),Vt=f({phone:"",purpose:"",note:""}),It=f({type:"",title:"",content:"",nextFollowUp:""}),Tt=v(!1),Pt=v(""),Nt=f({name:"",type:""}),xt={type:[{required:!0,message:"è¯·é€‰æ‹©è·Ÿè¿›ç±»åž‹",trigger:"change"}],title:[{required:!0,message:"è¯·è¾“å…¥è·Ÿè¿›æ ‡é¢˜",trigger:"blur"}],content:[{required:!0,message:"è¯·è¾“å…¥è·Ÿè¿›å†…å®¹",trigger:"blur"}]},St=v([]),Et=v([]),At=v([]),Ot=v([]),Ut=v([]),Dt=v();h(()=>{const e=re.currentUser;if(!e)return!1;if(re.isSuperAdmin)return!0;if(re.isDepartmentLeader){if(dt.value.createdBy===e.id||dt.value.salesPersonId===e.id)return!0;const a=re.users.find(e=>e.id===dt.value.createdBy),l=re.users.find(e=>e.id===dt.value.salesPersonId);return a&&a.departmentId===e.departmentId||l&&l.departmentId===e.departmentId}return dt.value.createdBy===e.id||dt.value.salesPersonId===e.id});const zt=h(()=>Kl.value?St.value.filter(e=>e.orderNo.includes(Kl.value)||e.products.includes(Kl.value)):St.value),$t=h(()=>nt.value.find(e=>e.id===rt.templateId)),Lt=h(()=>{if(!$t.value)return"";let e=$t.value.content;return $t.value.variables&&$t.value.variables.forEach(a=>{const l=rt.variables[a.key]||`{${a.key}}`;e=e.replace(new RegExp(`\\{${a.key}\\}`,"g"),l)}),e}),Rt=h(()=>it.value.todayCount<1&&it.value.monthCount<5&&rt.phone&&rt.templateId),jt=()=>{Gl.push("/customer/list")},Bt=()=>{dt.value.phone?Vt.phone=dt.value.phone:dt.value.otherPhones&&dt.value.otherPhones.length>0?Vt.phone=dt.value.otherPhones[0]:Vt.phone="",Yl.value=!0},Gt=()=>{dt.value.phone||dt.value.otherPhones&&0!==dt.value.otherPhones.length?(rt.phone=dt.value.phone||dt.value.otherPhones&&dt.value.otherPhones[0]||"",rt.templateId="",rt.variables={},qt(),Wt(),et.value=!0):le.warning("è¯¥å®¢æˆ·æ²¡æœ‰æ‰‹æœºå·ç ï¼Œæ— æ³•å‘é€çŸ­ä¿¡")},Jt=()=>{at.value=!0},Ht=e=>{console.log("æ¨¡æ¿ç”³è¯·æ•°æ®:",e),le.success("æ¨¡æ¿ç”³è¯·å·²æäº¤ï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸"),at.value=!1,qt()},Mt=()=>{rt.variables={},$t.value&&$t.value.variables&&$t.value.variables.forEach(e=>{rt.variables[e.key]=e.defaultValue||""})},Ft=async()=>{try{if(await Dt.value.validate(),!Rt.value)return void le.warning("å·²è¾¾åˆ°å‘é€é™åˆ¶ï¼Œæ— æ³•å‘é€çŸ­ä¿¡");ot.value=!0;dt.value.id,rt.phone,rt.templateId,rt.variables,Lt.value;await new Promise(e=>setTimeout(e,2e3)),le.success("çŸ­ä¿¡å‘é€æˆåŠŸï¼Œç­‰å¾…å®¡æ ¸"),et.value=!1,Wt()}catch(e){console.error("å‘é€çŸ­ä¿¡å¤±è´¥:",e),le.error("å‘é€çŸ­ä¿¡å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{ot.value=!1}},qt=async()=>{try{nt.value=[{id:"1",name:"å®¢æˆ·é—®å€™æ¨¡æ¿",content:"å°Šæ•¬çš„{customerName}ï¼Œæ„Ÿè°¢æ‚¨é€‰æ‹©æˆ‘ä»¬çš„æœåŠ¡ï¼å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ä»¬ã€‚",variables:[{key:"customerName",label:"å®¢æˆ·å§“å",placeholder:"è¯·è¾“å…¥å®¢æˆ·å§“å",defaultValue:dt.value.name}],status:"approved"},{id:"2",name:"é¢„çº¦æé†’æ¨¡æ¿",content:"å°Šæ•¬çš„{customerName}ï¼Œæ‚¨é¢„çº¦çš„{serviceName}å°†åœ¨{appointmentTime}å¼€å§‹ï¼Œè¯·å‡†æ—¶åˆ°è¾¾ã€‚",variables:[{key:"customerName",label:"å®¢æˆ·å§“å",placeholder:"è¯·è¾“å…¥å®¢æˆ·å§“å",defaultValue:dt.value.name},{key:"serviceName",label:"æœåŠ¡åç§°",placeholder:"è¯·è¾“å…¥æœåŠ¡åç§°"},{key:"appointmentTime",label:"é¢„çº¦æ—¶é—´",placeholder:"è¯·è¾“å…¥é¢„çº¦æ—¶é—´"}],status:"approved"},{id:"3",name:"æ´»åŠ¨é€šçŸ¥æ¨¡æ¿",content:"äº²çˆ±çš„{customerName}ï¼Œæˆ‘ä»¬æœ‰æ–°çš„ä¼˜æƒ æ´»åŠ¨ï¼š{activityName}ï¼Œè¯¦æƒ…è¯·å’¨è¯¢å®¢æœã€‚",variables:[{key:"customerName",label:"å®¢æˆ·å§“å",placeholder:"è¯·è¾“å…¥å®¢æˆ·å§“å",defaultValue:dt.value.name},{key:"activityName",label:"æ´»åŠ¨åç§°",placeholder:"è¯·è¾“å…¥æ´»åŠ¨åç§°"}],status:"approved"}]}catch(e){console.error("åŠ è½½çŸ­ä¿¡æ¨¡æ¿å¤±è´¥:",e),le.error("åŠ è½½çŸ­ä¿¡æ¨¡æ¿å¤±è´¥")}},Wt=async()=>{try{it.value={todayCount:0,monthCount:2}}catch(e){console.error("åŠ è½½çŸ­ä¿¡ç»Ÿè®¡å¤±è´¥:",e)}},Zt=()=>{Ql.value=!0},Kt=()=>{Ml.value=!0,Object.assign(mt,dt.value),pt.value=dt.value.otherPhones||[]},Yt=e=>({bronze:"",silver:"info",gold:"warning",diamond:"danger",normal:"",vip:"warning",svip:"danger","æ™®é€šå®¢æˆ·":"","VIPå®¢æˆ·":"warning","SVIPå®¢æˆ·":"danger"}[e]||""),Qt=e=>({bronze:"é“œç‰Œå®¢æˆ·",silver:"é“¶ç‰Œå®¢æˆ·",gold:"é‡‘ç‰Œå®¢æˆ·",diamond:"é’»çŸ³å®¢æˆ·",normal:"é“œç‰Œå®¢æˆ·",vip:"é‡‘ç‰Œå®¢æˆ·",svip:"é’»çŸ³å®¢æˆ·","æ™®é€šå®¢æˆ·":"é“œç‰Œå®¢æˆ·","VIPå®¢æˆ·":"é‡‘ç‰Œå®¢æˆ·","SVIPå®¢æˆ·":"é’»çŸ³å®¢æˆ·"}[e]||"é“œç‰Œå®¢æˆ·"),Xt=e=>({"ç”µè¯è·Ÿè¿›":"primary","å¾®ä¿¡æ²Ÿé€š":"success","ä¸Šé—¨æ‹œè®¿":"warning","é‚®ä»¶è”ç³»":"info","å…¶ä»–":""}[e]||""),es=e=>({high_value:"é«˜ä»·å€¼å®¢æˆ·",potential:"æ½œåœ¨å®¢æˆ·",loyal:"å¿ å®žå®¢æˆ·",new:"æ–°å®¢æˆ·",inactive:"ä¸æ´»è·ƒå®¢æˆ·",complaint:"æŠ•è¯‰å®¢æˆ·",vip:"VIPå®¢æˆ·"}[e]||e),as=e=>({"ä¼˜è´¨å®¢æˆ·":"success","é‡ç‚¹å…³æ³¨":"warning","é«˜æ¶ˆè´¹":"danger","æ½œåœ¨å®¢æˆ·":"info","å¿ å®žå®¢æˆ·":"success","æ–°å®¢æˆ·":"primary","ä¸æ´»è·ƒå®¢æˆ·":"","æŠ•è¯‰å®¢æˆ·":"danger","VIPå®¢æˆ·":"warning"}[e]||"info"),ls=()=>{Ml.value?ts():(Ml.value=!0,Object.assign(mt,dt.value),pt.value=dt.value.otherPhones||[])},ts=()=>{Ml.value=!1,Object.assign(mt,dt.value),pt.value=[],ft.value=!1,vt.value=""},ss=async()=>{Fl.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),Object.assign(dt.value,mt),dt.value.otherPhones=[...pt.value],Ml.value=!1,le.success("ä¿å­˜æˆåŠŸ")}catch(e){le.error("ä¿å­˜å¤±è´¥")}finally{Fl.value=!1}},os=()=>{if(!vt.value.trim())return void le.warning("è¯·è¾“å…¥æ‰‹æœºå·");/^1[3-9]\d{9}$/.test(vt.value)?pt.value.includes(vt.value)||mt.phone===vt.value?le.warning("è¯¥æ‰‹æœºå·å·²å­˜åœ¨"):(pt.value.push(vt.value),vt.value="",ft.value=!1,le.success("æ·»åŠ æˆåŠŸ")):le.warning("è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·æ ¼å¼")},ns=()=>{vt.value="",ft.value=!1},is=async()=>{if(_t.value.trim()){wt.value=!0;try{await new Promise(e=>setTimeout(e,1e3));const e={id:Date.now(),content:_t.value.trim(),createTime:(new Date).toISOString(),operator:"å½“å‰ç”¨æˆ·",operationType:"add"};ht.value.unshift(e),_t.value="",gt.value=!1,le.success("ç–¾ç—…ä¿¡æ¯æ·»åŠ æˆåŠŸ")}catch(e){le.error("æ·»åŠ å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{wt.value=!1}}else le.warning("è¯·è¾“å…¥ç–¾ç—…ä¿¡æ¯")},rs=()=>{_t.value="",gt.value=!1},us=()=>{kt.value=dt.value.notes||"",bt.value=!0},ds=()=>{kt.value="",bt.value=!1},cs=async()=>{Ct.value=!0;try{await new Promise(e=>setTimeout(e,800)),dt.value.notes=kt.value.trim(),bt.value=!1,kt.value="",le.success("å®¢æˆ·å¤‡æ³¨ä¿å­˜æˆåŠŸ")}catch(e){le.error("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{Ct.value=!1}},ms=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),ps=async()=>{if(dt.value.code)try{await n(dt.value.code),le.success("å®¢æˆ·ç¼–ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch(e){le.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")}else le.warning("å®¢æˆ·ç¼–ç ä¸ºç©º")},vs=()=>{Vt.phone=dt.value.phone,Yl.value=!0},fs=e=>{let a=e;a=(11===e.length&&e.startsWith("1")||/^\d{7,8}$/.test(e),e),Vt.phone=a,Yl.value=!0},hs=async()=>{const e=o.checkCallPermission(re.userInfo?.id||"guest",i.MAKE_CALL);if(e.hasAccess){lt.value=!0;try{const e={customerId:d.params.id,customerName:dt.value.name,phone:Vt.phone,purpose:Vt.purpose,notes:Vt.notes,type:"outbound"};await Bl.startCall(e),le.success("é€šè¯å·²å‘èµ·"),Yl.value=!1,await As()}catch(a){console.error("å¤–å‘¼å¤±è´¥:",a),le.error("å¤–å‘¼å¤±è´¥")}finally{lt.value=!1}}else le.error(e.reason||"æ— æƒé™å‘èµ·é€šè¯")},ys=()=>{Gl.push({path:"/order/add",query:{customerId:d.params.id,customerName:dt.value.name,customerPhone:dt.value.phone,customerEmail:dt.value.email,customerAddress:dt.value.address}})},gs=()=>{Gl.push({path:"/service/add",query:{customerId:d.params.id,customerName:dt.value.name,customerPhone:dt.value.phone,customerEmail:dt.value.email}})},_s=()=>{Tt.value=!1,Pt.value="",It.type="",It.title="",It.content="",It.nextFollowUp="",Ql.value=!0},ws=async()=>{if(It.type&&It.title&&It.content){tt.value=!0;try{const e=d.params.id;if(Tt.value){await he(e,Pt.value,{type:It.type,title:It.title,content:It.content});const a=Ot.value.findIndex(e=>e.id===Pt.value);if(a>-1){const e=Ot.value[a];Ot.value[a]={...e,type:It.type,title:It.title,content:It.content}}le.success("è·Ÿè¿›è®°å½•æ›´æ–°æˆåŠŸ")}else{const a=await fe(e,{type:It.type,title:It.title,content:It.content,author:re.currentUser?.name||"å½“å‰ç”¨æˆ·"});Ot.value.unshift({id:a.id,type:a.type,title:a.title||a.type,content:a.content,createTime:a.createTime,author:a.author||a.createdBy||"æœªçŸ¥",canEdit:!0}),le.success("è·Ÿè¿›è®°å½•ä¿å­˜æˆåŠŸ")}Ql.value=!1,Tt.value=!1,Pt.value="",It.type="",It.title="",It.content="",It.nextFollowUp=""}catch(e){console.error("ä¿å­˜è·Ÿè¿›è®°å½•å¤±è´¥:",e),le.error("ä¿å­˜å¤±è´¥")}finally{tt.value=!1}}else le.warning("è¯·å¡«å†™å®Œæ•´çš„è·Ÿè¿›ä¿¡æ¯")},bs=()=>{Nt.name="",Nt.type="",Xl.value=!0},ks=async()=>{if(Nt.name.trim()){st.value=!0;try{const e=d.params.id,a=await ge(e,{name:Nt.name,type:Nt.type});Ut.value.push({id:a.id,name:a.name,type:a.type}),le.success("æ ‡ç­¾æ·»åŠ æˆåŠŸ"),Xl.value=!1}catch(e){console.error("æ·»åŠ æ ‡ç­¾å¤±è´¥:",e),le.error("æ·»åŠ å¤±è´¥")}finally{st.value=!1}}else le.warning("è¯·è¾“å…¥æ ‡ç­¾åç§°")},Cs=e=>{const a=e.props.name;"orders"===a&&0===St.value.length?Ps():"service"===a&&0===Et.value.length?Es():"calls"===a&&0===At.value.length?As():"followup"===a&&0===Ot.value.length&&Os()},Vs=e=>{const a=new Date(e);return((new Date).getTime()-a.getTime())/36e5<=24},Is=()=>{Ql.value=!1,Tt.value=!1,Pt.value="",It.type="",It.title="",It.content="",It.nextFollowUp=""},Ts=async()=>{try{const l=d.params.id,t=d.query.code;if(t&&!l){const e=jl.getCustomerByCode(t);return e?void Gl.replace(`/customer/detail/${e.id}`):(le.error("æœªæ‰¾åˆ°å¯¹åº”çš„å®¢æˆ·ä¿¡æ¯"),void Gl.push("/customer/list"))}if(!l)return le.error("å®¢æˆ·IDä¸èƒ½ä¸ºç©º"),void Gl.push("/customer/list");const{isProduction:s}=await u(async()=>{const{isProduction:e}=await import("./env-DLalhsF6.js");return{isProduction:e}},[]),{shouldUseMockApi:o}=await u(async()=>{const{shouldUseMockApi:e}=await import("./index-DkAJPKqn.js").then(e=>e.R);return{shouldUseMockApi:e}},__vite__mapDeps([0,1,2,3,4]));let n=null;if(s()||!o()){console.log("[CustomerDetail] ðŸŒ ç”Ÿäº§çŽ¯å¢ƒï¼šä»ŽAPIèŽ·å–å®¢æˆ·è¯¦æƒ…");try{const{customerApi:e}=await u(async()=>{const{customerApi:e}=await import("./index-DkAJPKqn.js").then(e=>e.V);return{customerApi:e}},__vite__mapDeps([0,1,2,3,4])),a=await e.getDetail(l);a.data&&(n=a.data,console.log("[CustomerDetail] âœ… APIèŽ·å–æˆåŠŸ"))}catch(e){console.error("[CustomerDetail] âŒ APIèŽ·å–å¤±è´¥ï¼Œå°è¯•ä»Žæœ¬åœ°ç¼“å­˜èŽ·å–:",e),n=jl.customers.find(e=>e.id===l)}}else console.log("[CustomerDetail] ðŸ’» å¼€å‘çŽ¯å¢ƒï¼šä»ŽstoreèŽ·å–å®¢æˆ·ä¿¡æ¯"),n=jl.customers.find(e=>e.id===l);if(!n)return le.error("æœªæ‰¾åˆ°å®¢æˆ·ä¿¡æ¯"),void Gl.push("/customer/list");console.log("æ‰¾åˆ°å®¢æˆ·ä¿¡æ¯:",n),dt.value={id:n.id,code:n.code||"ZS202401201420",name:n.name,phone:n.phone,email:n.email||"",address:n.address||"",level:n.level||"VIPå®¢æˆ·",gender:n.gender||"ç”·",birthday:n.birthday||"1990-01-01",age:n.age||34,height:n.height||175,weight:n.weight||70,wechatId:n.wechatId||"",salesperson:n.salesperson||"æŽé”€å”®",createTime:n.createTime||"2023-01-15",joinTime:n.joinTime||"2023-01-10",source:n.source||"æœ‹å‹æŽ¨è",medicalHistory:n.medicalHistory||"",tags:n.tags||["ä¼˜è´¨å®¢æˆ·","é‡ç‚¹å…³æ³¨","é«˜æ¶ˆè´¹"],improvementGoals:n.improvementGoals||["å‡è‚¥","é™è¡€åŽ‹","æ”¹å–„ç¡çœ "],otherPhones:n.otherPhones||[],notes:n.notes||"å®¢æˆ·å¯¹äº§å“å¾ˆæ»¡æ„ï¼Œå»ºè®®å®šæœŸå›žè®¿ã€‚"};try{const e=await ve(l);Ut.value=e.map(e=>({id:e.id,name:e.name,type:e.type||"info"}))}catch(a){console.error("åŠ è½½å®¢æˆ·æ ‡ç­¾å¤±è´¥:",a),Ut.value=[]}ht.value=[{id:1,content:"é«˜è¡€åŽ‹ï¼Œéœ€è¦å®šæœŸç›‘æµ‹è¡€åŽ‹ï¼ŒæŽ§åˆ¶é¥®é£Ÿ",createTime:"2024-01-15T10:30:00.000Z",operator:"æŽåŒ»ç”Ÿ",operationType:"add"},{id:2,content:"ç³–å°¿ç—…ï¼Œéœ€è¦æŽ§åˆ¶è¡€ç³–ï¼Œå®šæœŸæ£€æŸ¥",createTime:"2023-12-20T14:20:00.000Z",operator:"çŽ‹åŒ»ç”Ÿ",operationType:"add"},{id:3,content:"è½»å¾®è„‚è‚ªè‚ï¼Œå»ºè®®å‡å°‘æ²¹è…»é£Ÿç‰©æ‘„å…¥",createTime:"2023-11-10T09:15:00.000Z",operator:"å¼ åŒ»ç”Ÿ",operationType:"add"}]}catch(a){console.error("åŠ è½½å®¢æˆ·è¯¦æƒ…å¤±è´¥:",a),le.error("åŠ è½½å®¢æˆ·è¯¦æƒ…å¤±è´¥")}},Ps=async()=>{ql.value=!0;try{const e=d.params.id,a=await de(e);St.value=a.map(e=>({id:e.id,orderNo:e.orderNumber||e.orderNo,products:e.products?e.products.map(e=>e.name).join(", "):e.productNames||"æš‚æ— å•†å“ä¿¡æ¯",totalAmount:e.totalAmount||e.amount||0,status:Ns(e.status),orderDate:e.createTime||e.orderDate}))}catch(e){console.error("åŠ è½½è®¢å•åŽ†å²å¤±è´¥:",e),e?.message?.includes("404")||e?.message?.includes("APIç«¯ç‚¹ä¸å­˜åœ¨")||le.error("åŠ è½½è®¢å•åŽ†å²å¤±è´¥"),St.value=[]}finally{ql.value=!1}},Ns=e=>({pending:"å¾…ç¡®è®¤",confirmed:"å·²ç¡®è®¤",shipped:"å·²å‘è´§",delivered:"å·²å®Œæˆ",cancelled:"å·²å–æ¶ˆ",draft:"è‰ç¨¿"}[e]||e),xs=e=>({return:"é€€è´§",exchange:"æ¢è´§",repair:"ç»´ä¿®",refund:"é€€æ¬¾"}[e]||e),Ss=e=>({pending:"å¾…å¤„ç†",processing:"å¤„ç†ä¸­",resolved:"å·²è§£å†³",closed:"å·²å…³é—­"}[e]||e),Es=async()=>{Wl.value=!0;try{const e=d.params.id,a=await ce(e);Et.value=a.map(e=>({id:e.id,serviceNo:e.serviceNumber||e.serviceNo,orderNo:e.orderNumber||e.orderNo,type:xs(e.serviceType||e.type),reason:e.reason||e.description||"æš‚æ— æè¿°",amount:e.price||e.amount||0,status:Ss(e.status),createTime:e.createTime}))}catch(e){console.error("åŠ è½½å”®åŽè®°å½•å¤±è´¥:",e),e?.message?.includes("404")||e?.message?.includes("APIç«¯ç‚¹ä¸å­˜åœ¨")||le.error("åŠ è½½å”®åŽè®°å½•å¤±è´¥"),Et.value=[]}finally{Wl.value=!1}},As=async()=>{Zl.value=!0;try{const e=d.params.id,a=await me(e);At.value=a.map(e=>({id:e.id,callType:"outbound"===e.direction||"å‘¼å‡º"===e.type?"å‘¼å‡º":"å‘¼å…¥",phone:e.customerPhone||e.phone,duration:e.duration?`${Math.floor(e.duration/60)}åˆ†${e.duration%60}ç§’`:"-",status:"connected"===e.status||"å·²æŽ¥é€š"===e.status?"å·²æŽ¥é€š":"busy"===e.status||"å¿™çº¿"===e.status?"å¿™çº¿":"no_answer"===e.status||"æœªæŽ¥å¬"===e.status?"æœªæŽ¥å¬":"failed"===e.status||"å¤±è´¥"===e.status?"å¤±è´¥":"æœªçŸ¥",summary:e.summary||e.remark||"-",callTime:e.startTime||e.callTime}))}catch(e){console.error("åŠ è½½é€šè¯è®°å½•å¤±è´¥:",e),e?.message?.includes("404")||e?.message?.includes("APIç«¯ç‚¹ä¸å­˜åœ¨")||le.error("åŠ è½½é€šè¯è®°å½•å¤±è´¥"),At.value=[]}finally{Zl.value=!1}},Os=async()=>{try{const e=d.params.id,a=await pe(e);Ot.value=a.map(e=>{const a=new Date(e.createTime),l=((new Date).getTime()-a.getTime())/36e5;return{id:e.id,type:e.type,title:e.title||e.type,content:e.content,createTime:e.createTime,author:e.author||e.createdBy||"æœªçŸ¥",canEdit:l<=24}})}catch(e){console.error("åŠ è½½è·Ÿè¿›è®°å½•å¤±è´¥:",e),e?.message?.includes("404")||e?.message?.includes("APIç«¯ç‚¹ä¸å­˜åœ¨")||le.error("åŠ è½½è·Ÿè¿›è®°å½•å¤±è´¥"),Ot.value=[]}};y(()=>d.params.id,e=>{e&&Ts()});const Us=()=>{const e=d.params.id,a=Jl(ue.orders).filter(a=>a.customerId===e),l=Rl.services.filter(a=>a.customerId===e),t=a.filter(e=>"approved"===e.auditStatus).reduce((e,a)=>e+a.totalAmount,0),s=a.length,o=l.filter(e=>"return"===e.serviceType).length,n=a.length>0?a.sort((e,a)=>new Date(a.createTime).getTime()-new Date(e.createTime).getTime())[0].createTime:"";ct.value={totalConsumption:t,orderCount:s,returnCount:o,lastOrderDate:n}};return y(()=>ue.orders,()=>{const e=d.params.id,a=Jl(ue.orders).filter(a=>a.customerId===e).map(e=>({id:e.id,orderNo:e.orderNumber,products:e.products.map(e=>e.name).join(", "),totalAmount:e.totalAmount,status:Ns(e.status),orderDate:e.createTime}));St.value=a,Us()},{deep:!0}),y(()=>Rl.services,()=>{const e=d.params.id,a=Rl.services.filter(a=>a.customerId===e).map(e=>({id:e.id,serviceNo:e.serviceNumber,orderNo:e.orderNumber,type:xs(e.serviceType),reason:e.reason,amount:e.price||0,status:Ss(e.status),createTime:e.createTime}));Et.value=a,Us()},{deep:!0}),g(()=>{Ts(),Ps(),Es(),Us();const e=e=>{const{customerId:a}=e.detail;a===d.params.id&&(Ts(),le.success("æ£€æµ‹åˆ°æ‰‹æœºå·æ›´æ–°ï¼Œå·²åˆ·æ–°å®¢æˆ·ä¿¡æ¯"))};window.addEventListener("customer-phone-updated",e),_(()=>{window.removeEventListener("customer-phone-updated",e)})}),(e,a)=>{const l=w("el-button"),t=w("el-tag"),n=w("el-icon"),r=w("el-collapse-transition"),u=w("el-input"),c=w("el-tooltip"),m=w("el-form-item"),p=w("el-col"),v=w("el-row"),f=w("el-option"),h=w("el-select"),y=w("el-input-number"),g=w("el-date-picker"),_=w("el-form"),se=w("el-card"),oe=w("el-table-column"),ue=w("el-table"),de=w("el-tab-pane"),ce=w("el-dropdown-item"),me=w("el-dropdown-menu"),pe=w("el-dropdown"),ve=w("el-timeline-item"),fe=w("el-timeline"),he=w("el-tabs"),ge=w("el-dialog"),Rl=w("el-alert"),jl=b("loading");return C(),k("div",we,[V("div",be,[V("div",ke,[I(l,{icon:T(z),onClick:jt,class:"back-btn"},null,8,["icon"]),V("div",Ce,[V("h2",null,P(dt.value.name),1),I(t,{type:Yt(dt.value.level),size:"large"},{default:N(()=>[x(P(Qt(dt.value.level)),1)]),_:1},8,["type"])])]),V("div",Ve,[I(l,{type:"primary",icon:T($),onClick:Bt,class:"action-btn"},{default:N(()=>[...a[39]||(a[39]=[x(" æ‹¨æ‰“ç”µè¯ ",-1)])]),_:1},8,["icon"]),I(l,{type:"info",icon:T(L),onClick:Gt,class:"action-btn"},{default:N(()=>[...a[40]||(a[40]=[x(" å‘é€çŸ­ä¿¡ ",-1)])]),_:1},8,["icon"]),I(l,{type:"success",icon:T(R),onClick:ys,class:"action-btn"},{default:N(()=>[...a[41]||(a[41]=[x(" æ–°å»ºè®¢å• ",-1)])]),_:1},8,["icon"]),I(l,{type:"warning",icon:T(j),onClick:Zt,class:"action-btn"},{default:N(()=>[...a[42]||(a[42]=[x(" æ·»åŠ è·Ÿè¿› ",-1)])]),_:1},8,["icon"]),I(l,{icon:T(B),onClick:Kt,class:"action-btn edit-btn"},{default:N(()=>[...a[43]||(a[43]=[x(" ç¼–è¾‘å®¢æˆ· ",-1)])]),_:1},8,["icon"])])]),V("div",Ie,[I(se,{class:"customer-info-card",shadow:"hover"},{header:N(()=>[V("div",Te,[V("span",Pe,[I(n,null,{default:N(()=>[I(T(q))]),_:1}),a[44]||(a[44]=x(" å®¢æˆ·ä¿¡æ¯ ",-1))]),Ml.value?(C(),k("div",Ne,[I(l,{type:"primary",size:"small",onClick:ss},{default:N(()=>[...a[46]||(a[46]=[x("ä¿å­˜",-1)])]),_:1}),I(l,{size:"small",onClick:ts},{default:N(()=>[...a[47]||(a[47]=[x("å–æ¶ˆ",-1)])]),_:1})])):(C(),S(l,{key:0,type:"text",onClick:ls,icon:T(M)},{default:N(()=>[...a[45]||(a[45]=[x("ç¼–è¾‘",-1)])]),_:1},8,["icon"]))])]),default:N(()=>{return[Ml.value?(C(),S(_,{key:1,model:mt,"label-width":"80px",class:"edit-form"},{default:N(()=>[I(v,{gutter:24},{default:N(()=>[I(p,{span:8},{default:N(()=>[I(m,{label:"å®¢æˆ·ç¼–ç "},{default:N(()=>[I(u,{modelValue:mt.code,"onUpdate:modelValue":a[5]||(a[5]=e=>mt.code=e),readonly:""},{suffix:N(()=>[I(c,{content:"å®¢æˆ·ç¼–ç è‡ªåŠ¨ç”Ÿæˆï¼Œä¸å¯ä¿®æ”¹"},{default:N(()=>[I(n,null,{default:N(()=>[I(T(F))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),I(p,{span:8},{default:N(()=>[I(m,{label:"å§“å"},{default:N(()=>[I(u,{modelValue:mt.name,"onUpdate:modelValue":a[6]||(a[6]=e=>mt.name=e)},null,8,["modelValue"])]),_:1})]),_:1}),I(p,{span:8},{default:N(()=>[I(m,{label:"ä¸»æ‰‹æœºå·"},{default:N(()=>[I(u,{value:T(ne)(mt.phone,T(s).PHONE),readonly:""},{suffix:N(()=>[I(c,{content:"æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†æ˜¾ç¤ºï¼Œä¸å¯ä¿®æ”¹"},{default:N(()=>[I(n,null,{default:N(()=>[I(T(F))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),I(p,{span:8},{default:N(()=>[I(m,{label:"é‚®ç®±"},{default:N(()=>[I(u,{value:T(ne)(mt.email,T(s).EMAIL),readonly:""},{suffix:N(()=>[I(c,{content:"æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†æ˜¾ç¤ºï¼Œä¸å¯ä¿®æ”¹"},{default:N(()=>[I(n,null,{default:N(()=>[I(T(F))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),I(v,{gutter:24},{default:N(()=>[I(p,{span:24},{default:N(()=>[I(m,{label:"å…¶ä»–æ‰‹æœºå·"},{default:N(()=>[V("div",Ha,[V("div",Ma,[(C(!0),k(E,null,O(pt.value,(e,a)=>(C(),S(t,{key:a,closable:"",onClose:e=>(e=>{pt.value.splice(e,1),le.success("åˆ é™¤æˆåŠŸ")})(a),class:"phone-tag"},{default:N(()=>[x(P(T(ne)(e,T(s).PHONE)),1)]),_:2},1032,["onClose"]))),128)),ft.value?A("",!0):(C(),S(l,{key:0,type:"primary",plain:"",size:"small",onClick:a[7]||(a[7]=e=>ft.value=!0),icon:T(H)},{default:N(()=>[...a[74]||(a[74]=[x(" æ·»åŠ æ‰‹æœºå· ",-1)])]),_:1},8,["icon"]))]),ft.value?(C(),k("div",Fa,[I(u,{modelValue:vt.value,"onUpdate:modelValue":a[8]||(a[8]=e=>vt.value=e),placeholder:"è¯·è¾“å…¥æ‰‹æœºå·",style:{width:"200px","margin-right":"10px"}},null,8,["modelValue"]),I(l,{type:"primary",size:"small",onClick:os},{default:N(()=>[...a[75]||(a[75]=[x("ç¡®è®¤",-1)])]),_:1}),I(l,{size:"small",onClick:ns},{default:N(()=>[...a[76]||(a[76]=[x("å–æ¶ˆ",-1)])]),_:1})])):A("",!0)])]),_:1})]),_:1})]),_:1}),I(v,{gutter:24},{default:N(()=>[I(p,{span:8},{default:N(()=>[I(m,{label:"å®¢æˆ·ç­‰çº§"},{default:N(()=>[I(h,{modelValue:mt.level,"onUpdate:modelValue":a[9]||(a[9]=e=>mt.level=e),placeholder:"è¯·é€‰æ‹©"},{default:N(()=>[I(f,{label:"é“œç‰Œå®¢æˆ·",value:"bronze"}),I(f,{label:"é“¶ç‰Œå®¢æˆ·",value:"silver"}),I(f,{label:"é‡‘ç‰Œå®¢æˆ·",value:"gold"}),I(f,{label:"é’»çŸ³å®¢æˆ·",value:"diamond"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),I(p,{span:8},{default:N(()=>[I(m,{label:"å¹´é¾„"},{default:N(()=>[I(y,{modelValue:mt.age,"onUpdate:modelValue":a[10]||(a[10]=e=>mt.age=e),min:0,max:150,placeholder:"è¯·è¾“å…¥å¹´é¾„"},null,8,["modelValue"])]),_:1})]),_:1}),I(p,{span:8},{default:N(()=>[I(m,{label:"èº«é«˜(cm)"},{default:N(()=>[I(y,{modelValue:mt.height,"onUpdate:modelValue":a[11]||(a[11]=e=>mt.height=e),min:0,max:300,placeholder:"è¯·è¾“å…¥èº«é«˜"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),I(v,{gutter:24},{default:N(()=>[I(p,{span:8},{default:N(()=>[I(m,{label:"ä½“é‡(kg)"},{default:N(()=>[I(y,{modelValue:mt.weight,"onUpdate:modelValue":a[12]||(a[12]=e=>mt.weight=e),min:0,max:500,placeholder:"è¯·è¾“å…¥ä½“é‡"},null,8,["modelValue"])]),_:1})]),_:1}),I(p,{span:8},{default:N(()=>[I(m,{label:"æ€§åˆ«"},{default:N(()=>[I(h,{modelValue:mt.gender,"onUpdate:modelValue":a[13]||(a[13]=e=>mt.gender=e),placeholder:"è¯·é€‰æ‹©"},{default:N(()=>[I(f,{label:"ç”·",value:"ç”·"}),I(f,{label:"å¥³",value:"å¥³"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),I(p,{span:8},{default:N(()=>[I(m,{label:"å®¢æˆ·æ¥æº"},{default:N(()=>[I(h,{modelValue:mt.source,"onUpdate:modelValue":a[14]||(a[14]=e=>mt.source=e),placeholder:"è¯·é€‰æ‹©"},{default:N(()=>[I(f,{label:"æœ‹å‹æŽ¨è",value:"æœ‹å‹æŽ¨è"}),I(f,{label:"çº¿ä¸ŠæŽ¨å¹¿",value:"çº¿ä¸ŠæŽ¨å¹¿"}),I(f,{label:"çº¿ä¸‹é—¨åº—",value:"çº¿ä¸‹é—¨åº—"}),I(f,{label:"ç¤¾äº¤åª’ä½“",value:"ç¤¾äº¤åª’ä½“"}),I(f,{label:"æœç´¢å¼•æ“Ž",value:"æœç´¢å¼•æ“Ž"}),I(f,{label:"å¹¿å‘ŠæŠ•æ”¾",value:"å¹¿å‘ŠæŠ•æ”¾"}),I(f,{label:"å…¶ä»–æ¸ é“",value:"å…¶ä»–æ¸ é“"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),I(v,{gutter:24},{default:N(()=>[I(p,{span:8},{default:N(()=>[I(m,{label:"å¾®ä¿¡å·"},{default:N(()=>[I(u,{value:T(ne)(mt.wechatId,T(s).WECHAT),readonly:""},{suffix:N(()=>[I(c,{content:"æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†æ˜¾ç¤ºï¼Œä¸å¯ä¿®æ”¹"},{default:N(()=>[I(n,null,{default:N(()=>[I(T(F))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),I(p,{span:8},{default:N(()=>[I(m,{label:"ç”Ÿæ—¥"},{default:N(()=>[I(g,{modelValue:mt.birthday,"onUpdate:modelValue":a[15]||(a[15]=e=>mt.birthday=e),type:"date",placeholder:"é€‰æ‹©æ—¥æœŸ"},null,8,["modelValue"])]),_:1})]),_:1}),I(p,{span:8},{default:N(()=>[I(m,{label:"é”€å”®äººå‘˜"},{default:N(()=>[I(u,{modelValue:mt.salesperson,"onUpdate:modelValue":a[16]||(a[16]=e=>mt.salesperson=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),I(v,{gutter:24},{default:N(()=>[I(p,{span:24},{default:N(()=>[I(m,{label:"è¯¦ç»†åœ°å€"},{default:N(()=>[I(u,{modelValue:mt.address,"onUpdate:modelValue":a[17]||(a[17]=e=>mt.address=e),placeholder:"è¯·è¾“å…¥è¯¦ç»†åœ°å€"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])):(C(),k("div",xe,[V("div",Se,[V("div",Ee,[a[48]||(a[48]=V("span",{class:"field-label"},"å®¢æˆ·å§“å",-1)),V("span",Ae,P(dt.value.name||"æš‚æ— "),1)]),V("div",Oe,[a[49]||(a[49]=V("span",{class:"field-label"},"å®¢æˆ·ç¼–ç ",-1)),V("span",{class:"customer-code-display",onClick:ps,title:"ç‚¹å‡»å¤åˆ¶ç¼–ç ï¼š"+(dt.value.code||"æš‚æ— ")},P(dt.value.code||"æš‚æ— "),9,Ue)]),V("div",De,[a[50]||(a[50]=V("span",{class:"field-label"},"è”ç³»ç”µè¯",-1)),V("div",ze,[dt.value.phone||dt.value.otherPhones&&dt.value.otherPhones.length>0?(C(),k(E,{key:0},[dt.value.phone?(C(),k("span",{key:0,class:"phone-display",onClick:a[0]||(a[0]=e=>fs(dt.value.phone))},[x(P(T(ne)(dt.value.phone,T(s).PHONE))+" ",1),I(n,{class:"call-icon"},{default:N(()=>[I(T($))]),_:1})])):A("",!0),(C(!0),k(E,null,O(dt.value.otherPhones,e=>(C(),k("span",{key:e,class:"phone-display",onClick:a=>fs(e)},[x(P(T(ne)(e,T(s).PHONE))+" ",1),I(n,{class:"call-icon"},{default:N(()=>[I(T($))]),_:1})],8,$e))),128))],64)):(C(),k("span",Le,"æš‚æ— "))])])]),V("div",Re,[V("div",je,[a[51]||(a[51]=V("span",{class:"field-label"},"å®¢æˆ·ç­‰çº§",-1)),dt.value.level?(C(),S(t,{key:0,type:Yt(dt.value.level),class:"level-tag",size:"small"},{default:N(()=>[x(P(Qt(dt.value.level)),1)]),_:1},8,["type"])):(C(),k("span",Be,"æš‚æ— "))]),V("div",Ge,[a[52]||(a[52]=V("span",{class:"field-label"},"å¹´é¾„",-1)),V("span",Je,P(dt.value.age?dt.value.age+"å²":"æš‚æ— "),1)]),V("div",He,[a[53]||(a[53]=V("span",{class:"field-label"},"èº«é«˜",-1)),V("span",Me,P(dt.value.height?dt.value.height+"cm":"æš‚æ— "),1)]),V("div",Fe,[a[54]||(a[54]=V("span",{class:"field-label"},"ä½“é‡",-1)),V("span",qe,P(dt.value.weight?dt.value.weight+"kg":"æš‚æ— "),1)]),V("div",We,[a[55]||(a[55]=V("span",{class:"field-label"},"æ€§åˆ«",-1)),V("span",Ze,P((o=dt.value.gender,{male:"ç”·",female:"å¥³","ç”·":"ç”·","å¥³":"å¥³"}[o]||o||"æš‚æ— ")),1)])]),V("div",Ke,[V("div",Ye,[a[56]||(a[56]=V("span",{class:"field-label"},"å®¢æˆ·æ ‡ç­¾",-1)),dt.value.tags&&dt.value.tags.length>0?(C(),k("div",Qe,[(C(!0),k(E,null,O(dt.value.tags,e=>(C(),S(t,{key:e,type:as(e),size:"small"},{default:N(()=>[x(P(es(e)),1)]),_:2},1032,["type"]))),128))])):(C(),k("span",Xe,"æš‚æ— "))]),V("div",ea,[V("div",aa,[a[57]||(a[57]=V("span",{class:"field-label"},"è¿›ç²‰æ—¶é—´",-1)),V("span",la,P(dt.value.joinTime||"æš‚æ— "),1)]),V("div",ta,[a[58]||(a[58]=V("span",{class:"field-label"},"è´Ÿè´£é”€å”®",-1)),V("span",sa,P(dt.value.salesperson||"æš‚æ— "),1)]),V("div",oa,[a[59]||(a[59]=V("span",{class:"field-label"},"æ”¹å–„é—®é¢˜",-1)),V("span",na,[dt.value.improvementGoals&&dt.value.improvementGoals.length>0?(C(),k("span",ia,P(dt.value.improvementGoals.join("ã€")),1)):(C(),k("span",ra,"æš‚æ— "))])])])]),V("div",ua,[V("div",da,[a[60]||(a[60]=V("span",{class:"field-label"},"åˆ›å»ºæ—¶é—´",-1)),V("span",ca,P(dt.value.createTime||"æš‚æ— "),1)]),V("div",ma,[a[61]||(a[61]=V("span",{class:"field-label"},"å®¢æˆ·æ¥æº",-1)),V("span",pa,P((e=dt.value.source,{online:"çº¿ä¸ŠæŽ¨å¹¿",offline:"çº¿ä¸‹é—¨åº—",referral:"æœ‹å‹æŽ¨è",social:"ç¤¾äº¤åª’ä½“",search:"æœç´¢å¼•æ“Ž",advertisement:"å¹¿å‘ŠæŠ•æ”¾",other:"å…¶ä»–æ¸ é“"}[e]||e||"æš‚æ— ")),1)]),V("div",va,[a[62]||(a[62]=V("span",{class:"field-label"},"å¾®ä¿¡å·",-1)),V("span",fa,P(dt.value.wechatId?T(ne)(dt.value.wechatId,T(s).WECHAT):"æš‚æ— "),1)]),V("div",ha,[a[63]||(a[63]=V("span",{class:"field-label"},"é‚®ç®±",-1)),V("span",ya,P(dt.value.email?T(ne)(dt.value.email,T(s).EMAIL):"æš‚æ— "),1)])]),V("div",ga,[V("div",_a,[a[64]||(a[64]=V("span",{class:"field-label"},"è¯¦ç»†åœ°å€",-1)),V("div",wa,P(dt.value.address||"æš‚æ— "),1)])]),V("div",ba,[V("div",ka,[a[69]||(a[69]=V("span",{class:"field-label"},"ç–¾ç—…å²",-1)),V("div",Ca,[ht.value.length>0?(C(),k("div",Va,[V("div",Ia,[V("span",Ta,P(ht.value[0].content),1),V("span",Pa,P(ms(ht.value[0].createTime)),1),V("span",Na,P(ht.value[0].operator),1)])])):A("",!0),ht.value.length>1?(C(),k("div",xa,[I(l,{type:"text",size:"small",onClick:a[1]||(a[1]=e=>yt.value=!yt.value),class:"toggle-btn"},{default:N(()=>[I(n,null,{default:N(()=>[yt.value?(C(),S(T(J),{key:1})):(C(),S(T(G),{key:0}))]),_:1}),x(" "+P(yt.value?"æ”¶èµ·":"æŸ¥çœ‹")+"åŽ†å²è®°å½• ("+P(ht.value.length-1)+"æ¡) ",1)]),_:1})])):A("",!0),I(r,null,{default:N(()=>[U(V("div",Sa,[(C(!0),k(E,null,O(ht.value.slice(1),(e,a)=>(C(),k("div",{class:"medical-record history-record",key:a},[V("span",Ea,P(e.content),1),V("span",Aa,P(ms(e.createTime)),1),V("span",Oa,P(e.operator),1)]))),128))],512),[[D,yt.value]])]),_:1}),V("div",Ua,[I(l,{type:"primary",size:"small",onClick:a[2]||(a[2]=e=>gt.value=!gt.value),class:"add-medical-btn"},{default:N(()=>[I(n,null,{default:N(()=>[I(T(H))]),_:1}),a[65]||(a[65]=x(" æ–°å¢žç–¾ç—…ä¿¡æ¯ ",-1))]),_:1}),I(r,null,{default:N(()=>[U(V("div",Da,[I(u,{modelValue:_t.value,"onUpdate:modelValue":a[3]||(a[3]=e=>_t.value=e),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥ç–¾ç—…ä¿¡æ¯...",maxlength:"500","show-word-limit":"",class:"medical-input"},null,8,["modelValue"]),V("div",za,[I(l,{size:"small",onClick:rs},{default:N(()=>[...a[66]||(a[66]=[x("å–æ¶ˆ",-1)])]),_:1}),I(l,{type:"primary",size:"small",onClick:is,loading:wt.value},{default:N(()=>[...a[67]||(a[67]=[x(" ä¿å­˜ ",-1)])]),_:1},8,["loading"])])],512),[[D,gt.value]])]),_:1})]),0===ht.value.length?(C(),k("div",$a,[...a[68]||(a[68]=[V("span",{class:"empty-text"},"æš‚æ— ç–¾ç—…å²è®°å½•",-1)])])):A("",!0)])])]),V("div",La,[V("div",Ra,[a[73]||(a[73]=V("span",{class:"field-label"},"å®¢æˆ·å¤‡æ³¨",-1)),bt.value?(C(),k("div",Ga,[I(u,{modelValue:kt.value,"onUpdate:modelValue":a[4]||(a[4]=e=>kt.value=e),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥å®¢æˆ·å¤‡æ³¨...",maxlength:"1000","show-word-limit":"",class:"notes-input"},null,8,["modelValue"]),V("div",Ja,[I(l,{size:"small",onClick:ds},{default:N(()=>[...a[71]||(a[71]=[x("å–æ¶ˆ",-1)])]),_:1}),I(l,{type:"primary",size:"small",onClick:cs,loading:Ct.value},{default:N(()=>[...a[72]||(a[72]=[x(" ä¿å­˜ ",-1)])]),_:1},8,["loading"])])])):(C(),k("div",ja,[V("span",Ba,P(dt.value.notes||"æš‚æ— å¤‡æ³¨"),1),I(l,{type:"text",size:"small",onClick:us,class:"edit-notes-btn"},{default:N(()=>[I(n,null,{default:N(()=>[I(T(M))]),_:1}),a[70]||(a[70]=x(" ç¼–è¾‘ ",-1))]),_:1})]))])])]))];var e,o}),_:1})]),V("div",qa,[I(se,{class:"stats-card",shadow:"hover"},{header:N(()=>[V("div",Wa,[V("span",Za,[I(n,null,{default:N(()=>[I(T(Y))]),_:1}),a[77]||(a[77]=x(" å®¢æˆ·ç»Ÿè®¡ ",-1))])])]),default:N(()=>[I(v,{gutter:24,class:"stats-row"},{default:N(()=>[I(p,{span:6},{default:N(()=>[V("div",Ka,[V("div",Ya,[I(n,null,{default:N(()=>[I(T(W))]),_:1})]),V("div",Qa,[V("div",Xa,"Â¥"+P(ct.value.totalConsumption.toLocaleString()),1),a[78]||(a[78]=V("div",{class:"stat-label"},"ç´¯è®¡æ¶ˆè´¹",-1))])])]),_:1}),I(p,{span:6},{default:N(()=>[V("div",el,[V("div",al,[I(n,null,{default:N(()=>[I(T(R))]),_:1})]),V("div",ll,[V("div",tl,P(ct.value.orderCount),1),a[79]||(a[79]=V("div",{class:"stat-label"},"è®¢å•æ•°é‡",-1))])])]),_:1}),I(p,{span:6},{default:N(()=>[V("div",sl,[V("div",ol,[I(n,null,{default:N(()=>[I(T(Z))]),_:1})]),V("div",nl,[V("div",il,P(ct.value.returnCount),1),a[80]||(a[80]=V("div",{class:"stat-label"},"é€€è´§æ¬¡æ•°",-1))])])]),_:1}),I(p,{span:6},{default:N(()=>[V("div",rl,[V("div",ul,[I(n,null,{default:N(()=>[I(T(K))]),_:1})]),V("div",dl,[V("div",cl,P(ct.value.lastOrderDate||"æš‚æ— "),1),a[81]||(a[81]=V("div",{class:"stat-label"},"æœ€åŽä¸‹å•",-1))])])]),_:1})]),_:1})]),_:1})]),I(se,{class:"tab-card"},{default:N(()=>[I(he,{modelValue:Hl.value,"onUpdate:modelValue":a[19]||(a[19]=e=>Hl.value=e),onTabClick:Cs},{default:N(()=>[I(de,{label:"è®¢å•åŽ†å²",name:"orders"},{default:N(()=>[V("div",ml,[V("div",pl,[I(l,{onClick:ys,icon:"Plus",type:"primary",size:"small"},{default:N(()=>[...a[82]||(a[82]=[x("æ–°å»ºè®¢å•",-1)])]),_:1}),I(u,{modelValue:Kl.value,"onUpdate:modelValue":a[18]||(a[18]=e=>Kl.value=e),placeholder:"æœç´¢è®¢å•å·ã€å•†å“åç§°",style:{width:"300px"},clearable:""},{prefix:N(()=>[I(n,null,{default:N(()=>[I(T(Q))]),_:1})]),_:1},8,["modelValue"])]),U((C(),S(ue,{data:zt.value,style:{width:"100%"}},{default:N(()=>[I(oe,{prop:"orderNo",label:"è®¢å•å·",width:"160","show-overflow-tooltip":""}),I(oe,{prop:"products",label:"å•†å“","min-width":"200","show-overflow-tooltip":""}),I(oe,{prop:"totalAmount",label:"è®¢å•é‡‘é¢",width:"110"},{default:N(({row:e})=>[V("span",vl,"Â¥"+P(e.totalAmount.toLocaleString()),1)]),_:1}),I(oe,{prop:"status",label:"è®¢å•çŠ¶æ€",width:"90"},{default:N(({row:e})=>{return[I(t,{type:(a=e.status,{"å·²å®Œæˆ":"success","è¿›è¡Œä¸­":"warning","å·²å–æ¶ˆ":"danger","å¾…ä»˜æ¬¾":"info"}[a]||"info"),size:"small"},{default:N(()=>[x(P(e.status),1)]),_:2},1032,["type"])];var a}),_:1}),I(oe,{prop:"orderDate",label:"ä¸‹å•æ—¶é—´",width:"160","show-overflow-tooltip":""}),I(oe,{label:"æ“ä½œ",width:"180",fixed:"right"},{default:N(({row:e})=>[I(l,{onClick:a=>{return l=e.id,void Gl.push(`/order/detail/${l}`);var l},size:"small",type:"primary",link:""},{default:N(()=>[...a[83]||(a[83]=[x("æŸ¥çœ‹",-1)])]),_:1},8,["onClick"]),"å¾…ä»˜æ¬¾"===e.status?(C(),S(l,{key:0,onClick:a=>{return l=e.id,void Gl.push(`/order/edit/${l}`);var l},size:"small",type:"warning",link:""},{default:N(()=>[...a[84]||(a[84]=[x("ç¼–è¾‘",-1)])]),_:1},8,["onClick"])):A("",!0),"å¾…ä»˜æ¬¾"===e.status?(C(),S(l,{key:1,onClick:a=>(async()=>{try{await te.confirm("ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªè®¢å•å—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),le.success("è®¢å•å·²å–æ¶ˆ"),Ps()}catch{}})(e.id),size:"small",type:"danger",link:""},{default:N(()=>[...a[85]||(a[85]=[x("å–æ¶ˆ",-1)])]),_:1},8,["onClick"])):A("",!0)]),_:1})]),_:1},8,["data"])),[[jl,ql.value]])])]),_:1}),I(de,{label:"å”®åŽè®°å½•",name:"service"},{default:N(()=>[V("div",fl,[V("div",hl,[I(l,{onClick:gs,icon:"Plus",type:"primary",size:"small"},{default:N(()=>[...a[86]||(a[86]=[x("æ–°å»ºå”®åŽ",-1)])]),_:1})]),U((C(),S(ue,{data:Et.value,style:{width:"100%"}},{default:N(()=>[I(oe,{prop:"serviceNo",label:"å”®åŽå•å·",width:"160","show-overflow-tooltip":""}),I(oe,{prop:"orderNo",label:"å…³è”è®¢å•",width:"160","show-overflow-tooltip":""}),I(oe,{prop:"type",label:"å”®åŽç±»åž‹",width:"90"},{default:N(({row:e})=>{return[I(t,{type:(a=e.type,{"é€€è´§":"warning","é€€æ¬¾":"danger","æ¢è´§":"info","ç»´ä¿®":"success"}[a]||"info"),size:"small"},{default:N(()=>[x(P(e.type),1)]),_:2},1032,["type"])];var a}),_:1}),I(oe,{prop:"reason",label:"å”®åŽåŽŸå› ","min-width":"180","show-overflow-tooltip":""}),I(oe,{prop:"amount",label:"é€€æ¬¾é‡‘é¢",width:"100"},{default:N(({row:e})=>[e.amount?(C(),k("span",yl,"Â¥"+P(e.amount.toLocaleString()),1)):(C(),k("span",gl,"-"))]),_:1}),I(oe,{prop:"status",label:"å¤„ç†çŠ¶æ€",width:"90"},{default:N(({row:e})=>{return[I(t,{type:(a=e.status,{"å·²å®Œæˆ":"success","å¤„ç†ä¸­":"warning","å¾…å¤„ç†":"info","å·²æ‹’ç»":"danger"}[a]||"info"),size:"small"},{default:N(()=>[x(P(e.status),1)]),_:2},1032,["type"])];var a}),_:1}),I(oe,{prop:"createTime",label:"ç”³è¯·æ—¶é—´",width:"160","show-overflow-tooltip":""}),I(oe,{label:"æ“ä½œ",width:"140",fixed:"right"},{default:N(({row:e})=>[I(l,{onClick:a=>{return l=e.id,void Gl.push(`/service/detail/${l}`);var l},size:"small",type:"primary",link:""},{default:N(()=>[...a[87]||(a[87]=[x("æŸ¥çœ‹",-1)])]),_:1},8,["onClick"]),"å¾…å¤„ç†"===e.status?(C(),S(l,{key:0,onClick:a=>{return l=e.id,void Gl.push(`/service/edit/${l}`);var l},size:"small",type:"warning",link:""},{default:N(()=>[...a[88]||(a[88]=[x("å¤„ç†",-1)])]),_:1},8,["onClick"])):A("",!0)]),_:1})]),_:1},8,["data"])),[[jl,Wl.value]])])]),_:1}),I(de,{label:"é€šè¯è®°å½•",name:"calls"},{default:N(()=>[V("div",_l,[V("div",wl,[T(o).checkCallPermission(T(re).userInfo?.id||"guest","MAKE_CALL").hasAccess?(C(),S(l,{key:0,onClick:vs,icon:"Phone",type:"success",size:"small"},{default:N(()=>[...a[89]||(a[89]=[x("å‘èµ·é€šè¯",-1)])]),_:1})):A("",!0)]),U((C(),S(ue,{data:At.value,style:{width:"100%"}},{default:N(()=>[I(oe,{prop:"callType",label:"é€šè¯ç±»åž‹",width:"90"},{default:N(({row:e})=>[I(t,{type:"å‘¼å‡º"===e.callType?"success":"info",size:"small"},{default:N(()=>[x(P(e.callType),1)]),_:2},1032,["type"])]),_:1}),I(oe,{prop:"phone",label:"ç”µè¯å·ç ",width:"130"},{default:N(({row:e})=>[x(P(T(ne)(e.phone,T(s).PHONE)),1)]),_:1}),I(oe,{prop:"duration",label:"é€šè¯æ—¶é•¿",width:"100"}),I(oe,{prop:"status",label:"é€šè¯çŠ¶æ€",width:"90"},{default:N(({row:e})=>{return[I(t,{type:(a=e.status,{"å·²æŽ¥é€š":"success","æœªæŽ¥é€š":"warning","å¿™çº¿":"info","æ‹’æŽ¥":"danger"}[a]||"info"),size:"small"},{default:N(()=>[x(P(e.status),1)]),_:2},1032,["type"])];var a}),_:1}),I(oe,{prop:"summary",label:"é€šè¯æ‘˜è¦","min-width":"180","show-overflow-tooltip":""}),I(oe,{prop:"callTime",label:"é€šè¯æ—¶é—´",width:"160","show-overflow-tooltip":""}),I(oe,{label:"æ“ä½œ",width:"180",fixed:"right"},{default:N(({row:e})=>[T(o).checkCallPermission(T(re).userInfo?.id||"guest","VIEW_RECORDS").hasAccess?(C(),S(l,{key:0,onClick:a=>(async e=>{try{await Bl.getCallDetail(e),le.success("æŸ¥çœ‹é€šè¯è¯¦æƒ…")}catch(a){console.error("èŽ·å–é€šè¯è¯¦æƒ…å¤±è´¥:",a),le.error("èŽ·å–é€šè¯è¯¦æƒ…å¤±è´¥")}})(e.id),size:"small",type:"primary",link:""},{default:N(()=>[...a[90]||(a[90]=[x("è¯¦æƒ…",-1)])]),_:1},8,["onClick"])):A("",!0),"å·²æŽ¥é€š"===e.status&&T(o).checkCallPermission(T(re).userInfo?.id||"guest","PLAY_RECORDING").hasAccess?(C(),S(l,{key:1,onClick:a=>(async e=>{const a=o.checkCallPermission(re.userInfo?.id||"guest",i.PLAY_RECORDING);if(a.hasAccess)try{await Bl.playRecording(e),le.success("å¼€å§‹æ’­æ”¾å½•éŸ³")}catch(l){console.error("æ’­æ”¾å½•éŸ³å¤±è´¥:",l),le.error("æ’­æ”¾å½•éŸ³å¤±è´¥")}else le.error(a.reason||"æ— æƒé™æ’­æ”¾å½•éŸ³")})(e.id),size:"small",type:"success",link:""},{default:N(()=>[...a[91]||(a[91]=[x("æ’­æ”¾",-1)])]),_:1},8,["onClick"])):A("",!0),I(l,{onClick:a=>{return l=e,It.type="ç”µè¯è·Ÿè¿›",It.title=`${l.callType}è·Ÿè¿›`,It.content=`åŸºäºŽ${l.callTime}çš„${l.callType}é€šè¯è¿›è¡Œè·Ÿè¿›`,It.nextTime="",It.priority="medium",It.status="pending",void(Ql.value=!0);var l},size:"small",type:"warning",link:""},{default:N(()=>[...a[92]||(a[92]=[x("è·Ÿè¿›",-1)])]),_:1},8,["onClick"]),I(pe,{trigger:"click"},{dropdown:N(()=>[I(me,null,{default:N(()=>["å·²æŽ¥é€š"===e.status&&T(o).checkCallPermission(T(re).userInfo?.id||"guest","DOWNLOAD_RECORDING").hasAccess?(C(),S(ce,{key:0,onClick:a=>(async e=>{const a=o.checkCallPermission(re.userInfo?.id||"guest",i.DOWNLOAD_RECORDING);if(a.hasAccess)try{await Bl.downloadRecording(e),le.success("å½•éŸ³ä¸‹è½½å·²å¼€å§‹")}catch(l){console.error("ä¸‹è½½å½•éŸ³å¤±è´¥:",l),le.error("ä¸‹è½½å½•éŸ³å¤±è´¥")}else le.error(a.reason||"æ— æƒé™ä¸‹è½½å½•éŸ³")})(e.id)},{default:N(()=>[I(n,null,{default:N(()=>[I(T(X))]),_:1}),a[94]||(a[94]=x("ä¸‹è½½å½•éŸ³ ",-1))]),_:1},8,["onClick"])):A("",!0),I(ce,{onClick:a=>(e.id,void le.info("åˆ†äº«é€šè¯åŠŸèƒ½å¼€å‘ä¸­"))},{default:N(()=>[I(n,null,{default:N(()=>[I(T(ee))]),_:1}),a[95]||(a[95]=x("åˆ†äº«é€šè¯ ",-1))]),_:1},8,["onClick"]),T(o).checkCallPermission(T(re).userInfo?.id||"guest","MAKE_CALL").hasAccess?(C(),S(ce,{key:1,onClick:a=>{return l=e.phone,Vt.phone=l,Vt.purpose="å›žæ‹¨",Vt.notes="",void(Yl.value=!0);var l}},{default:N(()=>[I(n,null,{default:N(()=>[I(T($))]),_:1}),a[96]||(a[96]=x("å›žæ‹¨ ",-1))]),_:1},8,["onClick"])):A("",!0),T(o).checkCallPermission(T(re).userInfo?.id||"guest","EDIT_RECORDS").hasAccess?(C(),S(ce,{key:2,onClick:a=>(()=>{const e=o.checkCallPermission(re.userInfo?.id||"guest",i.EDIT_RECORDS);e.hasAccess?le.info("ç¼–è¾‘é€šè¯è®°å½•åŠŸèƒ½å¼€å‘ä¸­"):le.error(e.reason||"æ— æƒé™ç¼–è¾‘é€šè¯è®°å½•")})(e.id)},{default:N(()=>[I(n,null,{default:N(()=>[I(T(M))]),_:1}),a[97]||(a[97]=x("ç¼–è¾‘è®°å½• ",-1))]),_:1},8,["onClick"])):A("",!0)]),_:2},1024)]),default:N(()=>[I(l,{size:"small",type:"info",link:""},{default:N(()=>[a[93]||(a[93]=x(" æ›´å¤š",-1)),I(n,{class:"el-icon--right"},{default:N(()=>[I(T(G))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[jl,Zl.value]])])]),_:1}),I(de,{label:"è·Ÿè¿›è®°å½•",name:"followup"},{default:N(()=>[V("div",bl,[V("div",kl,[I(l,{onClick:_s,icon:"Plus",type:"primary",size:"small"},{default:N(()=>[...a[98]||(a[98]=[x("æ·»åŠ è·Ÿè¿›",-1)])]),_:1})]),V("div",Cl,[I(fe,null,{default:N(()=>[(C(!0),k(E,null,O(Ot.value,e=>(C(),S(ve,{key:e.id,timestamp:e.createTime,type:Xt(e.type)},{default:N(()=>[I(se,{class:"timeline-card"},{default:N(()=>[V("div",Vl,[V("span",Il,P(e.title),1),I(t,{type:Xt(e.type),size:"small"},{default:N(()=>[x(P(e.type),1)]),_:2},1032,["type"])]),V("div",Tl,P(e.content),1),V("div",Pl,[V("span",Nl,P(e.author),1),Vs(e.createTime)?(C(),k("div",xl,[I(l,{onClick:a=>(e=>{const a=Ot.value.find(a=>a.id===e);a?(Tt.value=!0,Pt.value=e,It.type=a.type,It.title=a.title,It.content=a.content,It.nextFollowUp="",Ql.value=!0):le.error("æ‰¾ä¸åˆ°è¦ç¼–è¾‘çš„è·Ÿè¿›è®°å½•")})(e.id),size:"small",type:"primary",link:""},{default:N(()=>[...a[99]||(a[99]=[x(" ç¼–è¾‘ ",-1)])]),_:1},8,["onClick"]),T(re).isAdmin?(C(),S(l,{key:0,onClick:a=>(async e=>{if(re.isAdmin)try{await te.confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è·Ÿè¿›è®°å½•å—ï¼Ÿåˆ é™¤åŽæ— æ³•æ¢å¤ã€‚","ç¡®è®¤åˆ é™¤",{confirmButtonText:"ç¡®å®šåˆ é™¤",cancelButtonText:"å–æ¶ˆ",type:"warning"});const a=d.params.id;await ye(a,e);const l=Ot.value.findIndex(a=>a.id===e);l>-1&&(Ot.value.splice(l,1),le.success("è·Ÿè¿›è®°å½•åˆ é™¤æˆåŠŸ"))}catch(a){"cancel"!==a&&(console.error("åˆ é™¤è·Ÿè¿›è®°å½•å¤±è´¥:",a),le.error("åˆ é™¤å¤±è´¥"))}else le.error("æƒé™ä¸è¶³ï¼Œä»…è¶…çº§ç®¡ç†å‘˜å¯ä»¥åˆ é™¤è·Ÿè¿›è®°å½•")})(e.id),size:"small",type:"danger",link:""},{default:N(()=>[...a[100]||(a[100]=[x(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])):A("",!0)])):(C(),S(c,{key:1,content:"è¶…è¿‡24å°æ—¶çš„è·Ÿè¿›è®°å½•ä¸å¯ç¼–è¾‘",placement:"top"},{default:N(()=>[I(l,{size:"small",type:"info",link:"",disabled:""},{default:N(()=>[...a[101]||(a[101]=[x(" å·²é”å®š ",-1)])]),_:1})]),_:1}))])]),_:2},1024)]),_:2},1032,["timestamp","type"]))),128))]),_:1})])])]),_:1}),I(de,{label:"å®¢æˆ·æ ‡ç­¾",name:"tags"},{default:N(()=>[V("div",Sl,[V("div",El,[I(l,{onClick:bs,icon:"Plus",type:"primary",size:"small"},{default:N(()=>[...a[102]||(a[102]=[x("æ·»åŠ æ ‡ç­¾",-1)])]),_:1})]),V("div",Al,[(C(!0),k(E,null,O(Ut.value,e=>(C(),S(t,{key:e.id,type:e.type,closable:"",onClose:a=>(async e=>{try{await te.confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ ‡ç­¾å—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const a=d.params.id;await _e(a,e.toString()),Ut.value=Ut.value.filter(a=>a.id!==e),le.success("æ ‡ç­¾åˆ é™¤æˆåŠŸ")}catch(a){"cancel"!==a&&(console.error("åˆ é™¤æ ‡ç­¾å¤±è´¥:",a),le.error("åˆ é™¤å¤±è´¥"))}})(e.id),class:"tag-item"},{default:N(()=>[x(P(e.name),1)]),_:2},1032,["type","onClose"]))),128)),0===Ut.value.length?(C(),S(t,{key:0,type:"info"},{default:N(()=>[...a[103]||(a[103]=[x("æš‚æ— æ ‡ç­¾",-1)])]),_:1})):A("",!0)])])]),_:1})]),_:1},8,["modelValue"])]),_:1}),I(ge,{modelValue:Yl.value,"onUpdate:modelValue":a[24]||(a[24]=e=>Yl.value=e),title:"å‘èµ·å¤–å‘¼",width:"500px"},{footer:N(()=>[I(l,{onClick:a[23]||(a[23]=e=>Yl.value=!1)},{default:N(()=>[...a[104]||(a[104]=[x("å–æ¶ˆ",-1)])]),_:1}),I(l,{onClick:hs,type:"primary",loading:lt.value},{default:N(()=>[...a[105]||(a[105]=[x("å¼€å§‹é€šè¯",-1)])]),_:1},8,["loading"])]),default:N(()=>[I(_,{model:Vt,"label-width":"80px"},{default:N(()=>[I(m,{label:"ç”µè¯å·ç "},{default:N(()=>[I(h,{modelValue:Vt.phone,"onUpdate:modelValue":a[20]||(a[20]=e=>Vt.phone=e),placeholder:"è¯·é€‰æ‹©å®¢æˆ·å·ç ",filterable:"","allow-create":""},{default:N(()=>[dt.value.phone?(C(),S(f,{key:0,label:`${T(ne)(dt.value.phone,T(s).PHONE)} (ä¸»å·ç )`,value:dt.value.phone},null,8,["label","value"])):A("",!0),(C(!0),k(E,null,O(dt.value.otherPhones,(e,a)=>(C(),S(f,{key:e,label:`${T(ne)(e,T(s).PHONE)} (å¤‡ç”¨å·ç ${a+1})`,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),I(m,{label:"é€šè¯ç›®çš„"},{default:N(()=>[I(h,{modelValue:Vt.purpose,"onUpdate:modelValue":a[21]||(a[21]=e=>Vt.purpose=e),placeholder:"è¯·é€‰æ‹©"},{default:N(()=>[I(f,{label:"é”€å”®è·Ÿè¿›",value:"sales"}),I(f,{label:"å®¢æˆ·å›žè®¿",value:"callback"}),I(f,{label:"å”®åŽæœåŠ¡",value:"service"}),I(f,{label:"å…¶ä»–",value:"other"})]),_:1},8,["modelValue"])]),_:1}),I(m,{label:"å¤‡æ³¨"},{default:N(()=>[I(u,{modelValue:Vt.note,"onUpdate:modelValue":a[22]||(a[22]=e=>Vt.note=e),type:"textarea",rows:"3",placeholder:"è¯·è¾“å…¥å¤‡æ³¨"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),I(ge,{modelValue:Ql.value,"onUpdate:modelValue":a[29]||(a[29]=e=>Ql.value=e),title:Tt.value?"ç¼–è¾‘è·Ÿè¿›è®°å½•":"æ·»åŠ è·Ÿè¿›è®°å½•",width:"600px"},{footer:N(()=>[I(l,{onClick:Is},{default:N(()=>[...a[106]||(a[106]=[x("å–æ¶ˆ",-1)])]),_:1}),I(l,{onClick:ws,type:"primary",loading:tt.value},{default:N(()=>[x(P(Tt.value?"æ›´æ–°":"ä¿å­˜"),1)]),_:1},8,["loading"])]),default:N(()=>[I(_,{model:It,rules:xt,ref:"followUpFormRef","label-width":"80px"},{default:N(()=>[I(m,{label:"è·Ÿè¿›ç±»åž‹",prop:"type"},{default:N(()=>[I(h,{modelValue:It.type,"onUpdate:modelValue":a[25]||(a[25]=e=>It.type=e),placeholder:"è¯·é€‰æ‹©"},{default:N(()=>[I(f,{label:"ç”µè¯è·Ÿè¿›",value:"ç”µè¯è·Ÿè¿›"}),I(f,{label:"å¾®ä¿¡æ²Ÿé€š",value:"å¾®ä¿¡æ²Ÿé€š"}),I(f,{label:"ä¸Šé—¨æ‹œè®¿",value:"ä¸Šé—¨æ‹œè®¿"}),I(f,{label:"é‚®ä»¶è”ç³»",value:"é‚®ä»¶è”ç³»"}),I(f,{label:"å…¶ä»–",value:"å…¶ä»–"})]),_:1},8,["modelValue"])]),_:1}),I(m,{label:"è·Ÿè¿›æ ‡é¢˜",prop:"title"},{default:N(()=>[I(u,{modelValue:It.title,"onUpdate:modelValue":a[26]||(a[26]=e=>It.title=e),placeholder:"è¯·è¾“å…¥è·Ÿè¿›æ ‡é¢˜"},null,8,["modelValue"])]),_:1}),I(m,{label:"è·Ÿè¿›å†…å®¹",prop:"content"},{default:N(()=>[I(u,{modelValue:It.content,"onUpdate:modelValue":a[27]||(a[27]=e=>It.content=e),type:"textarea",rows:"4",placeholder:"è¯·è¾“å…¥è·Ÿè¿›å†…å®¹"},null,8,["modelValue"])]),_:1}),I(m,{label:"ä¸‹æ¬¡è·Ÿè¿›"},{default:N(()=>[I(g,{modelValue:It.nextFollowUp,"onUpdate:modelValue":a[28]||(a[28]=e=>It.nextFollowUp=e),type:"datetime",placeholder:"é€‰æ‹©ä¸‹æ¬¡è·Ÿè¿›æ—¶é—´"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),I(ge,{modelValue:et.value,"onUpdate:modelValue":a[33]||(a[33]=e=>et.value=e),title:"å‘é€çŸ­ä¿¡",width:"600px"},{footer:N(()=>[I(l,{onClick:a[32]||(a[32]=e=>et.value=!1)},{default:N(()=>[...a[109]||(a[109]=[x("å–æ¶ˆ",-1)])]),_:1}),I(l,{onClick:Ft,type:"primary",loading:ot.value,disabled:!Rt.value},{default:N(()=>[...a[110]||(a[110]=[x("å‘é€çŸ­ä¿¡",-1)])]),_:1},8,["loading","disabled"])]),default:N(()=>[I(_,{model:rt,rules:ut,ref_key:"smsFormRef",ref:Dt,"label-width":"100px"},{default:N(()=>[I(m,{label:"æŽ¥æ”¶å·ç ",prop:"phone"},{default:N(()=>[I(h,{modelValue:rt.phone,"onUpdate:modelValue":a[30]||(a[30]=e=>rt.phone=e),placeholder:"è¯·é€‰æ‹©å®¢æˆ·å·ç ",filterable:""},{default:N(()=>[dt.value.phone?(C(),S(f,{key:0,label:`${T(ne)(dt.value.phone,T(s).PHONE)} (ä¸»å·ç )`,value:dt.value.phone},null,8,["label","value"])):A("",!0),(C(!0),k(E,null,O(dt.value.otherPhones,(e,a)=>(C(),S(f,{key:e,label:`${T(ne)(e,T(s).PHONE)} (å¤‡ç”¨å·ç ${a+1})`,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),I(m,{label:"çŸ­ä¿¡æ¨¡æ¿",prop:"templateId"},{default:N(()=>[V("div",Ol,[I(h,{modelValue:rt.templateId,"onUpdate:modelValue":a[31]||(a[31]=e=>rt.templateId=e),placeholder:"è¯·é€‰æ‹©çŸ­ä¿¡æ¨¡æ¿",onChange:Mt,style:{flex:"1","margin-right":"10px"}},{default:N(()=>[(C(!0),k(E,null,O(nt.value,e=>(C(),S(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),I(l,{type:"primary",icon:T(ae),onClick:Jt,class:"apply-template-btn",title:"ç”³è¯·æ–°æ¨¡æ¿"},{default:N(()=>[...a[107]||(a[107]=[x(" ç”³è¯·æ¨¡æ¿ ",-1)])]),_:1},8,["icon"])])]),_:1}),$t.value?(C(),S(m,{key:0,label:"æ¨¡æ¿é¢„è§ˆ"},{default:N(()=>[V("div",Ul,[V("div",Dl,P($t.value.name),1),V("div",zl,P(Lt.value),1),a[108]||(a[108]=V("div",{class:"preview-note"},"æ³¨ï¼šå®žé™…å‘é€æ—¶ä¼šæ›¿æ¢æ¨¡æ¿å˜é‡",-1))])]),_:1})):A("",!0),$t.value&&$t.value.variables&&$t.value.variables.length>0?(C(),S(m,{key:1,label:"æ¨¡æ¿å˜é‡"},{default:N(()=>[V("div",$l,[(C(!0),k(E,null,O($t.value.variables,e=>(C(),k("div",{key:e.key,class:"variable-item"},[V("label",null,P(e.label)+"ï¼š",1),I(u,{modelValue:rt.variables[e.key],"onUpdate:modelValue":a=>rt.variables[e.key]=a,placeholder:e.placeholder||`è¯·è¾“å…¥${e.label}`,size:"small"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])]),_:1})):A("",!0),I(m,{label:"å‘é€é™åˆ¶"},{default:N(()=>[V("div",Ll,[I(Rl,{title:`ä»Šæ—¥å·²å‘é€ï¼š${it.value.todayCount}/1 æ¡ï¼Œæœ¬æœˆå·²å‘é€ï¼š${it.value.monthCount}/5 æ¡`,type:"info",closable:!1},null,8,["title"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),I(ge,{modelValue:Xl.value,"onUpdate:modelValue":a[37]||(a[37]=e=>Xl.value=e),title:"æ·»åŠ æ ‡ç­¾",width:"400px"},{footer:N(()=>[I(l,{onClick:a[36]||(a[36]=e=>Xl.value=!1)},{default:N(()=>[...a[111]||(a[111]=[x("å–æ¶ˆ",-1)])]),_:1}),I(l,{onClick:ks,type:"primary",loading:st.value},{default:N(()=>[...a[112]||(a[112]=[x("ä¿å­˜",-1)])]),_:1},8,["loading"])]),default:N(()=>[I(_,{model:Nt,"label-width":"80px"},{default:N(()=>[I(m,{label:"æ ‡ç­¾åç§°"},{default:N(()=>[I(u,{modelValue:Nt.name,"onUpdate:modelValue":a[34]||(a[34]=e=>Nt.name=e),placeholder:"è¯·è¾“å…¥æ ‡ç­¾åç§°"},null,8,["modelValue"])]),_:1}),I(m,{label:"æ ‡ç­¾é¢œè‰²"},{default:N(()=>[I(h,{modelValue:Nt.type,"onUpdate:modelValue":a[35]||(a[35]=e=>Nt.type=e),placeholder:"è¯·é€‰æ‹©é¢œè‰²"},{default:N(()=>[I(f,{label:"é»˜è®¤",value:""}),I(f,{label:"æˆåŠŸ",value:"success"}),I(f,{label:"ä¿¡æ¯",value:"info"}),I(f,{label:"è­¦å‘Š",value:"warning"}),I(f,{label:"å±é™©",value:"danger"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),I(ie,{modelValue:at.value,"onUpdate:modelValue":a[38]||(a[38]=e=>at.value=e),mode:"apply",onSubmit:Ht},null,8,["modelValue"])])}}}),[["__scopeId","data-v-1fc02489"]]);export{Rl as default};
