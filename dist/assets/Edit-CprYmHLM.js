var P=(E,x,f)=>new Promise((w,I)=>{var b=m=>{try{V(f.next(m))}catch(t){I(t)}},k=m=>{try{V(f.throw(m))}catch(t){I(t)}},V=m=>m.done?w(m.value):Promise.resolve(m.value).then(b,k);V((f=f.apply(E,x)).next())});import{l as se,az as ie,aC as re,r as T,e as O,Z as ne,c as de,ag as c,m as B,p as A,q as r,U as o,u as q,T as $,Q as ue,O as l,S}from"./vendor-D8Vxqhr-.js";import{a3 as me,p as ce,E as g,b as G}from"./elementPlus-Bmwh7Rh8.js";import{g as pe,c as fe,_ as ge}from"./settings-CuxbDWOu.js";import{u as _e}from"./product-DLyzXkG9.js";import"./utils-ywHRn0uI.js";const be={class:"product-edit"},ye={class:"page-header"},we={class:"header-left"},Ve={class:"header-info"},ve={class:"header-meta"},ke={key:0,class:"product-code"},Pe={class:"form-content"},Se={class:"profit-info"},xe={class:"image-upload-section"},Ie={class:"upload-tip"},Ue={class:"tips-content"},Ne={class:"form-footer"},he={class:"footer-actions"},Ce=se({__name:"Edit",setup(E){const x=ie(),f=re(),w=fe(x),I=pe(),b=_e(),k=T(!1),V=T(),m=O(()=>!!f.params.id),t=ne({id:"",code:"",name:"",categoryId:[],brand:"",specification:"",unit:"",weight:0,dimensions:"",description:"",price:0,costPrice:0,marketPrice:0,stock:0,minStock:0,maxStock:0,status:"active",isRecommended:!1,isNew:!1,isHot:!1,seoTitle:"",seoKeywords:"",seoDescription:"",mainImage:"",images:[]}),U=T([]),M=O(()=>b.categories.map(s=>{var e;return{value:s.id,label:s.name,children:((e=s.children)==null?void 0:e.map(i=>({value:i.id,label:i.name})))||[]}})),H={value:"value",label:"label",children:"children",emitPath:!1},K={name:[{required:!0,message:"请输入商品名称",trigger:"blur"},{min:2,max:100,message:"商品名称长度在 2 到 100 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入商品编码",trigger:"blur"},{pattern:/^[A-Z0-9]{3,20}$/,message:"商品编码只能包含大写字母和数字，长度3-20位",trigger:"blur"}],categoryId:[{required:!0,message:"请选择商品分类",trigger:"change"}],unit:[{required:!0,message:"请选择商品单位",trigger:"change"}],price:[{required:!0,message:"请输入销售价格",trigger:"blur"},{type:"number",min:.01,message:"销售价格必须大于0",trigger:"blur"}],costPrice:[{type:"number",min:0,message:"成本价格不能小于0",trigger:"blur"}],stock:[{required:!0,message:"请输入当前库存",trigger:"blur"},{type:"number",min:0,message:"库存不能小于0",trigger:"blur"}],minStock:[{type:"number",min:0,message:"最低库存不能小于0",trigger:"blur"}],maxStock:[{type:"number",min:0,message:"最高库存不能小于0",trigger:"blur"}]},R=()=>{x.back()},N=()=>{const s=Date.now().toString().slice(-8),e=Math.random().toString(36).substring(2,6).toUpperCase();t.code=`P${s}${e}`},z=()=>(t.price-t.costPrice).toFixed(2),F=()=>t.costPrice===0?"0.00":((t.price-t.costPrice)/t.costPrice*100).toFixed(2),L=s=>{const e=s.type==="image/jpeg"||s.type==="image/png",i=s.size/1024/1024<2;return e?i?!0:(g.error("图片大小不能超过 2MB!"),!1):(g.error("只能上传 JPG/PNG 格式的图片!"),!1)},j=(s,e)=>{if(s.raw){const i=new FileReader;i.onload=d=>{var u;s.url=(u=d.target)==null?void 0:u.result;const n=e.filter(p=>p.url).map(p=>p.url);t.images=n,n.length>0&&(t.mainImage=n[0])},i.readAsDataURL(s.raw)}else if(s.url){const i=e.filter(d=>d.url).map(d=>d.url);t.images=i,i.length>0&&(t.mainImage=i[0])}},J=(s,e)=>{const i=e.filter(d=>d.url).map(d=>d.url);t.images=i,i.length>0?t.mainImage=i[0]:t.mainImage=""},Z=()=>P(this,null,function*(){try{yield G.confirm("确定要取消吗？未保存的数据将丢失！","确认取消",{confirmButtonText:"确定",cancelButtonText:"继续编辑",type:"warning"}),R()}catch(s){}}),Q=()=>P(this,null,function*(){var s;try{if(yield(s=V.value)==null?void 0:s.validate(),t.minStock>t.maxStock){g.error("最低库存不能大于最高库存");return}if(t.costPrice>t.price)try{yield G.confirm("成本价格高于销售价格，确定要保存吗？","价格提醒",{confirmButtonText:"确定保存",cancelButtonText:"重新设置",type:"warning"})}catch(i){return}k.value=!0,yield new Promise(i=>setTimeout(i,1500));const e=!m.value;if(e){const i=b.addProduct({code:t.code,name:t.name,categoryId:t.categoryId,categoryName:t.categoryName||"未分类",brand:t.brand,specification:t.specification,unit:t.unit,weight:t.weight,dimensions:t.dimensions,description:t.description,price:t.price,costPrice:t.costPrice,marketPrice:t.marketPrice,stock:t.stock,minStock:t.minStock,maxStock:t.maxStock,salesCount:0,status:t.status,image:t.mainImage||"/src/assets/images/product-placeholder.svg",images:Array.isArray(t.images)?t.images:[]});t.id=i.id.toString()}else b.updateProduct(t.id,{code:t.code,name:t.name,categoryId:t.categoryId,categoryName:t.categoryName||"未分类",brand:t.brand,specification:t.specification,unit:t.unit,weight:t.weight,dimensions:t.dimensions,description:t.description,price:t.price,costPrice:t.costPrice,marketPrice:t.marketPrice,stock:t.stock,minStock:t.minStock,maxStock:t.maxStock,status:t.status,image:t.mainImage||"/src/assets/images/product-placeholder.svg",images:Array.isArray(t.images)?t.images:[]});g.success(m.value?"商品更新成功":"商品创建成功"),I.addNotification({type:e?"PRODUCT_CREATED":"PRODUCT_UPDATED",title:e?"商品创建":"商品更新",content:`商品"${t.name}"已${e?"创建":"更新"}成功`,data:{productId:t.id||"new",productName:t.name,productCode:t.code,action:e?"创建":"更新",timestamp:new Date().toISOString()},link:m.value?`/product/detail/${t.id}`:"/product/list"}),e?w.push({path:"/product/list",query:{refresh:"true"}}):w.push(`/product/detail/${t.id}`)}catch(e){console.error("表单验证失败:",e)}finally{k.value=!1}}),W=()=>P(this,null,function*(){if(m.value)try{const s=f.params.id;if(!s){g.error("商品ID不存在"),w.push("/product/list");return}yield new Promise(i=>setTimeout(i,800));let e=b.getProductById(s);!e&&!isNaN(Number(s))&&(e=b.getProductById(Number(s))),e?(Object.assign(t,{id:e.id,code:e.code,name:e.name,categoryId:e.categoryId,categoryName:e.categoryName,brand:e.brand,specification:e.specification,unit:e.unit,weight:e.weight,dimensions:e.dimensions,description:e.description,price:e.price,costPrice:e.costPrice,marketPrice:e.marketPrice,stock:e.stock,minStock:e.minStock,maxStock:e.maxStock,status:e.status,isRecommended:!1,isNew:!1,isHot:!1,seoTitle:"",seoKeywords:"",seoDescription:"",mainImage:e.image,images:e.images||[]}),U.value=(e.images||[]).map((i,d)=>({uid:Date.now()+d,name:`image-${d+1}`,status:"done",url:i}))):(g.error("商品不存在"),w.push("/product/list"))}catch(s){g.error("加载商品信息失败")}}),X=()=>P(this,null,function*(){if(f.query.copy)try{yield new Promise(e=>setTimeout(e,500)),Object.assign(t,{name:"iPhone 15 Pro (复制)",categoryId:"1-1",brand:"Apple",specification:"256GB 深空黑色",unit:"台",weight:.187,dimensions:"146.6×70.6×7.8",description:"iPhone 15 Pro 采用钛金属设计，搭载 A17 Pro 芯片，配备专业级摄像头系统，支持 5G 网络。",price:8999,costPrice:7200,marketPrice:9999,stock:0,minStock:10,maxStock:200,status:"inactive",isRecommended:!1,isNew:!1,isHot:!1,seoTitle:"",seoKeywords:"",seoDescription:"",images:[]}),N(),g.success("商品信息已复制，请修改后保存")}catch(e){g.error("复制商品信息失败")}});return de(()=>{m.value?W():f.query.copy?X():N()}),(s,e)=>{const i=c("el-button"),d=c("el-input"),n=c("el-form-item"),u=c("el-col"),p=c("el-row"),Y=c("el-cascader"),_=c("el-option"),ee=c("el-select"),y=c("el-input-number"),v=c("el-card"),h=c("el-alert"),te=c("el-icon"),oe=c("el-upload"),D=c("el-radio"),le=c("el-radio-group"),C=c("el-switch"),ae=c("el-form");return A(),B("div",be,[r("div",ye,[r("div",we,[o(i,{onClick:R,icon:q(me),circle:""},null,8,["icon"]),r("div",Ve,[r("h2",null,$(m.value?"编辑商品":"新增商品"),1),r("div",ve,[m.value?(A(),B("span",ke,"商品编码："+$(t.code),1)):ue("",!0)])])])]),r("div",Pe,[o(ae,{ref_key:"productFormRef",ref:V,model:t,rules:K,"label-width":"120px",size:"default"},{default:l(()=>[o(p,{gutter:20},{default:l(()=>[o(u,{span:16},{default:l(()=>[o(v,{class:"form-card",title:"基本信息"},{header:l(()=>[...e[23]||(e[23]=[r("span",null,"基本信息",-1)])]),default:l(()=>[o(p,{gutter:20},{default:l(()=>[o(u,{span:12},{default:l(()=>[o(n,{label:"商品名称",prop:"name"},{default:l(()=>[o(d,{modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=a=>t.name=a),placeholder:"请输入商品名称",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),o(u,{span:12},{default:l(()=>[o(n,{label:"商品编码",prop:"code"},{default:l(()=>[o(d,{modelValue:t.code,"onUpdate:modelValue":e[1]||(e[1]=a=>t.code=a),placeholder:"请输入商品编码",disabled:m.value},{append:l(()=>[o(i,{onClick:N,disabled:m.value},{default:l(()=>[...e[24]||(e[24]=[S(" 生成 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),o(p,{gutter:20},{default:l(()=>[o(u,{span:12},{default:l(()=>[o(n,{label:"商品分类",prop:"categoryId"},{default:l(()=>[o(Y,{modelValue:t.categoryId,"onUpdate:modelValue":e[2]||(e[2]=a=>t.categoryId=a),options:M.value,props:H,placeholder:"请选择商品分类",style:{width:"100%"},clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1}),o(u,{span:12},{default:l(()=>[o(n,{label:"商品品牌",prop:"brand"},{default:l(()=>[o(d,{modelValue:t.brand,"onUpdate:modelValue":e[3]||(e[3]=a=>t.brand=a),placeholder:"请输入商品品牌"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(p,{gutter:20},{default:l(()=>[o(u,{span:12},{default:l(()=>[o(n,{label:"商品规格",prop:"specification"},{default:l(()=>[o(d,{modelValue:t.specification,"onUpdate:modelValue":e[4]||(e[4]=a=>t.specification=a),placeholder:"请输入商品规格"},null,8,["modelValue"])]),_:1})]),_:1}),o(u,{span:12},{default:l(()=>[o(n,{label:"商品单位",prop:"unit"},{default:l(()=>[o(ee,{modelValue:t.unit,"onUpdate:modelValue":e[5]||(e[5]=a=>t.unit=a),placeholder:"请选择商品单位",style:{width:"100%"}},{default:l(()=>[o(_,{label:"件",value:"件"}),o(_,{label:"台",value:"台"}),o(_,{label:"个",value:"个"}),o(_,{label:"盒",value:"盒"}),o(_,{label:"包",value:"包"}),o(_,{label:"瓶",value:"瓶"}),o(_,{label:"袋",value:"袋"}),o(_,{label:"套",value:"套"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(p,{gutter:20},{default:l(()=>[o(u,{span:12},{default:l(()=>[o(n,{label:"商品重量",prop:"weight"},{default:l(()=>[o(y,{modelValue:t.weight,"onUpdate:modelValue":e[6]||(e[6]=a=>t.weight=a),precision:3,step:.1,min:0,style:{width:"100%"}},null,8,["modelValue"]),e[25]||(e[25]=r("span",{class:"unit-text"},"kg",-1))]),_:1})]),_:1}),o(u,{span:12},{default:l(()=>[o(n,{label:"商品尺寸",prop:"dimensions"},{default:l(()=>[o(d,{modelValue:t.dimensions,"onUpdate:modelValue":e[7]||(e[7]=a=>t.dimensions=a),placeholder:"长×宽×高 (cm)"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(n,{label:"商品描述",prop:"description"},{default:l(()=>[o(d,{modelValue:t.description,"onUpdate:modelValue":e[8]||(e[8]=a=>t.description=a),type:"textarea",rows:4,placeholder:"请输入商品描述",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{class:"form-card",title:"价格库存"},{header:l(()=>[...e[26]||(e[26]=[r("span",null,"价格库存",-1)])]),default:l(()=>[o(p,{gutter:20},{default:l(()=>[o(u,{span:12},{default:l(()=>[o(n,{label:"销售价格",prop:"price"},{default:l(()=>[o(y,{modelValue:t.price,"onUpdate:modelValue":e[9]||(e[9]=a=>t.price=a),precision:2,step:.01,min:0,style:{width:"100%"}},null,8,["modelValue"]),e[27]||(e[27]=r("span",{class:"unit-text"},"元",-1))]),_:1})]),_:1}),o(u,{span:12},{default:l(()=>[o(n,{label:"成本价格",prop:"costPrice"},{default:l(()=>[o(y,{modelValue:t.costPrice,"onUpdate:modelValue":e[10]||(e[10]=a=>t.costPrice=a),precision:2,step:.01,min:0,style:{width:"100%"}},null,8,["modelValue"]),e[28]||(e[28]=r("span",{class:"unit-text"},"元",-1))]),_:1})]),_:1})]),_:1}),o(p,{gutter:20},{default:l(()=>[o(u,{span:12},{default:l(()=>[o(n,{label:"市场价格",prop:"marketPrice"},{default:l(()=>[o(y,{modelValue:t.marketPrice,"onUpdate:modelValue":e[11]||(e[11]=a=>t.marketPrice=a),precision:2,step:.01,min:0,style:{width:"100%"}},null,8,["modelValue"]),e[29]||(e[29]=r("span",{class:"unit-text"},"元",-1))]),_:1})]),_:1}),o(u,{span:12},{default:l(()=>[o(n,{label:"当前库存",prop:"stock"},{default:l(()=>[o(y,{modelValue:t.stock,"onUpdate:modelValue":e[12]||(e[12]=a=>t.stock=a),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(p,{gutter:20},{default:l(()=>[o(u,{span:12},{default:l(()=>[o(n,{label:"最低库存",prop:"minStock"},{default:l(()=>[o(y,{modelValue:t.minStock,"onUpdate:modelValue":e[13]||(e[13]=a=>t.minStock=a),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),o(u,{span:12},{default:l(()=>[o(n,{label:"最高库存",prop:"maxStock"},{default:l(()=>[o(y,{modelValue:t.maxStock,"onUpdate:modelValue":e[14]||(e[14]=a=>t.maxStock=a),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r("div",Se,[o(h,{title:`预计利润：¥${z()} (${F()}%)`,type:"info",closable:!1,"show-icon":""},null,8,["title"])])]),_:1}),o(v,{class:"form-card",title:"商品图片"},{header:l(()=>[...e[30]||(e[30]=[r("span",null,"商品图片",-1)])]),default:l(()=>[r("div",xe,[r("div",Ie,[o(h,{title:"图片要求：支持 JPG、PNG 格式，单张图片不超过 2MB，建议尺寸 800x800px",type:"info",closable:!1})]),o(oe,{"file-list":U.value,"onUpdate:fileList":e[15]||(e[15]=a=>U.value=a),action:"#","list-type":"picture-card","auto-upload":!1,"on-change":j,"on-remove":J,"before-upload":L,multiple:"",limit:5},{tip:l(()=>[...e[31]||(e[31]=[r("div",{class:"el-upload__tip"}," 最多上传5张图片，第一张为主图 ",-1)])]),default:l(()=>[o(te,null,{default:l(()=>[o(q(ce))]),_:1})]),_:1},8,["file-list"])])]),_:1})]),_:1}),o(u,{span:8},{default:l(()=>[o(v,{class:"form-card",title:"商品状态"},{header:l(()=>[...e[32]||(e[32]=[r("span",null,"商品状态",-1)])]),default:l(()=>[o(n,{label:"商品状态",prop:"status"},{default:l(()=>[o(le,{modelValue:t.status,"onUpdate:modelValue":e[16]||(e[16]=a=>t.status=a)},{default:l(()=>[o(D,{value:"active"},{default:l(()=>[...e[33]||(e[33]=[S("上架",-1)])]),_:1}),o(D,{value:"inactive"},{default:l(()=>[...e[34]||(e[34]=[S("下架",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"是否推荐",prop:"isRecommended"},{default:l(()=>[o(C,{modelValue:t.isRecommended,"onUpdate:modelValue":e[17]||(e[17]=a=>t.isRecommended=a),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),o(n,{label:"是否新品",prop:"isNew"},{default:l(()=>[o(C,{modelValue:t.isNew,"onUpdate:modelValue":e[18]||(e[18]=a=>t.isNew=a),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),o(n,{label:"是否热销",prop:"isHot"},{default:l(()=>[o(C,{modelValue:t.isHot,"onUpdate:modelValue":e[19]||(e[19]=a=>t.isHot=a),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{class:"form-card",title:"SEO设置"},{header:l(()=>[...e[35]||(e[35]=[r("span",null,"SEO设置",-1)])]),default:l(()=>[o(n,{label:"SEO标题",prop:"seoTitle"},{default:l(()=>[o(d,{modelValue:t.seoTitle,"onUpdate:modelValue":e[20]||(e[20]=a=>t.seoTitle=a),placeholder:"请输入SEO标题",maxlength:"60","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(n,{label:"SEO关键词",prop:"seoKeywords"},{default:l(()=>[o(d,{modelValue:t.seoKeywords,"onUpdate:modelValue":e[21]||(e[21]=a=>t.seoKeywords=a),placeholder:"请输入SEO关键词，用逗号分隔"},null,8,["modelValue"])]),_:1}),o(n,{label:"SEO描述",prop:"seoDescription"},{default:l(()=>[o(d,{modelValue:t.seoDescription,"onUpdate:modelValue":e[22]||(e[22]=a=>t.seoDescription=a),type:"textarea",rows:3,placeholder:"请输入SEO描述",maxlength:"160","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),o(v,{class:"form-card",title:"操作提示"},{header:l(()=>[...e[36]||(e[36]=[r("span",null,"操作提示",-1)])]),default:l(()=>[r("div",Ue,[o(h,{title:"保存提示",type:"warning",closable:!1,"show-icon":""},{default:l(()=>[...e[37]||(e[37]=[r("ul",null,[r("li",null,"商品编码一旦保存不可修改"),r("li",null,"价格变动会影响现有订单"),r("li",null,"库存调整请谨慎操作"),r("li",null,"图片建议使用高清图片")],-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),r("div",Ne,[r("div",he,[o(i,{onClick:Z,size:"large"},{default:l(()=>[...e[38]||(e[38]=[S("取消",-1)])]),_:1}),o(i,{onClick:Q,type:"primary",size:"large",loading:k.value},{default:l(()=>[...e[39]||(e[39]=[S(" 保存 ",-1)])]),_:1},8,["loading"])])])])}}}),Ae=ge(Ce,[["__scopeId","data-v-83980288"]]);export{Ae as default};
