var O=(V,C,m)=>new Promise((g,_)=>{var y=s=>{try{v(m.next(s))}catch(r){_(r)}},h=s=>{try{v(m.throw(s))}catch(r){_(r)}},v=s=>s.done?g(s.value):Promise.resolve(s.value).then(y,h);v((m=m.apply(V,C)).next())});import{l as Q,az as W,r as k,Z as $,e as X,c as Y,ag as p,m as ee,p as te,q as b,U as t,O as n,S as u,u as S,T as w}from"./vendor-D8Vxqhr-.js";import{r as ae,s as le,a8 as se,E as oe}from"./elementPlus-Bmwh7Rh8.js";import{D as ne}from"./DynamicTable-CiyMIP8-.js";import{j as ie,u as re,c as de,_ as ce}from"./settings-CuxbDWOu.js";import"./utils-ywHRn0uI.js";const pe={class:"logistics-list"},ue={class:"page-header"},me={class:"header-actions"},fe=Q({__name:"List",setup(V){const C=W(),m=de(C),g=ie(),_=re(),y=k(!1),h=k(0),v=k([]),s=$({trackingNo:"",orderNo:"",status:"",company:""}),r=$({page:1,size:20}),z=k([]),B=X(()=>[{prop:"trackingNo",label:"物流单号",width:180,visible:!0},{prop:"orderNo",label:"订单号",width:150,visible:!0},{prop:"customerName",label:"客户姓名",width:120,visible:!0},{prop:"company",label:"物流公司",width:120,visible:!0},{prop:"status",label:"状态",width:100,visible:!0},{prop:"destination",label:"目的地",width:150,visible:!0},{prop:"shipDate",label:"发货时间",width:180,visible:!0},{prop:"estimatedDate",label:"预计送达",width:180,visible:!0}]),I=a=>({sf:"顺丰速运",yt:"圆通速递",zt:"中通快递",st:"申通快递",yd:"韵达速递"})[a]||a,E=a=>({pending:"info",shipped:"primary",in_transit:"warning",delivered:"success",exception:"danger"})[a]||"info",R=a=>({pending:"待发货",shipped:"已发货",in_transit:"运输中",delivered:"已送达",exception:"异常"})[a]||a,P=()=>{r.page=1,f()},j=()=>{Object.assign(s,{trackingNo:"",orderNo:"",status:"",company:""}),r.page=1,f()},L=()=>{f()},M=a=>{const e=_.currentUser;return e?e.role==="admin"?a:e.role==="department_manager"?a.filter(o=>{const d=_.getUserById(o.createdBy);return(d==null?void 0:d.department)===e.department}):e.role==="sales_staff"?a.filter(o=>o.createdBy===e.id):e.role==="customer_service"?a.filter(o=>o.servicePersonId===e.id):a.filter(o=>o.createdBy===e.id):[]},f=()=>O(this,null,function*(){y.value=!0;try{yield new Promise(l=>setTimeout(l,500));let o=M(g.orders).filter(l=>l.status==="shipped"&&l.expressNo&&l.expressCompany).map(l=>({id:parseInt(l.id),trackingNo:l.expressNo,orderNo:l.orderNumber,customerName:l.customerName,company:l.expressCompany,status:"shipped",destination:l.address,shipDate:l.shipTime||new Date().toISOString(),estimatedDate:l.estimatedDeliveryTime||""}));s.trackingNo&&(o=o.filter(l=>l.trackingNo.includes(s.trackingNo))),s.orderNo&&(o=o.filter(l=>l.orderNo.includes(s.orderNo))),s.status&&(o=o.filter(l=>l.status===s.status)),s.company&&(o=o.filter(l=>l.company===s.company));const d=(r.page-1)*r.size,N=d+r.size;z.value=o.slice(d,N),h.value=o.length}catch(a){oe.error("加载数据失败"),console.error("Load data error:",a)}finally{y.value=!1}}),q=a=>{v.value=a},A=a=>{r.size=a,r.page=1,f()},F=a=>{r.page=a,f()},Z=a=>{m.push(`/logistics/track/detail/${a.trackingNo}`)},G=a=>{m.push(`/logistics/edit/${a.id}`)},D=a=>{m.push(`/logistics/detail/${a.id}`)};return Y(()=>{f(),g.setupLogisticsEventListener(),g.startLogisticsAutoSync(),g.$subscribe((a,e)=>{a.events.some(o=>o.key==="status"||o.key==="expressNo"||o.key==="expressCompany")&&f()})}),(a,e)=>{const o=p("el-icon"),d=p("el-button"),N=p("el-input"),l=p("el-form-item"),c=p("el-option"),T=p("el-select"),H=p("el-form"),J=p("el-card"),K=p("el-link"),U=p("el-tag");return te(),ee("div",pe,[b("div",ue,[e[5]||(e[5]=b("div",{class:"header-left"},[b("h1",null,"物流列表"),b("p",null,"管理和跟踪所有物流订单")],-1)),b("div",me,[t(d,{type:"primary",onClick:L},{default:n(()=>[t(o,null,{default:n(()=>[t(S(ae))]),_:1}),e[4]||(e[4]=u(" 刷新 ",-1))]),_:1})])]),t(J,{class:"search-card"},{default:n(()=>[t(H,{model:s,inline:"",class:"search-form"},{default:n(()=>[t(l,{label:"物流单号"},{default:n(()=>[t(N,{modelValue:s.trackingNo,"onUpdate:modelValue":e[0]||(e[0]=i=>s.trackingNo=i),placeholder:"请输入物流单号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(l,{label:"订单号"},{default:n(()=>[t(N,{modelValue:s.orderNo,"onUpdate:modelValue":e[1]||(e[1]=i=>s.orderNo=i),placeholder:"请输入订单号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(l,{label:"物流状态"},{default:n(()=>[t(T,{modelValue:s.status,"onUpdate:modelValue":e[2]||(e[2]=i=>s.status=i),placeholder:"请选择状态",clearable:"",style:{width:"150px"}},{default:n(()=>[t(c,{label:"待发货",value:"pending"}),t(c,{label:"已发货",value:"shipped"}),t(c,{label:"运输中",value:"in_transit"}),t(c,{label:"已送达",value:"delivered"}),t(c,{label:"异常",value:"exception"})]),_:1},8,["modelValue"])]),_:1}),t(l,{label:"物流公司"},{default:n(()=>[t(T,{modelValue:s.company,"onUpdate:modelValue":e[3]||(e[3]=i=>s.company=i),placeholder:"请选择物流公司",clearable:"",style:{width:"150px"}},{default:n(()=>[t(c,{label:"顺丰速运",value:"sf"}),t(c,{label:"圆通速递",value:"yt"}),t(c,{label:"中通快递",value:"zt"}),t(c,{label:"申通快递",value:"st"}),t(c,{label:"韵达速递",value:"yd"})]),_:1},8,["modelValue"])]),_:1}),t(l,null,{default:n(()=>[t(d,{type:"primary",onClick:P},{default:n(()=>[t(o,null,{default:n(()=>[t(S(le))]),_:1}),e[6]||(e[6]=u(" 搜索 ",-1))]),_:1}),t(d,{onClick:j},{default:n(()=>[t(o,null,{default:n(()=>[t(S(se))]),_:1}),e[7]||(e[7]=u(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(ne,{data:z.value,columns:B.value,"storage-key":"logistics-list-columns",title:"物流列表",loading:y.value,"show-selection":!0,"show-index":!1,pagination:{currentPage:r.page,pageSize:r.size,total:h.value},onSelectionChange:q,onSizeChange:A,onCurrentChange:F},{"column-trackingNo":n(({row:i})=>[t(K,{type:"primary",onClick:x=>D(i)},{default:n(()=>[u(w(i.trackingNo),1)]),_:2},1032,["onClick"])]),"column-company":n(({row:i})=>[t(U,null,{default:n(()=>[u(w(I(i.company)),1)]),_:2},1024)]),"column-status":n(({row:i})=>[t(U,{type:E(i.status)},{default:n(()=>[u(w(R(i.status)),1)]),_:2},1032,["type"])]),"table-actions":n(({row:i})=>[t(d,{type:"primary",size:"small",onClick:x=>Z(i)},{default:n(()=>[...e[8]||(e[8]=[u(" 跟踪 ",-1)])]),_:1},8,["onClick"]),t(d,{type:"success",size:"small",onClick:x=>G(i)},{default:n(()=>[...e[9]||(e[9]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(d,{type:"info",size:"small",onClick:x=>D(i)},{default:n(()=>[...e[10]||(e[10]=[u(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1},8,["data","columns","loading","pagination"])])}}}),Ne=ce(fe,[["__scopeId","data-v-95dd9e2e"]]);export{Ne as default};
