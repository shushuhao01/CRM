var v=(x,_,t)=>new Promise((p,a)=>{var l=e=>{try{i(t.next(e))}catch(u){a(u)}},r=e=>{try{i(t.throw(e))}catch(u){a(u)}},i=e=>e.done?p(e.value):Promise.resolve(e.value).then(l,r);i((t=t.apply(x,_)).next())});import{l as T,az as E,r as V,Z as k,ag as f,m as U,p as C,q as g,U as n,O as c,S as L,n as N}from"./vendor-D8Vxqhr-.js";import{u as R,c as z,_ as S}from"./settings-CuxbDWOu.js";import{E as d}from"./elementPlus-Bmwh7Rh8.js";import"./utils-ywHRn0uI.js";const q={class:"login-container"},B={class:"login-box"},F=T({__name:"Login",setup(x){const _=E(),t=z(_),p=R(),a=V(!1),l=V(),r=k({username:"",password:""}),i={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}]};let e=null;const u=()=>v(this,null,function*(){if(l.value){if(e&&clearTimeout(e),a.value){d.warning("正在登录中，请稍候...");return}yield l.value.validate(y=>v(this,null,function*(){var s;if(y){a.value=!0;try{(yield p.loginWithRetry(r.username,r.password,!1,3))?(d.success("登录成功"),yield N(),(s=p.currentUser)!=null&&s.forcePasswordChange?t.push("/change-password"):t.push("/")):d.error("登录失败")}catch(o){console.error("登录错误:",o);const m=o instanceof Error?o.message:"登录失败，请检查用户名和密码";if(d.error(m),o instanceof Error&&(o.message.includes("频繁")||o.message.includes("429")||o.message==="RATE_LIMITED")){setTimeout(()=>{a.value=!1},3e4),d.warning("登录尝试过于频繁，按钮已禁用30秒");return}}finally{e=setTimeout(()=>{a.value=!1},1e3)}}}))}});return(y,s)=>{const o=f("el-input"),m=f("el-form-item"),b=f("el-button"),h=f("el-form");return C(),U("div",q,[g("div",B,[s[3]||(s[3]=g("div",{class:"login-header"},[g("h1",null,"智能销售管理系统"),g("p",null,"欢迎登录")],-1)),n(h,{model:r,rules:i,ref_key:"loginFormRef",ref:l,class:"login-form"},{default:c(()=>[n(m,{prop:"username"},{default:c(()=>[n(o,{modelValue:r.username,"onUpdate:modelValue":s[0]||(s[0]=w=>r.username=w),placeholder:"请输入用户名",size:"large","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),n(m,{prop:"password"},{default:c(()=>[n(o,{modelValue:r.password,"onUpdate:modelValue":s[1]||(s[1]=w=>r.password=w),type:"password",placeholder:"请输入密码",size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),n(m,null,{default:c(()=>[n(b,{type:"primary",size:"large",class:"login-button",loading:a.value,onClick:u},{default:c(()=>[...s[2]||(s[2]=[L(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}}),P=S(F,[["__scopeId","data-v-f0a50e75"]]);export{P as default};
