import{l as e,aA as a,aC as t,r as l,Z as s,e as o,w as r,b as n,n as i,aF as c,Y as u,ag as d,m,q as g,p,U as h,O as f,u as v,T as y,F as w,a9 as _,S as b,a7 as S,M as k,Q as C}from"./vendor-BtukhyiH.js";import{u as I,B as T,C as x,D as O,F as V,r as L,G as U,s as D,E as R,b as N}from"./elementPlus-DxaqjplL.js";import{g as P,u as $,h as z,i as A,b as M,S as J,c as B,_ as j}from"./index-DkAJPKqn.js";import{d as E}from"./sensitiveInfo-DVfrBLrU.js";import{e as q}from"./export-D-SEmR7Z.js";import{D as H}from"./DynamicTable-BEeD1UIt.js";import{isProduction as Y}from"./env-DLalhsF6.js";import"./utils-DfI7e5Rl.js";import"./TableColumnSettings-CrYSHYg1.js";const W="crm_customer_share_history",F="crm_store_customer",G="crm_mock_users",K=()=>{let e=JSON.parse(localStorage.getItem("currentUser")||"null");if(!e){const a=["user","loginUser","authUser"];for(const t of a){const a=localStorage.getItem(t);if(a)try{if(e=JSON.parse(a),e&&e.id)break}catch{continue}}}return e||{id:"admin",name:"ç®¡ç†å‘˜",role:"admin"}},Q={async getShareHistory(){if(Y())try{const e=await P.get("/customer-share/history");return e.data?.list||[]}catch(e){return console.error("[CustomerShare] APIèŽ·å–åˆ†äº«åŽ†å²å¤±è´¥:",e),[]}try{const e=localStorage.getItem(W);return e?JSON.parse(e):[]}catch(e){return console.error("[CustomerShare] èŽ·å–åˆ†äº«åŽ†å²å¤±è´¥:",e),[]}},async shareCustomer(e){if(Y())try{return{success:!0,message:"å®¢æˆ·åˆ†äº«æˆåŠŸ",data:(await P.post("/customer-share/share",e)).data}}catch(a){return{success:!1,message:a?.message||"åˆ†äº«å¤±è´¥"}}try{const a=K(),t=JSON.parse(localStorage.getItem(F)||'{"customers":[]}'),l=t.customers||[],s=l.findIndex(a=>a.id===e.customerId);if(-1===s)return{success:!1,message:"å®¢æˆ·ä¸å­˜åœ¨"};const o=l[s],r=JSON.parse(localStorage.getItem(G)||"[]").find(a=>a.id===e.sharedTo);if(!r)return{success:!1,message:"ç›®æ ‡ç”¨æˆ·ä¸å­˜åœ¨"};const n=await this.getShareHistory();if(n.find(a=>a.customerId===e.customerId&&a.sharedTo===e.sharedTo&&"active"===a.status))return{success:!1,message:"è¯¥å®¢æˆ·å·²åˆ†äº«ç»™æ­¤ç”¨æˆ·"};const i=0===e.timeLimit?null:new Date(Date.now()+24*e.timeLimit*60*60*1e3).toISOString(),c={id:`share_${Date.now()}`,customerId:e.customerId,customerName:o.name,sharedBy:a.id,sharedByName:a.name,sharedTo:e.sharedTo,sharedToName:r.name,shareTime:(new Date).toISOString(),timeLimit:e.timeLimit,expireTime:i,remark:e.remark,status:"active",originalOwner:o.salesPersonId};return n.push(c),localStorage.setItem(W,JSON.stringify(n)),o.shareInfo={...c,isShared:!0},o.salesPersonId=e.sharedTo,l[s]=o,t.customers=l,localStorage.setItem(F,JSON.stringify(t)),{success:!0,message:"å®¢æˆ·åˆ†äº«æˆåŠŸ",data:c}}catch(a){return console.error("[CustomerShare] åˆ†äº«å®¢æˆ·å¤±è´¥:",a),{success:!1,message:"åˆ†äº«å¤±è´¥"}}},async recallCustomer(e){if(Y())try{return await P.post("/customer-share/recall",e),{success:!0,message:"å®¢æˆ·å›žæ”¶æˆåŠŸ"}}catch(a){return{success:!1,message:a?.message||"å›žæ”¶å¤±è´¥"}}try{const a=K(),t=await this.getShareHistory(),l=t.find(a=>a.id===e.shareId);if(!l)return{success:!1,message:"åˆ†äº«è®°å½•ä¸å­˜åœ¨"};if(!(l.sharedBy===a.id||["super_admin","admin","department_manager"].includes(a.role)))return{success:!1,message:"æ²¡æœ‰æƒé™å›žæ”¶æ­¤å®¢æˆ·"};l.status="recalled",l.recallTime=(new Date).toISOString(),l.recallReason=e.recallReason;const s=JSON.parse(localStorage.getItem(F)||'{"customers":[]}'),o=s.customers||[],r=o.findIndex(e=>e.id===l.customerId);if(-1!==r){const e=o[r];e.salesPersonId=l.originalOwner,delete e.shareInfo,o[r]=e}return localStorage.setItem(W,JSON.stringify(t)),s.customers=o,localStorage.setItem(F,JSON.stringify(s)),{success:!0,message:"å®¢æˆ·å›žæ”¶æˆåŠŸ"}}catch(a){return console.error("[CustomerShare] å›žæ”¶å®¢æˆ·å¤±è´¥:",a),{success:!1,message:"å›žæ”¶å¤±è´¥"}}},async getMySharedCustomers(){if(Y())try{return(await P.get("/customer-share/my-shared")).data||[]}catch(a){return console.error("[CustomerShare] èŽ·å–æˆ‘åˆ†äº«çš„å®¢æˆ·å¤±è´¥:",a),[]}const e=K();return(await this.getShareHistory()).filter(a=>a.sharedBy===e.id&&"active"===a.status)},async getSharedToMeCustomers(){if(Y())try{return(await P.get("/customer-share/shared-to-me")).data||[]}catch(a){return console.error("[CustomerShare] èŽ·å–åˆ†äº«ç»™æˆ‘çš„å®¢æˆ·å¤±è´¥:",a),[]}const e=K();return(await this.getShareHistory()).filter(a=>a.sharedTo===e.id&&"active"===a.status)},async getShareableUsers(){if(Y())try{return(await P.get("/customer-share/shareable-users")).data||[]}catch(a){return console.error("[CustomerShare] èŽ·å–å¯åˆ†äº«ç”¨æˆ·å¤±è´¥:",a),[]}const e=K();return JSON.parse(localStorage.getItem(G)||"[]").filter(a=>a.id!==e.id&&["sales_staff","department_manager","admin"].includes(a.role))},async autoRecallExpiredShares(){const e=await this.getShareHistory(),a=new Date;let t=0;for(const l of e)if("active"===l.status&&l.expireTime){a>=new Date(l.expireTime)&&(await this.recallCustomer({shareId:l.id,recallReason:"åˆ†äº«æ—¶é—´åˆ°æœŸï¼Œè‡ªåŠ¨å›žæ”¶"}),t++)}return t}},Z={class:"customer-list"},X={class:"summary-cards-row"},ee={class:"card-content"},ae={class:"card-icon"},te={class:"card-info"},le={class:"card-value"},se={class:"card-content"},oe={class:"card-icon active"},re={class:"card-info"},ne={class:"card-value"},ie={class:"card-content"},ce={class:"card-icon new"},ue={class:"card-info"},de={class:"card-value"},me={class:"card-content"},ge={class:"card-icon high-value"},pe={class:"card-info"},he={class:"card-value"},fe={class:"quick-filters-row"},ve={class:"quick-filter-buttons"},ye={key:0,class:"allocated"},we={key:1,class:"self-created"},_e={key:0},be={key:0,class:"expire-time"},Se={key:0,class:"share-dialog-content"},ke={class:"customer-info"},Ce={class:"share-settings"},Ie={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Te={style:{color:"#8492a6","font-size":"12px"}},xe={class:"user-select-tip",style:{"margin-top":"5px"}},Oe={class:"time-limit-tip"},Ve={class:"dialog-footer"},Le={class:"stats-section"},Ue={class:"dialog-footer"},De=j(e({__name:"List",setup(e){const P=a(),j=t(),Y=$(),W=z(),F=A(),G=M(),K=B(P);l(!1);const De=l(!1),Re=l([]),Ne=s({keyword:"",level:"",status:"",source:"",dateRange:[]}),Pe=s({totalCustomers:0,activeCustomers:0,newCustomers:0,highValueCustomers:0}),$e=l("all"),ze=[{value:"today",label:"ä»Šæ—¥"},{value:"yesterday",label:"æ˜¨æ—¥"},{value:"week",label:"7å¤©"},{value:"month",label:"30å¤©"},{value:"year",label:"å¹´åº¦"},{value:"all",label:"å…¨éƒ¨"}],Ae=s({page:1,size:10,total:0}),Me=l(!1),Je=l(),Be=s({enabled:!0,permissionType:"all",allowedRoles:["super_admin","admin"],whitelist:[],dailyLimit:0}),je=s({todayCount:0,weekCount:0,monthCount:0}),Ee=o(()=>Y.users||[]),qe=o(()=>{console.log("[CustomerShare] userStore.users:",Y.users.length);const e=Y.users.filter(e=>["sales_staff","department_manager","admin","super_admin"].includes(e.role)).map(e=>({id:e.id,name:e.name,department:e.department||"æœªåˆ†é…éƒ¨é—¨",role:e.role}));return console.log("[CustomerShare] å¯åˆ†äº«çš„é”€å”®äººå‘˜:",e.length),e}),He=o(()=>!!Y.isSuperAdmin||Y.permissions.includes("customer.export"));o(()=>Y.isSuperAdmin||He.value);const Ye=o(()=>{const e=Y.currentUser;return!!e&&"super_admin"===e.role}),We=o(()=>{const e=Y.currentUser;return!!e&&(!(!Y.isAdmin&&!Y.isSuperAdmin)||("department_manager"===e.role||("sales_staff"===e.role||!!Y.permissions.includes("customer:add"))))}),Fe=o(()=>{const e=localStorage.getItem("crm_customer_export_config");if(!e)return!0;try{const a=JSON.parse(e);if(!a.enabled)return!1;const t=Y.currentUser;return!!t&&("all"===a.permissionType||("role"===a.permissionType?a.allowedRoles?.includes(t.role)||!1:"whitelist"===a.permissionType&&a.whitelist?.includes(t.id)||!1))}catch(a){return console.error("è§£æžå¯¼å‡ºé…ç½®å¤±è´¥:",a),!0}}),Ge=o(()=>[{prop:"code",label:"å®¢æˆ·ç¼–ç ",minWidth:130,visible:!0},{prop:"name",label:"å®¢æˆ·å§“å",minWidth:100,visible:!0},{prop:"phone",label:"æ‰‹æœºå·",width:130,visible:!0},{prop:"age",label:"å¹´é¾„",width:70,visible:!0},{prop:"address",label:"åœ°å€",minWidth:180,showOverflowTooltip:!0,visible:!0},{prop:"level",label:"å®¢æˆ·ç­‰çº§",width:90,visible:!0},{prop:"allocationSource",label:"æ¥æº",width:70,visible:!0},{prop:"status",label:"å®¢æˆ·çŠ¶æ€",width:90,visible:Y.isManager||Y.isSuperAdmin},{prop:"salesPerson",label:"è´Ÿè´£é”€å”®",minWidth:100,visible:!0},{prop:"shareStatus",label:"åˆ†äº«çŠ¶æ€",width:120,visible:Y.isAdmin},{prop:"orderCount",label:"è®¢å•æ•°",width:70,visible:!0},{prop:"createTime",label:"æ·»åŠ æ—¶é—´",width:160,visible:!0}]),Ke=l([]),Qe=async()=>{try{const e=await Q.getSharedToMeCustomers();Ke.value=e.map(e=>e.customerId),console.log("[CustomerList] åˆ†äº«ç»™æˆ‘çš„å®¢æˆ·æ•°é‡:",Ke.value.length)}catch(e){console.error("[CustomerList] åŠ è½½åˆ†äº«å®¢æˆ·å¤±è´¥:",e)}},Ze=o(()=>{console.log("=== searchResults computed ==="),console.log("customerStore.customers.length:",F.customers.length);const e=Y.currentUser;if(!e)return console.log("ç”¨æˆ·æœªç™»å½•ï¼Œè¿”å›žç©ºåˆ—è¡¨"),[];console.log("å½“å‰ç”¨æˆ·:",e.name,"è§’è‰²:",e.role);let a=[...F.customers];if("super_admin"===e.role||"admin"===e.role)console.log("[æƒé™è¿‡æ»¤] è¶…çº§ç®¡ç†å‘˜/ç®¡ç†å‘˜ï¼šæ˜¾ç¤ºæ‰€æœ‰å®¢æˆ·");else if("department_manager"===e.role){console.log("[æƒé™è¿‡æ»¤] éƒ¨é—¨ç»ç†ï¼šæ˜¾ç¤ºéƒ¨é—¨å®¢æˆ·");const t=Xe(e.departmentId||e.department);a=a.filter(a=>a.createdBy===e.id||a.salesPersonId===e.id||(!(!t.includes(a.createdBy||"")&&!t.includes(a.salesPersonId||""))||!!Ke.value.includes(a.id))),console.log("[æƒé™è¿‡æ»¤] éƒ¨é—¨ç»ç†è¿‡æ»¤åŽå®¢æˆ·æ•°é‡:",a.length)}else console.log("[æƒé™è¿‡æ»¤] é”€å”®å‘˜/å®¢æœï¼šæ˜¾ç¤ºè‡ªå·±çš„å®¢æˆ·"),a=a.filter(a=>a.createdBy===e.id||a.salesPersonId===e.id||!!Ke.value.includes(a.id)),console.log("[æƒé™è¿‡æ»¤] é”€å”®å‘˜è¿‡æ»¤åŽå®¢æˆ·æ•°é‡:",a.length);if(Ne.keyword){const e=Ne.keyword.toLowerCase().trim();a=a.filter(a=>!!a.name.toLowerCase().includes(e)||(!!a.phone.includes(Ne.keyword)||(!(!a.code||!a.code.toLowerCase().includes(e))||(!(!a.wechatId||!a.wechatId.toLowerCase().includes(e))||(!(!a.email||!a.email.toLowerCase().includes(e))||!(!a.company||!a.company.toLowerCase().includes(e)))))))}if(Ne.level&&(a=a.filter(e=>e.level===Ne.level)),Ne.status&&(a=a.filter(e=>e.status===Ne.status)),Ne.dateRange&&2===Ne.dateRange.length){const[e,t]=Ne.dateRange;a=a.filter(a=>{if(!a.createTime)return!1;let l;try{if(l=new Date(a.createTime),isNaN(l.getTime()))return console.warn("æ— æ•ˆçš„createTimeæ ¼å¼:",a.createTime),!1}catch(s){return console.warn("è§£æžcreateTimeå¤±è´¥:",a.createTime,s),!1}return l>=new Date(e+"T00:00:00")&&l<=new Date(t+"T23:59:59")})}return a.sort((e,a)=>{const t=new Date(e.createTime||0).getTime();return new Date(a.createTime||0).getTime()-t}),a}),Xe=e=>{if(!e)return[];return Y.users.filter(a=>a.department===e||a.departmentId===e).map(e=>e.id)},ea=o(()=>Ze.value.length),aa=o(()=>{console.log("=== customerList computed ==="),console.log("searchResults.value.length:",Ze.value.length),console.log("pagination:",Ae);const e=(Ae.page-1)*Ae.size,a=e+Ae.size;console.log("åˆ†é¡µèŒƒå›´:",e,"to",a);const t=Ze.value.slice(e,a);return console.log("åˆ†é¡µç»“æžœæ•°é‡:",t.length),console.log("åˆ†é¡µç»“æžœ:",t.map(e=>({name:e.name,phone:e.phone}))),t}),ta=e=>({bronze:"",silver:"info",gold:"warning",diamond:"danger",normal:"",vip:"warning",svip:"danger"}[e]||""),la=e=>({bronze:"é“œç‰Œå®¢æˆ·",silver:"é“¶ç‰Œå®¢æˆ·",gold:"é‡‘ç‰Œå®¢æˆ·",diamond:"é’»çŸ³å®¢æˆ·",normal:"é“œç‰Œå®¢æˆ·",vip:"é‡‘ç‰Œå®¢æˆ·",svip:"é’»çŸ³å®¢æˆ·","æ™®é€šå®¢æˆ·":"é“œç‰Œå®¢æˆ·","VIPå®¢æˆ·":"é‡‘ç‰Œå®¢æˆ·","SVIPå®¢æˆ·":"é’»çŸ³å®¢æˆ·"}[e]||"é“œç‰Œå®¢æˆ·"),sa=e=>({active:"æ´»è·ƒ",inactive:"éžæ´»è·ƒ",potential:"æ½œåœ¨å®¢æˆ·",lost:"æµå¤±å®¢æˆ·",blacklist:"é»‘åå•"}[e]||"æœªçŸ¥"),oa=()=>{console.log("æ‰‹åŠ¨åˆ·æ–°ï¼Œå¼ºåˆ¶é‡æ–°åŠ è½½æ•°æ®"),Pa(!0)},ra=()=>{K.push("/customer/add")},na=e=>{K.push(`/customer/detail/${e.id}`)},ia=e=>{Re.value=e},ca=()=>{ua(),da(),Me.value=!0},ua=()=>{try{const e=localStorage.getItem("crm_customer_export_config");if(e){const a=JSON.parse(e);Object.assign(Be,a)}}catch(e){console.error("åŠ è½½å¯¼å‡ºé…ç½®å¤±è´¥:",e)}},da=()=>{try{const e=localStorage.getItem("crm_customer_export_stats");if(!e)return je.todayCount=0,je.weekCount=0,void(je.monthCount=0);const a=JSON.parse(e),t=(new Date).toISOString().split("T")[0],l=new Date(Date.now()-6048e5).toISOString().split("T")[0],s=new Date(Date.now()-2592e6).toISOString().split("T")[0];je.todayCount=a[t]||0,je.weekCount=Object.keys(a).filter(e=>e>=l).reduce((e,t)=>e+a[t],0),je.monthCount=Object.keys(a).filter(e=>e>=s).reduce((e,t)=>e+a[t],0)}catch(e){console.error("åŠ è½½å¯¼å‡ºç»Ÿè®¡å¤±è´¥:",e)}},ma=()=>{const e={enabled:Be.enabled,permissionType:Be.permissionType,allowedRoles:Be.allowedRoles,whitelist:Be.whitelist,dailyLimit:Be.dailyLimit};localStorage.setItem("crm_customer_export_config",JSON.stringify(e)),R.success("å®¢æˆ·å¯¼å‡ºæƒé™è®¾ç½®å·²ä¿å­˜å¹¶å…¨å±€ç”Ÿæ•ˆ"),Me.value=!1},ga=()=>{Be.enabled=!0,Be.permissionType="all",Be.allowedRoles=["super_admin","admin"],Be.whitelist=[],Be.dailyLimit=0,R.success("å·²æ¢å¤é»˜è®¤è®¾ç½®")},pa=()=>{try{const e=localStorage.getItem("crm_customer_export_config");if(!e)return!0;const a=JSON.parse(e).dailyLimit||0;if(0===a)return!0;const t=(new Date).toISOString().split("T")[0],l=localStorage.getItem("crm_customer_export_stats"),s=l?JSON.parse(l):{};return!((s[t]||0)>=a)||(R.warning(`æ¯æ—¥å¯¼å‡ºæ¬¡æ•°å·²è¾¾ä¸Šé™ï¼ˆ${a}æ¬¡ï¼‰`),!1)}catch(e){return console.error("æ£€æŸ¥å¯¼å‡ºé™åˆ¶å¤±è´¥:",e),!0}},ha=()=>{try{const e=(new Date).toISOString().split("T")[0],a=localStorage.getItem("crm_customer_export_stats"),t=a?JSON.parse(a):{};t[e]=(t[e]||0)+1,localStorage.setItem("crm_customer_export_stats",JSON.stringify(t))}catch(e){console.error("è®°å½•å¯¼å‡ºç»Ÿè®¡å¤±è´¥:",e)}},fa=async()=>{if(pa())if(Fe.value)try{const a=Y.isSuperAdmin?"ç¡®å®šè¦å¯¼å‡ºæ‰€æœ‰å®¢æˆ·æ•°æ®å—ï¼Ÿå¯¼å‡ºçš„æ•°æ®å°†åŒ…å«å®Œæ•´çš„å®¢æˆ·ä¿¡æ¯ã€‚":"ç¡®å®šè¦å¯¼å‡ºæ‰€æœ‰å®¢æˆ·æ•°æ®å—ï¼Ÿæ•æ„Ÿä¿¡æ¯å°†è¿›è¡Œè„±æ•å¤„ç†ã€‚";await N.confirm(a,"æ‰¹é‡å¯¼å‡ºç¡®è®¤",{confirmButtonText:"ç¡®å®šå¯¼å‡º",cancelButtonText:"å–æ¶ˆ",type:"warning"}),De.value=!0;try{const e=Ze.value.map(e=>({code:e.code||"",name:e.name,phone:e.phone,age:e.age,address:e.address,level:la(e.level),status:sa(e.status),salesPersonId:e.salesPersonId,salesPersonName:xa(e.salesPersonId),orderCount:e.orderCount,createTime:e.createTime,createdBy:e.createdBy||"",wechatId:e.wechatId,email:e.email,company:e.company,position:e.position,source:e.allocationSource,tags:e.tags,remarks:e.remarks})),a=q(e,He.value);ha(),R.success(`å®¢æˆ·æ•°æ®å¯¼å‡ºæˆåŠŸï¼š${a}`)}catch(e){console.error("å¯¼å‡ºå¤±è´¥:",e),R.error("å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{De.value=!1}}catch(a){"cancel"!==a&&R.error("æ“ä½œå–æ¶ˆ")}else R.warning("æ‚¨æ²¡æœ‰å®¢æˆ·å¯¼å‡ºæƒé™")},va=async()=>{if(0!==Re.value.length){if(pa())if(Fe.value)try{const a=Y.isSuperAdmin?`ç¡®å®šè¦å¯¼å‡ºé€‰ä¸­çš„ ${Re.value.length} ä¸ªå®¢æˆ·æ•°æ®å—ï¼Ÿå¯¼å‡ºçš„æ•°æ®å°†åŒ…å«å®Œæ•´çš„å®¢æˆ·ä¿¡æ¯ã€‚`:`ç¡®å®šè¦å¯¼å‡ºé€‰ä¸­çš„ ${Re.value.length} ä¸ªå®¢æˆ·æ•°æ®å—ï¼Ÿæ•æ„Ÿä¿¡æ¯å°†è¿›è¡Œè„±æ•å¤„ç†ã€‚`;await N.confirm(a,"å¯¼å‡ºé€‰ä¸­å®¢æˆ·",{confirmButtonText:"ç¡®å®šå¯¼å‡º",cancelButtonText:"å–æ¶ˆ",type:"info"}),De.value=!0;try{const e=Re.value.map(e=>({code:e.code||"",name:e.name,phone:e.phone,age:e.age,address:e.address,level:la(e.level),status:sa(e.status),salesPersonId:e.salesPersonId,salesPersonName:xa(e.salesPersonId),orderCount:e.orderCount,createTime:e.createTime,createdBy:e.createdBy||"",wechatId:e.wechatId,email:e.email,company:e.company,position:e.position,source:e.allocationSource,tags:e.tags,remarks:e.remarks})),a=q(e,He.value);ha(),R.success(`é€‰ä¸­å®¢æˆ·æ•°æ®å¯¼å‡ºæˆåŠŸï¼š${a}`),Re.value=[]}catch(e){console.error("å¯¼å‡ºå¤±è´¥:",e),R.error("å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{De.value=!1}}catch(a){"cancel"!==a&&R.error("æ“ä½œå–æ¶ˆ")}else R.warning("æ‚¨æ²¡æœ‰å®¢æˆ·å¯¼å‡ºæƒé™")}else R.warning("è¯·å…ˆé€‰æ‹©è¦å¯¼å‡ºçš„å®¢æˆ·")},ya=l(!1),wa=s({targetUserId:"",timeLimit:7,remark:""}),_a=l(null),ba=l(""),Sa=o(()=>{if(!_a.value)return[];let e=qe.value.filter(e=>e.id!==_a.value?.salesPersonId);if(ba.value){const a=ba.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(a)||e.department&&e.department.toLowerCase().includes(a)||e.id.toLowerCase().includes(a))}return e}),ka=e=>{ba.value=e},Ca=e=>({super_admin:"è¶…çº§ç®¡ç†å‘˜",admin:"ç®¡ç†å‘˜",department_manager:"éƒ¨é—¨ç»ç†",sales_staff:"é”€å”®äººå‘˜",customer_service:"å®¢æœäººå‘˜"}[e]||e),Ia=[{label:"1å¤©",value:1},{label:"3å¤©",value:3},{label:"7å¤©",value:7},{label:"15å¤©",value:15},{label:"30å¤©",value:30},{label:"æ°¸ä¹…",value:0}],Ta=async()=>{if(wa.targetUserId)if(_a.value)try{De.value=!0;const e=_a.value,a={customerId:e.id,sharedTo:wa.targetUserId,timeLimit:wa.timeLimit,remark:wa.remark},t=await Q.shareCustomer(a);if(t.success){const a=qe.value.find(e=>e.id===wa.targetUserId),t=0===wa.timeLimit?"æ°¸ä¹…":`${wa.timeLimit}å¤©`;R.success(`å®¢æˆ· ${e.name} å·²æˆåŠŸåˆ†äº«ç»™ ${a?.name||"ç›®æ ‡ç”¨æˆ·"}ï¼Œæ—¶é—´é™åˆ¶ï¼š${t}`),G.sendMessage(G.MessageType.CUSTOMER_SHARE,`å®¢æˆ· ${e.name} å·²åˆ†äº«ç»™ ${a?.name||"ç›®æ ‡ç”¨æˆ·"}ï¼ˆæ—¶é—´é™åˆ¶ï¼š${t}ï¼‰`,{relatedId:e.id,relatedType:"customer",actionUrl:`/customer/detail/${e.id}`}),await Pa(!0),ya.value=!1}else R.error(t.message||"åˆ†äº«å¤±è´¥")}catch(e){console.error("åˆ†äº«å¤±è´¥:",e),R.error("åˆ†äº«å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{De.value=!1}else R.warning("è¯·é€‰æ‹©è¦åˆ†äº«çš„å®¢æˆ·");else R.warning("è¯·é€‰æ‹©è¦åˆ†äº«ç»™çš„é”€å”®äººå‘˜")},xa=e=>{const a=qe.value.find(a=>a.id===e);return a?a.name:"æœªåˆ†é…"},Oa=async()=>{try{const e=await Q.autoRecallExpiredShares();e>0&&(console.log(`[CustomerShare] è‡ªåŠ¨å›žæ”¶äº† ${e} ä¸ªè¿‡æœŸåˆ†äº«`),await Pa(!0))}catch(e){console.error("[CustomerShare] æ£€æŸ¥è¿‡æœŸåˆ†äº«å¤±è´¥:",e)}},Va=e=>{const a=new Date,t=new Date(e).getTime()-a.getTime();if(t<=0)return"å·²è¿‡æœŸ";const l=Math.floor(t/864e5),s=Math.floor(t%864e5/36e5);if(l>0)return`${l}å¤©${s}å°æ—¶`;if(s>0)return`${s}å°æ—¶`;return`${Math.floor(t%36e5/6e4)}åˆ†é’Ÿ`},La=e=>{if(!e||"active"!==e.status)return"";if(!e.expireTime)return"success";const a=new Date,t=new Date(e.expireTime).getTime()-a.getTime(),l=Math.floor(t/864e5);return l<=1?"danger":l<=3?"warning":"info"},Ua=()=>{Ae.page=1,Ae.total=ea.value,$a()},Da=()=>{Object.assign(Ne,{keyword:"",level:"",status:"",source:"",dateRange:[]}),Ua()},Ra=e=>{Ae.size=e,Ae.total=ea.value},Na=e=>{Ae.page=e},Pa=async(e=!1)=>{try{De.value=!0;const e=window.location.hostname,a=!("localhost"===e||"127.0.0.1"===e||e.includes("192.168")||e.includes("dev.")||e.includes("test."));console.log("[CustomerList] hostname:",e,", isProdEnv:",a),a?(console.log("[CustomerList] ðŸŒ ç”Ÿäº§çŽ¯å¢ƒï¼šå¼ºåˆ¶ä»ŽAPIåŠ è½½å®¢æˆ·æ•°æ®"),await F.loadCustomers()):console.log("[CustomerList] ðŸ’» å¼€å‘çŽ¯å¢ƒï¼šä½¿ç”¨æœ¬åœ°å®¢æˆ·æ•°æ®"),await i(),Ae.total=Ze.value.length,await $a(),console.log("[CustomerList] åŠ è½½å®Œæˆï¼Œå®¢æˆ·æ•°é‡:",F.customers.length)}catch(a){console.error("loadCustomerList é”™è¯¯:",a),W.showError("åŠ è½½å®¢æˆ·åˆ—è¡¨å¤±è´¥",a)}finally{De.value=!1}},$a=()=>{try{const e=Ze.value,a=(new Date).toISOString().split("T")[0];Pe.totalCustomers=e.length,Pe.activeCustomers=e.filter(e=>"active"===e.status).length,Pe.newCustomers=e.filter(e=>{if(!e.createTime)return!1;try{const t=new Date(e.createTime);if(isNaN(t.getTime()))return!1;return t.toISOString().split("T")[0]===a}catch(t){return console.warn("è§£æžå®¢æˆ·åˆ›å»ºæ—¶é—´å¤±è´¥:",e.createTime,t),!1}}).length,Pe.highValueCustomers=e.filter(e=>"gold"===e.level).length,console.log("ç»Ÿè®¡æ•°æ®å·²æ›´æ–°:",Pe)}catch(e){console.error("åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:",e)}};r(ea,e=>{Ae.total=e}),r(()=>F.customers,e=>{console.log("æ£€æµ‹åˆ°customerStoreå®¢æˆ·æ•°æ®å˜åŒ–ï¼Œå®¢æˆ·æ•°é‡:",e.length),i(()=>{console.log("å®¢æˆ·åˆ—è¡¨é¡µé¢æ•°æ®å·²æ›´æ–°ï¼Œå½“å‰æ˜¾ç¤ºå®¢æˆ·æ•°é‡:",aa.value.length)})},{deep:!0,immediate:!0}),r(Ze,()=>{$a()},{immediate:!0}),r(()=>j.path,async(e,a)=>{"/customer/list"===e&&(console.log("è·¯ç”±åˆ‡æ¢åˆ°å®¢æˆ·åˆ—è¡¨é¡µé¢ï¼Œä»Ž:",a,"åˆ°:",e),"/customer/add"===a?(console.log("ä»Žæ·»åŠ é¡µé¢è¿”å›žï¼Œæ‰§è¡Œå¼ºåŒ–æ•°æ®åŒæ­¥æµç¨‹"),Ae.page=1,Ne.keyword="",Ne.level="",Ne.status="",Ne.dateRange=null,$e.value="all",await i(),await Pa(!0),console.log("å¼ºåŒ–æ•°æ®åŒæ­¥å®Œæˆï¼Œæ–°å®¢æˆ·åº”è¯¥å·²æ˜¾ç¤ºï¼Œå½“å‰å®¢æˆ·æ•°é‡:",F.customers.length)):a?.startsWith("/customer/edit/")?(console.log("ä»Žç¼–è¾‘é¡µé¢è¿”å›žï¼Œé‡æ–°åŠ è½½æ•°æ®"),await Pa(!0)):a&&0!==F.customers.length?(console.log("å…¶ä»–æƒ…å†µï¼Œé‡æ–°åŠ è½½æ•°æ®ç¡®ä¿åŒæ­¥"),await Pa(!1)):(console.log("é¦–æ¬¡è¿›å…¥æˆ–åˆ—è¡¨ä¸ºç©ºï¼ŒåŠ è½½æ•°æ®"),await Pa(!0)))},{immediate:!0}),r(()=>j.query,e=>{"/customer/list"===j.path&&"true"===e.refresh&&(console.log("æ£€æµ‹åˆ°åˆ·æ–°å‚æ•°ï¼Œæ›´æ–°å®¢æˆ·åˆ—è¡¨æ˜¾ç¤º"),console.log("å½“å‰å®¢æˆ·æ€»æ•°:",F.customers.length),console.log("æœç´¢ç»“æžœæ•°é‡:",Ze.value.length),Ae.page=1,Ae.total=Ze.value.length,i(()=>{console.log("ç¬¬ä¸€æ¬¡nextTick - åˆ†é¡µæ€»æ•°:",Ae.total),console.log("ç¬¬ä¸€æ¬¡nextTick - å½“å‰é¡µå®¢æˆ·æ•°:",aa.value.length),i(()=>{Ae.total=Ze.value.length,console.log("ç¬¬äºŒæ¬¡nextTick - æœ€ç»ˆåˆ†é¡µæ€»æ•°:",Ae.total),console.log("ç¬¬äºŒæ¬¡nextTick - æœ€ç»ˆå®¢æˆ·æ•°:",aa.value.length),console.log("ç¬¬äºŒæ¬¡nextTick - å®¢æˆ·åˆ—è¡¨:",aa.value.map(e=>e.name))})}),K.replace({path:"/customer/list"}))},{immediate:!1});const za=l(null);return n(async()=>{if(!(await(async()=>(console.log("=== æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€ ==="),console.log("å½“å‰ç”¨æˆ·:",Y.currentUser),console.log("æ˜¯å¦å·²ç™»å½•:",Y.isLoggedIn),Y.isLoggedIn&&Y.currentUser?(console.log("ç”¨æˆ·å·²ç™»å½•ï¼Œè§’è‰²:",Y.currentUser.role),!0):(console.log("ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢..."),R.warning("è¯·å…ˆç™»å½•"),P.push("/login"),!1)))()))return;console.log("[å®¢æˆ·åˆ—è¡¨] onMounted - å¼€å§‹åˆå§‹åŒ–"),console.log("[å®¢æˆ·åˆ—è¡¨] å½“å‰customerStoreä¸­çš„å®¢æˆ·æ•°é‡:",F.customers.length),await Y.loadUsers(),console.log("[å®¢æˆ·åˆ—è¡¨] ç”¨æˆ·åˆ—è¡¨å·²åŠ è½½:",Y.users.length,"ä¸ªç”¨æˆ·"),console.log("[å®¢æˆ·åˆ—è¡¨] å½“å‰å®¢æˆ·æ•°é‡:",F.customers.length);const e="true"===j.query.refresh,a=!!j.query.timestamp;await i();const t=e||a||0===F.customers.length;(e||a)&&(Ae.page=1,Ne.keyword="",Ne.level="",Ne.status="",Ne.dateRange=null,$e.value="all",await i()),await Promise.all([Pa(t),Qe()]),console.log("[å®¢æˆ·åˆ—è¡¨] onMounted - åˆå§‹åŒ–å®Œæˆï¼Œå½“å‰æ˜¾ç¤ºå®¢æˆ·æ•°é‡:",aa.value.length),za.value=setInterval(()=>{Oa()},6e4),Oa()}),c(async()=>{console.log("[å®¢æˆ·åˆ—è¡¨] onActivated - ç»„ä»¶æ¿€æ´»"),console.log("[å®¢æˆ·åˆ—è¡¨] å½“å‰customerStoreä¸­çš„å®¢æˆ·æ•°é‡:",F.customers.length);const e="true"===j.query.refresh;console.log("[å®¢æˆ·åˆ—è¡¨] æ£€æŸ¥refreshå‚æ•°:",e),e?(console.log("[å®¢æˆ·åˆ—è¡¨] æ£€æµ‹åˆ°refreshå‚æ•°ï¼Œé‡ç½®ç­›é€‰æ¡ä»¶"),console.log("[å®¢æˆ·åˆ—è¡¨] å½“å‰å®¢æˆ·æ•°é‡:",F.customers.length),Ae.page=1,Ne.keyword="",Ne.level="",Ne.status="",Ne.dateRange=null,$e.value="all",await i(),await Pa(!0),await P.replace({path:"/customer/list"})):(console.log("[å®¢æˆ·åˆ—è¡¨] å½“å‰å®¢æˆ·æ•°é‡:",F.customers.length),Ae.total=ea.value,console.log("[å®¢æˆ·åˆ—è¡¨] æ›´æ–°åˆ†é¡µæ€»æ•°:",Ae.total)),console.log("[å®¢æˆ·åˆ—è¡¨] onActivatedå®Œæˆï¼Œå½“å‰æ˜¾ç¤ºå®¢æˆ·æ•°é‡:",aa.value.length)}),u(()=>{za.value&&(clearInterval(za.value),za.value=null);document.querySelectorAll('a[href^="blob:"]').forEach(e=>{const a=e.getAttribute("href");a&&a.startsWith("blob:")&&(URL.revokeObjectURL(a),e.parentNode&&e.parentNode.removeChild(e))})}),(e,a)=>{const t=d("el-icon"),l=d("el-card"),s=d("el-button"),o=d("el-input"),r=d("el-form-item"),n=d("el-col"),i=d("el-date-picker"),c=d("el-option"),u=d("el-select"),N=d("el-row"),P=d("el-form"),$=d("el-tag"),z=d("el-text"),A=d("el-descriptions-item"),M=d("el-descriptions"),B=d("el-dialog"),j=d("el-switch"),q=d("el-radio"),W=d("el-radio-group"),F=d("el-checkbox"),Q=d("el-checkbox-group"),Ae=d("el-input-number"),qe=d("el-divider");return g(),m("div",Z,[p("div",X,[h(l,{class:"summary-card"},{default:f(()=>[p("div",ee,[p("div",ae,[h(t,null,{default:f(()=>[h(v(I))]),_:1})]),p("div",te,[p("div",le,y(Pe.totalCustomers),1),a[17]||(a[17]=p("div",{class:"card-label"},"æ€»å®¢æˆ·æ•°",-1))])])]),_:1}),h(l,{class:"summary-card"},{default:f(()=>[p("div",se,[p("div",oe,[h(t,null,{default:f(()=>[h(v(T))]),_:1})]),p("div",re,[p("div",ne,y(Pe.activeCustomers),1),a[18]||(a[18]=p("div",{class:"card-label"},"æ´»è·ƒå®¢æˆ·",-1))])])]),_:1}),h(l,{class:"summary-card"},{default:f(()=>[p("div",ie,[p("div",ce,[h(t,null,{default:f(()=>[h(v(x))]),_:1})]),p("div",ue,[p("div",de,y(Pe.newCustomers),1),a[19]||(a[19]=p("div",{class:"card-label"},"æ–°å¢žå®¢æˆ·",-1))])])]),_:1}),h(l,{class:"summary-card"},{default:f(()=>[p("div",me,[p("div",ge,[h(t,null,{default:f(()=>[h(v(O))]),_:1})]),p("div",pe,[p("div",he,y(Pe.highValueCustomers),1),a[20]||(a[20]=p("div",{class:"card-label"},"é«˜ä»·å€¼å®¢æˆ·",-1))])])]),_:1})]),p("div",fe,[p("div",ve,[(g(),m(w,null,_(ze,e=>h(s,{key:e.value,type:$e.value===e.value?"primary":"",plain:$e.value!==e.value,round:"",size:"small",onClick:a=>(e=>{$e.value=e;const a=new Date,t=new Date(a);t.setDate(t.getDate()-1);const l=new Date(a);l.setDate(l.getDate()-7);const s=new Date(a);s.setDate(s.getDate()-30);const o=new Date(a.getFullYear(),0,1);switch(e){case"today":Ne.dateRange=[a.toISOString().split("T")[0],a.toISOString().split("T")[0]];break;case"yesterday":Ne.dateRange=[t.toISOString().split("T")[0],t.toISOString().split("T")[0]];break;case"week":Ne.dateRange=[l.toISOString().split("T")[0],a.toISOString().split("T")[0]];break;case"month":Ne.dateRange=[s.toISOString().split("T")[0],a.toISOString().split("T")[0]];break;case"year":Ne.dateRange=[o.toISOString().split("T")[0],a.toISOString().split("T")[0]];break;case"all":Ne.dateRange=[]}Ua()})(e.value)},{default:f(()=>[b(y(e.label),1)]),_:2},1032,["type","plain","onClick"])),64))])]),h(l,{class:"search-card",shadow:"never"},{default:f(()=>[h(P,{model:Ne,"label-width":"80px",class:"search-form"},{default:f(()=>[h(N,{gutter:20},{default:f(()=>[h(n,{span:6},{default:f(()=>[h(r,{label:"å…³é”®è¯"},{default:f(()=>[h(o,{modelValue:Ne.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>Ne.keyword=e),placeholder:"å®¢æˆ·å§“åã€ç”µè¯æˆ–ç¼–ç ",clearable:"",onKeyup:S(Ua,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),h(n,{span:6},{default:f(()=>[h(r,{label:"é€‰æ‹©æ—¥æœŸ"},{default:f(()=>[h(i,{modelValue:Ne.dateRange,"onUpdate:modelValue":a[1]||(a[1]=e=>Ne.dateRange=e),type:"daterange","range-separator":"è‡³","start-placeholder":"å¼€å§‹æ—¥æœŸ","end-placeholder":"ç»“æŸæ—¥æœŸ",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),h(n,{span:4},{default:f(()=>[h(r,{label:"å®¢æˆ·ç­‰çº§"},{default:f(()=>[h(u,{modelValue:Ne.level,"onUpdate:modelValue":a[2]||(a[2]=e=>Ne.level=e),placeholder:"è¯·é€‰æ‹©",clearable:"",style:{width:"100%"}},{default:f(()=>[h(c,{label:"æ™®é€š",value:"normal"}),h(c,{label:"ç™½é“¶",value:"silver"}),h(c,{label:"é»„é‡‘",value:"gold"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),h(n,{span:4},{default:f(()=>[h(r,{label:"å®¢æˆ·çŠ¶æ€"},{default:f(()=>[h(u,{modelValue:Ne.status,"onUpdate:modelValue":a[3]||(a[3]=e=>Ne.status=e),placeholder:"è¯·é€‰æ‹©",clearable:"",style:{width:"100%"}},{default:f(()=>[h(c,{label:"æ´»è·ƒ",value:"active"}),h(c,{label:"éžæ´»è·ƒ",value:"inactive"}),h(c,{label:"æ½œåœ¨å®¢æˆ·",value:"potential"}),h(c,{label:"æµå¤±å®¢æˆ·",value:"lost"}),h(c,{label:"é»‘åå•",value:"blacklist"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),h(n,{span:4},{default:f(()=>[h(r,{label:"å®¢æˆ·æ¥æº"},{default:f(()=>[h(u,{modelValue:Ne.source,"onUpdate:modelValue":a[4]||(a[4]=e=>Ne.source=e),placeholder:"è¯·é€‰æ‹©",clearable:"",style:{width:"100%"}},{default:f(()=>[h(c,{label:"çº¿ä¸ŠæŽ¨å¹¿",value:"online"}),h(c,{label:"çº¿ä¸‹æ´»åŠ¨",value:"offline"}),h(c,{label:"å®¢æˆ·æŽ¨è",value:"referral"}),h(c,{label:"ç”µè¯è¥é”€",value:"telemarketing"}),h(c,{label:"å…¶ä»–",value:"other"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),h(N,{gutter:20},{default:f(()=>[h(n,{span:24},{default:f(()=>[h(r,null,{default:f(()=>[h(s,{type:"primary",onClick:Ua,icon:v(V)},{default:f(()=>[...a[21]||(a[21]=[b("æœç´¢",-1)])]),_:1},8,["icon"]),h(s,{onClick:Da,icon:v(L)},{default:f(()=>[...a[22]||(a[22]=[b("é‡ç½®",-1)])]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),h(H,{data:aa.value,columns:Ge.value,"storage-key":"customer-list-columns",title:"å®¢æˆ·åˆ—è¡¨",loading:De.value,"show-selection":!0,"show-actions":!0,total:ea.value,"page-sizes":[10,20,50,100],onSelectionChange:ia,onSizeChange:Ra,onCurrentChange:Na,class:"customer-table"},{"header-actions":f(()=>[We.value?(g(),k(s,{key:0,type:"primary",onClick:ra},{default:f(()=>[h(t,null,{default:f(()=>[h(v(x))]),_:1}),a[23]||(a[23]=b(" æ–°å»ºå®¢æˆ· ",-1))]),_:1})):C("",!0),Fe.value?(g(),k(s,{key:1,type:"success",onClick:fa},{default:f(()=>[h(t,null,{default:f(()=>[h(v(U))]),_:1}),a[24]||(a[24]=b(" æ‰¹é‡å¯¼å‡º ",-1))]),_:1})):C("",!0),Fe.value&&Re.value.length>0?(g(),k(s,{key:2,type:"warning",onClick:va,disabled:0===Re.value.length},{default:f(()=>[h(t,null,{default:f(()=>[h(v(U))]),_:1}),b(" å¯¼å‡ºé€‰ä¸­ ("+y(Re.value.length)+") ",1)]),_:1},8,["disabled"])):C("",!0),Ye.value?(g(),k(s,{key:3,onClick:ca,class:"export-settings-btn",title:"å¯¼å‡ºæƒé™è®¾ç½®"},{default:f(()=>[h(t,null,{default:f(()=>[h(v(D))]),_:1})]),_:1})):C("",!0),h(s,{onClick:oa,loading:De.value},{default:f(()=>[h(t,null,{default:f(()=>[h(v(L))]),_:1}),a[25]||(a[25]=b(" åˆ·æ–° ",-1))]),_:1},8,["loading"])]),"column-code":f(({row:e})=>[h(s,{type:"text",onClick:a=>na(e),class:"code-link"},{default:f(()=>[b(y(e.code||"N/A"),1)]),_:2},1032,["onClick"])]),"column-name":f(({row:e})=>[h(s,{type:"text",onClick:a=>na(e),class:"name-link"},{default:f(()=>[b(y(e.name),1)]),_:2},1032,["onClick"])]),"column-phone":f(({row:e})=>[h(s,{type:"text",onClick:a=>na(e),class:"phone-link"},{default:f(()=>[b(y(v(E)(e.phone,v(J).PHONE,v(Y).currentUser?.id||"")),1)]),_:2},1032,["onClick"])]),"column-level":f(({row:e})=>[h($,{type:ta(e.level)},{default:f(()=>[b(y(la(e.level)),1)]),_:2},1032,["type"])]),"column-allocationSource":f(({row:e})=>{return[(a=e,a.createdBy&&a.createdBy!==Y.currentUser?.id?(g(),m("span",ye,"åˆ†é…")):(g(),m("span",we,"è‡ªå»º")))];var a}),"column-status":f(({row:e})=>{return[h($,{type:(a=e.status,{active:"success",inactive:"info",potential:"warning",lost:"danger",blacklist:"danger"}[a]||"")},{default:f(()=>[b(y(sa(e.status)),1)]),_:2},1032,["type"])];var a}),"column-salesPerson":f(({row:e})=>[b(y(xa(e.salesPersonId)),1)]),"column-shareStatus":f(({row:e})=>[e.shareInfo&&"active"===e.shareInfo.status?(g(),m("div",_e,[h($,{type:La(e.shareInfo),size:"small"},{default:f(()=>[b(y(e.shareInfo.expireTime?"é™æ—¶åˆ†äº«":"æ°¸ä¹…åˆ†äº«"),1)]),_:2},1032,["type"]),e.shareInfo.expireTime?(g(),m("div",be,[h(z,{size:"small",type:"info"},{default:f(()=>[b(" å‰©ä½™: "+y(Va(e.shareInfo.expireTime)),1)]),_:2},1024)])):C("",!0)])):(g(),k(z,{key:1,size:"small",type:"info"},{default:f(()=>[...a[26]||(a[26]=[b("æœªåˆ†äº«",-1)])]),_:1}))]),"table-actions":f(({row:e})=>[h(s,{type:"text",size:"small",onClick:a=>na(e)},{default:f(()=>[...a[27]||(a[27]=[b("è¯¦æƒ…",-1)])]),_:1},8,["onClick"]),h(s,{type:"text",size:"small",onClick:a=>(e=>{const a=new URLSearchParams({customerId:e.id,customerName:e.name,customerPhone:e.phone,customerAddress:e.address||""});K.push(`/order/add?${a.toString()}`)})(e)},{default:f(()=>[...a[28]||(a[28]=[b("ä¸‹å•",-1)])]),_:1},8,["onClick"]),h(s,{type:"text",size:"small",onClick:a=>(async e=>{try{R.info("æ­£åœ¨å‘èµ·å¤–å‘¼..."),setTimeout(()=>{R.success("å¤–å‘¼å·²å‘èµ·"),G.sendMessage(G.MessageType.CUSTOMER_CALL,`å·²å‘å®¢æˆ· ${e.name}ï¼ˆ${E(e.phone,J.PHONE,Y.currentUser?.id||"")}ï¼‰å‘èµ·å¤–å‘¼`,{relatedId:e.id,relatedType:"customer",actionUrl:`/customer/detail/${e.id}?tab=followup`}),K.push({name:"CustomerDetail",params:{id:e.id},query:{tab:"followup"}})},1e3)}catch(a){R.error("å¤–å‘¼å¤±è´¥ï¼Œè¯·é‡è¯•"),console.error("å¤–å‘¼å¤±è´¥:",a)}})(e)},{default:f(()=>[...a[29]||(a[29]=[b("å¤–å‘¼",-1)])]),_:1},8,["onClick"]),v(Y).isAdmin?(g(),k(s,{key:0,type:"text",size:"small",onClick:a=>(async e=>{Y.isAdmin?(_a.value=e,wa.targetUserId="",wa.timeLimit=7,wa.remark="",ba.value="",ya.value=!0):R.warning("åªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ†äº«å®¢æˆ·")})(e)},{default:f(()=>[...a[30]||(a[30]=[b("åˆ†äº«",-1)])]),_:1},8,["onClick"])):C("",!0)]),_:1},8,["data","columns","loading","total"]),h(B,{modelValue:ya.value,"onUpdate:modelValue":a[9]||(a[9]=e=>ya.value=e),title:"åˆ†äº«å®¢æˆ·",width:"500px","close-on-click-modal":!1},{footer:f(()=>[p("div",Ve,[h(s,{onClick:a[8]||(a[8]=e=>ya.value=!1)},{default:f(()=>[...a[33]||(a[33]=[b("å–æ¶ˆ",-1)])]),_:1}),h(s,{type:"primary",onClick:Ta,loading:De.value},{default:f(()=>[...a[34]||(a[34]=[b(" ç¡®è®¤åˆ†äº« ",-1)])]),_:1},8,["loading"])])]),default:f(()=>[_a.value?(g(),m("div",Se,[p("div",ke,[a[31]||(a[31]=p("h4",null,"å®¢æˆ·ä¿¡æ¯",-1)),h(M,{column:2,border:"",size:"small"},{default:f(()=>[h(A,{label:"å®¢æˆ·å§“å"},{default:f(()=>[b(y(_a.value.name),1)]),_:1}),h(A,{label:"è”ç³»ç”µè¯"},{default:f(()=>[b(y(v(E)(_a.value.phone,v(J).PHONE,v(Y).currentUser?.id||"")),1)]),_:1}),h(A,{label:"å®¢æˆ·ç­‰çº§"},{default:f(()=>[h($,{type:ta(_a.value.level),size:"small"},{default:f(()=>[b(y(la(_a.value.level)),1)]),_:1},8,["type"])]),_:1}),h(A,{label:"å½“å‰å½’å±ž"},{default:f(()=>[b(y(xa(_a.value.salesPersonId)),1)]),_:1})]),_:1})]),p("div",Ce,[a[32]||(a[32]=p("h4",null,"åˆ†äº«è®¾ç½®",-1)),h(P,{model:wa,"label-width":"100px"},{default:f(()=>[h(r,{label:"åˆ†äº«ç»™",required:""},{default:f(()=>[h(u,{modelValue:wa.targetUserId,"onUpdate:modelValue":a[5]||(a[5]=e=>wa.targetUserId=e),placeholder:"è¯·è¾“å…¥å§“åæˆ–é€‰æ‹©é”€å”®äººå‘˜",style:{width:"100%"},filterable:"",clearable:"","filter-method":ka},{default:f(()=>[(g(!0),m(w,null,_(Sa.value,e=>(g(),k(c,{key:e.id,label:`${e.name} - ${e.department||"æœªåˆ†é…éƒ¨é—¨"} (${Ca(e.role)})`,value:e.id},{default:f(()=>[p("div",Ie,[p("span",null,y(e.name),1),p("span",Te,y(e.department||"æœªåˆ†é…éƒ¨é—¨")+" | "+y(Ca(e.role)),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),p("div",xe,[h(z,{size:"small",type:"info"},{default:f(()=>[b(" å…± "+y(Sa.value.length)+" ä¸ªå¯é€‰ç”¨æˆ· ",1)]),_:1})])]),_:1}),h(r,{label:"æ—¶é—´é™åˆ¶",required:""},{default:f(()=>[h(u,{modelValue:wa.timeLimit,"onUpdate:modelValue":a[6]||(a[6]=e=>wa.timeLimit=e),style:{width:"100%"}},{default:f(()=>[(g(),m(w,null,_(Ia,e=>h(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),p("div",Oe,[h(z,{size:"small",type:"info"},{default:f(()=>[b(y(0===wa.timeLimit?"æ°¸ä¹…åˆ†äº«ï¼Œä¸ä¼šè‡ªåŠ¨å›žæ”¶":`${wa.timeLimit}å¤©åŽè‡ªåŠ¨å›žæ”¶åˆ°åŽŸå½’å±žäºº`),1)]),_:1})])]),_:1}),h(r,{label:"åˆ†äº«å¤‡æ³¨"},{default:f(()=>[h(o,{modelValue:wa.remark,"onUpdate:modelValue":a[7]||(a[7]=e=>wa.remark=e),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥åˆ†äº«åŽŸå› æˆ–å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])])):C("",!0)]),_:1},8,["modelValue"]),h(B,{modelValue:Me.value,"onUpdate:modelValue":a[16]||(a[16]=e=>Me.value=e),title:"å®¢æˆ·å¯¼å‡ºæƒé™è®¾ç½®",width:"700px","close-on-click-modal":!1},{footer:f(()=>[p("div",Ue,[h(s,{onClick:a[15]||(a[15]=e=>Me.value=!1)},{default:f(()=>[...a[50]||(a[50]=[b("å–æ¶ˆ",-1)])]),_:1}),h(s,{type:"primary",onClick:ma},{default:f(()=>[...a[51]||(a[51]=[b("ä¿å­˜è®¾ç½®",-1)])]),_:1}),h(s,{onClick:ga},{default:f(()=>[...a[52]||(a[52]=[b("æ¢å¤é»˜è®¤",-1)])]),_:1})])]),default:f(()=>[h(P,{ref_key:"exportFormRef",ref:Je,model:Be,"label-width":"140px"},{default:f(()=>[h(r,{label:"å¯ç”¨å¯¼å‡ºåŠŸèƒ½"},{default:f(()=>[h(j,{modelValue:Be.enabled,"onUpdate:modelValue":a[10]||(a[10]=e=>Be.enabled=e),"active-text":"å¯ç”¨","inactive-text":"ç¦ç”¨"},null,8,["modelValue"]),a[35]||(a[35]=p("div",{class:"form-item-tip"}," å…³é—­åŽï¼Œæ‰€æœ‰æˆå‘˜å°†æ— æ³•ä½¿ç”¨å®¢æˆ·å¯¼å‡ºåŠŸèƒ½ ",-1))]),_:1}),Be.enabled?(g(),k(r,{key:0,label:"æƒé™æŽ§åˆ¶æ–¹å¼"},{default:f(()=>[h(W,{modelValue:Be.permissionType,"onUpdate:modelValue":a[11]||(a[11]=e=>Be.permissionType=e)},{default:f(()=>[h(q,{label:"all"},{default:f(()=>[...a[36]||(a[36]=[b("æ‰€æœ‰äººå¯ç”¨",-1)])]),_:1}),h(q,{label:"role"},{default:f(()=>[...a[37]||(a[37]=[b("æŒ‰è§’è‰²æŽ§åˆ¶",-1)])]),_:1}),h(q,{label:"whitelist"},{default:f(()=>[...a[38]||(a[38]=[b("ç™½åå•æŽ§åˆ¶",-1)])]),_:1})]),_:1},8,["modelValue"]),a[39]||(a[39]=p("div",{class:"form-item-tip"}," é€‰æ‹©å¯¼å‡ºåŠŸèƒ½çš„æƒé™æŽ§åˆ¶æ–¹å¼ ",-1))]),_:1})):C("",!0),Be.enabled&&"role"===Be.permissionType?(g(),k(r,{key:1,label:"å…è®¸çš„è§’è‰²"},{default:f(()=>[h(Q,{modelValue:Be.allowedRoles,"onUpdate:modelValue":a[12]||(a[12]=e=>Be.allowedRoles=e)},{default:f(()=>[h(F,{label:"super_admin"},{default:f(()=>[...a[40]||(a[40]=[b("è¶…çº§ç®¡ç†å‘˜",-1)])]),_:1}),h(F,{label:"admin"},{default:f(()=>[...a[41]||(a[41]=[b("ç®¡ç†å‘˜",-1)])]),_:1}),h(F,{label:"department_manager"},{default:f(()=>[...a[42]||(a[42]=[b("éƒ¨é—¨ç»ç†",-1)])]),_:1}),h(F,{label:"sales_staff"},{default:f(()=>[...a[43]||(a[43]=[b("é”€å”®äººå‘˜",-1)])]),_:1}),h(F,{label:"customer_service"},{default:f(()=>[...a[44]||(a[44]=[b("å®¢æœäººå‘˜",-1)])]),_:1})]),_:1},8,["modelValue"]),a[45]||(a[45]=p("div",{class:"form-item-tip"}," é€‰æ‹©å…è®¸ä½¿ç”¨å¯¼å‡ºåŠŸèƒ½çš„è§’è‰² ",-1))]),_:1})):C("",!0),Be.enabled&&"whitelist"===Be.permissionType?(g(),k(r,{key:2,label:"ç™½åå•æˆå‘˜"},{default:f(()=>[h(u,{modelValue:Be.whitelist,"onUpdate:modelValue":a[13]||(a[13]=e=>Be.whitelist=e),multiple:"",filterable:"",placeholder:"é€‰æ‹©å…è®¸å¯¼å‡ºçš„æˆå‘˜",style:{width:"100%"}},{default:f(()=>[(g(!0),m(w,null,_(Ee.value,e=>(g(),k(c,{key:e.id,label:`${e.name} (${e.id})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a[46]||(a[46]=p("div",{class:"form-item-tip"}," åªæœ‰ç™½åå•ä¸­çš„æˆå‘˜å¯ä»¥ä½¿ç”¨å¯¼å‡ºåŠŸèƒ½ï¼Œå…¶ä»–äººçœ‹ä¸åˆ°å¯¼å‡ºæŒ‰é’® ",-1))]),_:1})):C("",!0),Be.enabled?(g(),k(r,{key:3,label:"å¯¼å‡ºé™åˆ¶"},{default:f(()=>[h(Ae,{modelValue:Be.dailyLimit,"onUpdate:modelValue":a[14]||(a[14]=e=>Be.dailyLimit=e),min:0,max:100,placeholder:"æ¯æ—¥å¯¼å‡ºæ¬¡æ•°é™åˆ¶"},null,8,["modelValue"]),a[47]||(a[47]=p("span",{style:{"margin-left":"10px"}},"æ¬¡/å¤©ï¼ˆ0è¡¨ç¤ºä¸é™åˆ¶ï¼‰",-1)),a[48]||(a[48]=p("div",{class:"form-item-tip"}," é™åˆ¶æ¯ä¸ªæˆå‘˜æ¯å¤©çš„å¯¼å‡ºæ¬¡æ•°ï¼Œé˜²æ­¢æ»¥ç”¨ ",-1))]),_:1})):C("",!0)]),_:1},8,["model"]),h(qe),p("div",Le,[a[49]||(a[49]=p("h3",null,"å¯¼å‡ºç»Ÿè®¡",-1)),h(M,{column:3,border:""},{default:f(()=>[h(A,{label:"ä»Šæ—¥å¯¼å‡ºæ¬¡æ•°"},{default:f(()=>[b(y(je.todayCount),1)]),_:1}),h(A,{label:"æœ¬å‘¨å¯¼å‡ºæ¬¡æ•°"},{default:f(()=>[b(y(je.weekCount),1)]),_:1}),h(A,{label:"æœ¬æœˆå¯¼å‡ºæ¬¡æ•°"},{default:f(()=>[b(y(je.monthCount),1)]),_:1})]),_:1})])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-835cad8b"]]);export{De as default};
