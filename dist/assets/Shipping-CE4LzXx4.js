var Ut=Object.defineProperty,Bt=Object.defineProperties;var Lt=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var Yt=Object.prototype.hasOwnProperty,It=Object.prototype.propertyIsEnumerable;var lt=(_,R,b)=>R in _?Ut(_,R,{enumerable:!0,configurable:!0,writable:!0,value:b}):_[R]=b,Ce=(_,R)=>{for(var b in R||(R={}))Yt.call(R,b)&&lt(_,b,R[b]);if(tt)for(var b of tt(R))It.call(R,b)&&lt(_,b,R[b]);return _},Ve=(_,R)=>Bt(_,Lt(R));var J=(_,R,b)=>new Promise((q,E)=>{var S=k=>{try{c(b.next(k))}catch(P){E(P)}},M=k=>{try{c(b.throw(k))}catch(P){E(P)}},c=k=>k.done?q(k.value):Promise.resolve(k.value).then(S,M);c((b=b.apply(_,R)).next())});import{l as Oe,e as me,r as D,c as Je,ag as f,M as ae,p as y,O as l,m as A,Q as ne,U as t,q as e,S as n,u as m,F as de,a9 as fe,J as zt,T as i,Z as Ae,w as Pe,az as Pt,Y as qt}from"./vendor-D8Vxqhr-.js";import{i as rt,B as Ft,a7 as qe,v as Be,as as je,E as h,b as ge,w as De,M as ye,r as Rt,a2 as st,C as Le,K as it,u as Ht,L as Et,n as Ke,Q as Qe,a1 as Ze,c as dt,a8 as Wt,at as jt,q as Kt,aj as Jt,au as Qt,s as ze,h as ot,av as nt,f as We,ar as Zt,e as at,T as Gt,aw as Xt}from"./elementPlus-Bmwh7Rh8.js";import{_ as Se,j as ut,g as el,u as tl,c as ll}from"./settings-CuxbDWOu.js";import{useDepartmentStore as sl}from"./department-CTOju6hT.js";import{a as ol,b as nl}from"./export-CTEZNzGJ.js";import{m as pe}from"./phone-DsAzMHsn.js";import{O as al}from"./OrderDetailDialog-54R0Lf8m.js";import{D as rl}from"./DynamicTable-CiyMIP8-.js";import"./utils-ywHRn0uI.js";const il={key:0,class:"print-content"},dl={class:"print-settings"},ul={class:"section-title"},cl={class:"settings-grid"},pl={class:"setting-item"},ml={class:"setting-item"},fl={class:"setting-item"},vl={class:"label-preview"},gl={class:"section-title"},_l={class:"preview-container"},yl={key:0,class:"standard-template"},bl={class:"label-header"},hl={class:"company-info"},kl={class:"label-body"},wl={class:"sender-info"},$l={class:"receiver-info"},Tl={class:"order-info"},xl={class:"label-footer"},Cl={class:"tracking-info"},Vl={key:1,class:"simple-template"},Al={class:"simple-header"},Dl={class:"order-no"},Ol={class:"simple-body"},Sl={class:"address-section"},Nl={class:"to-address"},Ml={class:"name"},Ul={class:"phone"},Bl={class:"address"},Ll={class:"product-section"},Yl={key:0,class:"cod-amount"},Il={key:2,class:"detailed-template"},zl={class:"detailed-header"},Pl={class:"logo-section"},ql={class:"company-details"},Fl={class:"order-summary"},Rl={class:"detailed-body"},Hl={class:"info-table"},El={class:"value-cell"},Wl={class:"value-cell"},jl={class:"value-cell",colspan:"3"},Kl={class:"value-cell",colspan:"3"},Jl={class:"value-cell"},Ql={class:"value-cell cod-highlight"},Zl={class:"detailed-footer"},Gl={class:"logistics-info"},Xl={class:"service-info"},es={class:"dialog-footer"},ts=Oe({__name:"PrintLabelDialog",props:{visible:{type:Boolean},order:{}},emits:["update:visible"],setup(_,{emit:R}){const b=_,q=R,E=me({get:()=>b.visible,set:$=>q("update:visible",$)}),S=D(""),M=D("standard"),c=D(1),k=D(""),P=D(""),z=D(!1),Z=D([{id:"printer1",name:"HP LaserJet Pro M404n",status:"online"},{id:"printer2",name:"Canon PIXMA G3010",status:"offline"},{id:"printer3",name:"Epson L3150",status:"online"}]),Q=D([{id:"standard",name:"标准模板",description:"包含完整信息的标准面单"},{id:"simple",name:"简约模板",description:"简洁清晰的面单样式"},{id:"detailed",name:"详细模板",description:"详细信息表格式面单"}]),H=D({name:"智慧销售CRM系统",address:"北京市朝阳区科技园区xxx号",phone:"400-123-4567",slogan:"专业、高效、贴心的服务",senderName:"客服中心",senderPhone:"010-12345678",senderAddress:"北京市朝阳区科技园区xxx号"}),ee=$=>$.toLocaleString(),j=()=>{var $;return!(($=b.order)!=null&&$.products)||!Array.isArray(b.order.products)?"":b.order.products.map(r=>`${r.name} × ${r.quantity}`).join("，")},te=()=>J(this,null,function*(){if(!S.value){h.warning("请先选择打印机");return}try{h.loading("正在连接打印机..."),yield new Promise($=>setTimeout($,2e3)),h.success("打印机连接成功")}catch($){h.error("打印机连接失败，请检查打印机状态")}}),se=()=>{z.value=!0},N=()=>{h.success("模板保存成功"),z.value=!1},o=()=>{var r;const $=window.open("","_blank");if($){const Y=(r=document.querySelector(".label-template"))==null?void 0:r.outerHTML;$.document.write(`
      <html>
        <head>
          <title>面单预览</title>
          <style>
            body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
            .label-template { max-width: 800px; margin: 0 auto; }
            @media print {
              body { margin: 0; padding: 0; }
              .label-template { max-width: none; }
            }
          </style>
        </head>
        <body>
          ${Y}
        </body>
      </html>
    `),$.document.close()}},a=()=>J(this,null,function*(){if(!S.value){h.warning("请先选择打印机");return}try{yield ge.confirm(`确认打印 ${c.value} 份面单吗？`,"确认打印",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}),h.loading("正在打印..."),yield new Promise($=>setTimeout($,3e3)),h.success(`成功打印 ${c.value} 份面单`),v()}catch($){}}),v=()=>{E.value=!1};return Je(()=>{k.value="SF"+Date.now().toString().slice(-8),P.value="顺丰速运"}),($,r)=>{const Y=f("el-icon"),I=f("el-option"),T=f("el-select"),w=f("el-button"),g=f("el-input-number"),U=f("el-dialog");return y(),ae(U,{modelValue:E.value,"onUpdate:modelValue":r[5]||(r[5]=x=>E.value=x),title:"打印面单",width:"70%","before-close":v,class:"print-label-dialog"},{footer:l(()=>[e("div",es,[t(w,{onClick:v},{default:l(()=>[...r[41]||(r[41]=[n("取消",-1)])]),_:1}),t(w,{type:"info",onClick:o},{default:l(()=>[t(Y,null,{default:l(()=>[t(m(Be))]),_:1}),r[42]||(r[42]=n(" 预览打印 ",-1))]),_:1}),t(w,{type:"primary",onClick:a,disabled:!S.value},{default:l(()=>[t(Y,null,{default:l(()=>[t(m(je))]),_:1}),r[43]||(r[43]=n(" 确认打印 ",-1))]),_:1},8,["disabled"])])]),default:l(()=>[_.order?(y(),A("div",il,[e("div",dl,[e("h3",ul,[t(Y,null,{default:l(()=>[t(m(rt))]),_:1}),r[6]||(r[6]=n(" 打印设置 ",-1))]),e("div",cl,[e("div",pl,[r[8]||(r[8]=e("label",null,"选择打印机：",-1)),t(T,{modelValue:S.value,"onUpdate:modelValue":r[0]||(r[0]=x=>S.value=x),placeholder:"请选择打印机",class:"printer-select"},{default:l(()=>[(y(!0),A(de,null,fe(Z.value,x=>(y(),ae(I,{key:x.id,label:x.name,value:x.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(w,{type:"primary",size:"small",onClick:te,class:"connect-btn"},{default:l(()=>[t(Y,null,{default:l(()=>[t(m(Ft))]),_:1}),r[7]||(r[7]=n(" 连接打印机 ",-1))]),_:1})]),e("div",ml,[r[10]||(r[10]=e("label",null,"打印模板：",-1)),t(T,{modelValue:M.value,"onUpdate:modelValue":r[1]||(r[1]=x=>M.value=x),placeholder:"请选择模板",class:"template-select"},{default:l(()=>[(y(!0),A(de,null,fe(Q.value,x=>(y(),ae(I,{key:x.id,label:x.name,value:x.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(w,{type:"success",size:"small",onClick:se,class:"edit-btn"},{default:l(()=>[t(Y,null,{default:l(()=>[t(m(qe))]),_:1}),r[9]||(r[9]=n(" 编辑模板 ",-1))]),_:1})]),e("div",fl,[r[11]||(r[11]=e("label",null,"打印份数：",-1)),t(g,{modelValue:c.value,"onUpdate:modelValue":r[2]||(r[2]=x=>c.value=x),min:1,max:10,class:"copies-input"},null,8,["modelValue"])])])]),e("div",vl,[e("h3",gl,[t(Y,null,{default:l(()=>[t(m(Be))]),_:1}),r[12]||(r[12]=n(" 面单预览 ",-1))]),e("div",_l,[e("div",{class:zt(["label-template",M.value])},[M.value==="standard"?(y(),A("div",yl,[e("div",bl,[e("div",hl,[e("h2",null,i(H.value.name),1),e("p",null,i(H.value.address),1),e("p",null,"客服电话："+i(m(pe)(H.value.phone)),1)]),r[13]||(r[13]=e("div",{class:"qr-code"},[e("div",{class:"qr-placeholder"},"二维码")],-1))]),e("div",kl,[e("div",wl,[r[17]||(r[17]=e("h4",null,"寄件人信息",-1)),e("p",null,[r[14]||(r[14]=e("strong",null,"姓名：",-1)),n(i(H.value.senderName),1)]),e("p",null,[r[15]||(r[15]=e("strong",null,"电话：",-1)),n(i(m(pe)(H.value.senderPhone)),1)]),e("p",null,[r[16]||(r[16]=e("strong",null,"地址：",-1)),n(i(H.value.senderAddress),1)])]),e("div",$l,[r[21]||(r[21]=e("h4",null,"收件人信息",-1)),e("p",null,[r[18]||(r[18]=e("strong",null,"姓名：",-1)),n(i(_.order.customerName),1)]),e("p",null,[r[19]||(r[19]=e("strong",null,"电话：",-1)),n(i(m(pe)(_.order.phone)),1)]),e("p",null,[r[20]||(r[20]=e("strong",null,"地址：",-1)),n(i(_.order.address),1)])]),e("div",Tl,[r[26]||(r[26]=e("h4",null,"订单信息",-1)),e("p",null,[r[22]||(r[22]=e("strong",null,"订单号：",-1)),n(i(_.order.orderNo),1)]),e("p",null,[r[23]||(r[23]=e("strong",null,"商品：",-1)),n(i(j()),1)]),e("p",null,[r[24]||(r[24]=e("strong",null,"数量：",-1)),n(i(_.order.totalQuantity)+"件",1)]),e("p",null,[r[25]||(r[25]=e("strong",null,"代收款：",-1)),n("¥"+i(ee(_.order.codAmount)),1)])])]),e("div",xl,[e("div",Cl,[e("p",null,[r[27]||(r[27]=e("strong",null,"运单号：",-1)),n(i(k.value||"待生成"),1)]),e("p",null,[r[28]||(r[28]=e("strong",null,"物流公司：",-1)),n(i(P.value||"待选择"),1)])]),r[29]||(r[29]=e("div",{class:"barcode"},[e("div",{class:"barcode-placeholder"},"条形码")],-1))])])):M.value==="simple"?(y(),A("div",Vl,[e("div",Al,[e("h3",null,i(H.value.name),1),e("span",Dl,i(_.order.orderNo),1)]),e("div",Ol,[e("div",Sl,[e("div",Nl,[r[30]||(r[30]=e("h4",null,"收件人",-1)),e("p",Ml,i(_.order.customerName),1),e("p",Ul,i(m(pe)(_.order.phone)),1),e("p",Bl,i(_.order.address),1)])]),e("div",Ll,[r[31]||(r[31]=e("h4",null,"商品信息",-1)),e("p",null,i(j()),1),_.order.codAmount>0?(y(),A("p",Yl," 代收款：¥"+i(ee(_.order.codAmount)),1)):ne("",!0)])])])):M.value==="detailed"?(y(),A("div",Il,[e("div",zl,[e("div",Pl,[r[32]||(r[32]=e("div",{class:"logo-placeholder"},"LOGO",-1)),e("div",ql,[e("h2",null,i(H.value.name),1),e("p",null,i(H.value.slogan),1)])]),e("div",Fl,[e("h3",null,"订单："+i(_.order.orderNo),1),e("p",null,"下单时间："+i(_.order.createTime||"2024-01-15 10:30"),1)])]),e("div",Rl,[e("table",Hl,[e("tbody",null,[e("tr",null,[r[33]||(r[33]=e("td",{class:"label-cell"},"收件人",-1)),e("td",El,i(_.order.customerName),1),r[34]||(r[34]=e("td",{class:"label-cell"},"联系电话",-1)),e("td",Wl,i(m(pe)(_.order.phone)),1)]),e("tr",null,[r[35]||(r[35]=e("td",{class:"label-cell"},"收货地址",-1)),e("td",jl,i(_.order.address),1)]),e("tr",null,[r[36]||(r[36]=e("td",{class:"label-cell"},"商品信息",-1)),e("td",Kl,i(j()),1)]),e("tr",null,[r[37]||(r[37]=e("td",{class:"label-cell"},"订单金额",-1)),e("td",Jl,"¥"+i(ee(_.order.totalAmount)),1),r[38]||(r[38]=e("td",{class:"label-cell"},"代收款",-1)),e("td",Ql,"¥"+i(ee(_.order.codAmount)),1)])])])]),e("div",Zl,[e("div",Gl,[e("p",null,[r[39]||(r[39]=e("strong",null,"物流公司：",-1)),n(i(P.value||"待选择"),1)]),e("p",null,[r[40]||(r[40]=e("strong",null,"运单号：",-1)),n(i(k.value||"待生成"),1)])]),e("div",Xl,[e("p",null,"客服微信："+i(_.order.serviceWechat),1),e("p",null,"客服电话："+i(m(pe)(H.value.phone)),1)])])])):ne("",!0)],2)])])])):ne("",!0),t(U,{modelValue:z.value,"onUpdate:modelValue":r[4]||(r[4]=x=>z.value=x),title:"编辑打印模板",width:"60%","append-to-body":""},{footer:l(()=>[t(w,{onClick:r[3]||(r[3]=x=>z.value=!1)},{default:l(()=>[...r[44]||(r[44]=[n("取消",-1)])]),_:1}),t(w,{type:"primary",onClick:N},{default:l(()=>[...r[45]||(r[45]=[n("保存模板",-1)])]),_:1})]),default:l(()=>[r[46]||(r[46]=e("div",{class:"template-editor"},[e("p",null,"模板编辑功能开发中..."),e("p",null,"您可以在这里自定义面单的布局、字体、颜色等样式。")],-1))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),ls=Se(ts,[["__scopeId","data-v-9583ca11"]]),ss={key:0,class:"shipping-content"},os={class:"order-summary"},ns={class:"section-title"},as={class:"order-info-grid"},rs={class:"info-item"},is={class:"value"},ds={class:"info-item"},us={class:"value"},cs={class:"info-item"},ps={class:"value"},ms={class:"info-item"},fs={class:"value"},vs={class:"info-item"},gs={class:"value"},_s={class:"info-item"},ys={class:"value cod-amount"},bs={class:"logistics-form"},hs={class:"section-title"},ks={class:"company-option"},ws={class:"company-name"},$s={class:"company-code"},Ts={class:"tracking-tip"},xs={class:"insurance-tip"},Cs={class:"shipping-confirm"},Vs={class:"dialog-footer"},As=Oe({__name:"ShippingDialog",props:{visible:{type:Boolean},order:{}},emits:["update:visible","shipped"],setup(_,{emit:R}){const b=_,q=R,E=me({get:()=>b.visible,set:a=>q("update:visible",a)}),S=D(),M=D(!1),c=ut(),k=Ae({logisticsCompany:"",trackingNumber:"",estimatedDelivery:"",remarks:"",shippingMethod:"standard",insuranceAmount:0}),P={logisticsCompany:[{required:!0,message:"请选择物流公司",trigger:"change"}],trackingNumber:[{required:!0,message:"请输入运单号",trigger:"blur"},{min:8,max:20,message:"运单号长度应在8-20位之间",trigger:"blur"}]},z=D([{code:"SF",name:"顺丰速运",prefix:"SF"},{code:"YTO",name:"圆通速递",prefix:"YT"},{code:"ZTO",name:"中通快递",prefix:"ZTO"},{code:"STO",name:"申通快递",prefix:"STO"},{code:"YD",name:"韵达速递",prefix:"YD"},{code:"HTKY",name:"百世快递",prefix:"HT"},{code:"JD",name:"京东物流",prefix:"JD"},{code:"EMS",name:"中国邮政",prefix:"EMS"},{code:"DBKD",name:"德邦快递",prefix:"DB"},{code:"UC",name:"优速快递",prefix:"UC"}]),Z=a=>a.toLocaleString(),Q=()=>{var a;return!((a=b.order)!=null&&a.products)||!Array.isArray(b.order.products)?"":b.order.products.map(v=>`${v.name} × ${v.quantity}`).join("，")},H=a=>{k.trackingNumber="";const v=new Date,$=ee(a),r=new Date(v.getTime()+$*24*60*60*1e3);k.estimatedDelivery=r.toISOString().split("T")[0]},ee=a=>({SF:1,JD:1,YTO:2,ZTO:2,STO:2,YD:2,HTKY:3,EMS:3,DBKD:2,UC:3})[a]||3,j=()=>{if(!k.logisticsCompany){h.warning("请先选择物流公司");return}const a=z.value.find(v=>v.code===k.logisticsCompany);if(a){const v=Date.now().toString(),$=Math.random().toString(36).substring(2,6).toUpperCase();k.trackingNumber=`${a.prefix}${v.slice(-8)}${$}`}},te=a=>a.getTime()<Date.now()-24*60*60*1e3,se=()=>J(this,null,function*(){try{h.loading("正在保存草稿..."),yield new Promise(a=>setTimeout(a,1e3)),h.success("草稿保存成功")}catch(a){h.error("草稿保存失败")}}),N=()=>J(this,null,function*(){var a;if(S.value)try{yield S.value.validate(),yield ge.confirm(`确认发货订单 ${b.order.orderNo} 吗？发货后将无法撤销。`,"确认发货",{confirmButtonText:"确认发货",cancelButtonText:"取消",type:"warning"}),M.value=!0,yield new Promise(Y=>setTimeout(Y,2e3));const v=Ve(Ce({orderId:b.order.id,orderNo:b.order.orderNo},k),{shippingTime:new Date().toISOString(),status:"shipped"}),$=b.order.orderNo.replace("ORD",""),r=((a=z.value.find(Y=>Y.code===k.logisticsCompany))==null?void 0:a.name)||k.logisticsCompany;c.syncOrderStatus($,"shipped","物流员",`订单已发货，快递公司：${r}，快递单号：${k.trackingNumber}`),q("shipped",v),h.success("发货成功！已通知客户"),o()}catch(v){v!=="cancel"&&h.error("发货失败，请重试")}finally{M.value=!1}}),o=()=>{S.value&&S.value.resetFields(),Object.assign(k,{logisticsCompany:"",trackingNumber:"",estimatedDelivery:"",remarks:"",shippingMethod:"standard",insuranceAmount:0}),E.value=!1};return Je(()=>{var a;(a=b.order)!=null&&a.totalAmount&&(k.insuranceAmount=Math.round(b.order.totalAmount*.8))}),(a,v)=>{const $=f("el-icon"),r=f("el-option"),Y=f("el-select"),I=f("el-form-item"),T=f("el-button"),w=f("el-input"),g=f("el-date-picker"),U=f("el-radio"),x=f("el-radio-group"),W=f("el-input-number"),re=f("el-form"),oe=f("el-alert"),ie=f("el-dialog");return y(),ae(ie,{modelValue:E.value,"onUpdate:modelValue":v[6]||(v[6]=C=>E.value=C),title:"发货处理",width:"50%","before-close":o,class:"shipping-dialog"},{footer:l(()=>[e("div",Vs,[t(T,{onClick:o},{default:l(()=>[...v[21]||(v[21]=[n("取消",-1)])]),_:1}),t(T,{type:"info",onClick:se},{default:l(()=>[t($,null,{default:l(()=>[t(m(Le))]),_:1}),v[22]||(v[22]=n(" 保存草稿 ",-1))]),_:1}),t(T,{type:"primary",onClick:N,loading:M.value},{default:l(()=>[t($,null,{default:l(()=>[t(m(ye))]),_:1}),v[23]||(v[23]=n(" 确认发货 ",-1))]),_:1},8,["loading"])])]),default:l(()=>[_.order?(y(),A("div",ss,[e("div",os,[e("h3",ns,[t($,null,{default:l(()=>[t(m(De))]),_:1}),v[7]||(v[7]=n(" 订单信息 ",-1))]),e("div",as,[e("div",rs,[v[8]||(v[8]=e("span",{class:"label"},"订单号：",-1)),e("span",is,i(_.order.orderNo),1)]),e("div",ds,[v[9]||(v[9]=e("span",{class:"label"},"客户姓名：",-1)),e("span",us,i(_.order.customerName),1)]),e("div",cs,[v[10]||(v[10]=e("span",{class:"label"},"联系电话：",-1)),e("span",ps,i(m(pe)(_.order.phone)),1)]),e("div",ms,[v[11]||(v[11]=e("span",{class:"label"},"收货地址：",-1)),e("span",fs,i(_.order.address),1)]),e("div",vs,[v[12]||(v[12]=e("span",{class:"label"},"商品信息：",-1)),e("span",gs,i(Q()),1)]),e("div",_s,[v[13]||(v[13]=e("span",{class:"label"},"代收款金额：",-1)),e("span",ys,"¥"+i(Z(_.order.codAmount)),1)])])]),e("div",bs,[e("h3",hs,[t($,null,{default:l(()=>[t(m(ye))]),_:1}),v[14]||(v[14]=n(" 物流信息 ",-1))]),t(re,{model:k,rules:P,ref_key:"formRef",ref:S,"label-width":"120px"},{default:l(()=>[t(I,{label:"物流公司",prop:"logisticsCompany",required:""},{default:l(()=>[t(Y,{modelValue:k.logisticsCompany,"onUpdate:modelValue":v[0]||(v[0]=C=>k.logisticsCompany=C),placeholder:"请选择物流公司",class:"full-width",filterable:"",onChange:H},{default:l(()=>[(y(!0),A(de,null,fe(z.value,C=>(y(),ae(r,{key:C.code,label:C.name,value:C.code},{default:l(()=>[e("div",ks,[e("span",ws,i(C.name),1),e("span",$s,"("+i(C.code)+")",1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"运单号",prop:"trackingNumber",required:""},{default:l(()=>[t(w,{modelValue:k.trackingNumber,"onUpdate:modelValue":v[1]||(v[1]=C=>k.trackingNumber=C),placeholder:"请输入运单号",class:"full-width",clearable:""},{append:l(()=>[t(T,{onClick:j,type:"primary"},{default:l(()=>[t($,null,{default:l(()=>[t(m(Rt))]),_:1}),v[15]||(v[15]=n(" 生成 ",-1))]),_:1})]),_:1},8,["modelValue"]),e("div",Ts,[t($,null,{default:l(()=>[t(m(st))]),_:1}),v[16]||(v[16]=e("span",null,"运单号可以手动输入或点击生成按钮自动生成",-1))])]),_:1}),t(I,{label:"预计送达",prop:"estimatedDelivery"},{default:l(()=>[t(g,{modelValue:k.estimatedDelivery,"onUpdate:modelValue":v[2]||(v[2]=C=>k.estimatedDelivery=C),type:"date",placeholder:"选择预计送达日期",class:"full-width","disabled-date":te},null,8,["modelValue"])]),_:1}),t(I,{label:"发货备注",prop:"remarks"},{default:l(()=>[t(w,{modelValue:k.remarks,"onUpdate:modelValue":v[3]||(v[3]=C=>k.remarks=C),type:"textarea",rows:3,placeholder:"请输入发货备注（选填）",maxlength:"200","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1}),t(I,{label:"发货方式",prop:"shippingMethod"},{default:l(()=>[t(x,{modelValue:k.shippingMethod,"onUpdate:modelValue":v[4]||(v[4]=C=>k.shippingMethod=C)},{default:l(()=>[t(U,{label:"standard"},{default:l(()=>[...v[17]||(v[17]=[n("标准快递",-1)])]),_:1}),t(U,{label:"express"},{default:l(()=>[...v[18]||(v[18]=[n("加急快递",-1)])]),_:1}),t(U,{label:"economy"},{default:l(()=>[...v[19]||(v[19]=[n("经济快递",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"保价金额",prop:"insuranceAmount"},{default:l(()=>[t(W,{modelValue:k.insuranceAmount,"onUpdate:modelValue":v[5]||(v[5]=C=>k.insuranceAmount=C),min:0,max:_.order.totalAmount,precision:2,placeholder:"保价金额",class:"full-width"},null,8,["modelValue","max"]),e("div",xs,[t($,null,{default:l(()=>[t(m(st))]),_:1}),e("span",null,"建议保价金额不超过订单总金额 ¥"+i(Z(_.order.totalAmount)),1)])]),_:1})]),_:1},8,["model"])]),e("div",Cs,[t(oe,{title:"发货确认",type:"warning",closable:!1,"show-icon":""},{default:l(()=>[...v[20]||(v[20]=[e("p",null,"确认发货后，系统将：",-1),e("ul",null,[e("li",null,'更新订单状态为"已发货"'),e("li",null,"记录物流信息和运单号"),e("li",null,"发送发货通知给客户"),e("li",null,"开始物流跟踪")],-1)])]),_:1})])])):ne("",!0)]),_:1},8,["modelValue"])}}}),Ds=Se(As,[["__scopeId","data-v-190bb191"]]),Os={class:"batch-content"},Ss={class:"selected-orders"},Ns={class:"section-title"},Ms={class:"orders-summary"},Us={class:"summary-cards"},Bs={class:"summary-card"},Ls={class:"card-value"},Ys={class:"summary-card"},Is={class:"card-value"},zs={class:"summary-card"},Ps={class:"card-value cod-amount"},qs={class:"orders-table"},Fs={class:"cod-text"},Rs={class:"batch-settings"},Hs={class:"section-title"},Es={class:"form-grid"},Ws={class:"company-option"},js={class:"company-name"},Ks={class:"company-code"},Js={key:0,class:"tracking-manual"},Qs={class:"section-title"},Zs={class:"tracking-inputs"},Gs={class:"order-label"},Xs={key:1,class:"tracking-import"},eo={class:"section-title"},to={class:"import-area"},lo={class:"import-template"},so={class:"shipping-preview"},oo={class:"section-title"},no={key:0,class:"auto-tracking"},ao={key:1},ro={key:2},io={class:"shipping-confirm"},uo={class:"warning-text"},co={class:"dialog-footer"},po=Oe({__name:"BatchShippingDialog",props:{visible:{type:Boolean},selectedOrders:{}},emits:["update:visible","batch-shipped"],setup(_,{emit:R}){const b=_,q=R,E=me({get:()=>b.visible,set:w=>q("update:visible",w)}),S=D(),M=D(!1),c=Ae({logisticsCompany:"",shippingMethod:"standard",trackingMode:"auto",estimatedDelivery:"",remarks:""}),k=D([]),P=D([]),z={logisticsCompany:[{required:!0,message:"请选择物流公司",trigger:"change"}]},Z=D([{code:"SF",name:"顺丰速运",prefix:"SF"},{code:"YTO",name:"圆通速递",prefix:"YT"},{code:"ZTO",name:"中通快递",prefix:"ZTO"},{code:"STO",name:"申通快递",prefix:"STO"},{code:"YD",name:"韵达速递",prefix:"YD"},{code:"HTKY",name:"百世快递",prefix:"HT"},{code:"JD",name:"京东物流",prefix:"JD"},{code:"EMS",name:"中国邮政",prefix:"EMS"}]),Q=me(()=>Array.isArray(b.selectedOrders)?b.selectedOrders.reduce((w,g)=>w+(g.totalAmount||0),0):0),H=me(()=>Array.isArray(b.selectedOrders)?b.selectedOrders.reduce((w,g)=>w+(g.codAmount||0),0):0),ee=me(()=>Array.isArray(b.selectedOrders)?b.selectedOrders:[]);Pe(()=>b.selectedOrders,w=>{Array.isArray(w)?(k.value=new Array(w.length).fill(""),P.value=new Array(w.length).fill("")):(k.value=[],P.value=[])},{immediate:!0});const j=w=>w.toLocaleString(),te=w=>{h.info("请在订单列表中取消选择该订单")},se=w=>{const g=new Date,U=N(w),x=new Date(g.getTime()+U*24*60*60*1e3);c.estimatedDelivery=x.toISOString().split("T")[0]},N=w=>({SF:1,JD:1,YTO:2,ZTO:2,STO:2,YD:2,HTKY:3,EMS:3})[w]||3,o=()=>{const w=Z.value.find(g=>g.code===c.logisticsCompany);return(w==null?void 0:w.name)||"待选择"},a=w=>c.logisticsCompany?c.trackingMode==="auto"?{type:"success",text:"就绪"}:c.trackingMode==="manual"?k.value[w]?{type:"success",text:"就绪"}:{type:"warning",text:"待输入"}:P.value[w]?{type:"success",text:"就绪"}:{type:"warning",text:"待导入"}:{type:"danger",text:"未设置"},v=w=>w.getTime()<Date.now()-24*60*60*1e3,$=w=>{h.info("文件解析功能开发中...")},r=()=>{b.selectedOrders.map(w=>({订单号:w.orderNo,运单号:""})),h.success("模板下载功能开发中...")},Y=()=>J(this,null,function*(){try{h.loading("正在保存草稿..."),yield new Promise(w=>setTimeout(w,1e3)),h.success("草稿保存成功")}catch(w){h.error("草稿保存失败")}}),I=()=>J(this,null,function*(){if(S.value)try{if(yield S.value.validate(),c.trackingMode==="manual"){const g=k.value.filter(U=>!U.trim()).length;if(g>0){h.error(`还有 ${g} 个订单的运单号未填写`);return}}yield ge.confirm(`确认批量发货 ${b.selectedOrders.length} 个订单吗？发货后将无法撤销。`,"确认批量发货",{confirmButtonText:"确认发货",cancelButtonText:"取消",type:"warning"}),M.value=!0;const w=b.selectedOrders.map((g,U)=>{let x="";if(c.trackingMode==="auto"){const W=Z.value.find(ie=>ie.code===c.logisticsCompany),re=Date.now().toString(),oe=Math.random().toString(36).substring(2,6).toUpperCase();x=`${W==null?void 0:W.prefix}${re.slice(-8)}${oe}${U}`}else c.trackingMode==="manual"?x=k.value[U]:x=P.value[U];return{orderId:g.id,orderNo:g.orderNo,logisticsCompany:c.logisticsCompany,trackingNumber:x,estimatedDelivery:c.estimatedDelivery,remarks:c.remarks,shippingMethod:c.shippingMethod,shippingTime:new Date().toISOString(),status:"shipped"}});yield new Promise(g=>setTimeout(g,3e3)),q("batch-shipped",w),h.success(`成功批量发货 ${b.selectedOrders.length} 个订单！`),T()}catch(w){w!=="cancel"&&h.error("批量发货失败，请重试")}finally{M.value=!1}}),T=()=>{S.value&&S.value.resetFields(),Object.assign(c,{logisticsCompany:"",shippingMethod:"standard",trackingMode:"auto",estimatedDelivery:"",remarks:""}),k.value=[],P.value=[],E.value=!1};return(w,g)=>{const U=f("el-icon"),x=f("el-table-column"),W=f("el-button"),re=f("el-table"),oe=f("el-option"),ie=f("el-select"),C=f("el-form-item"),L=f("el-radio"),Ne=f("el-radio-group"),ke=f("el-date-picker"),le=f("el-input"),Fe=f("el-form"),Ye=f("el-upload"),we=f("el-tag"),$e=f("el-alert"),Re=f("el-dialog");return y(),ae(Re,{modelValue:E.value,"onUpdate:modelValue":g[5]||(g[5]=B=>E.value=B),title:"批量发货",width:"80%","before-close":T,class:"batch-shipping-dialog"},{footer:l(()=>[e("div",co,[t(W,{onClick:T},{default:l(()=>[...g[24]||(g[24]=[n("取消",-1)])]),_:1}),t(W,{type:"info",onClick:Y},{default:l(()=>[t(U,null,{default:l(()=>[t(m(Le))]),_:1}),g[25]||(g[25]=n(" 保存草稿 ",-1))]),_:1}),t(W,{type:"primary",onClick:I,loading:M.value},{default:l(()=>[t(U,null,{default:l(()=>[t(m(ye))]),_:1}),g[26]||(g[26]=n(" 确认批量发货 ",-1))]),_:1},8,["loading"])])]),default:l(()=>[e("div",Os,[e("div",Ss,[e("h3",Ns,[t(U,null,{default:l(()=>[t(m(De))]),_:1}),n(" 选中订单 ("+i(_.selectedOrders.length)+"个) ",1)]),e("div",Ms,[e("div",Us,[e("div",Bs,[g[6]||(g[6]=e("div",{class:"card-title"},"订单总数",-1)),e("div",Ls,i(_.selectedOrders.length),1)]),e("div",Ys,[g[7]||(g[7]=e("div",{class:"card-title"},"总金额",-1)),e("div",Is,"¥"+i(j(Q.value)),1)]),e("div",zs,[g[8]||(g[8]=e("div",{class:"card-title"},"代收款总额",-1)),e("div",Ps,"¥"+i(j(H.value)),1)])])]),e("div",qs,[t(re,{data:_.selectedOrders,style:{width:"100%"},"max-height":"300"},{default:l(()=>[t(x,{prop:"orderNo",label:"订单号",width:"120"}),t(x,{prop:"customerName",label:"客户姓名",width:"100"}),t(x,{prop:"phone",label:"联系电话",width:"120"}),t(x,{prop:"address",label:"收货地址","min-width":"200","show-overflow-tooltip":""}),t(x,{prop:"totalAmount",label:"订单金额",width:"100",align:"right"},{default:l(({row:B})=>[n(" ¥"+i(j(B.totalAmount)),1)]),_:1}),t(x,{prop:"codAmount",label:"代收款",width:"100",align:"right"},{default:l(({row:B})=>[e("span",Fs,"¥"+i(j(B.codAmount)),1)]),_:1}),t(x,{label:"操作",width:"80",fixed:"right"},{default:l(({row:B,$index:be})=>[t(W,{type:"danger",size:"small",onClick:Me=>te(be),icon:m(it),circle:""},null,8,["onClick","icon"])]),_:1})]),_:1},8,["data"])])]),e("div",Rs,[e("h3",Hs,[t(U,null,{default:l(()=>[t(m(rt))]),_:1}),g[9]||(g[9]=n(" 批量设置 ",-1))]),t(Fe,{model:c,rules:z,ref_key:"formRef",ref:S,"label-width":"120px"},{default:l(()=>[e("div",Es,[t(C,{label:"物流公司",prop:"logisticsCompany",required:""},{default:l(()=>[t(ie,{modelValue:c.logisticsCompany,"onUpdate:modelValue":g[0]||(g[0]=B=>c.logisticsCompany=B),placeholder:"请选择物流公司",class:"full-width",filterable:"",onChange:se},{default:l(()=>[(y(!0),A(de,null,fe(Z.value,B=>(y(),ae(oe,{key:B.code,label:B.name,value:B.code},{default:l(()=>[e("div",Ws,[e("span",js,i(B.name),1),e("span",Ks,"("+i(B.code)+")",1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"发货方式",prop:"shippingMethod"},{default:l(()=>[t(ie,{modelValue:c.shippingMethod,"onUpdate:modelValue":g[1]||(g[1]=B=>c.shippingMethod=B),class:"full-width"},{default:l(()=>[t(oe,{label:"标准快递",value:"standard"}),t(oe,{label:"加急快递",value:"express"}),t(oe,{label:"经济快递",value:"economy"})]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"运单号生成",prop:"trackingMode"},{default:l(()=>[t(Ne,{modelValue:c.trackingMode,"onUpdate:modelValue":g[2]||(g[2]=B=>c.trackingMode=B)},{default:l(()=>[t(L,{label:"auto"},{default:l(()=>[...g[10]||(g[10]=[n("自动生成",-1)])]),_:1}),t(L,{label:"manual"},{default:l(()=>[...g[11]||(g[11]=[n("手动输入",-1)])]),_:1}),t(L,{label:"import"},{default:l(()=>[...g[12]||(g[12]=[n("批量导入",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"预计送达",prop:"estimatedDelivery"},{default:l(()=>[t(ke,{modelValue:c.estimatedDelivery,"onUpdate:modelValue":g[3]||(g[3]=B=>c.estimatedDelivery=B),type:"date",placeholder:"选择预计送达日期",class:"full-width","disabled-date":v},null,8,["modelValue"])]),_:1})]),t(C,{label:"批量备注",prop:"remarks"},{default:l(()=>[t(le,{modelValue:c.remarks,"onUpdate:modelValue":g[4]||(g[4]=B=>c.remarks=B),type:"textarea",rows:3,placeholder:"请输入批量发货备注（选填）",maxlength:"200","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),c.trackingMode==="manual"?(y(),A("div",Js,[e("h3",Qs,[t(U,null,{default:l(()=>[t(m(qe))]),_:1}),g[13]||(g[13]=n(" 手动输入运单号 ",-1))]),e("div",Zs,[(y(!0),A(de,null,fe(_.selectedOrders,(B,be)=>(y(),A("div",{key:B.id,class:"tracking-input-item"},[e("span",Gs,i(B.orderNo)+"：",1),t(le,{modelValue:k.value[be],"onUpdate:modelValue":Me=>k.value[be]=Me,placeholder:"请输入运单号",class:"tracking-input",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]))),128))])])):ne("",!0),c.trackingMode==="import"?(y(),A("div",Xs,[e("h3",eo,[t(U,null,{default:l(()=>[t(m(Ht))]),_:1}),g[14]||(g[14]=n(" 批量导入运单号 ",-1))]),e("div",to,[t(Ye,{class:"upload-demo",drag:"","auto-upload":!1,"on-change":$,accept:".xlsx,.xls,.csv"},{tip:l(()=>[...g[15]||(g[15]=[e("div",{class:"el-upload__tip"}," 支持 Excel 或 CSV 格式，第一列为订单号，第二列为运单号 ",-1)])]),default:l(()=>[t(U,{class:"el-icon--upload"},{default:l(()=>[t(m(Et))]),_:1}),g[16]||(g[16]=e("div",{class:"el-upload__text"},[n(" 将文件拖到此处，或"),e("em",null,"点击上传")],-1))]),_:1}),e("div",lo,[t(W,{type:"text",onClick:r},{default:l(()=>[t(U,null,{default:l(()=>[t(m(Ke))]),_:1}),g[17]||(g[17]=n(" 下载模板 ",-1))]),_:1})])])])):ne("",!0),e("div",so,[e("h3",oo,[t(U,null,{default:l(()=>[t(m(Be))]),_:1}),g[18]||(g[18]=n(" 发货预览 ",-1))]),t(re,{data:ee.value,style:{width:"100%"},"max-height":"200"},{default:l(()=>[t(x,{prop:"orderNo",label:"订单号",width:"120"}),t(x,{prop:"customerName",label:"客户姓名",width:"100"}),t(x,{label:"物流公司",width:"120"},{default:l(()=>[n(i(o()),1)]),_:1}),t(x,{label:"运单号",width:"150"},{default:l(({$index:B})=>[c.trackingMode==="auto"?(y(),A("span",no," 自动生成 ")):c.trackingMode==="manual"?(y(),A("span",ao,i(k.value[B]||"待输入"),1)):(y(),A("span",ro,i(P.value[B]||"待导入"),1))]),_:1}),t(x,{label:"预计送达",width:"120"},{default:l(()=>[n(i(c.estimatedDelivery||"待设置"),1)]),_:1}),t(x,{label:"状态",width:"100"},{default:l(({$index:B})=>[t(we,{type:a(B).type,size:"small"},{default:l(()=>[n(i(a(B).text),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),e("div",io,[t($e,{title:"批量发货确认",type:"warning",closable:!1,"show-icon":""},{default:l(()=>[g[23]||(g[23]=e("p",null,"确认批量发货后，系统将：",-1)),e("ul",null,[e("li",null,"批量更新 "+i(_.selectedOrders.length)+' 个订单状态为"已发货"',1),g[19]||(g[19]=e("li",null,"记录所有订单的物流信息和运单号",-1)),g[20]||(g[20]=e("li",null,"批量发送发货通知给客户",-1)),g[21]||(g[21]=e("li",null,"开始批量物流跟踪",-1))]),e("p",uo,[t(U,null,{default:l(()=>[t(m(Qe))]),_:1}),g[22]||(g[22]=n(" 批量发货操作无法撤销，请确认信息无误后再执行！ ",-1))])]),_:1})])])]),_:1},8,["modelValue"])}}}),mo=Se(po,[["__scopeId","data-v-ad743c3d"]]),fo={key:0,class:"return-content"},vo={class:"order-summary"},go={class:"section-title"},_o={class:"order-info-grid"},yo={class:"info-item"},bo={class:"value"},ho={class:"info-item"},ko={class:"value"},wo={class:"info-item"},$o={class:"value"},To={class:"info-item"},xo={class:"value"},Co={class:"info-item"},Vo={class:"value"},Ao={class:"info-item"},Do={class:"value"},Oo={class:"return-reason"},So={class:"section-title"},No={class:"return-confirm"},Mo={class:"warning-text"},Uo={key:0,class:"return-history"},Bo={class:"section-title"},Lo={class:"history-list"},Yo={class:"history-header"},Io={class:"history-time"},zo={class:"history-content"},Po={key:0},qo={class:"dialog-footer"},Fo=Oe({__name:"ReturnOrderDialog",props:{visible:{type:Boolean},order:{}},emits:["update:visible","returned"],setup(_,{emit:R}){const b=_,q=R,E=me({get:()=>b.visible,set:o=>q("update:visible",o)}),S=D(),M=D(!1),c=Ae({returnType:"",reason:"",urgency:"medium",suggestion:"",notificationMethod:["system"]}),k={returnType:[{required:!0,message:"请选择退回类型",trigger:"change"}],reason:[{required:!0,message:"请填写退回原因",trigger:"blur"},{min:10,message:"退回原因至少10个字符",trigger:"blur"}]},P=D([{returnTime:"2024-01-10 14:30:00",returnType:"address_error",reason:"客户地址信息不完整，缺少详细门牌号",suggestion:"联系客户补充完整地址信息",urgency:"medium",operator:"张三"}]),z=o=>o.toLocaleString(),Z=o=>({pending:"warning",confirmed:"success",shipped:"primary",delivered:"success",returned:"danger",cancelled:"info"})[o]||"info",Q=o=>({pending:"待审核",confirmed:"已确认",shipped:"已发货",delivered:"已送达",returned:"已退回",cancelled:"已取消"})[o]||"未知状态",H=o=>({low:"info",medium:"warning",high:"danger"})[o]||"info",ee=o=>({low:"一般",medium:"紧急",high:"非常紧急"})[o]||"一般",j=o=>({address_error:"地址信息错误",customer_info_error:"客户信息不符",product_error:"商品信息错误",price_error:"价格信息错误",stock_shortage:"库存不足",customer_request:"客户要求修改",logistics_issue:"物流配送问题",other:"其他原因"})[o]||"未知类型",te=()=>J(this,null,function*(){try{h.loading("正在保存草稿..."),yield new Promise(o=>setTimeout(o,1e3)),h.success("草稿保存成功")}catch(o){h.error("草稿保存失败")}}),se=()=>J(this,null,function*(){if(S.value)try{yield S.value.validate(),yield ge.confirm(`确认退回订单 ${b.order.orderNo} 吗？退回后订单将重新分配给销售人员处理。`,"确认退回订单",{confirmButtonText:"确认退回",cancelButtonText:"取消",type:"warning"}),M.value=!0,yield new Promise(a=>setTimeout(a,2e3));const o=Ve(Ce({orderId:b.order.id,orderNo:b.order.orderNo},c),{returnTime:new Date().toISOString(),operator:"当前用户",status:"returned"});q("returned",o),h.success("订单退回成功！已通知相关人员"),N()}catch(o){o!=="cancel"&&h.error("订单退回失败，请重试")}finally{M.value=!1}}),N=()=>{S.value&&S.value.resetFields(),Object.assign(c,{returnType:"",reason:"",urgency:"medium",suggestion:"",notificationMethod:["system"]}),E.value=!1};return(o,a)=>{const v=f("el-icon"),$=f("el-tag"),r=f("el-option"),Y=f("el-select"),I=f("el-form-item"),T=f("el-input"),w=f("el-radio"),g=f("el-radio-group"),U=f("el-checkbox"),x=f("el-checkbox-group"),W=f("el-form"),re=f("el-alert"),oe=f("el-button"),ie=f("el-dialog");return y(),ae(ie,{modelValue:E.value,"onUpdate:modelValue":a[5]||(a[5]=C=>E.value=C),title:"退回订单",width:"50%","before-close":N,class:"return-order-dialog"},{footer:l(()=>[e("div",qo,[t(oe,{onClick:N},{default:l(()=>[...a[32]||(a[32]=[n("取消",-1)])]),_:1}),t(oe,{type:"info",onClick:te},{default:l(()=>[t(v,null,{default:l(()=>[t(m(Le))]),_:1}),a[33]||(a[33]=n(" 保存草稿 ",-1))]),_:1}),t(oe,{type:"danger",onClick:se,loading:M.value},{default:l(()=>[t(v,null,{default:l(()=>[t(m(Wt))]),_:1}),a[34]||(a[34]=n(" 确认退回 ",-1))]),_:1},8,["loading"])])]),default:l(()=>[_.order?(y(),A("div",fo,[e("div",vo,[e("h3",go,[t(v,null,{default:l(()=>[t(m(De))]),_:1}),a[6]||(a[6]=n(" 订单信息 ",-1))]),e("div",_o,[e("div",yo,[a[7]||(a[7]=e("span",{class:"label"},"订单号：",-1)),e("span",bo,i(_.order.orderNo),1)]),e("div",ho,[a[8]||(a[8]=e("span",{class:"label"},"客户姓名：",-1)),e("span",ko,i(_.order.customerName),1)]),e("div",wo,[a[9]||(a[9]=e("span",{class:"label"},"联系电话：",-1)),e("span",$o,i(m(pe)(_.order.phone)),1)]),e("div",To,[a[10]||(a[10]=e("span",{class:"label"},"订单金额：",-1)),e("span",xo,"¥"+i(z(_.order.totalAmount)),1)]),e("div",Co,[a[11]||(a[11]=e("span",{class:"label"},"当前状态：",-1)),e("span",Vo,[t($,{type:Z(_.order.status)},{default:l(()=>[n(i(Q(_.order.status)),1)]),_:1},8,["type"])])]),e("div",Ao,[a[12]||(a[12]=e("span",{class:"label"},"负责销售：",-1)),e("span",Do,i(_.order.salesperson||"未分配"),1)])])]),e("div",Oo,[e("h3",So,[t(v,null,{default:l(()=>[t(m(Ze))]),_:1}),a[13]||(a[13]=n(" 退回原因 ",-1))]),t(W,{model:c,rules:k,ref_key:"formRef",ref:S,"label-width":"120px"},{default:l(()=>[t(I,{label:"退回类型",prop:"returnType",required:""},{default:l(()=>[t(Y,{modelValue:c.returnType,"onUpdate:modelValue":a[0]||(a[0]=C=>c.returnType=C),placeholder:"请选择退回类型",class:"full-width"},{default:l(()=>[t(r,{label:"地址信息错误",value:"address_error"}),t(r,{label:"客户信息不符",value:"customer_info_error"}),t(r,{label:"商品信息错误",value:"product_error"}),t(r,{label:"价格信息错误",value:"price_error"}),t(r,{label:"库存不足",value:"stock_shortage"}),t(r,{label:"客户要求修改",value:"customer_request"}),t(r,{label:"物流配送问题",value:"logistics_issue"}),t(r,{label:"其他原因",value:"other"})]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"退回原因",prop:"reason",required:""},{default:l(()=>[t(T,{modelValue:c.reason,"onUpdate:modelValue":a[1]||(a[1]=C=>c.reason=C),type:"textarea",rows:4,placeholder:"请详细说明退回原因，以便销售人员及时处理",maxlength:"500","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1}),t(I,{label:"紧急程度",prop:"urgency"},{default:l(()=>[t(g,{modelValue:c.urgency,"onUpdate:modelValue":a[2]||(a[2]=C=>c.urgency=C)},{default:l(()=>[t(w,{label:"low"},{default:l(()=>[t($,{type:"info",size:"small"},{default:l(()=>[...a[14]||(a[14]=[n("一般",-1)])]),_:1}),a[15]||(a[15]=e("span",{class:"urgency-desc"},"可在1-2个工作日内处理",-1))]),_:1}),t(w,{label:"medium"},{default:l(()=>[t($,{type:"warning",size:"small"},{default:l(()=>[...a[16]||(a[16]=[n("紧急",-1)])]),_:1}),a[17]||(a[17]=e("span",{class:"urgency-desc"},"需要当天处理",-1))]),_:1}),t(w,{label:"high"},{default:l(()=>[t($,{type:"danger",size:"small"},{default:l(()=>[...a[18]||(a[18]=[n("非常紧急",-1)])]),_:1}),a[19]||(a[19]=e("span",{class:"urgency-desc"},"需要立即处理",-1))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(I,{label:"处理建议",prop:"suggestion"},{default:l(()=>[t(T,{modelValue:c.suggestion,"onUpdate:modelValue":a[3]||(a[3]=C=>c.suggestion=C),type:"textarea",rows:3,placeholder:"请提供处理建议（选填）",maxlength:"300","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1}),t(I,{label:"通知方式",prop:"notificationMethod"},{default:l(()=>[t(x,{modelValue:c.notificationMethod,"onUpdate:modelValue":a[4]||(a[4]=C=>c.notificationMethod=C)},{default:l(()=>[t(U,{label:"system"},{default:l(()=>[...a[20]||(a[20]=[n("系统消息",-1)])]),_:1}),t(U,{label:"email"},{default:l(()=>[...a[21]||(a[21]=[n("邮件通知",-1)])]),_:1}),t(U,{label:"sms"},{default:l(()=>[...a[22]||(a[22]=[n("短信通知",-1)])]),_:1}),t(U,{label:"wechat"},{default:l(()=>[...a[23]||(a[23]=[n("微信通知",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),e("div",No,[t(re,{title:"退回确认",type:"warning",closable:!1,"show-icon":""},{default:l(()=>[a[25]||(a[25]=e("p",null,"确认退回订单后，系统将：",-1)),a[26]||(a[26]=e("ul",null,[e("li",null,'将订单状态更改为"已退回"'),e("li",null,"订单将重新分配给负责销售人员"),e("li",null,"发送退回通知给相关人员"),e("li",null,"记录退回原因和处理建议"),e("li",null,"生成退回处理任务")],-1)),e("p",Mo,[t(v,null,{default:l(()=>[t(m(Qe))]),_:1}),a[24]||(a[24]=n(" 退回后订单将从发货列表中移除，请确认退回原因准确无误！ ",-1))])]),_:1})]),P.value.length>0?(y(),A("div",Uo,[e("h3",Bo,[t(v,null,{default:l(()=>[t(m(dt))]),_:1}),a[27]||(a[27]=n(" 历史退回记录 ",-1))]),e("div",Lo,[(y(!0),A(de,null,fe(P.value,(C,L)=>(y(),A("div",{key:L,class:"history-item"},[e("div",Yo,[e("span",Io,i(C.returnTime),1),t($,{type:H(C.urgency),size:"small"},{default:l(()=>[n(i(ee(C.urgency)),1)]),_:2},1032,["type"])]),e("div",zo,[e("p",null,[a[28]||(a[28]=e("strong",null,"退回类型：",-1)),n(i(j(C.returnType)),1)]),e("p",null,[a[29]||(a[29]=e("strong",null,"退回原因：",-1)),n(i(C.reason),1)]),C.suggestion?(y(),A("p",Po,[a[30]||(a[30]=e("strong",null,"处理建议：",-1)),n(i(C.suggestion),1)])):ne("",!0),e("p",null,[a[31]||(a[31]=e("strong",null,"操作人员：",-1)),n(i(C.operator),1)])])]))),128))])])):ne("",!0)])):ne("",!0)]),_:1},8,["modelValue"])}}}),Ro=Se(Fo,[["__scopeId","data-v-83df400e"]]),Ho={key:0,class:"cancel-content"},Eo={class:"order-summary"},Wo={class:"section-title"},jo={class:"order-info-grid"},Ko={class:"info-item"},Jo={class:"value"},Qo={class:"info-item"},Zo={class:"value"},Go={class:"info-item"},Xo={class:"value"},en={class:"info-item"},tn={class:"value"},ln={class:"info-item"},sn={class:"value"},on={class:"info-item"},nn={class:"value cod-amount"},an={class:"info-item"},rn={class:"value"},dn={class:"info-item"},un={class:"value"},cn={class:"cancel-reason"},pn={class:"section-title"},mn={class:"refund-option"},fn={class:"refund-desc"},vn={class:"refund-tip"},gn={class:"cancel-confirm"},_n={key:0},yn={key:1},bn={key:2},hn={key:3},kn={class:"warning-text"},wn={key:0,class:"cancel-history"},$n={class:"section-title"},Tn={class:"history-list"},xn={class:"history-header"},Cn={class:"history-time"},Vn={class:"history-content"},An={class:"dialog-footer"},Dn=Oe({__name:"CancelOrderDialog",props:{visible:{type:Boolean},order:{}},emits:["update:visible","cancelled"],setup(_,{emit:R}){const b=_,q=R,E=me({get:()=>b.visible,set:N=>q("update:visible",N)}),S=D(),M=D(!1),c=Ae({cancelType:"",reason:"",refundType:"full_refund",refundAmount:0,feeDescription:"",notifyCustomer:!0,notificationMethod:["sms"],remarks:""}),k={cancelType:[{required:!0,message:"请选择取消类型",trigger:"change"}],reason:[{required:!0,message:"请填写取消原因",trigger:"blur"},{min:10,message:"取消原因至少10个字符",trigger:"blur"}],refundType:[{required:!0,message:"请选择退款处理方式",trigger:"change"}],refundAmount:[{required:!0,message:"请输入退款金额",trigger:"blur"}]},P=D([{orderNo:"ORD202401001",cancelTime:"2024-01-05 16:20:00",cancelType:"customer_cancel",reason:"客户临时改变主意，不需要该商品",refundType:"full_refund",operator:"李四"}]);Pe(()=>c.refundType,N=>{var o,a;N==="full_refund"?c.refundAmount=((o=b.order)==null?void 0:o.deposit)||0:N==="partial_refund"?c.refundAmount=Math.round((((a=b.order)==null?void 0:a.deposit)||0)*.8):c.refundAmount=0});const z=N=>N.toLocaleString(),Z=N=>({pending:"warning",confirmed:"success",shipped:"primary",delivered:"success",returned:"danger",cancelled:"info"})[N]||"info",Q=N=>({pending:"待审核",confirmed:"已确认",shipped:"已发货",delivered:"已送达",returned:"已退回",cancelled:"已取消"})[N]||"未知状态",H=N=>({customer_cancel:"客户主动取消",customer_unreachable:"客户联系不上",address_undeliverable:"地址无法配送",out_of_stock:"商品缺货",price_dispute:"价格争议",duplicate_order:"重复订单",fraud_order:"欺诈订单",system_error:"系统错误",other:"其他原因"})[N]||"未知类型",ee=N=>({full_refund:"全额退款",partial_refund:"部分退款",no_refund:"不退款"})[N]||"未知",j=()=>J(this,null,function*(){try{h.loading("正在保存草稿..."),yield new Promise(N=>setTimeout(N,1e3)),h.success("草稿保存成功")}catch(N){h.error("草稿保存失败")}}),te=()=>J(this,null,function*(){if(S.value)try{yield S.value.validate();const N=c.refundType==="full_refund"?`确认取消订单 ${b.order.orderNo} 并全额退款 ¥${z(b.order.deposit)} 吗？`:c.refundType==="partial_refund"?`确认取消订单 ${b.order.orderNo} 并退款 ¥${z(c.refundAmount)} 吗？`:`确认取消订单 ${b.order.orderNo} 且不退款吗？`;yield ge.confirm(N+" 此操作无法撤销！","确认取消订单",{confirmButtonText:"确认取消",cancelButtonText:"取消",type:"error"}),M.value=!0,yield new Promise(a=>setTimeout(a,2e3));const o=Ve(Ce({orderId:b.order.id,orderNo:b.order.orderNo},c),{cancelTime:new Date().toISOString(),operator:"当前用户",status:"cancelled"});q("cancelled",o),h.success("订单取消成功！"),se()}catch(N){N!=="cancel"&&h.error("订单取消失败，请重试")}finally{M.value=!1}}),se=()=>{S.value&&S.value.resetFields(),Object.assign(c,{cancelType:"",reason:"",refundType:"full_refund",refundAmount:0,feeDescription:"",notifyCustomer:!0,notificationMethod:["sms"],remarks:""}),E.value=!1};return(N,o)=>{const a=f("el-icon"),v=f("el-tag"),$=f("el-option"),r=f("el-select"),Y=f("el-form-item"),I=f("el-input"),T=f("el-radio"),w=f("el-radio-group"),g=f("el-input-number"),U=f("el-switch"),x=f("el-checkbox"),W=f("el-checkbox-group"),re=f("el-form"),oe=f("el-alert"),ie=f("el-button"),C=f("el-dialog");return y(),ae(C,{modelValue:E.value,"onUpdate:modelValue":o[8]||(o[8]=L=>E.value=L),title:"取消订单",width:"50%","before-close":se,class:"cancel-order-dialog"},{footer:l(()=>[e("div",An,[t(ie,{onClick:se},{default:l(()=>[...o[38]||(o[38]=[n("取消",-1)])]),_:1}),t(ie,{type:"info",onClick:j},{default:l(()=>[t(a,null,{default:l(()=>[t(m(Le))]),_:1}),o[39]||(o[39]=n(" 保存草稿 ",-1))]),_:1}),t(ie,{type:"danger",onClick:te,loading:M.value},{default:l(()=>[t(a,null,{default:l(()=>[t(m(jt))]),_:1}),o[40]||(o[40]=n(" 确认取消订单 ",-1))]),_:1},8,["loading"])])]),default:l(()=>[_.order?(y(),A("div",Ho,[e("div",Eo,[e("h3",Wo,[t(a,null,{default:l(()=>[t(m(De))]),_:1}),o[9]||(o[9]=n(" 订单信息 ",-1))]),e("div",jo,[e("div",Ko,[o[10]||(o[10]=e("span",{class:"label"},"订单号：",-1)),e("span",Jo,i(_.order.orderNo),1)]),e("div",Qo,[o[11]||(o[11]=e("span",{class:"label"},"客户姓名：",-1)),e("span",Zo,i(_.order.customerName),1)]),e("div",Go,[o[12]||(o[12]=e("span",{class:"label"},"联系电话：",-1)),e("span",Xo,i(m(pe)(_.order.phone)),1)]),e("div",en,[o[13]||(o[13]=e("span",{class:"label"},"订单金额：",-1)),e("span",tn,"¥"+i(z(_.order.totalAmount)),1)]),e("div",ln,[o[14]||(o[14]=e("span",{class:"label"},"定金：",-1)),e("span",sn,"¥"+i(z(_.order.deposit)),1)]),e("div",on,[o[15]||(o[15]=e("span",{class:"label"},"代收款：",-1)),e("span",nn,"¥"+i(z(_.order.codAmount)),1)]),e("div",an,[o[16]||(o[16]=e("span",{class:"label"},"当前状态：",-1)),e("span",rn,[t(v,{type:Z(_.order.status)},{default:l(()=>[n(i(Q(_.order.status)),1)]),_:1},8,["type"])])]),e("div",dn,[o[17]||(o[17]=e("span",{class:"label"},"负责销售：",-1)),e("span",un,i(_.order.createdBy||"系统用户"),1)])])]),e("div",cn,[e("h3",pn,[t(a,null,{default:l(()=>[t(m(Ze))]),_:1}),o[18]||(o[18]=n(" 取消原因 ",-1))]),t(re,{model:c,rules:k,ref_key:"formRef",ref:S,"label-width":"120px"},{default:l(()=>[t(Y,{label:"取消类型",prop:"cancelType",required:""},{default:l(()=>[t(r,{modelValue:c.cancelType,"onUpdate:modelValue":o[0]||(o[0]=L=>c.cancelType=L),placeholder:"请选择取消类型",class:"full-width"},{default:l(()=>[t($,{label:"客户主动取消",value:"customer_cancel"}),t($,{label:"客户联系不上",value:"customer_unreachable"}),t($,{label:"地址无法配送",value:"address_undeliverable"}),t($,{label:"商品缺货",value:"out_of_stock"}),t($,{label:"价格争议",value:"price_dispute"}),t($,{label:"重复订单",value:"duplicate_order"}),t($,{label:"欺诈订单",value:"fraud_order"}),t($,{label:"系统错误",value:"system_error"}),t($,{label:"其他原因",value:"other"})]),_:1},8,["modelValue"])]),_:1}),t(Y,{label:"取消原因",prop:"reason",required:""},{default:l(()=>[t(I,{modelValue:c.reason,"onUpdate:modelValue":o[1]||(o[1]=L=>c.reason=L),type:"textarea",rows:4,placeholder:"请详细说明取消原因",maxlength:"500","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1}),t(Y,{label:"退款处理",prop:"refundType",required:""},{default:l(()=>[t(w,{modelValue:c.refundType,"onUpdate:modelValue":o[2]||(o[2]=L=>c.refundType=L)},{default:l(()=>[t(T,{label:"full_refund"},{default:l(()=>[e("span",mn,[o[19]||(o[19]=e("strong",null,"全额退款",-1)),e("span",fn,"退还全部定金 ¥"+i(z(_.order.deposit)),1)])]),_:1}),t(T,{label:"partial_refund"},{default:l(()=>[...o[20]||(o[20]=[e("span",{class:"refund-option"},[e("strong",null,"部分退款"),e("span",{class:"refund-desc"},"扣除手续费后退款")],-1)])]),_:1}),t(T,{label:"no_refund"},{default:l(()=>[...o[21]||(o[21]=[e("span",{class:"refund-option"},[e("strong",null,"不退款"),e("span",{class:"refund-desc"},"定金不予退还")],-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),c.refundType==="partial_refund"?(y(),ae(Y,{key:0,label:"退款金额",prop:"refundAmount"},{default:l(()=>[t(g,{modelValue:c.refundAmount,"onUpdate:modelValue":o[3]||(o[3]=L=>c.refundAmount=L),min:0,max:_.order.deposit,precision:2,placeholder:"退款金额",class:"refund-input"},null,8,["modelValue","max"]),e("span",vn," 最大可退款金额：¥"+i(z(_.order.deposit)),1)]),_:1})):ne("",!0),c.refundType==="partial_refund"?(y(),ae(Y,{key:1,label:"手续费说明",prop:"feeDescription"},{default:l(()=>[t(I,{modelValue:c.feeDescription,"onUpdate:modelValue":o[4]||(o[4]=L=>c.feeDescription=L),placeholder:"请说明扣除手续费的原因",maxlength:"200","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1})):ne("",!0),t(Y,{label:"通知客户",prop:"notifyCustomer"},{default:l(()=>[t(U,{modelValue:c.notifyCustomer,"onUpdate:modelValue":o[5]||(o[5]=L=>c.notifyCustomer=L),"active-text":"发送取消通知","inactive-text":"不发送通知"},null,8,["modelValue"])]),_:1}),c.notifyCustomer?(y(),ae(Y,{key:2,label:"通知方式",prop:"notificationMethod"},{default:l(()=>[t(W,{modelValue:c.notificationMethod,"onUpdate:modelValue":o[6]||(o[6]=L=>c.notificationMethod=L)},{default:l(()=>[t(x,{label:"sms"},{default:l(()=>[...o[22]||(o[22]=[n("短信通知",-1)])]),_:1}),t(x,{label:"phone"},{default:l(()=>[...o[23]||(o[23]=[n("电话通知",-1)])]),_:1}),t(x,{label:"wechat"},{default:l(()=>[...o[24]||(o[24]=[n("微信通知",-1)])]),_:1}),t(x,{label:"email"},{default:l(()=>[...o[25]||(o[25]=[n("邮件通知",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):ne("",!0),t(Y,{label:"备注说明",prop:"remarks"},{default:l(()=>[t(I,{modelValue:c.remarks,"onUpdate:modelValue":o[7]||(o[7]=L=>c.remarks=L),type:"textarea",rows:3,placeholder:"其他备注说明（选填）",maxlength:"300","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),e("div",gn,[t(oe,{title:"取消确认",type:"error",closable:!1,"show-icon":""},{default:l(()=>[o[30]||(o[30]=e("p",null,"确认取消订单后，系统将：",-1)),e("ul",null,[o[26]||(o[26]=e("li",null,'将订单状态更改为"已取消"',-1)),c.refundType==="full_refund"?(y(),A("li",_n," 处理全额退款 ¥"+i(z(_.order.deposit)),1)):c.refundType==="partial_refund"?(y(),A("li",yn," 处理部分退款 ¥"+i(z(c.refundAmount)),1)):(y(),A("li",bn," 定金不予退还 ")),c.notifyCustomer?(y(),A("li",hn,"发送取消通知给客户")):ne("",!0),o[27]||(o[27]=e("li",null,"记录取消原因和处理过程",-1)),o[28]||(o[28]=e("li",null,"更新库存和销售数据",-1))]),e("p",kn,[t(a,null,{default:l(()=>[t(m(Qe))]),_:1}),o[29]||(o[29]=n(" 订单取消后无法恢复，请确认操作无误！ ",-1))])]),_:1})]),P.value.length>0?(y(),A("div",wn,[e("h3",$n,[t(a,null,{default:l(()=>[t(m(dt))]),_:1}),o[31]||(o[31]=n(" 相关取消记录 ",-1))]),e("div",Tn,[(y(!0),A(de,null,fe(P.value,(L,Ne)=>(y(),A("div",{key:Ne,class:"history-item"},[e("div",xn,[e("span",Cn,i(L.cancelTime),1),t(v,{type:"danger",size:"small"},{default:l(()=>[...o[32]||(o[32]=[n("已取消",-1)])]),_:1})]),e("div",Vn,[e("p",null,[o[33]||(o[33]=e("strong",null,"订单号：",-1)),n(i(L.orderNo),1)]),e("p",null,[o[34]||(o[34]=e("strong",null,"取消类型：",-1)),n(i(H(L.cancelType)),1)]),e("p",null,[o[35]||(o[35]=e("strong",null,"取消原因：",-1)),n(i(L.reason),1)]),e("p",null,[o[36]||(o[36]=e("strong",null,"退款处理：",-1)),n(i(ee(L.refundType)),1)]),e("p",null,[o[37]||(o[37]=e("strong",null,"操作人员：",-1)),n(i(L.operator),1)])])]))),128))])])):ne("",!0)])):ne("",!0)]),_:1},8,["modelValue"])}}}),On=Se(Dn,[["__scopeId","data-v-753357e8"]]),Sn={class:"shipping-list"},Nn={class:"metrics-grid"},Mn={class:"metrics-row"},Un={class:"metric-card"},Bn={class:"metric-icon total-orders"},Ln={class:"metric-content"},Yn={class:"metric-value"},In={class:"metric-card"},zn={class:"metric-icon total-amount"},Pn={class:"metric-content"},qn={class:"metric-value"},Fn={class:"metric-card"},Rn={class:"metric-icon shipped-today"},Hn={class:"metric-content"},En={class:"metric-value"},Wn={class:"metrics-row"},jn={class:"metric-card"},Kn={class:"metric-icon urgent-orders"},Jn={class:"metric-content"},Qn={class:"metric-value"},Zn={class:"metric-card"},Gn={class:"metric-icon cod-orders"},Xn={class:"metric-content"},ea={class:"metric-value"},ta={class:"metric-card"},la={class:"metric-icon cod-amount"},sa={class:"metric-content"},oa={class:"metric-value"},na={class:"quick-filters"},aa={class:"filter-section"},ra={class:"filter-left"},ia={class:"filter-right"},da={class:"status-tabs"},ua={class:"tabs-header"},ca={class:"tab-label"},pa={class:"tab-label"},ma={class:"tab-label"},fa={class:"tab-label"},va={class:"tab-label"},ga={class:"tabs-actions"},_a={class:"product-list"},ya={class:"amount"},ba={class:"amount"},ha={class:"amount highlight"},ka=["innerHTML"],wa={key:1,class:"no-remark"},$a={key:1,class:"no-data"},Ta={key:0,class:"express-no"},xa={key:1,class:"no-data"},Ca={key:1,class:"no-data"},Va={key:0,class:"operation-info"},Aa={class:"operation-action"},Da={class:"operation-meta"},Oa={class:"operation-user"},Sa={class:"operation-time"},Na={key:1,class:"no-data"},Ma={class:"action-buttons"},Ua={class:"fullscreen-content"},Ba={class:"fullscreen-filters"},La={class:"filter-left"},Ya={class:"filter-right"},Ia={class:"fullscreen-table"},za={class:"amount"},Pa={class:"cod-amount"},qa={class:"operation-buttons"},Fa={class:"fullscreen-pagination"},Ra=Oe({__name:"Shipping",setup(_){const R=Pt(),b=ll(R),q=Ae({totalOrders:0,totalAmount:0,shippedToday:0,urgentOrders:0,codOrders:0,codAmount:0}),E=[{label:"全部",value:"all"},{label:"今日订单",value:"today"},{label:"昨日订单",value:"yesterday"},{label:"本周订单",value:"thisWeek"},{label:"本月订单",value:"thisMonth"},{label:"今年订单",value:"thisYear"},{label:"紧急订单",value:"urgent"},{label:"代收款订单",value:"cod"},{label:"大额订单",value:"large"}],S=D("all"),M=D("pending"),c=Ae({pending:0,shipped:0,returned:0,cancelled:0,draft:0}),k=D(null),P=D(""),z=D(""),Z=D(""),Q=D([]),H=D([]),ee=D(0),j=D(1),te=D(50),se=D(!1),N=D(!1),o=D(!1),a=D(!1),v=D(!1),$=D(!1),r=D(!1),Y=D(!1),I=D(null),T=ut();el();const w=tl(),g=sl(),U=me(()=>`${{pending:"待发货",shipped:"已发货",returned:"退回",cancelled:"取消",draft:"草稿"}[M.value]||"发货"}列表`),x=me(()=>[{prop:"orderNo",label:"订单号",width:140,visible:!0},{prop:"status",label:"订单状态",width:100,align:"center",visible:!0},{prop:"customerName",label:"客户名字",width:100,align:"center",showOverflowTooltip:!0,visible:!0},{prop:"phone",label:"电话",width:120,align:"center",showOverflowTooltip:!0,visible:!0},{prop:"address",label:"地址",width:200,showOverflowTooltip:!0,visible:!0},{prop:"createTime",label:"下单时间",width:150,align:"center",visible:!0},{prop:"productsText",label:"商品",width:200,showOverflowTooltip:!0,visible:!0},{prop:"totalQuantity",label:"数量",width:80,align:"center",visible:!0},{prop:"totalAmount",label:"订单总额",width:120,align:"center",visible:!0},{prop:"deposit",label:"定金",width:100,align:"center",visible:!0},{prop:"codAmount",label:"代收款金额",width:120,align:"center",visible:!0},{prop:"customerAge",label:"年龄",width:80,align:"center",visible:!0},{prop:"customerHeight",label:"身高",width:80,align:"center",visible:!0},{prop:"customerWeight",label:"体重",width:80,align:"center",visible:!0},{prop:"medicalHistory",label:"疾病史",width:120,showOverflowTooltip:!0,visible:!0},{prop:"serviceWechat",label:"客服微信号",width:120,align:"center",showOverflowTooltip:!0,visible:!0},{prop:"remark",label:"订单备注",width:150,showOverflowTooltip:!0,visible:!0},{prop:"expressCompany",label:"物流公司",width:120,align:"center",visible:!0},{prop:"expressNo",label:"物流单号",width:150,align:"center",visible:!0},{prop:"logisticsStatus",label:"物流状态",width:100,align:"center",visible:!0},{prop:"lastOperation",label:"最近操作",width:200,showOverflowTooltip:!0,visible:!1}]),W=u=>u.toLocaleString(),re=u=>u?new Date(u).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",oe=u=>({pending_transfer:"info",pending_audit:"warning",audit_rejected:"danger",pending_shipment:"primary",shipped:"success",delivered:"success",package_exception:"danger",rejected:"danger",rejected_returned:"warning",after_sales_created:"info",cancelled:"info",draft:"info"})[u]||"info",ie=({row:u})=>u.status==="urgent"?"urgent-row":u.status==="cod"?"cod-row":"",C=u=>{const s=["紧急","加急","重要","特殊","注意"];let p=u;return s.forEach(V=>{const O=new RegExp(V,"gi");p=p.replace(O,`<span class="highlight-keyword">${V}</span>`)}),p},L=u=>{S.value=u,ke()},Ne=u=>{M.value=u,j.value=1,ke(),he()},ke=()=>{le()},le=()=>J(this,null,function*(){try{se.value=!0;const u=yield T.getOrdersByShippingStatus(M.value);if(!Array.isArray(u)){console.error("getOrdersByShippingStatus 返回的不是数组:",u),Q.value=[],ee.value=0;return}let s=[...u];if(S.value!=="all")switch(S.value){case"today":const O=new Date().toISOString().split("T")[0];s=s.filter(K=>K.createTime&&K.createTime.startsWith(O));break;case"yesterday":const F=new Date;F.setDate(F.getDate()-1);const ue=F.toISOString().split("T")[0];s=s.filter(K=>K.createTime&&K.createTime.startsWith(ue));break;case"thisWeek":const ce=new Date,ve=new Date(ce),_e=ce.getDay(),He=_e===0?6:_e-1;ve.setDate(ce.getDate()-He),ve.setHours(0,0,0,0),s=s.filter(K=>K.createTime?new Date(K.createTime)>=ve:!1);break;case"thisMonth":const Te=new Date,xe=new Date(Te.getFullYear(),Te.getMonth(),1);s=s.filter(K=>K.createTime?new Date(K.createTime)>=xe:!1);break;case"thisYear":const Ue=new Date().getFullYear(),Ee=new Date(Ue,0,1);s=s.filter(K=>K.createTime?new Date(K.createTime)>=Ee:!1);break;case"urgent":s=s.filter(K=>K.status==="urgent");break;case"cod":s=s.filter(K=>(K.codAmount||0)>0);break;case"large":s=s.filter(K=>(K.totalAmount||0)>1e3);break}if(k.value&&k.value.length===2){const[O,F]=k.value;s=s.filter(ue=>{var ve;const ce=(ve=ue.createTime)==null?void 0:ve.split("T")[0];return ce>=O&&ce<=F})}P.value&&(s=s.filter(O=>O.department&&O.department===P.value)),z.value&&(s=s.filter(O=>O.orderNo&&O.orderNo.includes(z.value))),Z.value&&(s=s.filter(O=>O.phone&&O.phone.includes(Z.value)));const p=(j.value-1)*te.value,V=p+te.value;Q.value=s.slice(p,V),ee.value=s.length,Q.value=Q.value.map(O=>{const F=T.getOperationLogs(O.id)||[],ue=F.length>0?F[F.length-1]:{action:"创建订单",operator:O.createdBy||"系统",time:O.createTime};return Ve(Ce({},O),{lastOperation:ue,operationLogs:F})}),Ye(),Fe(s)}catch(u){console.error("加载订单列表失败:",u),h.error("加载订单列表失败"),Q.value=[],ee.value=0}finally{se.value=!1}}),Fe=(u=[])=>{const s=Array.isArray(u)&&u.length>0?u:Array.isArray(Q.value)?Q.value:[];q.totalOrders=s.length,q.totalAmount=s.reduce((V,O)=>V+(O.totalAmount||0),0);const p=new Date().toISOString().split("T")[0];q.shippedToday=s.filter(V=>V.shipTime&&V.shipTime.startsWith(p)).length,q.urgentOrders=s.filter(V=>V.status==="urgent").length,q.codOrders=s.filter(V=>(V.codAmount||0)>0).length,q.codAmount=s.reduce((V,O)=>V+(O.codAmount||0),0)},Ye=()=>J(this,null,function*(){try{yield T.batchSyncLogistics();const u=yield T.getOrdersByShippingStatus(M.value);if(Array.isArray(u)){const s=(j.value-1)*te.value,p=s+te.value,V=u.slice(s,p);Q.value=V.map(O=>{const F=T.getOperationLogs(O.id)||[],ue=F.length>0?F[F.length-1]:{action:"创建订单",operator:O.createdBy||"系统",time:O.createTime};return Ve(Ce({},O),{lastOperation:ue,operationLogs:F})})}}catch(u){console.error("同步物流数据失败:",u)}});let we=null,$e=null;const Re=()=>{T.startLogisticsAutoSync(),T.setupLogisticsEventListener(),$e=setInterval(()=>{se.value||Ye()},3e4),we=setInterval(()=>{se.value||le()},6e4)},B=()=>{we&&(clearInterval(we),we=null),$e&&(clearInterval($e),$e=null),T.stopLogisticsAutoSync()},be=u=>{H.value=u},Me=u=>{te.value=u,le()},Ge=u=>{j.value=u,le()},Ie=u=>{I.value=u,N.value=!0},ct=()=>{Y.value=!0},Xe=u=>{I.value=u,o.value=!0},et=u=>{I.value=u,a.value=!0},pt=()=>J(this,null,function*(){if(H.value.length===0){h.warning("请选择要导出的订单");return}try{const u=H.value.map(p=>({orderNumber:p.orderNumber||"",customerName:p.customerName||"",customerPhone:p.customerPhone||"",receiverName:p.receiverName||"",receiverPhone:p.receiverPhone||"",receiverAddress:p.receiverAddress||"",products:p.productsText||(Array.isArray(p.products)?p.products.map(V=>`${V.name} x${V.quantity}`).join(", "):p.products||""),totalQuantity:Array.isArray(p.products)?p.products.reduce((V,O)=>V+(O.quantity||0),0):0,totalAmount:p.totalAmount||0,depositAmount:p.depositAmount||0,codAmount:(p.totalAmount||0)-(p.depositAmount||0),customerAge:p.customerAge||"",customerHeight:p.customerHeight||"",customerWeight:p.customerWeight||"",medicalHistory:p.medicalHistory||"",serviceWechat:p.serviceWechat||"",remark:p.remark||"",createTime:p.createTime||"",status:p.status||"",shippingStatus:p.shippingStatus||""})),s=ol(u,w.isAdmin);h.success(`导出成功：${s}`)}catch(u){console.error("导出失败:",u),h.error("导出失败，请重试")}}),mt=()=>{if(H.value.length===0){h.warning("请选择要发货的订单");return}v.value=!0},ft=p=>J(this,[p],function*({action:u,row:s}){switch(I.value=s,u){case"export":try{const V={orderNumber:s.orderNumber||"",customerName:s.customerName||"",customerPhone:s.customerPhone||"",receiverName:s.receiverName||"",receiverPhone:s.receiverPhone||"",receiverAddress:s.receiverAddress||"",products:s.productsText||(Array.isArray(s.products)?s.products.map(F=>`${F.name} x${F.quantity}`).join(", "):s.products||""),totalQuantity:Array.isArray(s.products)?s.products.reduce((F,ue)=>F+(ue.quantity||0),0):0,totalAmount:s.totalAmount||0,depositAmount:s.depositAmount||0,codAmount:(s.totalAmount||0)-(s.depositAmount||0),customerAge:s.customerAge||"",customerHeight:s.customerHeight||"",customerWeight:s.customerWeight||"",medicalHistory:s.medicalHistory||"",serviceWechat:s.serviceWechat||"",remark:s.remark||"",createTime:s.createTime||"",status:s.status||"",shippingStatus:s.shippingStatus||""},O=nl(V,w.isAdmin);h.success(`导出成功：${O}`)}catch(V){console.error("导出失败:",V),h.error("导出失败，请重试")}break;case"return":$.value=!0;break;case"cancel":r.value=!0;break}}),vt=u=>{T.shipOrder(u.orderId,u)?(h.success("发货成功"),le()):h.error("发货失败，订单不存在")},gt=u=>{u.forEach(s=>{T.shipOrder(s.orderId,s)}),h.success(`成功发货 ${u.length} 个订单`),le()},_t=u=>{T.returnOrder(u.orderId,u.returnReason)?(h.success("订单已退回"),le()):h.error("退回失败，订单不存在")},yt=u=>{T.cancelOrder(u.orderId,u.cancelReason)?(h.success("订单已取消"),le()):h.error("取消失败，订单不存在")},bt=u=>{h.info("编辑草稿功能开发中...")},ht=u=>J(this,null,function*(){try{yield ge.confirm(`确定要提交草稿订单 ${u.orderNumber} 吗？提交后将进入审核流程。`,"提交确认",{confirmButtonText:"确定提交",cancelButtonText:"取消",type:"warning"});const s=T.orders.findIndex(p=>p.id===u.id);if(s!==-1&&(T.orders[s].status="pending",T.orders[s].auditStatus="pending",T.orders[s].markType==="normal")){const p=new Date(Date.now()+18e4);T.orders[s].auditTransferTime=p.toISOString().slice(0,19).replace("T"," "),T.orders[s].isAuditTransferred=!1}h.success("草稿已提交，进入审核流程"),le(),he()}catch(s){s!=="cancel"&&(console.error("提交草稿失败:",s),h.error("提交失败，请重试"))}}),kt=u=>J(this,null,function*(){try{yield ge.confirm(`确定要删除草稿订单 ${u.orderNumber} 吗？删除后无法恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"});const s=T.orders.findIndex(p=>p.id===u.id);s!==-1&&T.orders.splice(s,1),h.success("草稿已删除"),le(),he()}catch(s){s!=="cancel"&&(console.error("删除草稿失败:",s),h.error("删除失败，请重试"))}}),he=()=>J(this,null,function*(){try{const u=yield T.getOrdersByShippingStatus("pending"),s=yield T.getOrdersByShippingStatus("shipped"),p=yield T.getOrdersByShippingStatus("returned"),V=yield T.getOrdersByShippingStatus("cancelled"),O=yield T.getOrdersByShippingStatus("draft");c.pending=Array.isArray(u)?u.length:0,c.shipped=Array.isArray(s)?s.length:0,c.returned=Array.isArray(p)?p.length:0,c.cancelled=Array.isArray(V)?V.length:0,c.draft=Array.isArray(O)?O.length:0}catch(u){console.error("更新标签页数量失败:",u)}}),wt=u=>{h.info("编辑被退回订单功能开发中...")},$t=u=>J(this,null,function*(){var s;try{yield ge.confirm(`确定要重新提审订单 ${u.orderNumber} 吗？提审后将重新进入审核流程。`,"提审确认",{confirmButtonText:"确定提审",cancelButtonText:"取消",type:"warning"}),T.resubmitForAudit(u.id,((s=w.user)==null?void 0:s.name)||"系统")?(h.success("订单已重新提审，进入审核流程"),le(),he()):h.error("重新提审失败，订单状态不符合要求")}catch(p){p!=="cancel"&&(console.error("提审失败:",p),h.error("提审失败，请重试"))}}),Tt=u=>J(this,null,function*(){try{yield ge.confirm(`确定要取消订单 ${u.orderNumber} 吗？取消后订单状态将变为已取消。`,"取消确认",{confirmButtonText:"确定取消",cancelButtonText:"保留",type:"error"});const s=T.orders.findIndex(p=>p.id===u.id);s!==-1&&(T.orders[s].status="cancelled",T.orders[s].shippingStatus="cancelled"),h.success("订单已取消"),le(),he()}catch(s){s!=="cancel"&&(console.error("取消订单失败:",s),h.error("取消失败，请重试"))}}),xt=u=>({SF:"顺丰速运",YTO:"圆通速递",ZTO:"中通快递",STO:"申通快递",YD:"韵达速递",HTKY:"百世快递",JD:"京东物流",EMS:"中国邮政",DBKD:"德邦快递",UC:"优速快递"})[u]||u,Ct=u=>({pending:"info",picked_up:"warning",in_transit:"primary",out_for_delivery:"warning",delivered:"success",exception:"danger",rejected:"danger",returned:"info"})[u]||"info",Vt=u=>({pending:"待揽收",picked_up:"已揽收",in_transit:"运输中",out_for_delivery:"派送中",delivered:"已签收",exception:"异常",rejected:"拒收",returned:"已退回"})[u]||u,At=u=>{if(!u.expressNo||!u.expressCompany){h.warning("物流信息不完整，无法跟踪");return}b.push({path:"/logistics/track/detail/"+u.expressNo,query:{company:u.expressCompany}})},Dt=u=>J(this,null,function*(){try{yield navigator.clipboard.writeText(u),h.success("物流单号已复制到剪贴板")}catch(s){const p=document.createElement("textarea");p.value=u,document.body.appendChild(p),p.select(),document.execCommand("copy"),document.body.removeChild(p),h.success("物流单号已复制到剪贴板")}});return Pe(M,u=>{le(),he()}),Pe(S,u=>{le()}),Je(()=>{le(),he(),Re(),g.initData()}),qt(()=>{B()}),(u,s)=>{const p=f("el-icon"),V=f("el-button"),O=f("el-date-picker"),F=f("el-option"),ue=f("el-select"),ce=f("el-input"),ve=f("el-badge"),_e=f("el-tab-pane"),He=f("el-tabs"),Te=f("el-link"),xe=f("el-tag"),Ue=f("el-dropdown-item"),Ee=f("el-dropdown-menu"),K=f("el-dropdown"),G=f("el-table-column"),Ot=f("el-table"),St=f("el-pagination"),Nt=f("el-dialog");return y(),A("div",Sn,[s[50]||(s[50]=e("div",{class:"page-header"},[e("h1",{class:"page-title"},"发货列表")],-1)),e("div",Nn,[e("div",Mn,[e("div",Un,[e("div",Bn,[t(p,null,{default:l(()=>[t(m(De))]),_:1})]),e("div",Ln,[e("div",Yn,i(q.totalOrders),1),s[18]||(s[18]=e("div",{class:"metric-label"},"待发货订单",-1))])]),e("div",In,[e("div",zn,[t(p,null,{default:l(()=>[t(m(Kt))]),_:1})]),e("div",Pn,[e("div",qn,"¥"+i(W(q.totalAmount)),1),s[19]||(s[19]=e("div",{class:"metric-label"},"待发货金额",-1))])]),e("div",Fn,[e("div",Rn,[t(p,null,{default:l(()=>[t(m(ye))]),_:1})]),e("div",Hn,[e("div",En,i(q.shippedToday),1),s[20]||(s[20]=e("div",{class:"metric-label"},"今日发货",-1))])])]),e("div",Wn,[e("div",jn,[e("div",Kn,[t(p,null,{default:l(()=>[t(m(Ze))]),_:1})]),e("div",Jn,[e("div",Qn,i(q.urgentOrders),1),s[21]||(s[21]=e("div",{class:"metric-label"},"紧急订单",-1))])]),e("div",Zn,[e("div",Gn,[t(p,null,{default:l(()=>[t(m(Jt))]),_:1})]),e("div",Xn,[e("div",ea,i(q.codOrders),1),s[22]||(s[22]=e("div",{class:"metric-label"},"代收款订单",-1))])]),e("div",ta,[e("div",la,[t(p,null,{default:l(()=>[t(m(Qt))]),_:1})]),e("div",sa,[e("div",oa,"¥"+i(W(q.codAmount)),1),s[23]||(s[23]=e("div",{class:"metric-label"},"代收款金额",-1))])])])]),e("div",na,[(y(),A(de,null,fe(E,d=>t(V,{key:d.value,type:S.value===d.value?"primary":"",onClick:X=>L(d.value),class:"filter-btn"},{default:l(()=>[n(i(d.label),1)]),_:2},1032,["type","onClick"])),64))]),e("div",aa,[e("div",ra,[t(O,{modelValue:k.value,"onUpdate:modelValue":s[0]||(s[0]=d=>k.value=d),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"date-picker"},null,8,["modelValue"]),t(ue,{modelValue:P.value,"onUpdate:modelValue":s[1]||(s[1]=d=>P.value=d),placeholder:"选择部门",class:"department-select",size:"default"},{default:l(()=>[t(F,{label:"全部部门",value:""}),(y(!0),A(de,null,fe(m(g).departmentList,d=>(y(),ae(F,{key:d.id,label:d.name,value:d.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(ce,{modelValue:z.value,"onUpdate:modelValue":s[2]||(s[2]=d=>z.value=d),placeholder:"订单号",class:"search-input",clearable:""},{prefix:l(()=>[t(p,null,{default:l(()=>[t(m(ze))]),_:1})]),_:1},8,["modelValue"]),t(ce,{modelValue:Z.value,"onUpdate:modelValue":s[3]||(s[3]=d=>Z.value=d),placeholder:"客户号码",class:"search-input",clearable:""},{prefix:l(()=>[t(p,null,{default:l(()=>[t(m(ot))]),_:1})]),_:1},8,["modelValue"])]),e("div",ia,[t(V,{type:"primary",onClick:ke,class:"query-btn"},{default:l(()=>[t(p,null,{default:l(()=>[t(m(ze))]),_:1}),s[24]||(s[24]=n(" 查询 ",-1))]),_:1})])]),e("div",da,[e("div",ua,[t(He,{modelValue:M.value,"onUpdate:modelValue":s[4]||(s[4]=d=>M.value=d),onTabChange:Ne,class:"shipping-tabs"},{default:l(()=>[t(_e,{label:"待发货",name:"pending"},{label:l(()=>[e("span",ca,[t(p,null,{default:l(()=>[t(m(De))]),_:1}),s[25]||(s[25]=n(" 待发货 ",-1)),t(ve,{value:c.pending,max:999,class:"tab-badge"},null,8,["value"])])]),_:1}),t(_e,{label:"已发货",name:"shipped"},{label:l(()=>[e("span",pa,[t(p,null,{default:l(()=>[t(m(ye))]),_:1}),s[26]||(s[26]=n(" 已发货 ",-1))])]),_:1}),t(_e,{label:"退回",name:"returned"},{label:l(()=>[e("span",ma,[t(p,null,{default:l(()=>[t(m(nt))]),_:1}),s[27]||(s[27]=n(" 退回 ",-1))])]),_:1}),t(_e,{label:"取消",name:"cancelled"},{label:l(()=>[e("span",fa,[t(p,null,{default:l(()=>[t(m(We))]),_:1}),s[28]||(s[28]=n(" 取消 ",-1))])]),_:1}),t(_e,{label:"草稿",name:"draft"},{label:l(()=>[e("span",va,[t(p,null,{default:l(()=>[t(m(Le))]),_:1}),s[29]||(s[29]=n(" 草稿 ",-1)),t(ve,{value:c.draft,max:999,class:"tab-badge draft-badge"},null,8,["value"])])]),_:1})]),_:1},8,["modelValue"]),e("div",ga,[t(V,{type:"primary",onClick:ct,class:"fullscreen-btn"},{default:l(()=>[t(p,null,{default:l(()=>[t(m(Zt))]),_:1}),s[30]||(s[30]=n(" 全屏查看 ",-1))]),_:1})])])]),t(rl,{data:Q.value,columns:x.value,"storage-key":"shipping-list-columns",title:U.value,loading:se.value,"show-selection":!0,"show-index":!0,pagination:{currentPage:j.value,pageSize:te.value,total:ee.value},onSelectionChange:be,onSizeChange:Me,onCurrentChange:Ge,"row-class-name":ie},{"header-actions":l(()=>[t(V,{onClick:pt,class:"export-btn",disabled:H.value.length===0},{default:l(()=>[t(p,null,{default:l(()=>[t(m(Ke))]),_:1}),s[31]||(s[31]=n(" 批量导出 ",-1))]),_:1},8,["disabled"]),t(V,{type:"success",onClick:mt,class:"batch-ship-btn",disabled:H.value.length===0},{default:l(()=>[t(p,null,{default:l(()=>[t(m(ye))]),_:1}),s[32]||(s[32]=n(" 批量发货 ",-1))]),_:1},8,["disabled"])]),orderNo:l(({row:d})=>[t(Te,{type:"primary",onClick:X=>Ie(d)},{default:l(()=>[n(i(d.orderNo),1)]),_:2},1032,["onClick"])]),status:l(({row:d})=>[t(xe,{type:oe(d.status),size:"small"},{default:l(()=>[n(i(m(T).getStatusText(d.status)),1)]),_:2},1032,["type"])]),createTime:l(({row:d})=>[e("span",null,i(re(d.createTime)),1)]),products:l(({row:d})=>[e("div",_a,[(y(!0),A(de,null,fe(d.products,(X,Mt)=>(y(),A("div",{key:Mt,class:"product-item"},i(X.name)+" × "+i(X.quantity),1))),128))])]),totalAmount:l(({row:d})=>[e("span",ya,"¥"+i(W(d.totalAmount)),1)]),deposit:l(({row:d})=>[e("span",ba,"¥"+i(W(d.deposit)),1)]),codAmount:l(({row:d})=>[e("span",ha,"¥"+i(W(d.codAmount)),1)]),remark:l(({row:d})=>[d.remark?(y(),A("span",{key:0,class:"remark-text",innerHTML:C(d.remark)},null,8,ka)):(y(),A("span",wa,"无备注"))]),expressCompany:l(({row:d})=>[d.expressCompany?(y(),ae(xe,{key:0,type:"info"},{default:l(()=>[n(i(xt(d.expressCompany)),1)]),_:2},1024)):(y(),A("span",$a,"未选择"))]),expressNo:l(({row:d})=>[d.expressNo?(y(),A("div",Ta,[t(Te,{type:"primary",onClick:X=>At(d)},{default:l(()=>[n(i(d.expressNo),1)]),_:2},1032,["onClick"]),t(V,{size:"small",type:"text",onClick:X=>Dt(d.expressNo),class:"copy-btn"},{default:l(()=>[t(p,null,{default:l(()=>[t(m(Xt))]),_:1})]),_:1},8,["onClick"])])):(y(),A("span",xa,"未发货"))]),logisticsStatus:l(({row:d})=>[d.logisticsStatus?(y(),ae(xe,{key:0,type:Ct(d.logisticsStatus)},{default:l(()=>[n(i(Vt(d.logisticsStatus)),1)]),_:2},1032,["type"])):(y(),A("span",Ca,"-"))]),lastOperation:l(({row:d})=>[d.lastOperation?(y(),A("div",Va,[e("div",Aa,i(d.lastOperation.action),1),e("div",Da,[e("span",Oa,i(d.lastOperation.operator),1),e("span",Sa,i(re(d.lastOperation.time)),1)])])):(y(),A("span",Na,"暂无记录"))]),"table-actions":l(({row:d})=>[e("div",Ma,[t(V,{size:"small",type:"primary",onClick:X=>Ie(d)},{default:l(()=>[t(p,null,{default:l(()=>[t(m(Be))]),_:1}),s[33]||(s[33]=n(" 查看 ",-1))]),_:1},8,["onClick"]),M.value==="returned"||M.value==="cancelled"?(y(),A(de,{key:0},[],64)):d.status==="draft"?(y(),A(de,{key:1},[t(V,{size:"small",type:"warning",onClick:X=>bt(d)},{default:l(()=>[t(p,null,{default:l(()=>[t(m(qe))]),_:1}),s[34]||(s[34]=n(" 编辑 ",-1))]),_:1},8,["onClick"]),t(V,{size:"small",type:"success",onClick:X=>ht(d)},{default:l(()=>[t(p,null,{default:l(()=>[t(m(at))]),_:1}),s[35]||(s[35]=n(" 提交 ",-1))]),_:1},8,["onClick"]),t(V,{size:"small",type:"danger",onClick:X=>kt(d)},{default:l(()=>[t(p,null,{default:l(()=>[t(m(it))]),_:1}),s[36]||(s[36]=n(" 删除 ",-1))]),_:1},8,["onClick"])],64)):d.status==="rejected_returned"?(y(),A(de,{key:2},[t(V,{size:"small",type:"warning",onClick:X=>wt(d)},{default:l(()=>[t(p,null,{default:l(()=>[t(m(qe))]),_:1}),s[37]||(s[37]=n(" 编辑 ",-1))]),_:1},8,["onClick"]),t(V,{size:"small",type:"success",onClick:X=>$t(d)},{default:l(()=>[t(p,null,{default:l(()=>[t(m(at))]),_:1}),s[38]||(s[38]=n(" 提审 ",-1))]),_:1},8,["onClick"]),t(V,{size:"small",type:"danger",onClick:X=>Tt(d)},{default:l(()=>[t(p,null,{default:l(()=>[t(m(We))]),_:1}),s[39]||(s[39]=n(" 取消 ",-1))]),_:1},8,["onClick"])],64)):(y(),A(de,{key:3},[t(V,{size:"small",type:"success",onClick:X=>Xe(d)},{default:l(()=>[t(p,null,{default:l(()=>[t(m(je))]),_:1}),s[40]||(s[40]=n(" 打印面单 ",-1))]),_:1},8,["onClick"]),t(V,{size:"small",type:"warning",onClick:X=>et(d)},{default:l(()=>[t(p,null,{default:l(()=>[t(m(ye))]),_:1}),s[41]||(s[41]=n(" 发货 ",-1))]),_:1},8,["onClick"]),t(K,{onCommand:ft,trigger:"click"},{dropdown:l(()=>[t(Ee,null,{default:l(()=>[t(Ue,{command:{action:"export",row:d}},{default:l(()=>[t(p,null,{default:l(()=>[t(m(Ke))]),_:1}),s[43]||(s[43]=n(" 导出 ",-1))]),_:1},8,["command"]),t(Ue,{command:{action:"return",row:d}},{default:l(()=>[t(p,null,{default:l(()=>[t(m(nt))]),_:1}),s[44]||(s[44]=n(" 退回 ",-1))]),_:1},8,["command"]),t(Ue,{command:{action:"cancel",row:d}},{default:l(()=>[t(p,null,{default:l(()=>[t(m(We))]),_:1}),s[45]||(s[45]=n(" 取消 ",-1))]),_:1},8,["command"])]),_:2},1024)]),default:l(()=>[t(V,{size:"small"},{default:l(()=>[s[42]||(s[42]=n(" 更多",-1)),t(p,{class:"el-icon--right"},{default:l(()=>[t(m(Gt))]),_:1})]),_:1})]),_:2},1024)],64))])]),_:1},8,["data","columns","title","loading","pagination"]),t(al,{visible:N.value,"onUpdate:visible":s[5]||(s[5]=d=>N.value=d),order:I.value},null,8,["visible","order"]),t(ls,{visible:o.value,"onUpdate:visible":s[6]||(s[6]=d=>o.value=d),order:I.value},null,8,["visible","order"]),t(Ds,{visible:a.value,"onUpdate:visible":s[7]||(s[7]=d=>a.value=d),order:I.value,onShipped:vt},null,8,["visible","order"]),t(mo,{visible:v.value,"onUpdate:visible":s[8]||(s[8]=d=>v.value=d),selectedOrders:H.value,onBatchShipped:gt},null,8,["visible","selectedOrders"]),t(Ro,{visible:$.value,"onUpdate:visible":s[9]||(s[9]=d=>$.value=d),order:I.value,onReturned:_t},null,8,["visible","order"]),t(On,{visible:r.value,"onUpdate:visible":s[10]||(s[10]=d=>r.value=d),order:I.value,onCancelled:yt},null,8,["visible","order"]),t(Nt,{modelValue:Y.value,"onUpdate:modelValue":s[17]||(s[17]=d=>Y.value=d),title:"发货列表 - 全屏查看",width:"95%",class:"fullscreen-dialog"},{default:l(()=>[e("div",Ua,[e("div",Ba,[e("div",La,[t(O,{modelValue:k.value,"onUpdate:modelValue":s[11]||(s[11]=d=>k.value=d),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"date-picker"},null,8,["modelValue"]),t(ue,{modelValue:P.value,"onUpdate:modelValue":s[12]||(s[12]=d=>P.value=d),placeholder:"选择部门",class:"department-select"},{default:l(()=>[t(F,{label:"全部部门",value:""}),t(F,{label:"销售一部",value:"sales1"}),t(F,{label:"销售二部",value:"sales2"}),t(F,{label:"市场部",value:"marketing"})]),_:1},8,["modelValue"]),t(ce,{modelValue:z.value,"onUpdate:modelValue":s[13]||(s[13]=d=>z.value=d),placeholder:"订单号",class:"search-input",clearable:""},{prefix:l(()=>[t(p,null,{default:l(()=>[t(m(ze))]),_:1})]),_:1},8,["modelValue"]),t(ce,{modelValue:Z.value,"onUpdate:modelValue":s[14]||(s[14]=d=>Z.value=d),placeholder:"客户号码",class:"search-input",clearable:""},{prefix:l(()=>[t(p,null,{default:l(()=>[t(m(ot))]),_:1})]),_:1},8,["modelValue"])]),e("div",Ya,[t(V,{type:"primary",onClick:ke,class:"query-btn"},{default:l(()=>[t(p,null,{default:l(()=>[t(m(ze))]),_:1}),s[46]||(s[46]=n(" 查询 ",-1))]),_:1})])]),e("div",Ia,[t(Ot,{data:Q.value,stripe:"",class:"data-table",border:"",onSelectionChange:be,"row-class-name":ie,height:"calc(100vh - 300px)"},{default:l(()=>[t(G,{type:"selection",width:"50",align:"center"}),t(G,{type:"index",label:"序号",width:"50",align:"center"}),t(G,{prop:"orderNo",label:"订单号",width:"120",align:"center"},{default:l(({row:d})=>[t(Te,{type:"primary",onClick:X=>Ie(d)},{default:l(()=>[n(i(d.orderNo),1)]),_:2},1032,["onClick"])]),_:1}),t(G,{prop:"status",label:"状态",width:"80",align:"center"},{default:l(({row:d})=>[t(xe,{type:oe(d.status),size:"small"},{default:l(()=>[n(i(m(T).getStatusText(d.status)),1)]),_:2},1032,["type"])]),_:1}),t(G,{prop:"customerName",label:"客户姓名",width:"100",align:"center","show-overflow-tooltip":""}),t(G,{prop:"phone",label:"联系电话",width:"120",align:"center","show-overflow-tooltip":""},{default:l(({row:d})=>[n(i(m(pe)(d.phone)),1)]),_:1}),t(G,{prop:"address",label:"收货地址",width:"180",align:"left","show-overflow-tooltip":""}),t(G,{prop:"productsText",label:"商品信息",width:"160",align:"left","show-overflow-tooltip":""}),t(G,{prop:"totalAmount",label:"订单金额",width:"100",align:"center"},{default:l(({row:d})=>[e("span",za,"¥"+i(W(d.totalAmount)),1)]),_:1}),t(G,{prop:"codAmount",label:"代收款",width:"100",align:"center"},{default:l(({row:d})=>[e("span",Pa,"¥"+i(W(d.codAmount)),1)]),_:1}),t(G,{prop:"createTime",label:"下单时间",width:"130",align:"center"},{default:l(({row:d})=>[n(i(re(d.createTime)),1)]),_:1}),t(G,{prop:"shipTime",label:"发货时间",width:"130",align:"center"},{default:l(({row:d})=>[n(i(re(d.shipTime)),1)]),_:1}),t(G,{prop:"trackingNo",label:"物流单号",width:"130",align:"center","show-overflow-tooltip":""}),t(G,{prop:"logisticsCompany",label:"物流公司",width:"100",align:"center","show-overflow-tooltip":""}),t(G,{prop:"remark",label:"备注",width:"140",align:"left","show-overflow-tooltip":""}),t(G,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:d})=>[e("div",qa,[t(V,{size:"small",type:"primary",onClick:X=>Ie(d)},{default:l(()=>[t(p,null,{default:l(()=>[t(m(Be))]),_:1}),s[47]||(s[47]=n(" 查看详情 ",-1))]),_:1},8,["onClick"]),t(V,{size:"small",type:"info",onClick:X=>Xe(d)},{default:l(()=>[t(p,null,{default:l(()=>[t(m(je))]),_:1}),s[48]||(s[48]=n(" 打印面单 ",-1))]),_:1},8,["onClick"]),d.status==="pending"?(y(),ae(V,{key:0,size:"small",type:"success",onClick:X=>et(d)},{default:l(()=>[t(p,null,{default:l(()=>[t(m(ye))]),_:1}),s[49]||(s[49]=n(" 发货 ",-1))]),_:1},8,["onClick"])):ne("",!0)])]),_:1})]),_:1},8,["data"])]),e("div",Fa,[t(St,{"current-page":j.value,"onUpdate:currentPage":s[15]||(s[15]=d=>j.value=d),"page-size":te.value,"onUpdate:pageSize":s[16]||(s[16]=d=>te.value=d),"page-sizes":[50,100,200],total:ee.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Me,onCurrentChange:Ge},null,8,["current-page","page-size","total"])])])]),_:1},8,["modelValue"])])}}}),er=Se(Ra,[["__scopeId","data-v-193c6386"]]);export{er as default};
