var ve=Object.defineProperty,_e=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var Q=(a,l,n)=>l in a?ve(a,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[l]=n,G=(a,l)=>{for(var n in l||(l={}))ye.call(l,n)&&Q(a,n,l[n]);if(K)for(var n of K(l))Ve.call(l,n)&&Q(a,n,l[n]);return a},P=(a,l)=>_e(a,be(l));var y=(a,l,n)=>new Promise((u,d)=>{var m=f=>{try{S(n.next(f))}catch(c){d(c)}},z=f=>{try{S(n.throw(f))}catch(c){d(c)}},S=f=>f.done?u(f.value):Promise.resolve(f.value).then(m,z);S((n=n.apply(a,l)).next())});import{p as Se,E as k,b as Ce}from"./elementPlus-Bmwh7Rh8.js";import{u as ke,S as ze,_ as we}from"./settings-CuxbDWOu.js";import{d as Ue}from"./sensitiveInfo-BWt1a88R.js";import{l as Oe,r as V,Z as J,c as xe,ag as p,aq as Ge,m as B,p as T,q as N,U as t,O as o,S as g,u as I,P as W,M as X,T as Y,F as Te,a9 as Ne}from"./vendor-D8Vxqhr-.js";import"./utils-ywHRn0uI.js";const D={getList:a=>y(void 0,null,function*(){try{const l=localStorage.getItem("customer_groups");let u=l?JSON.parse(l):[];a!=null&&a.name&&(u=u.filter(c=>c.name.toLowerCase().includes(a.name.toLowerCase()))),a!=null&&a.status&&(u=u.filter(c=>c.status===a.status));const d=(a==null?void 0:a.page)||1,m=(a==null?void 0:a.pageSize)||20,z=(d-1)*m,S=z+m;return{data:{list:u.slice(z,S),total:u.length,page:d,pageSize:m},code:200,message:"success",success:!0}}catch(l){return console.error("获取分组列表失败:",l),{data:{list:[],total:0,page:1,pageSize:20},code:500,message:"获取分组列表失败",success:!1}}}),create:a=>y(void 0,null,function*(){try{const l=localStorage.getItem("customer_groups"),n=l?JSON.parse(l):[],u=P(G({},a),{id:Date.now().toString(),createTime:new Date().toLocaleString("zh-CN"),customerCount:0});return n.unshift(u),localStorage.setItem("customer_groups",JSON.stringify(n)),{data:u,code:200,message:"success",success:!0}}catch(l){return console.error("创建分组失败:",l),{data:null,code:500,message:"创建分组失败",success:!1}}}),update:(a,l)=>y(void 0,null,function*(){try{const n=localStorage.getItem("customer_groups"),u=n?JSON.parse(n):[],d=u.findIndex(m=>m.id===a);return d===-1?{data:null,code:404,message:"分组不存在",success:!1}:(u[d]=G(G({},u[d]),l),localStorage.setItem("customer_groups",JSON.stringify(u)),{data:u[d],code:200,message:"success",success:!0})}catch(n){return console.error("更新分组失败:",n),{data:null,code:500,message:"更新分组失败",success:!1}}}),delete:a=>y(void 0,null,function*(){try{const l=localStorage.getItem("customer_groups"),u=(l?JSON.parse(l):[]).filter(d=>d.id!==a);return localStorage.setItem("customer_groups",JSON.stringify(u)),{data:null,code:200,message:"success",success:!0}}catch(l){return console.error("删除分组失败:",l),{data:null,code:500,message:"删除分组失败",success:!1}}}),getDetail:a=>y(void 0,null,function*(){try{const l=localStorage.getItem("customer_groups"),u=(l?JSON.parse(l):[]).find(d=>d.id===a);return u?{data:u,code:200,message:"success",success:!0}:{data:null,code:404,message:"分组不存在",success:!1}}catch(l){return console.error("获取分组详情失败:",l),{data:null,code:500,message:"获取分组详情失败",success:!1}}})},he={class:"customer-groups"},Ie={class:"page-header"},De={class:"header-actions"},Le={class:"pagination-container"},Pe={class:"condition-builder"},Je=Oe({__name:"Groups",setup(a){const l=ke(),n=V(!1),u=V(!1),d=V(!1),m=V(!1),z=V(!1),S=V(""),f=V(),c=J({name:"",status:""}),E=V([]),ee=V([]),q=V([]),C=J({currentPage:1,pageSize:20,total:0}),i=J({id:"",name:"",description:"",status:"active",conditions:[]}),te={name:[{required:!0,message:"请输入分组名称",trigger:"blur"}],description:[{required:!0,message:"请输入分组描述",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},O=()=>y(this,null,function*(){n.value=!0;try{const r={name:c.name,status:c.status,page:C.currentPage,pageSize:C.pageSize},e=yield D.getList(r);e.success?(E.value=e.data.list,C.total=e.data.total):k.error(e.message||"加载数据失败")}catch(r){console.error("加载分组数据失败:",r),k.error("加载数据失败")}finally{n.value=!1}}),A=()=>{C.currentPage=1,O()},le=()=>{Object.keys(c).forEach(r=>{c[r]=""}),A()},oe=()=>{S.value="新增分组",$(),m.value=!0},ae=r=>{S.value="编辑分组",Object.assign(i,P(G({},r),{conditions:r.conditions||[]})),m.value=!0},se=r=>y(this,null,function*(){try{yield Ce.confirm(`确定要删除分组"${r.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=yield D.delete(r.id);e.success?(k.success("删除成功"),O()):k.error(e.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除分组失败:",e),k.error("删除失败"))}}),ne=r=>y(this,null,function*(){z.value=!0,d.value=!0;try{yield new Promise(e=>setTimeout(e,500)),q.value=[{name:"张三",phone:"13800138001",level:"gold",totalAmount:15e3,lastOrderTime:"2024-01-20 14:30:00"},{name:"李四",phone:"13800138002",level:"silver",totalAmount:8500,lastOrderTime:"2024-01-18 10:15:00"}]}catch(e){k.error("加载客户数据失败")}finally{d.value=!1}}),re=()=>y(this,null,function*(){if(f.value)try{yield f.value.validate(),u.value=!0;let r;i.id?r=yield D.update(i.id,{name:i.name,description:i.description,status:i.status,conditions:i.conditions}):r=yield D.create({name:i.name,description:i.description,status:i.status,conditions:i.conditions}),r.success?(k.success(i.id?"更新成功":"创建成功"),m.value=!1,O()):k.error(r.message||"操作失败")}catch(r){console.error("提交分组失败:",r),k.error("操作失败")}finally{u.value=!1}}),ue=()=>{var r;(r=f.value)==null||r.clearValidate(),$()},$=()=>{Object.assign(i,{id:"",name:"",description:"",status:"active",conditions:[]})},ie=r=>{ee.value=r},de=()=>{i.conditions.push({field:"",operator:"",value:""})},ce=r=>{i.conditions.splice(r,1)};return xe(()=>{O()}),(r,e)=>{const pe=p("el-icon"),b=p("el-button"),h=p("el-input"),U=p("el-form-item"),_=p("el-option"),L=p("el-select"),j=p("el-form"),F=p("el-card"),v=p("el-table-column"),me=p("el-tag"),M=p("el-table"),ge=p("el-pagination"),R=p("el-radio"),fe=p("el-radio-group"),H=p("el-dialog"),Z=Ge("loading");return T(),B("div",he,[N("div",Ie,[e[11]||(e[11]=N("h2",null,"客户分组管理",-1)),N("div",De,[t(b,{type:"primary",onClick:oe},{default:o(()=>[t(pe,null,{default:o(()=>[t(I(Se))]),_:1}),e[10]||(e[10]=g(" 新增分组 ",-1))]),_:1})])]),t(F,{class:"search-card"},{default:o(()=>[t(j,{model:c,inline:""},{default:o(()=>[t(U,{label:"分组名称"},{default:o(()=>[t(h,{modelValue:c.name,"onUpdate:modelValue":e[0]||(e[0]=s=>c.name=s),placeholder:"请输入分组名称",clearable:""},null,8,["modelValue"])]),_:1}),t(U,{label:"状态"},{default:o(()=>[t(L,{modelValue:c.status,"onUpdate:modelValue":e[1]||(e[1]=s=>c.status=s),placeholder:"请选择状态",clearable:""},{default:o(()=>[t(_,{label:"启用",value:"active"}),t(_,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),t(U,null,{default:o(()=>[t(b,{type:"primary",onClick:A},{default:o(()=>[...e[12]||(e[12]=[g("搜索",-1)])]),_:1}),t(b,{onClick:le},{default:o(()=>[...e[13]||(e[13]=[g("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(F,{class:"table-card"},{default:o(()=>[W((T(),X(M,{data:E.value,onSelectionChange:ie},{default:o(()=>[t(v,{type:"selection",width:"55"}),t(v,{prop:"name",label:"分组名称"}),t(v,{prop:"description",label:"分组描述"}),t(v,{prop:"customerCount",label:"客户数量"}),t(v,{prop:"status",label:"状态"},{default:o(({row:s})=>[t(me,{type:s.status==="active"?"success":"danger"},{default:o(()=>[g(Y(s.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(v,{prop:"createTime",label:"创建时间"}),t(v,{label:"操作",width:"250"},{default:o(({row:s})=>[t(b,{type:"primary",size:"small",onClick:w=>ae(s)},{default:o(()=>[...e[14]||(e[14]=[g("编辑",-1)])]),_:1},8,["onClick"]),t(b,{type:"info",size:"small",onClick:w=>ne(s)},{default:o(()=>[...e[15]||(e[15]=[g("查看客户",-1)])]),_:1},8,["onClick"]),t(b,{type:"danger",size:"small",onClick:w=>se(s)},{default:o(()=>[...e[16]||(e[16]=[g("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,n.value]]),N("div",Le,[t(ge,{"current-page":C.currentPage,"onUpdate:currentPage":e[2]||(e[2]=s=>C.currentPage=s),"page-size":C.pageSize,"onUpdate:pageSize":e[3]||(e[3]=s=>C.pageSize=s),"page-sizes":[10,20,50,100],total:C.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:O},null,8,["current-page","page-size","total"])])]),_:1}),t(H,{modelValue:m.value,"onUpdate:modelValue":e[8]||(e[8]=s=>m.value=s),title:S.value,width:"600px",onClose:ue},{footer:o(()=>[t(b,{onClick:e[7]||(e[7]=s=>m.value=!1)},{default:o(()=>[...e[21]||(e[21]=[g("取消",-1)])]),_:1}),t(b,{type:"primary",onClick:re,loading:u.value},{default:o(()=>[...e[22]||(e[22]=[g(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(j,{ref_key:"formRef",ref:f,model:i,rules:te,"label-width":"100px"},{default:o(()=>[t(U,{label:"分组名称",prop:"name"},{default:o(()=>[t(h,{modelValue:i.name,"onUpdate:modelValue":e[4]||(e[4]=s=>i.name=s),placeholder:"请输入分组名称"},null,8,["modelValue"])]),_:1}),t(U,{label:"分组描述",prop:"description"},{default:o(()=>[t(h,{modelValue:i.description,"onUpdate:modelValue":e[5]||(e[5]=s=>i.description=s),type:"textarea",rows:3,placeholder:"请输入分组描述"},null,8,["modelValue"])]),_:1}),t(U,{label:"状态",prop:"status"},{default:o(()=>[t(fe,{modelValue:i.status,"onUpdate:modelValue":e[6]||(e[6]=s=>i.status=s)},{default:o(()=>[t(R,{value:"active"},{default:o(()=>[...e[17]||(e[17]=[g("启用",-1)])]),_:1}),t(R,{value:"inactive"},{default:o(()=>[...e[18]||(e[18]=[g("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(U,{label:"分组条件"},{default:o(()=>[N("div",Pe,[(T(!0),B(Te,null,Ne(i.conditions,(s,w)=>(T(),B("div",{key:w,class:"condition-item"},[t(L,{modelValue:s.field,"onUpdate:modelValue":x=>s.field=x,placeholder:"选择字段"},{default:o(()=>[t(_,{label:"客户等级",value:"level"}),t(_,{label:"注册时间",value:"registerTime"}),t(_,{label:"最后消费时间",value:"lastOrderTime"}),t(_,{label:"消费金额",value:"totalAmount"})]),_:1},8,["modelValue","onUpdate:modelValue"]),t(L,{modelValue:s.operator,"onUpdate:modelValue":x=>s.operator=x,placeholder:"选择条件"},{default:o(()=>[t(_,{label:"等于",value:"eq"}),t(_,{label:"不等于",value:"ne"}),t(_,{label:"大于",value:"gt"}),t(_,{label:"小于",value:"lt"}),t(_,{label:"包含",value:"contains"})]),_:1},8,["modelValue","onUpdate:modelValue"]),t(h,{modelValue:s.value,"onUpdate:modelValue":x=>s.value=x,placeholder:"输入值"},null,8,["modelValue","onUpdate:modelValue"]),t(b,{type:"danger",size:"small",onClick:x=>ce(w)},{default:o(()=>[...e[19]||(e[19]=[g("删除",-1)])]),_:1},8,["onClick"])]))),128)),t(b,{type:"primary",size:"small",onClick:de},{default:o(()=>[...e[20]||(e[20]=[g("添加条件",-1)])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(H,{modelValue:z.value,"onUpdate:modelValue":e[9]||(e[9]=s=>z.value=s),title:"分组客户列表",width:"800px"},{default:o(()=>[W((T(),X(M,{data:q.value},{default:o(()=>[t(v,{prop:"name",label:"客户姓名"}),t(v,{prop:"phone",label:"手机号"},{default:o(({row:s})=>{var w;return[g(Y(I(Ue)(s.phone,I(ze).PHONE,((w=I(l).currentUser)==null?void 0:w.id)||"")),1)]}),_:1}),t(v,{prop:"level",label:"客户等级"}),t(v,{prop:"totalAmount",label:"消费金额"}),t(v,{prop:"lastOrderTime",label:"最后消费时间"})]),_:1},8,["data"])),[[Z,d.value]])]),_:1},8,["modelValue"])])}}}),Fe=we(Je,[["__scopeId","data-v-8d78599e"]]);export{Fe as default};
