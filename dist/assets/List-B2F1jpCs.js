var N=(G,M,_)=>new Promise((T,f)=>{var A=m=>{try{V(_.next(m))}catch(b){f(b)}},E=m=>{try{V(_.throw(m))}catch(b){f(b)}},V=m=>m.done?T(m.value):Promise.resolve(m.value).then(A,E);V((_=_.apply(G,M)).next())});import{l as xe,az as Ae,r as h,Z as R,e as O,c as Ee,ag as s,m as Y,p as $,q as x,U as t,O as l,u as k,S as r,M as q,Q as Z,T as D,F as $e,a9 as De}from"./vendor-D8Vxqhr-.js";import{s as Ue,r as J,p as Pe,n as Le,i as Re,P as Me,E as u,b as K}from"./elementPlus-Bmwh7Rh8.js";import{u as ze}from"./service-CXxf5jtg.js";import{g as Ie,c as Be,_ as Fe}from"./settings-CuxbDWOu.js";import{m as Oe}from"./phone-DsAzMHsn.js";import{D as qe}from"./DynamicTable-CiyMIP8-.js";import"./utils-ywHRn0uI.js";const Ge={class:"service-list-container"},We={class:"action-bar"},je={class:"action-left"},He={class:"action-right"},Qe=xe({name:"ServiceList",__name:"List",setup(G){const M=Ae(),_=Be(M),T=ze(),f=Ie(),A=h(!1),E=h(!1),V=h(!1),m=h(!1),b=h(!1),v=R({orderNumber:"",customerName:"",serviceType:"",status:"",dateRange:[]}),S=R({currentPage:1,pageSize:20,total:0}),w=O(()=>T.afterSalesServices),W=h([]),y=R({assignedTo:"",remark:""}),g=R({priority:"",remark:""}),i=h(null),z=h([{id:"1",name:"李四"},{id:"2",name:"赵六"},{id:"3",name:"孙八"},{id:"4",name:"周九"}]),X=O(()=>[{prop:"serviceNumber",label:"售后单号",width:160,visible:!0,sortable:!0},{prop:"orderNumber",label:"原订单号",width:160,visible:!0},{prop:"customerName",label:"客户姓名",width:120,visible:!0},{prop:"customerPhone",label:"联系电话",width:130,visible:!0},{prop:"serviceType",label:"服务类型",width:100,visible:!0},{prop:"productName",label:"商品名称",minWidth:150,visible:!0,showOverflowTooltip:!0},{prop:"reason",label:"申请原因",minWidth:150,visible:!0,showOverflowTooltip:!0},{prop:"status",label:"处理状态",width:100,visible:!0},{prop:"priority",label:"优先级",width:100,visible:!0},{prop:"assignedTo",label:"处理人",width:100,visible:!0},{prop:"createdAt",label:"创建时间",width:160,visible:!0,sortable:!0},{prop:"updatedAt",label:"更新时间",width:160,visible:!0,sortable:!0}]);O(()=>W.value.length>0);const j=()=>{S.currentPage=1,C()},ee=()=>{Object.assign(v,{orderNumber:"",customerName:"",serviceType:"",status:"",dateRange:[]}),j()},te=()=>{C()},ae=()=>{_.push("/service/add")},H=a=>{_.push(`/service/detail/${a.id}`)},le=a=>{_.push(`/service/edit/${a.id}`)},oe=()=>{u.success("导出功能开发中...")},re=()=>{u.info("列设置功能开发中...")},ne=a=>{W.value=a},se=({column:a,prop:e,order:d})=>{console.log("排序变化:",{column:a,prop:e,order:d}),C()},ie=a=>{S.pageSize=a,C()},de=a=>{S.currentPage=a,C()},ue=(a,e)=>{switch(i.value=e,a){case"assign":y.assignedTo=e.assignedTo||"",y.remark="",m.value=!0;break;case"priority":g.priority=e.priority,g.remark="",b.value=!0;break;case"close":ce(e);break;case"delete":ve(e);break}},me=()=>N(this,null,function*(){var a,e;if(!y.assignedTo){u.warning("请选择处理人");return}E.value=!0;try{yield new Promise(n=>setTimeout(n,1e3));const d=w.value.findIndex(n=>n.id===i.value.id);d!==-1&&(w.value[d].assignedTo=((a=z.value.find(n=>n.id===y.assignedTo))==null?void 0:a.name)||"",w.value[d].updatedAt=new Date().toLocaleString());const p=((e=z.value.find(n=>n.id===y.assignedTo))==null?void 0:e.name)||"";f.sendMessage(f.MessageType.AFTER_SALES_ASSIGNED,`售后申请 ${i.value.serviceNumber} 已分配给 ${p}，客户：${i.value.customerName}`,{relatedId:i.value.serviceNumber,relatedType:"service",actionUrl:`/service/detail/${i.value.serviceNumber}`,metadata:{customerName:i.value.customerName,serviceType:i.value.serviceType,assignedTo:p}}),u.success("分配成功"),m.value=!1}catch(d){u.error("分配失败")}finally{E.value=!1}}),pe=()=>N(this,null,function*(){if(!g.priority){u.warning("请选择优先级");return}V.value=!0;try{yield new Promise(d=>setTimeout(d,1e3));const a=w.value.findIndex(d=>d.id===i.value.id);a!==-1&&(w.value[a].priority=g.priority,w.value[a].updatedAt=new Date().toLocaleString());const e=g.priority==="high"?"高":g.priority==="medium"?"中":"低";f.sendMessage(f.MessageType.AFTER_SALES_PRIORITY_CHANGED,`售后申请 ${i.value.serviceNumber} 优先级已设置为${e}，客户：${i.value.customerName}`,{relatedId:i.value.serviceNumber,relatedType:"service",actionUrl:`/service/detail/${i.value.serviceNumber}`,metadata:{customerName:i.value.customerName,serviceType:i.value.serviceType,priority:g.priority}}),u.success("优先级设置成功"),b.value=!1}catch(a){u.error("设置失败")}finally{V.value=!1}}),ce=a=>N(this,null,function*(){K.confirm("确定要关闭这个售后单吗？关闭后将无法继续处理。","确认关闭",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>N(this,null,function*(){try{yield T.updateServiceStatus(a.id,"closed","手动关闭"),f.sendMessage(f.MessageType.AFTER_SALES_CLOSED,`售后申请 ${a.serviceNumber} 已关闭，客户：${a.customerName}`,{relatedId:a.serviceNumber,relatedType:"service",actionUrl:`/service/detail/${a.serviceNumber}`,metadata:{customerName:a.customerName,serviceType:a.serviceType,closedAt:new Date().toISOString()}}),u.success("售后单已关闭")}catch(e){u.error("关闭售后单失败"),console.error("关闭售后单失败:",e)}}))}),ve=a=>N(this,null,function*(){K.confirm("确定要删除这个售后单吗？删除后无法恢复。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>N(this,null,function*(){try{T.deleteService(a.id)?(S.total=T.afterSalesServices.length,f.sendMessage(f.MessageType.AFTER_SALES_DELETED,`售后申请 ${a.serviceNumber} 已删除，客户：${a.customerName}`,{relatedId:a.serviceNumber,relatedType:"service",actionUrl:"/service/list",metadata:{customerName:a.customerName,serviceType:a.serviceType,deletedAt:new Date().toISOString()}}),u.success("删除成功")):u.error("删除失败")}catch(e){u.error("删除售后单失败"),console.error("删除售后单失败:",e)}}))}),C=()=>N(this,null,function*(){A.value=!0;try{yield T.loadAfterSalesServices(),S.total=T.afterSalesServices.length}catch(a){u.error("加载数据失败"),console.error("加载售后服务数据失败:",a)}finally{A.value=!1}}),ge=a=>({return:"退货",exchange:"换货",repair:"维修",complaint:"投诉",inquiry:"咨询"})[a]||a,fe=a=>({return:"danger",exchange:"warning",repair:"info",complaint:"danger",inquiry:"success"})[a]||"",ye=a=>({pending:"待处理",processing:"处理中",completed:"已完成",closed:"已关闭"})[a]||a,be=a=>({pending:"warning",processing:"primary",completed:"success",closed:"info"})[a]||"",_e=a=>({low:"低",medium:"中",high:"高",urgent:"紧急"})[a]||a,Te=a=>({low:"info",medium:"",high:"warning",urgent:"danger"})[a]||"";return Ee(()=>{C()}),(a,e)=>{const d=s("el-input"),p=s("el-form-item"),n=s("el-option"),I=s("el-select"),Se=s("el-date-picker"),c=s("el-button"),B=s("el-form"),Ne=s("el-card"),he=s("el-button-group"),ke=s("el-link"),F=s("el-tag"),U=s("el-dropdown-item"),Ve=s("el-dropdown-menu"),we=s("el-dropdown"),Q=s("el-dialog"),P=s("el-radio"),Ce=s("el-radio-group");return $(),Y("div",Ge,[e[31]||(e[31]=x("div",{class:"page-header"},[x("h2",null,"售后订单"),x("p",null,"管理和跟踪所有售后服务请求")],-1)),t(Ne,{class:"search-card",shadow:"never"},{default:l(()=>[t(B,{model:v,inline:""},{default:l(()=>[t(p,{label:"订单号"},{default:l(()=>[t(d,{modelValue:v.orderNumber,"onUpdate:modelValue":e[0]||(e[0]=o=>v.orderNumber=o),placeholder:"请输入订单号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(p,{label:"客户姓名"},{default:l(()=>[t(d,{modelValue:v.customerName,"onUpdate:modelValue":e[1]||(e[1]=o=>v.customerName=o),placeholder:"请输入客户姓名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(p,{label:"服务类型"},{default:l(()=>[t(I,{modelValue:v.serviceType,"onUpdate:modelValue":e[2]||(e[2]=o=>v.serviceType=o),placeholder:"请选择服务类型",clearable:"",style:{width:"150px"}},{default:l(()=>[t(n,{label:"退货",value:"return"}),t(n,{label:"换货",value:"exchange"}),t(n,{label:"维修",value:"repair"}),t(n,{label:"投诉",value:"complaint"}),t(n,{label:"咨询",value:"inquiry"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"处理状态"},{default:l(()=>[t(I,{modelValue:v.status,"onUpdate:modelValue":e[3]||(e[3]=o=>v.status=o),placeholder:"请选择状态",clearable:"",style:{width:"150px"}},{default:l(()=>[t(n,{label:"待处理",value:"pending"}),t(n,{label:"处理中",value:"processing"}),t(n,{label:"已完成",value:"completed"}),t(n,{label:"已关闭",value:"closed"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"创建时间"},{default:l(()=>[t(Se,{modelValue:v.dateRange,"onUpdate:modelValue":e[4]||(e[4]=o=>v.dateRange=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),t(p,null,{default:l(()=>[t(c,{type:"primary",icon:k(Ue),onClick:j},{default:l(()=>[...e[13]||(e[13]=[r(" 搜索 ",-1)])]),_:1},8,["icon"]),t(c,{icon:k(J),onClick:ee},{default:l(()=>[...e[14]||(e[14]=[r(" 重置 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),x("div",We,[x("div",je,[t(c,{type:"primary",icon:k(Pe),onClick:ae},{default:l(()=>[...e[15]||(e[15]=[r(" 新建售后 ",-1)])]),_:1},8,["icon"]),t(c,{icon:k(Le),onClick:oe},{default:l(()=>[...e[16]||(e[16]=[r(" 导出数据 ",-1)])]),_:1},8,["icon"])]),x("div",He,[t(he,null,{default:l(()=>[t(c,{icon:k(J),onClick:te},null,8,["icon"]),t(c,{icon:k(Re),onClick:re},null,8,["icon"])]),_:1})])]),t(qe,{data:w.value,columns:X.value,"storage-key":"service-list-columns",title:"售后订单列表",loading:A.value,"show-selection":!0,"show-index":!0,pagination:{currentPage:S.currentPage,pageSize:S.pageSize,total:S.total,pageSizes:[10,20,50,100]},onSelectionChange:ne,onSortChange:se,onSizeChange:ie,onCurrentChange:de},{serviceNumber:l(({row:o})=>[t(ke,{type:"primary",onClick:L=>H(o)},{default:l(()=>[r(D(o.serviceNumber),1)]),_:2},1032,["onClick"])]),customerPhone:l(({row:o})=>[r(D(k(Oe)(o.customerPhone)),1)]),serviceType:l(({row:o})=>[t(F,{type:fe(o.serviceType)},{default:l(()=>[r(D(ge(o.serviceType)),1)]),_:2},1032,["type"])]),status:l(({row:o})=>[t(F,{type:be(o.status)},{default:l(()=>[r(D(ye(o.status)),1)]),_:2},1032,["type"])]),priority:l(({row:o})=>[t(F,{type:Te(o.priority),size:"small"},{default:l(()=>[r(D(_e(o.priority)),1)]),_:2},1032,["type"])]),"table-actions":l(({row:o})=>[t(c,{size:"small",type:"primary",onClick:L=>H(o)},{default:l(()=>[...e[17]||(e[17]=[r(" 查看 ",-1)])]),_:1},8,["onClick"]),o.status!=="completed"?($(),q(c,{key:0,size:"small",onClick:L=>le(o)},{default:l(()=>[...e[18]||(e[18]=[r(" 编辑 ",-1)])]),_:1},8,["onClick"])):Z("",!0),t(we,{onCommand:L=>ue(L,o)},{dropdown:l(()=>[t(Ve,null,{default:l(()=>[t(U,{command:"assign"},{default:l(()=>[...e[19]||(e[19]=[r("分配处理人",-1)])]),_:1}),t(U,{command:"priority"},{default:l(()=>[...e[20]||(e[20]=[r("设置优先级",-1)])]),_:1}),o.status!=="closed"?($(),q(U,{key:0,command:"close"},{default:l(()=>[...e[21]||(e[21]=[r("关闭",-1)])]),_:1})):Z("",!0),t(U,{command:"delete",divided:""},{default:l(()=>[...e[22]||(e[22]=[r("删除",-1)])]),_:1})]),_:2},1024)]),default:l(()=>[t(c,{size:"small",icon:k(Me)},null,8,["icon"])]),_:2},1032,["onCommand"])]),_:1},8,["data","columns","loading","pagination"]),t(Q,{modelValue:m.value,"onUpdate:modelValue":e[8]||(e[8]=o=>m.value=o),title:"分配处理人",width:"400px"},{footer:l(()=>[t(c,{onClick:e[7]||(e[7]=o=>m.value=!1)},{default:l(()=>[...e[23]||(e[23]=[r("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:me,loading:E.value},{default:l(()=>[...e[24]||(e[24]=[r(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(B,{model:y,"label-width":"80px"},{default:l(()=>[t(p,{label:"处理人"},{default:l(()=>[t(I,{modelValue:y.assignedTo,"onUpdate:modelValue":e[5]||(e[5]=o=>y.assignedTo=o),placeholder:"请选择处理人",style:{width:"100%"}},{default:l(()=>[($(!0),Y($e,null,De(z.value,o=>($(),q(n,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"备注"},{default:l(()=>[t(d,{modelValue:y.remark,"onUpdate:modelValue":e[6]||(e[6]=o=>y.remark=o),type:"textarea",rows:3,placeholder:"请输入分配备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(Q,{modelValue:b.value,"onUpdate:modelValue":e[12]||(e[12]=o=>b.value=o),title:"设置优先级",width:"400px"},{footer:l(()=>[t(c,{onClick:e[11]||(e[11]=o=>b.value=!1)},{default:l(()=>[...e[29]||(e[29]=[r("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:pe,loading:V.value},{default:l(()=>[...e[30]||(e[30]=[r(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(B,{model:g,"label-width":"80px"},{default:l(()=>[t(p,{label:"优先级"},{default:l(()=>[t(Ce,{modelValue:g.priority,"onUpdate:modelValue":e[9]||(e[9]=o=>g.priority=o)},{default:l(()=>[t(P,{value:"low"},{default:l(()=>[...e[25]||(e[25]=[r("低",-1)])]),_:1}),t(P,{value:"medium"},{default:l(()=>[...e[26]||(e[26]=[r("中",-1)])]),_:1}),t(P,{value:"high"},{default:l(()=>[...e[27]||(e[27]=[r("高",-1)])]),_:1}),t(P,{value:"urgent"},{default:l(()=>[...e[28]||(e[28]=[r("紧急",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"备注"},{default:l(()=>[t(d,{modelValue:g.remark,"onUpdate:modelValue":e[10]||(e[10]=o=>g.remark=o),type:"textarea",rows:3,placeholder:"请输入设置原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),lt=Fe(Qe,[["__scopeId","data-v-96551403"]]);export{lt as default};
