import{l as e,r as a,Z as l,e as t,b as s,ag as o,aq as r,m as d,q as i,p as u,U as n,O as c,S as p,u as m,a7 as g,P as f,M as v,T as _,Q as y,F as b,a9 as h}from"./vendor-BtukhyiH.js";import{C as w,f as V,a4 as C,E as k,b as I}from"./elementPlus-DxaqjplL.js";import{u as x}from"./product-BDuYhoXd.js";import{_ as U}from"./index-DkAJPKqn.js";import"./env-DLalhsF6.js";import"./utils-DfI7e5Rl.js";const S={class:"category-container"},j={class:"page-header"},z={class:"header-actions"},A={class:"search-section"},q={class:"table-section"},T={class:"category-name"},O={class:"dialog-footer"},B=U(e({__name:"Category",setup(e){const U=x(),B=a(!1),E=a(!1),F=a(!1),P=a("新增分类"),Z=a(),$=l({name:"",status:""}),K=l({id:null,parentId:"0",name:"",code:"",sort:0,status:"active",description:""}),M={name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{min:2,max:50,message:"分类名称长度在 2 到 50 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入分类编码",trigger:"blur"},{pattern:/^[A-Za-z0-9_-]+$/,message:"分类编码只能包含字母、数字、下划线和横线",trigger:"blur"}],sort:[{required:!0,message:"请输入排序值",trigger:"blur"}]},Q=t(()=>Array.isArray(U.categories)?U.categories:[]),R=t(()=>(Array.isArray(U.categories)?U.categories:[]).filter(e=>1===e.level)),D=async()=>{B.value=!0;try{await U.loadCategories();(Array.isArray(U.categories)?U.categories:[]).forEach(e=>{e._initializing=!0,e._lastStatus=e.status,setTimeout(()=>{e._initializing=!1},100)}),console.log("分类数据加载完成")}catch(e){console.error("加载数据失败:",e),k.error("加载分类数据失败")}finally{B.value=!1}},G=()=>{console.log("搜索分类:",$),D()},H=()=>{$.name="",$.status="",D()},J=()=>{P.value="新增分类",W(),F.value=!0},L=async()=>{if(Z.value)try{if(await Z.value.validate(),E.value=!0,K.id)await U.updateCategory(K.id.toString(),{name:K.name,code:K.code,sort:K.sort,status:K.status}),k.success("编辑成功");else{const e={name:K.name,code:K.code,level:K.parentId&&"0"!==K.parentId?2:1,parentId:K.parentId&&"0"!==K.parentId?K.parentId:null,productCount:0,sort:K.sort,status:K.status};await U.addCategory(e),k.success("新增成功")}F.value=!1}catch(e){console.error("操作失败:",e),k.error("操作失败，请重试")}finally{E.value=!1}},N=()=>{Z.value?.resetFields(),W()},W=()=>{Object.assign(K,{id:null,parentId:0,name:"",code:"",sort:0,status:"active",description:""})};return s(()=>{D()}),(e,a)=>{const l=o("el-icon"),t=o("el-button"),s=o("el-input"),x=o("el-form-item"),D=o("el-option"),X=o("el-select"),Y=o("el-form"),ee=o("el-table-column"),ae=o("el-tag"),le=o("el-switch"),te=o("el-table"),se=o("el-input-number"),oe=o("el-radio"),re=o("el-radio-group"),de=o("el-dialog"),ie=r("loading");return i(),d("div",S,[u("div",j,[a[11]||(a[11]=u("div",{class:"header-left"},[u("h1",{class:"page-title"},"商品分类管理"),u("p",{class:"page-description"},"管理商品分类，支持多级分类结构")],-1)),u("div",z,[n(t,{type:"primary",onClick:J},{default:c(()=>[n(l,null,{default:c(()=>[n(m(w))]),_:1}),a[10]||(a[10]=p(" 新增分类 ",-1))]),_:1})])]),u("div",A,[n(Y,{model:$,inline:""},{default:c(()=>[n(x,{label:"分类名称"},{default:c(()=>[n(s,{modelValue:$.name,"onUpdate:modelValue":a[0]||(a[0]=e=>$.name=e),placeholder:"请输入分类名称",clearable:"",onKeyup:g(G,["enter"])},null,8,["modelValue"])]),_:1}),n(x,{label:"状态"},{default:c(()=>[n(X,{modelValue:$.status,"onUpdate:modelValue":a[1]||(a[1]=e=>$.status=e),placeholder:"请选择状态",clearable:""},{default:c(()=>[n(D,{label:"启用",value:"active"}),n(D,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),n(x,null,{default:c(()=>[n(t,{type:"primary",onClick:G},{default:c(()=>[...a[12]||(a[12]=[p("搜索",-1)])]),_:1}),n(t,{onClick:H},{default:c(()=>[...a[13]||(a[13]=[p("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),u("div",q,[f((i(),v(te,{data:Q.value,"row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},stripe:"",border:""},{default:c(()=>[n(ee,{prop:"name",label:"分类名称","min-width":"200"},{default:c(({row:e})=>[u("div",T,[1===e.level?(i(),v(l,{key:0,class:"level-icon"},{default:c(()=>[n(m(V))]),_:1})):(i(),v(l,{key:1,class:"level-icon"},{default:c(()=>[n(m(C))]),_:1})),p(" "+_(e.name),1)])]),_:1}),n(ee,{prop:"code",label:"分类编码",width:"120"}),n(ee,{prop:"level",label:"层级",width:"80"},{default:c(({row:e})=>[n(ae,{type:1===e.level?"primary":"success",size:"small"},{default:c(()=>[p(_(1===e.level?"一级":"二级"),1)]),_:2},1032,["type"])]),_:1}),n(ee,{prop:"productCount",label:"商品数量",width:"100",align:"center"}),n(ee,{prop:"sort",label:"排序",width:"80",align:"center"}),n(ee,{prop:"status",label:"状态",width:"80",align:"center"},{default:c(({row:e})=>[n(le,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,"active-value":"active","inactive-value":"inactive",onChange:a=>(async e=>{const a=e.status;if(!e._updating&&!e._initializing&&e.id&&(void 0===e._lastStatus||e._lastStatus!==e.status))try{e._updating=!0,await U.updateCategory(e.id.toString(),{status:e.status}),e._lastStatus=e.status,k.success(("active"===e.status?"启用":"禁用")+"成功")}catch(l){e.status=a,e._lastStatus=a,console.error("状态更新失败:",l),k.error("状态更新失败")}finally{e._updating=!1}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),n(ee,{prop:"createTime",label:"创建时间",width:"160"}),n(ee,{label:"操作",width:"200",fixed:"right"},{default:c(({row:e})=>[1===e.level?(i(),v(t,{key:0,type:"primary",size:"small",link:"",onClick:a=>(e=>{P.value="新增子分类",W(),K.parentId=e.id,F.value=!0})(e)},{default:c(()=>[...a[14]||(a[14]=[p(" 添加子分类 ",-1)])]),_:1},8,["onClick"])):y("",!0),n(t,{type:"primary",size:"small",link:"",onClick:a=>(e=>{P.value="编辑分类",Object.assign(K,{id:e.id,parentId:e.parentId,name:e.name,code:e.code,sort:e.sort,status:e.status,description:e.description||""}),F.value=!0})(e)},{default:c(()=>[...a[15]||(a[15]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"]),n(t,{type:"danger",size:"small",link:"",onClick:a=>(async e=>{if(e.productCount&&e.productCount>0)k.warning("该分类下有商品，无法删除");else try{await I.confirm(`确定要删除分类"${e.name}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await U.deleteCategory(e.id.toString()),k.success("删除成功")}catch(a){"cancel"!==a&&(console.error("删除失败:",a),k.error("删除失败"))}})(e),disabled:e.productCount>0},{default:c(()=>[...a[16]||(a[16]=[p(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[ie,B.value]])]),n(de,{modelValue:F.value,"onUpdate:modelValue":a[9]||(a[9]=e=>F.value=e),title:P.value,width:"600px",onClose:N},{footer:c(()=>[u("div",O,[n(t,{onClick:a[8]||(a[8]=e=>F.value=!1)},{default:c(()=>[...a[19]||(a[19]=[p("取消",-1)])]),_:1}),n(t,{type:"primary",onClick:L,loading:E.value},{default:c(()=>[...a[20]||(a[20]=[p(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:c(()=>[n(Y,{ref_key:"formRef",ref:Z,model:K,rules:M,"label-width":"100px"},{default:c(()=>[n(x,{label:"上级分类",prop:"parentId"},{default:c(()=>[n(X,{modelValue:K.parentId,"onUpdate:modelValue":a[2]||(a[2]=e=>K.parentId=e),placeholder:"请选择上级分类（不选则为一级分类）",clearable:"",style:{width:"100%"}},{default:c(()=>[n(D,{label:"无（一级分类）",value:0}),(i(!0),d(b,null,h(R.value,e=>(i(),v(D,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(x,{label:"分类名称",prop:"name"},{default:c(()=>[n(s,{modelValue:K.name,"onUpdate:modelValue":a[3]||(a[3]=e=>K.name=e),placeholder:"请输入分类名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),n(x,{label:"分类编码",prop:"code"},{default:c(()=>[n(s,{modelValue:K.code,"onUpdate:modelValue":a[4]||(a[4]=e=>K.code=e),placeholder:"请输入分类编码",maxlength:"20"},null,8,["modelValue"])]),_:1}),n(x,{label:"排序",prop:"sort"},{default:c(()=>[n(se,{modelValue:K.sort,"onUpdate:modelValue":a[5]||(a[5]=e=>K.sort=e),min:0,max:999,"controls-position":"right",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),n(x,{label:"状态",prop:"status"},{default:c(()=>[n(re,{modelValue:K.status,"onUpdate:modelValue":a[6]||(a[6]=e=>K.status=e)},{default:c(()=>[n(oe,{label:"active"},{default:c(()=>[...a[17]||(a[17]=[p("启用",-1)])]),_:1}),n(oe,{label:"inactive"},{default:c(()=>[...a[18]||(a[18]=[p("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(x,{label:"描述",prop:"description"},{default:c(()=>[n(s,{modelValue:K.description,"onUpdate:modelValue":a[7]||(a[7]=e=>K.description=e),type:"textarea",rows:3,placeholder:"请输入分类描述",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-a3fdb73d"]]);export{B as default};
