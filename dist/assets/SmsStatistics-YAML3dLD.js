import{r as e,G as t,m as a,t as l,R as s,a9 as i,E as r}from"./elementPlus-DxaqjplL.js";import{i as n}from"./utils-DfI7e5Rl.js";import{l as o,r as d,Z as c,b as u,n as m,Y as v,ag as h,aq as p,m as f,q as y,p as g,P as _,U as b,O as w,S,u as x,T as C}from"./vendor-BtukhyiH.js";import{_ as M}from"./index-DkAJPKqn.js";const U={class:"sms-statistics"},D={class:"filter-section"},z={class:"stats-cards"},k={class:"stats-card"},O={class:"stats-icon success"},V={class:"stats-content"},Y={class:"stats-number"},R={class:"stats-card"},L={class:"stats-icon warning"},q={class:"stats-content"},A={class:"stats-number"},j={class:"stats-card"},E={class:"stats-icon danger"},F={class:"stats-content"},I={class:"stats-number"},T={class:"stats-card"},N={class:"stats-icon info"},B={class:"stats-content"},P={class:"stats-number"},X={class:"charts-section"},G={class:"chart-card"},Z={class:"chart-header"},$={class:"chart-content"},H={class:"chart-card"},J={class:"chart-content"},K={class:"chart-card"},Q={class:"chart-content"},W={class:"chart-card"},ee={class:"chart-content"},te={class:"table-section"},ae={class:"cost-text"},le={class:"realtime-section"},se={class:"section-header"},ie={class:"realtime-stats"},re={class:"realtime-item"},ne={class:"realtime-value"},oe={class:"realtime-item"},de={class:"realtime-value"},ce={class:"realtime-item"},ue={class:"realtime-value"},me={class:"realtime-item"},ve={class:"realtime-value"},he=M(o({__name:"SmsStatistics",setup(o){const M=d(!1),he=d([]),pe=d("daily"),fe=d(!1),ye=d(null),ge=d(),_e=d(),be=d(),we=d();let Se=null,xe=null,Ce=null,Me=null;const Ue=c({totalSent:0,successRate:0,totalCost:0,monthlyUsage:0,dailyUsage:0,templateUsage:[],trendData:[]}),De=c({todaySent:0,onlineUsers:0,queueCount:0,systemStatus:"normal"}),ze=async()=>{M.value=!0;try{const e=await(void 0)(he.value);Object.assign(Ue,e),await m(),Ae()}catch(e){r.error("加载统计数据失败")}finally{M.value=!1}},ke=async()=>{try{const e=await(void 0)(he.value.length>0?he.value:["2024-01-01","2024-01-31"],pe.value);Ue.trendData=e,je()}catch(e){r.error("加载趋势数据失败")}},Oe=()=>{ze()},Ve=()=>{r.info("导出功能开发中...")},Ye=e=>{const t=Ue.templateUsage.reduce((e,t)=>e+t.count,0);return t>0?(e/t*100).toFixed(1):"0.0"},Re=e=>{e?Le():qe()},Le=()=>{ye.value=window.setInterval(()=>{De.todaySent+=Math.floor(5*Math.random()),De.onlineUsers=Math.floor(50*Math.random())+10,De.queueCount=Math.floor(20*Math.random()),De.systemStatus=Math.random()>.1?"normal":"error"},3e3)},qe=()=>{ye.value&&(clearInterval(ye.value),ye.value=null)},Ae=()=>{je(),Ee(),Fe(),Ie()},je=()=>{if(!Se)return;const e={title:{text:"发送量趋势",textStyle:{fontSize:14}},tooltip:{trigger:"axis"},xAxis:{type:"category",data:Ue.trendData.map(e=>e.date)},yAxis:{type:"value"},series:[{name:"发送量",type:"line",data:Ue.trendData.map(e=>e.count),smooth:!0,itemStyle:{color:"#409EFF"}}]};Se.setOption(e)},Ee=()=>{if(!xe)return;const e={title:{text:"模板使用分布",textStyle:{fontSize:14}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:"使用次数",type:"pie",radius:"60%",data:Ue.templateUsage.map(e=>({name:e.templateName,value:e.count})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};xe.setOption(e)},Fe=()=>{if(!Ce)return;const e=Math.floor(Ue.totalSent*Ue.successRate/100),t={title:{text:"发送成功率",textStyle:{fontSize:14}},tooltip:{trigger:"item"},series:[{name:"发送结果",type:"pie",radius:["40%","70%"],data:[{name:"成功",value:e,itemStyle:{color:"#67C23A"}},{name:"失败",value:Ue.totalSent-e,itemStyle:{color:"#F56C6C"}}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};Ce.setOption(t)},Ie=()=>{if(!Me)return;const e={title:{text:"费用趋势",textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter:"{b}<br/>{a}: ¥{c}"},xAxis:{type:"category",data:Ue.trendData.map(e=>e.date)},yAxis:{type:"value",axisLabel:{formatter:"¥{value}"}},series:[{name:"费用",type:"bar",data:Ue.trendData.map(e=>e.cost),itemStyle:{color:"#E6A23C"}}]};Me.setOption(e)},Te=()=>{Se?.resize(),xe?.resize(),Ce?.resize(),Me?.resize()};return u(async()=>{const e=new Date,t=new Date(e.getTime()-6048e5);he.value=[t.toISOString().split("T")[0],e.toISOString().split("T")[0]],await ze(),await m(),ge.value&&(Se=n(ge.value)),_e.value&&(xe=n(_e.value)),be.value&&(Ce=n(be.value)),we.value&&(Me=n(we.value)),window.addEventListener("resize",Te),De.todaySent=Math.floor(1e3*Math.random())+500,De.onlineUsers=Math.floor(50*Math.random())+10,De.queueCount=Math.floor(20*Math.random())}),v(()=>{qe(),window.removeEventListener("resize",Te),Se?.dispose(),xe?.dispose(),Ce?.dispose(),Me?.dispose()}),(n,o)=>{const d=h("el-date-picker"),c=h("el-form-item"),u=h("el-icon"),m=h("el-button"),v=h("el-form"),ye=h("el-radio-button"),Se=h("el-radio-group"),xe=h("el-col"),Ce=h("el-row"),Me=h("el-table-column"),Le=h("el-tag"),qe=h("el-table"),Ae=h("el-switch"),je=p("loading");return y(),f("div",U,[o[23]||(o[23]=g("div",{class:"page-header"},[g("h2",null,"短信统计分析"),g("p",null,"查看短信使用情况和数据分析报告")],-1)),g("div",D,[b(v,{inline:""},{default:w(()=>[b(c,{label:"统计时间"},{default:w(()=>[b(d,{modelValue:he.value,"onUpdate:modelValue":o[0]||(o[0]=e=>he.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:Oe,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),b(c,null,{default:w(()=>[b(m,{type:"primary",onClick:ze},{default:w(()=>[b(u,null,{default:w(()=>[b(x(e))]),_:1}),o[3]||(o[3]=S(" 刷新数据 ",-1))]),_:1}),b(m,{onClick:Ve},{default:w(()=>[b(u,null,{default:w(()=>[b(x(t))]),_:1}),o[4]||(o[4]=S(" 导出报告 ",-1))]),_:1})]),_:1})]),_:1})]),_((y(),f("div",z,[g("div",k,[g("div",O,[b(u,null,{default:w(()=>[b(x(a))]),_:1})]),g("div",V,[g("div",Y,C(Ue.totalSent.toLocaleString()),1),o[5]||(o[5]=g("div",{class:"stats-label"},"总发送量",-1))])]),g("div",R,[g("div",L,[b(u,null,{default:w(()=>[b(x(l))]),_:1})]),g("div",q,[g("div",A,C(Ue.successRate)+"%",1),o[6]||(o[6]=g("div",{class:"stats-label"},"成功率",-1))])]),g("div",j,[g("div",E,[b(u,null,{default:w(()=>[b(x(s))]),_:1})]),g("div",F,[g("div",I,"¥"+C(Ue.totalCost.toLocaleString()),1),o[7]||(o[7]=g("div",{class:"stats-label"},"总费用",-1))])]),g("div",T,[g("div",N,[b(u,null,{default:w(()=>[b(x(i))]),_:1})]),g("div",B,[g("div",P,C(Ue.dailyUsage.toLocaleString()),1),o[8]||(o[8]=g("div",{class:"stats-label"},"日均发送",-1))])])])),[[je,M.value]]),g("div",X,[b(Ce,{gutter:20},{default:w(()=>[b(xe,{span:12},{default:w(()=>[g("div",G,[g("div",Z,[o[12]||(o[12]=g("h3",null,"发送趋势",-1)),b(Se,{modelValue:pe.value,"onUpdate:modelValue":o[1]||(o[1]=e=>pe.value=e),onChange:ke},{default:w(()=>[b(ye,{label:"daily"},{default:w(()=>[...o[9]||(o[9]=[S("按天",-1)])]),_:1}),b(ye,{label:"weekly"},{default:w(()=>[...o[10]||(o[10]=[S("按周",-1)])]),_:1}),b(ye,{label:"monthly"},{default:w(()=>[...o[11]||(o[11]=[S("按月",-1)])]),_:1})]),_:1},8,["modelValue"])]),g("div",$,[g("div",{ref_key:"trendChartRef",ref:ge,style:{width:"100%",height:"300px"}},null,512)])])]),_:1}),b(xe,{span:12},{default:w(()=>[g("div",H,[o[13]||(o[13]=g("div",{class:"chart-header"},[g("h3",null,"模板使用统计")],-1)),g("div",J,[g("div",{ref_key:"templateChartRef",ref:_e,style:{width:"100%",height:"300px"}},null,512)])])]),_:1})]),_:1}),b(Ce,{gutter:20,style:{"margin-top":"20px"}},{default:w(()=>[b(xe,{span:12},{default:w(()=>[g("div",K,[o[14]||(o[14]=g("div",{class:"chart-header"},[g("h3",null,"成功率分析")],-1)),g("div",Q,[g("div",{ref_key:"successChartRef",ref:be,style:{width:"100%",height:"300px"}},null,512)])])]),_:1}),b(xe,{span:12},{default:w(()=>[g("div",W,[o[15]||(o[15]=g("div",{class:"chart-header"},[g("h3",null,"费用分析")],-1)),g("div",ee,[g("div",{ref_key:"costChartRef",ref:we,style:{width:"100%",height:"300px"}},null,512)])])]),_:1})]),_:1})]),g("div",te,[o[17]||(o[17]=g("div",{class:"section-header"},[g("h3",null,"模板使用详情")],-1)),b(qe,{data:Ue.templateUsage,border:"",stripe:""},{default:w(()=>[b(Me,{prop:"templateName",label:"模板名称","min-width":"200"}),b(Me,{prop:"count",label:"使用次数",width:"120",align:"center"},{default:w(({row:e})=>[b(Le,{type:"primary"},{default:w(()=>[S(C(e.count.toLocaleString()),1)]),_:2},1024)]),_:1}),b(Me,{label:"使用占比",width:"120",align:"center"},{default:w(({row:e})=>[g("span",null,C(Ye(e.count))+"%",1)]),_:1}),b(Me,{label:"费用估算",width:"120",align:"center"},{default:w(({row:e})=>[g("span",ae,"¥"+C((.05*e.count).toFixed(2)),1)]),_:1}),b(Me,{label:"操作",width:"100",align:"center"},{default:w(({row:e})=>[b(m,{type:"text",size:"small",onClick:t=>{return a=e,void r.info(`查看模板 "${a.templateName}" 的详细信息`);var a}},{default:w(()=>[...o[16]||(o[16]=[S(" 查看详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),g("div",le,[g("div",se,[o[18]||(o[18]=g("h3",null,"实时数据",-1)),b(Ae,{modelValue:fe.value,"onUpdate:modelValue":o[2]||(o[2]=e=>fe.value=e),"active-text":"实时更新",onChange:Re},null,8,["modelValue"])]),g("div",ie,[g("div",re,[o[19]||(o[19]=g("div",{class:"realtime-label"},"今日发送",-1)),g("div",ne,C(De.todaySent),1)]),g("div",oe,[o[20]||(o[20]=g("div",{class:"realtime-label"},"当前在线",-1)),g("div",de,C(De.onlineUsers),1)]),g("div",ce,[o[21]||(o[21]=g("div",{class:"realtime-label"},"队列待发",-1)),g("div",ue,C(De.queueCount),1)]),g("div",me,[o[22]||(o[22]=g("div",{class:"realtime-label"},"系统状态",-1)),g("div",ve,[b(Le,{type:"normal"===De.systemStatus?"success":"danger"},{default:w(()=>[S(C("normal"===De.systemStatus?"正常":"异常"),1)]),_:1},8,["type"])])])])])])}}}),[["__scopeId","data-v-0f1dea98"]]);export{he as default};
