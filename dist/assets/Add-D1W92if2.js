var pt=Object.defineProperty,ft=Object.defineProperties;var vt=Object.getOwnPropertyDescriptors;var Ae=Object.getOwnPropertySymbols;var _t=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable;var xe=(A,h,y)=>h in A?pt(A,h,{enumerable:!0,configurable:!0,writable:!0,value:y}):A[h]=y,Se=(A,h)=>{for(var y in h||(h={}))_t.call(h,y)&&xe(A,y,h[y]);if(Ae)for(var y of Ae(h))gt.call(h,y)&&xe(A,y,h[y]);return A},Pe=(A,h)=>ft(A,vt(h));var N=(A,h,y)=>new Promise((H,K)=>{var R=U=>{try{B(y.next(U))}catch(x){K(x)}},E=U=>{try{B(y.throw(U))}catch(x){K(x)}},B=U=>U.done?H(U.value):Promise.resolve(U.value).then(R,E);B((y=y.apply(A,h)).next())});import{l as ht,az as yt,aC as bt,r as f,e as D,Z as Ie,c as kt,ag as _,m as V,p as g,q as s,U as t,M as W,Q as M,T as m,O as a,F as Y,a9 as ee,u as p,S as v,a8 as wt,a2 as qe,P as Ct,V as Vt}from"./vendor-D8Vxqhr-.js";import{E as i,m as At,p as Te,ad as xt,F as St,s as Pt,v as It,a4 as qt,r as $e,K as Fe,u as Tt,ae as $t,af as Ft,q as Ut,ag as zt,b as Nt}from"./elementPlus-Bmwh7Rh8.js";import{j as Dt,t as Mt,u as Rt,g as Et,i as Bt,S as Lt,c as Wt,_ as Ot}from"./settings-CuxbDWOu.js";import{u as jt}from"./product-DLyzXkG9.js";import{m as Ue}from"./phone-DsAzMHsn.js";import{d as Ht}from"./sensitiveInfo-BWt1a88R.js";import"./utils-ywHRn0uI.js";const Kt={class:"order-form"},Zt={class:"page-header"},Qt={class:"card-header"},Gt={class:"header-left"},Jt={key:0,class:"delivery-info"},Xt={class:"phone-management"},Yt={class:"card-header"},es={class:"header-left"},ts={class:"product-search"},ss={class:"product-list"},os=["onClick"],ls={class:"product-image"},as=["src","alt"],ns={class:"product-info"},rs={class:"product-name"},is={class:"product-price"},ds={class:"product-stock"},us={class:"product-actions"},cs={class:"card-header"},ms={class:"header-left"},ps={key:0,class:"selected-products"},fs={class:"amount-summary-modern"},vs={class:"amount-row"},_s={class:"amount-field"},gs={class:"field-amount subtotal"},hs={class:"amount-field"},ys={class:"field-label"},bs={class:"amount-field"},ks={class:"amount-row"},ws={class:"amount-field"},Cs={class:"field-amount collect"},Vs={class:"amount-field"},As={class:"discount-horizontal"},xs={class:"field-amount discount"},Ss={key:0,class:"discount-percent"},Ps={class:"amount-field screenshot-field"},Is={class:"screenshot-buttons"},qs={class:"screenshot-content"},Ts={key:0,class:"screenshot-thumbnails"},$s=["onMouseenter","onClick"],Fs=["src"],Us={class:"thumbnail-overlay"},zs=["onClick"],Ns={class:"mark-section"},Ds={class:"mark-description"},Ms={class:"remark-section"},Rs={class:"form-footer"},Es={class:"order-confirm"},Bs={class:"confirm-section customer-info"},Ls={class:"info-grid"},Ws={class:"info-item"},Os={class:"value"},js={class:"info-item"},Hs={class:"value"},Ks={class:"info-item"},Zs={class:"value"},Qs={class:"info-item"},Gs={class:"value"},Js={class:"info-item"},Xs={class:"value"},Ys={class:"confirm-section order-mark"},eo={class:"mark-content"},to={class:"mark-item"},so={key:0,class:"mark-note"},oo={class:"confirm-section amount-info"},lo={class:"amount-summary-two-columns"},ao={class:"amount-column basic-amounts"},no={class:"amount-item"},ro={class:"value"},io={class:"amount-item"},uo={class:"discount-info"},co={class:"value discount"},mo={key:0,class:"discount-percent"},po={class:"amount-column important-amounts"},fo={class:"amount-item highlight total-amount"},vo={class:"value"},_o={class:"amount-item highlight deposit-amount"},go={class:"value"},ho={class:"amount-item highlight collect-amount"},yo={class:"value"},bo={class:"confirm-section product-info"},ko={class:"dialog-footer"},wo={class:"dialog-footer"},Co=ht({__name:"Add",setup(A){const h=yt(),y=bt(),H=Wt(h),K=Dt(),R=Mt(),E=Rt(),B=Et(),U=Bt(),x=jt(),ie=f(),te=f(!1),de=f(!1),ze=f(!1),se=f(!1),L=f(!1),Ne=f(!1),Z=f(""),oe=f(!1),ue=f([]),ce=D(()=>R.customers),me=D(()=>x.products.filter(o=>o.status==="active"&&!o.isDeleted&&o.stock>0).map(o=>({id:o.id,name:o.name,code:o.code,price:o.price,originalPrice:o.originalPrice,stock:o.stock,category:o.category,image:o.image,isHot:o.isHot}))),w=f(null),le=f([]),O=f(!1),pe=f(),Q=f(!1),S=Ie({phone:"",remark:""}),De={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}]},l=Ie({customerId:"",serviceWechat:"",orderSource:"",receiverName:"",receiverPhone:"",receiverAddress:"",expressCompany:"",products:[],discount:0,totalAmount:0,depositAmount:0,depositScreenshot:"",markType:"normal",remark:""}),Me={customerId:[{required:!0,message:"请选择客户",trigger:"change"}],serviceWechat:[{required:!0,message:"请输入客服微信号",trigger:"blur"}],orderSource:[{required:!0,message:"请选择订单来源",trigger:"change"}],expressCompany:[{required:!0,message:"请选择快递公司",trigger:"change"}],receiverName:[{required:!0,message:"请输入收货人姓名",trigger:"blur"}],receiverPhone:[{required:!0,message:"请输入收货人电话",trigger:"blur"}],receiverAddress:[{required:!0,message:"请输入收货地址",trigger:"blur"}],markType:[{required:!0,message:"请选择订单类型",trigger:"change"}]},P=f([]),ae=f(-1),fe=D(()=>{var r;const o=((r=E.currentUser)==null?void 0:r.role)||"employee",e=o==="employee"?"sales":o;return U.getMaxDiscountForRole(e)/100}),G=f(!1),I=D(()=>l.products.reduce((o,e)=>o+(e.price||0)*(e.quantity||0),0)),ve=D(()=>(l.totalAmount||0)-(l.depositAmount||0)),j=D(()=>I.value-(l.totalAmount||0)),_e=D(()=>I.value===0?0:j.value/I.value*100),Re=D(()=>Z.value?me.value.filter(o=>o.name.toLowerCase().includes(Z.value.toLowerCase())):me.value);f("");const Ee=o=>{o&&(te.value=!0,setTimeout(()=>{te.value=!1},300))},Be=o=>{const e=ce.value.find(r=>r.id===o);e&&(w.value=e,l.receiverName=e.name,l.receiverAddress=e.address,Le())},Le=o=>N(this,null,function*(){var e;try{const r=[{id:1,number:((e=w.value)==null?void 0:e.phone)||"",remark:"默认手机号",isDefault:!0}];le.value=r,r.length>0&&(l.receiverPhone=r[0].number)}catch(r){i.error("加载客户手机号失败")}}),We=()=>N(this,null,function*(){try{yield pe.value.validate(),Q.value=!0,setTimeout(()=>{const o={id:Date.now(),number:S.phone,remark:S.remark||"新增手机号",isDefault:!1};le.value.push(o),S.phone="",S.remark="",O.value=!1,Q.value=!1,i.success("手机号添加成功")},1e3)}catch(o){Q.value=!1}}),ge=()=>{S.phone="",S.remark="",O.value=!1},Oe=()=>{w.value&&(l.receiverAddress=w.value.address,i.success("已同步客户地址"))},je=()=>{},He=()=>N(this,null,function*(){try{de.value=!0,yield x.refreshProducts(),i.success("商品列表已刷新，已同步在售产品")}catch(o){i.error("刷新商品列表失败，请检查网络连接"),console.error("刷新商品失败:",o)}finally{de.value=!1}}),Ke=o=>{const e=l.products.find(r=>r.id===o.id);e?e.quantity<o.stock?(e.quantity++,e.total=e.price*e.quantity,J(),i.success(`${o.name} 数量已增加`)):i.warning("库存不足"):(l.products.push(Pe(Se({},o),{quantity:1,total:o.price*1})),J(),i.success(`${o.name} 已添加到订单`))},Ze=o=>{H.push(`/product/detail/${o.id}`)},Qe=o=>{const e=l.products[o];l.products.splice(o,1),J(),i.success(`${e.name} 已从订单中移除`)},J=()=>{l.products.forEach(o=>{o.total=o.price*o.quantity}),G.value||(l.totalAmount=I.value)},Ge=()=>{},Je=o=>{if(G.value=!0,o>I.value){i.warning("订单总额不能超过商品小计"),l.totalAmount=I.value;return}if(o<0){i.warning("订单总额不能小于0"),l.totalAmount=0;return}const e=I.value*(1-fe.value);if(o<e){Nt.alert(`订单总额不能低于 ¥${e.toFixed(2)}（最大优惠${(fe.value*100).toFixed(0)}%）`,"优惠限制提示",{confirmButtonText:"确定",type:"warning"}),l.totalAmount=e;return}l.depositAmount>o&&(l.depositAmount=o,i.info("定金已自动调整为订单总额"))},Xe=()=>{G.value=!1,l.totalAmount=I.value,i.success("订单总额已同步为商品小计")},he=f(),Ye=()=>{var o;(o=he.value)==null||o.click()},et=o=>{const e=o.target,r=e.files;if(r){for(let d=0;d<r.length;d++){if(P.value.length>=3){i.warning("最多只能上传3张图片");break}ye(r[d])}e.value=""}},tt=()=>N(this,null,function*(){if(P.value.length>=3){i.warning("最多只能上传3张图片");return}try{const o=yield navigator.clipboard.read();for(const e of o)for(const r of e.types)if(r.startsWith("image/")){const d=yield e.getType(r),k=new File([d],"pasted-image.png",{type:r});ye(k);return}i.warning("剪贴板中没有图片")}catch(o){i.error("粘贴图片失败，请检查浏览器权限")}}),ye=o=>{if(!lt(o))return;if(P.value.length>=3){i.warning("最多只能上传3张图片");return}const e=new FileReader;e.onload=r=>{var k;const d=(k=r.target)==null?void 0:k.result;P.value.push(d),l.depositScreenshot=P.value[0]||"",i.success("图片已添加")},e.readAsDataURL(o)},st=o=>{P.value.splice(o,1),l.depositScreenshot=P.value[0]||"",i.success("图片已删除")},ot=o=>{const e=o||l.depositScreenshot;e&&(ue.value=[e],oe.value=!0)},lt=o=>{const e=o.type.startsWith("image/"),r=o.size/1024/1024<2;return e?r?!0:(i.error("图片大小不能超过 2MB!"),!1):(i.error("只能上传图片文件!"),!1)},at=o=>{o==="reserved"?i.info("已选择预留单，订单将保留在您处，不会流转到审核员"):i.info("已选择正常发货单，订单将按正常流程进行审核")},nt=()=>N(this,null,function*(){try{if(yield ie.value.validate(),l.products.length===0){i.warning("请至少选择一个商品");return}L.value=!0}catch(o){i.error("请完善订单信息")}}),rt=()=>N(this,null,function*(){var o,e,r,d;try{se.value=!0;for(const c of l.products){const F=x.products.find(T=>T.id===c.id);if(!F){i.error(`商品 ${c.name} 不存在`);return}if(F.stock<c.quantity){i.error(`商品 ${c.name} 库存不足，当前库存：${F.stock}，需要：${c.quantity}`);return}}const k=l.products.reduce((c,F)=>c+(F.price*F.quantity||0),0),u=k-(l.discount||0),b=u-(l.depositAmount||0),C={customerId:l.customerId,customerName:((o=w.value)==null?void 0:o.name)||"",customerPhone:((e=w.value)==null?void 0:e.phone)||"",products:l.products,subtotal:k,discount:l.discount,totalAmount:u,collectAmount:b,depositAmount:l.depositAmount,depositScreenshot:l.depositScreenshot,depositScreenshots:P.value.length>0?P.value:void 0,receiverName:l.receiverName,receiverPhone:l.receiverPhone,receiverAddress:l.receiverAddress,markType:l.markType,remark:l.remark,salesPersonId:((r=E.user)==null?void 0:r.id)||"1",createdBy:((d=E.user)==null?void 0:d.name)||"系统用户"},q=yield K.createOrder(C);for(const c of l.products)yield x.updateProductStock(c.id,-c.quantity);C.customerId&&R.incrementOrderCount(C.customerId),B.sendMessage(B.MessageType.ORDER_SUBMITTED,`新订单已提交：客户 ${C.customerName}，订单金额 ¥${u.toFixed(2)}`,{relatedId:(q==null?void 0:q.id)||Date.now().toString(),relatedType:"order",actionUrl:`/order/detail/${(q==null?void 0:q.id)||Date.now().toString()}`}),C.markType==="normal"?i.success("订单已提交，该订单3分钟后将流转至审核"):C.markType==="reserved"?i.success("预留单已保存，信息将保留在系统中"):i.success("订单已提交"),L.value=!1,H.push({path:"/order/list",query:{refresh:"true",timestamp:Date.now().toString()}})}catch(k){i.error("提交失败，请重试")}finally{se.value=!1}}),it=()=>{L.value=!1},dt=()=>{h.back()},ut=o=>({sf:"顺丰速运",yt:"圆通速递",zt:"中通快递",st:"申通快递",yd:"韵达速递",bs:"百世快递",db:"德邦快递",jd:"京东物流"})[o]||o;return kt(()=>N(this,null,function*(){yield R.loadCustomers(),x.products.length===0&&x.initMockData();const{customerId:o,customerName:e,customerPhone:r,customerAddress:d,productId:k}=y.query;if(o){let u=R.customers.find(b=>b.id===o);u?(l.customerId=u.id,l.receiverName=u.name,l.receiverPhone=u.phone,l.receiverAddress=u.address||"",w.value=u,i.success(`已自动选择客户：${u.name}`)):e&&r?(l.customerId=o,l.receiverName=e,l.receiverPhone=r,l.receiverAddress=d||"",u={id:o,name:e,phone:r,address:d||"",age:0,level:"normal",salesPersonId:"",orderCount:0,createTime:"",createdBy:""},w.value=u,i.success(`已自动选择客户：${e}`)):i.warning("未找到指定的客户信息，请手动选择客户")}if(k){const u=x.products.find(b=>b.id===k);if(u){const b={id:u.id,name:u.name,price:u.price,quantity:1,total:u.price};l.products.push(b),i.success(`已自动添加商品：${u.name}`)}else i.warning("未找到指定的商品信息")}})),(o,e)=>{const r=_("el-icon"),d=_("el-option"),k=_("el-select"),u=_("el-form-item"),b=_("el-col"),C=_("el-input"),q=_("el-row"),c=_("el-button"),F=_("el-card"),T=_("el-table-column"),ne=_("el-input-number"),be=_("el-table"),ct=_("el-tooltip"),re=_("el-tag"),ke=_("el-radio"),mt=_("el-radio-group"),we=_("el-alert"),Ce=_("el-form"),Ve=_("el-dialog");return g(),V("div",Kt,[s("div",Zt,[s("h2",null,m(Ne.value?"编辑订单":"新增订单"),1)]),t(Ce,{model:l,rules:Me,ref_key:"orderFormRef",ref:ie,"label-width":"120px"},{default:a(()=>[t(F,{class:"customer-card"},{header:a(()=>[s("div",Qt,[s("div",Gt,[t(r,null,{default:a(()=>[t(p(St))]),_:1}),e[20]||(e[20]=s("span",null,"客户信息",-1))])])]),default:a(()=>[t(q,{gutter:20},{default:a(()=>[t(b,{span:8},{default:a(()=>[t(u,{label:"选择客户",prop:"customerId",required:""},{default:a(()=>[t(k,{modelValue:l.customerId,"onUpdate:modelValue":e[0]||(e[0]=n=>l.customerId=n),placeholder:"请选择客户",style:{width:"100%"},filterable:"",remote:"","remote-method":Ee,loading:te.value,onChange:Be,size:"large"},{default:a(()=>[(g(!0),V(Y,null,ee(ce.value,n=>(g(),W(d,{key:n.id,label:`${n.name} (${p(Ue)(n.phone)})`,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1}),t(b,{span:8},{default:a(()=>[t(u,{label:"客服微信号",prop:"serviceWechat",required:""},{default:a(()=>[t(C,{modelValue:l.serviceWechat,"onUpdate:modelValue":e[1]||(e[1]=n=>l.serviceWechat=n),placeholder:"请输入负责客服的微信号",clearable:""},{prefix:a(()=>[t(r,null,{default:a(()=>[t(p(At))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(b,{span:8},{default:a(()=>[t(u,{label:"订单来源",prop:"orderSource",required:""},{default:a(()=>[t(k,{modelValue:l.orderSource,"onUpdate:modelValue":e[2]||(e[2]=n=>l.orderSource=n),placeholder:"请选择订单来源",style:{width:"100%"}},{default:a(()=>[t(d,{label:"🛒 线上商城",value:"online_store"}),t(d,{label:"📱 微信小程序",value:"wechat_mini"}),t(d,{label:"💬 微信客服",value:"wechat_service"}),t(d,{label:"📞 电话咨询",value:"phone_call"}),t(d,{label:"🏪 线下门店",value:"offline_store"}),t(d,{label:"👥 客户推荐",value:"referral"}),t(d,{label:"📺 广告投放",value:"advertisement"}),t(d,{label:"🎯 其他渠道",value:"other"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),w.value?(g(),V("div",Jt,[e[22]||(e[22]=s("h4",null,"收货信息",-1)),t(q,{gutter:20},{default:a(()=>[t(b,{span:6},{default:a(()=>[t(u,{label:"收货人",prop:"receiverName"},{default:a(()=>[t(C,{modelValue:l.receiverName,"onUpdate:modelValue":e[3]||(e[3]=n=>l.receiverName=n),placeholder:"请输入收货人姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(b,{span:12},{default:a(()=>[t(u,{label:"收货电话",prop:"receiverPhone"},{default:a(()=>[s("div",Xt,[t(k,{modelValue:l.receiverPhone,"onUpdate:modelValue":e[4]||(e[4]=n=>l.receiverPhone=n),placeholder:"请选择收货电话",style:{width:"100%"},clearable:""},{default:a(()=>[(g(!0),V(Y,null,ee(le.value,n=>(g(),W(d,{key:n.id,label:p(Ue)(n.number),value:n.number},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(c,{type:"primary",size:"small",onClick:e[5]||(e[5]=n=>O.value=!0),style:{"margin-left":"8px"},icon:p(Te)},{default:a(()=>[...e[21]||(e[21]=[v(" 新增 ",-1)])]),_:1},8,["icon"])])]),_:1})]),_:1}),t(b,{span:6},{default:a(()=>[t(u,{label:"指定快递",prop:"expressCompany",required:""},{default:a(()=>[t(k,{modelValue:l.expressCompany,"onUpdate:modelValue":e[6]||(e[6]=n=>l.expressCompany=n),placeholder:"请选择快递公司",style:{width:"100%"}},{default:a(()=>[t(d,{label:"顺丰速运",value:"sf"}),t(d,{label:"圆通速递",value:"yt"}),t(d,{label:"中通快递",value:"zt"}),t(d,{label:"申通快递",value:"st"}),t(d,{label:"韵达速递",value:"yd"}),t(d,{label:"百世快递",value:"bs"}),t(d,{label:"德邦快递",value:"db"}),t(d,{label:"京东物流",value:"jd"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(q,null,{default:a(()=>[t(b,{span:24},{default:a(()=>[t(u,{label:"收货地址",prop:"receiverAddress"},{default:a(()=>[t(C,{modelValue:l.receiverAddress,"onUpdate:modelValue":e[7]||(e[7]=n=>l.receiverAddress=n),placeholder:"请输入详细收货地址",clearable:""},wt({_:2},[w.value&&w.value.address?{name:"suffix",fn:a(()=>[t(c,{size:"small",type:"text",onClick:Oe,title:"同步客户地址"},{default:a(()=>[t(r,null,{default:a(()=>[t(p(xt))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["modelValue"])]),_:1})]),_:1})]),_:1})])):M("",!0)]),_:1}),t(F,{class:"product-card"},{header:a(()=>[s("div",Yt,[s("div",es,[t(r,null,{default:a(()=>[t(p(qt))]),_:1}),e[23]||(e[23]=s("span",null,"产品选择",-1))]),t(c,{type:"primary",size:"small",icon:p($e),onClick:He,title:"刷新商品列表"},{default:a(()=>[...e[24]||(e[24]=[v(" 刷新 ",-1)])]),_:1},8,["icon"])])]),default:a(()=>[s("div",ts,[t(C,{modelValue:Z.value,"onUpdate:modelValue":e[8]||(e[8]=n=>Z.value=n),placeholder:"搜索产品名称、编号...",size:"large",clearable:"",onInput:je},{prefix:a(()=>[t(r,null,{default:a(()=>[t(p(Pt))]),_:1})]),_:1},8,["modelValue"])]),s("div",ss,[(g(!0),V(Y,null,ee(Re.value,n=>(g(),V("div",{key:n.id,class:"product-item",onClick:$=>Ke(n)},[s("div",ls,[s("img",{src:n.image||"/default-product.png",alt:n.name},null,8,as)]),s("div",ns,[s("div",rs,m(n.name),1),s("div",is,"¥"+m(n.price),1),s("div",ds,"库存: "+m(n.stock),1)]),s("div",us,[t(c,{type:"info",size:"small",icon:p(It),onClick:qe($=>Ze(n),["stop"]),title:"查看商品详情"},{default:a(()=>[...e[25]||(e[25]=[v(" 详情 ",-1)])]),_:1},8,["icon","onClick"]),t(c,{type:"primary",size:"small",icon:p(Te)},{default:a(()=>[...e[26]||(e[26]=[v("添加",-1)])]),_:1},8,["icon"])])],8,os))),128))])]),_:1}),t(F,{class:"summary-card"},{header:a(()=>[s("div",cs,[s("div",ms,[t(r,null,{default:a(()=>[t(p(Ut))]),_:1}),e[27]||(e[27]=s("span",null,"订单汇总",-1))])])]),default:a(()=>[l.products.length>0?(g(),V("div",ps,[e[28]||(e[28]=s("h4",null,"已选商品",-1)),t(be,{data:l.products,style:{width:"100%"}},{default:a(()=>[t(T,{prop:"name",label:"商品名称"}),t(T,{prop:"price",label:"单价",width:"100"},{default:a(({row:n})=>[v(" ¥"+m(n.price),1)]),_:1}),t(T,{label:"数量",width:"150"},{default:a(({row:n,$index:$})=>[t(ne,{modelValue:n.quantity,"onUpdate:modelValue":z=>n.quantity=z,min:1,max:n.stock,size:"small",onChange:J},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1}),t(T,{label:"小计",width:"100"},{default:a(({row:n})=>[v(" ¥"+m(((n.price||0)*(n.quantity||0)).toFixed(2)),1)]),_:1}),t(T,{label:"操作",width:"80"},{default:a(({$index:n})=>[t(c,{type:"danger",size:"small",icon:p(Fe),onClick:$=>Qe(n)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])])):M("",!0),s("div",fs,[s("div",vs,[s("div",_s,[e[29]||(e[29]=s("span",{class:"field-label"},"商品小计",-1)),s("span",gs,"¥"+m(I.value.toFixed(2)),1)]),s("div",hs,[s("span",ys,[e[30]||(e[30]=v(" 订单总额 ",-1)),G.value?(g(),W(ct,{key:0,content:"点击同步商品小计",placement:"top"},{default:a(()=>[t(c,{type:"text",size:"small",icon:p($e),onClick:Xe,class:"sync-button"},null,8,["icon"])]),_:1})):M("",!0)]),t(ne,{modelValue:l.totalAmount,"onUpdate:modelValue":e[9]||(e[9]=n=>l.totalAmount=n),min:0,max:I.value,precision:2,placeholder:"订单总额",class:"field-input",onChange:Je},null,8,["modelValue","max"])]),s("div",bs,[e[31]||(e[31]=s("span",{class:"field-label"},"定金",-1)),t(ne,{modelValue:l.depositAmount,"onUpdate:modelValue":e[10]||(e[10]=n=>l.depositAmount=n),min:0,max:l.totalAmount||0,precision:2,placeholder:"定金金额",class:"field-input",onChange:Ge},null,8,["modelValue","max"])])]),s("div",ks,[s("div",ws,[e[32]||(e[32]=s("span",{class:"field-label"},"代收金额",-1)),s("span",Cs,"¥"+m(ve.value.toFixed(2)),1)]),s("div",Vs,[e[33]||(e[33]=s("span",{class:"field-label"},"优惠金额",-1)),s("div",As,[s("span",xs,"¥"+m(j.value.toFixed(2)),1),j.value>0?(g(),V("span",Ss," ("+m(_e.value.toFixed(1))+"%) ",1)):M("",!0)])]),s("div",Ps,[e[36]||(e[36]=s("span",{class:"field-label"},"定金截图",-1)),s("div",Is,[t(c,{type:"primary",size:"small",icon:p(Tt),onClick:Ye},{default:a(()=>[...e[34]||(e[34]=[v(" 上传截图 ",-1)])]),_:1},8,["icon"]),t(c,{type:"success",size:"small",icon:p($t),onClick:tt},{default:a(()=>[...e[35]||(e[35]=[v(" 粘贴图片 ",-1)])]),_:1},8,["icon"])]),s("div",qs,[P.value.length>0?(g(),V("div",Ts,[(g(!0),V(Y,null,ee(P.value,(n,$)=>(g(),V("div",{key:$,class:"thumbnail-item",onMouseenter:z=>ae.value=$,onMouseleave:e[11]||(e[11]=z=>ae.value=-1),onClick:z=>ot(n)},[s("img",{src:n,alt:"定金截图"},null,8,Fs),Ct(s("div",Us,[t(r,{class:"zoom-icon"},{default:a(()=>[t(p(Ft))]),_:1})],512),[[Vt,ae.value===$]]),s("div",{class:"thumbnail-delete",onClick:qe(z=>st($),["stop"])},[t(r,null,{default:a(()=>[t(p(Fe))]),_:1})],8,zs)],40,$s))),128))])):M("",!0)]),s("input",{ref_key:"fileInput",ref:he,type:"file",accept:"image/*",multiple:"",style:{display:"none"},onChange:et},null,544)])])]),s("div",Ns,[e[39]||(e[39]=s("h4",null,"订单标记",-1)),t(q,{gutter:20},{default:a(()=>[t(b,{span:12},{default:a(()=>[t(u,{label:"订单类型",prop:"markType",required:""},{default:a(()=>[t(mt,{modelValue:l.markType,"onUpdate:modelValue":e[12]||(e[12]=n=>l.markType=n),onChange:at},{default:a(()=>[t(ke,{value:"normal"},{default:a(()=>[t(re,{type:"success",size:"small"},{default:a(()=>[...e[37]||(e[37]=[v("正常发货单",-1)])]),_:1})]),_:1}),t(ke,{value:"reserved"},{default:a(()=>[t(re,{type:"warning",size:"small"},{default:a(()=>[...e[38]||(e[38]=[v("预留单",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(b,{span:12},{default:a(()=>[s("div",Ds,[l.markType==="reserved"?(g(),W(we,{key:0,title:"预留单说明",description:"预留单将保留在下单人处，不会流转到审核员。需要修改为正常发货单后才会进入审核流程。",type:"warning",closable:!1,"show-icon":""})):(g(),W(we,{key:1,title:"正常发货单",description:"订单将按正常流程进行审核和发货处理。",type:"success",closable:!1,"show-icon":""}))])]),_:1})]),_:1})]),s("div",Ms,[t(u,{label:"订单备注"},{default:a(()=>[t(C,{modelValue:l.remark,"onUpdate:modelValue":e[13]||(e[13]=n=>l.remark=n),type:"textarea",rows:3,placeholder:"请输入订单备注信息"},null,8,["modelValue"])]),_:1})]),s("div",Rs,[t(c,{onClick:dt,size:"large"},{default:a(()=>[...e[40]||(e[40]=[v("取消",-1)])]),_:1}),t(c,{onClick:nt,type:"primary",size:"large",loading:ze.value},{default:a(()=>[...e[41]||(e[41]=[v(" 保存订单 ",-1)])]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model"]),t(Ve,{modelValue:L.value,"onUpdate:modelValue":e[15]||(e[15]=n=>L.value=n),title:"订单确认",width:"600px","before-close":it},{footer:a(()=>[s("span",ko,[t(c,{onClick:e[14]||(e[14]=n=>L.value=!1)},{default:a(()=>[...e[58]||(e[58]=[v("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:rt,loading:se.value},{default:a(()=>[...e[59]||(e[59]=[v(" 确认提交审核 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>{var n,$,z;return[s("div",Es,[e[57]||(e[57]=s("h4",null,"请确认以下订单信息：",-1)),s("div",Bs,[e[47]||(e[47]=s("h5",null,"客户信息",-1)),s("div",Ls,[s("div",Ws,[e[42]||(e[42]=s("span",{class:"label"},"客户：",-1)),s("span",Os,m((n=w.value)==null?void 0:n.name),1)]),s("div",js,[e[43]||(e[43]=s("span",{class:"label"},"电话：",-1)),s("span",Hs,m(($=w.value)!=null&&$.phone?p(Ht)(w.value.phone,p(Lt).PHONE,((z=p(E).currentUser)==null?void 0:z.id)||""):""),1)]),s("div",Ks,[e[44]||(e[44]=s("span",{class:"label"},"收货人：",-1)),s("span",Zs,m(l.receiverName),1)]),s("div",Qs,[e[45]||(e[45]=s("span",{class:"label"},"收货地址：",-1)),s("span",Gs,m(l.receiverAddress),1)]),s("div",Js,[e[46]||(e[46]=s("span",{class:"label"},"快递公司：",-1)),s("span",Xs,m(ut(l.expressCompany)),1)])])]),s("div",Ys,[e[49]||(e[49]=s("h5",null,"订单标记",-1)),s("div",eo,[s("div",to,[e[48]||(e[48]=s("span",{class:"label"},"订单类型：",-1)),t(re,{type:l.markType==="normal"?"success":"warning",size:"small"},{default:a(()=>[v(m(l.markType==="normal"?"正常发货单":"预留单"),1)]),_:1},8,["type"])]),l.markType==="reserved"?(g(),V("div",so," * 预留单将保留在您处，不会流转到审核员 ")):M("",!0)])]),s("div",oo,[e[55]||(e[55]=s("h5",null,"金额汇总",-1)),s("div",lo,[s("div",ao,[s("div",no,[e[50]||(e[50]=s("span",{class:"label"},"商品小计",-1)),s("span",ro,"¥"+m(I.value.toFixed(2)),1)]),s("div",io,[e[51]||(e[51]=s("span",{class:"label"},"优惠金额",-1)),s("div",uo,[s("span",co,"¥"+m(j.value.toFixed(2)),1),j.value>0?(g(),V("span",mo," ("+m(_e.value.toFixed(1))+"%) ",1)):M("",!0)])])]),s("div",po,[s("div",fo,[e[52]||(e[52]=s("span",{class:"label"},"订单总额",-1)),s("span",vo,"¥"+m((l.totalAmount||0).toFixed(2)),1)]),s("div",_o,[e[53]||(e[53]=s("span",{class:"label"},"定金",-1)),s("span",go,"¥"+m((l.depositAmount||0).toFixed(2)),1)]),s("div",ho,[e[54]||(e[54]=s("span",{class:"label"},"代收金额",-1)),s("span",yo,"¥"+m(ve.value.toFixed(2)),1)])])])]),s("div",bo,[e[56]||(e[56]=s("h5",null,"商品信息",-1)),t(be,{data:l.products,size:"small"},{default:a(()=>[t(T,{prop:"name",label:"商品名称"}),t(T,{prop:"price",label:"单价",width:"80"},{default:a(({row:X})=>[v("¥"+m(X.price),1)]),_:1}),t(T,{prop:"quantity",label:"数量",width:"60"}),t(T,{label:"小计",width:"80"},{default:a(({row:X})=>[v("¥"+m(((X.price||0)*(X.quantity||0)).toFixed(2)),1)]),_:1})]),_:1},8,["data"])])])]}),_:1},8,["modelValue"]),t(Ve,{modelValue:O.value,"onUpdate:modelValue":e[18]||(e[18]=n=>O.value=n),title:"新增手机号",width:"400px","before-close":ge},{footer:a(()=>[s("span",wo,[t(c,{onClick:ge},{default:a(()=>[...e[60]||(e[60]=[v("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:We,loading:Q.value},{default:a(()=>[...e[61]||(e[61]=[v(" 确认添加 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(Ce,{ref_key:"addPhoneFormRef",ref:pe,model:S,rules:De,"label-width":"80px"},{default:a(()=>[t(u,{label:"手机号",prop:"phone"},{default:a(()=>[t(C,{modelValue:S.phone,"onUpdate:modelValue":e[16]||(e[16]=n=>S.phone=n),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1}),t(u,{label:"备注",prop:"remark"},{default:a(()=>[t(C,{modelValue:S.remark,"onUpdate:modelValue":e[17]||(e[17]=n=>S.remark=n),placeholder:"请输入备注（可选）",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),oe.value?(g(),W(p(zt),{key:0,"url-list":ue.value,onClose:e[19]||(e[19]=n=>oe.value=!1)},null,8,["url-list"])):M("",!0)])}}}),$o=Ot(Co,[["__scopeId","data-v-48cf72d2"]]);export{$o as default};
