const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/uploadService-C3xZb1GB.js","assets/index-DkAJPKqn.js","assets/vendor-BtukhyiH.js","assets/elementPlus-DxaqjplL.js","assets/utils-DfI7e5Rl.js","assets/index-Cj-RrGL6.css"])))=>i.map(i=>d[i]);
import{l as e,_ as a}from"./index-DkAJPKqn.js";import{l as t,r as l,Z as o,e as r,b as c,w as u,ag as s,aq as i,m as d,q as n,p,U as m,O as f,S as g,u as v,T as k,J as y,M as h,a7 as w,F as _,a9 as S,P as b,Q as V}from"./vendor-BtukhyiH.js";import{Q as x,e as C,G as j,R as P,ay as U,k as z,P as I,I as N,H as T,al as O,a2 as F,C as q,E as Q}from"./elementPlus-DxaqjplL.js";import{u as $}from"./product-BDuYhoXd.js";import"./utils-DfI7e5Rl.js";import"./env-DLalhsF6.js";const R={class:"stock-container"},D={class:"page-header"},L={class:"header-actions"},E={class:"metrics-grid"},A={class:"metric-content"},J={class:"metric-icon",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},M={class:"metric-info"},B={class:"metric-value"},K={class:"metric-change stable"},G={class:"metric-content"},H={class:"metric-icon",style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"}},Z={class:"metric-info"},W={class:"metric-value"},X={class:"metric-change up"},Y={class:"metric-content"},ee={class:"metric-icon",style:{background:"linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%)"}},ae={class:"metric-info"},te={class:"metric-value"},le={class:"metric-content"},oe={class:"metric-icon",style:{background:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)"}},re={class:"metric-info"},ce={class:"metric-value"},ue={class:"search-section"},se={class:"table-section"},ie={class:"product-info"},de=["src","alt"],ne={class:"pagination-section"},pe={class:"product-display"},me=["src","alt"],fe={class:"product-code"},ge={class:"current-stock"},ve={class:"unit-text"},ke={class:"result-stock"},ye={class:"dialog-footer"},he={class:"unit-text"},we={class:"unit-text"},_e={class:"dialog-footer"},Se={class:"history-header"},be={class:"product-info"},Ve=["src","alt"],xe={class:"product-details"},Ce={class:"product-name"},je={class:"product-code"},Pe={class:"current-stock"},Ue={class:"stock-change"},ze={class:"before-stock"},Ie={class:"after-stock"},Ne={class:"dialog-footer"},Te={class:"quick-add-section"},Oe=["src"],Fe={class:"excel-import-section"},qe={class:"import-actions"},Qe={key:0,class:"file-info"},$e={key:1,class:"preview-section"},Re={style:{"margin-top":"8px",color:"#909399"}},De={class:"dialog-footer"},Le=a(t({__name:"Stock",setup(a){const t=$(),Le=l(!1),Ee=l([]),Ae=l({totalProducts:0,totalStock:0,totalValue:0,lowStockCount:0,outOfStockCount:0}),Je=o({productName:"",productCode:"",categoryId:"",stockStatus:"",keyword:"",status:"",brand:"",lowStock:!1}),Me=o({page:1,pageSize:10,total:0}),Be=o({id:null,productCode:"",productName:"",image:"",currentStock:0,unit:"",adjustType:"increase",adjustQuantity:0,reason:"",remark:"",productId:""}),Ke=o({id:null,productName:"",currentStock:0,unit:"",minStock:0,maxStock:0,productId:""}),Ge={adjustType:[{required:!0,message:"请选择调整类型",trigger:"change"}],adjustQuantity:[{required:!0,message:"请输入调整数量",trigger:"blur"}],reason:[{required:!0,message:"请选择调整原因",trigger:"change"}]},He={minStock:[{required:!0,message:"请输入最低库存",trigger:"blur"}],maxStock:[{required:!0,message:"请输入最高库存",trigger:"blur"}]},Ze=l(!1),We=l(!1),Xe=l(!1),Ye=l(!1),ea=l(!1),aa=l(!1),ta=l("quick"),la=l([]),oa=l(""),ra=l([]),ca=l(),ua=l(),sa=l(),ia=l([]),da=l({}),na=l(!1),pa=l([]),ma=o({page:1,pageSize:10,total:0}),fa=r(()=>({totalProducts:Ae.value.totalProducts||0,lowStockProducts:Ae.value.lowStockCount||0,outOfStockProducts:Ae.value.outOfStockCount||0,totalStockValue:Ae.value.totalValue||0})),ga=async()=>{try{Le.value=!0;let e=t.products||[];if(Je.keyword||Je.productName){const a=(Je.keyword||Je.productName||"").toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(a)||e.code.toLowerCase().includes(a))}Je.categoryId&&(e=e.filter(e=>e.categoryId===Je.categoryId)),Je.status&&(e=e.filter(e=>e.status===Je.status)),Je.brand&&(e=e.filter(e=>e.brand===Je.brand)),Je.stockStatus&&("normal"===Je.stockStatus?e=e.filter(e=>(e.stock||0)>(e.minStock||10)):"warning"===Je.stockStatus?e=e.filter(e=>{const a=e.stock||0,t=e.minStock||10;return a>0&&a<=t}):"out_of_stock"===Je.stockStatus&&(e=e.filter(e=>0===(e.stock||0)))),Je.lowStock&&(e=e.filter(e=>e.stock<=(e.minStock||10)));const a=e.map(e=>({id:e.id,productCode:e.code,productName:e.name,category:e.categoryName||e.category,image:e.image,currentStock:e.stock,minStock:e.minStock||10,maxStock:e.maxStock||9999,unit:e.unit||"件",costPrice:e.costPrice||.7*e.price,salePrice:e.price,lastUpdateTime:e.updateTime||e.createTime}));Me.total=a.length;const l=(Me.page-1)*Me.pageSize,o=l+Me.pageSize;Ee.value=a.slice(l,o);const r=e.reduce((e,a)=>e+(a.stock||0)*(a.price||0),0),c=e.filter(e=>{const a=e.stock||0,t=e.minStock||10;return a>0&&a<=t}).length,u=e.filter(e=>0===(e.stock||0)).length;Ae.value={totalProducts:e.length,totalValue:r,lowStockCount:c,outOfStockCount:u,totalStock:e.reduce((e,a)=>e+(a.stock||0),0)}}catch(e){console.error("加载数据失败:",e),Q.error("加载数据失败")}finally{Le.value=!1}},va=()=>{Me.page=1,ga()},ka=()=>{Object.assign(Je,{productName:"",productCode:"",categoryId:"",stockStatus:"",keyword:"",status:"",brand:"",lowStock:!1}),Me.page=1,ga()},ya=e=>{Object.assign(Be,{id:e.id,productId:e.id,productCode:e.productCode,productName:e.productName,image:e.image,currentStock:e.currentStock,unit:e.unit,adjustType:"increase",adjustQuantity:0,reason:"",remark:""}),Ze.value=!0},ha=()=>{Ye.value=!0,ta.value="quick",0===la.value.length&&wa()},wa=()=>{la.value.push({image:"",name:"",code:`P${Date.now()}`,categoryId:"",unit:"件",price:0,costPrice:0,stock:0,status:"active"})},_a=()=>{const a=["商品名称*","商品编码","分类","单位","销售价*","成本价","库存*","状态"],t=[["示例商品1","P001","体重管理","件","100","70","50","上架"],["示例商品2","P002","体重管理","盒","200","140","30","上架"]];e(()=>import("./utils-DfI7e5Rl.js").then(e=>e.x),[]).then(e=>{const l=e.utils.book_new(),o=[a,...t],r=e.utils.aoa_to_sheet(o);r["!cols"]=[{wch:20},{wch:15},{wch:15},{wch:10},{wch:12},{wch:12},{wch:10},{wch:10}],e.utils.book_append_sheet(l,r,"商品导入模板"),e.writeFile(l,"商品导入模板.xlsx"),Q.success("模板下载成功")}).catch(()=>{Q.error("下载失败，请重试")})},Sa=a=>{oa.value=a.name;const t=new FileReader;t.onload=a=>{try{e(()=>import("./utils-DfI7e5Rl.js").then(e=>e.x),[]).then(e=>{const t=new Uint8Array(a.target?.result),l=e.read(t,{type:"array"}),o=l.Sheets[l.SheetNames[0]],r=e.utils.sheet_to_json(o,{header:1}),c=[];for(let a=1;a<r.length;a++){const e=r[a];e&&0!==e.length&&c.push({name:String(e[0]||"").trim(),code:String(e[1]||"").trim()||`P${Date.now()+a}`,categoryName:String(e[2]||"").trim(),unit:String(e[3]||"").trim()||"件",price:parseFloat(e[4])||0,costPrice:parseFloat(e[5])||0,stock:parseInt(e[6])||0,status:"上架"===String(e[7]||"").trim()?"上架":"下架"})}ra.value=c,Q.success(`文件解析成功，共${c.length}条数据`)}).catch(e=>{console.error("文件解析失败:",e),Q.error("文件格式错误，请使用xlsx格式")})}catch(t){console.error("文件读取失败:",t),Q.error("文件读取失败")}},t.readAsArrayBuffer(a.raw)},ba=()=>{oa.value="",ra.value=[]},Va=()=>{Ye.value=!1,la.value=[],oa.value="",ra.value=[]},xa=async()=>{try{aa.value=!0;let e=[];if("quick"===ta.value){if(e=la.value.filter(e=>e.name&&e.price>0),0===e.length)return Q.warning("请至少填写一个商品的名称和价格"),void(aa.value=!1)}else{if(0===ra.value.length)return Q.warning("请先选择并解析Excel文件"),void(aa.value=!1);e=ra.value}for(const a of e){const e=a.categoryId||t.categories[0]?.id||"1",l={code:a.code||`P${Date.now()}`,name:a.name,categoryId:e,categoryName:t.categories.find(a=>a.id===e)?.name||"未分类",brand:"",specification:"",image:a.image||"https://via.placeholder.com/100",price:a.price,costPrice:a.costPrice||.7*a.price,stock:a.stock||0,minStock:10,maxStock:9999,unit:a.unit||"件",weight:0,dimensions:"",description:"",status:"active"===a.status||"上架"===a.status?"active":"inactive",salesCount:0,updateTime:(new Date).toISOString()};await t.addProduct(l)}Q.success(`成功导入${e.length}个商品`),Va(),ga()}catch(e){console.error("批量导入失败:",e),Q.error("批量导入失败")}finally{aa.value=!1}},Ca=async()=>{try{Le.value=!0;const e=Ee.value;if(0===e.length)return Q.warning("没有可导出的数据"),void(Le.value=!1);const a=["商品编码","商品名称","分类","当前库存","最低库存","最高库存","单位","成本价","销售价","库存价值","库存状态"],t=e.map(e=>[e.productCode,e.productName,e.category,e.currentStock,e.minStock,e.maxStock,e.unit,e.costPrice.toFixed(2),(e.salePrice||1.3*e.costPrice).toFixed(2),(e.currentStock*e.costPrice).toFixed(2),Ia(e)]),l=[a.join(","),...t.map(e=>e.join(","))].join("\n"),o=new Blob(["\ufeff"+l],{type:"text/csv;charset=utf-8;"}),r=window.URL.createObjectURL(o),c=document.createElement("a");c.href=r,c.download=`库存数据_${(new Date).toISOString().slice(0,10)}.csv`,c.click(),window.URL.revokeObjectURL(r),Q.success(`导出成功，共导出${e.length}条数据`)}catch(e){console.error("导出失败:",e),Q.error("导出失败")}finally{Le.value=!1}},ja=e=>{Me.pageSize=e,Me.page=1,ga()},Pa=e=>{Me.page=e,ga()},Ua=e=>e.currentStock<=0?"stock-out":e.currentStock<=e.minStock?"stock-warning":"stock-normal",za=e=>e.currentStock<=0?"danger":e.currentStock<=e.minStock?"warning":"success",Ia=e=>e.currentStock<=0?"缺货":e.currentStock<=e.minStock?"预警":"正常",Na=e=>{ia.value=e},Ta=()=>{if(0===ia.value.length)return void Q.warning("请先选择要调整的商品");const e=ia.value[0];ya(e),Q.info(`已选择${ia.value.length}个商品，当前调整第一个商品`)},Oa=async()=>{if(ua.value)try{await ua.value.validate(),ea.value=!0;let e=Be.currentStock;"increase"===Be.adjustType?e=Be.currentStock+Be.adjustQuantity:"decrease"===Be.adjustType?e=Math.max(0,Be.currentStock-Be.adjustQuantity):"set"===Be.adjustType&&(e=Be.adjustQuantity),await t.updateProduct(Be.productId,{stock:e});const a={id:Date.now().toString(),productId:Be.productId,productCode:Be.productCode,productName:Be.productName,type:Be.adjustType,typeName:"increase"===Be.adjustType?"增加":"decrease"===Be.adjustType?"减少":"设置",quantity:Be.adjustQuantity,beforeStock:Be.currentStock,afterStock:e,reason:Be.reason,remark:Be.remark,operator:"当前用户",date:(new Date).toLocaleString(),createTime:(new Date).toISOString()},l=`stock_history_${Be.productId}`,o=JSON.parse(localStorage.getItem(l)||"[]");o.unshift(a),localStorage.setItem(l,JSON.stringify(o.slice(0,100))),Q.success("库存调整成功"),setTimeout(()=>{Ze.value=!1,ga()},1e3)}catch(e){console.error("库存调整失败:",e),Q.error("库存调整失败")}finally{ea.value=!1}},Fa=async()=>{if(sa.value)try{await sa.value.validate(),ea.value=!0,await t.updateProduct(Ke.productId,{minStock:Ke.minStock,maxStock:Ke.maxStock}),Q.success("预警设置成功"),setTimeout(()=>{We.value=!1,ga()},1e3)}catch(e){console.error("预警设置失败:",e),Q.error("预警设置失败")}finally{ea.value=!1}},qa=()=>{Ze.value=!1,Object.assign(Be,{id:null,productCode:"",productName:"",image:"",currentStock:0,unit:"",adjustType:"increase",adjustQuantity:0,reason:"",remark:"",productId:""})},Qa=()=>{We.value=!1,Object.assign(Ke,{id:null,productName:"",currentStock:0,unit:"",minStock:0,maxStock:0,productId:""})},$a=()=>{const{adjustType:e,adjustQuantity:a,currentStock:t}=Be;return"increase"===e?t+(a||0):"decrease"===e?Math.max(0,t-(a||0)):"set"===e?a||0:t};return c(()=>{ga(),t.loadCategories()}),u(()=>Je.lowStock,()=>{Je.lowStock&&va()}),(a,l)=>{const o=s("el-icon"),r=s("el-button"),c=s("el-card"),u=s("el-input"),$=s("el-form-item"),Ae=s("el-option"),ia=s("el-select"),ga=s("el-form"),Ra=s("el-table-column"),Da=s("el-tag"),La=s("el-table"),Ea=s("el-pagination"),Aa=s("el-radio"),Ja=s("el-radio-group"),Ma=s("el-input-number"),Ba=s("el-dialog"),Ka=s("el-upload"),Ga=s("el-tab-pane"),Ha=s("el-alert"),Za=s("el-tabs"),Wa=i("loading");return n(),d("div",R,[p("div",D,[l[23]||(l[23]=p("div",{class:"header-left"},[p("h1",{class:"page-title"},"库存管理"),p("p",{class:"page-description"},"管理商品库存，支持库存调整、预警设置等功能")],-1)),p("div",L,[m(r,{type:"primary",onClick:Ta},{default:f(()=>[m(o,null,{default:f(()=>[m(v(x))]),_:1}),l[20]||(l[20]=g(" 库存调整 ",-1))]),_:1}),m(r,{type:"warning",onClick:ha},{default:f(()=>[m(o,null,{default:f(()=>[m(v(C))]),_:1}),l[21]||(l[21]=g(" 批量导入 ",-1))]),_:1}),m(r,{onClick:Ca},{default:f(()=>[m(o,null,{default:f(()=>[m(v(j))]),_:1}),l[22]||(l[22]=g(" 导出数据 ",-1))]),_:1})])]),p("div",E,[m(c,{class:"metric-card"},{default:f(()=>{return[p("div",A,[p("div",J,[m(o,{size:24},{default:f(()=>[m(v(P))]),_:1})]),p("div",M,[p("div",B,"¥"+k((e=fa.value.totalStockValue,e>=1e8?(e/1e8).toFixed(2)+"亿":e>=1e4?(e/1e4).toFixed(2)+"万":e.toFixed(2))),1),l[25]||(l[25]=p("div",{class:"metric-label"},"库存总值",-1)),p("div",K,[m(o,{size:12},{default:f(()=>[m(v(U))]),_:1}),l[24]||(l[24]=p("span",null,"当前库存商品总价值",-1))])])])];var e}),_:1}),m(c,{class:"metric-card"},{default:f(()=>[p("div",G,[p("div",H,[m(o,{size:24},{default:f(()=>[m(v(z))]),_:1})]),p("div",Z,[p("div",W,k(fa.value.totalProducts),1),l[27]||(l[27]=p("div",{class:"metric-label"},"商品总数",-1)),p("div",X,[m(o,{size:12},{default:f(()=>[m(v(I))]),_:1}),l[26]||(l[26]=p("span",null,"较上月增长",-1))])])])]),_:1}),m(c,{class:"metric-card"},{default:f(()=>[p("div",Y,[p("div",ee,[m(o,{size:24},{default:f(()=>[m(v(N))]),_:1})]),p("div",ae,[p("div",te,k(fa.value.lowStockProducts),1),l[28]||(l[28]=p("div",{class:"metric-label"},"库存预警",-1)),p("div",{class:y(["metric-change",fa.value.lowStockProducts>0?"down":"stable"])},[fa.value.lowStockProducts>0?(n(),h(o,{key:0,size:12},{default:f(()=>[m(v(N))]),_:1})):(n(),h(o,{key:1,size:12},{default:f(()=>[m(v(T))]),_:1})),p("span",null,k(fa.value.lowStockProducts>0?"需关注":"正常"),1)],2)])])]),_:1}),m(c,{class:"metric-card"},{default:f(()=>[p("div",le,[p("div",oe,[m(o,{size:24},{default:f(()=>[m(v(O))]),_:1})]),p("div",re,[p("div",ce,k(fa.value.outOfStockProducts),1),l[29]||(l[29]=p("div",{class:"metric-label"},"缺货商品",-1)),p("div",{class:y(["metric-change",fa.value.outOfStockProducts>0?"down":"up"])},[fa.value.outOfStockProducts>0?(n(),h(o,{key:0,size:12},{default:f(()=>[m(v(O))]),_:1})):(n(),h(o,{key:1,size:12},{default:f(()=>[m(v(T))]),_:1})),p("span",null,k(fa.value.outOfStockProducts>0?"需补货":"充足"),1)],2)])])]),_:1})]),p("div",ue,[m(ga,{model:Je,inline:""},{default:f(()=>[m($,{label:"商品名称"},{default:f(()=>[m(u,{modelValue:Je.productName,"onUpdate:modelValue":l[0]||(l[0]=e=>Je.productName=e),placeholder:"请输入商品名称",clearable:"",onKeyup:w(va,["enter"])},null,8,["modelValue"])]),_:1}),m($,{label:"商品编码"},{default:f(()=>[m(u,{modelValue:Je.productCode,"onUpdate:modelValue":l[1]||(l[1]=e=>Je.productCode=e),placeholder:"请输入商品编码",clearable:"",onKeyup:w(va,["enter"])},null,8,["modelValue"])]),_:1}),m($,{label:"商品分类"},{default:f(()=>[m(ia,{modelValue:Je.categoryId,"onUpdate:modelValue":l[2]||(l[2]=e=>Je.categoryId=e),placeholder:"请选择分类",clearable:""},{default:f(()=>[(n(!0),d(_,null,S(v(t).categories,e=>(n(),h(Ae,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),m($,{label:"库存状态"},{default:f(()=>[m(ia,{modelValue:Je.stockStatus,"onUpdate:modelValue":l[3]||(l[3]=e=>Je.stockStatus=e),placeholder:"请选择库存状态",clearable:""},{default:f(()=>[m(Ae,{label:"正常",value:"normal"}),m(Ae,{label:"预警",value:"warning"}),m(Ae,{label:"缺货",value:"out_of_stock"})]),_:1},8,["modelValue"])]),_:1}),m($,null,{default:f(()=>[m(r,{type:"primary",onClick:va},{default:f(()=>[...l[30]||(l[30]=[g("搜索",-1)])]),_:1}),m(r,{onClick:ka},{default:f(()=>[...l[31]||(l[31]=[g("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),p("div",se,[b((n(),h(La,{data:Ee.value,stripe:"",border:"",onSelectionChange:Na},{default:f(()=>[m(Ra,{type:"selection",width:"55"}),m(Ra,{prop:"productCode",label:"商品编码",width:"120"}),m(Ra,{prop:"productName",label:"商品名称","min-width":"200"},{default:f(({row:e})=>[p("div",ie,[p("img",{src:e.image,alt:e.productName,class:"product-image"},null,8,de),p("span",null,k(e.productName),1)])]),_:1}),m(Ra,{prop:"category",label:"分类",width:"120"}),m(Ra,{prop:"currentStock",label:"当前库存",width:"100",align:"center"},{default:f(({row:e})=>[p("span",{class:y(Ua(e))},k(e.currentStock),3)]),_:1}),m(Ra,{prop:"minStock",label:"最低库存",width:"100",align:"center"}),m(Ra,{prop:"maxStock",label:"最高库存",width:"100",align:"center"}),m(Ra,{prop:"unit",label:"单位",width:"80",align:"center"}),m(Ra,{prop:"costPrice",label:"成本价",width:"100",align:"center"},{default:f(({row:e})=>[g(" ¥"+k(e.costPrice.toFixed(2)),1)]),_:1}),m(Ra,{prop:"salePrice",label:"销售价",width:"100",align:"center"},{default:f(({row:e})=>[g(" ¥"+k(e.salePrice.toFixed(2)),1)]),_:1}),m(Ra,{prop:"stockValue",label:"库存价值",width:"120",align:"center"},{default:f(({row:e})=>[g(" ¥"+k((e.currentStock*e.costPrice).toFixed(2)),1)]),_:1}),m(Ra,{prop:"stockStatus",label:"库存状态",width:"100",align:"center"},{default:f(({row:e})=>[m(Da,{type:za(e),size:"small"},{default:f(()=>[g(k(Ia(e)),1)]),_:2},1032,["type"])]),_:1}),m(Ra,{prop:"lastUpdateTime",label:"最后更新",width:"160"}),m(Ra,{label:"操作",width:"180",fixed:"right"},{default:f(({row:e})=>[m(r,{type:"primary",size:"small",link:"",onClick:a=>ya(e)},{default:f(()=>[...l[32]||(l[32]=[g(" 调整库存 ",-1)])]),_:1},8,["onClick"]),m(r,{type:"warning",size:"small",link:"",onClick:a=>(e=>{Object.assign(Ke,{id:e.id,productId:e.id,productName:e.productName,currentStock:e.currentStock,unit:e.unit,minStock:e.minStock,maxStock:e.maxStock}),We.value=!0})(e)},{default:f(()=>[...l[33]||(l[33]=[g(" 设置预警 ",-1)])]),_:1},8,["onClick"]),m(r,{type:"info",size:"small",link:"",onClick:a=>(async e=>{try{da.value=e,Xe.value=!0,na.value=!0;const a=`stock_history_${e.id}`,t=JSON.parse(localStorage.getItem(a)||"[]");t.length>0?(pa.value=t,ma.total=t.length):(pa.value=[],ma.total=0)}catch(a){console.error("获取库存历史失败:",a),Q.error("获取库存历史失败"),pa.value=[]}finally{na.value=!1}})(e)},{default:f(()=>[...l[34]||(l[34]=[g(" 变动记录 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Wa,Le.value]]),p("div",ne,[m(Ea,{"current-page":Me.page,"onUpdate:currentPage":l[4]||(l[4]=e=>Me.page=e),"page-size":Me.pageSize,"onUpdate:pageSize":l[5]||(l[5]=e=>Me.pageSize=e),"page-sizes":[10,20,50,100],total:Me.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ja,onCurrentChange:Pa},null,8,["current-page","page-size","total"])])]),m(Ba,{modelValue:Ze.value,"onUpdate:modelValue":l[11]||(l[11]=e=>Ze.value=e),title:"库存调整",width:"600px",onClose:qa},{footer:f(()=>[p("div",ye,[m(r,{onClick:l[10]||(l[10]=e=>Ze.value=!1)},{default:f(()=>[...l[38]||(l[38]=[g("取消",-1)])]),_:1}),m(r,{type:"primary",onClick:Oa,loading:ea.value},{default:f(()=>[...l[39]||(l[39]=[g(" 确定调整 ",-1)])]),_:1},8,["loading"])])]),default:f(()=>[m(ga,{ref_key:"adjustFormRef",ref:ua,model:Be,rules:Ge,"label-width":"100px"},{default:f(()=>[m($,{label:"商品信息"},{default:f(()=>[p("div",pe,[p("img",{src:Be.image,alt:Be.productName,class:"product-image"},null,8,me),p("div",null,[p("div",null,k(Be.productName),1),p("div",fe,"编码："+k(Be.productCode),1)])])]),_:1}),m($,{label:"当前库存"},{default:f(()=>[p("span",ge,k(Be.currentStock)+" "+k(Be.unit),1)]),_:1}),m($,{label:"调整类型",prop:"adjustType"},{default:f(()=>[m(Ja,{modelValue:Be.adjustType,"onUpdate:modelValue":l[6]||(l[6]=e=>Be.adjustType=e)},{default:f(()=>[m(Aa,{label:"increase"},{default:f(()=>[...l[35]||(l[35]=[g("增加",-1)])]),_:1}),m(Aa,{label:"decrease"},{default:f(()=>[...l[36]||(l[36]=[g("减少",-1)])]),_:1}),m(Aa,{label:"set"},{default:f(()=>[...l[37]||(l[37]=[g("设置为",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),m($,{label:"调整数量",prop:"adjustQuantity"},{default:f(()=>[m(Ma,{modelValue:Be.adjustQuantity,"onUpdate:modelValue":l[7]||(l[7]=e=>Be.adjustQuantity=e),min:"decrease"===Be.adjustType?1:0,max:"decrease"===Be.adjustType?Be.currentStock:99999,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue","min","max"]),p("span",ve,k(Be.unit),1)]),_:1}),m($,{label:"调整后库存"},{default:f(()=>[p("span",ke,k($a())+" "+k(Be.unit),1)]),_:1}),m($,{label:"调整原因",prop:"reason"},{default:f(()=>[m(ia,{modelValue:Be.reason,"onUpdate:modelValue":l[8]||(l[8]=e=>Be.reason=e),placeholder:"请选择调整原因",style:{width:"100%"}},{default:f(()=>[m(Ae,{label:"盘点调整",value:"inventory"}),m(Ae,{label:"损耗调整",value:"loss"}),m(Ae,{label:"退货入库",value:"return"}),m(Ae,{label:"采购入库",value:"purchase"}),m(Ae,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),m($,{label:"备注",prop:"remark"},{default:f(()=>[m(u,{modelValue:Be.remark,"onUpdate:modelValue":l[9]||(l[9]=e=>Be.remark=e),type:"textarea",rows:3,placeholder:"请输入调整备注",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),m(Ba,{modelValue:We.value,"onUpdate:modelValue":l[15]||(l[15]=e=>We.value=e),title:"库存预警设置",width:"500px",onClose:Qa},{footer:f(()=>[p("div",_e,[m(r,{onClick:l[14]||(l[14]=e=>We.value=!1)},{default:f(()=>[...l[40]||(l[40]=[g("取消",-1)])]),_:1}),m(r,{type:"primary",onClick:Fa,loading:ea.value},{default:f(()=>[...l[41]||(l[41]=[g(" 保存设置 ",-1)])]),_:1},8,["loading"])])]),default:f(()=>[m(ga,{ref_key:"warningFormRef",ref:sa,model:Ke,rules:He,"label-width":"100px"},{default:f(()=>[m($,{label:"商品名称"},{default:f(()=>[p("span",null,k(Ke.productName),1)]),_:1}),m($,{label:"当前库存"},{default:f(()=>[p("span",null,k(Ke.currentStock)+" "+k(Ke.unit),1)]),_:1}),m($,{label:"最低库存",prop:"minStock"},{default:f(()=>[m(Ma,{modelValue:Ke.minStock,"onUpdate:modelValue":l[12]||(l[12]=e=>Ke.minStock=e),min:0,max:Ke.maxStock||99999,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue","max"]),p("span",he,k(Ke.unit),1)]),_:1}),m($,{label:"最高库存",prop:"maxStock"},{default:f(()=>[m(Ma,{modelValue:Ke.maxStock,"onUpdate:modelValue":l[13]||(l[13]=e=>Ke.maxStock=e),min:Ke.minStock||0,max:99999,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue","min"]),p("span",we,k(Ke.unit),1)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),m(Ba,{modelValue:Xe.value,"onUpdate:modelValue":l[17]||(l[17]=e=>Xe.value=e),title:`${da.value.productName} - 库存变动记录`,width:"900px",top:"5vh"},{footer:f(()=>[p("div",Ne,[m(r,{onClick:l[16]||(l[16]=e=>Xe.value=!1)},{default:f(()=>[...l[42]||(l[42]=[g("关闭",-1)])]),_:1})])]),default:f(()=>[p("div",Se,[p("div",be,[p("img",{src:da.value.image,alt:da.value.productName,class:"product-image-small"},null,8,Ve),p("div",xe,[p("div",Ce,k(da.value.productName),1),p("div",je,"商品编码："+k(da.value.productCode),1),p("div",Pe,"当前库存："+k(da.value.currentStock)+" "+k(da.value.unit),1)])])]),b((n(),h(La,{data:pa.value,style:{width:"100%"},"max-height":"400"},{default:f(()=>[m(Ra,{prop:"date",label:"变动时间",width:"160"}),m(Ra,{prop:"typeName",label:"变动类型",width:"80",align:"center"},{default:f(({row:e})=>[m(Da,{type:"increase"===e.type?"success":"decrease"===e.type?"danger":"warning",size:"small"},{default:f(()=>[g(k(e.typeName),1)]),_:2},1032,["type"])]),_:1}),m(Ra,{label:"库存变化",width:"120",align:"center"},{default:f(({row:e})=>[p("span",{class:y({"increase-text":"increase"===e.type,"decrease-text":"decrease"===e.type,"set-text":"set"===e.type})},k("increase"===e.type?"+":"decrease"===e.type?"-":"")+k(e.quantity),3)]),_:1}),m(Ra,{label:"库存变化详情",width:"150",align:"center"},{default:f(({row:e})=>[p("div",Ue,[p("span",ze,k(e.beforeStock),1),m(o,{class:"arrow-icon"},{default:f(()=>[m(v(F))]),_:1}),p("span",Ie,k(e.afterStock),1)])]),_:1}),m(Ra,{label:"变动原因",width:"100"},{default:f(({row:e})=>{return[g(k((a=e.reason,{inventory:"盘点调整",loss:"损耗调整",return:"退货入库",purchase:"采购入库",sale:"销售出库",other:"其他"}[a]||a)),1)];var a}),_:1}),m(Ra,{prop:"operator",label:"操作人",width:"80"}),m(Ra,{prop:"remark",label:"备注","min-width":"120","show-overflow-tooltip":""})]),_:1},8,["data"])),[[Wa,na.value]])]),_:1},8,["modelValue","title"]),m(Ba,{modelValue:Ye.value,"onUpdate:modelValue":l[19]||(l[19]=e=>Ye.value=e),title:"批量导入商品",width:"80%",top:"5vh","before-close":Va},{footer:f(()=>[p("div",De,[m(r,{onClick:Va},{default:f(()=>[...l[50]||(l[50]=[g("取消",-1)])]),_:1}),m(r,{type:"primary",onClick:xa,loading:aa.value},{default:f(()=>[...l[51]||(l[51]=[g(" 确定导入 ",-1)])]),_:1},8,["loading"])])]),default:f(()=>[m(Za,{modelValue:ta.value,"onUpdate:modelValue":l[18]||(l[18]=e=>ta.value=e)},{default:f(()=>[m(Ga,{label:"在线快速添加",name:"quick"},{default:f(()=>[p("div",Te,[m(r,{type:"primary",onClick:wa,icon:v(q),size:"small",style:{"margin-bottom":"16px"}},{default:f(()=>[...l[43]||(l[43]=[g(" 新增一行 ",-1)])]),_:1},8,["icon"]),m(La,{data:la.value,border:"",style:{width:"100%"}},{default:f(()=>[m(Ra,{type:"index",label:"序号",width:"60"}),m(Ra,{label:"商品图片",width:"100"},{default:f(({row:a,$index:t})=>[m(Ka,{class:"avatar-uploader","show-file-list":!1,"before-upload":a=>(async(a,t)=>{try{const{uploadImage:l}=await e(async()=>{const{uploadImage:e}=await import("./uploadService-C3xZb1GB.js");return{uploadImage:e}},__vite__mapDeps([0,1,2,3,4,5])),o=await l(a,"product");o.success&&o.url?(la.value[t].image=o.url,Q.success("图片上传成功")):Q.error(o.message||"图片上传失败")}catch(l){console.error("图片上传失败:",l),Q.error("图片上传失败，请重试")}return!1})(a,t),accept:"image/*"},{default:f(()=>[a.image?(n(),d("img",{key:0,src:a.image,class:"avatar"},null,8,Oe)):(n(),h(o,{key:1,class:"avatar-uploader-icon"},{default:f(()=>[m(v(q))]),_:1}))]),_:2},1032,["before-upload"])]),_:1}),m(Ra,{label:"商品名称","min-width":"180"},{default:f(({row:e})=>[m(u,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,placeholder:"请输入",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),m(Ra,{label:"商品编码","min-width":"140"},{default:f(({row:e})=>[m(u,{modelValue:e.code,"onUpdate:modelValue":a=>e.code=a,placeholder:"自动生成",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),m(Ra,{label:"分类","min-width":"140"},{default:f(({row:e})=>[m(ia,{modelValue:e.categoryId,"onUpdate:modelValue":a=>e.categoryId=a,placeholder:"请选择",size:"small",style:{width:"100%"}},{default:f(()=>[(n(!0),d(_,null,S(v(t).categories,e=>(n(),h(Ae,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),m(Ra,{label:"单位","min-width":"120"},{default:f(({row:e})=>[m(ia,{modelValue:e.unit,"onUpdate:modelValue":a=>e.unit=a,placeholder:"请选择",size:"small","allow-create":"",filterable:"",style:{width:"100%"}},{default:f(()=>[m(Ae,{label:"件",value:"件"}),m(Ae,{label:"盒",value:"盒"}),m(Ae,{label:"瓶",value:"瓶"}),m(Ae,{label:"袋",value:"袋"}),m(Ae,{label:"箱",value:"箱"}),m(Ae,{label:"个",value:"个"}),m(Ae,{label:"套",value:"套"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),m(Ra,{label:"销售价","min-width":"120"},{default:f(({row:e})=>[m(Ma,{modelValue:e.price,"onUpdate:modelValue":a=>e.price=a,min:0,precision:2,size:"small",style:{width:"100%"},"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),m(Ra,{label:"成本价","min-width":"120"},{default:f(({row:e})=>[m(Ma,{modelValue:e.costPrice,"onUpdate:modelValue":a=>e.costPrice=a,min:0,precision:2,size:"small",style:{width:"100%"},"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),m(Ra,{label:"库存","min-width":"100"},{default:f(({row:e})=>[m(Ma,{modelValue:e.stock,"onUpdate:modelValue":a=>e.stock=a,min:0,size:"small",style:{width:"100%"},"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),m(Ra,{label:"状态","min-width":"110"},{default:f(({row:e})=>[m(ia,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,size:"small",style:{width:"100%"}},{default:f(()=>[m(Ae,{label:"上架",value:"active"}),m(Ae,{label:"下架",value:"inactive"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),m(Ra,{label:"操作",width:"80",fixed:"right"},{default:f(({$index:e})=>[m(r,{type:"danger",link:"",size:"small",onClick:a=>{return t=e,void la.value.splice(t,1);var t}},{default:f(()=>[...l[44]||(l[44]=[g(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),m(Ga,{label:"表格导入",name:"excel"},{default:f(()=>[p("div",Fe,[m(Ha,{title:"导入说明",type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:f(()=>[...l[45]||(l[45]=[p("p",null,"1. 请先下载模板文件，按照模板格式填写商品信息",-1),p("p",null,"2. 支持.xlsx格式的Excel文件",-1),p("p",null,"3. 必填字段：商品名称、销售价、库存",-1)])]),_:1}),p("div",qe,[m(r,{type:"success",onClick:_a,icon:v(j)},{default:f(()=>[...l[46]||(l[46]=[g(" 下载模板 ",-1)])]),_:1},8,["icon"]),m(Ka,{ref_key:"uploadRef",ref:ca,"auto-upload":!1,"on-change":Sa,"show-file-list":!1,accept:".xlsx"},{default:f(()=>[m(r,{type:"primary",icon:v(C)},{default:f(()=>[...l[47]||(l[47]=[g(" 选择文件 ",-1)])]),_:1},8,["icon"])]),_:1},512)]),oa.value?(n(),d("div",Qe,[m(Da,{type:"success"},{default:f(()=>[g(k(oa.value),1)]),_:1}),m(r,{type:"text",onClick:ba},{default:f(()=>[...l[48]||(l[48]=[g("清除",-1)])]),_:1})])):V("",!0),ra.value.length>0?(n(),d("div",$e,[l[49]||(l[49]=p("h4",null,"数据预览（前10条）",-1)),m(La,{data:ra.value.slice(0,10),border:"",style:{width:"100%"}},{default:f(()=>[m(Ra,{prop:"name",label:"商品名称"}),m(Ra,{prop:"code",label:"商品编码"}),m(Ra,{prop:"categoryName",label:"分类"}),m(Ra,{prop:"unit",label:"单位"}),m(Ra,{prop:"price",label:"销售价"}),m(Ra,{prop:"costPrice",label:"成本价"}),m(Ra,{prop:"stock",label:"库存"}),m(Ra,{prop:"status",label:"状态"})]),_:1},8,["data"]),p("p",Re,"共 "+k(ra.value.length)+" 条数据",1)])):V("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-8b555160"]]);export{Le as default};
