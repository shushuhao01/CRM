var de=Object.defineProperty,pe=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var j=(x,m,i)=>m in x?de(x,m,{enumerable:!0,configurable:!0,writable:!0,value:i}):x[m]=i,B=(x,m)=>{for(var i in m||(m={}))fe.call(m,i)&&j(x,i,m[i]);if(E)for(var i of E(m))ge.call(m,i)&&j(x,i,m[i]);return x},z=(x,m)=>pe(x,me(m));var I=(x,m,i)=>new Promise((O,U)=>{var A=r=>{try{k(i.next(r))}catch(S){U(S)}},K=r=>{try{k(i.throw(r))}catch(S){U(S)}},k=r=>r.done?O(r.value):Promise.resolve(r.value).then(A,K);k((i=i.apply(x,m)).next())});import{n as ye,u as ve,r as be,E as y,b as Ve}from"./elementPlus-Bmwh7Rh8.js";import{l as xe,r as T,Z as N,c as we,ag as v,m as ce,p as c,q as n,U as l,O as t,S as g,M as L,Q as R,u as D}from"./vendor-D8Vxqhr-.js";import{_ as ke}from"./settings-CuxbDWOu.js";import"./utils-ywHRn0uI.js";const Ce={class:"sms-config"},Le={class:"form-actions"},Re={class:"form-actions"},Ue={class:"form-actions"},Ae={class:"form-actions"},Ke={class:"import-export-section"},Fe={class:"import-export-actions"},Ie=xe({__name:"SmsConfig",setup(x){const m=T("basic"),i=T(!1),O=T(!1),U=T(),A=T(),K=T(),k=T(),r=N({provider:"aliyun",accessKeyId:"",accessKeySecret:"",signName:"",region:"cn-hangzhou",batchLimit:100,rateLimit:10,retryCount:3,timeout:30}),S={provider:[{required:!0,message:"请选择服务商",trigger:"change"}],accessKeyId:[{required:!0,message:"请输入AccessKey ID",trigger:"blur"}],accessKeySecret:[{required:!0,message:"请输入AccessKey Secret",trigger:"blur"}],signName:[{required:!0,message:"请输入签名名称",trigger:"blur"}]},d=N({enabled:!0,autoApprovalLimit:10,approvalTimeout:24,approvers:["admin"],notifyOnApproval:!0,notifyMethods:["email","system"]}),J={autoApprovalLimit:[{required:!0,message:"请设置自动审核阈值",trigger:"blur"}],approvalTimeout:[{required:!0,message:"请设置审核超时时间",trigger:"blur"}]},f=N({ipWhitelist:`127.0.0.1
192.168.1.0/24`,apiKey:"sk-1234567890abcdef",keyExpiration:90,sensitiveWordFilter:!0,sensitiveWords:`赌博
色情
暴力
政治`,contentLengthLimit:200}),G={apiKey:[{required:!0,message:"请生成API密钥",trigger:"blur"}],contentLengthLimit:[{required:!0,message:"请设置内容长度限制",trigger:"blur"}]},p=N({enableLogging:!0,logLevel:"info",logRetentionDays:30,enableAlerts:!0,failureRateThreshold:10,alertReceivers:"admin@example.com"}),Q={logRetentionDays:[{required:!0,message:"请设置日志保留时间",trigger:"blur"}],failureRateThreshold:[{required:!0,message:"请设置失败率阈值",trigger:"blur"}]},Z=()=>I(this,null,function*(){if(U.value)try{yield U.value.validate(),i.value=!0,yield new Promise(s=>setTimeout(s,1e3)),y.success("基础配置保存成功")}catch(s){y.error("保存失败，请检查配置项")}finally{i.value=!1}}),H=()=>I(this,null,function*(){O.value=!0;try{yield new Promise(s=>setTimeout(s,2e3)),Math.random()>.3?y.success("连接测试成功"):y.error("连接测试失败，请检查配置")}finally{O.value=!1}}),X=()=>{var s;(s=U.value)==null||s.resetFields()},Y=()=>I(this,null,function*(){if(A.value)try{yield A.value.validate(),i.value=!0,yield new Promise(s=>setTimeout(s,1e3)),y.success("审核配置保存成功")}catch(s){y.error("保存失败，请检查配置项")}finally{i.value=!1}}),$=()=>{var s;(s=A.value)==null||s.resetFields()},h=()=>I(this,null,function*(){if(K.value)try{yield K.value.validate(),i.value=!0,yield new Promise(s=>setTimeout(s,1e3)),y.success("安全配置保存成功")}catch(s){y.error("保存失败，请检查配置项")}finally{i.value=!1}}),ee=()=>{const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="sk-";for(let u=0;u<32;u++)e+=s.charAt(Math.floor(Math.random()*s.length));f.apiKey=e,y.success("API密钥已重新生成")},le=()=>{var s;(s=K.value)==null||s.resetFields()},te=()=>I(this,null,function*(){if(k.value)try{yield k.value.validate(),i.value=!0,yield new Promise(s=>setTimeout(s,1e3)),y.success("监控配置保存成功")}catch(s){y.error("保存失败，请检查配置项")}finally{i.value=!1}}),oe=()=>{var s;(s=k.value)==null||s.resetFields()},ae=()=>{const s={basic:r,approval:d,security:z(B({},f),{apiKey:"***"}),monitoring:p},e=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),u=URL.createObjectURL(e),b=document.createElement("a");b.href=u,b.download=`sms-config-${new Date().toISOString().split("T")[0]}.json`,b.click(),URL.revokeObjectURL(u),y.success("配置导出成功")},se=s=>{const e=new FileReader;return e.onload=u=>{var b;try{const a=JSON.parse((b=u.target)==null?void 0:b.result);a.basic&&Object.assign(r,a.basic),a.approval&&Object.assign(d,a.approval),a.security&&Object.assign(f,a.security),a.monitoring&&Object.assign(p,a.monitoring),y.success("配置导入成功")}catch(a){y.error("配置文件格式错误")}},e.readAsText(s),!1},ne=()=>I(this,null,function*(){var s,e,u,b;try{yield Ve.confirm("确定要恢复所有配置到默认值吗？","确认重置",{type:"warning"}),(s=U.value)==null||s.resetFields(),(e=A.value)==null||e.resetFields(),(u=K.value)==null||u.resetFields(),(b=k.value)==null||b.resetFields(),y.success("所有配置已恢复默认值")}catch(a){}});return we(()=>{}),(s,e)=>{const u=v("el-option"),b=v("el-select"),a=v("el-form-item"),F=v("el-input"),C=v("el-card"),w=v("el-input-number"),V=v("el-button"),W=v("el-form"),M=v("el-tab-pane"),_=v("el-switch"),P=v("el-checkbox"),re=v("el-checkbox-group"),ie=v("el-tabs"),q=v("el-icon"),ue=v("el-upload");return c(),ce("div",Ce,[e[68]||(e[68]=n("div",{class:"page-header"},[n("h2",null,"短信配置管理"),n("p",null,"管理短信服务的各项配置参数")],-1)),l(ie,{modelValue:m.value,"onUpdate:modelValue":e[27]||(e[27]=o=>m.value=o),type:"border-card"},{default:t(()=>[l(M,{label:"基础配置",name:"basic"},{default:t(()=>[l(W,{model:r,rules:S,ref_key:"basicFormRef",ref:U,"label-width":"120px",class:"config-form"},{default:t(()=>[l(C,{class:"config-card"},{header:t(()=>[...e[28]||(e[28]=[n("span",null,"服务商配置",-1)])]),default:t(()=>[l(a,{label:"服务商",prop:"provider"},{default:t(()=>[l(b,{modelValue:r.provider,"onUpdate:modelValue":e[0]||(e[0]=o=>r.provider=o),style:{width:"300px"}},{default:t(()=>[l(u,{label:"阿里云短信",value:"aliyun"}),l(u,{label:"腾讯云短信",value:"tencent"}),l(u,{label:"华为云短信",value:"huawei"}),l(u,{label:"网易云信",value:"netease"})]),_:1},8,["modelValue"])]),_:1}),l(a,{label:"AccessKey ID",prop:"accessKeyId"},{default:t(()=>[l(F,{modelValue:r.accessKeyId,"onUpdate:modelValue":e[1]||(e[1]=o=>r.accessKeyId=o),placeholder:"请输入AccessKey ID",style:{width:"400px"},"show-password":""},null,8,["modelValue"])]),_:1}),l(a,{label:"AccessKey Secret",prop:"accessKeySecret"},{default:t(()=>[l(F,{modelValue:r.accessKeySecret,"onUpdate:modelValue":e[2]||(e[2]=o=>r.accessKeySecret=o),placeholder:"请输入AccessKey Secret",style:{width:"400px"},"show-password":""},null,8,["modelValue"])]),_:1}),l(a,{label:"签名名称",prop:"signName"},{default:t(()=>[l(F,{modelValue:r.signName,"onUpdate:modelValue":e[3]||(e[3]=o=>r.signName=o),placeholder:"请输入短信签名",style:{width:"300px"}},null,8,["modelValue"]),e[29]||(e[29]=n("div",{class:"form-tip"},"短信签名需要在服务商平台申请并审核通过",-1))]),_:1}),l(a,{label:"服务地域",prop:"region"},{default:t(()=>[l(b,{modelValue:r.region,"onUpdate:modelValue":e[4]||(e[4]=o=>r.region=o),style:{width:"200px"}},{default:t(()=>[l(u,{label:"华东1（杭州）",value:"cn-hangzhou"}),l(u,{label:"华北2（北京）",value:"cn-beijing"}),l(u,{label:"华南1（深圳）",value:"cn-shenzhen"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(C,{class:"config-card"},{header:t(()=>[...e[30]||(e[30]=[n("span",null,"发送配置",-1)])]),default:t(()=>[l(a,{label:"单次发送上限",prop:"batchLimit"},{default:t(()=>[l(w,{modelValue:r.batchLimit,"onUpdate:modelValue":e[5]||(e[5]=o=>r.batchLimit=o),min:1,max:1e3,style:{width:"200px"}},null,8,["modelValue"]),e[31]||(e[31]=n("span",{class:"unit-text"},"条",-1))]),_:1}),l(a,{label:"发送频率限制",prop:"rateLimit"},{default:t(()=>[l(w,{modelValue:r.rateLimit,"onUpdate:modelValue":e[6]||(e[6]=o=>r.rateLimit=o),min:1,max:100,style:{width:"200px"}},null,8,["modelValue"]),e[32]||(e[32]=n("span",{class:"unit-text"},"条/分钟",-1))]),_:1}),l(a,{label:"重试次数",prop:"retryCount"},{default:t(()=>[l(w,{modelValue:r.retryCount,"onUpdate:modelValue":e[7]||(e[7]=o=>r.retryCount=o),min:0,max:5,style:{width:"200px"}},null,8,["modelValue"]),e[33]||(e[33]=n("span",{class:"unit-text"},"次",-1))]),_:1}),l(a,{label:"超时时间",prop:"timeout"},{default:t(()=>[l(w,{modelValue:r.timeout,"onUpdate:modelValue":e[8]||(e[8]=o=>r.timeout=o),min:5,max:60,style:{width:"200px"}},null,8,["modelValue"]),e[34]||(e[34]=n("span",{class:"unit-text"},"秒",-1))]),_:1})]),_:1}),n("div",Le,[l(V,{type:"primary",onClick:Z,loading:i.value},{default:t(()=>[...e[35]||(e[35]=[g(" 保存配置 ",-1)])]),_:1},8,["loading"]),l(V,{onClick:H,loading:O.value},{default:t(()=>[...e[36]||(e[36]=[g(" 测试连接 ",-1)])]),_:1},8,["loading"]),l(V,{onClick:X},{default:t(()=>[...e[37]||(e[37]=[g(" 重置 ",-1)])]),_:1})])]),_:1},8,["model"])]),_:1}),l(M,{label:"审核配置",name:"approval"},{default:t(()=>[l(W,{model:d,rules:J,ref_key:"approvalFormRef",ref:A,"label-width":"120px",class:"config-form"},{default:t(()=>[l(C,{class:"config-card"},{header:t(()=>[...e[38]||(e[38]=[n("span",null,"审核流程",-1)])]),default:t(()=>[l(a,{label:"启用审核",prop:"enabled"},{default:t(()=>[l(_,{modelValue:d.enabled,"onUpdate:modelValue":e[9]||(e[9]=o=>d.enabled=o)},null,8,["modelValue"]),e[39]||(e[39]=n("div",{class:"form-tip"},"开启后，所有短信发送都需要审核",-1))]),_:1}),d.enabled?(c(),L(a,{key:0,label:"自动审核阈值",prop:"autoApprovalLimit"},{default:t(()=>[l(w,{modelValue:d.autoApprovalLimit,"onUpdate:modelValue":e[10]||(e[10]=o=>d.autoApprovalLimit=o),min:0,max:100,style:{width:"200px"}},null,8,["modelValue"]),e[40]||(e[40]=n("span",{class:"unit-text"},"条",-1)),e[41]||(e[41]=n("div",{class:"form-tip"},"低于此数量的发送申请将自动审核通过",-1))]),_:1})):R("",!0),d.enabled?(c(),L(a,{key:1,label:"审核超时时间",prop:"approvalTimeout"},{default:t(()=>[l(w,{modelValue:d.approvalTimeout,"onUpdate:modelValue":e[11]||(e[11]=o=>d.approvalTimeout=o),min:1,max:72,style:{width:"200px"}},null,8,["modelValue"]),e[42]||(e[42]=n("span",{class:"unit-text"},"小时",-1))]),_:1})):R("",!0),d.enabled?(c(),L(a,{key:2,label:"审核人员",prop:"approvers"},{default:t(()=>[l(b,{modelValue:d.approvers,"onUpdate:modelValue":e[12]||(e[12]=o=>d.approvers=o),multiple:"",placeholder:"请选择审核人员",style:{width:"400px"}},{default:t(()=>[l(u,{label:"管理员",value:"admin"}),l(u,{label:"部门主管",value:"manager"}),l(u,{label:"运营人员",value:"operator"})]),_:1},8,["modelValue"])]),_:1})):R("",!0)]),_:1}),l(C,{class:"config-card"},{header:t(()=>[...e[43]||(e[43]=[n("span",null,"通知设置",-1)])]),default:t(()=>[l(a,{label:"审核通知",prop:"notifyOnApproval"},{default:t(()=>[l(_,{modelValue:d.notifyOnApproval,"onUpdate:modelValue":e[13]||(e[13]=o=>d.notifyOnApproval=o)},null,8,["modelValue"]),e[44]||(e[44]=n("div",{class:"form-tip"},"审核结果将通知申请人",-1))]),_:1}),d.notifyOnApproval?(c(),L(a,{key:0,label:"通知方式",prop:"notifyMethods"},{default:t(()=>[l(re,{modelValue:d.notifyMethods,"onUpdate:modelValue":e[14]||(e[14]=o=>d.notifyMethods=o)},{default:t(()=>[l(P,{label:"email"},{default:t(()=>[...e[45]||(e[45]=[g("邮件",-1)])]),_:1}),l(P,{label:"sms"},{default:t(()=>[...e[46]||(e[46]=[g("短信",-1)])]),_:1}),l(P,{label:"system"},{default:t(()=>[...e[47]||(e[47]=[g("系统通知",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):R("",!0)]),_:1}),n("div",Re,[l(V,{type:"primary",onClick:Y,loading:i.value},{default:t(()=>[...e[48]||(e[48]=[g(" 保存配置 ",-1)])]),_:1},8,["loading"]),l(V,{onClick:$},{default:t(()=>[...e[49]||(e[49]=[g(" 重置 ",-1)])]),_:1})])]),_:1},8,["model"])]),_:1}),l(M,{label:"安全配置",name:"security"},{default:t(()=>[l(W,{model:f,rules:G,ref_key:"securityFormRef",ref:K,"label-width":"120px",class:"config-form"},{default:t(()=>[l(C,{class:"config-card"},{header:t(()=>[...e[50]||(e[50]=[n("span",null,"访问控制",-1)])]),default:t(()=>[l(a,{label:"IP白名单",prop:"ipWhitelist"},{default:t(()=>[l(F,{modelValue:f.ipWhitelist,"onUpdate:modelValue":e[15]||(e[15]=o=>f.ipWhitelist=o),type:"textarea",rows:4,placeholder:"请输入IP地址，每行一个，支持CIDR格式",style:{width:"500px"}},null,8,["modelValue"]),e[51]||(e[51]=n("div",{class:"form-tip"},"只有白名单内的IP才能调用短信接口",-1))]),_:1}),l(a,{label:"API密钥",prop:"apiKey"},{default:t(()=>[l(F,{modelValue:f.apiKey,"onUpdate:modelValue":e[16]||(e[16]=o=>f.apiKey=o),placeholder:"API密钥",style:{width:"400px"},readonly:""},{append:t(()=>[l(V,{onClick:ee},{default:t(()=>[...e[52]||(e[52]=[g("重新生成",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(a,{label:"密钥过期时间",prop:"keyExpiration"},{default:t(()=>[l(w,{modelValue:f.keyExpiration,"onUpdate:modelValue":e[17]||(e[17]=o=>f.keyExpiration=o),min:1,max:365,style:{width:"200px"}},null,8,["modelValue"]),e[53]||(e[53]=n("span",{class:"unit-text"},"天",-1))]),_:1})]),_:1}),l(C,{class:"config-card"},{header:t(()=>[...e[54]||(e[54]=[n("span",null,"内容安全",-1)])]),default:t(()=>[l(a,{label:"敏感词过滤",prop:"sensitiveWordFilter"},{default:t(()=>[l(_,{modelValue:f.sensitiveWordFilter,"onUpdate:modelValue":e[18]||(e[18]=o=>f.sensitiveWordFilter=o)},null,8,["modelValue"])]),_:1}),f.sensitiveWordFilter?(c(),L(a,{key:0,label:"敏感词库",prop:"sensitiveWords"},{default:t(()=>[l(F,{modelValue:f.sensitiveWords,"onUpdate:modelValue":e[19]||(e[19]=o=>f.sensitiveWords=o),type:"textarea",rows:6,placeholder:"请输入敏感词，每行一个",style:{width:"500px"}},null,8,["modelValue"])]),_:1})):R("",!0),l(a,{label:"内容长度限制",prop:"contentLengthLimit"},{default:t(()=>[l(w,{modelValue:f.contentLengthLimit,"onUpdate:modelValue":e[20]||(e[20]=o=>f.contentLengthLimit=o),min:10,max:500,style:{width:"200px"}},null,8,["modelValue"]),e[55]||(e[55]=n("span",{class:"unit-text"},"字符",-1))]),_:1})]),_:1}),n("div",Ue,[l(V,{type:"primary",onClick:h,loading:i.value},{default:t(()=>[...e[56]||(e[56]=[g(" 保存配置 ",-1)])]),_:1},8,["loading"]),l(V,{onClick:le},{default:t(()=>[...e[57]||(e[57]=[g(" 重置 ",-1)])]),_:1})])]),_:1},8,["model"])]),_:1}),l(M,{label:"监控配置",name:"monitoring"},{default:t(()=>[l(W,{model:p,rules:Q,ref_key:"monitoringFormRef",ref:k,"label-width":"120px",class:"config-form"},{default:t(()=>[l(C,{class:"config-card"},{header:t(()=>[...e[58]||(e[58]=[n("span",null,"日志配置",-1)])]),default:t(()=>[l(a,{label:"启用日志",prop:"enableLogging"},{default:t(()=>[l(_,{modelValue:p.enableLogging,"onUpdate:modelValue":e[21]||(e[21]=o=>p.enableLogging=o)},null,8,["modelValue"])]),_:1}),p.enableLogging?(c(),L(a,{key:0,label:"日志级别",prop:"logLevel"},{default:t(()=>[l(b,{modelValue:p.logLevel,"onUpdate:modelValue":e[22]||(e[22]=o=>p.logLevel=o),style:{width:"200px"}},{default:t(()=>[l(u,{label:"DEBUG",value:"debug"}),l(u,{label:"INFO",value:"info"}),l(u,{label:"WARN",value:"warn"}),l(u,{label:"ERROR",value:"error"})]),_:1},8,["modelValue"])]),_:1})):R("",!0),p.enableLogging?(c(),L(a,{key:1,label:"日志保留时间",prop:"logRetentionDays"},{default:t(()=>[l(w,{modelValue:p.logRetentionDays,"onUpdate:modelValue":e[23]||(e[23]=o=>p.logRetentionDays=o),min:1,max:365,style:{width:"200px"}},null,8,["modelValue"]),e[59]||(e[59]=n("span",{class:"unit-text"},"天",-1))]),_:1})):R("",!0)]),_:1}),l(C,{class:"config-card"},{header:t(()=>[...e[60]||(e[60]=[n("span",null,"告警配置",-1)])]),default:t(()=>[l(a,{label:"启用告警",prop:"enableAlerts"},{default:t(()=>[l(_,{modelValue:p.enableAlerts,"onUpdate:modelValue":e[24]||(e[24]=o=>p.enableAlerts=o)},null,8,["modelValue"])]),_:1}),p.enableAlerts?(c(),L(a,{key:0,label:"失败率阈值",prop:"failureRateThreshold"},{default:t(()=>[l(w,{modelValue:p.failureRateThreshold,"onUpdate:modelValue":e[25]||(e[25]=o=>p.failureRateThreshold=o),min:1,max:100,style:{width:"200px"}},null,8,["modelValue"]),e[61]||(e[61]=n("span",{class:"unit-text"},"%",-1))]),_:1})):R("",!0),p.enableAlerts?(c(),L(a,{key:1,label:"告警接收人",prop:"alertReceivers"},{default:t(()=>[l(F,{modelValue:p.alertReceivers,"onUpdate:modelValue":e[26]||(e[26]=o=>p.alertReceivers=o),placeholder:"请输入邮箱地址，多个用逗号分隔",style:{width:"400px"}},null,8,["modelValue"])]),_:1})):R("",!0)]),_:1}),n("div",Ae,[l(V,{type:"primary",onClick:te,loading:i.value},{default:t(()=>[...e[62]||(e[62]=[g(" 保存配置 ",-1)])]),_:1},8,["loading"]),l(V,{onClick:oe},{default:t(()=>[...e[63]||(e[63]=[g(" 重置 ",-1)])]),_:1})])]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"]),n("div",Ke,[l(C,null,{header:t(()=>[...e[64]||(e[64]=[n("span",null,"配置管理",-1)])]),default:t(()=>[n("div",Fe,[l(V,{type:"primary",onClick:ae},{default:t(()=>[l(q,null,{default:t(()=>[l(D(ye))]),_:1}),e[65]||(e[65]=g(" 导出配置 ",-1))]),_:1}),l(ue,{"before-upload":se,"show-file-list":!1,accept:".json"},{default:t(()=>[l(V,{type:"success"},{default:t(()=>[l(q,null,{default:t(()=>[l(D(ve))]),_:1}),e[66]||(e[66]=g(" 导入配置 ",-1))]),_:1})]),_:1}),l(V,{type:"warning",onClick:ne},{default:t(()=>[l(q,null,{default:t(()=>[l(D(be))]),_:1}),e[67]||(e[67]=g(" 恢复默认 ",-1))]),_:1})])]),_:1})])])}}}),Me=ke(Ie,[["__scopeId","data-v-0aa89491"]]);export{Me as default};
