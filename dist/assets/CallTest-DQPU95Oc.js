var $=(M,_,R)=>new Promise((v,D)=>{var d=E=>{try{r(R.next(E))}catch(b){D(b)}},O=E=>{try{r(R.throw(E))}catch(b){D(b)}},r=E=>E.done?v(E.value):Promise.resolve(E.value).then(d,O);r((R=R.apply(M,_)).next())});import{u as X}from"./call-C9NCWzRc.js";import{w as g,_ as Y,u as Z,C as I}from"./settings-CuxbDWOu.js";import{E as l}from"./elementPlus-Bmwh7Rh8.js";import{l as j,r as T,ag as y,m as f,p as C,U as o,O as a,q as i,Q as K,F as L,a9 as P,T as k,S as m,J as H,M as J,e as w,c as ee}from"./vendor-D8Vxqhr-.js";import"./utils-ywHRn0uI.js";const se={class:"permission-test"},te={class:"card-header"},le={class:"permission-grid"},ae={class:"permission-info"},oe={class:"permission-name"},ne={class:"permission-desc"},ie={class:"permission-status"},re={class:"test-buttons"},ce={key:0,class:"test-results"},de={class:"results-list"},ue={class:"result-time"},me={class:"result-message"},_e=j({__name:"CallPermissionTest",setup(M){const _=T([{id:"admin",name:"超级管理员"},{id:"manager",name:"部门经理"},{id:"sales001",name:"销售员工"},{id:"service001",name:"客服员工"}]),R=T("admin"),v=T([{type:"MAKE_CALL",name:"发起通话",description:"允许发起外呼通话"},{type:"VIEW_RECORDS",name:"查看记录",description:"允许查看通话记录"},{type:"PLAY_RECORDING",name:"播放录音",description:"允许播放通话录音"},{type:"DOWNLOAD_RECORDING",name:"下载录音",description:"允许下载通话录音"},{type:"EDIT_RECORDS",name:"编辑记录",description:"允许编辑通话记录"},{type:"DELETE_RECORDS",name:"删除记录",description:"允许删除通话记录"},{type:"MANAGE_CONFIG",name:"管理配置",description:"允许管理电话配置"},{type:"VIEW_STATISTICS",name:"查看统计",description:"允许查看通话统计"}]),D=T([]),d=A=>g.checkCallPermission(R.value,A).hasAccess,O=A=>{const t=_.value.find(N=>N.id===A);r(`切换到用户: ${t==null?void 0:t.name}`,!0),l.success(`已切换到用户: ${t==null?void 0:t.name}`)},r=(A,t)=>{D.value.unshift({time:new Date().toLocaleTimeString(),message:A,success:t})},E=()=>{d("MAKE_CALL")?(r("发起通话测试 - 权限验证通过",!0),l.success("发起通话权限验证通过")):(r("发起通话测试 - 权限验证失败",!1),l.error("无权限发起通话"))},b=()=>{d("VIEW_RECORDS")?(r("查看记录测试 - 权限验证通过",!0),l.success("查看记录权限验证通过")):(r("查看记录测试 - 权限验证失败",!1),l.error("无权限查看记录"))},u=()=>{d("PLAY_RECORDING")?(r("播放录音测试 - 权限验证通过",!0),l.success("播放录音权限验证通过")):(r("播放录音测试 - 权限验证失败",!1),l.error("无权限播放录音"))},U=()=>{d("DOWNLOAD_RECORDING")?(r("下载录音测试 - 权限验证通过",!0),l.success("下载录音权限验证通过")):(r("下载录音测试 - 权限验证失败",!1),l.error("无权限下载录音"))},V=()=>{d("EDIT_RECORDS")?(r("编辑记录测试 - 权限验证通过",!0),l.success("编辑记录权限验证通过")):(r("编辑记录测试 - 权限验证失败",!1),l.error("无权限编辑记录"))},G=()=>{d("DELETE_RECORDS")?(r("删除记录测试 - 权限验证通过",!0),l.success("删除记录权限验证通过")):(r("删除记录测试 - 权限验证失败",!1),l.error("无权限删除记录"))},W=()=>{d("MANAGE_CONFIG")?(r("管理配置测试 - 权限验证通过",!0),l.success("管理配置权限验证通过")):(r("管理配置测试 - 权限验证失败",!1),l.error("无权限管理配置"))},z=()=>{d("VIEW_STATISTICS")?(r("查看统计测试 - 权限验证通过",!0),l.success("查看统计权限验证通过")):(r("查看统计测试 - 权限验证失败",!1),l.error("无权限查看统计"))};return(A,t)=>{const N=y("el-option"),B=y("el-select"),x=y("el-tag"),s=y("el-button"),e=y("el-space"),c=y("el-card");return C(),f("div",se,[o(c,{class:"test-card"},{header:a(()=>[i("div",te,[t[1]||(t[1]=i("span",null,"通话权限测试",-1)),o(B,{modelValue:R.value,"onUpdate:modelValue":t[0]||(t[0]=n=>R.value=n),onChange:O,placeholder:"选择测试用户"},{default:a(()=>[(C(!0),f(L,null,P(_.value,n=>(C(),J(N,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),default:a(()=>[i("div",le,[(C(!0),f(L,null,P(v.value,n=>(C(),f("div",{class:"permission-item",key:n.type},[i("div",ae,[i("span",oe,k(n.name),1),i("span",ne,k(n.description),1)]),i("div",ie,[o(x,{type:d(n.type)?"success":"danger",size:"small"},{default:a(()=>[m(k(d(n.type)?"有权限":"无权限"),1)]),_:2},1032,["type"])])]))),128))]),i("div",re,[t[10]||(t[10]=i("h4",null,"功能测试按钮",-1)),o(e,{wrap:""},{default:a(()=>[o(s,{onClick:E,disabled:!d("MAKE_CALL"),type:"success",size:"small"},{default:a(()=>[...t[2]||(t[2]=[m(" 发起通话 ",-1)])]),_:1},8,["disabled"]),o(s,{onClick:b,disabled:!d("VIEW_RECORDS"),type:"primary",size:"small"},{default:a(()=>[...t[3]||(t[3]=[m(" 查看记录 ",-1)])]),_:1},8,["disabled"]),o(s,{onClick:u,disabled:!d("PLAY_RECORDING"),type:"info",size:"small"},{default:a(()=>[...t[4]||(t[4]=[m(" 播放录音 ",-1)])]),_:1},8,["disabled"]),o(s,{onClick:U,disabled:!d("DOWNLOAD_RECORDING"),type:"warning",size:"small"},{default:a(()=>[...t[5]||(t[5]=[m(" 下载录音 ",-1)])]),_:1},8,["disabled"]),o(s,{onClick:V,disabled:!d("EDIT_RECORDS"),type:"danger",size:"small"},{default:a(()=>[...t[6]||(t[6]=[m(" 编辑记录 ",-1)])]),_:1},8,["disabled"]),o(s,{onClick:G,disabled:!d("DELETE_RECORDS"),type:"danger",size:"small"},{default:a(()=>[...t[7]||(t[7]=[m(" 删除记录 ",-1)])]),_:1},8,["disabled"]),o(s,{onClick:W,disabled:!d("MANAGE_CONFIG"),type:"primary",size:"small"},{default:a(()=>[...t[8]||(t[8]=[m(" 管理配置 ",-1)])]),_:1},8,["disabled"]),o(s,{onClick:z,disabled:!d("VIEW_STATISTICS"),type:"success",size:"small"},{default:a(()=>[...t[9]||(t[9]=[m(" 查看统计 ",-1)])]),_:1},8,["disabled"])]),_:1})]),D.value.length>0?(C(),f("div",ce,[t[11]||(t[11]=i("h4",null,"测试结果",-1)),i("div",de,[(C(!0),f(L,null,P(D.value,(n,S)=>(C(),f("div",{key:S,class:H(["result-item",{success:n.success,error:!n.success}])},[i("span",ue,k(n.time),1),i("span",me,k(n.message),1)],2))),128))])])):K("",!0)]),_:1})])}}}),pe=Y(_e,[["__scopeId","data-v-b431f73b"]]),Ce={class:"call-test"},fe={class:"card-header"},Re={class:"test-section"},ye={class:"test-section"},ve={class:"test-section"},Ee={key:0,class:"test-results"},Se={class:"test-result-item"},De={class:"test-name"},ke={key:0,class:"test-details"},Ae=j({__name:"CallTest",setup(M){const _=X();Z();const R=T([{id:"admin",name:"超级管理员",role:"SUPER_ADMIN"},{id:"manager",name:"部门经理",role:"WHITELIST_MEMBER"},{id:"sales001",name:"销售员工",role:"REGULAR_USER"},{id:"service001",name:"客服员工",role:"REGULAR_USER"}]),v=T("admin"),D=T([]),d=w(()=>g.checkCallPermission(v.value,I.MAKE_CALL).hasAccess),O=w(()=>g.checkCallPermission(v.value,I.PLAY_RECORDING).hasAccess),r=w(()=>g.checkCallPermission(v.value,I.DOWNLOAD_RECORDING).hasAccess),E=w(()=>g.checkCallPermission(v.value,I.EDIT_RECORDS).hasAccess),b=w(()=>g.checkCallPermission(v.value,I.VIEW_STATISTICS).hasAccess),u=(s,e,c,n)=>{D.value.unshift({testName:s,success:e,message:c,timestamp:new Date().toLocaleString(),details:n})},U=s=>{v.value=s;const e=R.value.find(c=>c.id===s);l.success(`已切换到用户: ${e==null?void 0:e.name}`),u("用户切换",!0,`切换到用户: ${e==null?void 0:e.name} (${s})`)},V=s=>{const e=Object.values(I),c={};e.forEach(S=>{const h=g.checkCallPermission(s,S);c[S]={hasAccess:h.hasAccess,reason:h.reason}});const n=R.value.find(S=>S.id===s);u(`权限测试 - ${n==null?void 0:n.name}`,!0,`用户 ${n==null?void 0:n.name} 的权限检查完成`,c)},G=()=>$(this,null,function*(){try{const s={customerId:"test-customer-001",customerName:"测试客户",phone:"13800138000",purpose:"测试通话",notes:"这是一个测试通话",type:"outbound"};yield _.startCall(s),u("发起通话测试",!0,"通话发起成功",s),l.success("通话发起测试成功")}catch(s){u("发起通话测试",!1,`通话发起失败: ${s}`),l.error("通话发起测试失败")}}),W=()=>$(this,null,function*(){try{yield _.playRecording("test-call-001"),u("播放录音测试",!0,"录音播放成功"),l.success("录音播放测试成功")}catch(s){u("播放录音测试",!1,`录音播放失败: ${s}`),l.error("录音播放测试失败")}}),z=()=>$(this,null,function*(){try{yield _.downloadRecording("test-call-001"),u("下载录音测试",!0,"录音下载成功"),l.success("录音下载测试成功")}catch(s){u("下载录音测试",!1,`录音下载失败: ${s}`),l.error("录音下载测试失败")}}),A=()=>{try{u("编辑记录测试",!0,"记录编辑功能正常"),l.success("编辑记录测试成功")}catch(s){u("编辑记录测试",!1,`记录编辑失败: ${s}`),l.error("编辑记录测试失败")}},t=()=>{try{const s={todayCallCount:_.todayCallCount,todayCallDuration:_.todayCallDuration,totalRecords:_.callRecords.length};u("查看统计测试",!0,"统计数据获取成功",s),l.success("查看统计测试成功")}catch(s){u("查看统计测试",!1,`统计数据获取失败: ${s}`),l.error("查看统计测试失败")}},N=()=>$(this,null,function*(){try{yield _.loadCallRecords("test-customer-001"),u("数据同步测试",!0,"数据同步成功"),l.success("数据同步测试成功")}catch(s){u("数据同步测试",!1,`数据同步失败: ${s}`),l.error("数据同步测试失败")}}),B=()=>{try{const s={callRecords:_.callRecords.length,followUpRecords:_.followUpRecords.length,currentCall:_.currentCall,isCallActive:_.isCallActive};u("Store集成测试",!0,"Store状态正常",s),l.success("Store集成测试成功")}catch(s){u("Store集成测试",!1,`Store集成失败: ${s}`),l.error("Store集成测试失败")}},x=()=>{try{const e=Object.values(I).map(c=>({permission:c,hasAccess:g.checkCallPermission(v.value,c).hasAccess}));u("权限同步测试",!0,"权限同步正常",e),l.success("权限同步测试成功")}catch(s){u("权限同步测试",!1,`权限同步失败: ${s}`),l.error("权限同步测试失败")}};return ee(()=>{u("系统初始化",!0,"通话功能测试页面加载完成")}),(s,e)=>{const c=y("el-button"),n=y("el-tag"),S=y("el-space"),h=y("el-timeline-item"),q=y("el-timeline"),Q=y("el-card");return C(),f("div",Ce,[o(pe),o(Q,{class:"test-card"},{header:a(()=>[i("div",fe,[e[1]||(e[1]=i("span",null,"通话功能测试",-1)),o(c,{type:"primary",onClick:s.refreshData},{default:a(()=>[...e[0]||(e[0]=[m("刷新数据",-1)])]),_:1},8,["onClick"])])]),default:a(()=>[i("div",Re,[e[4]||(e[4]=i("h3",null,"权限测试",-1)),o(S,{direction:"vertical",style:{width:"100%"}},{default:a(()=>[(C(!0),f(L,null,P(R.value,p=>(C(),f("div",{key:p.id,class:"user-test"},[o(n,{type:p.role==="SUPER_ADMIN"?"success":p.role==="WHITELIST_MEMBER"?"warning":"info"},{default:a(()=>[m(k(p.name)+" ("+k(p.role)+") ",1)]),_:2},1032,["type"]),o(S,null,{default:a(()=>[o(c,{size:"small",onClick:F=>V(p.id)},{default:a(()=>[...e[2]||(e[2]=[m("测试权限",-1)])]),_:1},8,["onClick"]),o(c,{size:"small",onClick:F=>U(p.id),type:"primary"},{default:a(()=>[...e[3]||(e[3]=[m("切换用户",-1)])]),_:1},8,["onClick"])]),_:2},1024)]))),128))]),_:1})]),i("div",ye,[e[10]||(e[10]=i("h3",null,"通话功能测试",-1)),o(S,{direction:"vertical",style:{width:"100%"}},{default:a(()=>[o(c,{onClick:G,disabled:!d.value},{default:a(()=>[...e[5]||(e[5]=[m("测试发起通话",-1)])]),_:1},8,["disabled"]),o(c,{onClick:W,disabled:!O.value},{default:a(()=>[...e[6]||(e[6]=[m("测试播放录音",-1)])]),_:1},8,["disabled"]),o(c,{onClick:z,disabled:!r.value},{default:a(()=>[...e[7]||(e[7]=[m("测试下载录音",-1)])]),_:1},8,["disabled"]),o(c,{onClick:A,disabled:!E.value},{default:a(()=>[...e[8]||(e[8]=[m("测试编辑记录",-1)])]),_:1},8,["disabled"]),o(c,{onClick:t,disabled:!b.value},{default:a(()=>[...e[9]||(e[9]=[m("测试查看统计",-1)])]),_:1},8,["disabled"])]),_:1})]),i("div",ve,[e[14]||(e[14]=i("h3",null,"数据同步测试",-1)),o(S,{direction:"vertical",style:{width:"100%"}},{default:a(()=>[o(c,{onClick:N},{default:a(()=>[...e[11]||(e[11]=[m("测试数据同步",-1)])]),_:1}),o(c,{onClick:B},{default:a(()=>[...e[12]||(e[12]=[m("测试Store集成",-1)])]),_:1}),o(c,{onClick:x},{default:a(()=>[...e[13]||(e[13]=[m("测试权限同步",-1)])]),_:1})]),_:1})]),D.value.length>0?(C(),f("div",Ee,[e[15]||(e[15]=i("h3",null,"测试结果",-1)),o(q,null,{default:a(()=>[(C(!0),f(L,null,P(D.value,(p,F)=>(C(),J(h,{key:F,type:p.success?"success":"danger",timestamp:p.timestamp},{default:a(()=>[i("div",Se,[i("div",De,k(p.testName),1),i("div",{class:H(["test-message",{error:!p.success}])},k(p.message),3),p.details?(C(),f("div",ke,[i("pre",null,k(JSON.stringify(p.details,null,2)),1)])):K("",!0)])]),_:2},1032,["type","timestamp"]))),128))]),_:1})])):K("",!0)]),_:1})])}}}),$e=Y(Ae,[["__scopeId","data-v-9f55834f"]]);export{$e as default};
