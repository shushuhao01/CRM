var $e=Object.defineProperty,Me=Object.defineProperties;var Ye=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var oe=(p,s,u)=>s in p?$e(p,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):p[s]=u,K=(p,s)=>{for(var u in s||(s={}))Te.call(s,u)&&oe(p,u,s[u]);if(te)for(var u of te(s))Ie.call(s,u)&&oe(p,u,s[u]);return p},Z=(p,s)=>Me(p,Ye(s));var U=(p,s,u)=>new Promise((S,N)=>{var $=h=>{try{R(u.next(h))}catch(V){N(V)}},M=h=>{try{R(u.throw(h))}catch(V){N(V)}},R=h=>h.done?S(h.value):Promise.resolve(h.value).then($,M);R((u=u.apply(p,s)).next())});import{u as Oe}from"./call-C9NCWzRc.js";import{l as je,az as qe,r as v,Z as q,c as Be,ag as d,aq as Ee,m as G,p as F,q as C,U as e,S as n,O as t,u as _,P as He,M as J,T as D}from"./vendor-D8Vxqhr-.js";import{c as Le,_ as Ae}from"./settings-CuxbDWOu.js";import{m as Ke}from"./phone-DsAzMHsn.js";import{h as ae,n as Ze,s as Ge,j as ne,a5 as Je,T as Qe,v as We,a7 as Xe,K as el,E as i,b as se}from"./elementPlus-Bmwh7Rh8.js";import"./utils-ywHRn0uI.js";const ll={class:"outbound-list"},tl={class:"page-header"},ol={class:"header-content"},al={class:"page-title"},nl={class:"header-actions"},sl={class:"search-section"},rl={class:"table-section"},dl={class:"table-header"},ul={class:"table-actions"},il={key:1,style:{color:"#C0C4CC"}},cl={key:1,style:{color:"#C0C4CC"}},ml={class:"pagination-wrapper"},pl=je({__name:"OutboundList",setup(p){const s=Oe(),u=qe(),S=Le(u),N=v(!1),$=v(!1),M=v(!1),R=v(!1),h=v([]),V=v([]),B=v(0),Y=v(!1),T=v(!1),I=v(null),r=q({customerName:"",customerPhone:"",status:"",dateRange:[],callerId:""}),k=q({page:1,size:20}),b=q({customerPhone:"",customerName:"",notes:""}),O=v(),re={customerPhone:[{required:!0,message:"请输入客户电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],customerName:[{required:!0,message:"请输入客户姓名",trigger:"blur"}]},w=q({type:"",content:"",nextFollowUpTime:""}),j=v(),de={type:[{required:!0,message:"请选择跟进类型",trigger:"change"}],content:[{required:!0,message:"请输入跟进内容",trigger:"blur"}]},ue=a=>new Date(a).toLocaleString("zh-CN"),ie=a=>{if(a<60)return`${a}秒`;const l=Math.floor(a/60),E=a%60;return`${l}分${E}秒`},ce=a=>({connected:"success",missed:"warning",rejected:"danger",failed:"info"})[a]||"info",me=a=>({connected:"已接通",missed:"未接听",rejected:"拒接",failed:"失败"})[a]||"未知",x=()=>U(this,null,function*(){try{N.value=!0;const a=Z(K({page:k.page,size:k.size},r),{startDate:r.dateRange[0],endDate:r.dateRange[1]}),l=yield s.fetchCallRecords(a);h.value=l.records,B.value=l.total}catch(a){console.error("加载呼出记录失败:",a),i.error("加载数据失败")}finally{N.value=!1}}),Q=()=>{k.page=1,x()},pe=()=>{Object.assign(r,{customerName:"",customerPhone:"",status:"",dateRange:[],callerId:""}),Q()},fe=a=>{V.value=a},ge=a=>{k.size=a,x()},ve=a=>{k.page=a,x()},_e=()=>U(this,null,function*(){if(O.value)try{yield O.value.validate(),M.value=!0,yield s.makeOutboundCall({customerPhone:b.customerPhone,customerName:b.customerName,notes:b.notes}),i.success("外呼已发起"),Y.value=!1,O.value.resetFields(),Object.assign(b,{customerPhone:"",customerName:"",notes:""}),x()}catch(a){console.error("发起外呼失败:",a),i.error("发起外呼失败")}finally{M.value=!1}}),be=a=>U(this,null,function*(){try{yield s.makeOutboundCall({customerPhone:a.customerPhone,customerName:a.customerName,notes:`再次呼叫 - 原记录ID: ${a.id}`}),i.success("外呼已发起"),x()}catch(l){console.error("再次呼叫失败:",l),i.error("再次呼叫失败")}}),we=a=>{if(!a.hasRecording){i.warning("该通话没有录音");return}S.push(`/service-management/call/recordings?recordId=${a.id}`)},ye=a=>{I.value=a,T.value=!0},Ce=()=>U(this,null,function*(){if(!(!j.value||!I.value))try{yield j.value.validate(),R.value=!0,yield s.createFollowUpRecord({callRecordId:I.value.id,customerId:I.value.customerId,type:w.type,content:w.content,nextFollowUpTime:w.nextFollowUpTime||void 0}),i.success("跟进记录已保存"),T.value=!1,j.value.resetFields(),Object.assign(w,{type:"",content:"",nextFollowUpTime:""}),x()}catch(a){console.error("保存跟进记录失败:",a),i.error("保存跟进记录失败")}finally{R.value=!1}}),he=a=>{S.push(`/customer-management/detail/${a}`)},Ve=a=>{S.push(`/service-management/call/records/${a.id}`)},ke=a=>{console.log("编辑记录:",a)},xe=a=>U(this,null,function*(){try{yield se.confirm("确定要删除这条通话记录吗？","确认删除",{type:"warning"}),yield s.deleteCallRecord(a.id),i.success("删除成功"),x()}catch(l){l!=="cancel"&&(console.error("删除记录失败:",l),i.error("删除失败"))}}),Ue=()=>U(this,null,function*(){try{yield se.confirm(`确定要删除选中的 ${V.value.length} 条记录吗？`,"批量删除",{type:"warning"});const a=V.value.map(l=>l.id);yield s.batchDeleteCallRecords(a),i.success("批量删除成功"),x()}catch(a){a!=="cancel"&&(console.error("批量删除失败:",a),i.error("批量删除失败"))}}),Re=()=>U(this,null,function*(){try{const a=V.value.map(l=>l.id);yield s.exportCallRecords({recordIds:a}),i.success("导出成功")}catch(a){console.error("批量导出失败:",a),i.error("批量导出失败")}}),De=()=>U(this,null,function*(){try{$.value=!0;const a=Z(K({},r),{startDate:r.dateRange[0],endDate:r.dateRange[1]});yield s.exportCallRecords(a),i.success("导出成功")}catch(a){console.error("导出失败:",a),i.error("导出失败")}finally{$.value=!1}});return Be(()=>{x()}),(a,l)=>{const E=d("PhoneOutgoing"),f=d("el-icon"),c=d("el-button"),z=d("el-input"),g=d("el-form-item"),m=d("el-option"),H=d("el-select"),W=d("el-date-picker"),L=d("el-form"),X=d("el-card"),y=d("el-table-column"),ee=d("el-tag"),A=d("el-dropdown-item"),Ne=d("el-dropdown-menu"),ze=d("el-dropdown"),Pe=d("el-table"),Fe=d("el-pagination"),le=d("el-dialog"),Se=Ee("loading");return F(),G("div",ll,[C("div",tl,[C("div",ol,[C("h1",al,[e(f,null,{default:t(()=>[e(E)]),_:1}),l[18]||(l[18]=n(" 呼出列表 ",-1))]),l[19]||(l[19]=C("p",{class:"page-description"},"管理所有外呼记录，支持批量操作和数据导出",-1))]),C("div",nl,[e(c,{type:"primary",onClick:l[0]||(l[0]=o=>Y.value=!0)},{default:t(()=>[e(f,null,{default:t(()=>[e(_(ae))]),_:1}),l[20]||(l[20]=n(" 发起外呼 ",-1))]),_:1}),e(c,{onClick:De,loading:$.value},{default:t(()=>[e(f,null,{default:t(()=>[e(_(Ze))]),_:1}),l[21]||(l[21]=n(" 导出记录 ",-1))]),_:1},8,["loading"])])]),C("div",sl,[e(X,null,{default:t(()=>[e(L,{model:r,inline:""},{default:t(()=>[e(g,{label:"客户姓名"},{default:t(()=>[e(z,{modelValue:r.customerName,"onUpdate:modelValue":l[1]||(l[1]=o=>r.customerName=o),placeholder:"请输入客户姓名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(g,{label:"客户电话"},{default:t(()=>[e(z,{modelValue:r.customerPhone,"onUpdate:modelValue":l[2]||(l[2]=o=>r.customerPhone=o),placeholder:"请输入客户电话",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(g,{label:"通话状态"},{default:t(()=>[e(H,{modelValue:r.status,"onUpdate:modelValue":l[3]||(l[3]=o=>r.status=o),placeholder:"请选择状态",clearable:"",style:{width:"150px"}},{default:t(()=>[e(m,{label:"全部",value:""}),e(m,{label:"已接通",value:"connected"}),e(m,{label:"未接听",value:"missed"}),e(m,{label:"拒接",value:"rejected"}),e(m,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"呼叫时间"},{default:t(()=>[e(W,{modelValue:r.dateRange,"onUpdate:modelValue":l[4]||(l[4]=o=>r.dateRange=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(g,{label:"呼叫人员"},{default:t(()=>[e(H,{modelValue:r.callerId,"onUpdate:modelValue":l[5]||(l[5]=o=>r.callerId=o),placeholder:"请选择人员",clearable:"",style:{width:"150px"}},{default:t(()=>[e(m,{label:"全部",value:""}),e(m,{label:"张三",value:"1"}),e(m,{label:"李四",value:"2"}),e(m,{label:"王五",value:"3"})]),_:1},8,["modelValue"])]),_:1}),e(g,null,{default:t(()=>[e(c,{type:"primary",onClick:Q},{default:t(()=>[e(f,null,{default:t(()=>[e(_(Ge))]),_:1}),l[22]||(l[22]=n(" 搜索 ",-1))]),_:1}),e(c,{onClick:pe},{default:t(()=>[...l[23]||(l[23]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),C("div",rl,[e(X,null,{header:t(()=>[C("div",dl,[C("span",null,"呼出记录 (共 "+D(B.value)+" 条)",1),C("div",ul,[e(c,{size:"small",disabled:!V.value.length,onClick:Ue},{default:t(()=>[...l[24]||(l[24]=[n(" 批量删除 ",-1)])]),_:1},8,["disabled"]),e(c,{size:"small",disabled:!V.value.length,onClick:Re},{default:t(()=>[...l[25]||(l[25]=[n(" 批量导出 ",-1)])]),_:1},8,["disabled"])])])]),default:t(()=>[He((F(),J(Pe,{data:h.value,onSelectionChange:fe,style:{width:"100%"}},{default:t(()=>[e(y,{type:"selection",width:"55"}),e(y,{prop:"customerName",label:"客户姓名",width:"120"},{default:t(({row:o})=>[e(c,{text:"",onClick:P=>he(o.customerId)},{default:t(()=>[n(D(o.customerName),1)]),_:2},1032,["onClick"])]),_:1}),e(y,{prop:"customerPhone",label:"客户电话",width:"140"},{default:t(({row:o})=>[n(D(_(Ke)(o.customerPhone)),1)]),_:1}),e(y,{prop:"callerName",label:"呼叫人员",width:"100"}),e(y,{prop:"startTime",label:"呼叫时间",width:"160"},{default:t(({row:o})=>[n(D(ue(o.startTime)),1)]),_:1}),e(y,{prop:"duration",label:"通话时长",width:"100"},{default:t(({row:o})=>[n(D(ie(o.duration)),1)]),_:1}),e(y,{prop:"status",label:"通话状态",width:"100"},{default:t(({row:o})=>[e(ee,{type:ce(o.status)},{default:t(()=>[n(D(me(o.status)),1)]),_:2},1032,["type"])]),_:1}),e(y,{prop:"hasRecording",label:"录音",width:"80"},{default:t(({row:o})=>[o.hasRecording?(F(),J(f,{key:0,color:"#67C23A"},{default:t(()=>[e(_(ne))]),_:1})):(F(),G("span",il,"无"))]),_:1}),e(y,{prop:"followUpStatus",label:"跟进状态",width:"100"},{default:t(({row:o})=>[o.followUpStatus?(F(),J(ee,{key:0,type:o.followUpStatus==="pending"?"warning":"success",size:"small"},{default:t(()=>[n(D(o.followUpStatus==="pending"?"待跟进":"已跟进"),1)]),_:2},1032,["type"])):(F(),G("span",cl,"无需跟进"))]),_:1}),e(y,{prop:"notes",label:"备注","min-width":"150","show-overflow-tooltip":""}),e(y,{label:"操作",width:"200",fixed:"right"},{default:t(({row:o})=>[e(c,{text:"",size:"small",onClick:P=>be(o)},{default:t(()=>[e(f,null,{default:t(()=>[e(_(ae))]),_:1}),l[26]||(l[26]=n(" 再次呼叫 ",-1))]),_:1},8,["onClick"]),e(c,{text:"",size:"small",onClick:P=>we(o),disabled:!o.hasRecording},{default:t(()=>[e(f,null,{default:t(()=>[e(_(ne))]),_:1}),l[27]||(l[27]=n(" 播放录音 ",-1))]),_:1},8,["onClick","disabled"]),e(c,{text:"",size:"small",onClick:P=>ye(o)},{default:t(()=>[e(f,null,{default:t(()=>[e(_(Je))]),_:1}),l[28]||(l[28]=n(" 添加跟进 ",-1))]),_:1},8,["onClick"]),e(ze,null,{dropdown:t(()=>[e(Ne,null,{default:t(()=>[e(A,{onClick:P=>Ve(o)},{default:t(()=>[e(f,null,{default:t(()=>[e(_(We))]),_:1}),l[30]||(l[30]=n(" 查看详情 ",-1))]),_:1},8,["onClick"]),e(A,{onClick:P=>ke(o)},{default:t(()=>[e(f,null,{default:t(()=>[e(_(Xe))]),_:1}),l[31]||(l[31]=n(" 编辑记录 ",-1))]),_:1},8,["onClick"]),e(A,{onClick:P=>xe(o),divided:""},{default:t(()=>[e(f,null,{default:t(()=>[e(_(el))]),_:1}),l[32]||(l[32]=n(" 删除记录 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),default:t(()=>[e(c,{text:"",size:"small"},{default:t(()=>[l[29]||(l[29]=n(" 更多",-1)),e(f,null,{default:t(()=>[e(_(Qe))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Se,N.value]]),C("div",ml,[e(Fe,{"current-page":k.page,"onUpdate:currentPage":l[6]||(l[6]=o=>k.page=o),"page-size":k.size,"onUpdate:pageSize":l[7]||(l[7]=o=>k.size=o),"page-sizes":[10,20,50,100],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ge,onCurrentChange:ve},null,8,["current-page","page-size","total"])])]),_:1})]),e(le,{modelValue:Y.value,"onUpdate:modelValue":l[12]||(l[12]=o=>Y.value=o),title:"发起外呼",width:"500px","close-on-click-modal":!1},{footer:t(()=>[e(c,{onClick:l[11]||(l[11]=o=>Y.value=!1)},{default:t(()=>[...l[33]||(l[33]=[n("取消",-1)])]),_:1}),e(c,{type:"primary",onClick:_e,loading:M.value},{default:t(()=>[...l[34]||(l[34]=[n(" 开始呼叫 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(L,{model:b,rules:re,ref_key:"outboundFormRef",ref:O,"label-width":"80px"},{default:t(()=>[e(g,{label:"客户电话",prop:"customerPhone"},{default:t(()=>[e(z,{modelValue:b.customerPhone,"onUpdate:modelValue":l[8]||(l[8]=o=>b.customerPhone=o),placeholder:"请输入客户电话号码",maxlength:"11"},null,8,["modelValue"])]),_:1}),e(g,{label:"客户姓名",prop:"customerName"},{default:t(()=>[e(z,{modelValue:b.customerName,"onUpdate:modelValue":l[9]||(l[9]=o=>b.customerName=o),placeholder:"请输入客户姓名"},null,8,["modelValue"])]),_:1}),e(g,{label:"呼叫备注"},{default:t(()=>[e(z,{modelValue:b.notes,"onUpdate:modelValue":l[10]||(l[10]=o=>b.notes=o),type:"textarea",rows:3,placeholder:"请输入呼叫备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(le,{modelValue:T.value,"onUpdate:modelValue":l[17]||(l[17]=o=>T.value=o),title:"添加跟进记录",width:"600px","close-on-click-modal":!1},{footer:t(()=>[e(c,{onClick:l[16]||(l[16]=o=>T.value=!1)},{default:t(()=>[...l[35]||(l[35]=[n("取消",-1)])]),_:1}),e(c,{type:"primary",onClick:Ce,loading:R.value},{default:t(()=>[...l[36]||(l[36]=[n(" 保存 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(L,{model:w,rules:de,ref_key:"followUpFormRef",ref:j,"label-width":"100px"},{default:t(()=>[e(g,{label:"跟进类型",prop:"type"},{default:t(()=>[e(H,{modelValue:w.type,"onUpdate:modelValue":l[13]||(l[13]=o=>w.type=o),placeholder:"请选择跟进类型"},{default:t(()=>[e(m,{label:"电话跟进",value:"phone"}),e(m,{label:"微信跟进",value:"wechat"}),e(m,{label:"邮件跟进",value:"email"}),e(m,{label:"上门拜访",value:"visit"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"跟进内容",prop:"content"},{default:t(()=>[e(z,{modelValue:w.content,"onUpdate:modelValue":l[14]||(l[14]=o=>w.content=o),type:"textarea",rows:4,placeholder:"请输入跟进内容"},null,8,["modelValue"])]),_:1}),e(g,{label:"下次跟进"},{default:t(()=>[e(W,{modelValue:w.nextFollowUpTime,"onUpdate:modelValue":l[15]||(l[15]=o=>w.nextFollowUpTime=o),type:"datetime",placeholder:"选择下次跟进时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Cl=Ae(pl,[["__scopeId","data-v-1cc0e8c1"]]);export{Cl as default};
