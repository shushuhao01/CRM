var C=Object.defineProperty,h=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var T=(r,n,c)=>n in r?C(r,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):r[n]=c,p=(r,n)=>{for(var c in n||(n={}))b.call(n,c)&&T(r,c,n[c]);if(g)for(var c of g(n))P.call(n,c)&&T(r,c,n[c]);return r},N=(r,n)=>h(r,B(n));var d=(r,n,c)=>new Promise((f,a)=>{var m=u=>{try{S(c.next(u))}catch(l){a(l)}},w=u=>{try{S(c.throw(u))}catch(l){a(l)}},S=u=>u.done?f(u.value):Promise.resolve(u.value).then(m,w);S((c=c.apply(r,n)).next())});import{K as O,t as I,j as x}from"./settings-CuxbDWOu.js";import{r as A,e as v}from"./vendor-D8Vxqhr-.js";const F=O("service",()=>{const r=A([{id:"1",serviceNumber:"SH202401150001",orderId:"13",orderNumber:"ORD202401150013",customerId:"13",customerName:"已发货用户",customerPhone:"13800138013",serviceType:"return",status:"processing",priority:"normal",reason:"商品质量问题",description:"收到的商品有明显的质量缺陷，希望退货处理",createTime:"2024-01-16 10:30:00",createdBy:"customer",assignedTo:"客服小王",updateTime:"2024-01-16 14:20:00",expectedTime:"2024-01-18 18:00:00",remark:"客户要求尽快处理",attachments:["defect1.jpg","defect2.jpg"],productName:"已发货产品",productSpec:"标准版",quantity:1,price:800,contactAddress:"深圳市南山区科技园",contactName:"已发货用户"}]),n=v(()=>r.value.length),c=v(()=>r.value),f=v(()=>r.value.filter(e=>e.status==="pending")),a=v(()=>r.value.filter(e=>e.status==="processing")),m=e=>{const t=p({id:Date.now().toString(),serviceNumber:`SH${Date.now()}`,createTime:new Date().toISOString().slice(0,19).replace("T"," ")},e);return r.value.push(t),t};return{services:r,serviceCount:n,afterSalesServices:c,pendingServices:f,processingServices:a,addService:m,updateService:(e,t)=>{const s=r.value.findIndex(o=>o.id===e);return s!==-1?(r.value[s]=N(p(p({},r.value[s]),t),{updateTime:new Date().toISOString().slice(0,19).replace("T"," ")}),r.value[s]):null},deleteService:e=>{const t=r.value.findIndex(s=>s.id===e);if(t!==-1){const s=r.value[t];if(s.serviceType==="return"&&s.customerId){const o=I(),i=o.customers.find(y=>y.id===s.customerId);i&&i.returnCount&&i.returnCount>0&&o.updateCustomerStats(s.customerId,{returnCount:i.returnCount-1})}return r.value.splice(t,1),!0}return!1},getServiceById:e=>r.value.find(t=>t.id===e),getServicesByOrderId:e=>r.value.filter(t=>t.orderId===e),getServicesByCustomerId:e=>r.value.filter(t=>t.customerId===e),checkExistingAfterSales:e=>d(void 0,null,function*(){return yield new Promise(t=>setTimeout(t,500)),e.includes("202")&&Math.random()>.7&&r.value.find(t=>t.orderNumber===e)||null}),createService:e=>d(void 0,null,function*(){return yield new Promise(s=>setTimeout(s,500)),m(e)}),getServicesByStatus:e=>d(void 0,null,function*(){return yield new Promise(t=>setTimeout(t,300)),r.value.filter(t=>t.status===e)}),createAfterSalesService:e=>d(void 0,null,function*(){yield new Promise(s=>setTimeout(s,1e3));const t={id:`SH${Date.now()}`,serviceNumber:`SH${Date.now()}`,orderId:e.orderId||"",orderNumber:e.orderNumber||"",customerId:e.customerId||"",customerName:e.customerName||"",customerPhone:e.customerPhone||"",serviceType:e.serviceType||"return",status:"pending",priority:e.priority||"normal",reason:e.reason||"",description:e.description||"",productName:e.productName||"",productSpec:e.productSpec||"",quantity:e.quantity||1,price:e.price||0,createTime:new Date().toISOString().slice(0,19).replace("T"," "),createdBy:e.createdBy||"customer",assignedTo:e.assignedTo||"",updateTime:new Date().toISOString().slice(0,19).replace("T"," "),attachments:e.attachments||[]};if(r.value.unshift(t),t.orderNumber){const s=x(),o=s.orders.find(i=>i.orderNumber===t.orderNumber);o&&(s.createAfterSales(o.id,t.createdBy,t.reason),console.log(`订单 ${t.orderNumber} 状态已更新为已建售后`))}if(t.serviceType==="return"&&t.customerId){const s=I(),o=s.customers.find(i=>i.id===t.customerId);o&&s.updateCustomerStats(t.customerId,{returnCount:(o.returnCount||0)+1})}return window.dispatchEvent(new CustomEvent("after-sales-update",{detail:{orderId:t.orderId,serviceId:t.id,action:"create",service:t}})),t}),updateServiceStatus:(e,t,s)=>d(void 0,null,function*(){yield new Promise(i=>setTimeout(i,500));const o=r.value.find(i=>i.id===e);if(o){const i=o.status;o.status=t,o.updateTime=new Date().toISOString().slice(0,19).replace("T"," "),s&&(o.remark=s),(t==="resolved"||t==="closed")&&i!=="resolved"&&i!=="closed"&&o.serviceType==="return"&&o.customerId&&I().updateCustomerStats(o.customerId,{lastServiceDate:o.updateTime}),window.dispatchEvent(new CustomEvent("service-status-update",{detail:{orderId:o.orderId,serviceId:o.id,oldStatus:i,newStatus:t,service:o}}))}}),loadAfterSalesServices:()=>d(void 0,null,function*(){return yield new Promise(e=>setTimeout(e,500)),r.value})}});export{F as u};
