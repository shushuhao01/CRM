var Ge=Object.defineProperty,Je=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var ye=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable;var ke=(C,k,f)=>k in C?Ge(C,k,{enumerable:!0,configurable:!0,writable:!0,value:f}):C[k]=f,be=(C,k)=>{for(var f in k||(k={}))Ke.call(k,f)&&ke(C,f,k[f]);if(ye)for(var f of ye(k))Ze.call(k,f)&&ke(C,f,k[f]);return C},we=(C,k)=>Je(C,Qe(k));var R=(C,k,f)=>new Promise((O,q)=>{var V=P=>{try{S(f.next(P))}catch(M){q(M)}},h=P=>{try{S(f.throw(P))}catch(M){q(M)}},S=P=>P.done?O(P.value):Promise.resolve(P.value).then(V,h);S((f=f.apply(C,k)).next())});import{l as We,az as Xe,aC as et,r as I,Z as Te,e as X,c as tt,ag as v,m as y,p as m,q as t,U as a,u as T,T as r,O as s,S as c,M as B,Q as j,F as Ce,a9 as Se,J as he}from"./vendor-D8Vxqhr-.js";import{a3 as at,a7 as ie,P as ot,T as st,v as ee,p as lt,q as nt,aE as it,b as Pe,E as U}from"./elementPlus-Bmwh7Rh8.js";import{g as rt,u as dt,i as ut,c as ct,_ as pt}from"./settings-CuxbDWOu.js";import{u as mt}from"./product-DLyzXkG9.js";import"./utils-ywHRn0uI.js";const vt={class:"product-detail"},ft={class:"page-header"},_t={class:"header-left"},gt={class:"header-info"},yt={class:"header-meta"},kt={class:"product-code"},bt={class:"header-actions"},wt={class:"detail-content"},Tt={class:"product-basic"},Ct={class:"product-images"},St={class:"image-list"},ht={class:"product-info"},Pt={class:"info-row"},Nt={class:"info-row"},Dt={class:"info-row"},It={class:"info-row"},Vt={class:"info-row"},$t={class:"info-row"},xt={class:"info-row"},Rt={class:"info-row"},Ot={class:"info-row"},qt={class:"description"},Mt={class:"price-info"},At={class:"info-item"},Et={class:"price"},Ft={class:"info-item"},Ut={key:0},Lt={key:1,class:"sensitive-info"},Bt={class:"info-item"},jt={class:"stock-info"},zt={class:"info-item"},Ht={key:1,class:"sensitive-info"},Yt={class:"info-item"},Gt={key:0},Jt={key:1,class:"sensitive-info"},Qt={class:"info-item"},Kt={key:0},Zt={key:1,class:"sensitive-info"},Wt={class:"stat-item"},Xt={class:"stat-value"},ea={class:"stat-item"},ta={class:"stat-value"},aa={class:"stat-item"},oa={class:"stat-value"},sa={class:"stat-item"},la={class:"stat-value"},na={class:"card-header"},ia={key:0,class:"empty-data"},ra={class:"status-info"},da={class:"status-item"},ua={class:"status-item"},ca={class:"status-item"},pa={class:"status-item"},ma={class:"status-item"},va={class:"quick-actions"},fa={key:0,class:"related-stats"},_a={class:"stat-row"},ga={class:"stat-value"},ya={class:"stat-row"},ka={class:"stat-value"},ba={class:"stat-row"},wa={class:"stat-value"},Ta={class:"stat-row"},Ca={class:"stat-value"},Sa={class:"stat-row"},ha={class:"stat-value"},Pa={key:1,class:"empty-data"},Na={key:0,class:"operation-logs"},Da={class:"log-time"},Ia={class:"log-content"},Va={class:"log-operator"},$a={class:"log-action"},xa={key:0,class:"log-detail"},Ra={key:1,class:"empty-data"},Oa={class:"dialog-footer"},qa={key:0},Ma={class:"dialog-footer"},Aa=We({__name:"Detail",setup(C){const k=Xe(),f=et(),O=ct(k),q=rt(),V=mt(),h=dt(),S=ut(),P=I(!1),M=I(!1),te=I(!1),K=I(!1),l=I({id:"",code:"",name:"",categoryName:"",specification:"",brand:"",unit:"",weight:0,dimensions:"",description:"",price:0,costPrice:0,marketPrice:0,stock:0,minStock:0,maxStock:0,salesCount:0,salesAmount:0,viewCount:0,favoriteCount:0,status:"",mainImage:"",images:[],createTime:"",updateTime:"",creator:"",updater:""}),w=Te({type:"increase",quantity:0,reason:"",remark:""}),p=Te({originalPrice:0,newPrice:0,reason:"",remark:""}),z=I([]),A=I({pendingOrders:0,monthlySales:0,turnoverRate:0,avgRating:0,returnRate:0}),L=I([]),Ne={type:[{required:!0,message:"请选择调整类型",trigger:"change"}],quantity:[{required:!0,message:"请输入调整数量",trigger:"blur"}],reason:[{required:!0,message:"请选择调整原因",trigger:"change"}]},De={newPrice:[{required:!0,message:"请输入新价格",trigger:"blur"},{type:"number",min:.01,message:"价格必须大于0.01",trigger:"blur"}],reason:[{required:!0,message:"请选择调价原因",trigger:"change"}]},ae=I(),oe=I(),Ie=X(()=>{var o;return S.productConfig.enablePermissionControl?h.isSuperAdmin||S.productConfig.costPriceViewRoles.includes(((o=h.userInfo)==null?void 0:o.role)||""):!0}),Ve=X(()=>{var o;return S.productConfig.enablePermissionControl?h.isSuperAdmin||S.productConfig.salesDataViewRoles.includes(((o=h.userInfo)==null?void 0:o.role)||""):!0}),H=X(()=>{var o;return S.productConfig.enablePermissionControl?h.isSuperAdmin||S.productConfig.stockInfoViewRoles.includes(((o=h.userInfo)==null?void 0:o.role)||""):!0}),$e=X(()=>{var o;return S.productConfig.enablePermissionControl?h.isSuperAdmin||S.productConfig.operationLogsViewRoles.includes(((o=h.userInfo)==null?void 0:o.role)||""):!0}),xe=()=>{k.back()},re=o=>({active:"success",inactive:"info",out_of_stock:"danger"})[o]||"",de=o=>({active:"上架",inactive:"下架",out_of_stock:"缺货"})[o]||o,Re=(o,e)=>o===0?"stock-out":o<=e?"stock-warning":"stock-normal",Oe=o=>({increase:"success",decrease:"warning",set:"info"})[o]||"",qe=o=>({increase:"增加",decrease:"减少",set:"设置"})[o]||o,Me=()=>{O.push(`/product/edit/${l.value.id}`)},se=()=>{Object.assign(w,{type:"increase",quantity:0,reason:"",remark:""}),M.value=!0},Ae=()=>{Object.assign(p,{originalPrice:l.value.price,newPrice:0,reason:"",remark:""}),K.value=!0},Ee=()=>{q.addNotification({type:"ORDER_CREATE_INITIATED",title:"创建订单",content:`正在为商品"${l.value.name}"创建订单`,data:{productId:l.value.id,productName:l.value.name,productCode:l.value.code,timestamp:new Date().toISOString()},link:`/order/add?productId=${l.value.id}`}),O.push(`/order/add?productId=${l.value.id}`)},ue=()=>R(this,null,function*(){const o=l.value.status==="active"?"下架":"上架";try{yield Pe.confirm(`确定要${o}商品"${l.value.name}"吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield new Promise(e=>setTimeout(e,500)),l.value.status=l.value.status==="active"?"inactive":"active",U.success(`${o}成功`),q.addNotification({type:"PRODUCT_STATUS_CHANGED",title:`商品${o}`,content:`商品"${l.value.name}"已${o}`,data:{productId:l.value.id,productName:l.value.name,productCode:l.value.code,status:l.value.status,action:o,timestamp:new Date().toISOString()},link:`/product/detail/${l.value.id}`}),Z()}catch(e){}}),Fe=o=>{switch(o){case"copy":Ue();break;case"toggle":ue();break;case"delete":Le();break}},Ue=()=>{O.push(`/product/add?copy=${l.value.id}`)},Le=()=>R(this,null,function*(){try{yield Pe.confirm(`确定要删除商品"${l.value.name}"吗？删除后不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield new Promise(o=>setTimeout(o,500)),U.success("删除成功"),q.addNotification({type:"PRODUCT_DELETED",title:"商品删除",content:`商品"${l.value.name}"已删除`,data:{productId:l.value.id,productName:l.value.name,productCode:l.value.code,timestamp:new Date().toISOString()},link:"/product/list"}),O.push("/product/list")}catch(o){}}),Be=()=>R(this,null,function*(){var o;try{yield(o=ae.value)==null?void 0:o.validate(),P.value=!0,yield new Promise(e=>setTimeout(e,1e3)),U.success("库存调整成功"),q.addNotification({type:"PRODUCT_STOCK_ADJUSTED",title:"库存调整",content:`商品"${l.value.name}"库存已调整`,data:{productId:l.value.id,productName:l.value.name,adjustmentType:w.value.type,quantity:w.value.quantity,reason:w.value.reason,remark:w.value.remark,timestamp:new Date().toISOString()},link:`/product/detail/${l.value.id}`}),le(),Z(),ce()}catch(e){console.error("表单验证失败:",e)}finally{P.value=!1}}),le=()=>{var o;M.value=!1,(o=ae.value)==null||o.clearValidate()},je=()=>R(this,null,function*(){var o;try{yield(o=oe.value)==null?void 0:o.validate(),te.value=!0,yield new Promise(i=>setTimeout(i,1e3));const e=l.value.price;l.value.price=p.newPrice,V.updateProduct(l.value.id,{price:p.newPrice}),U.success("价格调整成功");const n=p.newPrice-e,g=(n/e*100).toFixed(1);q.addNotification({type:"PRODUCT_PRICE_CHANGED",title:"价格调整",content:`商品"${l.value.name}"价格已调整`,data:{productId:l.value.id,productName:l.value.name,productCode:l.value.code,oldPrice:e,newPrice:p.newPrice,priceChange:n,changePercent:g,reason:p.reason,remark:p.remark,timestamp:new Date().toISOString()},link:`/product/detail/${l.value.id}`}),ne(),Z()}catch(e){console.error("表单验证失败:",e)}finally{te.value=!1}}),ne=()=>{var o;K.value=!1,(o=oe.value)==null||o.clearValidate()},Z=()=>R(this,null,function*(){try{const o=f.params.id;if(!o){U.error("商品ID不存在"),O.push("/product/list");return}yield new Promise(n=>setTimeout(n,800));let e=V.getProductById(o);!e&&!isNaN(Number(o))&&(e=V.getProductById(Number(o))),e?l.value=we(be({},e),{salesCount:e.salesCount||0,salesAmount:(e.salesCount||0)*e.price,viewCount:Math.floor(Math.random()*1e3)+500,favoriteCount:Math.floor(Math.random()*100)+10,mainImage:e.image,images:e.images||[e.image],createTime:e.createTime,updateTime:e.updateTime||e.createTime,creator:"系统",updater:"系统"}):(U.error("商品不存在"),O.push("/product/list"))}catch(o){U.error("加载商品信息失败")}}),ce=()=>R(this,null,function*(){try{const o=f.params.id,e=V.products.find(i=>i.id===o||i.id===Number(o));if(!e){z.value=[];return}const n=orderStore.orders.filter(i=>i.products.some(u=>u.id===o||u.id===Number(o))&&["shipped","delivered"].includes(i.status)),g=[];if(g.push({id:`initial_${o}`,type:"increase",quantity:e.stock,stockAfter:e.stock,reason:"商品创建",operator:"系统管理员",remark:"商品创建时的初始库存",createTime:e.createTime}),n.forEach(i=>{const u=i.products.find(E=>E.id===o||E.id===Number(o));u&&g.push({id:`sale_${i.id}`,type:"decrease",quantity:u.quantity,stockAfter:Math.max(0,e.stock-u.quantity),reason:"销售出库",operator:"系统",remark:`订单号：${i.orderNumber}`,createTime:i.shippingTime||i.createTime})}),e.stock<e.minStock){const i=e.maxStock-e.stock;g.push({id:`restock_${Date.now()}`,type:"increase",quantity:i,stockAfter:e.maxStock,reason:"补货入库",operator:"采购部",remark:"库存不足，紧急补货",createTime:new Date().toLocaleString("zh-CN")})}z.value=g.sort((i,u)=>new Date(u.createTime).getTime()-new Date(i.createTime).getTime())}catch(o){console.error("加载库存记录失败:",o),z.value=[]}}),ze=o=>{const e=h.user;return e?e.role==="super_admin"?o:e.role==="department_head"?o.filter(n=>{var g,i;return((g=n.salesPerson)==null?void 0:g.departmentId)===e.departmentId||((i=n.customerService)==null?void 0:i.departmentId)===e.departmentId}):e.role==="sales"?o.filter(n=>n.salesPersonId===e.id):e.role==="customer_service"?o.filter(n=>n.customerServiceId===e.id):o.filter(n=>n.salesPersonId===e.id||n.customerServiceId===e.id):[]},He=()=>R(this,null,function*(){try{const o=f.params.id,n=ze(orderStore.orders).filter(b=>b.products.some(_=>_.id===o||_.id===Number(o))),g=n.filter(b=>["pending_audit","pending_shipment"].includes(b.status)).length,i=new Date().getMonth(),u=new Date().getFullYear(),E=n.filter(b=>{const _=new Date(b.createTime);return _.getMonth()===i&&_.getFullYear()===u&&["shipped","delivered"].includes(b.status)}).reduce((b,_)=>{const F=_.products.find(W=>W.id===o||W.id===Number(o));return b+((F==null?void 0:F.quantity)||0)},0),Y=V.products.find(b=>b.id===o||b.id===Number(o)),G=Y?(Y.stock+Y.maxStock)/2:1,D=G>0?E/G*100:0,J=n.filter(b=>b.status==="delivered").length>0?4.2+Math.random()*.6:0,Q=n.filter(b=>["rejected","rejected_returned","logistics_returned"].includes(b.status)).length,x=n.length>0?Q/n.length*100:0;A.value={pendingOrders:g,monthlySales:E,turnoverRate:Number(D.toFixed(1)),avgRating:Number(J.toFixed(1)),returnRate:Number(x.toFixed(1))}}catch(o){console.error("加载统计数据失败:",o),A.value={pendingOrders:0,monthlySales:0,turnoverRate:0,avgRating:0,returnRate:0}}}),Ye=()=>R(this,null,function*(){try{const o=f.params.id,e=[],n=V.products.find(i=>i.id===o||i.id===Number(o));if(!n){L.value=[];return}e.push({id:`product_create_${o}`,operator:"系统管理员",action:"创建商品",detail:`商品"${n.name}"创建成功`,createTime:n.createTime}),orderStore.orders.filter(i=>i.products.some(u=>u.id===o||u.id===Number(o))).forEach(i=>{e.push({id:`order_create_${i.id}`,operator:i.createdBy||"客服",action:"创建订单",detail:`创建了包含商品"${n.name}"的订单 (订单号：${i.orderNumber})`,createTime:i.createTime}),i.statusHistory&&i.statusHistory.length>0&&i.statusHistory.forEach(u=>{e.push({id:`status_${i.id}_${u.time}`,operator:u.operator,action:"订单状态变更",detail:`${u.description} (订单号：${i.orderNumber})`,createTime:u.time})}),i.operationLogs&&i.operationLogs.length>0&&i.operationLogs.forEach(u=>{e.push({id:`order_${u.id}`,operator:u.operator,action:`订单${u.action}`,detail:`${u.description} (订单号：${i.orderNumber})`,createTime:u.time})})}),n.updateTime&&n.updateTime!==n.createTime&&e.push({id:`product_update_${o}`,operator:"商品管理员",action:"更新商品信息",detail:`商品"${n.name}"信息已更新`,createTime:n.updateTime}),n.stock!==n.minStock&&e.push({id:`stock_adjust_${o}`,operator:"库存管理员",action:"调整库存",detail:`当前库存：${n.stock}件`,createTime:new Date(Date.now()-Math.random()*7*24*60*60*1e3).toLocaleString("zh-CN")}),n.price!==n.marketPrice&&e.push({id:`price_adjust_${o}`,operator:"价格管理员",action:"调整价格",detail:`销售价格调整为：¥${n.price}`,createTime:new Date(Date.now()-Math.random()*14*24*60*60*1e3).toLocaleString("zh-CN")}),L.value=e.sort((i,u)=>new Date(u.createTime).getTime()-new Date(i.createTime).getTime()).slice(0,20)}catch(o){console.error("加载操作日志失败:",o);const e=f.params.id,n=V.products.find(g=>g.id===e||g.id===Number(e));n?L.value=[{id:`product_create_${e}`,operator:"系统管理员",action:"创建商品",detail:`商品"${n.name}"创建成功`,createTime:n.createTime}]:L.value=[]}});return tt(()=>{Z(),ce(),He(),Ye()}),(o,e)=>{const n=v("el-button"),g=v("el-tag"),i=v("el-icon"),u=v("el-dropdown-item"),E=v("el-dropdown-menu"),Y=v("el-dropdown"),G=v("el-image"),D=v("el-card"),$=v("el-col"),J=v("el-row"),Q=v("el-empty"),x=v("el-table-column"),b=v("el-table"),_=v("el-form-item"),F=v("el-radio"),W=v("el-radio-group"),pe=v("el-input-number"),N=v("el-option"),me=v("el-select"),ve=v("el-input"),fe=v("el-form"),_e=v("el-dialog");return m(),y("div",vt,[t("div",ft,[t("div",_t,[a(n,{onClick:xe,icon:T(at),circle:""},null,8,["icon"]),t("div",gt,[t("h2",null,r(l.value.name),1),t("div",yt,[t("span",kt,"商品编码："+r(l.value.code),1),a(g,{type:re(l.value.status),size:"small"},{default:s(()=>[c(r(de(l.value.status)),1)]),_:1},8,["type"])])])]),t("div",bt,[a(n,{onClick:se,icon:T(ie)},{default:s(()=>[...e[9]||(e[9]=[c(" 调库存 ",-1)])]),_:1},8,["icon"]),a(n,{onClick:Me,type:"primary",icon:T(ie)},{default:s(()=>[...e[10]||(e[10]=[c(" 编辑商品 ",-1)])]),_:1},8,["icon"]),a(Y,{onCommand:Fe},{dropdown:s(()=>[a(E,null,{default:s(()=>[a(u,{command:"copy"},{default:s(()=>[...e[12]||(e[12]=[c("复制商品",-1)])]),_:1}),a(u,{command:"toggle",divided:!0},{default:s(()=>[c(r(l.value.status==="active"?"下架":"上架"),1)]),_:1}),a(u,{command:"delete",class:"danger-item"},{default:s(()=>[...e[13]||(e[13]=[c(" 删除商品 ",-1)])]),_:1})]),_:1})]),default:s(()=>[a(n,{icon:T(ot)},{default:s(()=>[e[11]||(e[11]=c(" 更多",-1)),a(i,{class:"el-icon--right"},{default:s(()=>[a(T(st))]),_:1})]),_:1},8,["icon"])]),_:1})])]),t("div",wt,[a(J,{gutter:20},{default:s(()=>[a($,{span:16},{default:s(()=>[a(D,{class:"info-card",title:"基本信息"},{header:s(()=>[...e[14]||(e[14]=[t("span",null,"基本信息",-1)])]),default:s(()=>[t("div",Tt,[t("div",Ct,[a(G,{src:l.value.mainImage,"preview-src-list":l.value.images,fit:"cover",class:"main-image"},null,8,["src","preview-src-list"]),t("div",St,[(m(!0),y(Ce,null,Se(l.value.images,(d,ge)=>(m(),B(G,{key:ge,src:d,"preview-src-list":l.value.images,"initial-index":ge,fit:"cover",class:"thumb-image"},null,8,["src","preview-src-list","initial-index"]))),128))])]),t("div",ht,[t("div",Pt,[e[15]||(e[15]=t("label",null,"商品名称：",-1)),t("span",null,r(l.value.name),1)]),t("div",Nt,[e[16]||(e[16]=t("label",null,"商品编码：",-1)),t("span",null,r(l.value.code),1)]),t("div",Dt,[e[17]||(e[17]=t("label",null,"商品分类：",-1)),t("span",null,r(l.value.categoryName),1)]),t("div",It,[e[18]||(e[18]=t("label",null,"商品规格：",-1)),t("span",null,r(l.value.specification),1)]),t("div",Vt,[e[19]||(e[19]=t("label",null,"商品品牌：",-1)),t("span",null,r(l.value.brand),1)]),t("div",$t,[e[20]||(e[20]=t("label",null,"商品单位：",-1)),t("span",null,r(l.value.unit),1)]),t("div",xt,[e[21]||(e[21]=t("label",null,"商品重量：",-1)),t("span",null,r(l.value.weight)+"kg",1)]),t("div",Rt,[e[22]||(e[22]=t("label",null,"商品尺寸：",-1)),t("span",null,r(l.value.dimensions),1)]),t("div",Ot,[e[23]||(e[23]=t("label",null,"商品描述：",-1)),t("div",qt,r(l.value.description),1)])])])]),_:1}),a(D,{class:"info-card",title:"价格库存"},{header:s(()=>[...e[24]||(e[24]=[t("span",null,"价格库存",-1)])]),default:s(()=>[a(J,{gutter:20},{default:s(()=>[a($,{span:12},{default:s(()=>[t("div",Mt,[t("div",At,[e[25]||(e[25]=t("label",null,"销售价格：",-1)),t("span",Et,"¥"+r(l.value.price),1)]),t("div",Ft,[e[27]||(e[27]=t("label",null,"成本价格：",-1)),Ie.value?(m(),y("span",Ut,"¥"+r(l.value.costPrice),1)):(m(),y("span",Lt,[a(i,null,{default:s(()=>[a(T(ee))]),_:1}),e[26]||(e[26]=c(" **** ",-1))]))]),t("div",Bt,[e[28]||(e[28]=t("label",null,"市场价格：",-1)),t("span",null,"¥"+r(l.value.marketPrice),1)])])]),_:1}),a($,{span:12},{default:s(()=>[t("div",jt,[t("div",zt,[e[30]||(e[30]=t("label",null,"当前库存：",-1)),H.value?(m(),y("span",{key:0,class:he(Re(l.value.stock,l.value.minStock))},r(l.value.stock),3)):(m(),y("span",Ht,[a(i,null,{default:s(()=>[a(T(ee))]),_:1}),e[29]||(e[29]=c(" **** ",-1))]))]),t("div",Yt,[e[32]||(e[32]=t("label",null,"最低库存：",-1)),H.value?(m(),y("span",Gt,r(l.value.minStock),1)):(m(),y("span",Jt,[a(i,null,{default:s(()=>[a(T(ee))]),_:1}),e[31]||(e[31]=c(" **** ",-1))]))]),t("div",Qt,[e[34]||(e[34]=t("label",null,"最高库存：",-1)),H.value?(m(),y("span",Kt,r(l.value.maxStock),1)):(m(),y("span",Zt,[a(i,null,{default:s(()=>[a(T(ee))]),_:1}),e[33]||(e[33]=c(" **** ",-1))]))])])]),_:1})]),_:1})]),_:1}),Ve.value?(m(),B(D,{key:0,class:"info-card",title:"销售数据"},{header:s(()=>[...e[35]||(e[35]=[t("span",null,"销售数据",-1)])]),default:s(()=>[a(J,{gutter:20},{default:s(()=>[a($,{span:6},{default:s(()=>[t("div",Wt,[t("div",Xt,r(l.value.salesCount),1),e[36]||(e[36]=t("div",{class:"stat-label"},"总销量",-1))])]),_:1}),a($,{span:6},{default:s(()=>[t("div",ea,[t("div",ta,"¥"+r(l.value.salesAmount),1),e[37]||(e[37]=t("div",{class:"stat-label"},"销售金额",-1))])]),_:1}),a($,{span:6},{default:s(()=>[t("div",aa,[t("div",oa,r(l.value.viewCount),1),e[38]||(e[38]=t("div",{class:"stat-label"},"浏览次数",-1))])]),_:1}),a($,{span:6},{default:s(()=>[t("div",sa,[t("div",la,r(l.value.favoriteCount),1),e[39]||(e[39]=t("div",{class:"stat-label"},"收藏次数",-1))])]),_:1})]),_:1})]),_:1})):j("",!0),H.value?(m(),B(D,{key:1,class:"info-card",title:"库存记录"},{header:s(()=>[t("div",na,[e[41]||(e[41]=t("span",null,"库存记录",-1)),H.value?(m(),B(n,{key:0,onClick:se,type:"primary",size:"small"},{default:s(()=>[...e[40]||(e[40]=[c(" 调整库存 ",-1)])]),_:1})):j("",!0)])]),default:s(()=>[z.value.length===0?(m(),y("div",ia,[a(Q,{description:"暂无库存记录"})])):(m(),B(b,{key:1,data:z.value,style:{width:"100%"}},{default:s(()=>[a(x,{prop:"createTime",label:"时间",width:"180"}),a(x,{label:"操作类型",width:"100"},{default:s(({row:d})=>[a(g,{type:Oe(d.type),size:"small"},{default:s(()=>[c(r(qe(d.type)),1)]),_:2},1032,["type"])]),_:1}),a(x,{prop:"quantity",label:"数量变化",width:"120"},{default:s(({row:d})=>[t("span",{class:he(d.type==="increase"?"increase":"decrease")},r(d.type==="increase"?"+":"-")+r(d.quantity),3)]),_:1}),a(x,{prop:"stockAfter",label:"变化后库存",width:"120"}),a(x,{prop:"reason",label:"调整原因"}),a(x,{prop:"operator",label:"操作人",width:"100"}),a(x,{prop:"remark",label:"备注","show-overflow-tooltip":""})]),_:1},8,["data"]))]),_:1})):j("",!0)]),_:1}),a($,{span:8},{default:s(()=>[a(D,{class:"status-card"},{header:s(()=>[...e[42]||(e[42]=[t("span",null,"商品状态",-1)])]),default:s(()=>[t("div",ra,[t("div",da,[e[43]||(e[43]=t("label",null,"当前状态：",-1)),a(g,{type:re(l.value.status)},{default:s(()=>[c(r(de(l.value.status)),1)]),_:1},8,["type"])]),t("div",ua,[e[44]||(e[44]=t("label",null,"创建时间：",-1)),t("span",null,r(l.value.createTime),1)]),t("div",ca,[e[45]||(e[45]=t("label",null,"更新时间：",-1)),t("span",null,r(l.value.updateTime),1)]),t("div",pa,[e[46]||(e[46]=t("label",null,"创建人：",-1)),t("span",null,r(l.value.creator),1)]),t("div",ma,[e[47]||(e[47]=t("label",null,"最后修改人：",-1)),t("span",null,r(l.value.updater),1)])])]),_:1}),a(D,{class:"action-card"},{header:s(()=>[...e[48]||(e[48]=[t("span",null,"快速操作",-1)])]),default:s(()=>[t("div",va,[a(n,{onClick:Ee,type:"primary",icon:T(lt),block:""},{default:s(()=>[...e[49]||(e[49]=[c(" 创建订单 ",-1)])]),_:1},8,["icon"]),a(n,{onClick:se,icon:T(ie),block:""},{default:s(()=>[...e[50]||(e[50]=[c(" 调整库存 ",-1)])]),_:1},8,["icon"]),a(n,{onClick:Ae,icon:T(nt),block:""},{default:s(()=>[...e[51]||(e[51]=[c(" 调整价格 ",-1)])]),_:1},8,["icon"]),a(n,{onClick:ue,icon:T(it),block:""},{default:s(()=>[c(r(l.value.status==="active"?"下架商品":"上架商品"),1)]),_:1},8,["icon"])])]),_:1}),a(D,{class:"stats-card"},{header:s(()=>[...e[52]||(e[52]=[t("span",null,"相关统计",-1)])]),default:s(()=>[A.value?(m(),y("div",fa,[t("div",_a,[e[53]||(e[53]=t("span",{class:"stat-label"},"待处理订单：",-1)),t("span",ga,r(A.value.pendingOrders||0),1)]),t("div",ya,[e[54]||(e[54]=t("span",{class:"stat-label"},"本月销量：",-1)),t("span",ka,r(A.value.monthlySales||0),1)]),t("div",ba,[e[55]||(e[55]=t("span",{class:"stat-label"},"库存周转率：",-1)),t("span",wa,r(A.value.turnoverRate||0)+"%",1)]),t("div",Ta,[e[56]||(e[56]=t("span",{class:"stat-label"},"平均评分：",-1)),t("span",Ca,r(A.value.avgRating||0),1)]),t("div",Sa,[e[57]||(e[57]=t("span",{class:"stat-label"},"退货率：",-1)),t("span",ha,r(A.value.returnRate||"0%"),1)])])):(m(),y("div",Pa,[a(Q,{description:"暂无统计数据"})]))]),_:1}),$e.value?(m(),B(D,{key:0,class:"log-card"},{header:s(()=>[...e[58]||(e[58]=[t("span",null,"操作日志",-1)])]),default:s(()=>[L.value.length>0?(m(),y("div",Na,[(m(!0),y(Ce,null,Se(L.value,d=>(m(),y("div",{key:d.id,class:"log-item"},[t("div",Da,r(d.createTime),1),t("div",Ia,[t("span",Va,r(d.operator),1),t("span",$a,r(d.action),1)]),d.detail?(m(),y("div",xa,r(d.detail),1)):j("",!0)]))),128))])):(m(),y("div",Ra,[a(Q,{description:"暂无操作日志"})]))]),_:1})):j("",!0)]),_:1})]),_:1})]),a(_e,{modelValue:M.value,"onUpdate:modelValue":e[4]||(e[4]=d=>M.value=d),title:"库存调整",width:"500px","before-close":le},{footer:s(()=>[t("span",Oa,[a(n,{onClick:le},{default:s(()=>[...e[62]||(e[62]=[c("取消",-1)])]),_:1}),a(n,{onClick:Be,type:"primary",loading:P.value},{default:s(()=>[...e[63]||(e[63]=[c(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:s(()=>[a(fe,{ref_key:"stockFormRef",ref:ae,model:w,rules:Ne,"label-width":"100px"},{default:s(()=>[a(_,{label:"商品名称"},{default:s(()=>[t("span",null,r(l.value.name),1)]),_:1}),a(_,{label:"当前库存"},{default:s(()=>[t("span",null,r(l.value.stock),1)]),_:1}),a(_,{label:"调整类型",prop:"type"},{default:s(()=>[a(W,{modelValue:w.type,"onUpdate:modelValue":e[0]||(e[0]=d=>w.type=d)},{default:s(()=>[a(F,{value:"increase"},{default:s(()=>[...e[59]||(e[59]=[c("增加",-1)])]),_:1}),a(F,{value:"decrease"},{default:s(()=>[...e[60]||(e[60]=[c("减少",-1)])]),_:1}),a(F,{value:"set"},{default:s(()=>[...e[61]||(e[61]=[c("设置",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(_,{label:"调整数量",prop:"quantity"},{default:s(()=>[a(pe,{modelValue:w.quantity,"onUpdate:modelValue":e[1]||(e[1]=d=>w.quantity=d),min:w.type==="decrease"?1:0,max:w.type==="decrease"?l.value.stock:99999,style:{width:"100%"}},null,8,["modelValue","min","max"])]),_:1}),a(_,{label:"调整原因",prop:"reason"},{default:s(()=>[a(me,{modelValue:w.reason,"onUpdate:modelValue":e[2]||(e[2]=d=>w.reason=d),placeholder:"请选择调整原因",style:{width:"100%"}},{default:s(()=>[a(N,{label:"采购入库",value:"purchase"}),a(N,{label:"销售出库",value:"sale"}),a(N,{label:"盘点调整",value:"inventory"}),a(N,{label:"损耗报废",value:"loss"}),a(N,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),a(_,{label:"备注",prop:"remark"},{default:s(()=>[a(ve,{modelValue:w.remark,"onUpdate:modelValue":e[3]||(e[3]=d=>w.remark=d),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(_e,{modelValue:K.value,"onUpdate:modelValue":e[8]||(e[8]=d=>K.value=d),title:"价格调整",width:"500px","before-close":ne},{footer:s(()=>[t("span",Ma,[a(n,{onClick:ne},{default:s(()=>[...e[64]||(e[64]=[c("取消",-1)])]),_:1}),a(n,{onClick:je,type:"primary",loading:te.value},{default:s(()=>[...e[65]||(e[65]=[c(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:s(()=>[a(fe,{ref_key:"priceFormRef",ref:oe,model:p,rules:De,"label-width":"100px"},{default:s(()=>[a(_,{label:"商品名称"},{default:s(()=>[t("span",null,r(l.value.name),1)]),_:1}),a(_,{label:"商品编码"},{default:s(()=>[t("span",null,r(l.value.code),1)]),_:1}),a(_,{label:"当前价格"},{default:s(()=>{var d;return[t("span",null,"¥"+r((d=l.value.price)==null?void 0:d.toFixed(2)),1)]}),_:1}),a(_,{label:"新价格",prop:"newPrice"},{default:s(()=>[a(pe,{modelValue:p.newPrice,"onUpdate:modelValue":e[5]||(e[5]=d=>p.newPrice=d),min:.01,precision:2,style:{width:"100%"},placeholder:"请输入新价格"},null,8,["modelValue"])]),_:1}),a(_,{label:"价格变化"},{default:s(()=>[p.newPrice&&p.originalPrice?(m(),y("span",qa,[a(g,{type:p.newPrice>p.originalPrice?"success":"danger",size:"small"},{default:s(()=>[c(r(p.newPrice>p.originalPrice?"+":"")+" ¥"+r((p.newPrice-p.originalPrice).toFixed(2))+" ("+r(((p.newPrice-p.originalPrice)/p.originalPrice*100).toFixed(1))+"%) ",1)]),_:1},8,["type"])])):j("",!0)]),_:1}),a(_,{label:"调价原因",prop:"reason"},{default:s(()=>[a(me,{modelValue:p.reason,"onUpdate:modelValue":e[6]||(e[6]=d=>p.reason=d),placeholder:"请选择调价原因",style:{width:"100%"}},{default:s(()=>[a(N,{label:"成本变化",value:"cost_change"}),a(N,{label:"市场调价",value:"market_adjust"}),a(N,{label:"促销活动",value:"promotion"}),a(N,{label:"竞争调价",value:"competition"}),a(N,{label:"季节调整",value:"seasonal"}),a(N,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),a(_,{label:"备注",prop:"remark"},{default:s(()=>[a(ve,{modelValue:p.remark,"onUpdate:modelValue":e[7]||(e[7]=d=>p.remark=d),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),za=pt(Aa,[["__scopeId","data-v-e12d4f67"]]);export{za as default};
