import{u as e}from"./call-x2JnX9hE.js";import{n as s,_ as a,u as l,C as t}from"./index-C4IdUW1A.js";import{E as c}from"./elementPlus-DxaqjplL.js";import{l as i,r,ag as d,m as n,q as o,U as u,O as m,p,Q as C,F as _,a9 as v,T as y,S as E,J as R,M as f,e as h,b as A}from"./vendor-BtukhyiH.js";import"./utils-DfI7e5Rl.js";const D={class:"permission-test"},I={class:"card-header"},S={class:"permission-grid"},k={class:"permission-info"},b={class:"permission-name"},O={class:"permission-desc"},g={class:"permission-status"},T={class:"test-buttons"},L={key:0,class:"test-results"},N={class:"results-list"},G={class:"result-time"},P={class:"result-message"},w=a(i({__name:"CallPermissionTest",setup(e){const a=r([{id:"admin",name:"超级管理员"},{id:"manager",name:"部门经理"},{id:"sales001",name:"销售员工"},{id:"service001",name:"客服员工"}]),l=r("admin"),t=r([{type:"MAKE_CALL",name:"发起通话",description:"允许发起外呼通话"},{type:"VIEW_RECORDS",name:"查看记录",description:"允许查看通话记录"},{type:"PLAY_RECORDING",name:"播放录音",description:"允许播放通话录音"},{type:"DOWNLOAD_RECORDING",name:"下载录音",description:"允许下载通话录音"},{type:"EDIT_RECORDS",name:"编辑记录",description:"允许编辑通话记录"},{type:"DELETE_RECORDS",name:"删除记录",description:"允许删除通话记录"},{type:"MANAGE_CONFIG",name:"管理配置",description:"允许管理电话配置"},{type:"VIEW_STATISTICS",name:"查看统计",description:"允许查看通话统计"}]),i=r([]),h=e=>s.checkCallPermission(l.value,e).hasAccess,A=e=>{const s=a.value.find(s=>s.id===e);w(`切换到用户: ${s?.name}`,!0),c.success(`已切换到用户: ${s?.name}`)},w=(e,s)=>{i.value.unshift({time:(new Date).toLocaleTimeString(),message:e,success:s})},$=()=>{h("MAKE_CALL")?(w("发起通话测试 - 权限验证通过",!0),c.success("发起通话权限验证通过")):(w("发起通话测试 - 权限验证失败",!1),c.error("无权限发起通话"))},M=()=>{h("VIEW_RECORDS")?(w("查看记录测试 - 权限验证通过",!0),c.success("查看记录权限验证通过")):(w("查看记录测试 - 权限验证失败",!1),c.error("无权限查看记录"))},W=()=>{h("PLAY_RECORDING")?(w("播放录音测试 - 权限验证通过",!0),c.success("播放录音权限验证通过")):(w("播放录音测试 - 权限验证失败",!1),c.error("无权限播放录音"))},z=()=>{h("DOWNLOAD_RECORDING")?(w("下载录音测试 - 权限验证通过",!0),c.success("下载录音权限验证通过")):(w("下载录音测试 - 权限验证失败",!1),c.error("无权限下载录音"))},U=()=>{h("EDIT_RECORDS")?(w("编辑记录测试 - 权限验证通过",!0),c.success("编辑记录权限验证通过")):(w("编辑记录测试 - 权限验证失败",!1),c.error("无权限编辑记录"))},V=()=>{h("DELETE_RECORDS")?(w("删除记录测试 - 权限验证通过",!0),c.success("删除记录权限验证通过")):(w("删除记录测试 - 权限验证失败",!1),c.error("无权限删除记录"))},j=()=>{h("MANAGE_CONFIG")?(w("管理配置测试 - 权限验证通过",!0),c.success("管理配置权限验证通过")):(w("管理配置测试 - 权限验证失败",!1),c.error("无权限管理配置"))},F=()=>{h("VIEW_STATISTICS")?(w("查看统计测试 - 权限验证通过",!0),c.success("查看统计权限验证通过")):(w("查看统计测试 - 权限验证失败",!1),c.error("无权限查看统计"))};return(e,s)=>{const c=d("el-option"),r=d("el-select"),w=d("el-tag"),K=d("el-button"),Y=d("el-space"),x=d("el-card");return o(),n("div",D,[u(x,{class:"test-card"},{header:m(()=>[p("div",I,[s[1]||(s[1]=p("span",null,"通话权限测试",-1)),u(r,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=e=>l.value=e),onChange:A,placeholder:"选择测试用户"},{default:m(()=>[(o(!0),n(_,null,v(a.value,e=>(o(),f(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),default:m(()=>[p("div",S,[(o(!0),n(_,null,v(t.value,e=>(o(),n("div",{class:"permission-item",key:e.type},[p("div",k,[p("span",b,y(e.name),1),p("span",O,y(e.description),1)]),p("div",g,[u(w,{type:h(e.type)?"success":"danger",size:"small"},{default:m(()=>[E(y(h(e.type)?"有权限":"无权限"),1)]),_:2},1032,["type"])])]))),128))]),p("div",T,[s[10]||(s[10]=p("h4",null,"功能测试按钮",-1)),u(Y,{wrap:""},{default:m(()=>[u(K,{onClick:$,disabled:!h("MAKE_CALL"),type:"success",size:"small"},{default:m(()=>[...s[2]||(s[2]=[E(" 发起通话 ",-1)])]),_:1},8,["disabled"]),u(K,{onClick:M,disabled:!h("VIEW_RECORDS"),type:"primary",size:"small"},{default:m(()=>[...s[3]||(s[3]=[E(" 查看记录 ",-1)])]),_:1},8,["disabled"]),u(K,{onClick:W,disabled:!h("PLAY_RECORDING"),type:"info",size:"small"},{default:m(()=>[...s[4]||(s[4]=[E(" 播放录音 ",-1)])]),_:1},8,["disabled"]),u(K,{onClick:z,disabled:!h("DOWNLOAD_RECORDING"),type:"warning",size:"small"},{default:m(()=>[...s[5]||(s[5]=[E(" 下载录音 ",-1)])]),_:1},8,["disabled"]),u(K,{onClick:U,disabled:!h("EDIT_RECORDS"),type:"danger",size:"small"},{default:m(()=>[...s[6]||(s[6]=[E(" 编辑记录 ",-1)])]),_:1},8,["disabled"]),u(K,{onClick:V,disabled:!h("DELETE_RECORDS"),type:"danger",size:"small"},{default:m(()=>[...s[7]||(s[7]=[E(" 删除记录 ",-1)])]),_:1},8,["disabled"]),u(K,{onClick:j,disabled:!h("MANAGE_CONFIG"),type:"primary",size:"small"},{default:m(()=>[...s[8]||(s[8]=[E(" 管理配置 ",-1)])]),_:1},8,["disabled"]),u(K,{onClick:F,disabled:!h("VIEW_STATISTICS"),type:"success",size:"small"},{default:m(()=>[...s[9]||(s[9]=[E(" 查看统计 ",-1)])]),_:1},8,["disabled"])]),_:1})]),i.value.length>0?(o(),n("div",L,[s[11]||(s[11]=p("h4",null,"测试结果",-1)),p("div",N,[(o(!0),n(_,null,v(i.value,(e,s)=>(o(),n("div",{key:s,class:R(["result-item",{success:e.success,error:!e.success}])},[p("span",G,y(e.time),1),p("span",P,y(e.message),1)],2))),128))])])):C("",!0)]),_:1})])}}}),[["__scopeId","data-v-b431f73b"]]),$={class:"call-test"},M={class:"card-header"},W={class:"test-section"},z={class:"test-section"},U={class:"test-section"},V={key:0,class:"test-results"},j={class:"test-result-item"},F={class:"test-name"},K={key:0,class:"test-details"},Y=a(i({__name:"CallTest",setup(a){const i=e();l();const D=r([{id:"admin",name:"超级管理员",role:"SUPER_ADMIN"},{id:"manager",name:"部门经理",role:"WHITELIST_MEMBER"},{id:"sales001",name:"销售员工",role:"REGULAR_USER"},{id:"service001",name:"客服员工",role:"REGULAR_USER"}]),I=r("admin"),S=r([]),k=h(()=>s.checkCallPermission(I.value,t.MAKE_CALL).hasAccess),b=h(()=>s.checkCallPermission(I.value,t.PLAY_RECORDING).hasAccess),O=h(()=>s.checkCallPermission(I.value,t.DOWNLOAD_RECORDING).hasAccess),g=h(()=>s.checkCallPermission(I.value,t.EDIT_RECORDS).hasAccess),T=h(()=>s.checkCallPermission(I.value,t.VIEW_STATISTICS).hasAccess),L=(e,s,a,l)=>{S.value.unshift({testName:e,success:s,message:a,timestamp:(new Date).toLocaleString(),details:l})},N=async()=>{try{const e={customerId:"test-customer-001",customerName:"测试客户",phone:"13800138000",purpose:"测试通话",notes:"这是一个测试通话",type:"outbound"};await i.startCall(e),L("发起通话测试",!0,"通话发起成功",e),c.success("通话发起测试成功")}catch(e){L("发起通话测试",!1,`通话发起失败: ${e}`),c.error("通话发起测试失败")}},G=async()=>{try{await i.playRecording("test-call-001"),L("播放录音测试",!0,"录音播放成功"),c.success("录音播放测试成功")}catch(e){L("播放录音测试",!1,`录音播放失败: ${e}`),c.error("录音播放测试失败")}},P=async()=>{try{await i.downloadRecording("test-call-001"),L("下载录音测试",!0,"录音下载成功"),c.success("录音下载测试成功")}catch(e){L("下载录音测试",!1,`录音下载失败: ${e}`),c.error("录音下载测试失败")}},Y=()=>{try{L("编辑记录测试",!0,"记录编辑功能正常"),c.success("编辑记录测试成功")}catch(e){L("编辑记录测试",!1,`记录编辑失败: ${e}`),c.error("编辑记录测试失败")}},x=()=>{try{const e={todayCallCount:i.todayCallCount,todayCallDuration:i.todayCallDuration,totalRecords:i.callRecords.length};L("查看统计测试",!0,"统计数据获取成功",e),c.success("查看统计测试成功")}catch(e){L("查看统计测试",!1,`统计数据获取失败: ${e}`),c.error("查看统计测试失败")}},B=async()=>{try{await i.loadCallRecords("test-customer-001"),L("数据同步测试",!0,"数据同步成功"),c.success("数据同步测试成功")}catch(e){L("数据同步测试",!1,`数据同步失败: ${e}`),c.error("数据同步测试失败")}},H=()=>{try{const e={callRecords:i.callRecords.length,followUpRecords:i.followUpRecords.length,currentCall:i.currentCall,isCallActive:i.isCallActive};L("Store集成测试",!0,"Store状态正常",e),c.success("Store集成测试成功")}catch(e){L("Store集成测试",!1,`Store集成失败: ${e}`),c.error("Store集成测试失败")}},J=()=>{try{const e=Object.values(t).map(e=>({permission:e,hasAccess:s.checkCallPermission(I.value,e).hasAccess}));L("权限同步测试",!0,"权限同步正常",e),c.success("权限同步测试成功")}catch(e){L("权限同步测试",!1,`权限同步失败: ${e}`),c.error("权限同步测试失败")}};return A(()=>{L("系统初始化",!0,"通话功能测试页面加载完成")}),(e,a)=>{const l=d("el-button"),i=d("el-tag"),r=d("el-space"),h=d("el-timeline-item"),A=d("el-timeline"),q=d("el-card");return o(),n("div",$,[u(w),u(q,{class:"test-card"},{header:m(()=>[p("div",M,[a[1]||(a[1]=p("span",null,"通话功能测试",-1)),u(l,{type:"primary",onClick:e.refreshData},{default:m(()=>[...a[0]||(a[0]=[E("刷新数据",-1)])]),_:1},8,["onClick"])])]),default:m(()=>[p("div",W,[a[4]||(a[4]=p("h3",null,"权限测试",-1)),u(r,{direction:"vertical",style:{width:"100%"}},{default:m(()=>[(o(!0),n(_,null,v(D.value,e=>(o(),n("div",{key:e.id,class:"user-test"},[u(i,{type:"SUPER_ADMIN"===e.role?"success":"WHITELIST_MEMBER"===e.role?"warning":"info"},{default:m(()=>[E(y(e.name)+" ("+y(e.role)+") ",1)]),_:2},1032,["type"]),u(r,null,{default:m(()=>[u(l,{size:"small",onClick:a=>(e=>{const a=Object.values(t),l={};a.forEach(a=>{const t=s.checkCallPermission(e,a);l[a]={hasAccess:t.hasAccess,reason:t.reason}});const c=D.value.find(s=>s.id===e);L(`权限测试 - ${c?.name}`,!0,`用户 ${c?.name} 的权限检查完成`,l)})(e.id)},{default:m(()=>[...a[2]||(a[2]=[E("测试权限",-1)])]),_:1},8,["onClick"]),u(l,{size:"small",onClick:s=>(e=>{I.value=e;const s=D.value.find(s=>s.id===e);c.success(`已切换到用户: ${s?.name}`),L("用户切换",!0,`切换到用户: ${s?.name} (${e})`)})(e.id),type:"primary"},{default:m(()=>[...a[3]||(a[3]=[E("切换用户",-1)])]),_:1},8,["onClick"])]),_:2},1024)]))),128))]),_:1})]),p("div",z,[a[10]||(a[10]=p("h3",null,"通话功能测试",-1)),u(r,{direction:"vertical",style:{width:"100%"}},{default:m(()=>[u(l,{onClick:N,disabled:!k.value},{default:m(()=>[...a[5]||(a[5]=[E("测试发起通话",-1)])]),_:1},8,["disabled"]),u(l,{onClick:G,disabled:!b.value},{default:m(()=>[...a[6]||(a[6]=[E("测试播放录音",-1)])]),_:1},8,["disabled"]),u(l,{onClick:P,disabled:!O.value},{default:m(()=>[...a[7]||(a[7]=[E("测试下载录音",-1)])]),_:1},8,["disabled"]),u(l,{onClick:Y,disabled:!g.value},{default:m(()=>[...a[8]||(a[8]=[E("测试编辑记录",-1)])]),_:1},8,["disabled"]),u(l,{onClick:x,disabled:!T.value},{default:m(()=>[...a[9]||(a[9]=[E("测试查看统计",-1)])]),_:1},8,["disabled"])]),_:1})]),p("div",U,[a[14]||(a[14]=p("h3",null,"数据同步测试",-1)),u(r,{direction:"vertical",style:{width:"100%"}},{default:m(()=>[u(l,{onClick:B},{default:m(()=>[...a[11]||(a[11]=[E("测试数据同步",-1)])]),_:1}),u(l,{onClick:H},{default:m(()=>[...a[12]||(a[12]=[E("测试Store集成",-1)])]),_:1}),u(l,{onClick:J},{default:m(()=>[...a[13]||(a[13]=[E("测试权限同步",-1)])]),_:1})]),_:1})]),S.value.length>0?(o(),n("div",V,[a[15]||(a[15]=p("h3",null,"测试结果",-1)),u(A,null,{default:m(()=>[(o(!0),n(_,null,v(S.value,(e,s)=>(o(),f(h,{key:s,type:e.success?"success":"danger",timestamp:e.timestamp},{default:m(()=>[p("div",j,[p("div",F,y(e.testName),1),p("div",{class:R(["test-message",{error:!e.success}])},y(e.message),3),e.details?(o(),n("div",K,[p("pre",null,y(JSON.stringify(e.details,null,2)),1)])):C("",!0)])]),_:2},1032,["type","timestamp"]))),128))]),_:1})])):C("",!0)]),_:1})])}}}),[["__scopeId","data-v-9f55834f"]]);export{Y as default};
