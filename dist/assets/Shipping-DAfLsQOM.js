const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DkAJPKqn.js","assets/vendor-BtukhyiH.js","assets/elementPlus-DxaqjplL.js","assets/utils-DfI7e5Rl.js","assets/index-Cj-RrGL6.css"])))=>i.map(i=>d[i]);
import{l as e,e as l,r as a,b as t,ag as r,M as s,q as o,O as n,m as i,Q as d,U as u,p as c,S as p,u as m,F as g,a9 as v,J as f,T as h,Z as y,w as b,aA as _,Y as w}from"./vendor-BtukhyiH.js";import{s as k,aj as T,Q as x,Z as A,ag as C,E as N,b as V,k as S,v as D,r as O,K as M,a4 as I,A as $,e as U,ak as E,G as B,w as P,I as q,T as R,S as H,al as j,R as z,a5 as L,am as Y,F as W,M as F,an as Q,j as J,ae as K,H as Z,d as G,ac as X}from"./elementPlus-DxaqjplL.js";import{_ as ee,d as le,b as ae,l as te,u as re,i as se,e as oe,E as ne,c as ie}from"./index-DkAJPKqn.js";import{useDepartmentStore as de}from"./department-DPqzaatc.js";import{u as ue}from"./orderFieldConfig-C2_zIqeo.js";import{a as ce,b as pe}from"./export-D-SEmR7Z.js";import{a as me}from"./sensitiveInfo-DVfrBLrU.js";import{O as ge}from"./OrderDetailDialog-D-0kW_qR.js";import{r as ve,k as fe,w as he}from"./utils-DfI7e5Rl.js";import{D as ye}from"./DynamicTable-BEeD1UIt.js";import"./TableColumnSettings-CrYSHYg1.js";const be={key:0,class:"print-content"},_e={class:"print-settings"},we={class:"section-title"},ke={class:"settings-grid"},Te={class:"setting-item"},xe={class:"setting-item"},Ae={class:"setting-item"},Ce={class:"label-preview"},Ne={class:"section-title"},Ve={class:"preview-container"},Se={key:0,class:"standard-template"},De={class:"label-header"},Oe={class:"company-info"},Me={class:"label-body"},Ie={class:"sender-info"},$e={class:"receiver-info"},Ue={class:"order-info"},Ee={class:"label-footer"},Be={class:"tracking-info"},Pe={key:1,class:"simple-template"},qe={class:"simple-header"},Re={class:"order-no"},He={class:"simple-body"},je={class:"address-section"},ze={class:"to-address"},Le={class:"name"},Ye={class:"phone"},We={class:"address"},Fe={class:"product-section"},Qe={key:0,class:"cod-amount"},Je={key:2,class:"detailed-template"},Ke={class:"detailed-header"},Ze={class:"logo-section"},Ge={class:"company-details"},Xe={class:"order-summary"},el={class:"detailed-body"},ll={class:"info-table"},al={class:"value-cell"},tl={class:"value-cell"},rl={class:"value-cell",colspan:"3"},sl={class:"value-cell",colspan:"3"},ol={class:"value-cell"},nl={class:"value-cell cod-highlight"},il={class:"detailed-footer"},dl={class:"logistics-info"},ul={class:"service-info"},cl={class:"dialog-footer"},pl=e({__name:"PrintLabelDialog",props:{visible:{type:Boolean},order:{}},emits:["update:visible"],setup(e,{emit:y}){const b=e,_=y,w=l({get:()=>b.visible,set:e=>_("update:visible",e)}),S=a(""),D=a("standard"),O=a(1),M=a(""),I=a(""),$=a(!1),U=a([{id:"printer1",name:"HP LaserJet Pro M404n",status:"online"},{id:"printer2",name:"Canon PIXMA G3010",status:"offline"},{id:"printer3",name:"Epson L3150",status:"online"}]),E=a([{id:"standard",name:"标准模板",description:"包含完整信息的标准面单"},{id:"simple",name:"简约模板",description:"简洁清晰的面单样式"},{id:"detailed",name:"详细模板",description:"详细信息表格式面单"}]),B=a({name:"智慧销售CRM系统",address:"北京市朝阳区科技园区xxx号",phone:"400-123-4567",slogan:"专业、高效、贴心的服务",senderName:"客服中心",senderPhone:"010-12345678",senderAddress:"北京市朝阳区科技园区xxx号"}),P=e=>null==e||isNaN(e)?"0":e.toLocaleString(),q=()=>b.order?.products&&Array.isArray(b.order.products)?b.order.products.map(e=>`${e.name} × ${e.quantity}`).join("，"):"",R=async()=>{if(S.value)try{N.loading("正在连接打印机..."),await new Promise(e=>setTimeout(e,2e3)),N.success("打印机连接成功")}catch(e){N.error("打印机连接失败，请检查打印机状态")}else N.warning("请先选择打印机")},H=()=>{$.value=!0},j=()=>{N.success("模板保存成功"),$.value=!1},z=()=>{const e=window.open("","_blank");if(e){const l=document.querySelector(".label-template")?.outerHTML;e.document.write(`\n      <html>\n        <head>\n          <title>面单预览</title>\n          <style>\n            body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }\n            .label-template { max-width: 800px; margin: 0 auto; }\n            @media print {\n              body { margin: 0; padding: 0; }\n              .label-template { max-width: none; }\n            }\n          </style>\n        </head>\n        <body>\n          ${l}\n        </body>\n      </html>\n    `),e.document.close()}},L=async()=>{if(S.value)try{await V.confirm(`确认打印 ${O.value} 份面单吗？`,"确认打印",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}),N.loading("正在打印..."),await new Promise(e=>setTimeout(e,3e3)),N.success(`成功打印 ${O.value} 份面单`),Y()}catch{}else N.warning("请先选择打印机")},Y=()=>{w.value=!1};return t(()=>{M.value="SF"+Date.now().toString().slice(-8),I.value="顺丰速运"}),(l,a)=>{const t=r("el-icon"),y=r("el-option"),b=r("el-select"),_=r("el-button"),N=r("el-input-number"),V=r("el-dialog");return o(),s(V,{modelValue:w.value,"onUpdate:modelValue":a[5]||(a[5]=e=>w.value=e),title:"打印面单",width:"70%","before-close":Y,class:"print-label-dialog"},{footer:n(()=>[c("div",cl,[u(_,{onClick:Y},{default:n(()=>[...a[41]||(a[41]=[p("取消",-1)])]),_:1}),u(_,{type:"info",onClick:z},{default:n(()=>[u(t,null,{default:n(()=>[u(m(A))]),_:1}),a[42]||(a[42]=p(" 预览打印 ",-1))]),_:1}),u(_,{type:"primary",onClick:L,disabled:!S.value},{default:n(()=>[u(t,null,{default:n(()=>[u(m(C))]),_:1}),a[43]||(a[43]=p(" 确认打印 ",-1))]),_:1},8,["disabled"])])]),default:n(()=>[e.order?(o(),i("div",be,[c("div",_e,[c("h3",we,[u(t,null,{default:n(()=>[u(m(k))]),_:1}),a[6]||(a[6]=p(" 打印设置 ",-1))]),c("div",ke,[c("div",Te,[a[8]||(a[8]=c("label",null,"选择打印机：",-1)),u(b,{modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=e=>S.value=e),placeholder:"请选择打印机",class:"printer-select"},{default:n(()=>[(o(!0),i(g,null,v(U.value,e=>(o(),s(y,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(_,{type:"primary",size:"small",onClick:R,class:"connect-btn"},{default:n(()=>[u(t,null,{default:n(()=>[u(m(T))]),_:1}),a[7]||(a[7]=p(" 连接打印机 ",-1))]),_:1})]),c("div",xe,[a[10]||(a[10]=c("label",null,"打印模板：",-1)),u(b,{modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=e=>D.value=e),placeholder:"请选择模板",class:"template-select"},{default:n(()=>[(o(!0),i(g,null,v(E.value,e=>(o(),s(y,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(_,{type:"success",size:"small",onClick:H,class:"edit-btn"},{default:n(()=>[u(t,null,{default:n(()=>[u(m(x))]),_:1}),a[9]||(a[9]=p(" 编辑模板 ",-1))]),_:1})]),c("div",Ae,[a[11]||(a[11]=c("label",null,"打印份数：",-1)),u(N,{modelValue:O.value,"onUpdate:modelValue":a[2]||(a[2]=e=>O.value=e),min:1,max:10,class:"copies-input"},null,8,["modelValue"])])])]),c("div",Ce,[c("h3",Ne,[u(t,null,{default:n(()=>[u(m(A))]),_:1}),a[12]||(a[12]=p(" 面单预览 ",-1))]),c("div",Ve,[c("div",{class:f(["label-template",D.value])},["standard"===D.value?(o(),i("div",Se,[c("div",De,[c("div",Oe,[c("h2",null,h(B.value.name),1),c("p",null,h(B.value.address),1),c("p",null,"客服电话："+h(m(me)(B.value.phone,"phone")),1)]),a[13]||(a[13]=c("div",{class:"qr-code"},[c("div",{class:"qr-placeholder"},"二维码")],-1))]),c("div",Me,[c("div",Ie,[a[17]||(a[17]=c("h4",null,"寄件人信息",-1)),c("p",null,[a[14]||(a[14]=c("strong",null,"姓名：",-1)),p(h(B.value.senderName),1)]),c("p",null,[a[15]||(a[15]=c("strong",null,"电话：",-1)),p(h(m(me)(B.value.senderPhone,"phone")),1)]),c("p",null,[a[16]||(a[16]=c("strong",null,"地址：",-1)),p(h(B.value.senderAddress),1)])]),c("div",$e,[a[21]||(a[21]=c("h4",null,"收件人信息",-1)),c("p",null,[a[18]||(a[18]=c("strong",null,"姓名：",-1)),p(h(e.order.customerName),1)]),c("p",null,[a[19]||(a[19]=c("strong",null,"电话：",-1)),p(h(m(me)(e.order.phone,"phone")),1)]),c("p",null,[a[20]||(a[20]=c("strong",null,"地址：",-1)),p(h(e.order.address),1)])]),c("div",Ue,[a[26]||(a[26]=c("h4",null,"订单信息",-1)),c("p",null,[a[22]||(a[22]=c("strong",null,"订单号：",-1)),p(h(e.order.orderNo),1)]),c("p",null,[a[23]||(a[23]=c("strong",null,"商品：",-1)),p(h(q()),1)]),c("p",null,[a[24]||(a[24]=c("strong",null,"数量：",-1)),p(h(e.order.totalQuantity)+"件",1)]),c("p",null,[a[25]||(a[25]=c("strong",null,"代收款：",-1)),p("¥"+h(P(e.order.codAmount)),1)])])]),c("div",Ee,[c("div",Be,[c("p",null,[a[27]||(a[27]=c("strong",null,"运单号：",-1)),p(h(M.value||"待生成"),1)]),c("p",null,[a[28]||(a[28]=c("strong",null,"物流公司：",-1)),p(h(I.value||"待选择"),1)])]),a[29]||(a[29]=c("div",{class:"barcode"},[c("div",{class:"barcode-placeholder"},"条形码")],-1))])])):"simple"===D.value?(o(),i("div",Pe,[c("div",qe,[c("h3",null,h(B.value.name),1),c("span",Re,h(e.order.orderNo),1)]),c("div",He,[c("div",je,[c("div",ze,[a[30]||(a[30]=c("h4",null,"收件人",-1)),c("p",Le,h(e.order.customerName),1),c("p",Ye,h(m(me)(e.order.phone,"phone")),1),c("p",We,h(e.order.address),1)])]),c("div",Fe,[a[31]||(a[31]=c("h4",null,"商品信息",-1)),c("p",null,h(q()),1),e.order.codAmount>0?(o(),i("p",Qe," 代收款：¥"+h(P(e.order.codAmount)),1)):d("",!0)])])])):"detailed"===D.value?(o(),i("div",Je,[c("div",Ke,[c("div",Ze,[a[32]||(a[32]=c("div",{class:"logo-placeholder"},"LOGO",-1)),c("div",Ge,[c("h2",null,h(B.value.name),1),c("p",null,h(B.value.slogan),1)])]),c("div",Xe,[c("h3",null,"订单："+h(e.order.orderNo),1),c("p",null,"下单时间："+h(e.order.createTime||"2024-01-15 10:30"),1)])]),c("div",el,[c("table",ll,[c("tbody",null,[c("tr",null,[a[33]||(a[33]=c("td",{class:"label-cell"},"收件人",-1)),c("td",al,h(e.order.customerName),1),a[34]||(a[34]=c("td",{class:"label-cell"},"联系电话",-1)),c("td",tl,h(m(me)(e.order.phone,"phone")),1)]),c("tr",null,[a[35]||(a[35]=c("td",{class:"label-cell"},"收货地址",-1)),c("td",rl,h(e.order.address),1)]),c("tr",null,[a[36]||(a[36]=c("td",{class:"label-cell"},"商品信息",-1)),c("td",sl,h(q()),1)]),c("tr",null,[a[37]||(a[37]=c("td",{class:"label-cell"},"订单金额",-1)),c("td",ol,"¥"+h(P(e.order.totalAmount)),1),a[38]||(a[38]=c("td",{class:"label-cell"},"代收款",-1)),c("td",nl,"¥"+h(P(e.order.codAmount)),1)])])])]),c("div",il,[c("div",dl,[c("p",null,[a[39]||(a[39]=c("strong",null,"物流公司：",-1)),p(h(I.value||"待选择"),1)]),c("p",null,[a[40]||(a[40]=c("strong",null,"运单号：",-1)),p(h(M.value||"待生成"),1)])]),c("div",ul,[c("p",null,"客服微信："+h(e.order.serviceWechat),1),c("p",null,"客服电话："+h(m(me)(B.value.phone,"phone")),1)])])])):d("",!0)],2)])])])):d("",!0),u(V,{modelValue:$.value,"onUpdate:modelValue":a[4]||(a[4]=e=>$.value=e),title:"编辑打印模板",width:"60%","append-to-body":""},{footer:n(()=>[u(_,{onClick:a[3]||(a[3]=e=>$.value=!1)},{default:n(()=>[...a[44]||(a[44]=[p("取消",-1)])]),_:1}),u(_,{type:"primary",onClick:j},{default:n(()=>[...a[45]||(a[45]=[p("保存模板",-1)])]),_:1})]),default:n(()=>[a[46]||(a[46]=c("div",{class:"template-editor"},[c("p",null,"模板编辑功能开发中..."),c("p",null,"您可以在这里自定义面单的布局、字体、颜色等样式。")],-1))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),ml=ee(pl,[["__scopeId","data-v-45a9cf8a"]]),gl={key:0,class:"shipping-content"},vl={class:"order-summary"},fl={class:"section-title"},hl={class:"order-info-grid"},yl={class:"info-item"},bl={class:"value"},_l={class:"info-item"},wl={class:"value"},kl={class:"info-item"},Tl={class:"value"},xl={class:"info-item"},Al={class:"value"},Cl={class:"info-item"},Nl={class:"value"},Vl={class:"info-item"},Sl={class:"value cod-amount"},Dl={class:"logistics-form"},Ol={class:"section-title"},Ml={class:"company-option"},Il={class:"company-name"},$l={class:"company-code"},Ul={class:"tracking-tip"},El={class:"insurance-tip"},Bl={class:"shipping-confirm"},Pl={class:"dialog-footer"},ql=ee(e({__name:"ShippingDialog",props:{visible:{type:Boolean},order:{}},emits:["update:visible","shipped"],setup(e,{emit:f}){const _=e,w=f,k=l({get:()=>_.visible,set:e=>w("update:visible",e)}),T=a(),x=a(!1),A=le(),C=ae(),$=y({logisticsCompany:"",trackingNumber:"",estimatedDelivery:"",remarks:"",shippingMethod:"standard",insuranceAmount:0}),U={logisticsCompany:[{required:!0,message:"请选择物流公司",trigger:"change"}],trackingNumber:[{required:!0,message:"请输入运单号",trigger:"blur"},{min:8,max:20,message:"运单号长度应在8-20位之间",trigger:"blur"}]},E=a([{code:"SF",name:"顺丰速运",prefix:"SF"},{code:"YTO",name:"圆通速递",prefix:"YT"},{code:"ZTO",name:"中通快递",prefix:"ZTO"},{code:"STO",name:"申通快递",prefix:"STO"},{code:"YD",name:"韵达速递",prefix:"YD"},{code:"HTKY",name:"百世快递",prefix:"HT"},{code:"JD",name:"京东物流",prefix:"JD"},{code:"EMS",name:"中国邮政",prefix:"EMS"},{code:"DBKD",name:"德邦快递",prefix:"DB"},{code:"UC",name:"优速快递",prefix:"UC"}]),B=e=>null==e||isNaN(e)?"0":e.toLocaleString(),P=e=>{$.trackingNumber="",$.estimatedDelivery||L()},q=()=>{if(!$.logisticsCompany)return void N.warning("请先选择物流公司");const e=E.value.find(e=>e.code===$.logisticsCompany);if(e){const l=Date.now().toString(),a=Math.random().toString(36).substring(2,6).toUpperCase();$.trackingNumber=`${e.prefix}${l.slice(-8)}${a}`}},R=e=>e.getTime()<Date.now()-864e5,H=async()=>{try{N.loading("正在保存草稿..."),await new Promise(e=>setTimeout(e,1e3)),N.success("草稿保存成功")}catch(e){N.error("草稿保存失败")}},j=async()=>{if(T.value)try{await T.value.validate(),await V.confirm(`确认发货订单 ${_.order.orderNo} 吗？发货后将无法撤销。`,"确认发货",{confirmButtonText:"确认发货",cancelButtonText:"取消",type:"warning"}),x.value=!0,await new Promise(e=>setTimeout(e,2e3));const e={orderId:_.order.id,orderNo:_.order.orderNo,...$,shippingTime:(new Date).toISOString(),status:"shipped"},l=_.order.orderNo.replace("ORD",""),a=E.value.find(e=>e.code===$.logisticsCompany)?.name||$.logisticsCompany;A.syncOrderStatus(l,"shipped","物流员",`订单已发货，快递公司：${a}，快递单号：${$.trackingNumber}`),C.sendMessage(C.MessageType.ORDER_SHIPPED,`订单 ${_.order.orderNo} 已发货，快递公司：${a}，快递单号：${$.trackingNumber}`,{relatedId:_.order.id,relatedType:"order",actionUrl:`/order/detail/${_.order.id}`}),w("shipped",e),N.success("发货成功！已通知客户"),z()}catch(e){"cancel"!==e&&N.error("发货失败，请重试")}finally{x.value=!1}},z=()=>{T.value&&T.value.resetFields(),Object.assign($,{logisticsCompany:"",trackingNumber:"",estimatedDelivery:"",remarks:"",shippingMethod:"standard",insuranceAmount:0}),k.value=!1},L=()=>{const e=new Date((new Date).getTime()+2592e5);$.estimatedDelivery=e.toISOString().split("T")[0]};return b(()=>_.visible,e=>{e&&(_.order?.totalAmount&&($.insuranceAmount=Math.round(.8*_.order.totalAmount)),L())},{immediate:!0}),t(()=>{_.order?.totalAmount&&($.insuranceAmount=Math.round(.8*_.order.totalAmount)),L()}),(l,a)=>{const t=r("el-icon"),f=r("el-option"),y=r("el-select"),b=r("el-form-item"),w=r("el-button"),A=r("el-input"),C=r("el-date-picker"),N=r("el-radio"),V=r("el-radio-group"),L=r("el-input-number"),Y=r("el-form"),W=r("el-alert"),F=r("el-dialog");return o(),s(F,{modelValue:k.value,"onUpdate:modelValue":a[6]||(a[6]=e=>k.value=e),title:"发货处理",width:"50%","before-close":z,class:"shipping-dialog"},{footer:n(()=>[c("div",Pl,[u(w,{onClick:z},{default:n(()=>[...a[21]||(a[21]=[p("取消",-1)])]),_:1}),u(w,{type:"info",onClick:H},{default:n(()=>[u(t,null,{default:n(()=>[u(m(I))]),_:1}),a[22]||(a[22]=p(" 保存草稿 ",-1))]),_:1}),u(w,{type:"primary",onClick:j,loading:x.value},{default:n(()=>[u(t,null,{default:n(()=>[u(m(D))]),_:1}),a[23]||(a[23]=p(" 确认发货 ",-1))]),_:1},8,["loading"])])]),default:n(()=>[e.order?(o(),i("div",gl,[c("div",vl,[c("h3",fl,[u(t,null,{default:n(()=>[u(m(S))]),_:1}),a[7]||(a[7]=p(" 订单信息 ",-1))]),c("div",hl,[c("div",yl,[a[8]||(a[8]=c("span",{class:"label"},"订单号：",-1)),c("span",bl,h(e.order.orderNo),1)]),c("div",_l,[a[9]||(a[9]=c("span",{class:"label"},"客户姓名：",-1)),c("span",wl,h(e.order.customerName),1)]),c("div",kl,[a[10]||(a[10]=c("span",{class:"label"},"联系电话：",-1)),c("span",Tl,h(m(me)(e.order.phone,"phone")),1)]),c("div",xl,[a[11]||(a[11]=c("span",{class:"label"},"收货地址：",-1)),c("span",Al,h(e.order.address),1)]),c("div",Cl,[a[12]||(a[12]=c("span",{class:"label"},"商品信息：",-1)),c("span",Nl,h(_.order?.products&&Array.isArray(_.order.products)?_.order.products.map(e=>`${e.name} × ${e.quantity}`).join("，"):""),1)]),c("div",Vl,[a[13]||(a[13]=c("span",{class:"label"},"代收款金额：",-1)),c("span",Sl,"¥"+h(B(e.order.codAmount)),1)])])]),c("div",Dl,[c("h3",Ol,[u(t,null,{default:n(()=>[u(m(D))]),_:1}),a[14]||(a[14]=p(" 物流信息 ",-1))]),u(Y,{model:$,rules:U,ref_key:"formRef",ref:T,"label-width":"120px"},{default:n(()=>[u(b,{label:"物流公司",prop:"logisticsCompany",required:""},{default:n(()=>[u(y,{modelValue:$.logisticsCompany,"onUpdate:modelValue":a[0]||(a[0]=e=>$.logisticsCompany=e),placeholder:"请选择物流公司",class:"full-width",filterable:"",onChange:P},{default:n(()=>[(o(!0),i(g,null,v(E.value,e=>(o(),s(f,{key:e.code,label:e.name,value:e.code},{default:n(()=>[c("div",Ml,[c("span",Il,h(e.name),1),c("span",$l,"("+h(e.code)+")",1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(b,{label:"运单号",prop:"trackingNumber",required:""},{default:n(()=>[u(A,{modelValue:$.trackingNumber,"onUpdate:modelValue":a[1]||(a[1]=e=>$.trackingNumber=e),placeholder:"请输入运单号",class:"full-width",clearable:""},{append:n(()=>[u(w,{onClick:q,type:"primary"},{default:n(()=>[u(t,null,{default:n(()=>[u(m(O))]),_:1}),a[15]||(a[15]=p(" 生成 ",-1))]),_:1})]),_:1},8,["modelValue"]),c("div",Ul,[u(t,null,{default:n(()=>[u(m(M))]),_:1}),a[16]||(a[16]=c("span",null,"运单号可以手动输入或点击生成按钮自动生成",-1))])]),_:1}),u(b,{label:"预计送达",prop:"estimatedDelivery"},{default:n(()=>[u(C,{modelValue:$.estimatedDelivery,"onUpdate:modelValue":a[2]||(a[2]=e=>$.estimatedDelivery=e),type:"date",placeholder:"选择预计送达日期",class:"full-width","disabled-date":R},null,8,["modelValue"])]),_:1}),u(b,{label:"发货备注",prop:"remarks"},{default:n(()=>[u(A,{modelValue:$.remarks,"onUpdate:modelValue":a[3]||(a[3]=e=>$.remarks=e),type:"textarea",rows:3,placeholder:"请输入发货备注（选填）",maxlength:"200","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1}),u(b,{label:"发货方式",prop:"shippingMethod"},{default:n(()=>[u(V,{modelValue:$.shippingMethod,"onUpdate:modelValue":a[4]||(a[4]=e=>$.shippingMethod=e)},{default:n(()=>[u(N,{label:"standard"},{default:n(()=>[...a[17]||(a[17]=[p("标准快递",-1)])]),_:1}),u(N,{label:"express"},{default:n(()=>[...a[18]||(a[18]=[p("加急快递",-1)])]),_:1}),u(N,{label:"economy"},{default:n(()=>[...a[19]||(a[19]=[p("经济快递",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),u(b,{label:"保价金额",prop:"insuranceAmount"},{default:n(()=>[u(L,{modelValue:$.insuranceAmount,"onUpdate:modelValue":a[5]||(a[5]=e=>$.insuranceAmount=e),min:0,max:e.order.totalAmount,precision:2,placeholder:"保价金额",class:"full-width"},null,8,["modelValue","max"]),c("div",El,[u(t,null,{default:n(()=>[u(m(M))]),_:1}),c("span",null,"建议保价金额不超过订单总金额 ¥"+h(B(e.order.totalAmount)),1)])]),_:1})]),_:1},8,["model"])]),c("div",Bl,[u(W,{title:"发货确认",type:"warning",closable:!1,"show-icon":""},{default:n(()=>[...a[20]||(a[20]=[c("p",null,"确认发货后，系统将：",-1),c("ul",null,[c("li",null,'更新订单状态为"已发货"'),c("li",null,"记录物流信息和运单号"),c("li",null,"发送发货通知给客户"),c("li",null,"开始物流跟踪")],-1)])]),_:1})])])):d("",!0)]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-aac730a0"]]),Rl={class:"batch-content"},Hl={class:"selected-orders"},jl={class:"section-title"},zl={class:"orders-summary"},Ll={class:"summary-cards"},Yl={class:"summary-card"},Wl={class:"card-value"},Fl={class:"summary-card"},Ql={class:"card-value"},Jl={class:"summary-card"},Kl={class:"card-value cod-amount"},Zl={class:"orders-table"},Gl={class:"cod-text"},Xl={class:"batch-settings"},ea={class:"section-title"},la={class:"form-grid"},aa={class:"company-option"},ta={class:"company-name"},ra={class:"company-code"},sa={key:0,class:"tracking-manual"},oa={class:"section-title"},na={class:"tracking-inputs"},ia={class:"order-label"},da={key:1,class:"tracking-import"},ua={class:"section-title"},ca={class:"import-area"},pa={class:"import-template"},ma={class:"shipping-preview"},ga={class:"section-title"},va={key:0,class:"auto-tracking"},fa={key:1},ha={key:2},ya={class:"shipping-confirm"},ba={class:"warning-text"},_a={class:"dialog-footer"},wa=e({__name:"BatchShippingDialog",props:{visible:{type:Boolean},selectedOrders:{}},emits:["update:visible","batch-shipped"],setup(e,{emit:t}){const f=e,_=t,w=l({get:()=>f.visible,set:e=>_("update:visible",e)}),T=a(),C=a(!1),O=y({logisticsCompany:"",shippingMethod:"standard",trackingMode:"auto",estimatedDelivery:"",remarks:""}),M=a([]),q=a([]),R={logisticsCompany:[{required:!0,message:"请选择物流公司",trigger:"change"}]},H=a([{code:"SF",name:"顺丰速运",prefix:"SF"},{code:"YTO",name:"圆通速递",prefix:"YT"},{code:"ZTO",name:"中通快递",prefix:"ZTO"},{code:"STO",name:"申通快递",prefix:"STO"},{code:"YD",name:"韵达速递",prefix:"YD"},{code:"HTKY",name:"百世快递",prefix:"HT"},{code:"JD",name:"京东物流",prefix:"JD"},{code:"EMS",name:"中国邮政",prefix:"EMS"}]),j=l(()=>Array.isArray(f.selectedOrders)?f.selectedOrders.reduce((e,l)=>e+(l.totalAmount||0),0):0),z=l(()=>Array.isArray(f.selectedOrders)?f.selectedOrders.reduce((e,l)=>e+(l.codAmount||0),0):0),L=l(()=>Array.isArray(f.selectedOrders)?f.selectedOrders:[]),Y=()=>{const e=new Date((new Date).getTime()+2592e5);O.estimatedDelivery=e.toISOString().split("T")[0]};b(()=>f.visible,e=>{e&&Y()},{immediate:!0}),b(()=>f.selectedOrders,e=>{Array.isArray(e)?(M.value=new Array(e.length).fill(""),q.value=new Array(e.length).fill("")):(M.value=[],q.value=[])},{immediate:!0});const W=e=>e.toLocaleString(),F=e=>{O.estimatedDelivery||Y()},Q=()=>{const e=H.value.find(e=>e.code===O.logisticsCompany);return e?.name||"待选择"},J=e=>O.logisticsCompany?"auto"===O.trackingMode?{type:"success",text:"就绪"}:"manual"===O.trackingMode?M.value[e]?{type:"success",text:"就绪"}:{type:"warning",text:"待输入"}:q.value[e]?{type:"success",text:"就绪"}:{type:"warning",text:"待导入"}:{type:"danger",text:"未设置"},K=e=>e.getTime()<Date.now()-864e5,Z=e=>{const l=e.raw;if(!l)return;const a=new FileReader;a.onload=e=>{try{const l=e.target?.result;if(!l)return void N.error("文件内容为空");const a=ve(l,{type:"binary"}),t=a.SheetNames[0],r=a.Sheets[t],s=fe.sheet_to_json(r,{header:1});if(s.length<2)return void N.error("文件格式错误，至少需要包含表头和一行数据");const o=s.slice(1),n=[];if(o.forEach((e,l)=>{if(Array.isArray(e)&&e.length>=5){let a=String(e[0]||"").trim();"number"==typeof e[0]&&(a=e[0].toString());const t=String(e[4]||"").trim(),r=String(e[5]||"").trim();console.log(`第${l+2}行数据:`,{orderNo:a,trackingNo:t,company:r}),a&&t&&n.push({orderNo:a,trackingNo:t,company:r})}}),console.log("导入的数据:",n),console.log("选中的订单号:",f.selectedOrders.map(e=>e.orderNo)),0===n.length)return void N.error("未找到有效的运单号数据，请确保第5列填写了运单号");let i=0;const d=[];f.selectedOrders.forEach((e,l)=>{const a=String(e.orderNo||"").trim(),t=n.find(e=>String(e.orderNo||"").trim()===a);if(t){if(q.value[l]=t.trackingNo,t.company&&!O.logisticsCompany){const e=H.value.find(e=>e.name===t.company||e.code===t.company);e&&(O.logisticsCompany=e.code)}i++}else d.push(a)}),i>0?(N.success(`成功导入 ${i} 个订单的运单号`),d.length>0&&(console.warn("未匹配的订单号:",d),N.warning(`有 ${d.length} 个订单未匹配到运单号`))):(console.error("未匹配到任何订单"),console.error("导入的订单号:",n.map(e=>e.orderNo)),console.error("系统中的订单号:",f.selectedOrders.map(e=>e.orderNo)),N.error("未匹配到任何订单，请检查订单号是否与系统中的订单号完全一致"))}catch(l){console.error("文件解析失败:",l),N.error("文件解析失败，请确保文件格式正确")}},a.onerror=()=>{N.error("文件读取失败")},a.readAsBinaryString(l)},G=()=>{try{const e=["订单号","客户姓名","联系电话","收货地址","运单号","物流公司"],l=f.selectedOrders.map(e=>[e.orderNo||"",e.customerName||"",e.phone||e.customerPhone||"",e.address||e.receiverAddress||"","",""]),a=[e,...l],t=fe.aoa_to_sheet(a),r=e.map((e,a)=>{let t=e.length;return l.forEach(e=>{const l=String(e[a]||"").split("").reduce((e,l)=>e+(/[\u4e00-\u9fa5]/.test(l)?2:1),0);t=Math.max(t,l)}),{wch:Math.min(Math.max(t+2,10),50)}});t["!cols"]=r;const s=fe.book_new();fe.book_append_sheet(s,t,"批量发货模板"),he(s,`批量发货模板_${(new Date).getTime()}.xlsx`),N.success("模板下载成功！请填写运单号和物流公司后导入")}catch(e){console.error("下载模板失败:",e),N.error("模板下载失败，请重试")}},X=async()=>{try{N.loading("正在保存草稿..."),await new Promise(e=>setTimeout(e,1e3)),N.success("草稿保存成功")}catch(e){N.error("草稿保存失败")}},ee=async()=>{if(T.value)try{if(await T.value.validate(),"manual"===O.trackingMode){const e=M.value.filter(e=>!e.trim()).length;if(e>0)return void N.error(`还有 ${e} 个订单的运单号未填写`)}else if("import"===O.trackingMode){const e=q.value.filter(e=>!e.trim()).length;if(e>0)return void N.error(`还有 ${e} 个订单的运单号未导入，请先导入完整数据`)}await V.confirm(`确认批量发货 ${f.selectedOrders.length} 个订单吗？发货后将无法撤销。`,"确认批量发货",{confirmButtonText:"确认发货",cancelButtonText:"取消",type:"warning"}),C.value=!0;const e=f.selectedOrders.map((e,l)=>{let a="";if("auto"===O.trackingMode){const e=H.value.find(e=>e.code===O.logisticsCompany),t=Date.now().toString(),r=Math.random().toString(36).substring(2,6).toUpperCase();a=`${e?.prefix}${t.slice(-8)}${r}${l}`}else a="manual"===O.trackingMode?M.value[l]:q.value[l];return{orderId:e.id,orderNo:e.orderNo,logisticsCompany:O.logisticsCompany,trackingNumber:a,estimatedDelivery:O.estimatedDelivery,remarks:O.remarks,shippingMethod:O.shippingMethod,shippingTime:(new Date).toISOString(),status:"shipped"}});await new Promise(e=>setTimeout(e,3e3));const{useOrderStore:l}=await te(async()=>{const{useOrderStore:e}=await import("./index-DkAJPKqn.js").then(e=>e.W);return{useOrderStore:e}},__vite__mapDeps([0,1,2,3,4])),a=l();e.forEach(e=>{a.updateOrder(e.orderId,{status:"shipped",trackingNumber:e.trackingNumber,expressNo:e.trackingNumber,expressCompany:e.logisticsCompany,logisticsCompany:e.logisticsCompany,shippingTime:e.shippingTime,estimatedDelivery:e.estimatedDelivery,remarks:e.remarks})}),_("batch-shipped",e),N.success(`成功批量发货 ${f.selectedOrders.length} 个订单！`),le()}catch(e){"cancel"!==e&&N.error("批量发货失败，请重试")}finally{C.value=!1}},le=()=>{T.value&&T.value.resetFields(),Object.assign(O,{logisticsCompany:"",shippingMethod:"standard",trackingMode:"auto",estimatedDelivery:"",remarks:""}),M.value=[],q.value=[],w.value=!1};return(l,a)=>{const t=r("el-icon"),f=r("el-table-column"),y=r("el-button"),b=r("el-table"),_=r("el-option"),V=r("el-select"),Y=r("el-form-item"),ae=r("el-radio"),te=r("el-radio-group"),re=r("el-date-picker"),se=r("el-input"),oe=r("el-form"),ne=r("el-upload"),ie=r("el-tag"),de=r("el-alert"),ue=r("el-dialog");return o(),s(ue,{modelValue:w.value,"onUpdate:modelValue":a[5]||(a[5]=e=>w.value=e),title:"批量发货",width:"80%","before-close":le,class:"batch-shipping-dialog"},{footer:n(()=>[c("div",_a,[u(y,{onClick:le},{default:n(()=>[...a[24]||(a[24]=[p("取消",-1)])]),_:1}),u(y,{type:"info",onClick:X},{default:n(()=>[u(t,null,{default:n(()=>[u(m(I))]),_:1}),a[25]||(a[25]=p(" 保存草稿 ",-1))]),_:1}),u(y,{type:"primary",onClick:ee,loading:C.value},{default:n(()=>[u(t,null,{default:n(()=>[u(m(D))]),_:1}),a[26]||(a[26]=p(" 确认批量发货 ",-1))]),_:1},8,["loading"])])]),default:n(()=>[c("div",Rl,[c("div",Hl,[c("h3",jl,[u(t,null,{default:n(()=>[u(m(S))]),_:1}),p(" 选中订单 ("+h(e.selectedOrders.length)+"个) ",1)]),c("div",zl,[c("div",Ll,[c("div",Yl,[a[6]||(a[6]=c("div",{class:"card-title"},"订单总数",-1)),c("div",Wl,h(e.selectedOrders.length),1)]),c("div",Fl,[a[7]||(a[7]=c("div",{class:"card-title"},"总金额",-1)),c("div",Ql,"¥"+h(W(j.value)),1)]),c("div",Jl,[a[8]||(a[8]=c("div",{class:"card-title"},"代收款总额",-1)),c("div",Kl,"¥"+h(W(z.value)),1)])])]),c("div",Zl,[u(b,{data:e.selectedOrders,style:{width:"100%"},"max-height":"300"},{default:n(()=>[u(f,{prop:"orderNo",label:"订单号",width:"120"}),u(f,{prop:"customerName",label:"客户姓名",width:"100"}),u(f,{prop:"phone",label:"联系电话",width:"120"}),u(f,{prop:"address",label:"收货地址","min-width":"200","show-overflow-tooltip":""}),u(f,{prop:"totalAmount",label:"订单金额",width:"100",align:"right"},{default:n(({row:e})=>[p(" ¥"+h(W(e.totalAmount)),1)]),_:1}),u(f,{prop:"codAmount",label:"代收款",width:"100",align:"right"},{default:n(({row:e})=>[c("span",Gl,"¥"+h(W(e.codAmount)),1)]),_:1}),u(f,{label:"操作",width:"80",fixed:"right"},{default:n(({row:e,$index:l})=>[u(y,{type:"danger",size:"small",onClick:e=>{N.info("请在订单列表中取消选择该订单")},icon:m($),circle:""},null,8,["onClick","icon"])]),_:1})]),_:1},8,["data"])])]),c("div",Xl,[c("h3",ea,[u(t,null,{default:n(()=>[u(m(k))]),_:1}),a[9]||(a[9]=p(" 批量设置 ",-1))]),u(oe,{model:O,rules:R,ref_key:"formRef",ref:T,"label-width":"120px"},{default:n(()=>[c("div",la,[u(Y,{label:"物流公司",prop:"logisticsCompany",required:""},{default:n(()=>[u(V,{modelValue:O.logisticsCompany,"onUpdate:modelValue":a[0]||(a[0]=e=>O.logisticsCompany=e),placeholder:"请选择物流公司",class:"full-width",filterable:"",onChange:F},{default:n(()=>[(o(!0),i(g,null,v(H.value,e=>(o(),s(_,{key:e.code,label:e.name,value:e.code},{default:n(()=>[c("div",aa,[c("span",ta,h(e.name),1),c("span",ra,"("+h(e.code)+")",1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(Y,{label:"发货方式",prop:"shippingMethod"},{default:n(()=>[u(V,{modelValue:O.shippingMethod,"onUpdate:modelValue":a[1]||(a[1]=e=>O.shippingMethod=e),class:"full-width"},{default:n(()=>[u(_,{label:"标准快递",value:"standard"}),u(_,{label:"加急快递",value:"express"}),u(_,{label:"经济快递",value:"economy"})]),_:1},8,["modelValue"])]),_:1}),u(Y,{label:"运单号生成",prop:"trackingMode"},{default:n(()=>[u(te,{modelValue:O.trackingMode,"onUpdate:modelValue":a[2]||(a[2]=e=>O.trackingMode=e)},{default:n(()=>[u(ae,{label:"auto"},{default:n(()=>[...a[10]||(a[10]=[p("自动生成",-1)])]),_:1}),u(ae,{label:"manual"},{default:n(()=>[...a[11]||(a[11]=[p("手动输入",-1)])]),_:1}),u(ae,{label:"import"},{default:n(()=>[...a[12]||(a[12]=[p("批量导入",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),u(Y,{label:"预计送达",prop:"estimatedDelivery"},{default:n(()=>[u(re,{modelValue:O.estimatedDelivery,"onUpdate:modelValue":a[3]||(a[3]=e=>O.estimatedDelivery=e),type:"date",placeholder:"选择预计送达日期",class:"full-width","disabled-date":K},null,8,["modelValue"])]),_:1})]),u(Y,{label:"批量备注",prop:"remarks"},{default:n(()=>[u(se,{modelValue:O.remarks,"onUpdate:modelValue":a[4]||(a[4]=e=>O.remarks=e),type:"textarea",rows:3,placeholder:"请输入批量发货备注（选填）",maxlength:"200","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),"manual"===O.trackingMode?(o(),i("div",sa,[c("h3",oa,[u(t,null,{default:n(()=>[u(m(x))]),_:1}),a[13]||(a[13]=p(" 手动输入运单号 ",-1))]),c("div",na,[(o(!0),i(g,null,v(e.selectedOrders,(e,l)=>(o(),i("div",{key:e.id,class:"tracking-input-item"},[c("span",ia,h(e.orderNo)+"：",1),u(se,{modelValue:M.value[l],"onUpdate:modelValue":e=>M.value[l]=e,placeholder:"请输入运单号",class:"tracking-input",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]))),128))])])):d("",!0),"import"===O.trackingMode?(o(),i("div",da,[c("h3",ua,[u(t,null,{default:n(()=>[u(m(U))]),_:1}),a[14]||(a[14]=p(" 批量导入运单号 ",-1))]),c("div",ca,[u(ne,{class:"upload-demo",drag:"","auto-upload":!1,"on-change":Z,accept:".xlsx,.xls",limit:1},{tip:n(()=>[...a[15]||(a[15]=[c("div",{class:"el-upload__tip"},[p(" 支持 Excel 格式（.xlsx），包含：订单号、客户姓名、联系电话、收货地址、运单号、物流公司 "),c("br"),c("span",{style:{color:"#f56c6c"}},"注意：请先下载模板，填写完整后再导入")],-1)])]),default:n(()=>[u(t,{class:"el-icon--upload"},{default:n(()=>[u(m(E))]),_:1}),a[16]||(a[16]=c("div",{class:"el-upload__text"},[p(" 将文件拖到此处，或"),c("em",null,"点击上传")],-1))]),_:1}),c("div",pa,[u(y,{type:"text",onClick:G},{default:n(()=>[u(t,null,{default:n(()=>[u(m(B))]),_:1}),a[17]||(a[17]=p(" 下载模板 ",-1))]),_:1})])])])):d("",!0),c("div",ma,[c("h3",ga,[u(t,null,{default:n(()=>[u(m(A))]),_:1}),a[18]||(a[18]=p(" 发货预览 ",-1))]),u(b,{data:L.value,style:{width:"100%"},"max-height":"200"},{default:n(()=>[u(f,{prop:"orderNo",label:"订单号",width:"120"}),u(f,{prop:"customerName",label:"客户姓名",width:"100"}),u(f,{label:"物流公司",width:"120"},{default:n(()=>[p(h(Q()),1)]),_:1}),u(f,{label:"运单号",width:"150"},{default:n(({$index:e})=>["auto"===O.trackingMode?(o(),i("span",va," 自动生成 ")):"manual"===O.trackingMode?(o(),i("span",fa,h(M.value[e]||"待输入"),1)):(o(),i("span",ha,h(q.value[e]||"待导入"),1))]),_:1}),u(f,{label:"预计送达",width:"120"},{default:n(()=>[p(h(O.estimatedDelivery||"待设置"),1)]),_:1}),u(f,{label:"状态",width:"100"},{default:n(({$index:e})=>[u(ie,{type:J(e).type,size:"small"},{default:n(()=>[p(h(J(e).text),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),c("div",ya,[u(de,{title:"批量发货确认",type:"warning",closable:!1,"show-icon":""},{default:n(()=>[a[23]||(a[23]=c("p",null,"确认批量发货后，系统将：",-1)),c("ul",null,[c("li",null,"批量更新 "+h(e.selectedOrders.length)+' 个订单状态为"已发货"',1),a[19]||(a[19]=c("li",null,"记录所有订单的物流信息和运单号",-1)),a[20]||(a[20]=c("li",null,"批量发送发货通知给客户",-1)),a[21]||(a[21]=c("li",null,"开始批量物流跟踪",-1))]),c("p",ba,[u(t,null,{default:n(()=>[u(m(P))]),_:1}),a[22]||(a[22]=p(" 批量发货操作无法撤销，请确认信息无误后再执行！ ",-1))])]),_:1})])])]),_:1},8,["modelValue"])}}}),ka=ee(wa,[["__scopeId","data-v-7e634072"]]),Ta={key:0,class:"return-content"},xa={class:"order-summary"},Aa={class:"section-title"},Ca={class:"order-info-grid"},Na={class:"info-item"},Va={class:"value"},Sa={class:"info-item"},Da={class:"value"},Oa={class:"info-item"},Ma={class:"value"},Ia={class:"info-item"},$a={class:"value"},Ua={class:"info-item"},Ea={class:"value"},Ba={class:"info-item"},Pa={class:"value"},qa={class:"return-reason"},Ra={class:"section-title"},Ha={class:"return-confirm"},ja={class:"warning-text"},za={key:0,class:"return-history"},La={class:"section-title"},Ya={class:"history-list"},Wa={class:"history-header"},Fa={class:"history-time"},Qa={class:"history-content"},Ja={key:0},Ka={class:"dialog-footer"},Za=ee(e({__name:"ReturnOrderDialog",props:{visible:{type:Boolean},order:{}},emits:["update:visible","returned"],setup(e,{emit:t}){const f=e,b=t,_=l({get:()=>f.visible,set:e=>b("update:visible",e)}),w=a(),k=a(!1),T=y({returnType:"",reason:"",urgency:"medium",suggestion:"",notificationMethod:["system"]}),x={returnType:[{required:!0,message:"请选择退回类型",trigger:"change"}],reason:[{required:!0,message:"请填写退回原因",trigger:"blur"},{min:10,message:"退回原因至少10个字符",trigger:"blur"}]},A=a([{returnTime:"2024-01-10 14:30:00",returnType:"address_error",reason:"客户地址信息不完整，缺少详细门牌号",suggestion:"联系客户补充完整地址信息",urgency:"medium",operator:"张三"}]),C=e=>({pending:"待审核",confirmed:"已确认",shipped:"已发货",delivered:"已送达",returned:"已退回",cancelled:"已取消"}[e]||"未知状态"),D=e=>({low:"一般",medium:"紧急",high:"非常紧急"}[e]||"一般"),O=async()=>{try{N.loading("正在保存草稿..."),await new Promise(e=>setTimeout(e,1e3)),N.success("草稿保存成功")}catch(e){N.error("草稿保存失败")}},M=async()=>{if(w.value)try{await w.value.validate(),await V.confirm(`确认退回订单 ${f.order.orderNo} 吗？退回后订单将重新分配给销售人员处理。`,"确认退回订单",{confirmButtonText:"确认退回",cancelButtonText:"取消",type:"warning"}),k.value=!0,await new Promise(e=>setTimeout(e,2e3));const e={orderId:f.order.id,orderNo:f.order.orderNo,...T,returnTime:(new Date).toISOString(),operator:"当前用户",status:"returned"};b("returned",e),N.success("订单退回成功！已通知相关人员"),$()}catch(e){"cancel"!==e&&N.error("订单退回失败，请重试")}finally{k.value=!1}},$=()=>{w.value&&w.value.resetFields(),Object.assign(T,{returnType:"",reason:"",urgency:"medium",suggestion:"",notificationMethod:["system"]}),_.value=!1};return(l,a)=>{const t=r("el-icon"),f=r("el-tag"),y=r("el-option"),b=r("el-select"),N=r("el-form-item"),V=r("el-input"),U=r("el-radio"),E=r("el-radio-group"),B=r("el-checkbox"),j=r("el-checkbox-group"),z=r("el-form"),L=r("el-alert"),Y=r("el-button"),W=r("el-dialog");return o(),s(W,{modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=e=>_.value=e),title:"退回订单",width:"50%","before-close":$,class:"return-order-dialog"},{footer:n(()=>[c("div",Ka,[u(Y,{onClick:$},{default:n(()=>[...a[32]||(a[32]=[p("取消",-1)])]),_:1}),u(Y,{type:"info",onClick:O},{default:n(()=>[u(t,null,{default:n(()=>[u(m(I))]),_:1}),a[33]||(a[33]=p(" 保存草稿 ",-1))]),_:1}),u(Y,{type:"danger",onClick:M,loading:k.value},{default:n(()=>[u(t,null,{default:n(()=>[u(m(H))]),_:1}),a[34]||(a[34]=p(" 确认退回 ",-1))]),_:1},8,["loading"])])]),default:n(()=>{return[e.order?(o(),i("div",Ta,[c("div",xa,[c("h3",Aa,[u(t,null,{default:n(()=>[u(m(S))]),_:1}),a[6]||(a[6]=p(" 订单信息 ",-1))]),c("div",Ca,[c("div",Na,[a[7]||(a[7]=c("span",{class:"label"},"订单号：",-1)),c("span",Va,h(e.order.orderNo),1)]),c("div",Sa,[a[8]||(a[8]=c("span",{class:"label"},"客户姓名：",-1)),c("span",Da,h(e.order.customerName),1)]),c("div",Oa,[a[9]||(a[9]=c("span",{class:"label"},"联系电话：",-1)),c("span",Ma,h(m(me)(e.order.phone,"phone")),1)]),c("div",Ia,[a[10]||(a[10]=c("span",{class:"label"},"订单金额：",-1)),c("span",$a,"¥"+h((r=e.order.totalAmount,r.toLocaleString())),1)]),c("div",Ua,[a[11]||(a[11]=c("span",{class:"label"},"当前状态：",-1)),c("span",Ea,[u(f,{type:(l=e.order.status,{pending:"warning",confirmed:"success",shipped:"primary",delivered:"success",returned:"danger",cancelled:"info"}[l]||"info")},{default:n(()=>[p(h(C(e.order.status)),1)]),_:1},8,["type"])])]),c("div",Ba,[a[12]||(a[12]=c("span",{class:"label"},"负责销售：",-1)),c("span",Pa,h(e.order.salesperson||"未分配"),1)])])]),c("div",qa,[c("h3",Ra,[u(t,null,{default:n(()=>[u(m(q))]),_:1}),a[13]||(a[13]=p(" 退回原因 ",-1))]),u(z,{model:T,rules:x,ref_key:"formRef",ref:w,"label-width":"120px"},{default:n(()=>[u(N,{label:"退回类型",prop:"returnType",required:""},{default:n(()=>[u(b,{modelValue:T.returnType,"onUpdate:modelValue":a[0]||(a[0]=e=>T.returnType=e),placeholder:"请选择退回类型",class:"full-width"},{default:n(()=>[u(y,{label:"地址信息错误",value:"address_error"}),u(y,{label:"客户信息不符",value:"customer_info_error"}),u(y,{label:"商品信息错误",value:"product_error"}),u(y,{label:"价格信息错误",value:"price_error"}),u(y,{label:"库存不足",value:"stock_shortage"}),u(y,{label:"客户要求修改",value:"customer_request"}),u(y,{label:"物流配送问题",value:"logistics_issue"}),u(y,{label:"其他原因",value:"other"})]),_:1},8,["modelValue"])]),_:1}),u(N,{label:"退回原因",prop:"reason",required:""},{default:n(()=>[u(V,{modelValue:T.reason,"onUpdate:modelValue":a[1]||(a[1]=e=>T.reason=e),type:"textarea",rows:4,placeholder:"请详细说明退回原因，以便销售人员及时处理",maxlength:"500","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1}),u(N,{label:"紧急程度",prop:"urgency"},{default:n(()=>[u(E,{modelValue:T.urgency,"onUpdate:modelValue":a[2]||(a[2]=e=>T.urgency=e)},{default:n(()=>[u(U,{label:"low"},{default:n(()=>[u(f,{type:"info",size:"small"},{default:n(()=>[...a[14]||(a[14]=[p("一般",-1)])]),_:1}),a[15]||(a[15]=c("span",{class:"urgency-desc"},"可在1-2个工作日内处理",-1))]),_:1}),u(U,{label:"medium"},{default:n(()=>[u(f,{type:"warning",size:"small"},{default:n(()=>[...a[16]||(a[16]=[p("紧急",-1)])]),_:1}),a[17]||(a[17]=c("span",{class:"urgency-desc"},"需要当天处理",-1))]),_:1}),u(U,{label:"high"},{default:n(()=>[u(f,{type:"danger",size:"small"},{default:n(()=>[...a[18]||(a[18]=[p("非常紧急",-1)])]),_:1}),a[19]||(a[19]=c("span",{class:"urgency-desc"},"需要立即处理",-1))]),_:1})]),_:1},8,["modelValue"])]),_:1}),u(N,{label:"处理建议",prop:"suggestion"},{default:n(()=>[u(V,{modelValue:T.suggestion,"onUpdate:modelValue":a[3]||(a[3]=e=>T.suggestion=e),type:"textarea",rows:3,placeholder:"请提供处理建议（选填）",maxlength:"300","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1}),u(N,{label:"通知方式",prop:"notificationMethod"},{default:n(()=>[u(j,{modelValue:T.notificationMethod,"onUpdate:modelValue":a[4]||(a[4]=e=>T.notificationMethod=e)},{default:n(()=>[u(B,{label:"system"},{default:n(()=>[...a[20]||(a[20]=[p("系统消息",-1)])]),_:1}),u(B,{label:"email"},{default:n(()=>[...a[21]||(a[21]=[p("邮件通知",-1)])]),_:1}),u(B,{label:"sms"},{default:n(()=>[...a[22]||(a[22]=[p("短信通知",-1)])]),_:1}),u(B,{label:"wechat"},{default:n(()=>[...a[23]||(a[23]=[p("微信通知",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),c("div",Ha,[u(L,{title:"退回确认",type:"warning",closable:!1,"show-icon":""},{default:n(()=>[a[25]||(a[25]=c("p",null,"确认退回订单后，系统将：",-1)),a[26]||(a[26]=c("ul",null,[c("li",null,'将订单状态更改为"已退回"'),c("li",null,"订单将重新分配给负责销售人员"),c("li",null,"发送退回通知给相关人员"),c("li",null,"记录退回原因和处理建议"),c("li",null,"生成退回处理任务")],-1)),c("p",ja,[u(t,null,{default:n(()=>[u(m(P))]),_:1}),a[24]||(a[24]=p(" 退回后订单将从发货列表中移除，请确认退回原因准确无误！ ",-1))])]),_:1})]),A.value.length>0?(o(),i("div",za,[c("h3",La,[u(t,null,{default:n(()=>[u(m(R))]),_:1}),a[27]||(a[27]=p(" 历史退回记录 ",-1))]),c("div",Ya,[(o(!0),i(g,null,v(A.value,(e,l)=>{return o(),i("div",{key:l,class:"history-item"},[c("div",Wa,[c("span",Fa,h(e.returnTime),1),u(f,{type:(r=e.urgency,{low:"info",medium:"warning",high:"danger"}[r]||"info"),size:"small"},{default:n(()=>[p(h(D(e.urgency)),1)]),_:2},1032,["type"])]),c("div",Qa,[c("p",null,[a[28]||(a[28]=c("strong",null,"退回类型：",-1)),p(h((t=e.returnType,{address_error:"地址信息错误",customer_info_error:"客户信息不符",product_error:"商品信息错误",price_error:"价格信息错误",stock_shortage:"库存不足",customer_request:"客户要求修改",logistics_issue:"物流配送问题",other:"其他原因"}[t]||"未知类型")),1)]),c("p",null,[a[29]||(a[29]=c("strong",null,"退回原因：",-1)),p(h(e.reason),1)]),e.suggestion?(o(),i("p",Ja,[a[30]||(a[30]=c("strong",null,"处理建议：",-1)),p(h(e.suggestion),1)])):d("",!0),c("p",null,[a[31]||(a[31]=c("strong",null,"操作人员：",-1)),p(h(e.operator),1)])])]);var t,r}),128))])])):d("",!0)])):d("",!0)];var l,r}),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-a6d3626a"]]),Ga={key:0,class:"cancel-content"},Xa={class:"order-summary"},et={class:"section-title"},lt={class:"order-info-grid"},at={class:"info-item"},tt={class:"value"},rt={class:"info-item"},st={class:"value"},ot={class:"info-item"},nt={class:"value"},it={class:"info-item"},dt={class:"value"},ut={class:"info-item"},ct={class:"value"},pt={class:"info-item"},mt={class:"value cod-amount"},gt={class:"info-item"},vt={class:"value"},ft={class:"info-item"},ht={class:"value"},yt={class:"cancel-reason"},bt={class:"section-title"},_t={class:"refund-option"},wt={class:"refund-desc"},kt={class:"refund-tip"},Tt={class:"cancel-confirm"},xt={key:0},At={key:1},Ct={key:2},Nt={key:3},Vt={class:"warning-text"},St={key:0,class:"cancel-history"},Dt={class:"section-title"},Ot={class:"history-list"},Mt={class:"history-header"},It={class:"history-time"},$t={class:"history-content"},Ut={class:"dialog-footer"},Et=ee(e({__name:"CancelOrderDialog",props:{visible:{type:Boolean},order:{}},emits:["update:visible","cancelled"],setup(e,{emit:t}){const f=e,_=t,w=l({get:()=>f.visible,set:e=>_("update:visible",e)}),k=a(),T=a(!1),x=y({cancelType:"",reason:"",refundType:"full_refund",refundAmount:0,feeDescription:"",notifyCustomer:!0,notificationMethod:["sms"],remarks:""}),A={cancelType:[{required:!0,message:"请选择取消类型",trigger:"change"}],reason:[{required:!0,message:"请填写取消原因",trigger:"blur"},{min:10,message:"取消原因至少10个字符",trigger:"blur"}],refundType:[{required:!0,message:"请选择退款处理方式",trigger:"change"}],refundAmount:[{required:!0,message:"请输入退款金额",trigger:"blur"}]},C=a([{orderNo:"ORD202401001",cancelTime:"2024-01-05 16:20:00",cancelType:"customer_cancel",reason:"客户临时改变主意，不需要该商品",refundType:"full_refund",operator:"李四"}]);b(()=>x.refundType,e=>{x.refundAmount="full_refund"===e?f.order?.deposit||0:"partial_refund"===e?Math.round(.8*(f.order?.deposit||0)):0});const D=e=>e.toLocaleString(),O=e=>({pending:"待审核",confirmed:"已确认",shipped:"已发货",delivered:"已送达",returned:"已退回",cancelled:"已取消"}[e]||"未知状态"),M=async()=>{try{N.loading("正在保存草稿..."),await new Promise(e=>setTimeout(e,1e3)),N.success("草稿保存成功")}catch(e){N.error("草稿保存失败")}},$=async()=>{if(k.value)try{await k.value.validate();const e="full_refund"===x.refundType?`确认取消订单 ${f.order.orderNo} 并全额退款 ¥${D(f.order.deposit)} 吗？`:"partial_refund"===x.refundType?`确认取消订单 ${f.order.orderNo} 并退款 ¥${D(x.refundAmount)} 吗？`:`确认取消订单 ${f.order.orderNo} 且不退款吗？`;await V.confirm(e+" 此操作无法撤销！","确认取消订单",{confirmButtonText:"确认取消",cancelButtonText:"取消",type:"error"}),T.value=!0,await new Promise(e=>setTimeout(e,2e3));const l={orderId:f.order.id,orderNo:f.order.orderNo,...x,cancelTime:(new Date).toISOString(),operator:"当前用户",status:"cancelled"};_("cancelled",l),N.success("订单取消成功！"),U()}catch(e){"cancel"!==e&&N.error("订单取消失败，请重试")}finally{T.value=!1}},U=()=>{k.value&&k.value.resetFields(),Object.assign(x,{cancelType:"",reason:"",refundType:"full_refund",refundAmount:0,feeDescription:"",notifyCustomer:!0,notificationMethod:["sms"],remarks:""}),w.value=!1};return(l,a)=>{const t=r("el-icon"),f=r("el-tag"),y=r("el-option"),b=r("el-select"),_=r("el-form-item"),N=r("el-input"),V=r("el-radio"),E=r("el-radio-group"),B=r("el-input-number"),H=r("el-switch"),z=r("el-checkbox"),L=r("el-checkbox-group"),Y=r("el-form"),W=r("el-alert"),F=r("el-button"),Q=r("el-dialog");return o(),s(Q,{modelValue:w.value,"onUpdate:modelValue":a[8]||(a[8]=e=>w.value=e),title:"取消订单",width:"50%","before-close":U,class:"cancel-order-dialog"},{footer:n(()=>[c("div",Ut,[u(F,{onClick:U},{default:n(()=>[...a[38]||(a[38]=[p("取消",-1)])]),_:1}),u(F,{type:"info",onClick:M},{default:n(()=>[u(t,null,{default:n(()=>[u(m(I))]),_:1}),a[39]||(a[39]=p(" 保存草稿 ",-1))]),_:1}),u(F,{type:"danger",onClick:$,loading:T.value},{default:n(()=>[u(t,null,{default:n(()=>[u(m(j))]),_:1}),a[40]||(a[40]=p(" 确认取消订单 ",-1))]),_:1},8,["loading"])])]),default:n(()=>{return[e.order?(o(),i("div",Ga,[c("div",Xa,[c("h3",et,[u(t,null,{default:n(()=>[u(m(S))]),_:1}),a[9]||(a[9]=p(" 订单信息 ",-1))]),c("div",lt,[c("div",at,[a[10]||(a[10]=c("span",{class:"label"},"订单号：",-1)),c("span",tt,h(e.order.orderNo),1)]),c("div",rt,[a[11]||(a[11]=c("span",{class:"label"},"客户姓名：",-1)),c("span",st,h(e.order.customerName),1)]),c("div",ot,[a[12]||(a[12]=c("span",{class:"label"},"联系电话：",-1)),c("span",nt,h(m(me)(e.order.phone,"phone")),1)]),c("div",it,[a[13]||(a[13]=c("span",{class:"label"},"订单金额：",-1)),c("span",dt,"¥"+h(D(e.order.totalAmount)),1)]),c("div",ut,[a[14]||(a[14]=c("span",{class:"label"},"定金：",-1)),c("span",ct,"¥"+h(D(e.order.deposit)),1)]),c("div",pt,[a[15]||(a[15]=c("span",{class:"label"},"代收款：",-1)),c("span",mt,"¥"+h(D(e.order.codAmount)),1)]),c("div",gt,[a[16]||(a[16]=c("span",{class:"label"},"当前状态：",-1)),c("span",vt,[u(f,{type:(l=e.order.status,{pending:"warning",confirmed:"success",shipped:"primary",delivered:"success",returned:"danger",cancelled:"info"}[l]||"info")},{default:n(()=>[p(h(O(e.order.status)),1)]),_:1},8,["type"])])]),c("div",ft,[a[17]||(a[17]=c("span",{class:"label"},"负责销售：",-1)),c("span",ht,h(e.order.createdBy||"系统用户"),1)])])]),c("div",yt,[c("h3",bt,[u(t,null,{default:n(()=>[u(m(q))]),_:1}),a[18]||(a[18]=p(" 取消原因 ",-1))]),u(Y,{model:x,rules:A,ref_key:"formRef",ref:k,"label-width":"120px"},{default:n(()=>[u(_,{label:"取消类型",prop:"cancelType",required:""},{default:n(()=>[u(b,{modelValue:x.cancelType,"onUpdate:modelValue":a[0]||(a[0]=e=>x.cancelType=e),placeholder:"请选择取消类型",class:"full-width"},{default:n(()=>[u(y,{label:"客户主动取消",value:"customer_cancel"}),u(y,{label:"客户联系不上",value:"customer_unreachable"}),u(y,{label:"地址无法配送",value:"address_undeliverable"}),u(y,{label:"商品缺货",value:"out_of_stock"}),u(y,{label:"价格争议",value:"price_dispute"}),u(y,{label:"重复订单",value:"duplicate_order"}),u(y,{label:"欺诈订单",value:"fraud_order"}),u(y,{label:"系统错误",value:"system_error"}),u(y,{label:"其他原因",value:"other"})]),_:1},8,["modelValue"])]),_:1}),u(_,{label:"取消原因",prop:"reason",required:""},{default:n(()=>[u(N,{modelValue:x.reason,"onUpdate:modelValue":a[1]||(a[1]=e=>x.reason=e),type:"textarea",rows:4,placeholder:"请详细说明取消原因",maxlength:"500","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1}),u(_,{label:"退款处理",prop:"refundType",required:""},{default:n(()=>[u(E,{modelValue:x.refundType,"onUpdate:modelValue":a[2]||(a[2]=e=>x.refundType=e)},{default:n(()=>[u(V,{label:"full_refund"},{default:n(()=>[c("span",_t,[a[19]||(a[19]=c("strong",null,"全额退款",-1)),c("span",wt,"退还全部定金 ¥"+h(D(e.order.deposit)),1)])]),_:1}),u(V,{label:"partial_refund"},{default:n(()=>[...a[20]||(a[20]=[c("span",{class:"refund-option"},[c("strong",null,"部分退款"),c("span",{class:"refund-desc"},"扣除手续费后退款")],-1)])]),_:1}),u(V,{label:"no_refund"},{default:n(()=>[...a[21]||(a[21]=[c("span",{class:"refund-option"},[c("strong",null,"不退款"),c("span",{class:"refund-desc"},"定金不予退还")],-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"partial_refund"===x.refundType?(o(),s(_,{key:0,label:"退款金额",prop:"refundAmount"},{default:n(()=>[u(B,{modelValue:x.refundAmount,"onUpdate:modelValue":a[3]||(a[3]=e=>x.refundAmount=e),min:0,max:e.order.deposit,precision:2,placeholder:"退款金额",class:"refund-input"},null,8,["modelValue","max"]),c("span",kt," 最大可退款金额：¥"+h(D(e.order.deposit)),1)]),_:1})):d("",!0),"partial_refund"===x.refundType?(o(),s(_,{key:1,label:"手续费说明",prop:"feeDescription"},{default:n(()=>[u(N,{modelValue:x.feeDescription,"onUpdate:modelValue":a[4]||(a[4]=e=>x.feeDescription=e),placeholder:"请说明扣除手续费的原因",maxlength:"200","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1})):d("",!0),u(_,{label:"通知客户",prop:"notifyCustomer"},{default:n(()=>[u(H,{modelValue:x.notifyCustomer,"onUpdate:modelValue":a[5]||(a[5]=e=>x.notifyCustomer=e),"active-text":"发送取消通知","inactive-text":"不发送通知"},null,8,["modelValue"])]),_:1}),x.notifyCustomer?(o(),s(_,{key:2,label:"通知方式",prop:"notificationMethod"},{default:n(()=>[u(L,{modelValue:x.notificationMethod,"onUpdate:modelValue":a[6]||(a[6]=e=>x.notificationMethod=e)},{default:n(()=>[u(z,{label:"sms"},{default:n(()=>[...a[22]||(a[22]=[p("短信通知",-1)])]),_:1}),u(z,{label:"phone"},{default:n(()=>[...a[23]||(a[23]=[p("电话通知",-1)])]),_:1}),u(z,{label:"wechat"},{default:n(()=>[...a[24]||(a[24]=[p("微信通知",-1)])]),_:1}),u(z,{label:"email"},{default:n(()=>[...a[25]||(a[25]=[p("邮件通知",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):d("",!0),u(_,{label:"备注说明",prop:"remarks"},{default:n(()=>[u(N,{modelValue:x.remarks,"onUpdate:modelValue":a[7]||(a[7]=e=>x.remarks=e),type:"textarea",rows:3,placeholder:"其他备注说明（选填）",maxlength:"300","show-word-limit":"",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),c("div",Tt,[u(W,{title:"取消确认",type:"error",closable:!1,"show-icon":""},{default:n(()=>[a[30]||(a[30]=c("p",null,"确认取消订单后，系统将：",-1)),c("ul",null,[a[26]||(a[26]=c("li",null,'将订单状态更改为"已取消"',-1)),"full_refund"===x.refundType?(o(),i("li",xt," 处理全额退款 ¥"+h(D(e.order.deposit)),1)):"partial_refund"===x.refundType?(o(),i("li",At," 处理部分退款 ¥"+h(D(x.refundAmount)),1)):(o(),i("li",Ct," 定金不予退还 ")),x.notifyCustomer?(o(),i("li",Nt,"发送取消通知给客户")):d("",!0),a[27]||(a[27]=c("li",null,"记录取消原因和处理过程",-1)),a[28]||(a[28]=c("li",null,"更新库存和销售数据",-1))]),c("p",Vt,[u(t,null,{default:n(()=>[u(m(P))]),_:1}),a[29]||(a[29]=p(" 订单取消后无法恢复，请确认操作无误！ ",-1))])]),_:1})]),C.value.length>0?(o(),i("div",St,[c("h3",Dt,[u(t,null,{default:n(()=>[u(m(R))]),_:1}),a[31]||(a[31]=p(" 相关取消记录 ",-1))]),c("div",Ot,[(o(!0),i(g,null,v(C.value,(e,l)=>{return o(),i("div",{key:l,class:"history-item"},[c("div",Mt,[c("span",It,h(e.cancelTime),1),u(f,{type:"danger",size:"small"},{default:n(()=>[...a[32]||(a[32]=[p("已取消",-1)])]),_:1})]),c("div",$t,[c("p",null,[a[33]||(a[33]=c("strong",null,"订单号：",-1)),p(h(e.orderNo),1)]),c("p",null,[a[34]||(a[34]=c("strong",null,"取消类型：",-1)),p(h((r=e.cancelType,{customer_cancel:"客户主动取消",customer_unreachable:"客户联系不上",address_undeliverable:"地址无法配送",out_of_stock:"商品缺货",price_dispute:"价格争议",duplicate_order:"重复订单",fraud_order:"欺诈订单",system_error:"系统错误",other:"其他原因"}[r]||"未知类型")),1)]),c("p",null,[a[35]||(a[35]=c("strong",null,"取消原因：",-1)),p(h(e.reason),1)]),c("p",null,[a[36]||(a[36]=c("strong",null,"退款处理：",-1)),p(h((t=e.refundType,{full_refund:"全额退款",partial_refund:"部分退款",no_refund:"不退款"}[t]||"未知")),1)]),c("p",null,[a[37]||(a[37]=c("strong",null,"操作人员：",-1)),p(h(e.operator),1)])])]);var t,r}),128))])])):d("",!0)])):d("",!0)];var l}),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-1986e1a4"]]),Bt={class:"shipping-list"},Pt={class:"metrics-grid"},qt={class:"metrics-row"},Rt={class:"metric-card"},Ht={class:"metric-icon total-orders"},jt={class:"metric-content"},zt={class:"metric-value"},Lt={class:"metric-card"},Yt={class:"metric-icon total-amount"},Wt={class:"metric-content"},Ft={class:"metric-value"},Qt={class:"metric-card"},Jt={class:"metric-icon shipped-today"},Kt={class:"metric-content"},Zt={class:"metric-value"},Gt={class:"metrics-row"},Xt={class:"metric-card"},er={class:"metric-icon urgent-orders"},lr={class:"metric-content"},ar={class:"metric-value"},tr={class:"metric-card"},rr={class:"metric-icon cod-orders"},sr={class:"metric-content"},or={class:"metric-value"},nr={class:"metric-card"},ir={class:"metric-icon cod-amount"},dr={class:"metric-content"},ur={class:"metric-value"},cr={class:"quick-filters"},pr={class:"filter-section"},mr={class:"filter-left"},gr={class:"filter-right"},vr={class:"status-tabs"},fr={class:"tabs-header"},hr={class:"tab-label"},yr={class:"tab-label"},br={class:"tab-label"},_r={class:"tab-label"},wr={class:"tab-label"},kr={class:"tabs-actions"},Tr={class:"product-list"},xr={class:"amount"},Ar={class:"amount"},Cr={class:"amount highlight"},Nr=["innerHTML"],Vr={key:1,class:"no-remark"},Sr={key:1,class:"no-data"},Dr={key:0,class:"express-no"},Or={key:1,class:"no-data"},Mr={key:1,class:"no-data"},Ir={key:0,class:"operation-info"},$r={class:"operation-action"},Ur={class:"operation-meta"},Er={class:"operation-user"},Br={class:"operation-time"},Pr={key:1,class:"no-data"},qr={class:"action-buttons"},Rr={class:"fullscreen-content"},Hr={class:"fullscreen-filters"},jr={class:"filter-left"},zr={class:"filter-right"},Lr={class:"fullscreen-table"},Yr={class:"amount"},Wr={class:"cod-amount"},Fr={class:"operation-buttons"},Qr={class:"fullscreen-pagination"},Jr=ee(e({name:"LogisticsShipping",__name:"Shipping",setup(e){const f=_(),k=ie(f),T=y({totalOrders:0,totalAmount:0,shippedToday:0,urgentOrders:0,codOrders:0,codAmount:0}),O=[{label:"全部",value:"all"},{label:"今日订单",value:"today"},{label:"昨日订单",value:"yesterday"},{label:"本周订单",value:"thisWeek"},{label:"本月订单",value:"thisMonth"},{label:"今年订单",value:"thisYear"},{label:"紧急订单",value:"urgent"},{label:"代收款订单",value:"cod"},{label:"大额订单",value:"large"}],M=a("all"),U=a("pending"),E=y({pending:0,shipped:0,returned:0,cancelled:0,draft:0}),P=a(null),R=a(""),H=a(""),j=a(""),ee=a([]),te=a([]),ve=a(0),fe=a(1),he=a(50),be=a(!1),_e=a(!1),we=a(!1),ke=a(!1),Te=a(!1),xe=a(!1),Ae=a(!1),Ce=a(!1),Ne=a(null),Ve=le(),Se=ae(),De=re(),Oe=de(),Me=se(),Ie=ue(),$e=l(()=>`${{pending:"待发货",shipped:"已发货",returned:"退回",cancelled:"取消",draft:"草稿"}[U.value]||"发货"}列表`),Ue=[{prop:"orderNo",label:"订单号",width:140,visible:!0},{prop:"status",label:"订单状态",width:100,align:"center",visible:!0},{prop:"customerName",label:"客户名字",width:100,align:"center",showOverflowTooltip:!0,visible:!0},{prop:"phone",label:"电话",width:120,align:"center",showOverflowTooltip:!0,visible:!0},{prop:"address",label:"地址",width:200,showOverflowTooltip:!0,visible:!0},{prop:"createTime",label:"下单时间",width:150,align:"center",visible:!0},{prop:"productsText",label:"商品",width:200,showOverflowTooltip:!0,visible:!0},{prop:"totalQuantity",label:"数量",width:80,align:"center",visible:!0},{prop:"totalAmount",label:"订单总额",width:120,align:"center",visible:!0},{prop:"deposit",label:"定金",width:100,align:"center",visible:!0},{prop:"codAmount",label:"代收款金额",width:120,align:"center",visible:!0},{prop:"customerAge",label:"年龄",width:80,align:"center",visible:!0},{prop:"customerHeight",label:"身高",width:80,align:"center",visible:!0},{prop:"customerWeight",label:"体重",width:80,align:"center",visible:!0},{prop:"medicalHistory",label:"疾病史",width:120,showOverflowTooltip:!0,visible:!0},{prop:"serviceWechat",label:"客服微信号",width:120,align:"center",showOverflowTooltip:!0,visible:!0},{prop:"orderSource",label:"订单来源",width:110,align:"center",visible:!0},{prop:"paymentMethod",label:"支付方式",width:100,align:"center",visible:!0},{prop:"remark",label:"订单备注",width:150,showOverflowTooltip:!0,visible:!0},{prop:"expressCompany",label:"物流公司",width:120,align:"center",visible:!0},{prop:"expressNo",label:"物流单号",width:150,align:"center",visible:!0},{prop:"logisticsStatus",label:"物流状态",width:100,align:"center",visible:!0},{prop:"lastOperation",label:"最近操作",width:200,showOverflowTooltip:!0,visible:!1}],Ee=l(()=>{const e=Ie.visibleCustomFields.map(e=>({prop:`customFields.${e.fieldKey}`,label:e.fieldName,width:"text"===e.fieldType?150:100,align:"center",showOverflowTooltip:!0,visible:!0,isCustomField:!0,fieldConfig:e})),l=Ue.findIndex(e=>"remark"===e.prop),a=[...Ue];return l>-1&&e.length>0?a.splice(l,0,...e):e.length>0&&a.push(...e),a}),Be=e=>null==e||isNaN(e)?"0":e.toLocaleString(),Pe=e=>{if(!e)return"-";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},qe=e=>{if(!e)return"-";return{online_store:"🛒 线上商城",wechat_mini:"📱 微信小程序",wechat_service:"💬 微信客服",phone_call:"📞 电话咨询",offline_store:"🏪 线下门店",referral:"👥 客户推荐",advertisement:"📺 广告投放",other:"🎯 其他渠道"}[e]||e},Re=e=>{if(!e)return"-";return{wechat:"微信支付",alipay:"支付宝",bank_transfer:"银行转账",unionpay:"云闪付",cod:"货到付款",cash:"现金",card:"刷卡",other:"其他"}[e]||e},He=e=>({pending_transfer:"info",pending_audit:"warning",audit_rejected:"danger",pending_shipment:"primary",shipped:"success",delivered:"success",package_exception:"danger",rejected:"danger",rejected_returned:"warning",logistics_returned:"warning",logistics_cancelled:"info",after_sales_created:"info",cancelled:"info",draft:"info"}[e]||"info"),je=({row:e})=>"urgent"===e.status?"urgent-row":"cod"===e.status?"cod-row":"",ze=e=>{let l=e;return["紧急","加急","重要","特殊","注意"].forEach(e=>{const a=new RegExp(e,"gi");l=l.replace(a,`<span class="highlight-keyword">${e}</span>`)}),l},Le=e=>{U.value=e,fe.value=1,Ye(),hl()},Ye=()=>{We()},We=async()=>{try{be.value=!0,console.log("[发货列表] 开始加载订单列表，当前标签页:",U.value),0===Me.customers.length&&await Me.loadCustomers();const e=await Ve.getOrdersByShippingStatus(U.value);if(console.log("[发货列表] getOrdersByShippingStatus 返回的订单数量:",e?.length||0),!Array.isArray(e))return console.error("[发货列表] getOrdersByShippingStatus 返回的不是数组:",e),ee.value=[],void(ve.value=0);console.log("[发货列表] 获取到的订单列表:",e.map(e=>({orderNumber:e.orderNumber,status:e.status,auditStatus:e.auditStatus,customerName:e.customerName})));let l=[...e];if("all"!==M.value)switch(M.value){case"today":const e=(new Date).toISOString().split("T")[0];l=l.filter(l=>l.createTime&&l.createTime.startsWith(e));break;case"yesterday":const a=new Date;a.setDate(a.getDate()-1);const t=a.toISOString().split("T")[0];l=l.filter(e=>e.createTime&&e.createTime.startsWith(t));break;case"thisWeek":const r=new Date,s=new Date(r),o=r.getDay(),n=0===o?6:o-1;s.setDate(r.getDate()-n),s.setHours(0,0,0,0),l=l.filter(e=>{if(!e.createTime)return!1;return new Date(e.createTime)>=s});break;case"thisMonth":const i=new Date,d=new Date(i.getFullYear(),i.getMonth(),1);l=l.filter(e=>{if(!e.createTime)return!1;return new Date(e.createTime)>=d});break;case"thisYear":const u=(new Date).getFullYear(),c=new Date(u,0,1);l=l.filter(e=>{if(!e.createTime)return!1;return new Date(e.createTime)>=c});break;case"urgent":l=l.filter(e=>"urgent"===e.status);break;case"cod":l=l.filter(e=>(e.codAmount||0)>0);break;case"large":l=l.filter(e=>(e.totalAmount||0)>1e3)}if(P.value&&2===P.value.length){const[e,a]=P.value;l=l.filter(l=>{const t=l.createTime?.split("T")[0];return t>=e&&t<=a})}R.value&&(l=l.filter(e=>e.department&&e.department===R.value)),H.value&&(l=l.filter(e=>e.orderNumber&&e.orderNumber.includes(H.value))),j.value&&(l=l.filter(e=>e.customerPhone&&e.customerPhone.includes(j.value))),l.sort((e,l)=>{const a=new Date(e.createTime||e.shippingTime||0).getTime();return new Date(l.createTime||l.shippingTime||0).getTime()-a});const a=(fe.value-1)*he.value,t=a+he.value;ee.value=l.slice(a,t),ve.value=l.length,ee.value=ee.value.map(e=>{const l=Ve.getOperationLogs(e.id)||[],a=l.length>0?l[l.length-1]:{action:"创建订单",operator:e.createdBy||"系统",time:e.createTime};let t={};if(e.customerId){const l=Me.getCustomerById(e.customerId);l&&(t={customerAge:l.age||null,customerHeight:l.height||null,customerWeight:l.weight||null,medicalHistory:l.medicalHistory||l.disease||null,serviceWechat:e.serviceWechat||l.serviceWechat||l.wechat||l.wechatId||null})}const r=Array.isArray(e.products)?e.products:[],s=r.map(e=>`${e.name} × ${e.quantity}`).join("，")||"-",o=r.reduce((e,l)=>e+(l.quantity||0),0)||0,n=e.depositAmount||0,i=e.collectAmount||(e.totalAmount||0)-(e.depositAmount||0);return{...e,orderNo:e.orderNumber||"-",phone:e.customerPhone||e.receiverPhone||"-",address:e.receiverAddress||"-",...t,productsText:s,totalQuantity:o,deposit:n,codAmount:i,expressCompany:e.expressCompany||null,expressNo:e.trackingNumber||null,logisticsStatus:e.logisticsStatus||null,orderSource:e.orderSource||null,lastOperation:a,operationLogs:l}}),Qe(),Fe(l)}catch(e){console.error("加载订单列表失败:",e),N.error("加载订单列表失败"),ee.value=[],ve.value=0}finally{be.value=!1}},Fe=(e=[])=>{const l=Array.isArray(e)&&e.length>0?e:Array.isArray(ee.value)?ee.value:[];T.totalOrders=l.length,T.totalAmount=l.reduce((e,l)=>e+(l.totalAmount||0),0);const a=(new Date).toISOString().split("T")[0];T.shippedToday=l.filter(e=>e.shipTime&&e.shipTime.startsWith(a)).length,T.urgentOrders=l.filter(e=>"urgent"===e.status).length,T.codOrders=l.filter(e=>(e.codAmount||0)>0).length,T.codAmount=l.reduce((e,l)=>e+(l.codAmount||0),0)},Qe=async()=>{try{await Ve.batchSyncLogistics();const e=await Ve.getOrdersByShippingStatus(U.value);if(Array.isArray(e)){const l=(fe.value-1)*he.value,a=l+he.value,t=e.slice(l,a);ee.value=t.map(e=>{const l=Ve.getOperationLogs(e.id)||[],a=l.length>0?l[l.length-1]:{action:"创建订单",operator:e.createdBy||"系统",time:e.createTime};let t={};if(e.customerId){const l=Me.getCustomerById(e.customerId);l&&(t={customerAge:l.age||null,customerHeight:l.height||null,customerWeight:l.weight||null,medicalHistory:l.medicalHistory||null,serviceWechat:l.wechatId||null})}const r=Array.isArray(e.products)?e.products:[],s=r.map(e=>`${e.name} × ${e.quantity}`).join("，")||"-",o=r.reduce((e,l)=>e+(l.quantity||0),0)||0,n=e.depositAmount||0,i=e.collectAmount||(e.totalAmount||0)-(e.depositAmount||0);return{...e,orderNo:e.orderNumber||"-",phone:e.customerPhone||e.receiverPhone||"-",address:e.receiverAddress||"-",...t,productsText:s,totalQuantity:o,deposit:n,codAmount:i,expressCompany:e.expressCompany||null,expressNo:e.trackingNumber||null,logisticsStatus:e.logisticsStatus||null,lastOperation:a,operationLogs:l}})}}catch(e){console.error("同步物流数据失败:",e)}};let Je=null,Ke=null;const Ze=e=>{te.value=e},Ge=e=>{he.value=e,We()},Xe=e=>{fe.value=e,We()},el=e=>{let l={};if(e.customerId){const a=Me.getCustomerById(e.customerId);a&&(l={customerAge:a.age||null,customerHeight:a.height||null,customerWeight:a.weight||null,medicalHistory:a.medicalHistory||null,serviceWechat:a.wechatId||null})}const a=Array.isArray(e.products)?e.products:[],t=a.map(e=>`${e.name} × ${e.quantity}`).join("，")||"",r=a.reduce((e,l)=>e+(l.quantity||0),0)||0,s=e.depositAmount||0,o=e.collectAmount||(e.totalAmount||0)-(e.depositAmount||0);return{...e,orderNo:e.orderNumber||e.orderNo||"-",phone:e.customerPhone||e.receiverPhone||e.phone||"-",address:e.receiverAddress||e.address||"-",...l,productsText:t,totalQuantity:r,deposit:s,codAmount:o,expressCompany:e.expressCompany||null,expressNo:e.trackingNumber||e.expressNo||null,logisticsStatus:e.logisticsStatus||null}},ll=e=>{e.id&&k.push(`/order/detail/${e.id}`)},al=e=>{e.customerId?k.push(`/customer/detail/${e.customerId}`):N.warning("客户ID不存在")},tl=e=>{Ne.value=el(e),_e.value=!0},rl=()=>{Ce.value=!0},sl=e=>{Ne.value=el(e),we.value=!0},ol=e=>{Ne.value=el(e),ke.value=!0},nl=async()=>{if(te.value&&0!==te.value.length)try{const e=te.value.map(e=>({orderNumber:e.orderNumber||"",customerName:e.customerName||"",customerPhone:e.customerPhone||"",receiverName:e.receiverName||"",receiverPhone:e.receiverPhone||"",receiverAddress:e.receiverAddress||"",products:e.productsText||(Array.isArray(e.products)?e.products.map(e=>`${e.name} x${e.quantity}`).join(", "):e.products||""),totalQuantity:Array.isArray(e.products)?e.products.reduce((e,l)=>e+(l.quantity||0),0):0,totalAmount:e.totalAmount||0,depositAmount:e.depositAmount||0,codAmount:(e.totalAmount||0)-(e.depositAmount||0),customerAge:e.customerAge||"",customerHeight:e.customerHeight||"",customerWeight:e.customerWeight||"",medicalHistory:e.medicalHistory||"",serviceWechat:e.serviceWechat||"",remark:e.remark||"",createTime:e.createTime||"",status:e.status||"",shippingStatus:e.shippingStatus||""})),l=ce(e,De.isAdmin);N.success(`导出成功：${l}`)}catch(e){console.error("导出失败:",e),N.error("导出失败，请重试")}else N.warning("请选择要导出的订单")},il=()=>{te.value&&0!==te.value.length?Te.value=!0:N.warning("请选择要发货的订单")},dl=async({action:e,row:l})=>{switch(Ne.value=l,e){case"export":try{const e={orderNumber:l.orderNumber||"",customerName:l.customerName||"",customerPhone:l.customerPhone||"",receiverName:l.receiverName||"",receiverPhone:l.receiverPhone||"",receiverAddress:l.receiverAddress||"",products:l.productsText||(Array.isArray(l.products)?l.products.map(e=>`${e.name} x${e.quantity}`).join(", "):l.products||""),totalQuantity:Array.isArray(l.products)?l.products.reduce((e,l)=>e+(l.quantity||0),0):0,totalAmount:l.totalAmount||0,depositAmount:l.depositAmount||0,codAmount:(l.totalAmount||0)-(l.depositAmount||0),customerAge:l.customerAge||"",customerHeight:l.customerHeight||"",customerWeight:l.customerWeight||"",medicalHistory:l.medicalHistory||"",serviceWechat:l.serviceWechat||"",remark:l.remark||"",createTime:l.createTime||"",status:l.status||"",shippingStatus:l.shippingStatus||""},a=pe(e,De.isAdmin);N.success(`导出成功：${a}`)}catch(a){console.error("导出失败:",a),N.error("导出失败，请重试")}break;case"return":xe.value=!0;break;case"cancel":Ae.value=!0}},ul=e=>{e.orderId&&e.logisticsCompany&&e.trackingNumber&&Ve.shipOrder(e.orderId,e.logisticsCompany,e.trackingNumber),N.success("发货成功"),We()},cl=e=>{e.forEach(e=>{e.orderId&&e.logisticsCompany&&e.trackingNumber&&Ve.shipOrder(e.orderId,e.logisticsCompany,e.trackingNumber)}),N.success(`成功发货 ${e.length} 个订单`),We()},pl=e=>{if(e.orderId&&e.reason){const l=`${e.returnType?vl(e.returnType)+"：":""}${e.reason}`;Ve.returnOrder(e.orderId,l);const a=Ve.getOrderById(e.orderId);a&&e.notificationMethod&&e.notificationMethod.length>0&&Se.sendMessage(Se.MessageType.ORDER_CANCELLED,`订单 ${a.orderNumber} 已被退回，原因：${l}`,{relatedId:a.id,relatedType:"order",actionUrl:`/order/detail/${a.id}`})}N.success("订单已退回"),We(),hl()},gl=e=>{if(e.orderId&&e.reason){const l=`${e.cancelType?fl(e.cancelType)+"：":""}${e.reason}`;Ve.cancelOrder(e.orderId,l);const a=Ve.getOrderById(e.orderId);a&&e.notifyCustomer&&e.notificationMethod&&e.notificationMethod.length>0&&console.log("通知客户订单已取消:",a.orderNumber)}N.success("订单已取消"),We(),hl()},vl=e=>({address_error:"地址信息错误",customer_info_error:"客户信息不符",product_error:"商品信息错误",price_error:"价格信息错误",stock_shortage:"库存不足",customer_request:"客户要求修改",logistics_issue:"物流配送问题",other:"其他原因"}[e]||"未知类型"),fl=e=>({customer_cancel:"客户主动取消",customer_unreachable:"客户联系不上",address_undeliverable:"地址无法配送",out_of_stock:"商品缺货",price_dispute:"价格争议",duplicate_order:"重复订单",fraud_order:"欺诈订单",system_error:"系统错误",other:"其他原因"}[e]||"未知类型"),hl=async()=>{try{const e=await Ve.getOrdersByShippingStatus("pending"),l=await Ve.getOrdersByShippingStatus("shipped"),a=await Ve.getOrdersByShippingStatus("returned"),t=await Ve.getOrdersByShippingStatus("cancelled"),r=await Ve.getOrdersByShippingStatus("draft");E.pending=Array.isArray(e)?e.length:0,E.shipped=Array.isArray(l)?l.length:0,E.returned=Array.isArray(a)?a.length:0,E.cancelled=Array.isArray(t)?t.length:0,E.draft=Array.isArray(r)?r.length:0}catch(e){console.error("更新标签页数量失败:",e)}},yl=e=>({pending:"待揽收",picked_up:"已揽收",in_transit:"运输中",out_for_delivery:"派送中",delivered:"已签收",exception:"异常",rejected:"拒收",returned:"已退回"}[e]||e);b(U,()=>{We(),hl()}),b(M,()=>{We()});const bl=e=>{console.log("[发货列表] 收到订单审核事件",e),e&&e.approved&&console.log("[发货列表] 订单审核通过，刷新列表:",e.order?.orderNumber),We(),hl()},_l=()=>{console.log("[发货列表] 收到订单发货事件"),We(),hl()},wl=()=>{console.log("[发货列表] 收到订单取消事件"),We(),hl()},kl=()=>{console.log("[发货列表] 收到订单退回事件"),We(),hl()},Tl=()=>{console.log("[发货列表] 收到刷新列表事件"),We(),hl()};return t(()=>{We(),hl(),Ve.startLogisticsAutoSync(),Ve.setupLogisticsEventListener(),Ke=setInterval(()=>{be.value||Qe()},3e4),Je=setInterval(()=>{be.value||We()},6e4),Oe.initData(),oe.on(ne.ORDER_AUDITED,bl),oe.on(ne.ORDER_SHIPPED,_l),oe.on(ne.ORDER_CANCELLED,wl),oe.on(ne.ORDER_RETURNED,kl),oe.on(ne.REFRESH_SHIPPING_LIST,Tl),console.log("[发货列表] 事件监听器已注册")}),w(()=>{Je&&(clearInterval(Je),Je=null),Ke&&(clearInterval(Ke),Ke=null),Ve.stopLogisticsAutoSync(),oe.off(ne.ORDER_AUDITED,bl),oe.off(ne.ORDER_SHIPPED,_l),oe.off(ne.ORDER_CANCELLED,wl),oe.off(ne.ORDER_RETURNED,kl),oe.off(ne.REFRESH_SHIPPING_LIST,Tl),console.log("[发货列表] 事件监听器已清理")}),(e,l)=>{const a=r("el-icon"),t=r("el-button"),f=r("el-date-picker"),y=r("el-option"),b=r("el-select"),_=r("el-input"),w=r("el-badge"),le=r("el-tab-pane"),ae=r("el-tabs"),re=r("el-link"),se=r("el-tag"),oe=r("el-dropdown-item"),ne=r("el-dropdown-menu"),ie=r("el-dropdown"),de=r("el-table-column"),ue=r("el-table"),ce=r("el-pagination"),pe=r("el-dialog");return o(),i("div",Bt,[l[50]||(l[50]=c("div",{class:"page-header"},[c("h1",{class:"page-title"},"发货列表")],-1)),c("div",Pt,[c("div",qt,[c("div",Rt,[c("div",Ht,[u(a,null,{default:n(()=>[u(m(S))]),_:1})]),c("div",jt,[c("div",zt,h(T.totalOrders),1),l[18]||(l[18]=c("div",{class:"metric-label"},"待发货订单",-1))])]),c("div",Lt,[c("div",Yt,[u(a,null,{default:n(()=>[u(m(z))]),_:1})]),c("div",Wt,[c("div",Ft,"¥"+h(Be(T.totalAmount)),1),l[19]||(l[19]=c("div",{class:"metric-label"},"待发货金额",-1))])]),c("div",Qt,[c("div",Jt,[u(a,null,{default:n(()=>[u(m(D))]),_:1})]),c("div",Kt,[c("div",Zt,h(T.shippedToday),1),l[20]||(l[20]=c("div",{class:"metric-label"},"今日发货",-1))])])]),c("div",Gt,[c("div",Xt,[c("div",er,[u(a,null,{default:n(()=>[u(m(q))]),_:1})]),c("div",lr,[c("div",ar,h(T.urgentOrders),1),l[21]||(l[21]=c("div",{class:"metric-label"},"紧急订单",-1))])]),c("div",tr,[c("div",rr,[u(a,null,{default:n(()=>[u(m(L))]),_:1})]),c("div",sr,[c("div",or,h(T.codOrders),1),l[22]||(l[22]=c("div",{class:"metric-label"},"代收款订单",-1))])]),c("div",nr,[c("div",ir,[u(a,null,{default:n(()=>[u(m(Y))]),_:1})]),c("div",dr,[c("div",ur,"¥"+h(Be(T.codAmount)),1),l[23]||(l[23]=c("div",{class:"metric-label"},"代收款金额",-1))])])])]),c("div",cr,[(o(),i(g,null,v(O,e=>u(t,{key:e.value,type:M.value===e.value?"primary":"",onClick:l=>{return a=e.value,M.value=a,void Ye();var a},class:"filter-btn"},{default:n(()=>[p(h(e.label),1)]),_:2},1032,["type","onClick"])),64))]),c("div",pr,[c("div",mr,[u(f,{modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=e=>P.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"date-picker"},null,8,["modelValue"]),u(b,{modelValue:R.value,"onUpdate:modelValue":l[1]||(l[1]=e=>R.value=e),placeholder:"选择部门",class:"department-select",size:"default"},{default:n(()=>[u(y,{label:"全部部门",value:""}),(o(!0),i(g,null,v(m(Oe).departmentList,e=>(o(),s(y,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(_,{modelValue:H.value,"onUpdate:modelValue":l[2]||(l[2]=e=>H.value=e),placeholder:"订单号",class:"search-input",clearable:""},{prefix:n(()=>[u(a,null,{default:n(()=>[u(m(W))]),_:1})]),_:1},8,["modelValue"]),u(_,{modelValue:j.value,"onUpdate:modelValue":l[3]||(l[3]=e=>j.value=e),placeholder:"客户号码",class:"search-input",clearable:""},{prefix:n(()=>[u(a,null,{default:n(()=>[u(m(F))]),_:1})]),_:1},8,["modelValue"])]),c("div",gr,[u(t,{type:"primary",onClick:Ye,class:"query-btn"},{default:n(()=>[u(a,null,{default:n(()=>[u(m(W))]),_:1}),l[24]||(l[24]=p(" 查询 ",-1))]),_:1})])]),c("div",vr,[c("div",fr,[u(ae,{modelValue:U.value,"onUpdate:modelValue":l[4]||(l[4]=e=>U.value=e),onTabChange:Le,class:"shipping-tabs"},{default:n(()=>[u(le,{label:"待发货",name:"pending"},{label:n(()=>[c("span",hr,[u(a,null,{default:n(()=>[u(m(S))]),_:1}),l[25]||(l[25]=p(" 待发货 ",-1)),u(w,{value:E.pending,max:999,class:"tab-badge"},null,8,["value"])])]),_:1}),u(le,{label:"已发货",name:"shipped"},{label:n(()=>[c("span",yr,[u(a,null,{default:n(()=>[u(m(D))]),_:1}),l[26]||(l[26]=p(" 已发货 ",-1))])]),_:1}),u(le,{label:"退回",name:"returned"},{label:n(()=>[c("span",br,[u(a,null,{default:n(()=>[u(m(Q))]),_:1}),l[27]||(l[27]=p(" 退回 ",-1))])]),_:1}),u(le,{label:"取消",name:"cancelled"},{label:n(()=>[c("span",_r,[u(a,null,{default:n(()=>[u(m(J))]),_:1}),l[28]||(l[28]=p(" 取消 ",-1))])]),_:1}),u(le,{label:"草稿",name:"draft"},{label:n(()=>[c("span",wr,[u(a,null,{default:n(()=>[u(m(I))]),_:1}),l[29]||(l[29]=p(" 草稿 ",-1)),u(w,{value:E.draft,max:999,class:"tab-badge draft-badge"},null,8,["value"])])]),_:1})]),_:1},8,["modelValue"]),c("div",kr,[u(t,{type:"primary",onClick:rl,class:"fullscreen-btn"},{default:n(()=>[u(a,null,{default:n(()=>[u(m(K))]),_:1}),l[30]||(l[30]=p(" 全屏查看 ",-1))]),_:1})])])]),u(ye,{data:ee.value,columns:Ee.value,"storage-key":"shipping-list-columns",title:$e.value,loading:be.value,"show-selection":!0,"show-index":!0,pagination:{currentPage:fe.value,pageSize:he.value,total:ve.value},onSelectionChange:Ze,onSizeChange:Ge,onCurrentChange:Xe,"row-class-name":je},{"header-actions":n(()=>[u(t,{onClick:nl,class:"export-btn",disabled:0===te.value.length},{default:n(()=>[u(a,null,{default:n(()=>[u(m(B))]),_:1}),l[31]||(l[31]=p(" 批量导出 ",-1))]),_:1},8,["disabled"]),u(t,{type:"success",onClick:il,class:"batch-ship-btn",disabled:0===te.value.length},{default:n(()=>[u(a,null,{default:n(()=>[u(m(D))]),_:1}),l[32]||(l[32]=p(" 批量发货 ",-1))]),_:1},8,["disabled"])]),"column-orderNo":n(({row:e})=>[u(re,{type:"primary",onClick:l=>ll(e),underline:!1},{default:n(()=>[p(h(e.orderNo),1)]),_:2},1032,["onClick"])]),"column-customerName":n(({row:e})=>[u(re,{type:"primary",onClick:l=>al(e),underline:!1},{default:n(()=>[p(h(e.customerName),1)]),_:2},1032,["onClick"])]),"column-status":n(({row:e})=>[u(se,{type:He(e.status),size:"small"},{default:n(()=>{return[p(h((l=e.status,{pending_transfer:"待流转",pending_audit:"待审核",audit_rejected:"审核拒绝",pending_shipment:"待发货",shipped:"已发货",delivered:"已签收",package_exception:"包裹异常",rejected:"拒收",rejected_returned:"物流部退回",logistics_returned:"物流部退回",logistics_cancelled:"物流部取消",after_sales_created:"已建售后",pending_cancel:"待取消",cancel_failed:"取消失败",cancelled:"已取消",draft:"草稿",approved:"已审核",confirmed:"已确认"}[l]||l||"-")),1)];var l}),_:2},1032,["type"])]),createTime:n(({row:e})=>[c("span",null,h(Pe(e.createTime)),1)]),products:n(({row:e})=>[c("div",Tr,[(o(!0),i(g,null,v(e.products,(e,l)=>(o(),i("div",{key:l,class:"product-item"},h(e.name)+" × "+h(e.quantity),1))),128))])]),totalAmount:n(({row:e})=>[c("span",xr,"¥"+h(Be(e.totalAmount)),1)]),deposit:n(({row:e})=>[c("span",Ar,"¥"+h(Be(e.deposit)),1)]),codAmount:n(({row:e})=>[c("span",Cr,"¥"+h(Be(e.codAmount)),1)]),"column-orderSource":n(({row:e})=>[c("span",null,h(qe(e.orderSource)),1)]),"column-paymentMethod":n(({row:e})=>[c("span",null,h(Re(e.paymentMethod)),1)]),"column-remark":n(({row:e})=>[e.remark?(o(),i("span",{key:0,class:"remark-text",innerHTML:ze(e.remark)},null,8,Nr)):(o(),i("span",Vr,"无备注"))]),expressCompany:n(({row:e})=>[e.expressCompany?(o(),s(se,{key:0,type:"info"},{default:n(()=>{return[p(h((l=e.expressCompany,{SF:"顺丰速运",YTO:"圆通速递",ZTO:"中通快递",STO:"申通快递",YD:"韵达速递",HTKY:"百世快递",JD:"京东物流",EMS:"中国邮政",DBKD:"德邦快递",UC:"优速快递"}[l]||l)),1)];var l}),_:2},1024)):(o(),i("span",Sr,"未选择"))]),expressNo:n(({row:e})=>[e.expressNo?(o(),i("div",Dr,[u(re,{type:"primary",onClick:l=>(e=>{e.expressNo&&e.expressCompany?k.push({path:"/logistics/track/detail/"+e.expressNo,query:{company:e.expressCompany}}):N.warning("物流信息不完整，无法跟踪")})(e)},{default:n(()=>[p(h(e.expressNo),1)]),_:2},1032,["onClick"]),u(t,{size:"small",type:"text",onClick:l=>(async e=>{try{await navigator.clipboard.writeText(e),N.success("物流单号已复制到剪贴板")}catch(l){const a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),N.success("物流单号已复制到剪贴板")}})(e.expressNo),class:"copy-btn"},{default:n(()=>[u(a,null,{default:n(()=>[u(m(X))]),_:1})]),_:1},8,["onClick"])])):(o(),i("span",Or,"未发货"))]),logisticsStatus:n(({row:e})=>{return[e.logisticsStatus?(o(),s(se,{key:0,type:(l=e.logisticsStatus,{pending:"info",picked_up:"warning",in_transit:"primary",out_for_delivery:"warning",delivered:"success",exception:"danger",rejected:"danger",returned:"info"}[l]||"info")},{default:n(()=>[p(h(yl(e.logisticsStatus)),1)]),_:2},1032,["type"])):(o(),i("span",Mr,"-"))];var l}),lastOperation:n(({row:e})=>[e.lastOperation?(o(),i("div",Ir,[c("div",$r,h(e.lastOperation.action),1),c("div",Ur,[c("span",Er,h(e.lastOperation.operator),1),c("span",Br,h(Pe(e.lastOperation.time)),1)])])):(o(),i("span",Pr,"暂无记录"))]),"table-actions":n(({row:e})=>[c("div",qr,[u(t,{size:"small",type:"primary",onClick:l=>tl(e)},{default:n(()=>[u(a,null,{default:n(()=>[u(m(A))]),_:1}),l[33]||(l[33]=p(" 查看 ",-1))]),_:1},8,["onClick"]),"returned"===U.value||"cancelled"===U.value?(o(),i(g,{key:0},[],64)):"draft"===e.status?(o(),i(g,{key:1},[u(t,{size:"small",type:"warning",onClick:e=>{N.info("编辑草稿功能开发中...")}},{default:n(()=>[u(a,null,{default:n(()=>[u(m(x))]),_:1}),l[34]||(l[34]=p(" 编辑 ",-1))]),_:1},8,["onClick"]),u(t,{size:"small",type:"success",onClick:l=>(async e=>{try{await V.confirm(`确定要提交草稿订单 ${e.orderNumber} 吗？提交后将进入审核流程。`,"提交确认",{confirmButtonText:"确定提交",cancelButtonText:"取消",type:"warning"});const l=Ve.orders.findIndex(l=>l.id===e.id);if(-1!==l&&(Ve.orders[l].status="pending",Ve.orders[l].auditStatus="pending","normal"===Ve.orders[l].markType)){const e=new Date(Date.now()+18e4);Ve.orders[l].auditTransferTime=e.toISOString().slice(0,19).replace("T"," "),Ve.orders[l].isAuditTransferred=!1}N.success("草稿已提交，进入审核流程"),We(),hl()}catch(l){"cancel"!==l&&(console.error("提交草稿失败:",l),N.error("提交失败，请重试"))}})(e)},{default:n(()=>[u(a,null,{default:n(()=>[u(m(Z))]),_:1}),l[35]||(l[35]=p(" 提交 ",-1))]),_:1},8,["onClick"]),u(t,{size:"small",type:"danger",onClick:l=>(async e=>{try{await V.confirm(`确定要删除草稿订单 ${e.orderNumber} 吗？删除后无法恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"});const l=Ve.orders.findIndex(l=>l.id===e.id);-1!==l&&Ve.orders.splice(l,1),N.success("草稿已删除"),We(),hl()}catch(l){"cancel"!==l&&(console.error("删除草稿失败:",l),N.error("删除失败，请重试"))}})(e)},{default:n(()=>[u(a,null,{default:n(()=>[u(m($))]),_:1}),l[36]||(l[36]=p(" 删除 ",-1))]),_:1},8,["onClick"])],64)):"rejected_returned"===e.status?(o(),i(g,{key:2},[u(t,{size:"small",type:"warning",onClick:e=>{N.info("编辑被退回订单功能开发中...")}},{default:n(()=>[u(a,null,{default:n(()=>[u(m(x))]),_:1}),l[37]||(l[37]=p(" 编辑 ",-1))]),_:1},8,["onClick"]),u(t,{size:"small",type:"success",onClick:l=>(async e=>{try{await V.confirm(`确定要重新提审订单 ${e.orderNumber} 吗？提审后将重新进入审核流程。`,"提审确认",{confirmButtonText:"确定提审",cancelButtonText:"取消",type:"warning"}),Ve.resubmitForAudit(e.id,De.user?.name||"系统")?(N.success("订单已重新提审，进入审核流程"),We(),hl()):N.error("重新提审失败，订单状态不符合要求")}catch(l){"cancel"!==l&&(console.error("提审失败:",l),N.error("提审失败，请重试"))}})(e)},{default:n(()=>[u(a,null,{default:n(()=>[u(m(Z))]),_:1}),l[38]||(l[38]=p(" 提审 ",-1))]),_:1},8,["onClick"]),u(t,{size:"small",type:"danger",onClick:l=>(async e=>{try{await V.confirm(`确定要取消订单 ${e.orderNumber} 吗？取消后订单状态将变为已取消。`,"取消确认",{confirmButtonText:"确定取消",cancelButtonText:"保留",type:"error"});const l=Ve.orders.findIndex(l=>l.id===e.id);-1!==l&&(Ve.orders[l].status="cancelled",Ve.orders[l].shippingStatus="cancelled"),N.success("订单已取消"),We(),hl()}catch(l){"cancel"!==l&&(console.error("取消订单失败:",l),N.error("取消失败，请重试"))}})(e)},{default:n(()=>[u(a,null,{default:n(()=>[u(m(J))]),_:1}),l[39]||(l[39]=p(" 取消 ",-1))]),_:1},8,["onClick"])],64)):(o(),i(g,{key:3},["shipped"===U.value?(o(),i(g,{key:0},[],64)):(o(),i(g,{key:1},[u(t,{size:"small",type:"success",onClick:l=>sl(e)},{default:n(()=>[u(a,null,{default:n(()=>[u(m(C))]),_:1}),l[40]||(l[40]=p(" 打印面单 ",-1))]),_:1},8,["onClick"]),u(t,{size:"small",type:"warning",onClick:l=>ol(e)},{default:n(()=>[u(a,null,{default:n(()=>[u(m(D))]),_:1}),l[41]||(l[41]=p(" 发货 ",-1))]),_:1},8,["onClick"])],64)),u(ie,{onCommand:dl,trigger:"click"},{dropdown:n(()=>[u(ne,null,{default:n(()=>[u(oe,{command:{action:"export",row:e}},{default:n(()=>[u(a,null,{default:n(()=>[u(m(B))]),_:1}),l[43]||(l[43]=p(" 导出 ",-1))]),_:1},8,["command"]),"shipped"!==U.value?(o(),i(g,{key:0},[u(oe,{command:{action:"return",row:e}},{default:n(()=>[u(a,null,{default:n(()=>[u(m(Q))]),_:1}),l[44]||(l[44]=p(" 退回 ",-1))]),_:1},8,["command"]),u(oe,{command:{action:"cancel",row:e}},{default:n(()=>[u(a,null,{default:n(()=>[u(m(J))]),_:1}),l[45]||(l[45]=p(" 取消 ",-1))]),_:1},8,["command"])],64)):d("",!0)]),_:2},1024)]),default:n(()=>[u(t,{size:"small"},{default:n(()=>[l[42]||(l[42]=p(" 更多",-1)),u(a,{class:"el-icon--right"},{default:n(()=>[u(m(G))]),_:1})]),_:1})]),_:2},1024)],64))])]),_:1},8,["data","columns","title","loading","pagination"]),u(ge,{visible:_e.value,"onUpdate:visible":l[5]||(l[5]=e=>_e.value=e),order:Ne.value},null,8,["visible","order"]),u(ml,{visible:we.value,"onUpdate:visible":l[6]||(l[6]=e=>we.value=e),order:Ne.value},null,8,["visible","order"]),u(ql,{visible:ke.value,"onUpdate:visible":l[7]||(l[7]=e=>ke.value=e),order:Ne.value,onShipped:ul},null,8,["visible","order"]),u(ka,{visible:Te.value,"onUpdate:visible":l[8]||(l[8]=e=>Te.value=e),selectedOrders:te.value,onBatchShipped:cl},null,8,["visible","selectedOrders"]),u(Za,{visible:xe.value,"onUpdate:visible":l[9]||(l[9]=e=>xe.value=e),order:Ne.value,onReturned:pl},null,8,["visible","order"]),u(Et,{visible:Ae.value,"onUpdate:visible":l[10]||(l[10]=e=>Ae.value=e),order:Ne.value,onCancelled:gl},null,8,["visible","order"]),u(pe,{modelValue:Ce.value,"onUpdate:modelValue":l[17]||(l[17]=e=>Ce.value=e),title:"发货列表 - 全屏查看",width:"95%",class:"fullscreen-dialog"},{default:n(()=>[c("div",Rr,[c("div",Hr,[c("div",jr,[u(f,{modelValue:P.value,"onUpdate:modelValue":l[11]||(l[11]=e=>P.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"date-picker"},null,8,["modelValue"]),u(b,{modelValue:R.value,"onUpdate:modelValue":l[12]||(l[12]=e=>R.value=e),placeholder:"选择部门",class:"department-select"},{default:n(()=>[u(y,{label:"全部部门",value:""}),u(y,{label:"销售一部",value:"sales1"}),u(y,{label:"销售二部",value:"sales2"}),u(y,{label:"市场部",value:"marketing"})]),_:1},8,["modelValue"]),u(_,{modelValue:H.value,"onUpdate:modelValue":l[13]||(l[13]=e=>H.value=e),placeholder:"订单号",class:"search-input",clearable:""},{prefix:n(()=>[u(a,null,{default:n(()=>[u(m(W))]),_:1})]),_:1},8,["modelValue"]),u(_,{modelValue:j.value,"onUpdate:modelValue":l[14]||(l[14]=e=>j.value=e),placeholder:"客户号码",class:"search-input",clearable:""},{prefix:n(()=>[u(a,null,{default:n(()=>[u(m(F))]),_:1})]),_:1},8,["modelValue"])]),c("div",zr,[u(t,{type:"primary",onClick:Ye,class:"query-btn"},{default:n(()=>[u(a,null,{default:n(()=>[u(m(W))]),_:1}),l[46]||(l[46]=p(" 查询 ",-1))]),_:1})])]),c("div",Lr,[u(ue,{data:ee.value,stripe:"",class:"data-table",border:"",onSelectionChange:Ze,"row-class-name":je,height:"calc(100vh - 300px)"},{default:n(()=>[u(de,{type:"selection",width:"50",align:"center"}),u(de,{type:"index",label:"序号",width:"50",align:"center"}),u(de,{prop:"orderNo",label:"订单号",width:"120",align:"center"},{default:n(({row:e})=>[u(re,{type:"primary",onClick:l=>ll(e)},{default:n(()=>[p(h(e.orderNo),1)]),_:2},1032,["onClick"])]),_:1}),u(de,{prop:"customerName",label:"客户姓名",width:"100",align:"center","show-overflow-tooltip":""},{default:n(({row:e})=>[u(re,{type:"primary",onClick:l=>al(e)},{default:n(()=>[p(h(e.customerName),1)]),_:2},1032,["onClick"])]),_:1}),u(de,{prop:"status",label:"状态",width:"80",align:"center"},{default:n(({row:e})=>[u(se,{type:He(e.status),size:"small"},{default:n(()=>[p(h(m(Ve).getStatusText(e.status)),1)]),_:2},1032,["type"])]),_:1}),u(de,{prop:"customerName",label:"客户姓名",width:"100",align:"center","show-overflow-tooltip":""}),u(de,{prop:"phone",label:"联系电话",width:"120",align:"center","show-overflow-tooltip":""},{default:n(({row:e})=>[p(h(m(me)(e.phone,"phone")),1)]),_:1}),u(de,{prop:"address",label:"收货地址",width:"180",align:"left","show-overflow-tooltip":""}),u(de,{prop:"productsText",label:"商品信息",width:"160",align:"left","show-overflow-tooltip":""}),u(de,{prop:"totalAmount",label:"订单金额",width:"100",align:"center"},{default:n(({row:e})=>[c("span",Yr,"¥"+h(Be(e.totalAmount)),1)]),_:1}),u(de,{prop:"codAmount",label:"代收款",width:"100",align:"center"},{default:n(({row:e})=>[c("span",Wr,"¥"+h(Be(e.codAmount)),1)]),_:1}),u(de,{prop:"createTime",label:"下单时间",width:"130",align:"center"},{default:n(({row:e})=>[p(h(Pe(e.createTime)),1)]),_:1}),u(de,{prop:"shipTime",label:"发货时间",width:"130",align:"center"},{default:n(({row:e})=>[p(h(Pe(e.shipTime)),1)]),_:1}),u(de,{prop:"trackingNo",label:"物流单号",width:"130",align:"center","show-overflow-tooltip":""}),u(de,{prop:"logisticsCompany",label:"物流公司",width:"100",align:"center","show-overflow-tooltip":""}),u(de,{prop:"remark",label:"备注",width:"140",align:"left","show-overflow-tooltip":""}),u(de,{label:"操作",width:"200",align:"center",fixed:"right"},{default:n(({row:e})=>[c("div",Fr,[u(t,{size:"small",type:"primary",onClick:l=>tl(e)},{default:n(()=>[u(a,null,{default:n(()=>[u(m(A))]),_:1}),l[47]||(l[47]=p(" 查看详情 ",-1))]),_:1},8,["onClick"]),u(t,{size:"small",type:"info",onClick:l=>sl(e)},{default:n(()=>[u(a,null,{default:n(()=>[u(m(C))]),_:1}),l[48]||(l[48]=p(" 打印面单 ",-1))]),_:1},8,["onClick"]),"pending"===e.status?(o(),s(t,{key:0,size:"small",type:"success",onClick:l=>ol(e)},{default:n(()=>[u(a,null,{default:n(()=>[u(m(D))]),_:1}),l[49]||(l[49]=p(" 发货 ",-1))]),_:1},8,["onClick"])):d("",!0)])]),_:1})]),_:1},8,["data"])]),c("div",Qr,[u(ce,{"current-page":fe.value,"onUpdate:currentPage":l[15]||(l[15]=e=>fe.value=e),"page-size":he.value,"onUpdate:pageSize":l[16]||(l[16]=e=>he.value=e),"page-sizes":[50,100,200],total:ve.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Ge,onCurrentChange:Xe},null,8,["current-page","page-size","total"])])])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-f40cdd3e"]]);export{Jr as default};
