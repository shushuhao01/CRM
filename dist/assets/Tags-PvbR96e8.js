var z=(w,k,p)=>new Promise((m,b)=>{var y=d=>{try{V(p.next(d))}catch(r){b(r)}},i=d=>{try{V(p.throw(d))}catch(r){b(r)}},V=d=>d.done?m(d.value):Promise.resolve(d.value).then(y,i);V((p=p.apply(w,k)).next())});import{p as ae,E as f,b as le}from"./elementPlus-Bmwh7Rh8.js";import{c as S}from"./customerTags-Cm4wsNSA.js";import{l as oe,r as v,Z as U,c as se,ag as n,aq as ne,m as re,p as M,q as F,U as t,O as a,S as u,u as ie,P as ue,M as de,I as ce,T as O}from"./vendor-D8Vxqhr-.js";import{_ as pe}from"./settings-CuxbDWOu.js";import"./utils-ywHRn0uI.js";const me={class:"customer-tags"},ge={class:"page-header"},fe={class:"header-actions"},_e={class:"pagination-container"},ve=oe({__name:"Tags",setup(w){const k=v(!1),p=v(!1),m=v(!1),b=v(""),y=v(),i=U({name:"",status:""}),V=v([]),d=v([]),r=U({currentPage:1,pageSize:20,total:0}),s=U({id:"",name:"",color:"#409EFF",status:"active",description:"",customerCount:0,createTime:""}),R={name:[{required:!0,message:"请输入标签名称",trigger:"blur"}],color:[{required:!0,message:"请选择标签颜色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},C=()=>z(this,null,function*(){k.value=!0;try{const o={name:i.name,status:i.status,page:r.currentPage,pageSize:r.pageSize},e=yield S.getList(o);e.success?(V.value=e.data.list,r.total=e.data.total):f.error(e.message||"加载数据失败")}catch(o){console.error("加载标签数据失败:",o),f.error("加载数据失败")}finally{k.value=!1}}),E=()=>{r.currentPage=1,C()},$=()=>{Object.keys(i).forEach(o=>{i[o]=""}),E()},L=()=>{b.value="新增标签",B(),m.value=!0},N=o=>{b.value="编辑标签",Object.assign(s,o),m.value=!0},h=o=>z(this,null,function*(){try{yield le.confirm(`确定要删除标签"${o.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=yield S.delete(o.id);e.success?(f.success("删除成功"),C()):f.error(e.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除标签失败:",e),f.error("删除失败"))}}),A=()=>z(this,null,function*(){if(y.value)try{yield y.value.validate(),p.value=!0;let o;s.id?o=yield S.update(s.id,{name:s.name,color:s.color,status:s.status,description:s.description}):o=yield S.create({name:s.name,color:s.color,status:s.status,description:s.description}),o.success?(f.success(s.id?"更新成功":"创建成功"),m.value=!1,C()):f.error(o.message||"操作失败")}catch(o){console.error("提交标签失败:",o),f.error("操作失败")}finally{p.value=!1}}),Z=()=>{var o;(o=y.value)==null||o.clearValidate(),B()},B=()=>{Object.assign(s,{id:"",name:"",color:"#409EFF",status:"active",description:""})},G=o=>{d.value=o},H=o=>{const e=o.replace("#",""),T=parseInt(e.substr(0,2),16),c=parseInt(e.substr(2,2),16),x=parseInt(e.substr(4,2),16);return(T*299+c*587+x*114)/1e3>128?"#000000":"#FFFFFF"};return se(()=>{C()}),(o,e)=>{const T=n("el-icon"),c=n("el-button"),x=n("el-input"),g=n("el-form-item"),P=n("el-option"),J=n("el-select"),D=n("el-form"),q=n("el-card"),_=n("el-table-column"),I=n("el-tag"),K=n("el-table"),Q=n("el-pagination"),W=n("el-color-picker"),j=n("el-radio"),X=n("el-radio-group"),Y=n("el-dialog"),ee=ne("loading");return M(),re("div",me,[F("div",ge,[e[11]||(e[11]=F("h2",null,"客户标签管理",-1)),F("div",fe,[t(c,{type:"primary",onClick:L},{default:a(()=>[t(T,null,{default:a(()=>[t(ie(ae))]),_:1}),e[10]||(e[10]=u(" 新增标签 ",-1))]),_:1})])]),t(q,{class:"search-card"},{default:a(()=>[t(D,{model:i,inline:""},{default:a(()=>[t(g,{label:"标签名称"},{default:a(()=>[t(x,{modelValue:i.name,"onUpdate:modelValue":e[0]||(e[0]=l=>i.name=l),placeholder:"请输入标签名称",clearable:""},null,8,["modelValue"])]),_:1}),t(g,{label:"状态"},{default:a(()=>[t(J,{modelValue:i.status,"onUpdate:modelValue":e[1]||(e[1]=l=>i.status=l),placeholder:"请选择状态",clearable:""},{default:a(()=>[t(P,{label:"启用",value:"active"}),t(P,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),t(g,null,{default:a(()=>[t(c,{type:"primary",onClick:E},{default:a(()=>[...e[12]||(e[12]=[u("搜索",-1)])]),_:1}),t(c,{onClick:$},{default:a(()=>[...e[13]||(e[13]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(q,{class:"table-card"},{default:a(()=>[ue((M(),de(K,{data:V.value,onSelectionChange:G},{default:a(()=>[t(_,{type:"selection",width:"55"}),t(_,{prop:"name",label:"标签名称"}),t(_,{prop:"color",label:"标签颜色"},{default:a(({row:l})=>[t(I,{color:l.color,style:ce({color:H(l.color)})},{default:a(()=>[u(O(l.name),1)]),_:2},1032,["color","style"])]),_:1}),t(_,{prop:"customerCount",label:"关联客户数"}),t(_,{prop:"status",label:"状态"},{default:a(({row:l})=>[t(I,{type:l.status==="active"?"success":"danger"},{default:a(()=>[u(O(l.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"createTime",label:"创建时间"}),t(_,{label:"操作",width:"200"},{default:a(({row:l})=>[t(c,{type:"primary",size:"small",onClick:te=>N(l)},{default:a(()=>[...e[14]||(e[14]=[u("编辑",-1)])]),_:1},8,["onClick"]),t(c,{type:"danger",size:"small",onClick:te=>h(l)},{default:a(()=>[...e[15]||(e[15]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,k.value]]),F("div",_e,[t(Q,{"current-page":r.currentPage,"onUpdate:currentPage":e[2]||(e[2]=l=>r.currentPage=l),"page-size":r.pageSize,"onUpdate:pageSize":e[3]||(e[3]=l=>r.pageSize=l),"page-sizes":[10,20,50,100],total:r.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:C,onCurrentChange:C},null,8,["current-page","page-size","total"])])]),_:1}),t(Y,{modelValue:m.value,"onUpdate:modelValue":e[9]||(e[9]=l=>m.value=l),title:b.value,width:"500px",onClose:Z},{footer:a(()=>[t(c,{onClick:e[8]||(e[8]=l=>m.value=!1)},{default:a(()=>[...e[18]||(e[18]=[u("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:A,loading:p.value},{default:a(()=>[...e[19]||(e[19]=[u(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(D,{ref_key:"formRef",ref:y,model:s,rules:R,"label-width":"80px"},{default:a(()=>[t(g,{label:"标签名称",prop:"name"},{default:a(()=>[t(x,{modelValue:s.name,"onUpdate:modelValue":e[4]||(e[4]=l=>s.name=l),placeholder:"请输入标签名称"},null,8,["modelValue"])]),_:1}),t(g,{label:"标签颜色",prop:"color"},{default:a(()=>[t(W,{modelValue:s.color,"onUpdate:modelValue":e[5]||(e[5]=l=>s.color=l)},null,8,["modelValue"])]),_:1}),t(g,{label:"状态",prop:"status"},{default:a(()=>[t(X,{modelValue:s.status,"onUpdate:modelValue":e[6]||(e[6]=l=>s.status=l)},{default:a(()=>[t(j,{value:"active"},{default:a(()=>[...e[16]||(e[16]=[u("启用",-1)])]),_:1}),t(j,{value:"inactive"},{default:a(()=>[...e[17]||(e[17]=[u("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"描述"},{default:a(()=>[t(x,{modelValue:s.description,"onUpdate:modelValue":e[7]||(e[7]=l=>s.description=l),type:"textarea",rows:3,placeholder:"请输入标签描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ze=pe(ve,[["__scopeId","data-v-2113a31b"]]);export{ze as default};
