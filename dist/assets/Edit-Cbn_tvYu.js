const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DkAJPKqn.js","assets/vendor-BtukhyiH.js","assets/elementPlus-DxaqjplL.js","assets/utils-DfI7e5Rl.js","assets/index-Cj-RrGL6.css"])))=>i.map(i=>d[i]);
import{u as e,i as l,S as a,c as t,l as r,_ as d}from"./index-DkAJPKqn.js";import{l as s,aC as o,aA as u,r as i,e as n,Z as c,b as m,ag as p,m as f,q as v,p as _,U as h,O as g,S as b,u as y,F as V,a9 as w,M as A,Q as k}from"./vendor-BtukhyiH.js";import{K as U,E as P,b as I}from"./elementPlus-DxaqjplL.js";import{a as x,b as E,c as G,g as j}from"./addressData-BYEdhjmU.js";import{d as C}from"./sensitiveInfo-DVfrBLrU.js";import{c as H}from"./customerTags-BceXFDEB.js";import"./utils-DfI7e5Rl.js";const B={class:"customer-form"},D={class:"page-header"},L={class:"header-actions"},O={class:"form-section"},T={class:"form-section"},q={class:"form-section"},M={class:"form-section"},R={class:"form-section"},S=d(s({__name:"Edit",setup(d){const s=o(),S=u(),z=t(S),F=e(),K=l(),N=i(),Q=i(!1),W=i(null),Z=n(()=>{if(!W.value||!F.currentUser)return!1;const e=F.currentUser,l=W.value;if(F.isSuperAdmin)return!0;if(F.isDepartmentLeader){if(l.createdBy===e.id||l.salesPersonId===e.id)return!0;const a=F.users.find(e=>e.id===l.createdBy),t=F.users.find(e=>e.id===l.salesPersonId);return a&&a.departmentId===e.departmentId||t&&t.departmentId===e.departmentId}return l.createdBy===e.id||l.salesPersonId===e.id}),$=c({name:"",gender:"unknown",phone:"",age:null,email:"",wechat:"",height:null,weight:null,province:"",city:"",district:"",street:"",detailAddress:"",overseasAddress:"",medicalHistory:"",improvementGoals:[],otherGoals:"",level:"normal",source:"online",tags:[],salesPerson:"",remark:""}),J={name:[{required:!0,message:"è¯·è¾“å…¥å®¢æˆ·å§“å",trigger:"blur"}],phone:[{required:!0,message:"è¯·è¾“å…¥æ‰‹æœºå·",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·",trigger:"blur"}],email:[{type:"email",message:"è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±åœ°å€",trigger:"blur"}],age:[{type:"number",min:1,max:120,message:"å¹´é¾„å¿…é¡»åœ¨1-120ä¹‹é—´",trigger:"blur"}],level:[{required:!0,message:"è¯·é€‰æ‹©å®¢æˆ·ç­‰çº§",trigger:"change"}],salesPerson:[{required:!0,message:"è¯·é€‰æ‹©è´Ÿè´£é”€å”®",trigger:"change"}]},X=i([]),Y=i([]),ee=i([]),le=i([]),ae=i([{id:"1",name:"å¼ ä¸‰",department:"é”€å”®ä¸€éƒ¨"},{id:"2",name:"æå››",department:"é”€å”®äºŒéƒ¨"},{id:"3",name:"ç‹äº”",department:"é”€å”®ä¸€éƒ¨"},{id:"4",name:"èµµå…­",department:"é”€å”®ä¸‰éƒ¨"}]),te=i([]),re=i(!1),de=e=>{$.city="",$.district="",$.street="",Y.value=x(e),ee.value=[],le.value=[]},se=e=>{$.district="",$.street="",ee.value=E($.province,e),le.value=[]},oe=e=>{$.street="",le.value=G($.province,$.city,e)},ue=()=>{z.back()},ie=async()=>{try{await N.value.validate(),Q.value=!0;const e=[$.province,$.city,$.district,$.street,$.detailAddress].filter(Boolean).join(""),l={...$,address:e,province:$.province,city:$.city,district:$.district,street:$.street,detailAddress:$.detailAddress,overseasAddress:$.overseasAddress};await K.updateCustomer(l),P.success("å®¢æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ"),z.push("/customer/list")}catch(e){console.error("æ›´æ–°å¤±è´¥:",e),P.error("æ›´æ–°å®¢æˆ·ä¿¡æ¯å¤±è´¥")}finally{Q.value=!1}};return m(()=>{$.salesPerson=F.currentUser?.id||"",X.value=j(),(async()=>{try{re.value=!0;const e=await H.getActiveList();te.value=e.data}catch(e){console.error("åŠ è½½æ ‡ç­¾å¤±è´¥:",e),P.error("åŠ è½½æ ‡ç­¾å¤±è´¥")}finally{re.value=!1}})(),(async()=>{const e=s.params.id;if(!e)return P.error("å®¢æˆ·IDä¸å­˜åœ¨"),void z.push("/customer/list");try{Q.value=!0;const{isProduction:a}=await r(async()=>{const{isProduction:e}=await import("./env-DLalhsF6.js");return{isProduction:e}},[]),{shouldUseMockApi:t}=await r(async()=>{const{shouldUseMockApi:e}=await import("./index-DkAJPKqn.js").then(e=>e.R);return{shouldUseMockApi:e}},__vite__mapDeps([0,1,2,3,4]));let d=null;if(a()||!t()){console.log("[Edit.vue] ğŸŒ ç”Ÿäº§ç¯å¢ƒï¼šä»APIè·å–å®¢æˆ·è¯¦æƒ…");try{const{customerApi:l}=await r(async()=>{const{customerApi:e}=await import("./index-DkAJPKqn.js").then(e=>e.V);return{customerApi:e}},__vite__mapDeps([0,1,2,3,4])),a=await l.getDetail(e);a.data&&(d=a.data,console.log("[Edit.vue] âœ… APIè·å–å®¢æˆ·è¯¦æƒ…æˆåŠŸ:",d.name))}catch(l){console.error("[Edit.vue] âŒ APIè·å–å®¢æˆ·è¯¦æƒ…å¤±è´¥:",l),d=K.getCustomerById(e)}}else console.log("[Edit.vue] ğŸ’» å¼€å‘ç¯å¢ƒï¼šä»æœ¬åœ°storeè·å–å®¢æˆ·è¯¦æƒ…"),d=K.getCustomerById(e);if(!d)return P.error("å®¢æˆ·ä¸å­˜åœ¨"),void z.push("/customer/list");if(W.value=d,!Z.value)return await I.alert("æ‚¨æ²¡æœ‰æƒé™ç¼–è¾‘æ­¤å®¢æˆ·ä¿¡æ¯ã€‚åªèƒ½ç¼–è¾‘è‡ªå·±åˆ›å»ºæˆ–è¢«åˆ†é…çš„å®¢æˆ·ã€‚","æƒé™ä¸è¶³",{confirmButtonText:"è¿”å›",type:"warning"}),void z.push("/customer/list");Object.assign($,{name:d.name||"",gender:d.gender||"unknown",phone:d.phone||"",age:d.age||null,email:d.email||"",wechat:d.wechat||"",height:d.height||null,weight:d.weight||null,province:d.province||"",city:d.city||"",district:d.district||"",street:d.street||"",detailAddress:d.detailAddress||"",medicalHistory:d.medicalHistory||"",improvementGoals:d.improvementGoals||[],otherGoals:d.otherGoals||"",level:d.level||"normal",source:d.source||"online",tags:d.tags||[],salesPerson:d.salesPersonId||"",remark:d.remark||""}),$.province&&de($.province),$.city&&se($.city),$.district&&oe($.district)}catch(a){console.error("åŠ è½½å®¢æˆ·è¯¦æƒ…å¤±è´¥:",a),P.error("åŠ è½½å®¢æˆ·ä¿¡æ¯å¤±è´¥"),z.push("/customer/list")}finally{Q.value=!1}})()}),(e,l)=>{const t=p("el-button"),r=p("el-input"),d=p("el-form-item"),s=p("el-col"),o=p("el-radio"),u=p("el-radio-group"),i=p("el-row"),n=p("el-icon"),c=p("el-tooltip"),m=p("el-input-number"),P=p("el-option"),I=p("el-select"),x=p("el-checkbox"),E=p("el-checkbox-group"),G=p("el-form"),j=p("el-card");return v(),f("div",B,[_("div",D,[l[21]||(l[21]=_("h2",null,"ç¼–è¾‘å®¢æˆ·",-1)),_("div",L,[h(t,{onClick:ue},{default:g(()=>[...l[19]||(l[19]=[b("å–æ¶ˆ",-1)])]),_:1}),h(t,{type:"primary",onClick:ie,loading:Q.value},{default:g(()=>[...l[20]||(l[20]=[b(" æ›´æ–° ",-1)])]),_:1},8,["loading"])])]),h(j,{class:"form-card"},{default:g(()=>[h(G,{ref_key:"customerFormRef",ref:N,model:$,rules:J,"label-width":"100px",size:"default"},{default:g(()=>[_("div",O,[l[25]||(l[25]=_("h3",{class:"section-title"},"åŸºæœ¬ä¿¡æ¯",-1)),h(i,{gutter:20},{default:g(()=>[h(s,{span:12},{default:g(()=>[h(d,{label:"å®¢æˆ·å§“å",prop:"name"},{default:g(()=>[h(r,{modelValue:$.name,"onUpdate:modelValue":l[0]||(l[0]=e=>$.name=e),placeholder:"è¯·è¾“å…¥å®¢æˆ·å§“å",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),h(s,{span:12},{default:g(()=>[h(d,{label:"æ€§åˆ«",prop:"gender"},{default:g(()=>[h(u,{modelValue:$.gender,"onUpdate:modelValue":l[1]||(l[1]=e=>$.gender=e)},{default:g(()=>[h(o,{label:"male"},{default:g(()=>[...l[22]||(l[22]=[b("ç”·",-1)])]),_:1}),h(o,{label:"female"},{default:g(()=>[...l[23]||(l[23]=[b("å¥³",-1)])]),_:1}),h(o,{label:"unknown"},{default:g(()=>[...l[24]||(l[24]=[b("æœªçŸ¥",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),h(i,{gutter:20},{default:g(()=>[h(s,{span:12},{default:g(()=>[h(d,{label:"æ‰‹æœºå·",prop:"phone"},{default:g(()=>[h(r,{value:y(C)($.phone,y(a).PHONE),readonly:"",placeholder:"æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†æ˜¾ç¤º"},{suffix:g(()=>[h(c,{content:"æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†æ˜¾ç¤ºï¼Œä¸å¯ä¿®æ”¹"},{default:g(()=>[h(n,null,{default:g(()=>[h(y(U))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),h(s,{span:12},{default:g(()=>[h(d,{label:"å¹´é¾„",prop:"age"},{default:g(()=>[h(m,{modelValue:$.age,"onUpdate:modelValue":l[2]||(l[2]=e=>$.age=e),min:1,max:120,placeholder:"è¯·è¾“å…¥å¹´é¾„",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),h(i,{gutter:20},{default:g(()=>[h(s,{span:12},{default:g(()=>[h(d,{label:"é‚®ç®±",prop:"email"},{default:g(()=>[h(r,{value:y(C)($.email,y(a).EMAIL),readonly:"",placeholder:"æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†æ˜¾ç¤º"},{suffix:g(()=>[h(c,{content:"æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†æ˜¾ç¤ºï¼Œä¸å¯ä¿®æ”¹"},{default:g(()=>[h(n,null,{default:g(()=>[h(y(U))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),h(s,{span:12},{default:g(()=>[h(d,{label:"å¾®ä¿¡å·",prop:"wechat"},{default:g(()=>[h(r,{value:y(C)($.wechat,y(a).WECHAT),readonly:"",placeholder:"æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†æ˜¾ç¤º"},{suffix:g(()=>[h(c,{content:"æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†æ˜¾ç¤ºï¼Œä¸å¯ä¿®æ”¹"},{default:g(()=>[h(n,null,{default:g(()=>[h(y(U))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),h(i,{gutter:20},{default:g(()=>[h(s,{span:12},{default:g(()=>[h(d,{label:"èº«é«˜(cm)",prop:"height"},{default:g(()=>[h(m,{modelValue:$.height,"onUpdate:modelValue":l[3]||(l[3]=e=>$.height=e),min:50,max:250,placeholder:"è¯·è¾“å…¥èº«é«˜",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),h(s,{span:12},{default:g(()=>[h(d,{label:"ä½“é‡(kg)",prop:"weight"},{default:g(()=>[h(m,{modelValue:$.weight,"onUpdate:modelValue":l[4]||(l[4]=e=>$.weight=e),min:20,max:300,placeholder:"è¯·è¾“å…¥ä½“é‡",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_("div",T,[l[26]||(l[26]=_("h3",{class:"section-title"},"æ”¶è´§åœ°å€",-1)),h(i,{gutter:20},{default:g(()=>[h(s,{span:6},{default:g(()=>[h(d,{label:"çœä»½",prop:"province"},{default:g(()=>[h(I,{modelValue:$.province,"onUpdate:modelValue":l[5]||(l[5]=e=>$.province=e),placeholder:"è¯·é€‰æ‹©çœä»½",style:{width:"100%"},onChange:de},{default:g(()=>[(v(!0),f(V,null,w(X.value,e=>(v(),A(P,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),h(s,{span:6},{default:g(()=>[h(d,{label:"åŸå¸‚",prop:"city"},{default:g(()=>[h(I,{modelValue:$.city,"onUpdate:modelValue":l[6]||(l[6]=e=>$.city=e),placeholder:"è¯·é€‰æ‹©åŸå¸‚",style:{width:"100%"},onChange:se},{default:g(()=>[(v(!0),f(V,null,w(Y.value,e=>(v(),A(P,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),h(s,{span:6},{default:g(()=>[h(d,{label:"åŒºå¿",prop:"district"},{default:g(()=>[h(I,{modelValue:$.district,"onUpdate:modelValue":l[7]||(l[7]=e=>$.district=e),placeholder:"è¯·é€‰æ‹©åŒºå¿",style:{width:"100%"},onChange:oe},{default:g(()=>[(v(!0),f(V,null,w(ee.value,e=>(v(),A(P,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),h(s,{span:6},{default:g(()=>[h(d,{label:"è¡—é“",prop:"street"},{default:g(()=>[h(I,{modelValue:$.street,"onUpdate:modelValue":l[8]||(l[8]=e=>$.street=e),placeholder:"è¯·é€‰æ‹©è¡—é“",style:{width:"100%"}},{default:g(()=>[(v(!0),f(V,null,w(le.value,e=>(v(),A(P,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),h(d,{label:"è¯¦ç»†åœ°å€",prop:"detailAddress"},{default:g(()=>[h(r,{modelValue:$.detailAddress,"onUpdate:modelValue":l[9]||(l[9]=e=>$.detailAddress=e),placeholder:"è¯·è¾“å…¥è¯¦ç»†åœ°å€ï¼ˆé—¨ç‰Œå·ã€æ¥¼å±‚ç­‰ï¼‰",clearable:""},null,8,["modelValue"])]),_:1}),h(d,{label:"å¢ƒå¤–åœ°å€",prop:"overseasAddress"},{default:g(()=>[h(r,{modelValue:$.overseasAddress,"onUpdate:modelValue":l[10]||(l[10]=e=>$.overseasAddress=e),placeholder:"å¦‚ä¸ºå¢ƒå¤–åœ°å€ï¼Œè¯·åœ¨æ­¤è¾“å…¥å®Œæ•´åœ°å€",clearable:""},null,8,["modelValue"])]),_:1})]),_("div",q,[l[34]||(l[34]=_("h3",{class:"section-title"},"å¥åº·ä¿¡æ¯",-1)),h(d,{label:"ç–¾ç—…å²",prop:"medicalHistory"},{default:g(()=>[h(r,{modelValue:$.medicalHistory,"onUpdate:modelValue":l[11]||(l[11]=e=>$.medicalHistory=e),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥ç–¾ç—…å²ï¼ˆå¦‚æœ‰ï¼‰"},null,8,["modelValue"])]),_:1}),h(d,{label:"æ”¹å–„é—®é¢˜",prop:"improvementGoals"},{default:g(()=>[h(E,{modelValue:$.improvementGoals,"onUpdate:modelValue":l[12]||(l[12]=e=>$.improvementGoals=e)},{default:g(()=>[h(x,{label:"å‡è‚¥ç˜¦èº«"},{default:g(()=>[...l[27]||(l[27]=[b("å‡è‚¥ç˜¦èº«",-1)])]),_:1}),h(x,{label:"å¢è‚Œå¡‘å½¢"},{default:g(()=>[...l[28]||(l[28]=[b("å¢è‚Œå¡‘å½¢",-1)])]),_:1}),h(x,{label:"æ”¹å–„ç¡çœ "},{default:g(()=>[...l[29]||(l[29]=[b("æ”¹å–„ç¡çœ ",-1)])]),_:1}),h(x,{label:"æé«˜å…ç–«åŠ›"},{default:g(()=>[...l[30]||(l[30]=[b("æé«˜å…ç–«åŠ›",-1)])]),_:1}),h(x,{label:"è°ƒç†è‚ èƒƒ"},{default:g(()=>[...l[31]||(l[31]=[b("è°ƒç†è‚ èƒƒ",-1)])]),_:1}),h(x,{label:"ç¾å®¹å…»é¢œ"},{default:g(()=>[...l[32]||(l[32]=[b("ç¾å®¹å…»é¢œ",-1)])]),_:1}),h(x,{label:"å…¶ä»–"},{default:g(()=>[...l[33]||(l[33]=[b("å…¶ä»–",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),$.improvementGoals.includes("å…¶ä»–")?(v(),A(d,{key:0,label:"å…¶ä»–æ”¹å–„ç›®æ ‡",prop:"otherGoals"},{default:g(()=>[h(r,{modelValue:$.otherGoals,"onUpdate:modelValue":l[13]||(l[13]=e=>$.otherGoals=e),placeholder:"è¯·è¾“å…¥å…¶ä»–æ”¹å–„ç›®æ ‡",clearable:""},null,8,["modelValue"])]),_:1})):k("",!0)]),_("div",M,[l[35]||(l[35]=_("h3",{class:"section-title"},"å®¢æˆ·åˆ†ç±»",-1)),h(i,{gutter:20},{default:g(()=>[h(s,{span:12},{default:g(()=>[h(d,{label:"å®¢æˆ·ç­‰çº§",prop:"level"},{default:g(()=>[h(I,{modelValue:$.level,"onUpdate:modelValue":l[14]||(l[14]=e=>$.level=e),placeholder:"è¯·é€‰æ‹©å®¢æˆ·ç­‰çº§",style:{width:"100%"}},{default:g(()=>[h(P,{label:"é“œç‰Œå®¢æˆ·",value:"bronze"}),h(P,{label:"é“¶ç‰Œå®¢æˆ·",value:"silver"}),h(P,{label:"é‡‘ç‰Œå®¢æˆ·",value:"gold"}),h(P,{label:"é’»çŸ³å®¢æˆ·",value:"diamond"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),h(s,{span:12},{default:g(()=>[h(d,{label:"å®¢æˆ·æ¥æº",prop:"source"},{default:g(()=>[h(I,{modelValue:$.source,"onUpdate:modelValue":l[15]||(l[15]=e=>$.source=e),placeholder:"è¯·é€‰æ‹©å®¢æˆ·æ¥æº",style:{width:"100%"}},{default:g(()=>[h(P,{label:"çº¿ä¸Šæ¨å¹¿",value:"online"}),h(P,{label:"æœ‹å‹æ¨è",value:"referral"}),h(P,{label:"ç”µè¯è¥é”€",value:"telemarketing"}),h(P,{label:"é—¨åº—åˆ°è®¿",value:"store"}),h(P,{label:"å…¶ä»–",value:"other"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),h(i,{gutter:20},{default:g(()=>[h(s,{span:12},{default:g(()=>[h(d,{label:"å®¢æˆ·æ ‡ç­¾",prop:"tags"},{default:g(()=>[h(I,{modelValue:$.tags,"onUpdate:modelValue":l[16]||(l[16]=e=>$.tags=e),placeholder:"è¯·é€‰æ‹©å®¢æˆ·æ ‡ç­¾",multiple:"",style:{width:"100%"},loading:re.value},{default:g(()=>[(v(!0),f(V,null,w(te.value,e=>(v(),A(P,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1}),h(s,{span:12},{default:g(()=>[h(d,{label:"è´Ÿè´£é”€å”®",prop:"salesPerson"},{default:g(()=>[h(I,{modelValue:$.salesPerson,"onUpdate:modelValue":l[17]||(l[17]=e=>$.salesPerson=e),placeholder:"è¯·é€‰æ‹©è´Ÿè´£é”€å”®",style:{width:"100%"},disabled:!y(F).isAdmin},{default:g(()=>[(v(!0),f(V,null,w(ae.value,e=>(v(),A(P,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_("div",R,[l[36]||(l[36]=_("h3",{class:"section-title"},"å¤‡æ³¨ä¿¡æ¯",-1)),h(d,{label:"å¤‡æ³¨",prop:"remark"},{default:g(()=>[h(r,{modelValue:$.remark,"onUpdate:modelValue":l[18]||(l[18]=e=>$.remark=e),type:"textarea",rows:4,placeholder:"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"},null,8,["modelValue"])]),_:1})])]),_:1},8,["model"])]),_:1})])}}}),[["__scopeId","data-v-560f5b8d"]]);export{S as default};
