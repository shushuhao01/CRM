import{l as e,e as a,r as t,Z as l,b as s,w as i,ag as n,aq as c,m as o,q as d,p as u,U as r,M as m,O as p,S as v,u as g,Q as y,T as f,P as b,F as k,a9 as w,J as h,a2 as _}from"./vendor-BtukhyiH.js";import{C,W as A,a4 as D,z as N,T as z,t as V,F as S,r as T,Z as x,Q as P,H as B,j as U,A as j,d as L,aK as E,a7 as M,E as I,b as q}from"./elementPlus-DxaqjplL.js";import{u as R,b as $,M as F,_ as O}from"./index-C4IdUW1A.js";import"./utils-DfI7e5Rl.js";const J={class:"sms-templates-page"},Q={class:"page-header"},Z={class:"header-content"},H={class:"header-right"},K={class:"stats-section"},W={class:"stats-grid"},G={class:"stat-card total"},X={class:"stat-icon"},Y={class:"stat-content"},ee={class:"stat-value"},ae={class:"stat-card active"},te={class:"stat-icon"},le={class:"stat-content"},se={class:"stat-value"},ie={key:0,class:"stat-card pending"},ne={class:"stat-icon"},ce={class:"stat-content"},oe={class:"stat-value"},de={class:"stat-card usage"},ue={class:"stat-icon"},re={class:"stat-content"},me={class:"stat-value"},pe={class:"search-section"},ve={class:"search-form"},ge={class:"search-left"},ye={class:"search-right"},fe={class:"templates-section"},be={class:"card-header"},ke={class:"header-actions"},we={key:0,class:"grid-view"},he={class:"templates-grid"},_e={class:"template-header"},Ce={class:"template-title"},Ae={class:"template-status"},De={class:"template-content"},Ne={class:"content-preview"},ze={class:"template-meta"},Ve={class:"category"},Se={class:"usage-count"},Te={class:"template-footer"},xe={class:"template-time"},Pe={class:"template-actions"},Be={key:1,class:"list-view"},Ue={class:"template-name-cell"},je={class:"name"},Le={class:"content-cell"},Ee={class:"content-text"},Me={key:0,class:"variables"},Ie={class:"category-text"},qe={class:"usage-count"},Re={class:"time-text"},$e={class:"action-buttons"},Fe={class:"pagination-section"},Oe={class:"variables-section"},Je={class:"variables-list"},Qe={class:"dialog-footer"},Ze={class:"preview-content"},He={class:"preview-header"},Ke={class:"preview-body"},We={class:"content-section"},Ge={class:"content-display"},Xe={key:0,class:"variables-section"},Ye={class:"variables-display"},ea={class:"meta-section"},aa={class:"meta-item"},ta={class:"value"},la={class:"meta-item"},sa={class:"value"},ia={class:"meta-item"},na={class:"value"},ca={class:"meta-item"},oa={class:"value"},da=O(e({__name:"SmsTemplates",setup(e){const O=R(),da=a(()=>"super_admin"===O.user?.role),ua=$(),ra=t(!1),ma=t(!1),pa=t(!1),va=t(!1),ga=t("create"),ya=t("grid"),fa=t(),ba=l({keyword:"",status:"",category:""}),ka=l({currentPage:1,pageSize:20}),wa=l({total:0,active:0,pending:0,usage:0}),ha=t([]),_a=t(null),Ca=l({id:"",name:"",content:"",category:"",description:"",isDefault:!1,status:"active"}),Aa={name:[{required:!0,message:"请输入模板名称",trigger:"blur"},{min:2,max:50,message:"模板名称长度在 2 到 50 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入模板内容",trigger:"blur"},{min:10,max:500,message:"模板内容长度在 10 到 500 个字符",trigger:"blur"}],category:[{required:!0,message:"请选择模板分类",trigger:"change"}],description:[{required:!0,message:"请输入申请说明",trigger:"blur"},{min:10,max:200,message:"申请说明长度在 10 到 200 个字符",trigger:"blur"}]},Da=a(()=>{const e=Ca.content.match(/\{([^}]+)\}/g);return e?e.map(e=>e.slice(1,-1)):[]}),Na=a(()=>{let e=ha.value;return da.value||(e=e.filter(e=>"active"===e.status||e.createdBy===O.user?.id)),ba.keyword&&(e=e.filter(e=>e.name.toLowerCase().includes(ba.keyword.toLowerCase())||e.content.toLowerCase().includes(ba.keyword.toLowerCase()))),ba.status&&(e=e.filter(e=>e.status===ba.status)),ba.category&&(e=e.filter(e=>e.category===ba.category)),e}),za=a(()=>{const e=(ka.currentPage-1)*ka.pageSize,a=e+ka.pageSize;return Na.value.slice(e,a)}),Va=()=>{ga.value="create",qa(),pa.value=!0},Sa=()=>{ga.value="apply",qa(),Ca.status="pending",pa.value=!0},Ta=e=>{ga.value="edit",Object.assign(Ca,e),pa.value=!0},xa=e=>{_a.value=e,va.value=!0},Pa=async e=>{try{await q.confirm("确定要审核通过这个模板吗？","确认审核",{type:"warning"}),e.status="active",I.success("模板审核通过"),ua.sendMessage(F.SMS_TEMPLATE_APPROVED,`您申请的短信模板"${e.name}"已审核通过，现在可以使用了。`,{relatedId:e.id,relatedType:"sms_template",actionUrl:"/system/sms-templates"})}catch(a){}},Ba=async e=>{try{const{value:a}=await q.prompt("请输入拒绝原因","审核拒绝",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{5,}/,inputErrorMessage:"拒绝原因至少5个字符"});e.status="rejected",e.rejectReason=a,I.success("模板已拒绝"),ua.sendMessage(F.SMS_TEMPLATE_REJECTED,`您申请的短信模板"${e.name}"审核未通过。拒绝原因：${a}`,{relatedId:e.id,relatedType:"sms_template",actionUrl:"/system/sms-templates"})}catch(a){}},Ua=async e=>{try{await q.confirm("确定要删除这个模板吗？删除后不可恢复。","确认删除",{type:"warning"});const a=ha.value.findIndex(a=>a.id===e.id);a>-1&&(ha.value.splice(a,1),I.success("模板删除成功"))}catch(a){}},ja=async e=>{try{await q.confirm("确定要启用这个模板吗？","确认启用",{type:"info"}),e.status="active",e.updatedAt=(new Date).toLocaleString(),I.success("模板已启用")}catch(a){}},La=async e=>{try{await q.confirm("确定要禁用这个模板吗？禁用后将无法使用。","确认禁用",{type:"warning"}),e.status="disabled",e.updatedAt=(new Date).toLocaleString(),I.success("模板已禁用")}catch(a){}},Ea=async()=>{if(fa.value)try{if(await fa.value.validate(),ma.value=!0,await new Promise(e=>setTimeout(e,1e3)),"create"===ga.value){const e={...Ca,id:Date.now().toString(),usageCount:0,variables:Da.value,createdBy:O.user?.id,createdAt:(new Date).toLocaleString(),updatedAt:(new Date).toLocaleString()};ha.value.unshift(e),I.success("模板创建成功")}else if("edit"===ga.value){const e=ha.value.findIndex(e=>e.id===Ca.id);e>-1&&(ha.value[e]={...ha.value[e],...Ca,variables:Da.value,updatedAt:(new Date).toLocaleString()},I.success("模板更新成功"))}else if("apply"===ga.value){const e={...Ca,id:Date.now().toString(),usageCount:0,variables:Da.value,createdBy:O.user?.id,createdAt:(new Date).toLocaleString(),updatedAt:(new Date).toLocaleString()};ha.value.unshift(e),I.success("模板申请已提交，等待管理员审核"),ua.sendMessage(F.SMS_TEMPLATE_APPLIED,`用户 ${O.user?.name} 申请了新的短信模板"${e.name}"，请及时审核。`,{relatedId:e.id,relatedType:"sms_template",actionUrl:"/system/sms-templates"})}pa.value=!1}catch(e){I.error("操作失败，请重试")}finally{ma.value=!1}},Ma=()=>{ka.currentPage=1},Ia=()=>{ba.keyword="",ba.status="",ba.category="",ka.currentPage=1},qa=()=>{Object.assign(Ca,{id:"",name:"",content:"",category:"",description:"",isDefault:!1,status:"active"}),fa.value?.resetFields()},Ra=e=>{ka.pageSize=e,ka.currentPage=1},$a=e=>{ka.currentPage=e},Fa=e=>{xa(e)},Oa=e=>da.value||e.createdBy===O.user?.id,Ja=e=>da.value||e.createdBy===O.user?.id&&"active"!==e.status,Qa=e=>({active:"success",disabled:"info",pending:"warning",rejected:"danger"}[e]||"info"),Za=e=>({active:"已启用",disabled:"已禁用",pending:"待审核",rejected:"已拒绝"}[e]||"未知"),Ha=e=>({marketing:"营销推广",notification:"系统通知",verification:"验证码",order:"订单提醒"}[e]||"其他"),Ka=e=>e||"-";return s(()=>{(async()=>{ra.value=!0;try{await new Promise(e=>setTimeout(e,500)),ha.value=[{id:"1",name:"客户回访模板",content:"尊敬的{customerName}，感谢您对我们产品的支持，我们将为您提供更好的服务。如有任何问题，请联系我们：{phone}",category:"notification",status:"active",isDefault:!1,usageCount:156,variables:["customerName","phone"],createdBy:"admin",createdAt:"2024-01-15 10:30:00",updatedAt:"2024-01-20 14:20:00"},{id:"2",name:"促销活动模板",content:"【{companyName}】新年大促销！全场商品{discount}折起，活动时间：{startDate}至{endDate}，详情咨询客服。",category:"marketing",status:"active",isDefault:!1,usageCount:89,variables:["companyName","discount","startDate","endDate"],createdBy:"admin",createdAt:"2024-01-10 09:15:00",updatedAt:"2024-01-18 16:45:00"},{id:"3",name:"验证码模板",content:"您的验证码是：{code}，请在{minutes}分钟内使用，请勿泄露给他人。",category:"verification",status:"active",isDefault:!0,usageCount:1234,variables:["code","minutes"],createdBy:"admin",createdAt:"2024-01-22 11:20:00",updatedAt:"2024-01-22 11:20:00"},{id:"4",name:"订单确认通知",content:"【{companyName}】您的订单{orderNo}已确认，商品：{productName}，金额：{amount}元，预计{deliveryDate}发货。",category:"order",status:"active",isDefault:!1,usageCount:892,variables:["companyName","orderNo","productName","amount","deliveryDate"],createdBy:"admin",createdAt:"2024-01-20 15:30:00",updatedAt:"2024-01-25 10:15:00"},{id:"5",name:"发货通知模板",content:"【{companyName}】您的订单{orderNo}已发货，快递单号：{trackingNo}，请注意查收。物流查询：{trackingUrl}",category:"notification",status:"active",isDefault:!1,usageCount:756,variables:["companyName","orderNo","trackingNo","trackingUrl"],createdBy:"admin",createdAt:"2024-01-18 14:20:00",updatedAt:"2024-01-23 09:45:00"},{id:"6",name:"付款提醒模板",content:"尊敬的{customerName}，您的订单{orderNo}待付款，金额{amount}元，请及时完成支付。如有疑问请联系客服。",category:"notification",status:"active",isDefault:!1,usageCount:423,variables:["customerName","orderNo","amount"],createdBy:"admin",createdAt:"2024-01-16 11:30:00",updatedAt:"2024-01-21 16:20:00"},{id:"7",name:"会议通知模板",content:"【会议通知】{meetingTitle}将于{meetingDate} {meetingTime}在{location}举行，请准时参加。联系人：{contact}",category:"notification",status:"active",isDefault:!1,usageCount:234,variables:["meetingTitle","meetingDate","meetingTime","location","contact"],createdBy:"admin",createdAt:"2024-01-19 13:15:00",updatedAt:"2024-01-24 08:30:00"},{id:"8",name:"生日祝福模板",content:"亲爱的{customerName}，今天是您的生日，{companyName}全体员工祝您生日快乐！特为您准备了生日礼品，请到店领取。",category:"marketing",status:"active",isDefault:!1,usageCount:67,variables:["customerName","companyName"],createdBy:"admin",createdAt:"2024-01-17 10:45:00",updatedAt:"2024-01-22 14:10:00"},{id:"9",name:"服务预约确认",content:"【{companyName}】您预约的{serviceName}服务已确认，时间：{appointmentDate} {appointmentTime}，地址：{address}，联系电话：{phone}",category:"notification",status:"active",isDefault:!1,usageCount:345,variables:["companyName","serviceName","appointmentDate","appointmentTime","address","phone"],createdBy:"admin",createdAt:"2024-01-21 09:20:00",updatedAt:"2024-01-26 11:40:00"},{id:"10",name:"账户余额提醒",content:"【{companyName}】您的账户余额为{balance}元，余额不足可能影响服务使用，请及时充值。充值热线：{phone}",category:"notification",status:"active",isDefault:!1,usageCount:178,variables:["companyName","balance","phone"],createdBy:"admin",createdAt:"2024-01-14 16:30:00",updatedAt:"2024-01-19 12:15:00"},{id:"11",name:"密码重置通知",content:"【{companyName}】您的账户密码已重置，新密码：{newPassword}，请及时登录修改。如非本人操作，请联系客服：{phone}",category:"notification",status:"disabled",isDefault:!1,usageCount:89,variables:["companyName","newPassword","phone"],createdBy:"admin",createdAt:"2024-01-13 08:45:00",updatedAt:"2024-01-18 15:20:00"},{id:"12",name:"活动邀请模板",content:"【{companyName}】诚邀您参加{eventName}，时间：{eventDate}，地点：{venue}。精彩活动，丰厚奖品等您来！报名电话：{phone}",category:"marketing",status:"active",isDefault:!1,usageCount:123,variables:["companyName","eventName","eventDate","venue","phone"],createdBy:"admin",createdAt:"2024-01-12 12:10:00",updatedAt:"2024-01-17 17:25:00"},{id:"13",name:"新用户申请模板",content:"【限时优惠】{name}，{product}现在只要{price}元！立即购买享受{discount}折优惠，活动截止{endTime}。",category:"marketing",status:"pending",isDefault:!1,usageCount:0,variables:["name","product","price","discount","endTime"],createdBy:"user2",createdAt:"2024-01-26 11:20:00",updatedAt:"2024-01-26 11:20:00"}],wa.total=ha.value.length,wa.active=ha.value.filter(e=>"active"===e.status).length,wa.pending=ha.value.filter(e=>"pending"===e.status).length,wa.usage=ha.value.reduce((e,a)=>e+a.usageCount,0)}catch(e){I.error("加载模板失败")}finally{ra.value=!1}})()}),i([()=>ba.keyword,()=>ba.status,()=>ba.category],()=>{ka.currentPage=1}),(e,a)=>{const t=n("el-button"),l=n("el-icon"),s=n("el-input"),i=n("el-option"),I=n("el-select"),q=n("el-card"),R=n("el-button-group"),$=n("el-tag"),F=n("el-table-column"),O=n("el-dropdown-item"),ua=n("el-dropdown-menu"),ha=n("el-dropdown"),qa=n("el-table"),Wa=n("el-pagination"),Ga=n("el-form-item"),Xa=n("el-switch"),Ya=n("el-form"),et=n("el-dialog"),at=c("loading");return d(),o("div",J,[u("div",Q,[u("div",Z,[a[17]||(a[17]=u("div",{class:"header-left"},[u("h1",{class:"page-title"},"短信模板管理"),u("p",{class:"page-subtitle"},"管理和配置短信模板，支持创建、编辑和审核流程")],-1)),u("div",H,[da.value?(d(),m(t,{key:0,type:"primary",icon:g(C),onClick:Va,class:"create-btn"},{default:p(()=>[...a[15]||(a[15]=[v(" 创建模板 ",-1)])]),_:1},8,["icon"])):(d(),m(t,{key:1,type:"primary",icon:g(A),onClick:Sa,class:"apply-btn"},{default:p(()=>[...a[16]||(a[16]=[v(" 申请模板 ",-1)])]),_:1},8,["icon"]))])])]),u("div",K,[u("div",W,[u("div",G,[u("div",X,[r(l,null,{default:p(()=>[r(g(D))]),_:1})]),u("div",Y,[u("div",ee,f(wa.total),1),a[18]||(a[18]=u("div",{class:"stat-label"},"总模板数",-1))])]),u("div",ae,[u("div",te,[r(l,null,{default:p(()=>[r(g(N))]),_:1})]),u("div",le,[u("div",se,f(wa.active),1),a[19]||(a[19]=u("div",{class:"stat-label"},"已启用",-1))])]),da.value?(d(),o("div",ie,[u("div",ne,[r(l,null,{default:p(()=>[r(g(z))]),_:1})]),u("div",ce,[u("div",oe,f(wa.pending),1),a[20]||(a[20]=u("div",{class:"stat-label"},"待审核",-1))])])):y("",!0),u("div",de,[u("div",ue,[r(l,null,{default:p(()=>[r(g(V))]),_:1})]),u("div",re,[u("div",me,f(wa.usage),1),a[21]||(a[21]=u("div",{class:"stat-label"},"本月使用",-1))])])])]),u("div",pe,[r(q,{class:"search-card"},{default:p(()=>[u("div",ve,[u("div",ge,[r(s,{modelValue:ba.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>ba.keyword=e),placeholder:"搜索模板名称或内容","prefix-icon":g(S),clearable:"",onInput:Ma,class:"search-input"},null,8,["modelValue","prefix-icon"]),r(I,{modelValue:ba.status,"onUpdate:modelValue":a[1]||(a[1]=e=>ba.status=e),placeholder:"状态",clearable:"",class:"status-select"},{default:p(()=>[r(i,{label:"全部",value:""}),r(i,{label:"已启用",value:"active"}),r(i,{label:"已禁用",value:"disabled"}),da.value?(d(),m(i,{key:0,label:"待审核",value:"pending"})):y("",!0),da.value?(d(),m(i,{key:1,label:"已拒绝",value:"rejected"})):y("",!0)]),_:1},8,["modelValue"]),r(I,{modelValue:ba.category,"onUpdate:modelValue":a[2]||(a[2]=e=>ba.category=e),placeholder:"分类",clearable:"",class:"category-select"},{default:p(()=>[r(i,{label:"全部",value:""}),r(i,{label:"营销推广",value:"marketing"}),r(i,{label:"系统通知",value:"notification"}),r(i,{label:"验证码",value:"verification"}),r(i,{label:"订单提醒",value:"order"})]),_:1},8,["modelValue"])]),u("div",ye,[r(t,{onClick:Ia,icon:g(T)},{default:p(()=>[...a[22]||(a[22]=[v("重置",-1)])]),_:1},8,["icon"]),r(t,{type:"primary",onClick:Ma,icon:g(S)},{default:p(()=>[...a[23]||(a[23]=[v("搜索",-1)])]),_:1},8,["icon"])])])]),_:1})]),u("div",fe,[r(q,{class:"templates-card"},{header:p(()=>[u("div",be,[a[24]||(a[24]=u("span",{class:"header-title"},"模板列表",-1)),u("div",ke,[r(R,null,{default:p(()=>[r(t,{type:"grid"===ya.value?"primary":"",icon:g(E),onClick:a[3]||(a[3]=e=>ya.value="grid"),size:"small"},null,8,["type","icon"]),r(t,{type:"list"===ya.value?"primary":"",icon:g(M),onClick:a[4]||(a[4]=e=>ya.value="list"),size:"small"},null,8,["type","icon"])]),_:1})])])]),default:p(()=>["grid"===ya.value?(d(),o("div",we,[b((d(),o("div",he,[(d(!0),o(k,null,w(za.value,e=>(d(),o("div",{key:e.id,class:h(["template-card",{pending:"pending"===e.status}])},[u("div",_e,[u("div",Ce,f(e.name),1),u("div",Ae,[r($,{type:Qa(e.status),size:"small",class:"status-tag"},{default:p(()=>[v(f(Za(e.status)),1)]),_:2},1032,["type"])])]),u("div",De,[u("p",Ne,f(e.content),1),u("div",ze,[u("span",Ve,f(Ha(e.category)),1),u("span",Se,"使用 "+f(e.usageCount)+" 次",1)])]),u("div",Te,[u("div",xe,[u("span",null,f(Ka(e.updatedAt)),1)]),u("div",Pe,[r(t,{size:"small",icon:g(x),onClick:a=>xa(e),title:"预览"},{default:p(()=>[...a[25]||(a[25]=[v(" 预览 ",-1)])]),_:1},8,["icon","onClick"]),Oa(e)?(d(),m(t,{key:0,size:"small",type:"primary",icon:g(P),onClick:a=>Ta(e),title:"编辑"},{default:p(()=>[...a[26]||(a[26]=[v(" 编辑 ",-1)])]),_:1},8,["icon","onClick"])):y("",!0),"active"===e.status?(d(),m(t,{key:1,size:"small",type:"warning",onClick:a=>La(e),title:"禁用"},{default:p(()=>[...a[27]||(a[27]=[v(" 禁用 ",-1)])]),_:1},8,["onClick"])):y("",!0),"disabled"===e.status?(d(),m(t,{key:2,size:"small",type:"success",onClick:a=>ja(e),title:"启用"},{default:p(()=>[...a[28]||(a[28]=[v(" 启用 ",-1)])]),_:1},8,["onClick"])):y("",!0),da.value&&"pending"===e.status?(d(),m(t,{key:3,size:"small",type:"success",icon:g(B),onClick:a=>Pa(e),title:"审核通过"},null,8,["icon","onClick"])):y("",!0),da.value&&"pending"===e.status?(d(),m(t,{key:4,size:"small",type:"danger",icon:g(U),onClick:a=>Ba(e),title:"审核拒绝"},null,8,["icon","onClick"])):y("",!0),Ja(e)?(d(),m(t,{key:5,size:"small",type:"danger",icon:g(j),onClick:a=>Ua(e),title:"删除"},{default:p(()=>[...a[29]||(a[29]=[v(" 删除 ",-1)])]),_:1},8,["icon","onClick"])):y("",!0)])])],2))),128))])),[[at,ra.value]])])):(d(),o("div",Be,[b((d(),m(qa,{data:za.value,class:"templates-table",onRowClick:Fa},{default:p(()=>[r(F,{prop:"name",label:"模板名称",width:"200"},{default:p(({row:e})=>[u("div",Ue,[u("span",je,f(e.name),1),e.isDefault?(d(),m($,{key:0,type:"warning",size:"small",class:"default-tag"},{default:p(()=>[...a[30]||(a[30]=[v(" 默认 ",-1)])]),_:1})):y("",!0)])]),_:1}),r(F,{prop:"content",label:"模板内容","min-width":"300"},{default:p(({row:e})=>[u("div",Le,[u("p",Ee,f(e.content),1),e.variables?.length?(d(),o("div",Me,[(d(!0),o(k,null,w(e.variables,e=>(d(),m($,{key:e,size:"small",class:"variable-tag"},{default:p(()=>[v(f(e),1)]),_:2},1024))),128))])):y("",!0)])]),_:1}),r(F,{prop:"category",label:"分类",width:"120"},{default:p(({row:e})=>[u("span",Ie,f(Ha(e.category)),1)]),_:1}),r(F,{prop:"status",label:"状态",width:"100"},{default:p(({row:e})=>[r($,{type:Qa(e.status),size:"small"},{default:p(()=>[v(f(Za(e.status)),1)]),_:2},1032,["type"])]),_:1}),r(F,{prop:"usageCount",label:"使用次数",width:"100",align:"center"},{default:p(({row:e})=>[u("span",qe,f(e.usageCount),1)]),_:1}),r(F,{prop:"updatedAt",label:"更新时间",width:"160"},{default:p(({row:e})=>[u("span",Re,f(Ka(e.updatedAt)),1)]),_:1}),r(F,{label:"操作",width:"280",fixed:"right"},{default:p(({row:e})=>[u("div",$e,[r(t,{size:"small",icon:g(x),onClick:_(a=>xa(e),["stop"])},{default:p(()=>[...a[31]||(a[31]=[v(" 预览 ",-1)])]),_:1},8,["icon","onClick"]),Oa(e)?(d(),m(t,{key:0,size:"small",type:"primary",icon:g(P),onClick:_(a=>Ta(e),["stop"])},{default:p(()=>[...a[32]||(a[32]=[v(" 编辑 ",-1)])]),_:1},8,["icon","onClick"])):y("",!0),"active"===e.status?(d(),m(t,{key:1,size:"small",type:"warning",onClick:_(a=>La(e),["stop"])},{default:p(()=>[...a[33]||(a[33]=[v(" 禁用 ",-1)])]),_:1},8,["onClick"])):y("",!0),"disabled"===e.status?(d(),m(t,{key:2,size:"small",type:"success",onClick:_(a=>ja(e),["stop"])},{default:p(()=>[...a[34]||(a[34]=[v(" 启用 ",-1)])]),_:1},8,["onClick"])):y("",!0),da.value&&"pending"===e.status?(d(),m(ha,{key:3,onCommand:a=>((e,a)=>{"approve"===e?Pa(a):"reject"===e&&Ba(a)})(a,e)},{dropdown:p(()=>[r(ua,null,{default:p(()=>[r(O,{command:"approve"},{default:p(()=>[...a[36]||(a[36]=[v("通过",-1)])]),_:1}),r(O,{command:"reject"},{default:p(()=>[...a[37]||(a[37]=[v("拒绝",-1)])]),_:1})]),_:1})]),default:p(()=>[r(t,{size:"small",type:"success"},{default:p(()=>[a[35]||(a[35]=v(" 审核",-1)),r(l,{class:"el-icon--right"},{default:p(()=>[r(g(L))]),_:1})]),_:1})]),_:1},8,["onCommand"])):y("",!0),Ja(e)?(d(),m(t,{key:4,size:"small",type:"danger",icon:g(j),onClick:_(a=>Ua(e),["stop"])},{default:p(()=>[...a[38]||(a[38]=[v(" 删除 ",-1)])]),_:1},8,["icon","onClick"])):y("",!0)])]),_:1})]),_:1},8,["data"])),[[at,ra.value]])])),u("div",Fe,[r(Wa,{"current-page":ka.currentPage,"onUpdate:currentPage":a[5]||(a[5]=e=>ka.currentPage=e),"page-size":ka.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>ka.pageSize=e),"page-sizes":[10,20,50,100],total:Na.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Ra,onCurrentChange:$a,class:"pagination"},null,8,["current-page","page-size","total"])])]),_:1})]),r(et,{modelValue:pa.value,"onUpdate:modelValue":a[13]||(a[13]=e=>pa.value=e),title:"create"===ga.value?"创建模板":"edit"===ga.value?"编辑模板":"申请模板",width:"800px",class:"template-dialog","close-on-click-modal":!1},{footer:p(()=>[u("div",Qe,[r(t,{onClick:a[12]||(a[12]=e=>pa.value=!1)},{default:p(()=>[...a[42]||(a[42]=[v("取消",-1)])]),_:1}),r(t,{type:"primary",onClick:Ea,loading:ma.value},{default:p(()=>[v(f("apply"===ga.value?"提交申请":"确定"),1)]),_:1},8,["loading"])])]),default:p(()=>[r(Ya,{model:Ca,rules:Aa,ref_key:"templateFormRef",ref:fa,"label-width":"100px",class:"template-form"},{default:p(()=>[r(Ga,{label:"模板名称",prop:"name"},{default:p(()=>[r(s,{modelValue:Ca.name,"onUpdate:modelValue":a[7]||(a[7]=e=>Ca.name=e),placeholder:"请输入模板名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),r(Ga,{label:"模板分类",prop:"category"},{default:p(()=>[r(I,{modelValue:Ca.category,"onUpdate:modelValue":a[8]||(a[8]=e=>Ca.category=e),placeholder:"请选择分类"},{default:p(()=>[r(i,{label:"营销推广",value:"marketing"}),r(i,{label:"系统通知",value:"notification"}),r(i,{label:"验证码",value:"verification"}),r(i,{label:"订单提醒",value:"order"})]),_:1},8,["modelValue"])]),_:1}),r(Ga,{label:"模板内容",prop:"content"},{default:p(()=>[r(s,{modelValue:Ca.content,"onUpdate:modelValue":a[9]||(a[9]=e=>Ca.content=e),type:"textarea",rows:6,placeholder:"请输入模板内容，使用 {变量名} 格式定义变量",maxlength:"500","show-word-limit":""},null,8,["modelValue"]),a[39]||(a[39]=u("div",{class:"form-tip"},[u("p",null,"• 使用 {变量名} 格式定义变量，如：{name}、{code}、{amount}"),u("p",null,"• 模板内容不能超过500字符"),u("p",null,"• 请确保内容符合相关法规要求")],-1))]),_:1}),Da.value.length?(d(),m(Ga,{key:0,label:"变量说明"},{default:p(()=>[u("div",Oe,[u("div",Je,[(d(!0),o(k,null,w(Da.value,e=>(d(),m($,{key:e,class:"variable-item"},{default:p(()=>[v(f(e),1)]),_:2},1024))),128))]),a[40]||(a[40]=u("p",{class:"variables-tip"},"系统自动检测到以上变量，请确保在使用时提供对应的值",-1))])]),_:1})):y("",!0),"apply"===ga.value?(d(),m(Ga,{key:1,label:"申请说明",prop:"description"},{default:p(()=>[r(s,{modelValue:Ca.description,"onUpdate:modelValue":a[10]||(a[10]=e=>Ca.description=e),type:"textarea",rows:3,placeholder:"请说明申请此模板的用途和必要性",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})):y("",!0),da.value&&"apply"!==ga.value?(d(),m(Ga,{key:2,label:"设为默认"},{default:p(()=>[r(Xa,{modelValue:Ca.isDefault,"onUpdate:modelValue":a[11]||(a[11]=e=>Ca.isDefault=e)},null,8,["modelValue"]),a[41]||(a[41]=u("span",{class:"form-tip"},"默认模板将在发送短信时优先显示",-1))]),_:1})):y("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),r(et,{modelValue:va.value,"onUpdate:modelValue":a[14]||(a[14]=e=>va.value=e),title:"模板预览",width:"600px",class:"preview-dialog"},{default:p(()=>[u("div",Ze,[u("div",He,[u("h4",null,f(_a.value?.name),1),r($,{type:Qa(_a.value?.status)},{default:p(()=>[v(f(Za(_a.value?.status)),1)]),_:1},8,["type"])]),u("div",Ke,[u("div",We,[a[43]||(a[43]=u("h5",null,"模板内容",-1)),u("div",Ge,f(_a.value?.content),1)]),_a.value?.variables?.length?(d(),o("div",Xe,[a[44]||(a[44]=u("h5",null,"变量列表",-1)),u("div",Ye,[(d(!0),o(k,null,w(_a.value.variables,e=>(d(),m($,{key:e,class:"variable-tag"},{default:p(()=>[v(f(e),1)]),_:2},1024))),128))])])):y("",!0),u("div",ea,[u("div",aa,[a[45]||(a[45]=u("span",{class:"label"},"分类：",-1)),u("span",ta,f(Ha(_a.value?.category)),1)]),u("div",la,[a[46]||(a[46]=u("span",{class:"label"},"使用次数：",-1)),u("span",sa,f(_a.value?.usageCount)+" 次",1)]),u("div",ia,[a[47]||(a[47]=u("span",{class:"label"},"创建时间：",-1)),u("span",na,f(Ka(_a.value?.createdAt)),1)]),u("div",ca,[a[48]||(a[48]=u("span",{class:"label"},"更新时间：",-1)),u("span",oa,f(Ka(_a.value?.updatedAt)),1)])])])])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-62d2cea2"]]);export{da as default};
