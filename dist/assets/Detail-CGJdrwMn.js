import{l as e,aA as a,aC as t,r as l,Z as s,e as i,b as r,ag as o,m as n,q as u,p as d,U as c,u as p,T as m,O as v,S as f,M as g,Q as y,F as _,a9 as k,J as b}from"./vendor-BtukhyiH.js";import{L as h,Q as w,aq as T,d as P,Z as S,C,R as $,ax as N,b as V,E as x}from"./elementPlus-DxaqjplL.js";import{b as D,d as I,u as R,a as q,c as A,_ as O}from"./index-DkAJPKqn.js";import{u as U,p as j}from"./product-BDuYhoXd.js";import"./utils-DfI7e5Rl.js";import"./env-DLalhsF6.js";const E={class:"product-detail"},F={class:"page-header"},L={class:"header-left"},z={class:"header-info"},B={class:"header-meta"},M={class:"product-code"},H={class:"header-actions"},G={class:"detail-content"},J={class:"product-basic"},Q={class:"product-images"},Y={class:"image-list"},Z={class:"product-info"},K={class:"info-row"},W={class:"info-row"},X={class:"info-row"},ee={class:"info-row"},ae={class:"info-row"},te={class:"info-row"},le={class:"info-row"},se={class:"info-row"},ie={class:"info-row"},re={class:"description"},oe={class:"price-info"},ne={class:"info-item"},ue={class:"price"},de={class:"info-item"},ce={key:0},pe={key:1,class:"sensitive-info"},me={class:"info-item"},ve={class:"stock-info"},fe={class:"info-item"},ge={key:1,class:"sensitive-info"},ye={class:"info-item"},_e={key:0},ke={key:1,class:"sensitive-info"},be={class:"info-item"},he={key:0},we={key:1,class:"sensitive-info"},Te={class:"stat-item"},Pe={class:"stat-value"},Se={class:"stat-item"},Ce={class:"stat-value"},$e={class:"card-header"},Ne={key:0,class:"empty-data"},Ve={class:"status-info"},xe={class:"status-item"},De={class:"status-item"},Ie={class:"status-item"},Re={class:"status-item"},qe={class:"status-item"},Ae={class:"quick-actions"},Oe={class:"stats-header"},Ue={key:0,class:"related-stats"},je={class:"stat-row"},Ee={class:"stat-value"},Fe={class:"stat-row"},Le={class:"stat-value"},ze={class:"stat-row"},Be={class:"stat-value"},Me={class:"stat-row"},He={class:"stat-value"},Ge={class:"stat-row"},Je={class:"stat-value"},Qe={key:1,class:"empty-data"},Ye={key:0,class:"operation-logs"},Ze={class:"log-time"},Ke={class:"log-content"},We={class:"log-operator"},Xe={class:"log-action"},ea={key:0,class:"log-detail"},aa={key:1,class:"empty-data"},ta={class:"dialog-footer"},la={key:0},sa={class:"dialog-footer"},ia=O(e({__name:"Detail",setup(e){const O=a(),ia=t(),ra=A(O),oa=D(),na=I(),ua=U(),da=R(),ca=q(),pa=l(!1),ma=l(!1),va=l(!1),fa=l(!1),ga=l({id:"",code:"",name:"",categoryName:"",specification:"",brand:"",unit:"",weight:0,dimensions:"",description:"",price:0,costPrice:0,marketPrice:0,stock:0,minStock:0,maxStock:0,salesCount:0,salesAmount:0,viewCount:0,favoriteCount:0,status:"",mainImage:"",images:[],createTime:"",updateTime:"",creator:"",updater:""}),ya=s({type:"increase",quantity:0,reason:"",remark:""}),_a=s({originalPrice:0,newPrice:0,reason:"",remark:""}),ka=l([]),ba=l({pendingOrders:0,monthlySales:0,turnoverRate:0,avgRating:0,returnRate:0,dataScope:"personal"}),ha=l([]),wa={type:[{required:!0,message:"请选择调整类型",trigger:"change"}],quantity:[{required:!0,message:"请输入调整数量",trigger:"blur"}],reason:[{required:!0,message:"请选择调整原因",trigger:"change"}]},Ta={newPrice:[{required:!0,message:"请输入新价格",trigger:"blur"},{type:"number",min:.01,message:"价格必须大于0.01",trigger:"blur"}],reason:[{required:!0,message:"请选择调价原因",trigger:"change"}]},Pa=l(),Sa=l(),Ca=i(()=>!ca.productConfig.enablePermissionControl||(da.isSuperAdmin||ca.productConfig.costPriceViewRoles.includes(da.userInfo?.role||""))),$a=i(()=>!ca.productConfig.enablePermissionControl||(da.isSuperAdmin||ca.productConfig.salesDataViewRoles.includes(da.userInfo?.role||""))),Na=i(()=>!ca.productConfig.enablePermissionControl||(da.isSuperAdmin||ca.productConfig.stockInfoViewRoles.includes(da.userInfo?.role||""))),Va=i(()=>!ca.productConfig.enablePermissionControl||(da.isSuperAdmin||ca.productConfig.operationLogsViewRoles.includes(da.userInfo?.role||""))),xa=i(()=>da.isAdmin||da.isSuperAdmin),Da=i(()=>da.isAdmin||da.isSuperAdmin),Ia=i(()=>da.isAdmin||da.isSuperAdmin),Ra=i(()=>da.isAdmin||da.isSuperAdmin),qa=()=>{O.back()},Aa=e=>({active:"success",inactive:"info",out_of_stock:"danger"}[e]||""),Oa=e=>({active:"上架",inactive:"下架",out_of_stock:"缺货"}[e]||e),Ua=e=>({increase:"增加",decrease:"减少",set:"设置"}[e]||e),ja=()=>{ra.push(`/product/edit/${ga.value.id}`)},Ea=()=>{Object.assign(ya,{type:"increase",quantity:0,reason:"",remark:""}),ma.value=!0},Fa=()=>{Object.assign(_a,{originalPrice:ga.value.price,newPrice:0,reason:"",remark:""}),fa.value=!0},La=()=>{ra.push(`/order/add?productId=${ga.value.id}`)},za=async()=>{const e="active"===ga.value.status?"下架":"上架";try{await V.confirm(`确定要${e}商品"${ga.value.name}"吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await new Promise(e=>setTimeout(e,500)),ga.value.status="active"===ga.value.status?"inactive":"active",x.success(`${e}成功`),oa.addNotification({type:"PRODUCT_STATUS_CHANGED",title:`商品${e}`,content:`商品"${ga.value.name}"已${e}`,data:{productId:ga.value.id,productName:ga.value.name,productCode:ga.value.code,status:ga.value.status,action:e,timestamp:(new Date).toISOString()},link:`/product/detail/${ga.value.id}`}),Za()}catch(a){}},Ba=e=>{switch(e){case"copy":Ma();break;case"toggle":za();break;case"delete":Ha()}},Ma=()=>{ra.push(`/product/add?copy=${ga.value.id}`)},Ha=async()=>{try{await V.confirm(`确定要删除商品"${ga.value.name}"吗？删除后不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await new Promise(e=>setTimeout(e,500)),x.success("删除成功"),oa.addNotification({type:"PRODUCT_DELETED",title:"商品删除",content:`商品"${ga.value.name}"已删除`,data:{productId:ga.value.id,productName:ga.value.name,productCode:ga.value.code,timestamp:(new Date).toISOString()},link:"/product/list"}),ra.push("/product/list")}catch(e){}},Ga=async()=>{try{await(Pa.value?.validate()),pa.value=!0,await new Promise(e=>setTimeout(e,1e3)),x.success("库存调整成功"),oa.addNotification({type:"PRODUCT_STOCK_ADJUSTED",title:"库存调整",content:`商品"${ga.value.name}"库存已调整`,data:{productId:ga.value.id,productName:ga.value.name,adjustmentType:ya.value.type,quantity:ya.value.quantity,reason:ya.value.reason,remark:ya.value.remark,timestamp:(new Date).toISOString()},link:`/product/detail/${ga.value.id}`}),Ja(),Za(),Ka()}catch(e){console.error("表单验证失败:",e)}finally{pa.value=!1}},Ja=()=>{ma.value=!1,Pa.value?.clearValidate()},Qa=async()=>{try{await(Sa.value?.validate()),va.value=!0,await new Promise(e=>setTimeout(e,1e3));const e=ga.value.price;ga.value.price=_a.newPrice,ua.updateProduct(ga.value.id,{price:_a.newPrice}),x.success("价格调整成功");const a=_a.newPrice-e,t=(a/e*100).toFixed(1);oa.addNotification({type:"PRODUCT_PRICE_CHANGED",title:"价格调整",content:`商品"${ga.value.name}"价格已调整`,data:{productId:ga.value.id,productName:ga.value.name,productCode:ga.value.code,oldPrice:e,newPrice:_a.newPrice,priceChange:a,changePercent:t,reason:_a.reason,remark:_a.remark,timestamp:(new Date).toISOString()},link:`/product/detail/${ga.value.id}`}),Ya(),Za()}catch(e){console.error("表单验证失败:",e)}finally{va.value=!1}},Ya=()=>{fa.value=!1,Sa.value?.clearValidate()},Za=async()=>{try{const e=ia.params.id;if(!e)return x.error("商品ID不存在"),void ra.push("/product/list");await new Promise(e=>setTimeout(e,800));let a=ua.getProductById(e);a||isNaN(Number(e))||(a=ua.getProductById(Number(e))),a?ga.value={...a,salesCount:a.salesCount||0,salesAmount:(a.salesCount||0)*a.price,mainImage:a.image,images:a.images||[a.image],createTime:a.createTime,updateTime:a.updateTime||a.createTime,creator:"系统",updater:"系统"}:(x.error("商品不存在"),ra.push("/product/list"))}catch(e){x.error("加载商品信息失败")}},Ka=async()=>{try{const e=ia.params.id,a=ua.products.find(a=>a.id===e||a.id===Number(e));if(!a)return void(ka.value=[]);const t=na.orders.filter(a=>a.products.some(a=>a.id===e||a.id===Number(e))&&["shipped","delivered"].includes(a.status)),l=[];if(l.push({id:`initial_${e}`,type:"increase",quantity:a.stock,stockAfter:a.stock,reason:"商品创建",operator:"系统管理员",remark:"商品创建时的初始库存",createTime:a.createTime}),t.forEach(t=>{const s=t.products.find(a=>a.id===e||a.id===Number(e));s&&l.push({id:`sale_${t.id}`,type:"decrease",quantity:s.quantity,stockAfter:Math.max(0,a.stock-s.quantity),reason:"销售出库",operator:"系统",remark:`订单号：${t.orderNumber}`,createTime:t.shippingTime||t.createTime})}),a.stock<a.minStock){const e=a.maxStock-a.stock;l.push({id:`restock_${Date.now()}`,type:"increase",quantity:e,stockAfter:a.maxStock,reason:"补货入库",operator:"采购部",remark:"库存不足，紧急补货",createTime:(new Date).toLocaleString("zh-CN")})}ka.value=l.sort((e,a)=>new Date(a.createTime).getTime()-new Date(e.createTime).getTime())}catch(e){console.error("加载库存记录失败:",e),ka.value=[]}},Wa=()=>{const e=da.user;return e?"super_admin"===e.role||"admin"===e.role?"all":"department_manager"===e.role||"department_head"===e.role?"department":"personal":"personal"},Xa=e=>({all:"全部数据",department:"部门数据",personal:"个人数据"}[e]||"个人数据"),et=async()=>{try{const e=ia.params.id,a=(e=>{const a=da.user;return a?"super_admin"===a.role?e:"department_head"===a.role?e.filter(e=>e.salesPerson?.departmentId===a.departmentId||e.customerService?.departmentId===a.departmentId):"sales"===a.role?e.filter(e=>e.salesPersonId===a.id):"customer_service"===a.role?e.filter(e=>e.customerServiceId===a.id):e.filter(e=>e.salesPersonId===a.id||e.customerServiceId===a.id):[]})(na.orders),t=a.filter(a=>a.products.some(a=>a.id===e||a.id===Number(e))),l=t.filter(e=>["pending_audit","pending_shipment"].includes(e.status)).length,s=(new Date).getMonth(),i=(new Date).getFullYear(),r=t.filter(e=>{const a=new Date(e.createTime);return a.getMonth()===s&&a.getFullYear()===i&&["shipped","delivered"].includes(e.status)}).reduce((a,t)=>{const l=t.products.find(a=>a.id===e||a.id===Number(e));return a+(l?.quantity||0)},0),o=(ua.products||[]).find(a=>a.id===e||a.id===Number(e)),n=o?(o.stock+o.maxStock)/2:1,u=n>0?r/n*100:0,d=t.filter(e=>"delivered"===e.status).length>0?4.2+.6*Math.random():0,c=t.filter(e=>["rejected","rejected_returned","logistics_returned"].includes(e.status)).length,p=t.length>0?c/t.length*100:0,m=da.user;let v="personal";"super_admin"===m?.role||"admin"===m?.role?v="all":"department_head"!==m?.role&&"manager"!==m?.role||(v="department"),ba.value={pendingOrders:l,monthlySales:r,turnoverRate:Number(u.toFixed(1)),avgRating:Number(d.toFixed(1)),returnRate:Number(p.toFixed(1)),dataScope:v}}catch(e){console.error("从本地加载统计数据失败:",e),ba.value={pendingOrders:0,monthlySales:0,turnoverRate:0,avgRating:0,returnRate:0,dataScope:"personal"}}};return r(()=>{Za(),Ka(),(async()=>{try{const e=ia.params.id,a=await j.getProductStats(e),t=Wa();ba.value={pendingOrders:a.pendingOrders||0,monthlySales:a.monthlySales||0,turnoverRate:a.turnoverRate||0,avgRating:a.avgRating||0,returnRate:a.returnRate||0,dataScope:a.dataScope||t}}catch(e){console.error("加载统计数据失败:",e),await et()}})(),(async()=>{try{const e=ia.params.id,a=[],t=ua.products.find(a=>a.id===e||a.id===Number(e));if(!t)return void(ha.value=[]);a.push({id:`product_create_${e}`,operator:"系统管理员",action:"创建商品",detail:`商品"${t.name}"创建成功`,createTime:t.createTime}),na.orders.filter(a=>a.products.some(a=>a.id===e||a.id===Number(e))).forEach(e=>{a.push({id:`order_create_${e.id}`,operator:e.createdBy||"客服",action:"创建订单",detail:`创建了包含商品"${t.name}"的订单 (订单号：${e.orderNumber})`,createTime:e.createTime}),e.statusHistory&&e.statusHistory.length>0&&e.statusHistory.forEach(t=>{a.push({id:`status_${e.id}_${t.time}`,operator:t.operator,action:"订单状态变更",detail:`${t.description} (订单号：${e.orderNumber})`,createTime:t.time})}),e.operationLogs&&e.operationLogs.length>0&&e.operationLogs.forEach(t=>{a.push({id:`order_${t.id}`,operator:t.operator,action:`订单${t.action}`,detail:`${t.description} (订单号：${e.orderNumber})`,createTime:t.time})})}),t.updateTime&&t.updateTime!==t.createTime&&a.push({id:`product_update_${e}`,operator:"商品管理员",action:"更新商品信息",detail:`商品"${t.name}"信息已更新`,createTime:t.updateTime}),t.stock!==t.minStock&&a.push({id:`stock_adjust_${e}`,operator:"库存管理员",action:"调整库存",detail:`当前库存：${t.stock}件`,createTime:new Date(Date.now()-7*Math.random()*24*60*60*1e3).toLocaleString("zh-CN")}),t.price!==t.marketPrice&&a.push({id:`price_adjust_${e}`,operator:"价格管理员",action:"调整价格",detail:`销售价格调整为：¥${t.price}`,createTime:new Date(Date.now()-14*Math.random()*24*60*60*1e3).toLocaleString("zh-CN")}),ha.value=a.sort((e,a)=>new Date(a.createTime).getTime()-new Date(e.createTime).getTime()).slice(0,20)}catch(e){console.error("加载操作日志失败:",e);const a=ia.params.id,t=ua.products.find(e=>e.id===a||e.id===Number(a));ha.value=t?[{id:`product_create_${a}`,operator:"系统管理员",action:"创建商品",detail:`商品"${t.name}"创建成功`,createTime:t.createTime}]:[]}})()}),(e,a)=>{const t=o("el-button"),l=o("el-tag"),s=o("el-icon"),i=o("el-dropdown-item"),r=o("el-dropdown-menu"),V=o("el-dropdown"),x=o("el-image"),D=o("el-card"),I=o("el-col"),R=o("el-row"),q=o("el-empty"),A=o("el-table-column"),O=o("el-table"),U=o("el-form-item"),j=o("el-radio"),ia=o("el-radio-group"),ra=o("el-input-number"),oa=o("el-option"),na=o("el-select"),ua=o("el-input"),da=o("el-form"),ca=o("el-dialog");return u(),n("div",E,[d("div",F,[d("div",L,[c(t,{onClick:qa,icon:p(h),circle:""},null,8,["icon"]),d("div",z,[d("h2",null,m(ga.value.name),1),d("div",B,[d("span",M,"商品编码："+m(ga.value.code),1),c(l,{type:Aa(ga.value.status),size:"small"},{default:v(()=>[f(m(Oa(ga.value.status)),1)]),_:1},8,["type"])])])]),d("div",H,[Da.value?(u(),g(t,{key:0,onClick:Ea,icon:p(w)},{default:v(()=>[...a[9]||(a[9]=[f(" 调库存 ",-1)])]),_:1},8,["icon"])):y("",!0),xa.value?(u(),g(t,{key:1,onClick:ja,type:"primary",icon:p(w)},{default:v(()=>[...a[10]||(a[10]=[f(" 编辑商品 ",-1)])]),_:1},8,["icon"])):y("",!0),xa.value?(u(),g(V,{key:2,onCommand:Ba},{dropdown:v(()=>[c(r,null,{default:v(()=>[c(i,{command:"copy"},{default:v(()=>[...a[12]||(a[12]=[f("复制商品",-1)])]),_:1}),Ra.value?(u(),g(i,{key:0,command:"toggle",divided:!0},{default:v(()=>[f(m("active"===ga.value.status?"下架":"上架"),1)]),_:1})):y("",!0),xa.value?(u(),g(i,{key:1,command:"delete",class:"danger-item"},{default:v(()=>[...a[13]||(a[13]=[f(" 删除商品 ",-1)])]),_:1})):y("",!0)]),_:1})]),default:v(()=>[c(t,{icon:p(T)},{default:v(()=>[a[11]||(a[11]=f(" 更多",-1)),c(s,{class:"el-icon--right"},{default:v(()=>[c(p(P))]),_:1})]),_:1},8,["icon"])]),_:1})):y("",!0)])]),d("div",G,[c(R,{gutter:20},{default:v(()=>[c(I,{span:16},{default:v(()=>[c(D,{class:"info-card",title:"基本信息"},{header:v(()=>[...a[14]||(a[14]=[d("span",null,"基本信息",-1)])]),default:v(()=>[d("div",J,[d("div",Q,[c(x,{src:ga.value.mainImage,"preview-src-list":ga.value.images,fit:"cover",class:"main-image"},null,8,["src","preview-src-list"]),d("div",Y,[(u(!0),n(_,null,k(ga.value.images,(e,a)=>(u(),g(x,{key:a,src:e,"preview-src-list":ga.value.images,"initial-index":a,fit:"cover",class:"thumb-image"},null,8,["src","preview-src-list","initial-index"]))),128))])]),d("div",Z,[d("div",K,[a[15]||(a[15]=d("label",null,"商品名称：",-1)),d("span",null,m(ga.value.name),1)]),d("div",W,[a[16]||(a[16]=d("label",null,"商品编码：",-1)),d("span",null,m(ga.value.code),1)]),d("div",X,[a[17]||(a[17]=d("label",null,"商品分类：",-1)),d("span",null,m(ga.value.categoryName),1)]),d("div",ee,[a[18]||(a[18]=d("label",null,"商品规格：",-1)),d("span",null,m(ga.value.specification),1)]),d("div",ae,[a[19]||(a[19]=d("label",null,"商品品牌：",-1)),d("span",null,m(ga.value.brand),1)]),d("div",te,[a[20]||(a[20]=d("label",null,"商品单位：",-1)),d("span",null,m(ga.value.unit),1)]),d("div",le,[a[21]||(a[21]=d("label",null,"商品重量：",-1)),d("span",null,m(ga.value.weight)+"kg",1)]),d("div",se,[a[22]||(a[22]=d("label",null,"商品尺寸：",-1)),d("span",null,m(ga.value.dimensions),1)]),d("div",ie,[a[23]||(a[23]=d("label",null,"商品描述：",-1)),d("div",re,m(ga.value.description),1)])])])]),_:1}),c(D,{class:"info-card",title:"价格库存"},{header:v(()=>[...a[24]||(a[24]=[d("span",null,"价格库存",-1)])]),default:v(()=>[c(R,{gutter:20},{default:v(()=>[c(I,{span:12},{default:v(()=>[d("div",oe,[d("div",ne,[a[25]||(a[25]=d("label",null,"销售价格：",-1)),d("span",ue,"¥"+m(ga.value.price),1)]),d("div",de,[a[27]||(a[27]=d("label",null,"成本价格：",-1)),Ca.value?(u(),n("span",ce,"¥"+m(ga.value.costPrice),1)):(u(),n("span",pe,[c(s,null,{default:v(()=>[c(p(S))]),_:1}),a[26]||(a[26]=f(" **** ",-1))]))]),d("div",me,[a[28]||(a[28]=d("label",null,"市场价格：",-1)),d("span",null,"¥"+m(ga.value.marketPrice),1)])])]),_:1}),c(I,{span:12},{default:v(()=>{return[d("div",ve,[d("div",fe,[a[30]||(a[30]=d("label",null,"当前库存：",-1)),Na.value?(u(),n("span",{key:0,class:b((e=ga.value.stock,t=ga.value.minStock,0===e?"stock-out":e<=t?"stock-warning":"stock-normal"))},m(ga.value.stock),3)):(u(),n("span",ge,[c(s,null,{default:v(()=>[c(p(S))]),_:1}),a[29]||(a[29]=f(" **** ",-1))]))]),d("div",ye,[a[32]||(a[32]=d("label",null,"最低库存：",-1)),Na.value?(u(),n("span",_e,m(ga.value.minStock),1)):(u(),n("span",ke,[c(s,null,{default:v(()=>[c(p(S))]),_:1}),a[31]||(a[31]=f(" **** ",-1))]))]),d("div",be,[a[34]||(a[34]=d("label",null,"最高库存：",-1)),Na.value?(u(),n("span",he,m(ga.value.maxStock),1)):(u(),n("span",we,[c(s,null,{default:v(()=>[c(p(S))]),_:1}),a[33]||(a[33]=f(" **** ",-1))]))])])];var e,t}),_:1})]),_:1})]),_:1}),$a.value?(u(),g(D,{key:0,class:"info-card",title:"销售数据"},{header:v(()=>[...a[35]||(a[35]=[d("span",null,"销售数据",-1)])]),default:v(()=>[c(R,{gutter:20},{default:v(()=>[c(I,{span:12},{default:v(()=>[d("div",Te,[d("div",Pe,m(ga.value.salesCount),1),a[36]||(a[36]=d("div",{class:"stat-label"},"总销量",-1))])]),_:1}),c(I,{span:12},{default:v(()=>[d("div",Se,[d("div",Ce,"¥"+m(ga.value.salesAmount),1),a[37]||(a[37]=d("div",{class:"stat-label"},"销售金额",-1))])]),_:1})]),_:1})]),_:1})):y("",!0),Na.value?(u(),g(D,{key:1,class:"info-card",title:"库存记录"},{header:v(()=>[d("div",$e,[a[39]||(a[39]=d("span",null,"库存记录",-1)),Na.value?(u(),g(t,{key:0,onClick:Ea,type:"primary",size:"small"},{default:v(()=>[...a[38]||(a[38]=[f(" 调整库存 ",-1)])]),_:1})):y("",!0)])]),default:v(()=>[0===ka.value.length?(u(),n("div",Ne,[c(q,{description:"暂无库存记录"})])):(u(),g(O,{key:1,data:ka.value,style:{width:"100%"}},{default:v(()=>[c(A,{prop:"createTime",label:"时间",width:"180"}),c(A,{label:"操作类型",width:"100"},{default:v(({row:e})=>{return[c(l,{type:(a=e.type,{increase:"success",decrease:"warning",set:"info"}[a]||""),size:"small"},{default:v(()=>[f(m(Ua(e.type)),1)]),_:2},1032,["type"])];var a}),_:1}),c(A,{prop:"quantity",label:"数量变化",width:"120"},{default:v(({row:e})=>[d("span",{class:b("increase"===e.type?"increase":"decrease")},m("increase"===e.type?"+":"-")+m(e.quantity),3)]),_:1}),c(A,{prop:"stockAfter",label:"变化后库存",width:"120"}),c(A,{prop:"reason",label:"调整原因"}),c(A,{prop:"operator",label:"操作人",width:"100"}),c(A,{prop:"remark",label:"备注","show-overflow-tooltip":""})]),_:1},8,["data"]))]),_:1})):y("",!0)]),_:1}),c(I,{span:8},{default:v(()=>[c(D,{class:"status-card"},{header:v(()=>[...a[40]||(a[40]=[d("span",null,"商品状态",-1)])]),default:v(()=>[d("div",Ve,[d("div",xe,[a[41]||(a[41]=d("label",null,"当前状态：",-1)),c(l,{type:Aa(ga.value.status)},{default:v(()=>[f(m(Oa(ga.value.status)),1)]),_:1},8,["type"])]),d("div",De,[a[42]||(a[42]=d("label",null,"创建时间：",-1)),d("span",null,m(ga.value.createTime),1)]),d("div",Ie,[a[43]||(a[43]=d("label",null,"更新时间：",-1)),d("span",null,m(ga.value.updateTime),1)]),d("div",Re,[a[44]||(a[44]=d("label",null,"创建人：",-1)),d("span",null,m(ga.value.creator),1)]),d("div",qe,[a[45]||(a[45]=d("label",null,"最后修改人：",-1)),d("span",null,m(ga.value.updater),1)])])]),_:1}),c(D,{class:"action-card"},{header:v(()=>[...a[46]||(a[46]=[d("span",null,"快速操作",-1)])]),default:v(()=>[d("div",Ae,[c(t,{onClick:La,type:"primary",icon:p(C),block:""},{default:v(()=>[...a[47]||(a[47]=[f(" 创建订单 ",-1)])]),_:1},8,["icon"]),Da.value?(u(),g(t,{key:0,onClick:Ea,icon:p(w),block:""},{default:v(()=>[...a[48]||(a[48]=[f(" 调整库存 ",-1)])]),_:1},8,["icon"])):y("",!0),Ia.value?(u(),g(t,{key:1,onClick:Fa,icon:p($),block:""},{default:v(()=>[...a[49]||(a[49]=[f(" 调整价格 ",-1)])]),_:1},8,["icon"])):y("",!0),Ra.value?(u(),g(t,{key:2,onClick:za,icon:p(N),block:""},{default:v(()=>[f(m("active"===ga.value.status?"下架商品":"上架商品"),1)]),_:1},8,["icon"])):y("",!0)])]),_:1}),$a.value?(u(),g(D,{key:0,class:"stats-card"},{header:v(()=>{return[d("div",Oe,[a[50]||(a[50]=d("span",null,"相关统计",-1)),ba.value.dataScope?(u(),g(l,{key:0,size:"small",type:(e=ba.value.dataScope,{all:"success",department:"warning",personal:"info"}[e]||"info")},{default:v(()=>[f(m(Xa(ba.value.dataScope)),1)]),_:1},8,["type"])):y("",!0)])];var e}),default:v(()=>[ba.value?(u(),n("div",Ue,[d("div",je,[a[51]||(a[51]=d("span",{class:"stat-label"},"待处理订单：",-1)),d("span",Ee,m(ba.value.pendingOrders||0),1)]),d("div",Fe,[a[52]||(a[52]=d("span",{class:"stat-label"},"本月销量：",-1)),d("span",Le,m(ba.value.monthlySales||0),1)]),d("div",ze,[a[53]||(a[53]=d("span",{class:"stat-label"},"库存周转率：",-1)),d("span",Be,m(ba.value.turnoverRate||0)+"%",1)]),d("div",Me,[a[54]||(a[54]=d("span",{class:"stat-label"},"平均评分：",-1)),d("span",He,m(ba.value.avgRating||0),1)]),d("div",Ge,[a[55]||(a[55]=d("span",{class:"stat-label"},"退货率：",-1)),d("span",Je,m(ba.value.returnRate||0)+"%",1)])])):(u(),n("div",Qe,[c(q,{description:"暂无统计数据"})]))]),_:1})):y("",!0),Va.value?(u(),g(D,{key:1,class:"log-card"},{header:v(()=>[...a[56]||(a[56]=[d("span",null,"操作日志",-1)])]),default:v(()=>[ha.value.length>0?(u(),n("div",Ye,[(u(!0),n(_,null,k(ha.value,e=>(u(),n("div",{key:e.id,class:"log-item"},[d("div",Ze,m(e.createTime),1),d("div",Ke,[d("span",We,m(e.operator),1),d("span",Xe,m(e.action),1)]),e.detail?(u(),n("div",ea,m(e.detail),1)):y("",!0)]))),128))])):(u(),n("div",aa,[c(q,{description:"暂无操作日志"})]))]),_:1})):y("",!0)]),_:1})]),_:1})]),c(ca,{modelValue:ma.value,"onUpdate:modelValue":a[4]||(a[4]=e=>ma.value=e),title:"库存调整",width:"500px","before-close":Ja},{footer:v(()=>[d("span",ta,[c(t,{onClick:Ja},{default:v(()=>[...a[60]||(a[60]=[f("取消",-1)])]),_:1}),c(t,{onClick:Ga,type:"primary",loading:pa.value},{default:v(()=>[...a[61]||(a[61]=[f(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:v(()=>[c(da,{ref_key:"stockFormRef",ref:Pa,model:ya,rules:wa,"label-width":"100px"},{default:v(()=>[c(U,{label:"商品名称"},{default:v(()=>[d("span",null,m(ga.value.name),1)]),_:1}),c(U,{label:"当前库存"},{default:v(()=>[d("span",null,m(ga.value.stock),1)]),_:1}),c(U,{label:"调整类型",prop:"type"},{default:v(()=>[c(ia,{modelValue:ya.type,"onUpdate:modelValue":a[0]||(a[0]=e=>ya.type=e)},{default:v(()=>[c(j,{label:"increase"},{default:v(()=>[...a[57]||(a[57]=[f("增加",-1)])]),_:1}),c(j,{label:"decrease"},{default:v(()=>[...a[58]||(a[58]=[f("减少",-1)])]),_:1}),c(j,{label:"set"},{default:v(()=>[...a[59]||(a[59]=[f("设置",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),c(U,{label:"调整数量",prop:"quantity"},{default:v(()=>[c(ra,{modelValue:ya.quantity,"onUpdate:modelValue":a[1]||(a[1]=e=>ya.quantity=e),min:"decrease"===ya.type?1:0,max:"decrease"===ya.type?ga.value.stock:99999,style:{width:"100%"}},null,8,["modelValue","min","max"])]),_:1}),c(U,{label:"调整原因",prop:"reason"},{default:v(()=>[c(na,{modelValue:ya.reason,"onUpdate:modelValue":a[2]||(a[2]=e=>ya.reason=e),placeholder:"请选择调整原因",style:{width:"100%"}},{default:v(()=>[c(oa,{label:"采购入库",value:"purchase"}),c(oa,{label:"销售出库",value:"sale"}),c(oa,{label:"盘点调整",value:"inventory"}),c(oa,{label:"损耗报废",value:"loss"}),c(oa,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),c(U,{label:"备注",prop:"remark"},{default:v(()=>[c(ua,{modelValue:ya.remark,"onUpdate:modelValue":a[3]||(a[3]=e=>ya.remark=e),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),c(ca,{modelValue:fa.value,"onUpdate:modelValue":a[8]||(a[8]=e=>fa.value=e),title:"价格调整",width:"500px","before-close":Ya},{footer:v(()=>[d("span",sa,[c(t,{onClick:Ya},{default:v(()=>[...a[62]||(a[62]=[f("取消",-1)])]),_:1}),c(t,{onClick:Qa,type:"primary",loading:va.value},{default:v(()=>[...a[63]||(a[63]=[f(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:v(()=>[c(da,{ref_key:"priceFormRef",ref:Sa,model:_a,rules:Ta,"label-width":"100px"},{default:v(()=>[c(U,{label:"商品名称"},{default:v(()=>[d("span",null,m(ga.value.name),1)]),_:1}),c(U,{label:"商品编码"},{default:v(()=>[d("span",null,m(ga.value.code),1)]),_:1}),c(U,{label:"当前价格"},{default:v(()=>[d("span",null,"¥"+m(ga.value.price?.toFixed(2)),1)]),_:1}),c(U,{label:"新价格",prop:"newPrice"},{default:v(()=>[c(ra,{modelValue:_a.newPrice,"onUpdate:modelValue":a[5]||(a[5]=e=>_a.newPrice=e),min:.01,precision:2,style:{width:"100%"},placeholder:"请输入新价格"},null,8,["modelValue"])]),_:1}),c(U,{label:"价格变化"},{default:v(()=>[_a.newPrice&&_a.originalPrice?(u(),n("span",la,[c(l,{type:_a.newPrice>_a.originalPrice?"success":"danger",size:"small"},{default:v(()=>[f(m(_a.newPrice>_a.originalPrice?"+":"")+" ¥"+m((_a.newPrice-_a.originalPrice).toFixed(2))+" ("+m(((_a.newPrice-_a.originalPrice)/_a.originalPrice*100).toFixed(1))+"%) ",1)]),_:1},8,["type"])])):y("",!0)]),_:1}),c(U,{label:"调价原因",prop:"reason"},{default:v(()=>[c(na,{modelValue:_a.reason,"onUpdate:modelValue":a[6]||(a[6]=e=>_a.reason=e),placeholder:"请选择调价原因",style:{width:"100%"}},{default:v(()=>[c(oa,{label:"成本变化",value:"cost_change"}),c(oa,{label:"市场调价",value:"market_adjust"}),c(oa,{label:"促销活动",value:"promotion"}),c(oa,{label:"竞争调价",value:"competition"}),c(oa,{label:"季节调整",value:"seasonal"}),c(oa,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),c(U,{label:"备注",prop:"remark"},{default:v(()=>[c(ua,{modelValue:_a.remark,"onUpdate:modelValue":a[7]||(a[7]=e=>_a.remark=e),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-5974f9a7"]]);export{ia as default};
