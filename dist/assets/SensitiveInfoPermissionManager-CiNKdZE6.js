var w=(E,b,i)=>new Promise((t,v)=>{var C=u=>{try{_(i.next(u))}catch(g){v(g)}},f=u=>{try{_(i.throw(u))}catch(g){v(g)}},_=u=>u.done?t(u.value):Promise.resolve(u.value).then(C,f);_((i=i.apply(E,b)).next())});import{e as Y,l as Z,E as x,b as A}from"./elementPlus-Bmwh7Rh8.js";import{S as p,_ as ee}from"./settings-CuxbDWOu.js";import{l as le,r as y,c as ae,ag as r,m as P,p as h,U as s,O as n,q as c,J as se,T as V,F as B,a9 as D,M,S as m,u as S,Q as ne}from"./vendor-D8Vxqhr-.js";import"./utils-ywHRn0uI.js";const te={class:"sensitive-info-permission-manager"},oe={class:"card-header"},ie={class:"info-type-cell"},re={class:"batch-operations"},ue={class:"batch-controls"},de={class:"save-section"},ce={key:0,class:"permission-detail"},pe={class:"info-description"},me=le({__name:"SensitiveInfoPermissionManager",setup(E){const b=y([]),i=y([{value:"super_admin",label:"超级管理员"},{value:"department_manager",label:"部门经理"},{value:"sales_staff",label:"销售员"},{value:"customer_service",label:"客服"}]),t=y(""),v=y(!1),C=y(!1),f=y(null),_={[p.PHONE]:{name:"手机号码",icon:"Phone",description:"客户的手机号码信息，用于联系和身份验证"},[p.ID_CARD]:{name:"身份证号",icon:"CreditCard",description:"客户的身份证号码，重要的身份识别信息"},[p.EMAIL]:{name:"邮箱地址",icon:"Message",description:"客户的电子邮箱地址，用于邮件通信"},[p.WECHAT]:{name:"微信号",icon:"User",description:"客户的微信号码，用于微信联系"},[p.ADDRESS]:{name:"地址信息",icon:"Location",description:"客户的详细地址信息，包括收货地址等"},[p.BANK_ACCOUNT]:{name:"银行账户",icon:"Wallet",description:"客户的银行账户信息，财务相关敏感数据"},[p.FINANCIAL]:{name:"财务信息",icon:"Wallet",description:"客户的财务状况、收入等敏感财务数据"}},u=()=>{const l=[];Object.values(p).forEach(e=>{const o={};i.value.forEach(d=>{d.value==="super_admin"?o[d.value]=!0:o[d.value]=!1}),l.push({infoType:e,permissions:o})}),b.value=l},g=l=>{var e;return((e=_[l])==null?void 0:e.name)||l},U=l=>{var e;return((e=_[l])==null?void 0:e.icon)||"Document"},$=l=>{var e;return((e=_[l])==null?void 0:e.description)||""},R=(l,e,o)=>{console.log(`权限变更: ${l} - ${e} - ${o}`)},F=l=>{f.value=l,C.value=!0},z=l=>i.value.map(e=>({roleName:e.label,hasPermission:l.permissions[e.value],description:e.value==="super_admin"?"超级管理员拥有所有权限":l.permissions[e.value]?"可以查看此类敏感信息":"无法查看此类敏感信息"})),L=()=>{var l;t.value&&(b.value.forEach(e=>{e.permissions[t.value]=!0}),x.success(`已为${(l=i.value.find(e=>e.value===t.value))==null?void 0:l.label}启用所有敏感信息权限`))},O=()=>{var l;t.value&&A.confirm(`确定要禁用${(l=i.value.find(e=>e.value===t.value))==null?void 0:l.label}的所有敏感信息权限吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e;b.value.forEach(o=>{o.permissions[t.value]=!1}),x.success(`已禁用${(e=i.value.find(o=>o.value===t.value))==null?void 0:e.label}的所有敏感信息权限`)})},W=()=>w(this,null,function*(){v.value=!0;try{yield new Promise(l=>setTimeout(l,1e3)),x.success("权限配置保存成功！")}catch(l){x.error("保存失败，请重试"),console.error("保存权限配置失败:",l)}finally{v.value=!1}}),H=()=>{A.confirm("确定要重置所有权限配置吗？这将恢复到默认设置。","确认重置",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{u(),x.success("权限配置已重置")})};return ae(()=>{u()}),(l,e)=>{const o=r("el-icon"),d=r("el-table-column"),j=r("el-switch"),T=r("el-button"),N=r("el-table"),q=r("el-divider"),J=r("el-option"),K=r("el-select"),Q=r("el-card"),G=r("el-tag"),X=r("el-dialog");return h(),P("div",te,[s(Q,{class:"manager-card"},{header:n(()=>[c("div",oe,[c("h3",null,[s(o,null,{default:n(()=>[s(S(Z))]),_:1}),e[2]||(e[2]=m(" 客户敏感信息权限管理 ",-1))]),e[3]||(e[3]=c("p",{class:"header-description"},"设置不同角色对客户敏感信息的访问权限",-1))])]),default:n(()=>[s(N,{data:b.value,border:"",style:{width:"100%"},class:"permission-table"},{default:n(()=>[s(d,{prop:"infoType",label:"敏感信息类型",width:"150",fixed:"left"},{default:n(({row:a})=>[c("div",ie,[s(o,{class:se(U(a.infoType))},null,8,["class"]),c("span",null,V(g(a.infoType)),1)])]),_:1}),(h(!0),P(B,null,D(i.value,a=>(h(),M(d,{key:a.value,label:a.label,width:"120",align:"center"},{default:n(({row:k})=>[s(j,{modelValue:k.permissions[a.value],"onUpdate:modelValue":I=>k.permissions[a.value]=I,onChange:I=>R(k.infoType,a.value,I),disabled:a.value==="super_admin","active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_:2},1032,["label"]))),128)),s(d,{label:"操作",width:"100",fixed:"right"},{default:n(({row:a})=>[s(T,{type:"primary",size:"small",onClick:k=>F(a),link:""},{default:n(()=>[...e[4]||(e[4]=[m(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),c("div",re,[s(q,{"content-position":"left"},{default:n(()=>[...e[5]||(e[5]=[m("批量操作",-1)])]),_:1}),c("div",ue,[s(K,{modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value=a),placeholder:"选择角色",style:{width:"150px"}},{default:n(()=>[(h(!0),P(B,null,D(i.value.filter(a=>a.value!=="super_admin"),a=>(h(),M(J,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(T,{type:"success",onClick:L,disabled:!t.value},{default:n(()=>[...e[6]||(e[6]=[m(" 全部启用 ",-1)])]),_:1},8,["disabled"]),s(T,{type:"danger",onClick:O,disabled:!t.value},{default:n(()=>[...e[7]||(e[7]=[m(" 全部禁用 ",-1)])]),_:1},8,["disabled"])])]),c("div",de,[s(T,{type:"primary",size:"large",onClick:W,loading:v.value},{default:n(()=>[s(o,null,{default:n(()=>[s(S(Y))]),_:1}),e[8]||(e[8]=m(" 保存权限配置 ",-1))]),_:1},8,["loading"]),s(T,{onClick:H,disabled:v.value},{default:n(()=>[...e[9]||(e[9]=[m(" 重置 ",-1)])]),_:1},8,["disabled"])])]),_:1}),s(X,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=a=>C.value=a),title:"敏感信息权限详情",width:"600px"},{default:n(()=>[f.value?(h(),P("div",ce,[c("h4",null,V(g(f.value.infoType)),1),c("p",pe,V($(f.value.infoType)),1),s(N,{data:z(f.value),border:""},{default:n(()=>[s(d,{prop:"roleName",label:"角色",width:"120"}),s(d,{prop:"hasPermission",label:"权限状态",width:"100"},{default:n(({row:a})=>[s(G,{type:a.hasPermission?"success":"danger"},{default:n(()=>[m(V(a.hasPermission?"有权限":"无权限"),1)]),_:2},1032,["type"])]),_:1}),s(d,{prop:"description",label:"说明"})]),_:1},8,["data"])])):ne("",!0)]),_:1},8,["modelValue"])])}}}),ye=ee(me,[["__scopeId","data-v-3b62d666"]]);export{ye as default};
