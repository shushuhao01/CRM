var S=($,P,k)=>new Promise((w,F)=>{var b=r=>{try{m(k.next(r))}catch(a){F(a)}},T=r=>{try{m(k.throw(r))}catch(a){F(a)}},m=r=>r.done?w(r.value):Promise.resolve(r.value).then(b,T);m((k=k.apply($,P)).next())});import{l as Ce,az as Ve,aC as xe,r as f,Z as W,e as q,c as Se,z as Pe,ag as d,m as h,p as v,q as t,U as s,u,T as l,O as o,S as _,M as B,Q as D,F as R,a9 as E}from"./vendor-D8Vxqhr-.js";import{a3 as Fe,as as Oe,a7 as qe,w as De,ad as Ie,F as X,r as Ue,s as Me,h as Be,a1 as Re,C as Ee,q as $e,E as g}from"./elementPlus-Bmwh7Rh8.js";import{m as ee}from"./phone-DsAzMHsn.js";import{j as Ae,c as ze,_ as He}from"./settings-CuxbDWOu.js";import"./utils-ywHRn0uI.js";const Le={class:"logistics-detail"},je={class:"page-header"},Ye={class:"header-left"},Qe={class:"header-info"},Ze={class:"header-meta"},Ge={class:"tracking-no"},Je={class:"header-actions"},Ke={class:"info-grid"},We={class:"info-item"},Xe={class:"value"},et={class:"info-item"},tt={class:"info-item"},st={class:"value"},ot={class:"info-item"},at={class:"info-item"},lt={class:"value"},it={class:"info-item"},nt={class:"value"},rt={class:"info-item"},dt={class:"value"},ct={class:"info-item"},ut={class:"value"},mt={class:"receiver-info"},pt={class:"receiver-basic"},_t={class:"info-item"},vt={class:"value"},ft={class:"info-item"},ht={class:"value"},gt={class:"info-item"},yt={class:"value"},kt={key:0,class:"info-item"},bt={class:"value"},wt={class:"product-summary"},Tt={class:"summary-item"},Nt={class:"value"},Ct={class:"summary-item"},Vt={class:"value"},xt={class:"summary-item"},St={class:"value"},Pt={class:"card-header"},Ft={class:"tracking-timeline"},Ot={class:"timeline-content"},qt={key:0,class:"timeline-location"},Dt={key:1,class:"timeline-operator"},It={class:"action-buttons"},Ut={class:"related-info"},Mt={class:"related-item"},Bt={class:"item-header"},Rt={class:"item-content"},Et={class:"item-meta"},$t={class:"related-item"},At={class:"item-header"},zt={class:"item-content"},Ht={class:"item-meta"},Lt={class:"related-item"},jt={class:"item-header"},Yt={class:"item-content"},Qt={class:"fee-item"},Zt={class:"fee-item"},Gt={class:"fee-item total"},Jt={class:"operation-log"},Kt={class:"log-time"},Wt={class:"log-content"},Xt={class:"log-operator"},es={class:"log-action"},ts={class:"dialog-footer"},ss=Ce({__name:"Detail",setup($){const P=Ve(),k=xe(),w=ze(P),F=Ae(),b=f(!1),T=f(!1),m=new Set,r=f(!1),a=W({id:"",trackingNo:"",orderNo:"",companyName:"",status:"",shipTime:"",estimatedTime:"",actualTime:"",freight:0,insuranceFee:0,receiverName:"",receiverPhone:"",receiverAddress:"",remark:"",customerName:"",customerPhone:"",orderTime:""}),N=f([]),A=f([]),z=f([]),te=f([{code:"SF",name:"顺丰速运"},{code:"YTO",name:"圆通速递"},{code:"ZTO",name:"中通快递"},{code:"STO",name:"申通快递"},{code:"YD",name:"韵达速递"},{code:"HTKY",name:"百世快递"},{code:"JD",name:"京东物流"},{code:"EMS",name:"中国邮政"}]),p=W({company:"",trackingNo:"",shipTime:"",estimatedTime:"",remark:""}),se={company:[{required:!0,message:"请选择物流公司",trigger:"change"}],trackingNo:[{required:!0,message:"请输入物流单号",trigger:"blur"}],shipTime:[{required:!0,message:"请选择发货时间",trigger:"change"}]},I=f(),oe=q(()=>N.value.reduce((i,e)=>i+e.quantity,0)),ae=q(()=>N.value.reduce((i,e)=>i+e.weight*e.quantity,0).toFixed(2)),le=q(()=>N.value.reduce((i,e)=>i+e.volume*e.quantity,0)),ie=q(()=>(a.freight+(a.insuranceFee||0)).toFixed(2)),H=i=>({pending:"warning",shipped:"primary",in_transit:"info",delivering:"success",delivered:"success",exception:"danger"})[i]||"",L=i=>({pending:"待发货",shipped:"已发货",in_transit:"运输中",delivering:"派送中",delivered:"已签收",exception:"异常"})[i]||i,ne=()=>{P.go(-1)},re=()=>{window.print()},de=()=>{w.push(`/logistics/edit/${a.id}`)},ce=()=>{Object.assign(p,{company:"",trackingNo:"",shipTime:new Date,estimatedTime:"",remark:""}),b.value=!0},ue=()=>S(this,null,function*(){var i;if(!r.value)try{if(yield(i=I.value)==null?void 0:i.validate(),r.value)return;if(T.value=!0,yield new Promise(e=>{const c=setTimeout(()=>{m.delete(c),e(void 0)},1500);m.add(c)}),!r.value){const e=a.orderNo.replace("ORD","");F.syncOrderStatus(e,"shipped","物流员",`订单已发货，快递公司：${p.company}，快递单号：${p.trackingNo}`),g.success("发货成功"),U(),Q()}}catch(e){console.error("表单验证失败:",e)}finally{r.value||(T.value=!1)}}),U=()=>{var i;b.value=!1,(i=I.value)==null||i.clearValidate()},me=()=>{g.success("跳转到物流公司官网跟踪页面...")},pe=()=>{g.success(`拨打电话：${a.receiverPhone}`)},_e=()=>{g.success("投诉建议功能开发中...")},j=()=>{w.push(`/order/detail/${a.orderNo}`)},ve=()=>{w.push(`/customer/detail/${a.customerId}`)},fe=()=>S(this,null,function*(){if(!r.value)try{yield new Promise(i=>{const e=setTimeout(()=>{m.delete(e),i(void 0)},1e3);m.add(e)}),r.value||(g.success("轨迹已刷新"),Y())}catch(i){r.value||g.error("刷新失败")}}),Y=()=>S(this,null,function*(){if(!r.value)try{if(yield new Promise(i=>{const e=setTimeout(()=>{m.delete(e),i(void 0)},500);m.add(e)}),r.value)return;A.value=[{time:"2024-01-12 14:30:00",status:"已签收",description:"您的快件已由本人签收，感谢使用顺丰速运",location:"北京市朝阳区",operator:"张师傅",type:"success"},{time:"2024-01-12 09:15:00",status:"派送中",description:"快件正在派送中，派送员：张师傅，联系电话：138****1234",location:"北京市朝阳区",operator:"张师傅",type:"primary"},{time:"2024-01-12 06:20:00",status:"到达目的地",description:"快件已到达北京朝阳区分拣中心",location:"北京市朝阳区",type:"info"},{time:"2024-01-11 22:45:00",status:"运输中",description:"快件正在从天津转运中心发往北京朝阳区分拣中心",location:"天津市",type:"info"},{time:"2024-01-11 18:30:00",status:"已发货",description:"快件已从上海分拣中心发出",location:"上海市",type:"warning"}]}catch(i){g.error("加载物流轨迹失败")}}),Q=()=>S(this,null,function*(){if(!r.value)try{const i=k.params.id;if(yield new Promise(e=>{const c=setTimeout(()=>{m.delete(c),e(void 0)},800);m.add(c)}),r.value)return;Object.assign(a,{id:i,trackingNo:"SF1234567890123",orderNo:"ORD202401090001",companyName:"顺丰速运",status:"delivered",shipTime:"2024-01-10 09:30:00",estimatedTime:"2024-01-12 18:00:00",actualTime:"2024-01-12 14:30:00",freight:15,insuranceFee:2,receiverName:"张三",receiverPhone:"13800138001",receiverAddress:"北京市朝阳区建国路88号SOHO现代城A座1001室",remark:"请在工作时间配送",customerName:"张三",customerPhone:"13800138001",orderTime:"2024-01-09 15:30:00",customerId:"CUST001"}),N.value=[{productName:"iPhone 15 Pro",specification:"256GB 深空黑色",quantity:1,weight:.2,volume:150},{productName:"AirPods Pro",specification:"第二代",quantity:1,weight:.05,volume:80}],z.value=[{time:"2024-01-12 14:30:00",operator:"系统",action:"订单已签收"},{time:"2024-01-10 09:30:00",operator:"李四",action:"确认发货"},{time:"2024-01-09 16:00:00",operator:"王五",action:"创建物流单"}],yield Y()}catch(i){g.error("加载数据失败")}});return Se(()=>{Q()}),Pe(()=>{r.value=!0,m.forEach(i=>clearTimeout(i)),m.clear()}),(i,e)=>{const c=d("el-button"),Z=d("el-tag"),M=d("el-link"),y=d("el-card"),C=d("el-table-column"),he=d("el-table"),V=d("el-icon"),ge=d("el-timeline-item"),ye=d("el-timeline"),G=d("el-col"),ke=d("el-row"),be=d("el-option"),we=d("el-select"),x=d("el-form-item"),J=d("el-input"),K=d("el-date-picker"),Te=d("el-form"),Ne=d("el-dialog");return v(),h("div",Le,[t("div",je,[t("div",Ye,[s(c,{onClick:ne,icon:u(Fe),circle:""},null,8,["icon"]),t("div",Qe,[e[6]||(e[6]=t("h2",null,"物流详情",-1)),t("div",Ze,[t("span",Ge,l(a.trackingNo),1),s(Z,{type:H(a.status),size:"large"},{default:o(()=>[_(l(L(a.status)),1)]),_:1},8,["type"])])])]),t("div",Je,[s(c,{onClick:re,icon:u(Oe)},{default:o(()=>[...e[7]||(e[7]=[_(" 打印 ",-1)])]),_:1},8,["icon"]),s(c,{onClick:de,type:"primary",icon:u(qe)},{default:o(()=>[...e[8]||(e[8]=[_(" 编辑 ",-1)])]),_:1},8,["icon"]),a.status==="pending"?(v(),B(c,{key:0,onClick:ce,type:"success",icon:u(De)},{default:o(()=>[...e[9]||(e[9]=[_(" 发货 ",-1)])]),_:1},8,["icon"])):D("",!0)])]),s(ke,{gutter:20},{default:o(()=>[s(G,{span:16},{default:o(()=>[s(y,{class:"info-card",title:"基本信息"},{header:o(()=>[...e[10]||(e[10]=[t("div",{class:"card-header"},[t("span",null,"基本信息")],-1)])]),default:o(()=>[t("div",Ke,[t("div",We,[e[11]||(e[11]=t("span",{class:"label"},"物流单号：",-1)),t("span",Xe,l(a.trackingNo),1)]),t("div",et,[e[12]||(e[12]=t("span",{class:"label"},"订单号：",-1)),s(M,{onClick:j,type:"primary",class:"value"},{default:o(()=>[_(l(a.orderNo),1)]),_:1})]),t("div",tt,[e[13]||(e[13]=t("span",{class:"label"},"物流公司：",-1)),t("span",st,l(a.companyName),1)]),t("div",ot,[e[14]||(e[14]=t("span",{class:"label"},"物流状态：",-1)),s(Z,{type:H(a.status),class:"value"},{default:o(()=>[_(l(L(a.status)),1)]),_:1},8,["type"])]),t("div",at,[e[15]||(e[15]=t("span",{class:"label"},"发货时间：",-1)),t("span",lt,l(a.shipTime||"未发货"),1)]),t("div",it,[e[16]||(e[16]=t("span",{class:"label"},"预计送达：",-1)),t("span",nt,l(a.estimatedTime||"未设置"),1)]),t("div",rt,[e[17]||(e[17]=t("span",{class:"label"},"实际送达：",-1)),t("span",dt,l(a.actualTime||"未送达"),1)]),t("div",ct,[e[18]||(e[18]=t("span",{class:"label"},"运费：",-1)),t("span",ut,"¥"+l(a.freight),1)])])]),_:1}),s(y,{class:"info-card"},{header:o(()=>[...e[19]||(e[19]=[t("div",{class:"card-header"},[t("span",null,"收货信息")],-1)])]),default:o(()=>[t("div",mt,[t("div",pt,[t("div",_t,[e[20]||(e[20]=t("span",{class:"label"},"收货人：",-1)),t("span",vt,l(a.receiverName),1)]),t("div",ft,[e[21]||(e[21]=t("span",{class:"label"},"联系电话：",-1)),t("span",ht,l(u(ee)(a.receiverPhone)),1)])]),t("div",gt,[e[22]||(e[22]=t("span",{class:"label"},"收货地址：",-1)),t("span",yt,l(a.receiverAddress),1)]),a.remark?(v(),h("div",kt,[e[23]||(e[23]=t("span",{class:"label"},"备注：",-1)),t("span",bt,l(a.remark),1)])):D("",!0)])]),_:1}),s(y,{class:"info-card"},{header:o(()=>[...e[24]||(e[24]=[t("div",{class:"card-header"},[t("span",null,"商品信息")],-1)])]),default:o(()=>[s(he,{data:N.value,style:{width:"100%"}},{default:o(()=>[s(C,{prop:"productName",label:"商品名称"}),s(C,{prop:"specification",label:"规格",width:"120"}),s(C,{prop:"quantity",label:"数量",width:"80"}),s(C,{prop:"weight",label:"重量(kg)",width:"100"}),s(C,{prop:"volume",label:"体积(cm³)",width:"120"})]),_:1},8,["data"]),t("div",wt,[t("div",Tt,[e[25]||(e[25]=t("span",{class:"label"},"总数量：",-1)),t("span",Nt,l(oe.value)+" 件",1)]),t("div",Ct,[e[26]||(e[26]=t("span",{class:"label"},"总重量：",-1)),t("span",Vt,l(ae.value)+" kg",1)]),t("div",xt,[e[27]||(e[27]=t("span",{class:"label"},"总体积：",-1)),t("span",St,l(le.value)+" cm³",1)])])]),_:1}),s(y,{class:"info-card"},{header:o(()=>[t("div",Pt,[e[29]||(e[29]=t("span",null,"物流轨迹",-1)),s(c,{onClick:fe,icon:u(Ue),size:"small"},{default:o(()=>[...e[28]||(e[28]=[_(" 刷新 ",-1)])]),_:1},8,["icon"])])]),default:o(()=>[t("div",Ft,[s(ye,null,{default:o(()=>[(v(!0),h(R,null,E(A.value,(n,O)=>(v(),B(ge,{key:O,timestamp:n.time,type:n.type,hollow:O!==0},{default:o(()=>[t("div",Ot,[t("h4",null,l(n.status),1),t("p",null,l(n.description),1),n.location?(v(),h("div",qt,[s(V,null,{default:o(()=>[s(u(Ie))]),_:1}),t("span",null,l(n.location),1)])):D("",!0),n.operator?(v(),h("div",Dt,[s(V,null,{default:o(()=>[s(u(X))]),_:1}),t("span",null,l(n.operator),1)])):D("",!0)])]),_:2},1032,["timestamp","type","hollow"]))),128))]),_:1})])]),_:1})]),_:1}),s(G,{span:8},{default:o(()=>[s(y,{class:"action-card"},{header:o(()=>[...e[30]||(e[30]=[t("div",{class:"card-header"},[t("span",null,"快捷操作")],-1)])]),default:o(()=>[t("div",It,[s(c,{onClick:me,type:"primary",icon:u(Me),style:{width:"100%","margin-bottom":"12px"}},{default:o(()=>[...e[31]||(e[31]=[_(" 实时跟踪 ",-1)])]),_:1},8,["icon"]),s(c,{onClick:pe,type:"success",icon:u(Be),style:{width:"100%","margin-bottom":"12px"}},{default:o(()=>[...e[32]||(e[32]=[_(" 联系收货人 ",-1)])]),_:1},8,["icon"]),s(c,{onClick:_e,type:"warning",icon:u(Re),style:{width:"100%","margin-bottom":"12px"}},{default:o(()=>[...e[33]||(e[33]=[_(" 投诉建议 ",-1)])]),_:1},8,["icon"])])]),_:1}),s(y,{class:"related-card"},{header:o(()=>[...e[34]||(e[34]=[t("div",{class:"card-header"},[t("span",null,"相关信息")],-1)])]),default:o(()=>[t("div",Ut,[t("div",Mt,[t("div",Bt,[s(V,null,{default:o(()=>[s(u(Ee))]),_:1}),e[35]||(e[35]=t("span",null,"关联订单",-1))]),t("div",Rt,[s(M,{onClick:j,type:"primary"},{default:o(()=>[_(l(a.orderNo),1)]),_:1}),t("span",Et,l(a.orderTime),1)])]),t("div",$t,[t("div",At,[s(V,null,{default:o(()=>[s(u(X))]),_:1}),e[36]||(e[36]=t("span",null,"客户信息",-1))]),t("div",zt,[s(M,{onClick:ve,type:"primary"},{default:o(()=>[_(l(a.customerName),1)]),_:1}),t("span",Ht,l(u(ee)(a.customerPhone)),1)])]),t("div",Lt,[t("div",jt,[s(V,null,{default:o(()=>[s(u($e))]),_:1}),e[37]||(e[37]=t("span",null,"费用信息",-1))]),t("div",Yt,[t("div",Qt,[t("span",null,"运费：¥"+l(a.freight),1)]),t("div",Zt,[t("span",null,"保价费：¥"+l(a.insuranceFee||"0.00"),1)]),t("div",Gt,[t("span",null,"总计：¥"+l(ie.value),1)])])])])]),_:1}),s(y,{class:"log-card"},{header:o(()=>[...e[38]||(e[38]=[t("div",{class:"card-header"},[t("span",null,"操作日志")],-1)])]),default:o(()=>[t("div",Jt,[(v(!0),h(R,null,E(z.value,(n,O)=>(v(),h("div",{key:O,class:"log-item"},[t("div",Kt,l(n.time),1),t("div",Wt,[t("span",Xt,l(n.operator),1),t("span",es,l(n.action),1)])]))),128))])]),_:1})]),_:1})]),_:1}),s(Ne,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=n=>b.value=n),title:"发货处理",width:"600px","before-close":U},{footer:o(()=>[t("span",ts,[s(c,{onClick:U},{default:o(()=>[...e[39]||(e[39]=[_("取消",-1)])]),_:1}),s(c,{onClick:ue,type:"primary",loading:T.value},{default:o(()=>[...e[40]||(e[40]=[_(" 确认发货 ",-1)])]),_:1},8,["loading"])])]),default:o(()=>[s(Te,{ref_key:"shipFormRef",ref:I,model:p,rules:se,"label-width":"100px"},{default:o(()=>[s(x,{label:"物流公司",prop:"company"},{default:o(()=>[s(we,{modelValue:p.company,"onUpdate:modelValue":e[0]||(e[0]=n=>p.company=n),placeholder:"请选择物流公司",style:{width:"100%"}},{default:o(()=>[(v(!0),h(R,null,E(te.value,n=>(v(),B(be,{key:n.code,label:n.name,value:n.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(x,{label:"物流单号",prop:"trackingNo"},{default:o(()=>[s(J,{modelValue:p.trackingNo,"onUpdate:modelValue":e[1]||(e[1]=n=>p.trackingNo=n),placeholder:"请输入物流单号"},null,8,["modelValue"])]),_:1}),s(x,{label:"发货时间",prop:"shipTime"},{default:o(()=>[s(K,{modelValue:p.shipTime,"onUpdate:modelValue":e[2]||(e[2]=n=>p.shipTime=n),type:"datetime",placeholder:"选择发货时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),s(x,{label:"预计送达",prop:"estimatedTime"},{default:o(()=>[s(K,{modelValue:p.estimatedTime,"onUpdate:modelValue":e[3]||(e[3]=n=>p.estimatedTime=n),type:"datetime",placeholder:"选择预计送达时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),s(x,{label:"备注",prop:"remark"},{default:o(()=>[s(J,{modelValue:p.remark,"onUpdate:modelValue":e[4]||(e[4]=n=>p.remark=n),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),ds=He(ss,[["__scopeId","data-v-55f56de2"]]);export{ds as default};
