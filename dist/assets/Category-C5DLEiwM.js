var x=(F,u,f)=>new Promise((C,i)=>{var b=a=>{try{r(f.next(a))}catch(V){i(V)}},y=a=>{try{r(f.throw(a))}catch(V){i(V)}},r=a=>a.done?C(a.value):Promise.resolve(a.value).then(b,y);r((f=f.apply(F,u)).next())});import{l as oe,r as U,Z as M,e as N,c as se,ag as n,aq as ne,m as O,p as v,q as m,U as t,O as o,S as d,u as D,a7 as re,P as de,M as w,T as R,Q as ie,F as ue,a9 as pe}from"./vendor-D8Vxqhr-.js";import{p as me,U as ce,C as fe,E as c,b as ge}from"./elementPlus-Bmwh7Rh8.js";import{u as _e}from"./product-DLyzXkG9.js";import{_ as ve}from"./settings-CuxbDWOu.js";import"./utils-ywHRn0uI.js";const be={class:"category-container"},ye={class:"page-header"},Ce={class:"header-actions"},Ve={class:"search-section"},he={class:"table-section"},ke={class:"category-name"},xe={class:"dialog-footer"},Ue=oe({__name:"Category",setup(F){const u=_e(),f=U(!1),C=U(!1),i=U(!1),b=U("新增分类"),y=U(),r=M({name:"",status:""}),a=M({id:null,parentId:"0",name:"",code:"",sort:0,status:1,description:""}),V={name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{min:2,max:50,message:"分类名称长度在 2 到 50 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入分类编码",trigger:"blur"},{pattern:/^[A-Za-z0-9_-]+$/,message:"分类编码只能包含字母、数字、下划线和横线",trigger:"blur"}],sort:[{required:!0,message:"请输入排序值",trigger:"blur"}]},A=N(()=>u.categories),L=N(()=>u.categories.filter(s=>s.level===1)),$=()=>x(this,null,function*(){f.value=!0;try{yield u.loadCategories(),console.log("分类数据加载完成")}catch(s){console.error("加载数据失败:",s),c.error("加载分类数据失败")}finally{f.value=!1}}),T=()=>{console.log("搜索分类:",r),$()},j=()=>{r.name="",r.status="",$()},K=()=>{b.value="新增分类",B(),i.value=!0},P=s=>{b.value="新增子分类",B(),a.parentId=s.id,i.value=!0},Z=s=>{b.value="编辑分类",Object.assign(a,{id:s.id,parentId:s.parentId,name:s.name,code:s.code,sort:s.sort,status:s.status,description:s.description||""}),i.value=!0},Q=s=>x(this,null,function*(){if(s.productCount&&s.productCount>0){c.warning("该分类下有商品，无法删除");return}try{yield ge.confirm(`确定要删除分类"${s.name}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield u.deleteCategory(s.id.toString()),c.success("删除成功")}catch(e){e!=="cancel"&&(console.error("删除失败:",e),c.error("删除失败"))}}),G=s=>x(this,null,function*(){const e=s.status;try{yield u.updateCategory(s.id.toString(),{status:s.status}),c.success(`${s.status?"启用":"禁用"}成功`)}catch(h){s.status=e,console.error("状态更新失败:",h),c.error("状态更新失败")}}),H=()=>x(this,null,function*(){if(y.value)try{if(yield y.value.validate(),C.value=!0,a.id)yield u.updateCategory(a.id.toString(),{name:a.name,code:a.code,sort:a.sort,status:a.status}),c.success("编辑成功");else{const s={name:a.name,code:a.code,level:a.parentId==="0"?1:2,parentId:a.parentId,productCount:0,sort:a.sort,status:a.status};yield u.addCategory(s),c.success("新增成功")}i.value=!1}catch(s){console.error("操作失败:",s),c.error("操作失败，请重试")}finally{C.value=!1}}),J=()=>{var s;(s=y.value)==null||s.resetFields(),B()},B=()=>{Object.assign(a,{id:null,parentId:0,name:"",code:"",sort:0,status:1,description:""})};return se(()=>{$()}),(s,e)=>{const h=n("el-icon"),g=n("el-button"),I=n("el-input"),p=n("el-form-item"),S=n("el-option"),q=n("el-select"),z=n("el-form"),_=n("el-table-column"),W=n("el-tag"),X=n("el-switch"),Y=n("el-table"),ee=n("el-input-number"),E=n("el-radio"),te=n("el-radio-group"),le=n("el-dialog"),ae=ne("loading");return v(),O("div",be,[m("div",ye,[e[11]||(e[11]=m("div",{class:"header-left"},[m("h1",{class:"page-title"},"商品分类管理"),m("p",{class:"page-description"},"管理商品分类，支持多级分类结构")],-1)),m("div",Ce,[t(g,{type:"primary",onClick:K},{default:o(()=>[t(h,null,{default:o(()=>[t(D(me))]),_:1}),e[10]||(e[10]=d(" 新增分类 ",-1))]),_:1})])]),m("div",Ve,[t(z,{model:r,inline:""},{default:o(()=>[t(p,{label:"分类名称"},{default:o(()=>[t(I,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=l=>r.name=l),placeholder:"请输入分类名称",clearable:"",onKeyup:re(T,["enter"])},null,8,["modelValue"])]),_:1}),t(p,{label:"状态"},{default:o(()=>[t(q,{modelValue:r.status,"onUpdate:modelValue":e[1]||(e[1]=l=>r.status=l),placeholder:"请选择状态",clearable:""},{default:o(()=>[t(S,{label:"启用",value:"1"}),t(S,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),t(p,null,{default:o(()=>[t(g,{type:"primary",onClick:T},{default:o(()=>[...e[12]||(e[12]=[d("搜索",-1)])]),_:1}),t(g,{onClick:j},{default:o(()=>[...e[13]||(e[13]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),m("div",he,[de((v(),w(Y,{data:A.value,"row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},stripe:"",border:""},{default:o(()=>[t(_,{prop:"name",label:"分类名称","min-width":"200"},{default:o(({row:l})=>[m("div",ke,[l.level===1?(v(),w(h,{key:0,class:"level-icon"},{default:o(()=>[t(D(ce))]),_:1})):(v(),w(h,{key:1,class:"level-icon"},{default:o(()=>[t(D(fe))]),_:1})),d(" "+R(l.name),1)])]),_:1}),t(_,{prop:"code",label:"分类编码",width:"120"}),t(_,{prop:"level",label:"层级",width:"80"},{default:o(({row:l})=>[t(W,{type:l.level===1?"primary":"success",size:"small"},{default:o(()=>[d(R(l.level===1?"一级":"二级"),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"productCount",label:"商品数量",width:"100",align:"center"}),t(_,{prop:"sort",label:"排序",width:"80",align:"center"}),t(_,{prop:"status",label:"状态",width:"80",align:"center"},{default:o(({row:l})=>[t(X,{modelValue:l.status,"onUpdate:modelValue":k=>l.status=k,"active-value":1,"inactive-value":0,onChange:k=>G(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(_,{prop:"createTime",label:"创建时间",width:"160"}),t(_,{label:"操作",width:"200",fixed:"right"},{default:o(({row:l})=>[l.level===1?(v(),w(g,{key:0,type:"primary",size:"small",link:"",onClick:k=>P(l)},{default:o(()=>[...e[14]||(e[14]=[d(" 添加子分类 ",-1)])]),_:1},8,["onClick"])):ie("",!0),t(g,{type:"primary",size:"small",link:"",onClick:k=>Z(l)},{default:o(()=>[...e[15]||(e[15]=[d(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(g,{type:"danger",size:"small",link:"",onClick:k=>Q(l),disabled:l.productCount>0},{default:o(()=>[...e[16]||(e[16]=[d(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[ae,f.value]])]),t(le,{modelValue:i.value,"onUpdate:modelValue":e[9]||(e[9]=l=>i.value=l),title:b.value,width:"600px",onClose:J},{footer:o(()=>[m("div",xe,[t(g,{onClick:e[8]||(e[8]=l=>i.value=!1)},{default:o(()=>[...e[19]||(e[19]=[d("取消",-1)])]),_:1}),t(g,{type:"primary",onClick:H,loading:C.value},{default:o(()=>[...e[20]||(e[20]=[d(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:o(()=>[t(z,{ref_key:"formRef",ref:y,model:a,rules:V,"label-width":"100px"},{default:o(()=>[t(p,{label:"上级分类",prop:"parentId"},{default:o(()=>[t(q,{modelValue:a.parentId,"onUpdate:modelValue":e[2]||(e[2]=l=>a.parentId=l),placeholder:"请选择上级分类（不选则为一级分类）",clearable:"",style:{width:"100%"}},{default:o(()=>[t(S,{label:"无（一级分类）",value:0}),(v(!0),O(ue,null,pe(L.value,l=>(v(),w(S,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"分类名称",prop:"name"},{default:o(()=>[t(I,{modelValue:a.name,"onUpdate:modelValue":e[3]||(e[3]=l=>a.name=l),placeholder:"请输入分类名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(p,{label:"分类编码",prop:"code"},{default:o(()=>[t(I,{modelValue:a.code,"onUpdate:modelValue":e[4]||(e[4]=l=>a.code=l),placeholder:"请输入分类编码",maxlength:"20"},null,8,["modelValue"])]),_:1}),t(p,{label:"排序",prop:"sort"},{default:o(()=>[t(ee,{modelValue:a.sort,"onUpdate:modelValue":e[5]||(e[5]=l=>a.sort=l),min:0,max:999,"controls-position":"right",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),t(p,{label:"状态",prop:"status"},{default:o(()=>[t(te,{modelValue:a.status,"onUpdate:modelValue":e[6]||(e[6]=l=>a.status=l)},{default:o(()=>[t(E,{label:1},{default:o(()=>[...e[17]||(e[17]=[d("启用",-1)])]),_:1}),t(E,{label:0},{default:o(()=>[...e[18]||(e[18]=[d("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"描述",prop:"description"},{default:o(()=>[t(I,{modelValue:a.description,"onUpdate:modelValue":e[7]||(e[7]=l=>a.description=l),type:"textarea",rows:3,placeholder:"请输入分类描述",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Fe=ve(Ue,[["__scopeId","data-v-f50eb139"]]);export{Fe as default};
