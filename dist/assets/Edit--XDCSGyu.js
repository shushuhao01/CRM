const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DkAJPKqn.js","assets/vendor-BtukhyiH.js","assets/elementPlus-DxaqjplL.js","assets/utils-DfI7e5Rl.js","assets/index-Cj-RrGL6.css","assets/uploadService-C3xZb1GB.js"])))=>i.map(i=>d[i]);
import{d as e,i as a,u as l,a as t,l as o,c as s,_ as r}from"./index-DkAJPKqn.js";import{l as n,aC as u,aA as d,r as i,Z as c,e as p,b as m,Y as v,ag as h,m as f,q as y,p as b,U as g,M as _,Q as w,O as k,u as V,F as C,a9 as A,J as x,P as S,S as I,V as U,T,a2 as P}from"./vendor-BtukhyiH.js";import{E as M,u as N,m as z,J as q,d as O,C as E,N as F,r as W,F as j,A as L,$,b as B}from"./elementPlus-DxaqjplL.js";import{u as D}from"./product-BDuYhoXd.js";import"./utils-DfI7e5Rl.js";import"./env-DLalhsF6.js";const R={class:"order-edit-page"},Y={class:"form-section"},J={class:"section-header"},Q={key:0,class:"form-section"},Z={class:"header-left"},G={class:"header-right"},H={class:"phone-management"},K={class:"form-section"},X={class:"section-header"},ee={class:"header-left"},ae={class:"header-right"},le={class:"product-search"},te={class:"product-container"},oe={class:"product-list"},se=["onClick"],re={class:"product-image"},ne=["src","alt"],ue={class:"product-info"},de={class:"product-name"},ie={class:"product-price"},ce={class:"product-stock"},pe={class:"product-actions"},me={class:"form-section"},ve={class:"section-header"},he={key:0,class:"selected-products"},fe={key:1,class:"empty-products"},ye={class:"amount-summary-modern"},be={class:"amount-row"},ge={class:"amount-field"},_e={class:"field-amount subtotal"},we={class:"amount-field"},ke={class:"field-label"},Ve={class:"amount-field"},Ce={class:"amount-field"},Ae={class:"payment-method-wrapper"},xe={class:"amount-row"},Se={class:"amount-field"},Ie={class:"field-amount collect"},Ue={class:"amount-field"},Te={class:"discount-horizontal"},Pe={class:"field-amount discount"},Me={key:0,class:"discount-percent"},Ne={class:"amount-field screenshot-field"},ze={class:"screenshot-buttons"},qe={class:"screenshot-content"},Oe={key:0,class:"screenshot-thumbnails"},Ee=["onMouseenter","onClick"],Fe=["src"],We={class:"thumbnail-overlay"},je=["onClick"],Le={class:"mark-section"},$e={class:"mark-description"},Be={class:"remark-section"},De={class:"form-footer"},Re={class:"customer-search"},Ye={class:"customer-list"},Je={class:"dialog-footer"},Qe={class:"confirm-content"},Ze={class:"confirm-section"},Ge={class:"info-grid"},He={class:"info-item"},Ke={class:"value"},Xe={class:"info-item"},ea={class:"value"},aa={class:"info-item"},la={class:"value"},ta={class:"info-item"},oa={class:"value"},sa={class:"info-item"},ra={key:0,class:"info-item"},na={class:"value"},ua={class:"confirm-section"},da={class:"amount-summary-two-columns"},ia={class:"amount-column basic-amounts"},ca={class:"amount-item"},pa={class:"value"},ma={class:"amount-item"},va={class:"discount-info"},ha={class:"value discount"},fa={key:0,class:"discount-percent"},ya={class:"amount-column important-amounts"},ba={class:"amount-item total-amount"},ga={class:"value"},_a={class:"amount-item deposit-amount"},wa={class:"value"},ka={class:"amount-item collect-amount"},Va={class:"value"},Ca={class:"confirm-section"},Aa={class:"dialog-footer"},xa=r(n({name:"OrderEdit",__name:"Edit",setup(r){const n=u(),xa=d(),Sa=s(xa),Ia=e(),Ua=a(),Ta=D(),Pa=l(),Ma=t(),Na=n.params.id,za=i(!1),qa=i(""),Oa=i([]),Ea=i(""),Fa=i(""),Wa=i([]),ja=i([]),La=i(!1),$a=i(!1),Ba=i(!1),Da=i(!1),Ra=i([]);i("");const Ya=i(null),Ja=i([]),Qa=i(-1),Za=i(null),Ga=i(!1),Ha=i([]),Ka=i(!1),Xa=c({id:null,customerId:null,customerName:"",customerPhone:"",deliveryAddress:"",deliveryTime:"",receiverName:"",receiverPhone:"",expressCompany:"",serviceWechat:"",orderSource:"",products:[],subtotal:0,totalAmount:0,depositAmount:0,collectedAmount:0,discountAmount:0,depositScreenshot:"",paymentMethod:"",paymentMethodOther:"",orderType:"normal",remarks:""}),el=i([{label:"å¾®ä¿¡æ”¯ä»˜",value:"wechat"},{label:"æ”¯ä»˜å®æ”¯ä»˜",value:"alipay"},{label:"é“¶è¡Œè½¬è´¦",value:"bank_transfer"},{label:"äº‘é—ªä»˜",value:"unionpay"},{label:"è´§åˆ°ä»˜æ¬¾",value:"cod"},{label:"å…¶ä»–",value:"other"}]),al=e=>{"other"!==e&&(Xa.paymentMethodOther="")},ll=c({phone:""}),tl=p(()=>Xa.products.reduce((e,a)=>e+(a.price||0)*(a.quantity||0),0)),ol=p(()=>(Xa.totalAmount||0)-(Xa.depositAmount||0)),sl=p(()=>tl.value-(Xa.totalAmount||0)),rl=p(()=>tl.value>0&&sl.value>0?sl.value/tl.value*100:0),nl=p(()=>{const e=Pa.currentUser?.role||"employee",a="employee"===e?"sales":e;let l=0;return l="admin"===a||"super_admin"===a?Ma.productConfig.adminMaxDiscount:"department_manager"===a||"manager"===a?Ma.productConfig.managerMaxDiscount:"sales"===a?Ma.productConfig.salesMaxDiscount:0,l/100}),ul=p(()=>Ea.value?Ta.products.filter(e=>"active"===e.status&&(e.name.toLowerCase().includes(Ea.value.toLowerCase())||e.code?.toLowerCase().includes(Ea.value.toLowerCase()))):Ta.products.filter(e=>"active"===e.status)),dl=p(()=>Ua.customers.filter(e=>!e.deleted));m(async()=>{await Ua.loadCustomers(),(async()=>{Ka.value=!0;try{const{apiService:e}=await o(async()=>{const{apiService:e}=await import("./index-DkAJPKqn.js").then(e=>e.Q);return{apiService:e}},__vite__mapDeps([0,1,2,3,4])),a=await e.get("/logistics/companies/active");a&&Array.isArray(a)&&(Ha.value=a.map(e=>({code:e.code,name:e.shortName||e.name,logo:e.logo})))}catch(e){console.warn("åŠ è½½ç‰©æµå…¬å¸åˆ—è¡¨å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤åˆ—è¡¨:",e),Ha.value=[{code:"SF",name:"é¡ºä¸°é€Ÿè¿"},{code:"YTO",name:"åœ†é€šé€Ÿé€’"},{code:"ZTO",name:"ä¸­é€šå¿«é€’"},{code:"STO",name:"ç”³é€šå¿«é€’"},{code:"YD",name:"éŸµè¾¾é€Ÿé€’"}]}finally{Ka.value=!1}})(),(async()=>{try{const e=localStorage.getItem("auth_token"),a=await fetch("/api/v1/system/payment-methods",{headers:{Authorization:`Bearer ${e}`}}),l=await a.json();l.success&&l.data&&l.data.length>0&&(el.value=l.data.map(e=>({label:e.label,value:e.value})))}catch(e){console.warn("åŠ è½½æ”¯ä»˜æ–¹å¼å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:",e)}})(),await pl(),window.addEventListener("orderUpdated",il),window.addEventListener("orderStatusUpdated",cl)}),v(()=>{window.removeEventListener("orderUpdated",il),window.removeEventListener("orderStatusUpdated",cl)});const il=e=>{const{orderId:a}=e.detail;a===Na&&(pl(),M.success("è®¢å•æ•°æ®å·²åŒæ­¥æ›´æ–°"))},cl=e=>{const{orderId:a}=e.detail;a===Na&&(pl(),M.info("è®¢å•çŠ¶æ€å·²æ›´æ–°"))},pl=async()=>{try{const e=Ia.getOrderById(Na);e&&(Object.assign(Xa,{id:e.id,customerId:e.customerId,customerName:e.customerName,customerPhone:e.customerPhone,receiverName:e.receiverName||"",receiverPhone:e.receiverPhone||"",deliveryAddress:e.deliveryAddress||"",deliveryTime:e.deliveryTime||"",expressCompany:e.expressCompany||"",serviceWechat:e.serviceWechat||"",orderSource:e.orderSource||"",products:e.products||[],subtotal:e.subtotal||0,totalAmount:e.totalAmount||0,depositAmount:e.depositAmount||0,collectedAmount:e.collectedAmount||0,discountAmount:e.discountAmount||0,depositScreenshot:e.depositScreenshot||"",paymentMethod:e.paymentMethod||"",paymentMethodOther:e.paymentMethodOther||"",orderType:e.orderType||"normal",remarks:e.remarks||""}),e.customerId&&await Cl(e.customerId),e.depositScreenshots&&Array.isArray(e.depositScreenshots)?Ja.value=[...e.depositScreenshots]:e.depositScreenshot?Ja.value=[e.depositScreenshot]:Ja.value=[],ml())}catch(e){console.error("åŠ è½½è®¢å•æ•°æ®å¤±è´¥:",e),M.error("åŠ è½½è®¢å•æ•°æ®å¤±è´¥"),zl()}},ml=()=>{Xa.products.forEach(e=>{e.subtotal=e.quantity*e.price}),Xa.subtotal=Xa.products.reduce((e,a)=>e+a.subtotal,0),vl()},vl=()=>{Xa.totalAmount=Xa.subtotal-Xa.discountAmount,Xa.collectedAmount=Xa.depositAmount},hl=()=>{},fl=async e=>{if(e){const a=Ua.getCustomerById(e);a&&(Za.value=a,Xa.customerName=a.name,Xa.customerPhone=a.phone,Xa.deliveryAddress=a.address||"",Xa.receiverName=a.name,Xa.receiverPhone=a.phone,Xa.serviceWechat=a.wechatId||"",Xa.orderSource=a.source||"",Ga.value=!1,await Cl(e))}else Za.value=null,Xa.customerName="",Xa.customerPhone="",Xa.deliveryAddress="",Xa.receiverName="",Xa.receiverPhone="",Xa.serviceWechat="",Xa.orderSource="",ja.value=[]},yl=()=>{Ta.refreshProducts(),M.success("äº§å“åˆ—è¡¨å·²åˆ·æ–°")},bl=e=>{if(null==e)return;const a=tl.value*(1-nl.value);e<a?B.alert(`è®¢å•æ€»é¢ä¸èƒ½ä½ŽäºŽ Â¥${a.toFixed(2)}ï¼ˆæœ€å¤§ä¼˜æƒ ${(100*nl.value).toFixed(0)}%ï¼‰`,"ä¼˜æƒ é™åˆ¶æç¤º",{confirmButtonText:"ç¡®å®š",type:"warning",callback:()=>{Xa.totalAmount=a,gl()}}):e>tl.value?B.alert("è®¢å•æ€»é¢ä¸èƒ½è¶…è¿‡å•†å“å°è®¡","æç¤º",{confirmButtonText:"ç¡®å®š",type:"warning",callback:()=>{Xa.totalAmount=tl.value,gl()}}):((Xa.depositAmount||0)>e&&(Xa.depositAmount=e,M.info("å®šé‡‘å·²è‡ªåŠ¨è°ƒæ•´ä¸ºè®¢å•æ€»é¢")),Xa.totalAmount=e,gl())},gl=()=>{Xa.collectedAmount=(Xa.totalAmount||0)-(Xa.depositAmount||0)},_l=()=>{Xa.totalAmount=tl.value,gl()},wl=p(()=>Math.abs((Xa.totalAmount||0)-tl.value)>.01),kl=async()=>{if(Fa.value.trim())try{Wa.value=await Ua.searchCustomers(Fa.value)}catch(e){console.error("æœç´¢å®¢æˆ·å¤±è´¥:",e),Wa.value=[]}else Wa.value=[]},Vl=async e=>{Xa.customerId=e.id,Xa.customerName=e.name,Xa.customerPhone=e.phone,Xa.deliveryAddress=e.address||"",Xa.receiverName=e.name,Xa.receiverPhone=e.phone,Xa.serviceWechat=e.wechatId||"",Xa.orderSource=e.source||"",Ga.value=!1,await Cl(e.id),La.value=!1},Cl=async e=>{try{const a=await Ua.getCustomerPhones(e);ja.value=a||[]}catch(a){console.error("åŠ è½½å®¢æˆ·ç”µè¯å¤±è´¥:",a),ja.value=[]}},Al=async()=>{if(ll.phone.trim())try{await Ua.addCustomerPhone(Xa.customerId,ll.phone),ja.value.push(ll.phone),Xa.customerPhone=ll.phone,ll.phone="",$a.value=!1,M.success("æ·»åŠ ç”µè¯å·ç æˆåŠŸ")}catch(e){console.error("æ·»åŠ ç”µè¯å·ç å¤±è´¥:",e),M.error("æ·»åŠ ç”µè¯å·ç å¤±è´¥")}else M.warning("è¯·è¾“å…¥ç”µè¯å·ç ")},xl=()=>{Ya.value?.click()},Sl=e=>{const a=e.target.files;if(a&&a.length>0){for(let e=0;e<a.length;e++){if(Ja.value.length>=3){M.warning("æœ€å¤šåªèƒ½ä¸Šä¼ 3å¼ å›¾ç‰‡");break}Ul(a[e])}e.target.value=""}},Il=async()=>{if(Ja.value.length>=3)M.warning("æœ€å¤šåªèƒ½ä¸Šä¼ 3å¼ å›¾ç‰‡");else try{const e=await navigator.clipboard.read();for(const a of e)for(const e of a.types)if(e.startsWith("image/")){const l=await a.getType(e),t=new File([l],"pasted-image.png",{type:e});return void Ul(t)}M.warning("å‰ªè´´æ¿ä¸­æ²¡æœ‰å›¾ç‰‡")}catch(e){M.error("ç²˜è´´å›¾ç‰‡å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™")}},Ul=async e=>{if(Tl(e))if(Ja.value.length>=3)M.warning("æœ€å¤šåªèƒ½ä¸Šä¼ 3å¼ å›¾ç‰‡");else try{const{uploadImage:a}=await o(async()=>{const{uploadImage:e}=await import("./uploadService-C3xZb1GB.js");return{uploadImage:e}},__vite__mapDeps([5,0,1,2,3,4])),l=await a(e,"order");l.success&&l.url?(Ja.value.push(l.url),Xa.depositScreenshot=Ja.value[0]||"",M.success("å›¾ç‰‡ä¸Šä¼ æˆåŠŸ")):M.error(l.message||"å›¾ç‰‡ä¸Šä¼ å¤±è´¥")}catch(a){console.error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥:",a),M.error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•")}},Tl=e=>{const a=e.type.startsWith("image/"),l=e.size/1024/1024<2;return a?!!l||(M.error("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 2MB!"),!1):(M.error("åªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶!"),!1)},Pl=()=>{Xa.customerName?0!==Xa.products.length?Ba.value=!0:M.warning("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªäº§å“"):M.warning("è¯·é€‰æ‹©å®¢æˆ·")},Ml=async()=>{za.value=!0;try{const e={...Xa,depositScreenshots:Ja.value,depositScreenshot:Ja.value[0]||""};await Ia.updateOrder(Na,e),M.success("è®¢å•æ›´æ–°æˆåŠŸ"),Ba.value=!1,setTimeout(()=>{Sa.push("/order/list")},1e3)}catch(e){console.error("æ›´æ–°è®¢å•å¤±è´¥:",e),M.error("æ›´æ–°è®¢å•å¤±è´¥")}finally{za.value=!1}},Nl=async()=>{try{await B.confirm("ç¡®å®šè¦å–æ¶ˆå—ï¼Ÿæœªä¿å­˜çš„æ•°æ®å°†ä¸¢å¤±","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"ç»§ç»­ç¼–è¾‘",type:"warning"}),Sa.push("/order/list")}catch(e){}},zl=()=>{xa.back()},ql=()=>{La.value=!1,Fa.value="",Wa.value=[]},Ol=()=>{Ba.value=!1};return(e,a)=>{const l=h("el-icon"),t=h("el-option"),o=h("el-select"),s=h("el-form-item"),r=h("el-col"),n=h("el-input"),u=h("el-row"),d=h("el-button"),i=h("el-collapse-transition"),c=h("Money"),p=h("el-table-column"),m=h("el-input-number"),v=h("el-table"),B=h("el-empty"),D=h("el-tooltip"),xa=h("el-tag"),Ia=h("el-radio"),Ua=h("el-radio-group"),Ta=h("el-alert"),Pa=h("el-form"),Ma=h("el-dialog"),Na=h("el-image-viewer");return y(),f("div",R,[a[66]||(a[66]=b("div",{class:"page-header"},[b("h2",{class:"page-title"},"ç¼–è¾‘è®¢å•")],-1)),g(Pa,{model:Xa,rules:e.formRules,ref:"orderFormRef","label-width":"120px",class:"order-form"},{default:k(()=>[b("div",Y,[b("div",J,[g(l,null,{default:k(()=>[g(V(N))]),_:1}),a[24]||(a[24]=b("span",null,"å®¢æˆ·ä¿¡æ¯",-1))]),g(u,{gutter:20},{default:k(()=>[g(r,{span:8},{default:k(()=>[g(s,{label:"é€‰æ‹©å®¢æˆ·",prop:"customerId",required:""},{default:k(()=>[g(o,{modelValue:Xa.customerId,"onUpdate:modelValue":a[0]||(a[0]=e=>Xa.customerId=e),placeholder:"è¯·é€‰æ‹©å®¢æˆ·",style:{width:"100%"},filterable:"",onChange:fl,size:"large"},{default:k(()=>[(y(!0),f(C,null,A(dl.value,e=>(y(),_(t,{key:e.id,label:`${e.name} (${e.phone})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),g(r,{span:8},{default:k(()=>[g(s,{label:"å®¢æœå¾®ä¿¡å·",prop:"serviceWechat",required:""},{default:k(()=>[g(n,{modelValue:Xa.serviceWechat,"onUpdate:modelValue":a[1]||(a[1]=e=>Xa.serviceWechat=e),placeholder:"è¯·è¾“å…¥è´Ÿè´£å®¢æœçš„å¾®ä¿¡å·",clearable:""},{prefix:k(()=>[g(l,null,{default:k(()=>[g(V(z))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),g(r,{span:8},{default:k(()=>[g(s,{label:"è®¢å•æ¥æº",prop:"orderSource",required:""},{default:k(()=>[g(o,{modelValue:Xa.orderSource,"onUpdate:modelValue":a[2]||(a[2]=e=>Xa.orderSource=e),placeholder:"è¯·é€‰æ‹©è®¢å•æ¥æº",style:{width:"100%"}},{default:k(()=>[g(t,{label:"ðŸ›’ çº¿ä¸Šå•†åŸŽ",value:"online_store"}),g(t,{label:"ðŸ“± å¾®ä¿¡å°ç¨‹åº",value:"wechat_mini"}),g(t,{label:"ðŸ’¬ å¾®ä¿¡å®¢æœ",value:"wechat_service"}),g(t,{label:"ðŸ“ž ç”µè¯å’¨è¯¢",value:"phone_call"}),g(t,{label:"ðŸª çº¿ä¸‹é—¨åº—",value:"offline_store"}),g(t,{label:"ðŸ‘¥ å®¢æˆ·æŽ¨è",value:"referral"}),g(t,{label:"ðŸ“º å¹¿å‘ŠæŠ•æ”¾",value:"advertisement"}),g(t,{label:"ðŸŽ¯ å…¶ä»–æ¸ é“",value:"other"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),Za.value?(y(),f("div",Q,[b("div",{class:"section-header",onClick:a[3]||(a[3]=e=>Ga.value=!Ga.value),style:{cursor:"pointer"}},[b("div",Z,[g(l,null,{default:k(()=>[g(V(q))]),_:1}),a[25]||(a[25]=b("span",null,"æ”¶è´§ä¿¡æ¯",-1))]),b("div",G,[g(l,{class:x(["collapse-icon",{collapsed:Ga.value}])},{default:k(()=>[g(V(O))]),_:1},8,["class"])])]),g(i,null,{default:k(()=>[S(b("div",null,[g(u,{gutter:20},{default:k(()=>[g(r,{span:6},{default:k(()=>[g(s,{label:"æ”¶è´§äºº",prop:"receiverName"},{default:k(()=>[g(n,{modelValue:Xa.receiverName,"onUpdate:modelValue":a[4]||(a[4]=e=>Xa.receiverName=e),placeholder:"è¯·è¾“å…¥æ”¶è´§äººå§“å",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),g(r,{span:12},{default:k(()=>[g(s,{label:"æ”¶è´§ç”µè¯",prop:"receiverPhone"},{default:k(()=>[b("div",H,[g(o,{modelValue:Xa.receiverPhone,"onUpdate:modelValue":a[5]||(a[5]=e=>Xa.receiverPhone=e),placeholder:"è¯·é€‰æ‹©æ”¶è´§ç”µè¯",style:{width:"100%"},clearable:""},{default:k(()=>[(y(!0),f(C,null,A(ja.value,e=>(y(),_(t,{key:e.id,label:e.number,value:e.number},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),g(d,{type:"primary",size:"small",onClick:a[6]||(a[6]=e=>$a.value=!0),style:{"margin-left":"8px"},icon:V(E)},{default:k(()=>[...a[26]||(a[26]=[I(" æ–°å¢ž ",-1)])]),_:1},8,["icon"])])]),_:1})]),_:1}),g(r,{span:6},{default:k(()=>[g(s,{label:"æŒ‡å®šå¿«é€’",prop:"expressCompany",required:""},{default:k(()=>[g(o,{modelValue:Xa.expressCompany,"onUpdate:modelValue":a[7]||(a[7]=e=>Xa.expressCompany=e),placeholder:"è¯·é€‰æ‹©å¿«é€’å…¬å¸",style:{width:"100%"},loading:Ka.value},{default:k(()=>[(y(!0),f(C,null,A(Ha.value,e=>(y(),_(t,{key:e.code,label:e.name,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1})],512),[[U,!Ga.value]])]),_:1})])):w("",!0),b("div",K,[b("div",X,[b("div",ee,[g(l,null,{default:k(()=>[g(V(F))]),_:1}),a[27]||(a[27]=b("span",null,"äº§å“é€‰æ‹©",-1))]),b("div",ae,[g(d,{type:"primary",size:"small",icon:V(W),onClick:yl,title:"åˆ·æ–°å•†å“åˆ—è¡¨"},{default:k(()=>[...a[28]||(a[28]=[I(" åˆ·æ–° ",-1)])]),_:1},8,["icon"])])]),b("div",le,[g(n,{modelValue:Ea.value,"onUpdate:modelValue":a[8]||(a[8]=e=>Ea.value=e),placeholder:"æœç´¢äº§å“åç§°ã€ç¼–å·...",size:"large",clearable:"",onInput:hl},{prefix:k(()=>[g(l,null,{default:k(()=>[g(V(j))]),_:1})]),_:1},8,["modelValue"])]),b("div",te,[b("div",oe,[(y(!0),f(C,null,A(ul.value,l=>(y(),f("div",{key:l.id,class:"product-item",onClick:e=>(e=>{const a=Xa.products.find(a=>a.productId===e.id);a?(a.quantity+=1,a.subtotal=a.quantity*a.price):Xa.products.push({productId:e.id,productName:e.name,productCode:e.code,specification:e.specification,price:e.price,quantity:1,subtotal:e.price}),ml(),qa.value="",Oa.value=[]})(l)},[b("div",re,[b("img",{src:l.image||"/default-product.png",alt:l.name},null,8,ne)]),b("div",ue,[b("div",de,T(l.name),1),b("div",ie,"Â¥"+T(l.price),1),b("div",ce,"åº“å­˜: "+T(l.stock),1)]),b("div",pe,[g(d,{type:"info",size:"small",icon:e.View,onClick:P(e=>(e=>{Sa.push(`/product/detail/${e.id}`)})(l),["stop"]),title:"æŸ¥çœ‹å•†å“è¯¦æƒ…"},{default:k(()=>[...a[29]||(a[29]=[I(" è¯¦æƒ… ",-1)])]),_:1},8,["icon","onClick"]),g(d,{type:"primary",size:"small",icon:V(E)},{default:k(()=>[...a[30]||(a[30]=[I("æ·»åŠ ",-1)])]),_:1},8,["icon"])])],8,se))),128))])])]),b("div",me,[b("div",ve,[g(l,null,{default:k(()=>[g(c)]),_:1}),a[31]||(a[31]=b("span",null,"è®¢å•æ±‡æ€»",-1))]),Xa.products.length>0?(y(),f("div",he,[a[33]||(a[33]=b("h4",null,"å·²é€‰å•†å“",-1)),g(v,{data:Xa.products,style:{width:"100%"}},{default:k(()=>[g(p,{prop:"productName",label:"å•†å“åç§°"}),g(p,{prop:"price",label:"å•ä»·",width:"100"},{default:k(({row:e})=>[I(" Â¥"+T(e.price),1)]),_:1}),g(p,{label:"æ•°é‡",width:"150"},{default:k(({row:e,$index:a})=>[g(m,{modelValue:e.quantity,"onUpdate:modelValue":a=>e.quantity=a,min:1,max:e.stock,size:"small",onChange:vl},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1}),g(p,{label:"å°è®¡",width:"100"},{default:k(({row:e})=>[I(" Â¥"+T(((e.price||0)*(e.quantity||0)).toFixed(2)),1)]),_:1}),g(p,{label:"æ“ä½œ",width:"80"},{default:k(({$index:e})=>[g(d,{type:"danger",size:"small",icon:V(L),onClick:a=>{return l=e,Xa.products.splice(l,1),void ml();var l}},{default:k(()=>[...a[32]||(a[32]=[I(" åˆ é™¤ ",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])])):(y(),f("div",fe,[g(B,{description:"æš‚æ— é€‰æ‹©å•†å“"})])),b("div",ye,[b("div",be,[b("div",ge,[a[34]||(a[34]=b("span",{class:"field-label"},"å•†å“å°è®¡",-1)),b("span",_e,"Â¥"+T(tl.value.toFixed(2)),1)]),b("div",we,[b("span",ke,[a[35]||(a[35]=I(" è®¢å•æ€»é¢ ",-1)),wl.value?(y(),_(D,{key:0,content:"ç‚¹å‡»åŒæ­¥å•†å“å°è®¡",placement:"top"},{default:k(()=>[g(d,{type:"text",size:"small",icon:V(W),onClick:_l,class:"sync-button"},null,8,["icon"])]),_:1})):w("",!0)]),g(m,{modelValue:Xa.totalAmount,"onUpdate:modelValue":a[9]||(a[9]=e=>Xa.totalAmount=e),min:0,max:tl.value,precision:2,placeholder:"è®¢å•æ€»é¢",class:"field-input",onChange:bl},null,8,["modelValue","max"])]),b("div",Ve,[a[36]||(a[36]=b("span",{class:"field-label"},"å®šé‡‘",-1)),g(m,{modelValue:Xa.depositAmount,"onUpdate:modelValue":a[10]||(a[10]=e=>Xa.depositAmount=e),min:0,max:Xa.totalAmount||0,precision:2,placeholder:"å®šé‡‘é‡‘é¢",class:"field-input",onChange:gl},null,8,["modelValue","max"])]),b("div",Ce,[a[37]||(a[37]=b("span",{class:"field-label"},[I("æ”¯ä»˜æ–¹å¼ "),b("span",{class:"required-star"},"*")],-1)),b("div",Ae,[g(o,{modelValue:Xa.paymentMethod,"onUpdate:modelValue":a[11]||(a[11]=e=>Xa.paymentMethod=e),placeholder:"è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼",class:"field-input",style:{width:"140px"},onChange:al},{default:k(()=>[(y(!0),f(C,null,A(el.value,e=>(y(),_(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),"other"===Xa.paymentMethod?(y(),_(n,{key:0,modelValue:Xa.paymentMethodOther,"onUpdate:modelValue":a[12]||(a[12]=e=>Xa.paymentMethodOther=e),placeholder:"è¯·è¾“å…¥æ”¯ä»˜æ–¹å¼",style:{width:"140px","margin-left":"8px"}},null,8,["modelValue"])):w("",!0)])])]),b("div",xe,[b("div",Se,[a[38]||(a[38]=b("span",{class:"field-label"},"ä»£æ”¶é‡‘é¢",-1)),b("span",Ie,"Â¥"+T(ol.value.toFixed(2)),1)]),b("div",Ue,[a[39]||(a[39]=b("span",{class:"field-label"},"ä¼˜æƒ é‡‘é¢",-1)),b("div",Te,[b("span",Pe,"Â¥"+T(sl.value.toFixed(2)),1),sl.value>0?(y(),f("span",Me," ("+T(rl.value.toFixed(1))+"%) ",1)):w("",!0)])]),b("div",Ne,[a[42]||(a[42]=b("span",{class:"field-label"},"å®šé‡‘æˆªå›¾",-1)),b("div",ze,[g(d,{type:"primary",size:"small",icon:e.Upload,onClick:xl},{default:k(()=>[...a[40]||(a[40]=[I(" ä¸Šä¼ æˆªå›¾ ",-1)])]),_:1},8,["icon"]),g(d,{type:"success",size:"small",icon:e.DocumentCopy,onClick:Il},{default:k(()=>[...a[41]||(a[41]=[I(" ç²˜è´´å›¾ç‰‡ ",-1)])]),_:1},8,["icon"])]),b("div",qe,[Ja.value.length>0?(y(),f("div",Oe,[(y(!0),f(C,null,A(Ja.value,(e,t)=>(y(),f("div",{key:t,class:"thumbnail-item",onMouseenter:e=>Qa.value=t,onMouseleave:a[13]||(a[13]=e=>Qa.value=-1),onClick:a=>(e=>{const a=e||Xa.depositScreenshot;a&&(Ra.value=[a],Da.value=!0)})(e)},[b("img",{src:e,alt:"å®šé‡‘æˆªå›¾"},null,8,Fe),S(b("div",We,[g(l,{class:"zoom-icon"},{default:k(()=>[g(V($))]),_:1})],512),[[U,Qa.value===t]]),b("div",{class:"thumbnail-delete",onClick:P(e=>(e=>{"number"==typeof e?(Ja.value.splice(e,1),Xa.depositScreenshot=Ja.value[0]||"",M.success("å›¾ç‰‡å·²åˆ é™¤")):(Ja.value=[],Xa.depositScreenshot="")})(t),["stop"])},[g(l,null,{default:k(()=>[g(V(L))]),_:1})],8,je)],40,Ee))),128))])):w("",!0)]),b("input",{ref_key:"fileInput",ref:Ya,type:"file",accept:"image/*",multiple:"",style:{display:"none"},onChange:Sl},null,544)])])]),b("div",Le,[a[45]||(a[45]=b("h4",null,"è®¢å•æ ‡è®°",-1)),g(u,{gutter:20},{default:k(()=>[g(r,{span:12},{default:k(()=>[g(s,{label:"è®¢å•ç±»åž‹",prop:"markType",required:""},{default:k(()=>[g(Ua,{modelValue:Xa.markType,"onUpdate:modelValue":a[14]||(a[14]=e=>Xa.markType=e),onChange:e.handleMarkTypeChange},{default:k(()=>[g(Ia,{value:"normal"},{default:k(()=>[g(xa,{type:"success",size:"small"},{default:k(()=>[...a[43]||(a[43]=[I("æ­£å¸¸å‘è´§å•",-1)])]),_:1})]),_:1}),g(Ia,{value:"reserved"},{default:k(()=>[g(xa,{type:"warning",size:"small"},{default:k(()=>[...a[44]||(a[44]=[I("é¢„ç•™å•",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1}),g(r,{span:12},{default:k(()=>[b("div",$e,["reserved"===Xa.markType?(y(),_(Ta,{key:0,title:"é¢„ç•™å•è¯´æ˜Ž",description:"é¢„ç•™å•å°†ä¿ç•™åœ¨ä¸‹å•äººå¤„ï¼Œä¸ä¼šæµè½¬åˆ°å®¡æ ¸å‘˜ã€‚éœ€è¦ä¿®æ”¹ä¸ºæ­£å¸¸å‘è´§å•åŽæ‰ä¼šè¿›å…¥å®¡æ ¸æµç¨‹ã€‚",type:"warning",closable:!1,"show-icon":""})):(y(),_(Ta,{key:1,title:"æ­£å¸¸å‘è´§å•",description:"è®¢å•å°†æŒ‰æ­£å¸¸æµç¨‹è¿›è¡Œå®¡æ ¸å’Œå‘è´§å¤„ç†ã€‚",type:"success",closable:!1,"show-icon":""}))])]),_:1})]),_:1})]),b("div",Be,[g(s,{label:"è®¢å•å¤‡æ³¨"},{default:k(()=>[g(n,{modelValue:Xa.remark,"onUpdate:modelValue":a[15]||(a[15]=e=>Xa.remark=e),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥è®¢å•å¤‡æ³¨ä¿¡æ¯"},null,8,["modelValue"])]),_:1})]),b("div",De,[g(d,{onClick:Nl,size:"large"},{default:k(()=>[...a[46]||(a[46]=[I("å–æ¶ˆ",-1)])]),_:1}),g(d,{onClick:Pl,type:"primary",size:"large",loading:za.value},{default:k(()=>[...a[47]||(a[47]=[I(" ä¿å­˜æ›´æ–° ",-1)])]),_:1},8,["loading"])])])]),_:1},8,["model","rules"]),g(Ma,{modelValue:La.value,"onUpdate:modelValue":a[17]||(a[17]=e=>La.value=e),title:"é€‰æ‹©å®¢æˆ·",width:"800px","before-close":ql},{default:k(()=>[b("div",Re,[g(n,{modelValue:Fa.value,"onUpdate:modelValue":a[16]||(a[16]=e=>Fa.value=e),placeholder:"æœç´¢å®¢æˆ·å§“åæˆ–ç”µè¯...",onInput:kl,clearable:""},{prefix:k(()=>[g(l,null,{default:k(()=>[g(V(j))]),_:1})]),_:1},8,["modelValue"])]),b("div",Ye,[g(v,{data:Wa.value,onRowClick:Vl,"highlight-current-row":"",style:{width:"100%"}},{default:k(()=>[g(p,{prop:"name",label:"å®¢æˆ·å§“å"}),g(p,{prop:"phone",label:"è”ç³»ç”µè¯"}),g(p,{prop:"address",label:"åœ°å€"})]),_:1},8,["data"])])]),_:1},8,["modelValue"]),g(Ma,{modelValue:$a.value,"onUpdate:modelValue":a[20]||(a[20]=e=>$a.value=e),title:"æ·»åŠ ç”µè¯å·ç ",width:"400px"},{footer:k(()=>[b("span",Je,[g(d,{onClick:a[19]||(a[19]=e=>$a.value=!1)},{default:k(()=>[...a[48]||(a[48]=[I("å–æ¶ˆ",-1)])]),_:1}),g(d,{type:"primary",onClick:Al},{default:k(()=>[...a[49]||(a[49]=[I("ç¡®å®š",-1)])]),_:1})])]),default:k(()=>[g(Pa,{model:ll,"label-width":"80px"},{default:k(()=>[g(s,{label:"ç”µè¯å·ç "},{default:k(()=>[g(n,{modelValue:ll.phone,"onUpdate:modelValue":a[18]||(a[18]=e=>ll.phone=e),placeholder:"è¯·è¾“å…¥ç”µè¯å·ç "},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),g(Ma,{modelValue:Ba.value,"onUpdate:modelValue":a[22]||(a[22]=e=>Ba.value=e),title:"è®¢å•ç¡®è®¤",width:"900px","before-close":Ol},{footer:k(()=>[b("span",Aa,[g(d,{onClick:a[21]||(a[21]=e=>Ba.value=!1)},{default:k(()=>[...a[64]||(a[64]=[I("å–æ¶ˆ",-1)])]),_:1}),g(d,{type:"primary",onClick:Ml,loading:za.value},{default:k(()=>[...a[65]||(a[65]=[I(" ç¡®è®¤ä¿å­˜ ",-1)])]),_:1},8,["loading"])])]),default:k(()=>[b("div",Qe,[b("div",Ze,[a[56]||(a[56]=b("h4",{class:"confirm-title"},"å®¢æˆ·ä¿¡æ¯",-1)),b("div",Ge,[b("div",He,[a[50]||(a[50]=b("span",{class:"label"},"å®¢æˆ·å§“å:",-1)),b("span",Ke,T(Xa.customerName),1)]),b("div",Xe,[a[51]||(a[51]=b("span",{class:"label"},"è”ç³»ç”µè¯:",-1)),b("span",ea,T(Xa.customerPhone),1)]),b("div",aa,[a[52]||(a[52]=b("span",{class:"label"},"é…é€åœ°å€:",-1)),b("span",la,T(Xa.deliveryAddress||"æ— "),1)]),b("div",ta,[a[53]||(a[53]=b("span",{class:"label"},"é…é€æ—¶é—´:",-1)),b("span",oa,T(Xa.deliveryTime||"æ— "),1)]),b("div",sa,[a[54]||(a[54]=b("span",{class:"label"},"è®¢å•ç±»åž‹:",-1)),g(xa,{type:"normal"===Xa.orderType?"success":"warning"},{default:k(()=>[I(T("normal"===Xa.orderType?"æ­£å¸¸è®¢å•":"é¢„ç•™è®¢å•"),1)]),_:1},8,["type"])]),Xa.remarks?(y(),f("div",ra,[a[55]||(a[55]=b("span",{class:"label"},"å¤‡æ³¨:",-1)),b("span",na,T(Xa.remarks),1)])):w("",!0)])]),b("div",ua,[a[62]||(a[62]=b("h4",{class:"confirm-title"},"é‡‘é¢æ±‡æ€»",-1)),b("div",da,[b("div",ia,[b("div",ca,[a[57]||(a[57]=b("span",{class:"label"},"å•†å“å°è®¡",-1)),b("span",pa,"Â¥"+T(Xa.subtotal),1)]),b("div",ma,[a[58]||(a[58]=b("span",{class:"label"},"ä¼˜æƒ é‡‘é¢",-1)),b("div",va,[b("span",ha,"-Â¥"+T(Xa.discountAmount),1),rl.value>0?(y(),f("span",fa,T(rl.value)+"%",1)):w("",!0)])])]),b("div",ya,[b("div",ba,[a[59]||(a[59]=b("span",{class:"label"},"è®¢å•æ€»é¢",-1)),b("span",ga,"Â¥"+T(Xa.totalAmount),1)]),b("div",_a,[a[60]||(a[60]=b("span",{class:"label"},"å®šé‡‘é‡‘é¢",-1)),b("span",wa,"Â¥"+T(Xa.depositAmount),1)]),b("div",ka,[a[61]||(a[61]=b("span",{class:"label"},"å·²æ”¶é‡‘é¢",-1)),b("span",Va,"Â¥"+T(Xa.collectedAmount),1)])])])]),b("div",Ca,[a[63]||(a[63]=b("h4",{class:"confirm-title"},"äº§å“ä¿¡æ¯",-1)),g(v,{data:Xa.products,style:{width:"100%"}},{default:k(()=>[g(p,{prop:"productName",label:"äº§å“åç§°"}),g(p,{prop:"productCode",label:"äº§å“ç¼–å·",width:"120"}),g(p,{prop:"specification",label:"è§„æ ¼",width:"120"}),g(p,{prop:"price",label:"å•ä»·",width:"100"},{default:k(e=>[I(" Â¥"+T(e.row.price),1)]),_:1}),g(p,{prop:"quantity",label:"æ•°é‡",width:"80"}),g(p,{prop:"subtotal",label:"å°è®¡",width:"100"},{default:k(e=>[I(" Â¥"+T(e.row.subtotal),1)]),_:1})]),_:1},8,["data"])])])]),_:1},8,["modelValue"]),Da.value?(y(),_(Na,{key:0,"url-list":Ra.value,"initial-index":0,onClose:a[23]||(a[23]=e=>Da.value=!1)},null,8,["url-list"])):w("",!0),b("input",{ref_key:"fileInput",ref:Ya,type:"file",accept:"image/*",style:{display:"none"},onChange:Sl},null,544)])}}}),[["__scopeId","data-v-94883a08"]]);export{xa as default};
