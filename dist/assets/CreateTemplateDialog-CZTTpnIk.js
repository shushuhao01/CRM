import{l as e,r as l,e as a,w as t,ag as s,m as o,q as i,F as u,U as n,O as r,Q as d,M as c,a9 as m,p as v,T as p,S as g,u as f,a7 as b,n as y}from"./vendor-BtukhyiH.js";import{K as h,E as w}from"./elementPlus-DxaqjplL.js";import{_}from"./index-C4IdUW1A.js";const V={class:"category-option"},k={class:"category-name"},x={class:"category-desc"},U={class:"content-wrapper"},D={class:"content-info"},C={class:"content-stats"},N={class:"char-count"},q={class:"sms-count"},P={class:"variables-section"},z={class:"variables-list"},j={class:"variables-tip"},E={class:"template-settings"},F={class:"tags-wrapper"},O={key:0,class:"preview-section"},R={class:"preview-content"},S={class:"preview-header"},T={class:"preview-text"},I={class:"dialog-footer"},M={class:"footer-info"},B={class:"submit-tip"},K={class:"footer-actions"},$={class:"full-preview"},A={class:"preview-info"},L={class:"preview-content-full"},Q={class:"content-display"},G={key:0,class:"preview-variables"},H={class:"variables-display"},J=_(e({__name:"CreateTemplateDialog",props:{modelValue:{type:Boolean},mode:{default:"apply"},initialData:{}},emits:["update:modelValue","submit"],setup(e,{expose:_,emit:J}){const W=e,X=J,Y=l(),Z=l(),ee=l(!1),le=l(!1),ae=l(!1),te=l(!1),se=l(""),oe=l({name:"",category:"",content:"",scenario:"",description:"",isDefault:!1,isPublic:!1,tags:[]}),ie=[{value:"order",label:"订单通知",description:"订单确认、发货、收货等通知"},{value:"logistics",label:"物流通知",description:"发货、配送、签收等物流信息"},{value:"marketing",label:"营销推广",description:"促销活动、新品推荐等营销内容"},{value:"service",label:"客服通知",description:"售后服务、客户关怀等通知"},{value:"system",label:"系统通知",description:"系统维护、账户变更等系统消息"},{value:"reminder",label:"提醒通知",description:"付款提醒、到期提醒等"}],ue=a(()=>({name:[{required:!0,message:"请输入模板名称",trigger:"blur"},{min:2,max:50,message:"模板名称长度在 2 到 50 个字符",trigger:"blur"}],category:[{required:!0,message:"请选择模板分类",trigger:"change"}],content:[{required:!0,message:"请输入模板内容",trigger:"blur"},{min:10,max:500,message:"模板内容长度在 10 到 500 个字符",trigger:"blur"},{validator:(e,l,a)=>{["赌博","彩票","贷款","投资理财"].some(e=>l.includes(e))?a(new Error("模板内容包含敏感词汇，请修改")):a()},trigger:"blur"}],scenario:[{required:!0,message:"请描述使用场景",trigger:"blur"},{min:5,max:200,message:"使用场景描述长度在 5 到 200 个字符",trigger:"blur"}],description:"apply"===W.mode?[{required:!0,message:"请输入申请说明",trigger:"blur"},{min:10,max:300,message:"申请说明长度在 10 到 300 个字符",trigger:"blur"}]:[]})),ne=a(()=>"apply"===W.mode?"申请短信模板":"创建短信模板"),re=a(()=>{if(!oe.value.content)return[];const e=oe.value.content.match(/\{(\w+)\}/g);return e?[...new Set(e.map(e=>e.slice(1,-1)))]:[]}),de=a(()=>{let e=oe.value.content;return re.value.forEach(l=>{const a=ce(l);e=e.replace(new RegExp(`\\{${l}\\}`,"g"),a)}),e});t(()=>W.modelValue,e=>{ee.value=e,e&&W.initialData&&Object.assign(oe.value,W.initialData)}),t(ee,e=>{X("update:modelValue",e),e||ye()});const ce=e=>({customerName:"张先生",orderNo:"ORD20240115001",amount:"299.00",deliveryTime:"2024-01-16 14:00",trackingNo:"SF1234567890",productName:"商品名称",companyName:"公司名称",phone:"138****8888",code:"123456",date:"2024-01-15",time:"14:30"}[e]||`[${e}]`),me=e=>{const l=ie.find(l=>l.value===e);return l?.label||e},ve=()=>{},pe=()=>{te.value=!0,y(()=>{Z.value?.focus()})},ge=()=>{const e=se.value.trim();if(e&&!oe.value.tags.includes(e)){if(oe.value.tags.length>=5)return void w.warning("最多只能添加5个标签");oe.value.tags.push(e)}se.value="",te.value=!1},fe=async()=>{try{await(Y.value?.validate()),le.value=!0;const e={...oe.value,variables:re.value,mode:W.mode,createdAt:(new Date).toLocaleString()};await new Promise(e=>setTimeout(e,1500)),X("submit",e),w.success("apply"===W.mode?"模板申请已提交，等待管理员审核":"模板创建成功"),be()}catch(e){console.error("提交失败:",e)}finally{le.value=!1}},be=()=>{ee.value=!1},ye=()=>{oe.value={name:"",category:"",content:"",scenario:"",description:"",isDefault:!1,isPublic:!1,tags:[]},te.value=!1,se.value="",Y.value?.resetFields()};return _({resetForm:ye}),(l,a)=>{const t=s("el-input"),y=s("el-form-item"),w=s("el-option"),_=s("el-select"),J=s("el-tag"),W=s("el-icon"),X=s("el-checkbox"),ce=s("el-button"),ye=s("el-form"),he=s("el-dialog"),we=s("el-descriptions-item"),_e=s("el-descriptions");return i(),o(u,null,[n(he,{modelValue:ee.value,"onUpdate:modelValue":a[9]||(a[9]=e=>ee.value=e),title:ne.value,width:"700px","before-close":be,class:"create-template-dialog"},{footer:r(()=>[v("div",I,[v("div",M,[v("span",B,p("apply"===e.mode?"提交后将进入审核流程":"创建后立即生效"),1)]),v("div",K,[n(ce,{onClick:be},{default:r(()=>[...a[21]||(a[21]=[g("取消",-1)])]),_:1}),n(ce,{type:"primary",onClick:fe,loading:le.value},{default:r(()=>[g(p("apply"===e.mode?"提交申请":"创建模板"),1)]),_:1},8,["loading"])])])]),default:r(()=>[n(ye,{model:oe.value,rules:ue.value,ref_key:"formRef",ref:Y,"label-width":"100px",class:"template-form"},{default:r(()=>[n(y,{label:"模板名称",prop:"name"},{default:r(()=>[n(t,{modelValue:oe.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>oe.value.name=e),placeholder:"请输入模板名称，建议简洁明了",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),n(y,{label:"模板分类",prop:"category"},{default:r(()=>[n(_,{modelValue:oe.value.category,"onUpdate:modelValue":a[1]||(a[1]=e=>oe.value.category=e),placeholder:"请选择模板分类",style:{width:"100%"}},{default:r(()=>[(i(),o(u,null,m(ie,e=>n(w,{key:e.value,label:e.label,value:e.value},{default:r(()=>[v("div",V,[v("span",k,p(e.label),1),v("span",x,p(e.description),1)])]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),n(y,{label:"模板内容",prop:"content"},{default:r(()=>[v("div",U,[n(t,{modelValue:oe.value.content,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.value.content=e),type:"textarea",rows:8,placeholder:"请输入短信模板内容\n\n支持变量格式：{变量名}\n例如：您好{customerName}，您的订单{orderNo}已确认。\n\n注意：短信内容需符合相关法规要求",maxlength:"500","show-word-limit":"",onInput:ve},null,8,["modelValue"]),v("div",D,[v("div",C,[v("span",N,"字符数: "+p(oe.value.content.length)+"/500",1),v("span",q,"预计短信条数: "+p(Math.ceil(oe.value.content.length/70)),1)])])])]),_:1}),re.value.length>0?(i(),c(y,{key:0,label:"检测到的变量"},{default:r(()=>[v("div",P,[v("div",z,[(i(!0),o(u,null,m(re.value,e=>(i(),c(J,{key:e,class:"variable-tag",type:"info"},{default:r(()=>[g(p(e),1)]),_:2},1024))),128))]),v("div",j,[n(W,null,{default:r(()=>[n(f(h))]),_:1}),a[12]||(a[12]=g(" 系统自动检测到以上变量，请确保在使用时提供对应的值 ",-1))])])]),_:1})):d("",!0),n(y,{label:"使用场景",prop:"scenario"},{default:r(()=>[n(t,{modelValue:oe.value.scenario,"onUpdate:modelValue":a[3]||(a[3]=e=>oe.value.scenario=e),type:"textarea",rows:2,placeholder:"请描述此模板的使用场景，如：订单确认后通知客户",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),"apply"===e.mode?(i(),c(y,{key:1,label:"申请说明",prop:"description"},{default:r(()=>[n(t,{modelValue:oe.value.description,"onUpdate:modelValue":a[4]||(a[4]=e=>oe.value.description=e),type:"textarea",rows:3,placeholder:"请说明申请此模板的用途和必要性，以便管理员审核",maxlength:"300","show-word-limit":""},null,8,["modelValue"])]),_:1})):d("",!0),"create"===e.mode?(i(),c(y,{key:2,label:"模板设置"},{default:r(()=>[v("div",E,[n(X,{modelValue:oe.value.isDefault,"onUpdate:modelValue":a[5]||(a[5]=e=>oe.value.isDefault=e)},{default:r(()=>[...a[13]||(a[13]=[g("设为默认模板",-1)])]),_:1},8,["modelValue"]),n(X,{modelValue:oe.value.isPublic,"onUpdate:modelValue":a[6]||(a[6]=e=>oe.value.isPublic=e)},{default:r(()=>[...a[14]||(a[14]=[g("公开模板（其他用户可见）",-1)])]),_:1},8,["modelValue"])]),a[15]||(a[15]=v("div",{class:"settings-tip"}," 默认模板将在发送短信时优先显示；公开模板可被其他用户使用 ",-1))]),_:1})):d("",!0),n(y,{label:"标签",prop:"tags"},{default:r(()=>[v("div",F,[(i(!0),o(u,null,m(oe.value.tags,e=>(i(),c(J,{key:e,closable:"",onClose:l=>(e=>{const l=oe.value.tags.indexOf(e);l>-1&&oe.value.tags.splice(l,1)})(e),class:"tag-item"},{default:r(()=>[g(p(e),1)]),_:2},1032,["onClose"]))),128)),te.value?(i(),c(t,{key:0,ref_key:"tagInputRef",ref:Z,modelValue:se.value,"onUpdate:modelValue":a[7]||(a[7]=e=>se.value=e),size:"small",style:{width:"100px"},onKeyup:b(ge,["enter"]),onBlur:ge},null,8,["modelValue"])):(i(),c(ce,{key:1,size:"small",onClick:pe,class:"add-tag-btn"},{default:r(()=>[...a[16]||(a[16]=[g(" + 添加标签 ",-1)])]),_:1}))]),a[17]||(a[17]=v("div",{class:"tags-tip"}," 添加标签便于分类和搜索模板 ",-1))]),_:1})]),_:1},8,["model","rules"]),oe.value.content?(i(),o("div",O,[a[20]||(a[20]=v("h4",{class:"preview-title"},"模板预览",-1)),v("div",R,[v("div",S,[a[19]||(a[19]=v("span",{class:"preview-label"},"短信内容预览：",-1)),n(ce,{size:"small",type:"primary",link:"",onClick:a[8]||(a[8]=e=>ae.value=!0)},{default:r(()=>[...a[18]||(a[18]=[g(" 完整预览 ",-1)])]),_:1})]),v("div",T,p(de.value),1)])])):d("",!0)]),_:1},8,["modelValue","title"]),n(he,{modelValue:ae.value,"onUpdate:modelValue":a[11]||(a[11]=e=>ae.value=e),title:"模板预览",width:"500px",class:"preview-dialog"},{footer:r(()=>[n(ce,{onClick:a[10]||(a[10]=e=>ae.value=!1)},{default:r(()=>[...a[24]||(a[24]=[g("关闭",-1)])]),_:1})]),default:r(()=>[v("div",$,[v("div",A,[n(_e,{column:1,size:"small"},{default:r(()=>[n(we,{label:"模板名称"},{default:r(()=>[g(p(oe.value.name),1)]),_:1}),n(we,{label:"分类"},{default:r(()=>[g(p(me(oe.value.category)),1)]),_:1}),n(we,{label:"字符数"},{default:r(()=>[g(p(oe.value.content.length),1)]),_:1}),n(we,{label:"预计条数"},{default:r(()=>[g(p(Math.ceil(oe.value.content.length/70)),1)]),_:1})]),_:1})]),v("div",L,[a[22]||(a[22]=v("h5",null,"短信内容：",-1)),v("div",Q,p(oe.value.content),1)]),re.value.length>0?(i(),o("div",G,[a[23]||(a[23]=v("h5",null,"包含变量：",-1)),v("div",H,[(i(!0),o(u,null,m(re.value,e=>(i(),c(J,{key:e,size:"small",class:"variable-tag"},{default:r(()=>[g(p(e),1)]),_:2},1024))),128))])])):d("",!0)])]),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-af076099"]]);export{J as C};
