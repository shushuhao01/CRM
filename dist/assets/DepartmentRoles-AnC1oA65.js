var Ve=(R,le,I)=>new Promise((j,B)=>{var N=n=>{try{V(I.next(n))}catch(w){B(w)}},L=n=>{try{V(I.throw(n))}catch(w){B(w)}},V=n=>n.done?j(n.value):Promise.resolve(n.value).then(N,L);V((I=I.apply(R,le)).next())});import{l as be,r as x,e as Z,w as we,ag as _,M as O,p,O as t,U as s,q as e,u as E,m as b,F as Q,a9 as Y,S as v,T as u,Q as se,n as Ee,I as xe,R as Ie,J as De,a2 as he,c as Ae,aq as Be,P as Ne}from"./vendor-D8Vxqhr-.js";import{I as _e,l as Ue,F as ge,U as Le,C as Oe,E as ae,s as Re,r as Te,e as ze,aI as Pe,x as Fe,t as qe,n as je,d as We,b as Je,p as Qe,i as Ye,a0 as Ze,aC as Ge,aR as He,P as Xe}from"./elementPlus-Bmwh7Rh8.js";import{useDepartmentStore as ke}from"./department-CTOju6hT.js";import{Y as Se,Z as Ke,_ as $e}from"./settings-CuxbDWOu.js";import"./utils-ywHRn0uI.js";const Me={class:"form-section"},es={class:"role-option"},ss={class:"role-option"},ts={class:"role-option"},ls={class:"role-option"},os={class:"form-section"},ns={class:"permission-templates"},as={class:"templates-header"},is={class:"templates-list"},ds={class:"permissions-tree"},rs={class:"menu-header"},cs={class:"menu-title"},us={class:"menu-count"},ms={key:0,class:"submenu-list"},ps={class:"submenu-header"},vs={class:"submenu-title"},_s={class:"submenu-count"},fs={key:0,class:"action-list"},gs={class:"action-content"},ys={class:"action-name"},hs={class:"action-desc"},bs={class:"permission-summary"},ks={class:"summary-item"},$s={class:"summary-value"},Cs={class:"summary-item"},Vs={class:"summary-item"},ws={class:"summary-value"},xs={class:"dialog-footer"},Is=be({__name:"RoleDialog",props:{modelValue:{type:Boolean},role:{},isEdit:{type:Boolean}},emits:["update:modelValue","success"],setup(R,{emit:le}){const I=R,j=le,B=ke(),N=x(),L=x(!1),V=x(""),n=x({name:"",description:"",departmentId:"",type:"member",permissions:[]}),w=Z({get:()=>I.modelValue,set:r=>j("update:modelValue",r)}),F={name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"角色名称长度在 2 到 20 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择角色类型",trigger:"change"}],departmentId:[{required:!0,message:"请选择所属部门",trigger:"change"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"},{min:5,max:200,message:"角色描述长度在 5 到 200 个字符",trigger:"blur"}]};x(Se.map(r=>{var c;return{key:r.code,name:r.name,checked:!1,indeterminate:!1,permissions:((c=r.children)==null?void 0:c.flatMap(h=>{var a;return[{key:h.code,name:`${h.name}菜单`,description:`访问${h.name}页面`},...((a=h.actions)==null?void 0:a.map(i=>({key:`${h.code}:${i.code}`,name:`${h.name}-${i.name}`,description:i.description})))||[]]}))||[]}}));const T=x(Object.entries(Ke).map(([r,c])=>({key:r,name:c.name,permissions:c.permissions}))),W=r=>{let c=0;return n.value.permissions.includes(r.code)&&c++,r.children&&r.children.forEach(h=>{n.value.permissions.includes(h.code)&&c++,h.actions&&h.actions.forEach(a=>{n.value.permissions.includes(`${h.code}:${a.code}`)&&c++})}),c},J=r=>{let c=1;return r.children&&(c+=r.children.length,r.children.forEach(h=>{h.actions&&(c+=h.actions.length)})),c},M=r=>{const c=W(r),h=J(r);return c>0&&c<h},oe=r=>{let c=0;return n.value.permissions.includes(r.code)&&c++,r.actions&&r.actions.forEach(h=>{n.value.permissions.includes(`${r.code}:${h.code}`)&&c++}),c},ne=r=>{let c=1;return r.actions&&(c+=r.actions.length),c},ue=r=>{const c=oe(r),h=ne(r);return c>0&&c<h},ie=()=>{const r=n.value.permissions.length;return r>=30?"超级管理员":r>=20?"高级权限":r>=10?"中级权限":r>=3?"基础权限":"无权限"},de=()=>{const r=n.value.permissions.length;return r>=30?"danger":r>=20?"warning":r>=10?"primary":r>=3?"success":"info"},re=()=>{const r=new Set;return n.value.permissions.forEach(c=>{const h=c.split(":")[0],a=Se.find(i=>i.code===h);a&&r.add(a.name)}),Array.from(r).join("、")},ce=r=>{if(n.value.permissions.includes(r.code))n.value.permissions.includes(r.code)||n.value.permissions.push(r.code),r.children&&r.children.forEach(h=>{n.value.permissions.includes(h.code)||n.value.permissions.push(h.code),h.actions&&h.actions.forEach(a=>{const i=`${h.code}:${a.code}`;n.value.permissions.includes(i)||n.value.permissions.push(i)})});else{const h=n.value.permissions.indexOf(r.code);h>-1&&n.value.permissions.splice(h,1),r.children&&r.children.forEach(a=>{const i=n.value.permissions.indexOf(a.code);i>-1&&n.value.permissions.splice(i,1),a.actions&&a.actions.forEach(d=>{const o=`${a.code}:${d.code}`,l=n.value.permissions.indexOf(o);l>-1&&n.value.permissions.splice(l,1)})})}},me=r=>{if(n.value.permissions.includes(r.code))n.value.permissions.includes(r.code)||n.value.permissions.push(r.code),r.actions&&r.actions.forEach(h=>{const a=`${r.code}:${h.code}`;n.value.permissions.includes(a)||n.value.permissions.push(a)});else{const h=n.value.permissions.indexOf(r.code);h>-1&&n.value.permissions.splice(h,1),r.actions&&r.actions.forEach(a=>{const i=`${r.code}:${a.code}`,d=n.value.permissions.indexOf(i);d>-1&&n.value.permissions.splice(d,1)})}},G=r=>{V.value=r.key,n.value.permissions=[...r.permissions]},g=()=>{V.value="",n.value.permissions=[]},m=()=>{n.value={name:"",description:"",departmentId:"",type:"member",permissions:[]},V.value=""},q=()=>{I.isEdit&&I.role?n.value={name:I.role.name,description:I.role.description,departmentId:I.role.departmentId,type:I.role.type,permissions:[...I.role.permissions]}:m()},P=()=>{m(),j("update:modelValue",!1)},ee=()=>Ve(this,null,function*(){if(N.value)try{yield N.value.validate(),L.value=!0,yield new Promise(r=>setTimeout(r,1e3)),j("success"),ae.success(I.isEdit?"角色更新成功":"角色创建成功")}catch(r){console.error("表单验证失败:",r)}finally{L.value=!1}});return we(()=>I.modelValue,r=>{r&&Ee(()=>{q()})}),we(()=>n.value.permissions,()=>{updateAllCategoryStatus()},{deep:!0}),(r,c)=>{const h=_("el-input"),a=_("el-form-item"),i=_("el-col"),d=_("el-icon"),o=_("el-option"),l=_("el-select"),U=_("el-row"),S=_("el-button"),z=_("el-checkbox"),te=_("el-tag"),H=_("el-form"),X=_("el-dialog");return p(),O(X,{modelValue:w.value,"onUpdate:modelValue":c[7]||(c[7]=$=>w.value=$),title:R.isEdit?"编辑角色":"新建角色",width:"800px","before-close":P,class:"role-dialog"},{footer:t(()=>[e("div",xs,[s(S,{onClick:P,class:"cancel-btn"},{default:t(()=>[...c[19]||(c[19]=[v("取消",-1)])]),_:1}),s(S,{type:"primary",onClick:ee,loading:L.value,class:"submit-btn"},{default:t(()=>[v(u(R.isEdit?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:t(()=>[s(H,{ref_key:"formRef",ref:N,model:n.value,rules:F,"label-width":"100px",class:"role-form"},{default:t(()=>[e("div",Me,[c[12]||(c[12]=e("h4",{class:"section-title"},"基本信息",-1)),s(U,{gutter:20},{default:t(()=>[s(i,{span:12},{default:t(()=>[s(a,{label:"角色名称",prop:"name"},{default:t(()=>[s(h,{modelValue:n.value.name,"onUpdate:modelValue":c[0]||(c[0]=$=>n.value.name=$),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),s(i,{span:12},{default:t(()=>[s(a,{label:"角色类型",prop:"type"},{default:t(()=>[s(l,{modelValue:n.value.type,"onUpdate:modelValue":c[1]||(c[1]=$=>n.value.type=$),placeholder:"选择角色类型",style:{width:"100%"}},{default:t(()=>[s(o,{label:"部门负责人",value:"manager"},{default:t(()=>[e("div",es,[s(d,null,{default:t(()=>[s(E(_e))]),_:1}),c[8]||(c[8]=e("span",null,"部门负责人",-1))])]),_:1}),s(o,{label:"主管",value:"supervisor"},{default:t(()=>[e("div",ss,[s(d,null,{default:t(()=>[s(E(Ue))]),_:1}),c[9]||(c[9]=e("span",null,"主管",-1))])]),_:1}),s(o,{label:"专员",value:"specialist"},{default:t(()=>[e("div",ts,[s(d,null,{default:t(()=>[s(E(_e))]),_:1}),c[10]||(c[10]=e("span",null,"专员",-1))])]),_:1}),s(o,{label:"普通成员",value:"member"},{default:t(()=>[e("div",ls,[s(d,null,{default:t(()=>[s(E(ge))]),_:1}),c[11]||(c[11]=e("span",null,"普通成员",-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(a,{label:"所属部门",prop:"departmentId"},{default:t(()=>[s(l,{modelValue:n.value.departmentId,"onUpdate:modelValue":c[2]||(c[2]=$=>n.value.departmentId=$),placeholder:"选择所属部门",style:{width:"100%"}},{default:t(()=>[(p(!0),b(Q,null,Y(E(B).departmentList,$=>(p(),O(o,{key:$.id,label:$.name,value:$.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(a,{label:"角色描述",prop:"description"},{default:t(()=>[s(h,{modelValue:n.value.description,"onUpdate:modelValue":c[3]||(c[3]=$=>n.value.description=$),type:"textarea",rows:3,placeholder:"请输入角色描述",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),e("div",os,[c[18]||(c[18]=e("h4",{class:"section-title"},"权限配置",-1)),e("div",ns,[e("div",as,[c[14]||(c[14]=e("span",null,"快速模板",-1)),s(S,{type:"text",size:"small",onClick:g},{default:t(()=>[...c[13]||(c[13]=[v(" 清空权限 ",-1)])]),_:1})]),e("div",is,[(p(!0),b(Q,null,Y(T.value,$=>(p(),O(S,{key:$.key,size:"small",type:$.key===V.value?"primary":"default",onClick:D=>G($),class:"template-btn"},{default:t(()=>[v(u($.name),1)]),_:2},1032,["type","onClick"]))),128))])]),e("div",ds,[(p(!0),b(Q,null,Y(E(Se),$=>(p(),b("div",{key:$.code,class:"permission-menu"},[e("div",rs,[s(z,{modelValue:n.value.permissions,"onUpdate:modelValue":c[4]||(c[4]=D=>n.value.permissions=D),value:$.code,onChange:D=>ce($),indeterminate:M($)},{default:t(()=>[e("span",cs,[s(d,null,{default:t(()=>[s(E(Le))]),_:1}),v(" "+u($.name),1)])]),_:2},1032,["modelValue","value","onChange","indeterminate"]),e("span",us,u(W($))+"/"+u(J($)),1)]),$.children?(p(),b("div",ms,[(p(!0),b(Q,null,Y($.children,D=>(p(),b("div",{key:D.code,class:"submenu-item"},[e("div",ps,[s(z,{modelValue:n.value.permissions,"onUpdate:modelValue":c[5]||(c[5]=C=>n.value.permissions=C),value:D.code,onChange:C=>me(D),indeterminate:ue(D)},{default:t(()=>[e("span",vs,[s(d,null,{default:t(()=>[s(E(Oe))]),_:1}),v(" "+u(D.name),1)])]),_:2},1032,["modelValue","value","onChange","indeterminate"]),e("span",_s,u(oe(D))+"/"+u(ne(D)),1)]),D.actions?(p(),b("div",fs,[(p(!0),b(Q,null,Y(D.actions,C=>(p(),O(z,{key:`${D.code}:${C.code}`,modelValue:n.value.permissions,"onUpdate:modelValue":c[6]||(c[6]=K=>n.value.permissions=K),value:`${D.code}:${C.code}`,class:"action-item"},{default:t(()=>[e("div",gs,[e("span",ys,u(C.name),1),e("span",hs,u(C.description),1)])]),_:2},1032,["modelValue","value"]))),128))])):se("",!0)]))),128))])):se("",!0)]))),128))]),e("div",bs,[e("div",ks,[c[15]||(c[15]=e("span",{class:"summary-label"},"已选权限：",-1)),e("span",$s,u(n.value.permissions.length)+" 项",1)]),e("div",Cs,[c[16]||(c[16]=e("span",{class:"summary-label"},"权限等级：",-1)),s(te,{type:de(),size:"small"},{default:t(()=>[v(u(ie()),1)]),_:1},8,["type"])]),e("div",Vs,[c[17]||(c[17]=e("span",{class:"summary-label"},"覆盖模块：",-1)),e("span",ws,u(re()),1)])])])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Us=$e(Is,[["__scopeId","data-v-0d8fa1ba"]]),Ss={class:"dialog-content"},zs={class:"role-info-section"},Es={class:"role-header"},Rs={class:"role-details"},Ts={class:"role-name"},Ps={class:"role-desc"},Ds={class:"role-meta"},As={class:"department-name"},Bs={class:"filter-section"},Ns={class:"users-section"},Ls={class:"section-header"},Os={class:"header-left"},Fs={class:"user-count"},qs={class:"header-actions"},js={class:"users-grid"},Ws=["onClick"],Js={class:"user-avatar"},Qs={key:0,class:"assigned-badge"},Ys={class:"user-info"},Zs={class:"user-name"},Gs={class:"user-id"},Hs={class:"user-department"},Xs={class:"user-status"},Ks={class:"user-actions"},Ms={class:"selection-indicator"},et={key:0,class:"empty-state"},st={key:0,class:"assigned-section"},tt={class:"section-header"},lt={class:"user-count"},ot={class:"assigned-users"},nt={class:"user-name"},at={class:"user-id"},it={class:"dialog-footer"},dt=be({__name:"UserAssignDialog",props:{modelValue:{type:Boolean},role:{}},emits:["update:modelValue","success"],setup(R,{emit:le}){const I=R,j=le,B=ke(),N=x(""),L=x(""),V=x(""),n=x([]),w=x([]),F=x([]),T=x(!1),W=Z({get:()=>I.modelValue,set:a=>j("update:modelValue",a)}),J=x([{id:"1",name:"张三",employeeId:"EMP001",avatar:"",departmentId:"2",status:"active",email:"zhangsan@company.com",phone:"13800138001"},{id:"2",name:"李四",employeeId:"EMP002",avatar:"",departmentId:"2",status:"active",email:"lisi@company.com",phone:"13800138002"},{id:"3",name:"王五",employeeId:"EMP003",avatar:"",departmentId:"3",status:"active",email:"wangwu@company.com",phone:"13800138003"},{id:"4",name:"赵六",employeeId:"EMP004",avatar:"",departmentId:"4",status:"probation",email:"zhaoliu@company.com",phone:"13800138004"},{id:"5",name:"钱七",employeeId:"EMP005",avatar:"",departmentId:"2",status:"inactive",email:"qianqi@company.com",phone:"13800138005"}]),M=Z(()=>{let a=J.value;if(N.value){const i=N.value.toLowerCase();a=a.filter(d=>d.name.toLowerCase().includes(i)||d.employeeId.toLowerCase().includes(i))}return L.value&&(a=a.filter(i=>i.status===L.value)),V.value&&(a=a.filter(i=>i.departmentId===V.value)),a}),oe=Z(()=>{const a=w.value.map(d=>d.id).sort(),i=F.value.sort();return JSON.stringify(a)!==JSON.stringify(i)}),ne=a=>{if(!a)return"未知部门";const i=B.getDepartmentById(a);return(i==null?void 0:i.name)||"未知部门"},ue=a=>{const i={manager:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",member:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",specialist:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",supervisor:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"};return i[a]||i.member},ie=a=>({manager:_e,member:ge,specialist:_e,supervisor:Ue})[a]||ge,de=a=>({manager:"danger",member:"primary",specialist:"success",supervisor:"warning"})[a]||"primary",re=a=>({manager:"部门负责人",member:"普通成员",specialist:"专员",supervisor:"主管"})[a]||"未知",ce=a=>({active:"success",inactive:"danger",probation:"warning"})[a]||"info",me=a=>({active:"在职",inactive:"离职",probation:"试用期"})[a]||"未知",G=a=>w.value.some(i=>i.id===a),g=()=>{N.value="",L.value="",V.value="",n.value=[],ae.success("数据已刷新")},m=a=>{if(G(a.id))return;const i=n.value.indexOf(a.id);i>-1?n.value.splice(i,1):n.value.push(a.id)},q=a=>{if(!G(a.id)){w.value.push(a);const i=n.value.indexOf(a.id);i>-1&&n.value.splice(i,1)}},P=a=>{const i=w.value.findIndex(d=>d.id===a.id);i>-1&&w.value.splice(i,1)},ee=()=>{n.value.forEach(a=>{const i=J.value.find(d=>d.id===a);i&&!G(a)&&w.value.push(i)}),n.value=[]},r=()=>{I.role&&(w.value=J.value.slice(0,2),F.value=w.value.map(a=>a.id)),n.value=[]},c=()=>{w.value=J.value.filter(a=>F.value.includes(a.id)),n.value=[],N.value="",L.value="",V.value="",j("update:modelValue",!1)},h=()=>Ve(this,null,function*(){try{T.value=!0,yield new Promise(a=>setTimeout(a,1e3)),F.value=w.value.map(a=>a.id),j("success"),ae.success("用户分配成功")}catch(a){ae.error("保存失败，请重试")}finally{T.value=!1}});return we(()=>I.modelValue,a=>{a&&Ee(()=>{r()})}),(a,i)=>{const d=_("el-icon"),o=_("el-tag"),l=_("el-divider"),U=_("el-input"),S=_("el-col"),z=_("el-option"),te=_("el-select"),H=_("el-button"),X=_("el-row"),$=_("el-avatar"),D=_("el-checkbox"),C=_("el-empty"),K=_("el-dialog");return p(),O(K,{modelValue:W.value,"onUpdate:modelValue":i[5]||(i[5]=pe=>W.value=pe),title:"分配用户",width:"900px","before-close":c,class:"user-assign-dialog"},{footer:t(()=>[e("div",it,[s(H,{onClick:c,class:"cancel-btn"},{default:t(()=>[...i[12]||(i[12]=[v("取消",-1)])]),_:1}),s(H,{type:"primary",onClick:h,loading:T.value,disabled:!oe.value,class:"save-btn"},{default:t(()=>[...i[13]||(i[13]=[v(" 保存分配 ",-1)])]),_:1},8,["loading","disabled"])])]),default:t(()=>{var pe,ye,y,A,Ce;return[e("div",Ss,[e("div",zs,[e("div",Es,[e("div",{class:"role-icon",style:xe({background:ue((pe=R.role)==null?void 0:pe.type)})},[s(d,null,{default:t(()=>{var k;return[(p(),O(Ie(ie((k=R.role)==null?void 0:k.type))))]}),_:1})],4),e("div",Rs,[e("h3",Ts,u((ye=R.role)==null?void 0:ye.name),1),e("p",Ps,u((y=R.role)==null?void 0:y.description),1),e("div",Ds,[s(o,{type:de((A=R.role)==null?void 0:A.type),size:"small"},{default:t(()=>{var k;return[v(u(re((k=R.role)==null?void 0:k.type)),1)]}),_:1},8,["type"]),e("span",As,u(ne((Ce=R.role)==null?void 0:Ce.departmentId)),1)])])])]),s(l),e("div",Bs,[s(X,{gutter:20,align:"middle"},{default:t(()=>[s(S,{span:8},{default:t(()=>[s(U,{modelValue:N.value,"onUpdate:modelValue":i[0]||(i[0]=k=>N.value=k),placeholder:"搜索用户姓名、工号","prefix-icon":E(Re),clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),s(S,{span:6},{default:t(()=>[s(te,{modelValue:L.value,"onUpdate:modelValue":i[1]||(i[1]=k=>L.value=k),placeholder:"用户状态",clearable:""},{default:t(()=>[s(z,{label:"全部状态",value:""}),s(z,{label:"在职",value:"active"}),s(z,{label:"离职",value:"inactive"}),s(z,{label:"试用期",value:"probation"})]),_:1},8,["modelValue"])]),_:1}),s(S,{span:6},{default:t(()=>[s(te,{modelValue:V.value,"onUpdate:modelValue":i[2]||(i[2]=k=>V.value=k),placeholder:"所属部门",clearable:""},{default:t(()=>[s(z,{label:"全部部门",value:""}),(p(!0),b(Q,null,Y(E(B).departmentList,k=>(p(),O(z,{key:k.id,label:k.name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(S,{span:4},{default:t(()=>[s(H,{icon:E(Te),onClick:g,class:"refresh-btn"},{default:t(()=>[...i[6]||(i[6]=[v(" 刷新 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1})]),e("div",Ns,[e("div",Ls,[e("div",Os,[i[7]||(i[7]=e("h4",null,"可分配用户",-1)),e("span",Fs,"共 "+u(M.value.length)+" 人",1)]),e("div",qs,[s(H,{size:"small",disabled:n.value.length===0,onClick:ee,class:"batch-btn"},{default:t(()=>[v(" 批量分配 ("+u(n.value.length)+") ",1)]),_:1},8,["disabled"])])]),e("div",js,[(p(!0),b(Q,null,Y(M.value,k=>(p(),b("div",{key:k.id,class:De(["user-card",{selected:n.value.includes(k.id),assigned:G(k.id)}]),onClick:fe=>m(k)},[e("div",Js,[s($,{size:48,src:k.avatar},{default:t(()=>[v(u(k.name.charAt(0)),1)]),_:2},1032,["src"]),G(k.id)?(p(),b("div",Qs,[s(d,null,{default:t(()=>[s(E(ze))]),_:1})])):se("",!0)]),e("div",Ys,[e("h5",Zs,u(k.name),1),e("p",Gs,"工号："+u(k.employeeId),1),e("p",Hs,u(ne(k.departmentId)),1),e("div",Xs,[s(o,{type:ce(k.status),size:"small"},{default:t(()=>[v(u(me(k.status)),1)]),_:2},1032,["type"])])]),e("div",Ks,[G(k.id)?(p(),O(H,{key:1,size:"small",type:"danger",onClick:he(fe=>P(k),["stop"]),class:"unassign-btn"},{default:t(()=>[...i[9]||(i[9]=[v(" 取消分配 ",-1)])]),_:1},8,["onClick"])):(p(),O(H,{key:0,size:"small",type:"primary",onClick:he(fe=>q(k),["stop"]),class:"assign-btn"},{default:t(()=>[...i[8]||(i[8]=[v(" 分配 ",-1)])]),_:1},8,["onClick"]))]),e("div",Ms,[s(D,{modelValue:n.value,"onUpdate:modelValue":i[3]||(i[3]=fe=>n.value=fe),value:k.id,onClick:i[4]||(i[4]=he(()=>{},["stop"]))},null,8,["modelValue","value"])])],10,Ws))),128))]),M.value.length===0?(p(),b("div",et,[s(C,{description:"暂无可分配的用户"})])):se("",!0)]),w.value.length>0?(p(),b("div",st,[e("div",tt,[i[10]||(i[10]=e("h4",null,"已分配用户",-1)),e("span",lt,u(w.value.length)+" 人",1)]),e("div",ot,[(p(!0),b(Q,null,Y(w.value,k=>(p(),b("div",{key:k.id,class:"assigned-user"},[s($,{size:32,src:k.avatar},{default:t(()=>[v(u(k.name.charAt(0)),1)]),_:2},1032,["src"]),e("span",nt,u(k.name),1),e("span",at,u(k.employeeId),1),s(H,{size:"small",type:"danger",link:"",onClick:fe=>P(k)},{default:t(()=>[...i[11]||(i[11]=[v(" 移除 ",-1)])]),_:1},8,["onClick"])]))),128))])])):se("",!0)])]}),_:1},8,["modelValue"])}}}),rt=$e(dt,[["__scopeId","data-v-fee92dc7"]]),ct={class:"dialog-content"},ut={class:"role-info-section"},mt={class:"role-header"},pt={class:"role-details"},vt={class:"role-name"},_t={class:"role-desc"},ft={class:"role-meta"},gt={class:"department-name"},yt={class:"permission-count"},ht={class:"permission-stats"},bt={class:"stat-item"},kt={class:"stat-icon total"},$t={class:"stat-content"},Ct={class:"stat-number"},Vt={class:"stat-item"},wt={class:"stat-icon modules"},xt={class:"stat-content"},It={class:"stat-number"},Ut={class:"stat-item"},St={class:"stat-icon level"},zt={class:"stat-content"},Et={class:"stat-number"},Rt={class:"permissions-section"},Tt={class:"section-header"},Pt={class:"view-options"},Dt={key:0,class:"category-view"},At={class:"category-header"},Bt={class:"category-info"},Nt={class:"category-name"},Lt={class:"category-count"},Ot={class:"category-progress"},Ft={class:"category-permissions"},qt={class:"permission-icon"},jt={class:"permission-content"},Wt={class:"permission-name"},Jt={class:"permission-desc"},Qt={class:"permission-level"},Yt={key:1,class:"list-view"},Zt={class:"permission-name-cell"},Gt={key:0,class:"comparison-section"},Ht={class:"section-header"},Xt={class:"comparison-content"},Kt={class:"dialog-footer"},Mt=be({__name:"PermissionDetailDialog",props:{modelValue:{type:Boolean},role:{}},emits:["update:modelValue"],setup(R,{emit:le}){const I=R,j=le,B=ke(),N=x("category"),L=x(!1),V=Z({get:()=>I.modelValue,set:g=>j("update:modelValue",g)}),n={"customer:read":{key:"customer:read",name:"查看客户",description:"查看客户基本信息和详情",module:"客户管理"},"customer:write":{key:"customer:write",name:"编辑客户",description:"创建、修改客户信息",module:"客户管理"},"customer:delete":{key:"customer:delete",name:"删除客户",description:"删除客户记录",module:"客户管理"},"customer:export":{key:"customer:export",name:"导出客户",description:"导出客户数据",module:"客户管理"},"customer:import":{key:"customer:import",name:"导入客户",description:"批量导入客户数据",module:"客户管理"},"order:read":{key:"order:read",name:"查看订单",description:"查看订单信息和状态",module:"订单管理"},"order:write":{key:"order:write",name:"编辑订单",description:"创建、修改订单",module:"订单管理"},"order:audit":{key:"order:audit",name:"审核订单",description:"审核订单状态",module:"订单管理"},"order:cancel":{key:"order:cancel",name:"取消订单",description:"取消订单操作",module:"订单管理"},"order:refund":{key:"order:refund",name:"退款处理",description:"处理订单退款",module:"订单管理"},"finance:read":{key:"finance:read",name:"查看财务",description:"查看财务数据和报表",module:"财务管理"},"finance:write":{key:"finance:write",name:"编辑财务",description:"录入、修改财务数据",module:"财务管理"},"finance:audit":{key:"finance:audit",name:"财务审核",description:"审核财务单据",module:"财务管理"},"finance:report":{key:"finance:report",name:"财务报表",description:"生成财务报表",module:"财务管理"},"finance:settlement":{key:"finance:settlement",name:"结算管理",description:"处理结算业务",module:"财务管理"},"logistics:read":{key:"logistics:read",name:"查看物流",description:"查看物流信息",module:"物流管理"},"logistics:write":{key:"logistics:write",name:"编辑物流",description:"创建、修改物流单",module:"物流管理"},"logistics:track":{key:"logistics:track",name:"物流跟踪",description:"跟踪物流状态",module:"物流管理"},"logistics:warehouse":{key:"logistics:warehouse",name:"仓库管理",description:"管理仓库库存",module:"物流管理"},"service:read":{key:"service:read",name:"查看工单",description:"查看客服工单",module:"客服管理"},"service:write":{key:"service:write",name:"处理工单",description:"创建、处理工单",module:"客服管理"},"service:assign":{key:"service:assign",name:"分配工单",description:"分配工单给客服",module:"客服管理"},"service:close":{key:"service:close",name:"关闭工单",description:"关闭已处理工单",module:"客服管理"},"system:user":{key:"system:user",name:"用户管理",description:"管理系统用户",module:"系统管理"},"system:role":{key:"system:role",name:"角色管理",description:"管理用户角色",module:"系统管理"},"system:dept":{key:"system:dept",name:"部门管理",description:"管理部门结构",module:"系统管理"},"system:config":{key:"system:config",name:"系统配置",description:"配置系统参数",module:"系统管理"},"system:log":{key:"system:log",name:"日志查看",description:"查看系统日志",module:"系统管理"},"performance:read":{key:"performance:read",name:"查看绩效",description:"查看绩效数据",module:"绩效管理"}},w=Z(()=>{var m;if(!((m=I.role)!=null&&m.permissions))return[];const g=new Set;return I.role.permissions.forEach(q=>{const P=n[q];P&&g.add(P.module)}),Array.from(g)}),F=Z(()=>{var m;const g=((m=I.role)==null?void 0:m.permissions.length)||0;return g>=15?"高级":g>=8?"中级":g>=3?"基础":"无"}),T=Z(()=>{var m;if(!((m=I.role)!=null&&m.permissions))return[];const g={};return I.role.permissions.forEach(q=>{const P=n[q];if(P){const ee=P.key.split(":")[0];g[ee]||(g[ee]={key:ee,name:P.module,permissions:[]}),g[ee].permissions.push(P)}}),Object.values(g)}),W=Z(()=>{var g;return(g=I.role)!=null&&g.permissions?I.role.permissions.map(m=>n[m]||{key:m,name:m,description:"未知权限",module:"未知"}):[]}),J=g=>{if(!g)return"未知部门";const m=B.getDepartmentById(g);return(m==null?void 0:m.name)||"未知部门"},M=g=>{const m={manager:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",member:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",specialist:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",supervisor:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"};return m[g]||m.member},oe=g=>({manager:_e,member:ge,specialist:_e,supervisor:Ue})[g]||ge,ne=g=>({manager:"danger",member:"primary",specialist:"success",supervisor:"warning"})[g]||"primary",ue=g=>({manager:"部门负责人",member:"普通成员",specialist:"专员",supervisor:"主管"})[g]||"未知",ie=g=>{const m=Object.values(n).filter(q=>q.module===g.name);return m.length===0?100:Math.round(g.permissions.length/m.length*100)},de=g=>{const m=ie(g);return m>=80?"#67c23a":m>=50?"#e6a23c":"#f56c6c"},re=g=>g.includes("delete")||g.includes("audit")?"danger":g.includes("write")||g.includes("edit")?"warning":"success",ce=g=>g.includes("delete")||g.includes("audit")?"高级":g.includes("write")||g.includes("edit")?"中级":"基础",me=()=>{j("update:modelValue",!1)},G=()=>{const g=W.value.map(m=>({权限名称:m.name,权限描述:m.description,所属模块:m.module,权限等级:ce(m.key)}));console.log("导出数据:",g),ae.success("权限列表已导出")};return(g,m)=>{const q=_("el-icon"),P=_("el-tag"),ee=_("el-divider"),r=_("el-col"),c=_("el-row"),h=_("el-radio-button"),a=_("el-radio-group"),i=_("el-progress"),d=_("el-table-column"),o=_("el-table"),l=_("el-button"),U=_("el-empty"),S=_("el-dialog");return p(),O(S,{modelValue:V.value,"onUpdate:modelValue":m[3]||(m[3]=z=>V.value=z),title:"权限详情",width:"700px","before-close":me,class:"permission-detail-dialog"},{footer:t(()=>[e("div",Kt,[s(l,{onClick:G,class:"export-btn"},{default:t(()=>[s(q,null,{default:t(()=>[s(E(je))]),_:1}),m[12]||(m[12]=v(" 导出权限 ",-1))]),_:1}),s(l,{onClick:m[2]||(m[2]=z=>L.value=!L.value),class:"compare-btn"},{default:t(()=>[s(q,null,{default:t(()=>[s(E(We))]),_:1}),m[13]||(m[13]=v(" 权限对比 ",-1))]),_:1}),s(l,{type:"primary",onClick:me,class:"close-btn"},{default:t(()=>[...m[14]||(m[14]=[v(" 关闭 ",-1)])]),_:1})])]),default:t(()=>{var z,te,H,X,$,D;return[e("div",ct,[e("div",ut,[e("div",mt,[e("div",{class:"role-icon",style:xe({background:M((z=R.role)==null?void 0:z.type)})},[s(q,null,{default:t(()=>{var C;return[(p(),O(Ie(oe((C=R.role)==null?void 0:C.type))))]}),_:1})],4),e("div",pt,[e("h3",vt,u((te=R.role)==null?void 0:te.name),1),e("p",_t,u((H=R.role)==null?void 0:H.description),1),e("div",ft,[s(P,{type:ne((X=R.role)==null?void 0:X.type),size:"small"},{default:t(()=>{var C;return[v(u(ue((C=R.role)==null?void 0:C.type)),1)]}),_:1},8,["type"]),e("span",gt,u(J(($=R.role)==null?void 0:$.departmentId)),1),e("span",yt,u(((D=R.role)==null?void 0:D.permissions.length)||0)+" 项权限",1)])])])]),s(ee),e("div",ht,[s(c,{gutter:16},{default:t(()=>[s(r,{span:8},{default:t(()=>{var C;return[e("div",bt,[e("div",kt,[s(q,null,{default:t(()=>[s(E(Pe))]),_:1})]),e("div",$t,[e("div",Ct,u(((C=R.role)==null?void 0:C.permissions.length)||0),1),m[4]||(m[4]=e("div",{class:"stat-label"},"总权限数",-1))])])]}),_:1}),s(r,{span:8},{default:t(()=>[e("div",Vt,[e("div",wt,[s(q,null,{default:t(()=>[s(E(Fe))]),_:1})]),e("div",xt,[e("div",It,u(w.value.length),1),m[5]||(m[5]=e("div",{class:"stat-label"},"覆盖模块",-1))])])]),_:1}),s(r,{span:8},{default:t(()=>[e("div",Ut,[e("div",St,[s(q,null,{default:t(()=>[s(E(qe))]),_:1})]),e("div",zt,[e("div",Et,u(F.value),1),m[6]||(m[6]=e("div",{class:"stat-label"},"权限等级",-1))])])]),_:1})]),_:1})]),e("div",Rt,[e("div",Tt,[m[9]||(m[9]=e("h4",null,"权限详情",-1)),e("div",Pt,[s(a,{modelValue:N.value,"onUpdate:modelValue":m[0]||(m[0]=C=>N.value=C),size:"small"},{default:t(()=>[s(h,{value:"category"},{default:t(()=>[...m[7]||(m[7]=[v("按模块",-1)])]),_:1}),s(h,{value:"list"},{default:t(()=>[...m[8]||(m[8]=[v("列表",-1)])]),_:1})]),_:1},8,["modelValue"])])]),N.value==="category"?(p(),b("div",Dt,[(p(!0),b(Q,null,Y(T.value,C=>(p(),b("div",{key:C.key,class:"permission-category"},[e("div",At,[e("div",Bt,[e("h5",Nt,u(C.name),1),e("span",Lt,u(C.permissions.length)+" 项",1)]),e("div",Ot,[s(i,{percentage:ie(C),"stroke-width":6,"show-text":!1,color:de(C)},null,8,["percentage","color"])])]),e("div",Ft,[(p(!0),b(Q,null,Y(C.permissions,K=>(p(),b("div",{key:K.key,class:"permission-item"},[e("div",qt,[s(q,null,{default:t(()=>[s(E(ze))]),_:1})]),e("div",jt,[e("span",Wt,u(K.name),1),e("span",Jt,u(K.description),1)]),e("div",Qt,[s(P,{type:re(K.key),size:"small"},{default:t(()=>[v(u(ce(K.key)),1)]),_:2},1032,["type"])])]))),128))])]))),128))])):(p(),b("div",Yt,[s(o,{data:W.value,style:{width:"100%"}},{default:t(()=>[s(d,{prop:"name",label:"权限名称",width:"150"},{default:t(({row:C})=>[e("div",Zt,[s(q,{class:"permission-icon"},{default:t(()=>[s(E(ze))]),_:1}),e("span",null,u(C.name),1)])]),_:1}),s(d,{prop:"description",label:"权限描述","min-width":"200"}),s(d,{prop:"module",label:"所属模块",width:"120"},{default:t(({row:C})=>[s(P,{size:"small"},{default:t(()=>[v(u(C.module),1)]),_:2},1024)]),_:1}),s(d,{prop:"level",label:"权限等级",width:"100"},{default:t(({row:C})=>[s(P,{type:re(C.key),size:"small"},{default:t(()=>[v(u(ce(C.key)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]))]),L.value?(p(),b("div",Gt,[e("div",Ht,[m[11]||(m[11]=e("h4",null,"权限对比",-1)),s(l,{size:"small",type:"text",onClick:m[1]||(m[1]=C=>L.value=!1)},{default:t(()=>[...m[10]||(m[10]=[v(" 隐藏对比 ",-1)])]),_:1})]),e("div",Xt,[s(U,{description:"暂无对比数据"})])])):se("",!0)])]}),_:1},8,["modelValue"])}}}),el=$e(Mt,[["__scopeId","data-v-7e0ff117"]]),sl={class:"config-target-section"},tl={key:0,class:"target-selection"},ll={class:"target-item"},ol={class:"target-info"},nl={class:"target-name"},al={class:"target-desc"},il={key:0,class:"target-stats"},dl={key:1,class:"target-stats"},rl={key:0,class:"config-method-section"},cl={key:0,class:"template-selection"},ul={class:"template-option"},ml={key:0,class:"template-preview"},pl={class:"permission-tags"},vl={key:1,class:"custom-permissions"},_l={class:"permission-categories"},fl={class:"category-header"},gl={class:"category-count"},yl={class:"category-permissions"},hl={key:2,class:"copy-source"},bl={class:"copy-source-option"},kl={key:1,class:"config-preview"},$l={class:"preview-details"},Cl={class:"affected-targets"},Vl={class:"target-list"},wl={class:"permission-summary"},xl={class:"summary-stats"},Il={class:"dialog-footer"},Ul=be({__name:"BatchConfigDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(R,{emit:le}){const I=R,j=le,B=ke(),N=Z({get:()=>I.modelValue,set:d=>j("update:modelValue",d)}),L=x(!1),V=x("roles"),n=x("template"),w=x([]),F=x(""),T=x([]),W=x(""),J=x([{id:"sales",name:"销售人员",permissions:["customer.view","customer.create","customer.edit","order.view","order.create"]},{id:"manager",name:"部门经理",permissions:["customer.all","order.all","report.view","team.manage"]},{id:"audit",name:"审核人员",permissions:["order.audit","customer.audit","report.view"]},{id:"finance",name:"财务人员",permissions:["order.finance","report.finance","customer.finance"]}]),M=x([{id:"customer",name:"客户管理",checked:!1,indeterminate:!1,checkedCount:0,permissions:[{id:"customer.view",name:"查看客户"},{id:"customer.create",name:"创建客户"},{id:"customer.edit",name:"编辑客户"},{id:"customer.delete",name:"删除客户"},{id:"customer.export",name:"导出客户"}]},{id:"order",name:"订单管理",checked:!1,indeterminate:!1,checkedCount:0,permissions:[{id:"order.view",name:"查看订单"},{id:"order.create",name:"创建订单"},{id:"order.edit",name:"编辑订单"},{id:"order.delete",name:"删除订单"},{id:"order.audit",name:"审核订单"}]},{id:"report",name:"报表管理",checked:!1,indeterminate:!1,checkedCount:0,permissions:[{id:"report.view",name:"查看报表"},{id:"report.export",name:"导出报表"},{id:"report.create",name:"创建报表"}]}]),oe=Z(()=>V.value==="roles"?B.roles.map(d=>{var o;return{key:d.id,label:d.name,description:d.description,userCount:d.userCount||0,permissionCount:((o=d.permissions)==null?void 0:o.length)||0}}):B.departments.map(d=>({key:d.id,label:d.name,description:d.description||"",memberCount:d.memberCount||0,level:d.level}))),ne=Z(()=>{const d=V.value==="roles"?"角色":"部门";return[`可选${d}`,`已选${d}`]}),ue=Z(()=>V.value==="roles"?"搜索角色":"搜索部门"),ie=Z(()=>{const d=[];return V.value==="roles"&&d.push({label:"角色",options:B.roles.map(o=>{var l;return{value:`role_${o.id}`,label:o.name,permissionCount:((l=o.permissions)==null?void 0:l.length)||0}})}),d.push({label:"部门",options:B.departments.map(o=>{var l;return{value:`dept_${o.id}`,label:o.name,permissionCount:((l=o.permissions)==null?void 0:l.length)||0}})}),d}),de=Z(()=>w.value.length>0&&(n.value==="template"&&F.value||n.value==="custom"&&T.value.length>0||n.value==="copy"&&W.value)),re=Z(()=>de.value&&!L.value);we(T,()=>{G()},{deep:!0});const ce=()=>{w.value=[],h()},me=d=>{d.checked?d.permissions.forEach(o=>{T.value.includes(o.id)||T.value.push(o.id)}):d.permissions.forEach(o=>{const l=T.value.indexOf(o.id);l>-1&&T.value.splice(l,1)}),G()},G=()=>{M.value.forEach(d=>{const o=d.permissions.filter(l=>T.value.includes(l.id)).length;d.checkedCount=o,d.checked=o===d.permissions.length,d.indeterminate=o>0&&o<d.permissions.length})},g=d=>{const o=J.value.find(l=>l.id===d);return(o==null?void 0:o.permissions)||[]},m=d=>{for(const o of M.value){const l=o.permissions.find(U=>U.id===d);if(l)return l.name}return d},q=d=>{const o=oe.value.find(l=>l.key===d);return(o==null?void 0:o.label)||d},P=()=>{if(n.value==="template"&&F.value)return g(F.value);if(n.value==="custom")return T.value;if(n.value==="copy"&&W.value){const[d,o]=W.value.split("_");if(d==="role"){const l=B.roles.find(U=>U.id===o);return(l==null?void 0:l.permissions)||[]}else if(d==="dept"){const l=B.departments.find(U=>U.id===o);return(l==null?void 0:l.permissions)||[]}}return[]},ee=()=>{const d=P(),o=new Set;return d.forEach(l=>{const U=l.split(".")[0];o.add(U)}),Array.from(o)},r=()=>{const d=P();return d.length>=15?"高级":d.length>=8?"中级":d.length>=3?"基础":"无"},c=()=>{V.value="roles",n.value="template",w.value=[],F.value="",T.value=[],W.value="",G()},h=()=>{n.value="template",F.value="",T.value=[],W.value="",G()},a=()=>{N.value=!1,c()},i=()=>Ve(this,null,function*(){try{yield Je.confirm(`确认为 ${w.value.length} 个${V.value==="roles"?"角色":"部门"}配置权限？`,"确认操作",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),L.value=!0;const d=P();V.value==="roles"?yield B.batchUpdateRolePermissions(w.value,d):yield B.batchUpdatePermissions(w.value,d),ae.success("批量权限配置成功"),j("success"),a()}catch(d){d!=="cancel"&&ae.error("批量权限配置失败")}finally{L.value=!1}});return(d,o)=>{const l=_("el-radio"),U=_("el-radio-group"),S=_("el-tag"),z=_("el-transfer"),te=_("el-option"),H=_("el-select"),X=_("el-checkbox"),$=_("el-checkbox-group"),D=_("el-option-group"),C=_("el-alert"),K=_("el-statistic"),pe=_("el-button"),ye=_("el-dialog");return p(),O(ye,{modelValue:N.value,"onUpdate:modelValue":o[6]||(o[6]=y=>N.value=y),title:"批量权限配置",width:"900px","before-close":a,class:"batch-config-dialog"},{footer:t(()=>[e("div",Il,[s(pe,{onClick:a},{default:t(()=>[...o[17]||(o[17]=[v("取消",-1)])]),_:1}),s(pe,{onClick:c},{default:t(()=>[...o[18]||(o[18]=[v("重置",-1)])]),_:1}),s(pe,{type:"primary",onClick:i,loading:L.value,disabled:!re.value},{default:t(()=>[...o[19]||(o[19]=[v(" 确认配置 ",-1)])]),_:1},8,["loading","disabled"])])]),default:t(()=>[e("div",sl,[o[9]||(o[9]=e("h4",null,"配置目标",-1)),s(U,{modelValue:V.value,"onUpdate:modelValue":o[0]||(o[0]=y=>V.value=y),onChange:ce},{default:t(()=>[s(l,{value:"roles"},{default:t(()=>[...o[7]||(o[7]=[v("按角色配置",-1)])]),_:1}),s(l,{value:"departments"},{default:t(()=>[...o[8]||(o[8]=[v("按部门配置",-1)])]),_:1})]),_:1},8,["modelValue"]),V.value?(p(),b("div",tl,[s(z,{modelValue:w.value,"onUpdate:modelValue":o[1]||(o[1]=y=>w.value=y),data:oe.value,titles:ne.value,"button-texts":["移除","添加"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},filterable:"","filter-placeholder":ue.value,style:{"text-align":"left",display:"inline-block"}},{default:t(({option:y})=>[e("div",ll,[e("div",ol,[e("span",nl,u(y.label),1),e("span",al,u(y.description),1)]),V.value==="roles"?(p(),b("div",il,[s(S,{size:"small",type:"info"},{default:t(()=>[v(u(y.userCount)+"人",1)]),_:2},1024),s(S,{size:"small",type:"success"},{default:t(()=>[v(u(y.permissionCount)+"权限",1)]),_:2},1024)])):(p(),b("div",dl,[s(S,{size:"small",type:"info"},{default:t(()=>[v(u(y.memberCount)+"成员",1)]),_:2},1024),s(S,{size:"small",type:"warning"},{default:t(()=>[v(u(y.level)+"级",1)]),_:2},1024)]))])]),_:1},8,["modelValue","data","titles","filter-placeholder"])])):se("",!0)]),w.value.length>0?(p(),b("div",rl,[o[14]||(o[14]=e("h4",null,"配置方式",-1)),s(U,{modelValue:n.value,"onUpdate:modelValue":o[2]||(o[2]=y=>n.value=y)},{default:t(()=>[s(l,{value:"template"},{default:t(()=>[...o[10]||(o[10]=[v("使用权限模板",-1)])]),_:1}),s(l,{value:"custom"},{default:t(()=>[...o[11]||(o[11]=[v("自定义权限",-1)])]),_:1}),s(l,{value:"copy"},{default:t(()=>[...o[12]||(o[12]=[v("复制现有权限",-1)])]),_:1})]),_:1},8,["modelValue"]),n.value==="template"?(p(),b("div",cl,[s(H,{modelValue:F.value,"onUpdate:modelValue":o[3]||(o[3]=y=>F.value=y),placeholder:"选择权限模板",style:{width:"300px"}},{default:t(()=>[(p(!0),b(Q,null,Y(J.value,y=>(p(),O(te,{key:y.id,label:y.name,value:y.id},{default:t(()=>[e("div",ul,[e("span",null,u(y.name),1),s(S,{size:"small",type:"info"},{default:t(()=>[v(u(y.permissions.length)+"项权限",1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),F.value?(p(),b("div",ml,[o[13]||(o[13]=e("h5",null,"模板权限预览：",-1)),e("div",pl,[(p(!0),b(Q,null,Y(g(F.value),y=>(p(),O(S,{key:y,size:"small",style:{margin:"2px"}},{default:t(()=>[v(u(m(y)),1)]),_:2},1024))),128))])])):se("",!0)])):se("",!0),n.value==="custom"?(p(),b("div",vl,[e("div",_l,[(p(!0),b(Q,null,Y(M.value,y=>(p(),b("div",{key:y.id,class:"category-section"},[e("div",fl,[s(X,{modelValue:y.checked,"onUpdate:modelValue":A=>y.checked=A,indeterminate:y.indeterminate,onChange:A=>me(y)},{default:t(()=>[v(u(y.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","indeterminate","onChange"]),e("span",gl,"("+u(y.checkedCount)+"/"+u(y.permissions.length)+")",1)]),e("div",yl,[s($,{modelValue:T.value,"onUpdate:modelValue":o[4]||(o[4]=A=>T.value=A)},{default:t(()=>[(p(!0),b(Q,null,Y(y.permissions,A=>(p(),O(X,{key:A.id,value:A.id,label:A.name},null,8,["value","label"]))),128))]),_:2},1032,["modelValue"])])]))),128))])])):se("",!0),n.value==="copy"?(p(),b("div",hl,[s(H,{modelValue:W.value,"onUpdate:modelValue":o[5]||(o[5]=y=>W.value=y),placeholder:"选择权限复制源",style:{width:"300px"}},{default:t(()=>[(p(!0),b(Q,null,Y(ie.value,y=>(p(),O(D,{key:y.label,label:y.label},{default:t(()=>[(p(!0),b(Q,null,Y(y.options,A=>(p(),O(te,{key:A.value,label:A.label,value:A.value},{default:t(()=>[e("div",bl,[e("span",null,u(A.label),1),s(S,{size:"small",type:"success"},{default:t(()=>[v(u(A.permissionCount)+"权限",1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])):se("",!0)])):se("",!0),de.value?(p(),b("div",kl,[o[16]||(o[16]=e("h4",null,"配置预览",-1)),s(C,{title:`将为 ${w.value.length} 个${V.value==="roles"?"角色":"部门"}配置权限`,type:"info","show-icon":"",closable:!1},null,8,["title"]),e("div",$l,[e("div",Cl,[e("h5",null,"影响的"+u(V.value==="roles"?"角色":"部门")+"：",1),e("div",Vl,[(p(!0),b(Q,null,Y(w.value,y=>(p(),O(S,{key:y,style:{margin:"2px"}},{default:t(()=>[v(u(q(y)),1)]),_:2},1024))),128))])]),e("div",wl,[o[15]||(o[15]=e("h5",null,"权限配置：",-1)),e("div",xl,[s(K,{title:"总权限数",value:P().length},null,8,["value"]),s(K,{title:"覆盖模块",value:ee().length},null,8,["value"]),s(K,{title:"权限等级",value:r(),"value-style":"color: #409EFF"},null,8,["value"])])])])])):se("",!0)]),_:1},8,["modelValue"])}}}),Sl=$e(Ul,[["__scopeId","data-v-b766eda9"]]),zl={class:"department-roles-container"},El={class:"page-header"},Rl={class:"header-actions"},Tl={class:"stats-section"},Pl={class:"stat-card"},Dl={class:"stat-icon roles"},Al={class:"stat-content"},Bl={class:"stat-number"},Nl={class:"stat-card"},Ll={class:"stat-icon departments"},Ol={class:"stat-content"},Fl={class:"stat-number"},ql={class:"stat-card"},jl={class:"stat-icon permissions"},Wl={class:"stat-content"},Jl={class:"stat-number"},Ql={class:"stat-card"},Yl={class:"stat-icon users"},Zl={class:"stat-content"},Gl={class:"stat-number"},Hl={class:"filter-section"},Xl={class:"roles-section"},Kl={class:"section-header"},Ml={class:"view-options"},eo={key:0,class:"roles-grid"},so=["onClick"],to={class:"role-header"},lo={class:"role-info"},oo={class:"role-details"},no={class:"role-name"},ao={class:"role-desc"},io={class:"role-meta"},ro={class:"meta-item"},co={class:"meta-value"},uo={class:"meta-item"},mo={class:"meta-item"},po={class:"meta-value"},vo={class:"meta-item"},_o={class:"meta-value"},fo={class:"role-permissions"},go={class:"permissions-header"},yo={class:"permissions-list"},ho={class:"role-actions"},bo={key:1,class:"roles-table"},ko={class:"role-name-cell"},$o={class:"table-actions"},Co=be({__name:"DepartmentRoles",setup(R){const le=ke(),I=x(""),j=x(""),B=x(""),N=x("card"),L=x(!1),V=x(!1),n=x(!1),w=x(!1),F=x(!1),T=x(null),W=x(!1),J=x([{id:"1",name:"销售部经理",description:"销售部门负责人，负责销售团队管理和业务决策",departmentId:"2",type:"manager",permissions:["customer:read","customer:write","order:read","order:write","performance:read"],userCount:1,createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"2",name:"销售专员",description:"销售部门普通成员，负责客户开发和订单处理",departmentId:"2",type:"member",permissions:["customer:read","customer:write","order:read","order:write"],userCount:8,createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"3",name:"审核主管",description:"审核部门负责人，负责订单审核和风险控制",departmentId:"3",type:"manager",permissions:["order:read","order:audit","customer:read","finance:read"],userCount:1,createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"4",name:"财务经理",description:"财务部门负责人，负责财务管理和报表分析",departmentId:"4",type:"manager",permissions:["finance:read","finance:write","finance:audit","finance:report"],userCount:1,createdAt:"2024-01-01",updatedAt:"2024-01-01"}]),M=Z(()=>{const o=new Set(J.value.map(S=>S.departmentId)),l=new Set(J.value.flatMap(S=>S.permissions)).size,U=J.value.reduce((S,z)=>S+z.userCount,0);return{totalRoles:J.value.length,departmentsWithRoles:o.size,totalPermissions:l,usersWithRoles:U}}),oe=Z(()=>{let o=J.value;if(I.value){const l=I.value.toLowerCase();o=o.filter(U=>U.name.toLowerCase().includes(l)||U.description.toLowerCase().includes(l))}return j.value&&(o=o.filter(l=>l.departmentId===j.value)),B.value&&(o=o.filter(l=>l.type===B.value)),o}),ne=o=>{const l=le.getDepartmentById(o);return(l==null?void 0:l.name)||"未知部门"},ue=o=>{const l={manager:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",member:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",specialist:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",supervisor:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"};return l[o]||l.member},ie=o=>({manager:_e,member:ge,specialist:_e,supervisor:Ue})[o]||ge,de=o=>({manager:"danger",member:"primary",specialist:"success",supervisor:"warning"})[o]||"primary",re=o=>({manager:"部门负责人",member:"普通成员",specialist:"专员",supervisor:"主管"})[o]||"未知",ce=o=>({"customer:read":"查看客户","customer:write":"编辑客户","order:read":"查看订单","order:write":"编辑订单","order:audit":"审核订单","finance:read":"查看财务","finance:write":"编辑财务","finance:audit":"财务审核","finance:report":"财务报表","performance:read":"查看绩效"})[o]||o,me=o=>new Date(o).toLocaleString("zh-CN"),G=()=>{I.value="",j.value="",B.value="",ae.success("数据已刷新")},g=()=>{T.value=null,W.value=!1,V.value=!0},m=o=>{T.value=o,W.value=!0,V.value=!0},q=o=>{console.log("查看角色:",o)},P=o=>{const l=J.value.findIndex(U=>U.id===o.id);l>-1&&(J.value.splice(l,1),ae.success("角色删除成功"))},ee=o=>{T.value=o,n.value=!0},r=o=>{T.value=o,w.value=!0},c=()=>{F.value=!0},h=({action:o,role:l})=>{switch(o){case"edit":m(l);break;case"copy":console.log("复制角色:",l);break;case"delete":P(l);break}},a=()=>{V.value=!1,ae.success(W.value?"角色更新成功":"角色创建成功")},i=()=>{n.value=!1,ae.success("用户分配成功")},d=()=>{F.value=!1,ae.success("批量配置成功")};return Ae(()=>{}),(o,l)=>{const U=_("el-button"),S=_("el-icon"),z=_("el-col"),te=_("el-row"),H=_("el-input"),X=_("el-option"),$=_("el-select"),D=_("el-radio-button"),C=_("el-radio-group"),K=_("el-dropdown-item"),pe=_("el-dropdown-menu"),ye=_("el-dropdown"),y=_("el-tag"),A=_("el-table-column"),Ce=_("el-popconfirm"),k=_("el-table"),fe=Be("loading");return p(),b("div",zl,[e("div",El,[l[10]||(l[10]=e("div",{class:"header-left"},[e("h2",{class:"page-title"},"部门角色权限"),e("p",{class:"page-desc"},"管理不同部门的角色权限配置，包括部门负责人、普通成员等角色")],-1)),e("div",Rl,[s(U,{type:"primary",icon:E(Qe),onClick:g,class:"add-btn"},{default:t(()=>[...l[8]||(l[8]=[v(" 新建角色 ",-1)])]),_:1},8,["icon"]),s(U,{icon:E(Ye),onClick:c,class:"batch-btn"},{default:t(()=>[...l[9]||(l[9]=[v(" 批量配置 ",-1)])]),_:1},8,["icon"])])]),e("div",Tl,[s(te,{gutter:20},{default:t(()=>[s(z,{span:6},{default:t(()=>[e("div",Pl,[e("div",Dl,[s(S,null,{default:t(()=>[s(E(Ze))]),_:1})]),e("div",Al,[e("div",Bl,u(M.value.totalRoles),1),l[11]||(l[11]=e("div",{class:"stat-label"},"总角色数",-1))])])]),_:1}),s(z,{span:6},{default:t(()=>[e("div",Nl,[e("div",Ll,[s(S,null,{default:t(()=>[s(E(Ge))]),_:1})]),e("div",Ol,[e("div",Fl,u(M.value.departmentsWithRoles),1),l[12]||(l[12]=e("div",{class:"stat-label"},"已配置部门",-1))])])]),_:1}),s(z,{span:6},{default:t(()=>[e("div",ql,[e("div",jl,[s(S,null,{default:t(()=>[s(E(Pe))]),_:1})]),e("div",Wl,[e("div",Jl,u(M.value.totalPermissions),1),l[13]||(l[13]=e("div",{class:"stat-label"},"权限总数",-1))])])]),_:1}),s(z,{span:6},{default:t(()=>[e("div",Ql,[e("div",Yl,[s(S,null,{default:t(()=>[s(E(He))]),_:1})]),e("div",Zl,[e("div",Gl,u(M.value.usersWithRoles),1),l[14]||(l[14]=e("div",{class:"stat-label"},"已分配用户",-1))])])]),_:1})]),_:1})]),e("div",Hl,[s(te,{gutter:20,align:"middle"},{default:t(()=>[s(z,{span:6},{default:t(()=>[s(H,{modelValue:I.value,"onUpdate:modelValue":l[0]||(l[0]=f=>I.value=f),placeholder:"搜索角色名称","prefix-icon":E(Re),clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),s(z,{span:6},{default:t(()=>[s($,{modelValue:j.value,"onUpdate:modelValue":l[1]||(l[1]=f=>j.value=f),placeholder:"选择部门",clearable:""},{default:t(()=>[s(X,{label:"全部部门",value:""}),(p(!0),b(Q,null,Y(E(le).departmentList,f=>(p(),O(X,{key:f.id,label:f.name,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(z,{span:6},{default:t(()=>[s($,{modelValue:B.value,"onUpdate:modelValue":l[2]||(l[2]=f=>B.value=f),placeholder:"角色类型",clearable:""},{default:t(()=>[s(X,{label:"全部类型",value:""}),s(X,{label:"部门负责人",value:"manager"}),s(X,{label:"普通成员",value:"member"}),s(X,{label:"专员",value:"specialist"}),s(X,{label:"主管",value:"supervisor"})]),_:1},8,["modelValue"])]),_:1}),s(z,{span:6},{default:t(()=>[s(U,{icon:E(Te),onClick:G,class:"refresh-btn"},{default:t(()=>[...l[15]||(l[15]=[v(" 刷新 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1})]),e("div",Xl,[e("div",Kl,[l[18]||(l[18]=e("h3",null,"角色列表",-1)),e("div",Ml,[s(C,{modelValue:N.value,"onUpdate:modelValue":l[3]||(l[3]=f=>N.value=f),size:"small"},{default:t(()=>[s(D,{value:"card"},{default:t(()=>[...l[16]||(l[16]=[v("卡片视图",-1)])]),_:1}),s(D,{value:"table"},{default:t(()=>[...l[17]||(l[17]=[v("表格视图",-1)])]),_:1})]),_:1},8,["modelValue"])])]),N.value==="card"?(p(),b("div",eo,[(p(!0),b(Q,null,Y(oe.value,f=>(p(),b("div",{key:f.id,class:"role-card",onClick:ve=>q(f)},[e("div",to,[e("div",lo,[e("div",{class:"role-icon",style:xe({background:ue(f.type)})},[s(S,null,{default:t(()=>[(p(),O(Ie(ie(f.type))))]),_:2},1024)],4),e("div",oo,[e("h4",no,u(f.name),1),e("p",ao,u(f.description),1)])]),s(ye,{onCommand:h},{dropdown:t(()=>[s(pe,null,{default:t(()=>[s(K,{command:{action:"edit",role:f}},{default:t(()=>[...l[19]||(l[19]=[v("编辑",-1)])]),_:1},8,["command"]),s(K,{command:{action:"copy",role:f}},{default:t(()=>[...l[20]||(l[20]=[v("复制",-1)])]),_:1},8,["command"]),s(K,{command:{action:"delete",role:f},divided:""},{default:t(()=>[...l[21]||(l[21]=[v("删除",-1)])]),_:1},8,["command"])]),_:2},1024)]),default:t(()=>[s(U,{type:"text",icon:E(Xe)},null,8,["icon"])]),_:2},1024)]),e("div",io,[e("div",ro,[l[22]||(l[22]=e("span",{class:"meta-label"},"所属部门：",-1)),e("span",co,u(ne(f.departmentId)),1)]),e("div",uo,[l[23]||(l[23]=e("span",{class:"meta-label"},"角色类型：",-1)),s(y,{type:de(f.type),size:"small"},{default:t(()=>[v(u(re(f.type)),1)]),_:2},1032,["type"])]),e("div",mo,[l[24]||(l[24]=e("span",{class:"meta-label"},"权限数量：",-1)),e("span",po,u(f.permissions.length)+" 项",1)]),e("div",vo,[l[25]||(l[25]=e("span",{class:"meta-label"},"分配用户：",-1)),e("span",_o,u(f.userCount)+" 人",1)])]),e("div",fo,[e("div",go,[l[27]||(l[27]=e("span",null,"主要权限",-1)),s(U,{type:"text",size:"small",onClick:he(ve=>r(f),["stop"])},{default:t(()=>[...l[26]||(l[26]=[v(" 查看全部 ",-1)])]),_:1},8,["onClick"])]),e("div",yo,[(p(!0),b(Q,null,Y(f.permissions.slice(0,3),ve=>(p(),O(y,{key:ve,size:"small",class:"permission-tag"},{default:t(()=>[v(u(ce(ve)),1)]),_:2},1024))),128)),f.permissions.length>3?(p(),O(y,{key:0,size:"small",type:"info"},{default:t(()=>[v(" +"+u(f.permissions.length-3),1)]),_:2},1024)):se("",!0)])]),e("div",ho,[s(U,{size:"small",type:"primary",onClick:he(ve=>m(f),["stop"])},{default:t(()=>[...l[28]||(l[28]=[v(" 编辑 ",-1)])]),_:1},8,["onClick"]),s(U,{size:"small",type:"success",onClick:he(ve=>ee(f),["stop"])},{default:t(()=>[...l[29]||(l[29]=[v(" 分配用户 ",-1)])]),_:1},8,["onClick"])])],8,so))),128))])):(p(),b("div",bo,[Ne((p(),O(k,{data:oe.value},{default:t(()=>[s(A,{prop:"name",label:"角色名称",width:"200"},{default:t(({row:f})=>[e("div",ko,[e("div",{class:"role-icon-small",style:xe({background:ue(f.type)})},[s(S,null,{default:t(()=>[(p(),O(Ie(ie(f.type))))]),_:2},1024)],4),e("span",null,u(f.name),1)])]),_:1}),s(A,{prop:"departmentId",label:"所属部门",width:"150"},{default:t(({row:f})=>[v(u(ne(f.departmentId)),1)]),_:1}),s(A,{prop:"type",label:"角色类型",width:"120"},{default:t(({row:f})=>[s(y,{type:de(f.type),size:"small"},{default:t(()=>[v(u(re(f.type)),1)]),_:2},1032,["type"])]),_:1}),s(A,{prop:"permissions",label:"权限数量",width:"100"},{default:t(({row:f})=>[v(u(f.permissions.length)+" 项 ",1)]),_:1}),s(A,{prop:"userCount",label:"分配用户",width:"100"},{default:t(({row:f})=>[v(u(f.userCount)+" 人 ",1)]),_:1}),s(A,{prop:"updatedAt",label:"更新时间",width:"180"},{default:t(({row:f})=>[v(u(me(f.updatedAt)),1)]),_:1}),s(A,{label:"操作",width:"200",fixed:"right"},{default:t(({row:f})=>[e("div",$o,[s(U,{size:"small",type:"primary",link:"",onClick:ve=>m(f)},{default:t(()=>[...l[30]||(l[30]=[v(" 编辑 ",-1)])]),_:1},8,["onClick"]),s(U,{size:"small",type:"success",link:"",onClick:ve=>ee(f)},{default:t(()=>[...l[31]||(l[31]=[v(" 分配用户 ",-1)])]),_:1},8,["onClick"]),s(U,{size:"small",type:"info",link:"",onClick:ve=>r(f)},{default:t(()=>[...l[32]||(l[32]=[v(" 权限详情 ",-1)])]),_:1},8,["onClick"]),s(Ce,{title:"确定要删除这个角色吗？",onConfirm:ve=>P(f)},{reference:t(()=>[s(U,{size:"small",type:"danger",link:""},{default:t(()=>[...l[33]||(l[33]=[v("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])])]),_:1})]),_:1},8,["data"])),[[fe,L.value]])]))]),s(Us,{modelValue:V.value,"onUpdate:modelValue":l[4]||(l[4]=f=>V.value=f),role:T.value,"is-edit":W.value,onSuccess:a},null,8,["modelValue","role","is-edit"]),s(rt,{modelValue:n.value,"onUpdate:modelValue":l[5]||(l[5]=f=>n.value=f),role:T.value,onSuccess:i},null,8,["modelValue","role"]),s(el,{modelValue:w.value,"onUpdate:modelValue":l[6]||(l[6]=f=>w.value=f),role:T.value},null,8,["modelValue","role"]),s(Sl,{modelValue:F.value,"onUpdate:modelValue":l[7]||(l[7]=f=>F.value=f),onSuccess:d},null,8,["modelValue"])])}}}),zo=$e(Co,[["__scopeId","data-v-63677a32"]]);export{zo as default};
