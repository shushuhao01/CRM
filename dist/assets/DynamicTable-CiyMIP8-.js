var G=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var A=(a,i,r)=>i in a?G(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,W=(a,i)=>{for(var r in i||(i={}))Z.call(i,r)&&A(a,r,i[r]);if(M)for(var r of M(i))ee.call(i,r)&&A(a,r,i[r]);return a},H=(a,i)=>X(a,Y(i));import{i as te,ac as ae}from"./elementPlus-Bmwh7Rh8.js";import{l as F,r as D,e as J,c as R,ag as b,M as k,p as c,O as m,U as f,S as K,u as q,q as h,m as z,F as j,a9 as L,T as I,w as oe,aq as ne,Q as x,P as se,H as y,K as le}from"./vendor-D8Vxqhr-.js";import{_ as Q}from"./settings-CuxbDWOu.js";const ie={class:"column-settings-header"},re={class:"column-settings-container"},ue=["onDragstart","onDrop"],ce=F({__name:"TableColumnSettings",props:{columns:{},storageKey:{}},emits:["update:columns","columns-change"],setup(a,{expose:i,emit:r}){const v=a,d=r,o=D([]),p=D(-1),S=()=>{o.value=v.columns.map(e=>W({},e))},T=J(()=>o.value.filter(e=>e.visible)),C=()=>{const e={columns:o.value.map(t=>({prop:t.prop,visible:t.visible})),order:o.value.map(t=>t.prop)};localStorage.setItem(v.storageKey,JSON.stringify(e)),d("update:columns",[...o.value]),d("columns-change",[...o.value])},V=()=>{try{const e=localStorage.getItem(v.storageKey);if(e){const t=JSON.parse(e);if(t.columns&&t.columns.forEach(l=>{const s=o.value.find(u=>u.prop===l.prop);s&&(s.visible=l.visible)}),t.order){const l=[];if(v.storageKey==="customer-list-columns"){const s=o.value.find(u=>u.prop==="code");s&&(l.push(s),s.visible=!0)}t.order.forEach(s=>{const u=o.value.find(w=>w.prop===s);u&&!l.find(w=>w.prop===s)&&l.push(u)}),o.value.forEach(s=>{l.find(u=>u.prop===s.prop)||l.push(s)}),o.value=l}d("update:columns",[...o.value]),d("columns-change",[...o.value])}}catch(e){console.error("加载列设置失败:",e)}},$=()=>{S(),localStorage.removeItem(v.storageKey),d("update:columns",[...o.value]),d("columns-change",[...o.value])},N=e=>{e||C()},P=(e,t)=>{p.value=t,e.dataTransfer&&(e.dataTransfer.effectAllowed="move")},E=e=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move")},O=(e,t)=>{if(e.preventDefault(),p.value!==-1&&p.value!==t){const l=o.value[p.value],s=[...o.value];s.splice(p.value,1),s.splice(t,0,l),o.value=s,C()}p.value=-1},B=()=>{S(),V()};return R(()=>{B()}),i({loadColumnSettings:V,resetColumns:$,visibleColumns:T}),(e,t)=>{const l=b("el-icon"),s=b("el-button"),u=b("el-checkbox"),w=b("el-dropdown-menu"),n=b("el-dropdown");return c(),k(n,{trigger:"click",onVisibleChange:N,placement:"bottom-end"},{dropdown:m(()=>[f(w,{class:"column-settings-dropdown"},{default:m(()=>[h("div",ie,[t[2]||(t[2]=h("span",null,"列设置",-1)),f(s,{type:"text",size:"small",onClick:$,class:"reset-btn"},{default:m(()=>[...t[1]||(t[1]=[K(" 重置 ",-1)])]),_:1})]),h("div",re,[(c(!0),z(j,null,L(o.value,(g,U)=>(c(),z("div",{key:g.prop,class:"column-item",draggable:!0,onDragstart:_=>P(_,U),onDragover:E,onDrop:_=>O(_,U)},[f(l,{class:"drag-handle"},{default:m(()=>[f(q(ae))]),_:1}),f(u,{modelValue:g.visible,"onUpdate:modelValue":_=>g.visible=_,onChange:C,class:"column-checkbox"},{default:m(()=>[K(I(g.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])],40,ue))),128))])]),_:1})]),default:m(()=>[f(s,{size:"small"},{default:m(()=>[f(l,null,{default:m(()=>[f(q(te))]),_:1}),t[0]||(t[0]=K(" 列设置 ",-1))]),_:1})]),_:1})}}}),de=Q(ce,[["__scopeId","data-v-7e52ca52"]]),me={class:"dynamic-table-container"},pe={key:0,class:"table-header"},ge={class:"table-title"},fe={class:"table-actions"},he={key:1,class:"table-pagination"},ve={class:"pagination-stats"},be={class:"stats-text"},Ce={class:"pagination-controls"},we=F({__name:"DynamicTable",props:{data:{},columns:{},storageKey:{},title:{default:""},showHeader:{type:Boolean,default:!0},showColumnSettings:{type:Boolean,default:!0},showSelection:{type:Boolean,default:!1},showActions:{type:Boolean,default:!0},actionsWidth:{default:200},actionsMinWidth:{default:150},loading:{type:Boolean,default:!1},showPagination:{type:Boolean,default:!0},total:{default:0},pageSizes:{default:()=>[10,20,50,100]}},emits:["selection-change","sort-change","size-change","current-change"],setup(a,{expose:i,emit:r}){const v=a,d=r,o=D(),p=D(1),S=D(10),T=J(()=>v.columns.map(e=>H(W({},e),{visible:e.visible!==!1}))),C=D([]),V=(e,t)=>t.formatter?t.formatter(e,{}):e==null?"-":e,$=e=>{C.value=e.filter(t=>t.visible)},N=e=>{d("selection-change",e)},P=e=>{d("sort-change",e)},E=e=>{S.value=e,d("size-change",e)},O=e=>{p.value=e,d("current-change",e)},B=()=>{C.value=T.value.filter(e=>e.visible)};return oe(()=>v.columns,()=>{B(),o.value&&o.value.loadColumnSettings()},{immediate:!0}),R(()=>{B()}),i({resetColumns:()=>{var e;return(e=o.value)==null?void 0:e.resetColumns()},loadColumnSettings:()=>{var e;return(e=o.value)==null?void 0:e.loadColumnSettings()}}),(e,t)=>{const l=b("el-table-column"),s=b("el-table"),u=b("el-pagination"),w=ne("loading");return c(),z("div",me,[a.showHeader?(c(),z("div",pe,[h("div",ge,[y(e.$slots,"title",{},()=>[K(I(a.title),1)],!0)]),h("div",fe,[y(e.$slots,"header-actions",{},void 0,!0),a.showColumnSettings?(c(),k(de,{key:0,columns:T.value,"storage-key":a.storageKey,onColumnsChange:$,ref_key:"columnSettingsRef",ref:o},null,8,["columns","storage-key"])):x("",!0)])])):x("",!0),se((c(),k(s,le({data:a.data},e.$attrs,{onSelectionChange:N,onSortChange:P,stripe:"",border:""}),{default:m(()=>[a.showSelection?(c(),k(l,{key:0,type:"selection",width:"55"})):x("",!0),(c(!0),z(j,null,L(C.value,n=>(c(),k(l,{key:n.prop,prop:n.prop,label:n.label,width:n.width,"min-width":n.minWidth,sortable:n.sortable,align:n.align,fixed:n.fixed,"show-overflow-tooltip":n.showOverflowTooltip},{default:m(({row:g,column:U,$index:_})=>[y(e.$slots,`column-${n.prop}`,{row:g,column:n,value:g[n.prop],index:_},()=>[h("span",null,I(V(g[n.prop],n)),1)],!0)]),_:2},1032,["prop","label","width","min-width","sortable","align","fixed","show-overflow-tooltip"]))),128)),a.showActions?(c(),k(l,{key:1,label:"操作",width:a.actionsWidth,"min-width":a.actionsMinWidth,fixed:"right"},{default:m(({row:n,$index:g})=>[y(e.$slots,"table-actions",{row:n,index:g},void 0,!0)]),_:3},8,["width","min-width"])):x("",!0)]),_:3},16,["data"])),[[w,a.loading]]),a.showPagination?(c(),z("div",he,[h("div",ve,[y(e.$slots,"pagination-stats",{},()=>[h("span",be,"共 "+I(a.total)+" 条记录",1)],!0)]),h("div",Ce,[y(e.$slots,"pagination",{},()=>[f(u,{"current-page":p.value,"onUpdate:currentPage":t[0]||(t[0]=n=>p.value=n),"page-size":S.value,"onUpdate:pageSize":t[1]||(t[1]=n=>S.value=n),"page-sizes":a.pageSizes,total:a.total,layout:"sizes, prev, pager, next, jumper",onSizeChange:E,onCurrentChange:O},null,8,["current-page","page-size","page-sizes","total"])],!0)])])):x("",!0)])}}}),De=Q(we,[["__scopeId","data-v-bcb6139c"]]);export{De as D,de as T};
