var el=Object.defineProperty,ll=Object.defineProperties;var sl=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var tl=Object.prototype.hasOwnProperty,nl=Object.prototype.propertyIsEnumerable;var xe=(k,$,u)=>$ in k?el(k,$,{enumerable:!0,configurable:!0,writable:!0,value:u}):k[$]=u,ee=(k,$)=>{for(var u in $||($={}))tl.call($,u)&&xe(k,u,$[u]);if(Se)for(var u of Se($))nl.call($,u)&&xe(k,u,$[u]);return k},le=(k,$)=>ll(k,sl($));var Y=(k,$,u)=>new Promise((w,D)=>{var I=b=>{try{m(u.next(b))}catch(U){D(U)}},S=b=>{try{m(u.throw(b))}catch(U){D(U)}},m=b=>b.done?w(b.value):Promise.resolve(b.value).then(I,S);m((u=u.apply(k,$)).next())});import{l as ye,r as N,Z as Be,e as se,w as ve,ag as g,M as J,p as y,O as t,q as e,U as l,m as z,Q as me,T as p,S as r,n as fe,u as d,F as ne,a9 as ae,J as Ee,R as Ie,a2 as al,I as il,az as ol,c as dl,aq as rl,P as ze}from"./vendor-D8Vxqhr-.js";import{_ as be,c as cl}from"./settings-CuxbDWOu.js";import{E as x,F as _e,I as Te,O as ul,aj as ml,M as pl,H as vl,X as fl,t as _l,l as ge,i as Pe,aC as ie,e as he,f as gl,r as Fe,D as qe,J as hl,ar as yl,a0 as pe,p as Me,aP as bl,s as kl,x as wl,aQ as Ne,v as Ue,a7 as Le,P as Cl,ac as Oe,K as Ae}from"./elementPlus-Bmwh7Rh8.js";import{useDepartmentStore as ke}from"./department-CTOju6hT.js";import{D as $l}from"./DepartmentDialog-CYatLe97.js";import{D as Vl}from"./DynamicTable-CiyMIP8-.js";import"./utils-ywHRn0uI.js";import"./departmentPermissionService--eajZN4h.js";const Dl={class:"move-content"},Sl={class:"current-info"},xl={class:"info-item"},Il={class:"value"},zl={class:"info-item"},Tl={class:"value"},Pl={class:"info-item"},Ml={class:"value"},Nl={key:0,class:"preview-info"},Ul={class:"info-item"},Ll={class:"value"},Ol={class:"info-item"},Al={class:"value"},Bl={class:"info-item"},El={class:"value"},Fl={class:"dialog-footer"},ql=ye({__name:"MoveDepartmentDialog",props:{modelValue:{type:Boolean},department:{default:null}},emits:["update:modelValue","success"],setup(k,{emit:$}){const u=k,w=$,D=ke(),I=N(),S=N(!1),m=Be({newParentId:null,newSort:1}),b={newSort:[{required:!0,message:"请输入排序位置",trigger:"blur"}]},U={value:"id",label:"name",children:"children"},F=se(()=>{var v;if(!((v=u.department)!=null&&v.parentId))return null;const h=D.getDepartmentById(u.department.parentId);return h==null?void 0:h.name}),O=se(()=>{if(!u.department)return[];const h=v=>v.filter(T=>T.id===u.department.id?!1:!q(T.id,u.department.id)).map(T=>le(ee({},T),{children:T.children?h(T.children):[]}));return h(D.departmentTree)}),q=(h,v)=>{const T=(G,c)=>{for(const a of G){if(a.id===c)return a;if(a.children){const f=T(a.children,c);if(f)return f}}return null},Q=T(D.departmentTree,h);if(!Q)return!1;let M=Q;for(;M.parentId;){if(M.parentId===v)return!0;if(M=T(D.departmentTree,M.parentId)||M,!M.parentId)break}return!1},B=se(()=>{if(!u.department)return null;const h=m.newParentId?D.getDepartmentById(m.newParentId):null,v=h?h.level+1:1;return{newParentName:h==null?void 0:h.name,newLevel:v}}),A=()=>{Object.assign(m,{newParentId:null,newSort:1}),fe(()=>{var h;(h=I.value)==null||h.clearValidate()})},R=()=>{u.department?Object.assign(m,{newParentId:u.department.parentId,newSort:u.department.sort}):A()};ve(()=>u.modelValue,h=>{h&&R()}),ve(()=>u.department,()=>{u.modelValue&&R()});const X=()=>{w("update:modelValue",!1),A()},K=()=>Y(this,null,function*(){if(!(!I.value||!u.department))try{if(!(yield I.value.validate()))return;if(m.newParentId===u.department.parentId&&m.newSort===u.department.sort){x.warning("部门位置没有变化");return}S.value=!0,yield D.moveDepartment(u.department.id,m.newParentId,m.newSort),w("success")}catch(h){x.error(h instanceof Error?h.message:"移动失败")}finally{S.value=!1}});return(h,v)=>{const T=g("el-divider"),Q=g("el-tree-select"),M=g("el-form-item"),G=g("el-input-number"),c=g("el-form"),a=g("el-button"),f=g("el-dialog");return y(),J(f,{"model-value":k.modelValue,title:"移动部门",width:"500px","before-close":X,class:"move-dialog"},{footer:t(()=>[e("div",Fl,[l(a,{onClick:X,class:"cancel-btn"},{default:t(()=>[...v[10]||(v[10]=[r("取消",-1)])]),_:1}),l(a,{type:"primary",onClick:K,loading:S.value,class:"submit-btn"},{default:t(()=>[...v[11]||(v[11]=[r(" 确认移动 ",-1)])]),_:1},8,["loading"])])]),default:t(()=>{var C,j;return[e("div",Dl,[e("div",Sl,[v[5]||(v[5]=e("h4",null,"当前部门信息",-1)),e("div",xl,[v[2]||(v[2]=e("span",{class:"label"},"部门名称：",-1)),e("span",Il,p((C=k.department)==null?void 0:C.name),1)]),e("div",zl,[v[3]||(v[3]=e("span",{class:"label"},"当前层级：",-1)),e("span",Tl,p((j=k.department)==null?void 0:j.level)+"级",1)]),e("div",Pl,[v[4]||(v[4]=e("span",{class:"label"},"当前上级：",-1)),e("span",Ml,p(F.value||"无（顶级部门）"),1)])]),l(T),l(c,{ref_key:"formRef",ref:I,model:m,rules:b,"label-width":"100px"},{default:t(()=>[l(M,{label:"目标上级",prop:"newParentId"},{default:t(()=>[l(Q,{modelValue:m.newParentId,"onUpdate:modelValue":v[0]||(v[0]=H=>m.newParentId=H),data:O.value,props:U,placeholder:"请选择新的上级部门（留空为顶级部门）",clearable:"","check-strictly":"","render-after-expand":!1,style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),l(M,{label:"排序位置",prop:"newSort"},{default:t(()=>[l(G,{modelValue:m.newSort,"onUpdate:modelValue":v[1]||(v[1]=H=>m.newSort=H),min:1,max:999,placeholder:"在同级部门中的排序位置",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),B.value?(y(),z("div",Nl,[v[9]||(v[9]=e("h4",null,"移动预览",-1)),e("div",Ul,[v[6]||(v[6]=e("span",{class:"label"},"新上级部门：",-1)),e("span",Ll,p(B.value.newParentName||"无（顶级部门）"),1)]),e("div",Ol,[v[7]||(v[7]=e("span",{class:"label"},"新层级：",-1)),e("span",Al,p(B.value.newLevel)+"级",1)]),e("div",Bl,[v[8]||(v[8]=e("span",{class:"label"},"排序位置：",-1)),e("span",El,"第"+p(m.newSort)+"位",1)])])):me("",!0)])]}),_:1},8,["model-value"])}}}),Rl=be(ql,[["__scopeId","data-v-878b8fd0"]]),Ql={class:"dialog-header"},jl={class:"header-left"},Jl={class:"department-info"},Gl={class:"dept-avatar"},Hl={class:"dept-details"},Xl={class:"dept-name"},Zl={class:"dept-code"},Wl={class:"header-right"},Yl={class:"permission-stats"},Kl={class:"stat-item"},es={class:"stat-number"},ls={class:"stat-item"},ss={class:"stat-number"},ts={class:"action-bar"},ns={class:"action-left"},as={class:"section-title"},is={class:"action-right"},os={class:"template-section"},ds={class:"template-header"},rs={class:"template-grid"},cs=["onClick"],us={class:"template-icon"},ms={class:"template-content"},ps={class:"template-name"},vs={class:"template-desc"},fs={class:"template-badge"},_s={class:"permission-content"},gs={class:"permission-grid"},hs={class:"category-header"},ys={class:"category-title"},bs={class:"category-info"},ks={class:"category-text"},ws={class:"category-name"},Cs={class:"category-count"},$s={class:"permission-list"},Vs={class:"permission-info"},Ds={class:"permission-main"},Ss={class:"permission-name"},xs={class:"permission-desc"},Is={class:"dialog-footer"},zs={class:"footer-left"},Ts={class:"selected-summary"},Ps={class:"footer-right"},Ms=ye({__name:"PermissionDialog",props:{modelValue:{type:Boolean},department:{}},emits:["update:modelValue","success"],setup(k,{emit:$}){const u=k,w=$,D=ke(),I=N(!1),S=N(""),m=Be({permissions:[]}),b=[{key:"customer",name:"客户管理",icon:_e,color:"#3b82f6",permissions:[{key:"customer.view",name:"查看客户",description:"查看客户列表和详细信息",level:"basic"},{key:"customer.create",name:"新增客户",description:"创建新的客户记录",level:"basic"},{key:"customer.edit",name:"编辑客户",description:"修改客户信息",level:"advanced"},{key:"customer.delete",name:"删除客户",description:"删除客户记录",level:"admin"},{key:"customer.export",name:"导出客户",description:"导出客户数据",level:"advanced"},{key:"customer.import",name:"导入客户",description:"批量导入客户数据",level:"admin"}]},{key:"order",name:"订单管理",icon:ul,color:"#10b981",permissions:[{key:"order.view",name:"查看订单",description:"查看订单列表和详情",level:"basic"},{key:"order.create",name:"创建订单",description:"新建订单",level:"basic"},{key:"order.edit",name:"编辑订单",description:"修改订单信息",level:"advanced"},{key:"order.cancel",name:"取消订单",description:"取消订单",level:"advanced"},{key:"order.delete",name:"删除订单",description:"删除订单记录",level:"admin"},{key:"order.audit",name:"审核订单",description:"订单审核权限",level:"admin"}]},{key:"finance",name:"财务管理",icon:ml,color:"#f59e0b",permissions:[{key:"finance.view",name:"查看财务",description:"查看财务报表",level:"basic"},{key:"finance.invoice",name:"开具发票",description:"开具和管理发票",level:"advanced"},{key:"finance.payment",name:"付款管理",description:"处理付款事务",level:"advanced"},{key:"finance.report",name:"财务报告",description:"生成财务报告",level:"admin"},{key:"finance.audit",name:"财务审核",description:"财务数据审核",level:"admin"}]},{key:"logistics",name:"物流管理",icon:pl,color:"#8b5cf6",permissions:[{key:"logistics.view",name:"查看物流",description:"查看物流信息",level:"basic"},{key:"logistics.track",name:"物流跟踪",description:"跟踪物流状态",level:"basic"},{key:"logistics.manage",name:"物流管理",description:"管理物流配送",level:"advanced"},{key:"logistics.config",name:"物流配置",description:"配置物流参数",level:"admin"}]},{key:"service",name:"客服管理",icon:vl,color:"#06b6d4",permissions:[{key:"service.view",name:"查看工单",description:"查看客服工单",level:"basic"},{key:"service.handle",name:"处理工单",description:"处理客服工单",level:"basic"},{key:"service.assign",name:"分配工单",description:"分配工单给其他人",level:"advanced"},{key:"service.close",name:"关闭工单",description:"关闭已完成工单",level:"advanced"},{key:"service.report",name:"客服报告",description:"生成客服报告",level:"admin"}]},{key:"data",name:"资料管理",icon:fl,color:"#f59e0b",permissions:[{key:"data.view",name:"查看资料",description:"查看资料列表和详情",level:"basic"},{key:"data.search",name:"客户查询",description:"查询客户归属信息",level:"basic"},{key:"data.assign",name:"分配资料",description:"分配资料给其他成员",level:"advanced"},{key:"data.archive",name:"封存资料",description:"封存和恢复资料",level:"advanced"},{key:"data.export",name:"导出资料",description:"导出资料数据",level:"admin"}]},{key:"analytics",name:"数据分析",icon:_l,color:"#ef4444",permissions:[{key:"analytics.view",name:"查看报表",description:"查看数据报表",level:"basic"},{key:"analytics.export",name:"导出报表",description:"导出分析报表",level:"advanced"},{key:"analytics.custom",name:"自定义报表",description:"创建自定义报表",level:"admin"},{key:"analytics.dashboard",name:"数据看板",description:"访问数据看板",level:"admin"}]}],U=[{key:"basic",name:"基础权限",description:"适合普通员工的基础操作权限",icon:_e,count:10,permissions:["customer.view","customer.create","order.view","order.create","finance.view","logistics.view","service.view","analytics.view","data.view","data.search"]},{key:"advanced",name:"高级权限",description:"适合主管级别的进阶操作权限",icon:Te,count:18,permissions:["customer.view","customer.create","customer.edit","customer.export","order.view","order.create","order.edit","order.cancel","finance.view","finance.invoice","finance.payment","logistics.view","logistics.track","logistics.manage","service.view","service.handle","service.assign","service.close","analytics.view","analytics.export","data.view","data.search","data.assign"]},{key:"admin",name:"管理员权限",description:"拥有所有操作权限，适合管理员",icon:ge,count:25,permissions:b.flatMap(c=>c.permissions.map(a=>a.key))},{key:"custom",name:"自定义权限",description:"根据需要自由选择权限组合",icon:Pe,count:0,permissions:[]}],F=se(()=>b.reduce((c,a)=>c+a.permissions.length,0)),O=c=>{const a={basic:{text:"基础",type:"success"},advanced:{text:"高级",type:"warning"},admin:{text:"管理",type:"danger"}};return a[c]||a.basic},q=c=>{const a=b.find(f=>f.key===c);return a?a.permissions.every(f=>m.permissions.includes(f.key)):!1},B=c=>{const a=b.find(C=>C.key===c);if(!a)return!1;const f=a.permissions.filter(C=>m.permissions.includes(C.key)).length;return f>0&&f<a.permissions.length},A=c=>{const a=b.find(f=>f.key===c);return a?a.permissions.filter(f=>m.permissions.includes(f.key)).length:0},R=(c,a)=>{const f=b.find(C=>C.key===c);f&&(a?f.permissions.forEach(C=>{m.permissions.includes(C.key)||m.permissions.push(C.key)}):f.permissions.forEach(C=>{const j=m.permissions.indexOf(C.key);j>-1&&m.permissions.splice(j,1)}))},X=()=>b.filter(c=>A(c.key)>0).map(c=>c.key),K=c=>{const a=b.find(f=>f.key===c);return(a==null?void 0:a.name)||c},h=()=>{m.permissions=b.flatMap(c=>c.permissions.map(a=>a.key))},v=()=>{m.permissions=[],S.value=""},T=()=>{var c;m.permissions=[...((c=u.department)==null?void 0:c.permissions)||[]],S.value=""},Q=c=>{const a=U.find(f=>f.key===c);if(a){if(c==="custom"){S.value=c;return}m.permissions=[...a.permissions],S.value=c}},M=()=>{w("update:modelValue",!1)},G=()=>Y(this,null,function*(){if(!u.department){x.error("请先选择部门");return}I.value=!0;try{yield D.updateDepartmentPermissions(u.department.id,m.permissions),x.success("权限配置保存成功"),w("success"),M()}catch(c){x.error("保存失败，请重试")}finally{I.value=!1}});return ve(()=>u.department,c=>{c&&(m.permissions=[...c.permissions||[]])},{immediate:!0}),(c,a)=>{const f=g("el-icon"),C=g("el-button"),j=g("el-button-group"),H=g("el-checkbox"),te=g("el-tag"),oe=g("el-checkbox-group"),de=g("el-dialog");return y(),J(de,{"model-value":k.modelValue,title:"权限配置",width:"1200px","before-close":M,class:"permission-dialog","align-center":"","destroy-on-close":""},{footer:t(()=>[e("div",Is,[e("div",zs,[e("div",Ts,[l(f,null,{default:t(()=>[l(d(qe))]),_:1}),e("span",null,"已选择 "+p(m.permissions.length)+" 项权限",1),(y(!0),z(ne,null,ae(X(),Z=>(y(),J(te,{key:Z,size:"small",class:"category-tag"},{default:t(()=>[r(p(K(Z)),1)]),_:2},1024))),128))])]),e("div",Ps,[l(C,{onClick:M,size:"large"},{default:t(()=>[...a[10]||(a[10]=[r(" 取消 ",-1)])]),_:1}),l(C,{type:"primary",onClick:G,loading:I.value,size:"large"},{default:t(()=>[l(f,null,{default:t(()=>[l(d(he))]),_:1}),a[11]||(a[11]=r(" 保存配置 ",-1))]),_:1},8,["loading"])])])]),default:t(()=>{var Z,re;return[e("div",Ql,[e("div",jl,[e("div",Jl,[e("div",Gl,[l(f,null,{default:t(()=>[l(d(ie))]),_:1})]),e("div",Hl,[e("h3",Xl,p(((Z=k.department)==null?void 0:Z.name)||"未选择部门"),1),e("p",Zl,"部门编码："+p(((re=k.department)==null?void 0:re.code)||"暂无"),1)])])]),e("div",Wl,[e("div",Yl,[e("div",Kl,[e("span",es,p(m.permissions.length),1),a[2]||(a[2]=e("span",{class:"stat-label"},"已选权限",-1))]),a[4]||(a[4]=e("div",{class:"stat-divider"},null,-1)),e("div",ls,[e("span",ss,p(F.value),1),a[3]||(a[3]=e("span",{class:"stat-label"},"总权限数",-1))])])])]),e("div",ts,[e("div",ns,[e("h4",as,[l(f,null,{default:t(()=>[l(d(Pe))]),_:1}),a[5]||(a[5]=r(" 权限配置 ",-1))])]),e("div",is,[l(j,{class:"action-buttons"},{default:t(()=>[l(C,{onClick:h,type:"primary",plain:"",size:"small"},{default:t(()=>[l(f,null,{default:t(()=>[l(d(he))]),_:1}),a[6]||(a[6]=r(" 全选 ",-1))]),_:1}),l(C,{onClick:v,size:"small"},{default:t(()=>[l(f,null,{default:t(()=>[l(d(gl))]),_:1}),a[7]||(a[7]=r(" 清空 ",-1))]),_:1}),l(C,{onClick:T,size:"small"},{default:t(()=>[l(f,null,{default:t(()=>[l(d(Fe))]),_:1}),a[8]||(a[8]=r(" 重置 ",-1))]),_:1})]),_:1})])]),e("div",os,[e("div",ds,[l(f,null,{default:t(()=>[l(d(Te))]),_:1}),a[9]||(a[9]=e("span",null,"快捷模板",-1))]),e("div",rs,[(y(),z(ne,null,ae(U,V=>e("div",{key:V.key,onClick:L=>Q(V.key),class:Ee(["template-card",{active:S.value===V.key}])},[e("div",us,[l(f,null,{default:t(()=>[(y(),J(Ie(V.icon)))]),_:2},1024)]),e("div",ms,[e("h5",ps,p(V.name),1),e("p",vs,p(V.description),1)]),e("div",fs,[e("span",null,p(V.count)+"项",1)])],10,cs)),64))])]),e("div",_s,[e("div",gs,[(y(),z(ne,null,ae(b,V=>e("div",{key:V.key,class:"permission-category"},[e("div",hs,[e("div",ys,[l(H,{"model-value":q(V.key),indeterminate:B(V.key),onChange:L=>R(V.key,L),onClick:a[0]||(a[0]=al(()=>{},["stop"])),class:"category-checkbox"},{default:t(()=>[e("div",bs,[e("div",{class:"category-icon",style:il({backgroundColor:V.color})},[l(f,null,{default:t(()=>[(y(),J(Ie(V.icon)))]),_:2},1024)],4),e("div",ks,[e("span",ws,p(V.name),1),e("span",Cs,p(A(V.key))+"/"+p(V.permissions.length),1)])])]),_:2},1032,["model-value","indeterminate","onChange"])])]),e("div",$s,[l(oe,{modelValue:m.permissions,"onUpdate:modelValue":a[1]||(a[1]=L=>m.permissions=L)},{default:t(()=>[(y(!0),z(ne,null,ae(V.permissions,L=>(y(),z("div",{key:L.key,class:"permission-item"},[l(H,{value:L.key,class:"permission-checkbox"},{default:t(()=>[e("div",Vs,[e("div",Ds,[e("span",Ss,p(L.name),1),l(te,{type:O(L.level).type,size:"small",class:"permission-level"},{default:t(()=>[r(p(O(L.level).text),1)]),_:2},1032,["type"])]),e("p",xs,p(L.description),1)])]),_:2},1032,["value"])]))),128))]),_:2},1032,["modelValue"])])])),64))])])]}),_:1},8,["model-value"])}}}),Ns=be(Ms,[["__scopeId","data-v-cdbf6ec0"]]),Us={class:"departments-container"},Ls={class:"page-header"},Os={class:"header-actions"},As={class:"stats-cards"},Bs={class:"stat-card"},Es={class:"stat-icon total"},Fs={class:"stat-content"},qs={class:"stat-number"},Rs={class:"stat-card"},Qs={class:"stat-icon active"},js={class:"stat-content"},Js={class:"stat-number"},Gs={class:"stat-card"},Hs={class:"stat-icon members"},Xs={class:"stat-content"},Zs={class:"stat-number"},Ws={class:"stat-card"},Ys={class:"stat-icon hierarchy"},Ks={class:"stat-content"},et={class:"stat-number"},lt={class:"search-section"},st={class:"department-list-section"},tt={class:"section-header"},nt={class:"section-title"},at={class:"section-actions"},it={key:0,class:"department-cards-container"},ot={key:0,class:"empty-state"},dt={key:1,class:"department-cards-grid"},rt={class:"card-header"},ct={class:"department-info"},ut={class:"department-icon"},mt={class:"department-details"},pt={class:"department-name"},vt={class:"department-code"},ft={class:"department-status"},_t={class:"card-content"},gt={class:"info-table"},ht={class:"info-row"},yt={class:"info-value"},bt={class:"info-row"},kt={class:"info-value"},wt={class:"info-row"},Ct={class:"info-value"},$t={class:"info-row"},Vt={class:"info-value"},Dt={key:0,class:"info-row"},St={class:"info-value"},xt={class:"card-actions"},It={class:"action-buttons"},zt={key:0,class:"children-indicator"},Tt={key:1},Pt={class:"department-name-cell"},Mt={key:0},Nt={key:1,class:"text-gray"},Ut={class:"dialog-footer"},Lt=ye({__name:"Departments",setup(k){const $=ol(),u=cl($),w=ke(),D=N(""),I=N(""),S=N(""),m=N(!1),b=N(!1),U=N(!1),F=N(!1),O=N(null),q=N(!1),B=N("card"),A=se(()=>{let o=w.departmentTree;if(D.value){const s=D.value.toLowerCase();o=R(o,s)}return I.value&&(o=X(o,I.value)),S.value&&(o=K(o,parseInt(S.value))),o}),R=(o,s)=>o.filter(i=>{const _=i.name.toLowerCase().includes(s)||i.code.toLowerCase().includes(s),E=i.children&&i.children.length>0&&R(i.children,s).length>0;return _||E?le(ee({},i),{children:i.children?R(i.children,s):[]}):!1}).map(i=>le(ee({},i),{children:i.children?R(i.children,s):[]})),X=(o,s)=>o.filter(i=>i.status===s).map(i=>le(ee({},i),{children:i.children?X(i.children,s):[]})),K=(o,s)=>o.filter(i=>i.level===s).map(i=>le(ee({},i),{children:i.children?K(i.children,s):[]})),h=o=>["","primary","success","warning","danger"][o]||"info",v=o=>new Date(o).toLocaleString("zh-CN"),T=()=>{},Q=()=>{},M=()=>{D.value="",I.value="",S.value="",x.success("数据已刷新")},G=()=>{O.value=null,q.value=!1,m.value=!0},c=o=>{O.value=o,q.value=!0,m.value=!0},a=o=>{u.push(`/system/department/detail/${o.id}`)},f=o=>{O.value=o,U.value=!0},C=o=>{u.push(`/system/department/members/${o.id}`)},j=(o,s)=>{switch(o){case"permission":f(s);break;case"members":C(s);break;case"move":te(s);break;case"delete":oe(s);break}},H=o=>{u.push(`/system/department/members/${o.id}`)},te=o=>{O.value=o,b.value=!0},oe=o=>Y(this,null,function*(){try{yield w.deleteDepartment(o.id),x.success("部门删除成功")}catch(s){x.error(s instanceof Error?s.message:"删除失败")}}),de=o=>Y(this,null,function*(){const s=o.status,i=s==="active"?"启用":"禁用";try{o.statusLoading=!0,yield w.updateDepartmentStatus(o.id,s),x.success(`部门${i}成功`)}catch(_){o.status=s==="active"?"inactive":"active",x.error(_ instanceof Error?_.message:`${i}失败`)}finally{o.statusLoading=!1}}),Z=()=>{m.value=!1,fe(()=>Y(this,null,function*(){yield fe(),console.log("[Departments] 部门操作成功，当前部门数量:",w.departments.length),console.log("[Departments] 部门树结构:",w.departmentTree.length),console.log("[Departments] 过滤后的部门数量:",A.value.length),!q.value&&A.value.length===0&&w.departments.length>0&&(console.log("[Departments] 检测到新增部门但列表为空，重置过滤条件"),D.value="",I.value="",S.value="")})),x.success(q.value?"部门更新成功":"部门创建成功")},re=()=>{b.value=!1,x.success("部门移动成功")},V=()=>{U.value=!1,x.success("权限配置已保存")},L=()=>{u.push("/system/department-roles")},Re=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{x.success("已退出全屏模式")}).catch(()=>{x.error("退出全屏失败")}):document.documentElement.requestFullscreen().then(()=>{x.success("已进入全屏模式")}).catch(()=>{x.error("全屏模式不支持")})},Qe=()=>{F.value=!0},we=o=>{B.value=o},je=se(()=>[{prop:"statusSwitch",label:"启用状态",width:100,visible:!0,sortable:!1,showOverflowTooltip:!1,slot:"statusSwitch"},{prop:"name",label:"部门名称",width:200,visible:!0,sortable:!1,showOverflowTooltip:!0,slot:"name"},{prop:"code",label:"部门编码",width:120,visible:!0,sortable:!0,showOverflowTooltip:!1},{prop:"managerName",label:"部门负责人",width:120,visible:!0,sortable:!1,showOverflowTooltip:!1,slot:"managerName"},{prop:"memberCount",label:"成员数量",width:100,visible:!0,sortable:!0,showOverflowTooltip:!1,slot:"memberCount"},{prop:"level",label:"层级",width:80,visible:!0,sortable:!0,showOverflowTooltip:!1,slot:"level"},{prop:"status",label:"状态",width:100,visible:!0,sortable:!1,showOverflowTooltip:!1,slot:"status"},{prop:"updatedAt",label:"更新时间",width:180,visible:!0,sortable:!0,showOverflowTooltip:!1,slot:"updatedAt"}]),Je=o=>{console.log("列设置变化:",o)};return dl(()=>Y(this,null,function*(){try{console.log("[Departments] 开始初始化部门数据"),yield w.initData(),console.log("[Departments] 页面初始化完成，部门数量:",w.departments.length)}catch(o){console.error("[Departments] 初始化部门数据失败:",o),x.error("加载部门数据失败，请稍后重试")}})),(o,s)=>{const i=g("el-button"),_=g("el-icon"),E=g("el-col"),Ce=g("el-row"),Ge=g("el-input"),W=g("el-option"),$e=g("el-select"),He=g("el-button-group"),Xe=g("el-empty"),Ve=g("el-switch"),Ze=g("el-link"),ce=g("el-tag"),ue=g("el-dropdown-item"),We=g("el-dropdown-menu"),Ye=g("el-dropdown"),Ke=g("el-dialog"),De=rl("loading");return y(),z("div",Us,[e("div",Ls,[s[15]||(s[15]=e("h2",{class:"page-title"},"部门管理",-1)),e("div",Os,[l(i,{type:"warning",icon:d(hl),onClick:Qe,class:"guide-btn"},{default:t(()=>[...s[11]||(s[11]=[r(" 操作指南 ",-1)])]),_:1},8,["icon"]),l(i,{type:"success",icon:d(yl),onClick:Re,class:"fullscreen-btn"},{default:t(()=>[...s[12]||(s[12]=[r(" 全屏查看 ",-1)])]),_:1},8,["icon"]),l(i,{type:"info",icon:d(pe),onClick:L,class:"role-btn"},{default:t(()=>[...s[13]||(s[13]=[r(" 角色管理 ",-1)])]),_:1},8,["icon"]),l(i,{type:"primary",icon:d(Me),onClick:G,class:"add-btn"},{default:t(()=>[...s[14]||(s[14]=[r(" 新建部门 ",-1)])]),_:1},8,["icon"])])]),e("div",As,[l(Ce,{gutter:20},{default:t(()=>[l(E,{span:6},{default:t(()=>[e("div",Bs,[e("div",Es,[l(_,null,{default:t(()=>[l(d(ie))]),_:1})]),e("div",Fs,[e("div",qs,p(d(w).stats.totalDepartments),1),s[16]||(s[16]=e("div",{class:"stat-label"},"总部门数",-1))])])]),_:1}),l(E,{span:6},{default:t(()=>[e("div",Rs,[e("div",Qs,[l(_,null,{default:t(()=>[l(d(he))]),_:1})]),e("div",js,[e("div",Js,p(d(w).stats.activeDepartments),1),s[17]||(s[17]=e("div",{class:"stat-label"},"活跃部门",-1))])])]),_:1}),l(E,{span:6},{default:t(()=>[e("div",Gs,[e("div",Hs,[l(_,null,{default:t(()=>[l(d(_e))]),_:1})]),e("div",Xs,[e("div",Zs,p(d(w).stats.totalMembers),1),s[18]||(s[18]=e("div",{class:"stat-label"},"总成员数",-1))])])]),_:1}),l(E,{span:6},{default:t(()=>[e("div",Ws,[e("div",Ys,[l(_,null,{default:t(()=>[l(d(bl))]),_:1})]),e("div",Ks,[e("div",et,p(Object.keys(d(w).stats.departmentsByType).length),1),s[19]||(s[19]=e("div",{class:"stat-label"},"层级类型",-1))])])]),_:1})]),_:1})]),e("div",lt,[l(Ce,{gutter:20,align:"middle"},{default:t(()=>[l(E,{span:8},{default:t(()=>[l(Ge,{modelValue:D.value,"onUpdate:modelValue":s[0]||(s[0]=n=>D.value=n),placeholder:"搜索部门名称或编码","prefix-icon":d(kl),clearable:"",onInput:T},null,8,["modelValue","prefix-icon"])]),_:1}),l(E,{span:6},{default:t(()=>[l($e,{modelValue:I.value,"onUpdate:modelValue":s[1]||(s[1]=n=>I.value=n),placeholder:"部门状态",clearable:"",onChange:Q},{default:t(()=>[l(W,{label:"全部",value:""}),l(W,{label:"活跃",value:"active"}),l(W,{label:"停用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),l(E,{span:6},{default:t(()=>[l($e,{modelValue:S.value,"onUpdate:modelValue":s[2]||(s[2]=n=>S.value=n),placeholder:"部门层级",clearable:"",onChange:Q},{default:t(()=>[l(W,{label:"全部",value:""}),l(W,{label:"一级部门",value:"1"}),l(W,{label:"二级部门",value:"2"}),l(W,{label:"三级部门",value:"3"})]),_:1},8,["modelValue"])]),_:1}),l(E,{span:4},{default:t(()=>[l(i,{icon:d(Fe),onClick:M,class:"refresh-btn"},{default:t(()=>[...s[20]||(s[20]=[r(" 刷新 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1})]),e("div",st,[e("div",tt,[e("h3",nt,[l(_,null,{default:t(()=>[l(d(ie))]),_:1}),s[21]||(s[21]=r(" 部门列表 ",-1))]),e("div",at,[l(He,{class:"view-toggle"},{default:t(()=>[l(i,{type:B.value==="card"?"primary":"default",onClick:s[3]||(s[3]=n=>we("card")),size:"small"},{default:t(()=>[l(_,null,{default:t(()=>[l(d(wl))]),_:1}),s[22]||(s[22]=r(" 卡片 ",-1))]),_:1},8,["type"]),l(i,{type:B.value==="table"?"primary":"default",onClick:s[4]||(s[4]=n=>we("table")),size:"small"},{default:t(()=>[l(_,null,{default:t(()=>[l(d(qe))]),_:1}),s[23]||(s[23]=r(" 列表 ",-1))]),_:1},8,["type"])]),_:1}),l(i,{type:"primary",onClick:G},{default:t(()=>[l(_,null,{default:t(()=>[l(d(Me))]),_:1}),s[24]||(s[24]=r(" 新建部门 ",-1))]),_:1})])]),B.value==="card"?ze((y(),z("div",it,[A.value.length===0?(y(),z("div",ot,[l(Xe,{description:"暂无部门数据"})])):(y(),z("div",dt,[(y(!0),z(ne,null,ae(A.value,n=>(y(),z("div",{key:n.id,class:Ee(["department-card",{inactive:n.status==="inactive"}])},[e("div",rt,[e("div",ct,[e("div",ut,[n.level===1?(y(),J(_,{key:0},{default:t(()=>[l(d(ie))]),_:1})):(y(),J(_,{key:1},{default:t(()=>[l(d(Ne))]),_:1}))]),e("div",mt,[e("h4",pt,p(n.name),1),e("p",vt,p(n.code),1)])]),e("div",ft,[l(Ve,{modelValue:n.status,"onUpdate:modelValue":P=>n.status=P,"active-value":"active","inactive-value":"inactive",loading:n.statusLoading,onChange:P=>de(n)},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])])]),e("div",_t,[e("div",gt,[e("div",ht,[s[25]||(s[25]=e("span",{class:"info-label"},"负责人",-1)),e("span",yt,p(n.managerName||"未设置"),1)]),e("div",bt,[s[26]||(s[26]=e("span",{class:"info-label"},"成员数量",-1)),e("span",kt,[l(Ze,{type:"primary",onClick:P=>H(n)},{default:t(()=>[r(p(n.memberCount)+"人 ",1)]),_:2},1032,["onClick"])])]),e("div",wt,[s[27]||(s[27]=e("span",{class:"info-label"},"部门层级",-1)),e("span",Ct,[l(ce,{type:h(n.level),size:"small"},{default:t(()=>[r(p(n.level)+"级 ",1)]),_:2},1032,["type"])])]),e("div",$t,[s[28]||(s[28]=e("span",{class:"info-label"},"更新时间",-1)),e("span",Vt,p(v(n.updatedAt)),1)]),n.description?(y(),z("div",Dt,[s[29]||(s[29]=e("span",{class:"info-label"},"描述",-1)),e("span",St,p(n.description),1)])):me("",!0)])]),e("div",xt,[e("div",It,[l(i,{type:"primary",link:"",size:"small",onClick:P=>a(n)},{default:t(()=>[l(_,null,{default:t(()=>[l(d(Ue))]),_:1}),s[30]||(s[30]=r(" 详情 ",-1))]),_:1},8,["onClick"]),l(i,{type:"primary",link:"",size:"small",onClick:P=>c(n)},{default:t(()=>[l(_,null,{default:t(()=>[l(d(Le))]),_:1}),s[31]||(s[31]=r(" 编辑 ",-1))]),_:1},8,["onClick"]),l(Ye,{trigger:"click",onCommand:P=>j(P,n)},{dropdown:t(()=>[l(We,null,{default:t(()=>[l(ue,{command:"permission"},{default:t(()=>[l(_,null,{default:t(()=>[l(d(ge))]),_:1}),s[33]||(s[33]=r(" 权限配置 ",-1))]),_:1}),l(ue,{command:"members"},{default:t(()=>[l(_,null,{default:t(()=>[l(d(pe))]),_:1}),s[34]||(s[34]=r(" 成员配置 ",-1))]),_:1}),l(ue,{command:"move",disabled:n.level===1},{default:t(()=>[l(_,null,{default:t(()=>[l(d(Oe))]),_:1}),s[35]||(s[35]=r(" 移动部门 ",-1))]),_:1},8,["disabled"]),l(ue,{command:"delete",disabled:n.children&&n.children.length>0},{default:t(()=>[l(_,null,{default:t(()=>[l(d(Ae))]),_:1}),s[36]||(s[36]=r(" 删除部门 ",-1))]),_:1},8,["disabled"])]),_:2},1024)]),default:t(()=>[l(i,{type:"primary",link:"",size:"small"},{default:t(()=>[l(_,null,{default:t(()=>[l(d(Cl))]),_:1}),s[32]||(s[32]=r(" 更多 ",-1))]),_:1})]),_:2},1032,["onCommand"])])]),n.children&&n.children.length>0?(y(),z("div",zt,[e("span",null,p(n.children.length)+"个子部门",1)])):me("",!0)],2))),128))]))])),[[De,d(w).loading]]):B.value==="table"?ze((y(),z("div",Tt,[l(Vl,{data:A.value,columns:je.value,"show-selection":!1,"show-index":!0,"show-pagination":!0,"show-actions":!0,"actions-width":350,"page-size":20,total:A.value.length,onColumnSettingsChange:Je},{"column-statusSwitch":t(({row:n})=>[l(Ve,{modelValue:n.status,"onUpdate:modelValue":P=>n.status=P,"active-value":"active","inactive-value":"inactive",loading:n.statusLoading,onChange:P=>de(n)},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]),"column-name":t(({row:n})=>[e("div",Pt,[n.level===1?(y(),J(_,{key:0},{default:t(()=>[l(d(ie))]),_:1})):(y(),J(_,{key:1},{default:t(()=>[l(d(Ne))]),_:1})),e("span",null,p(n.name),1)])]),"column-managerName":t(({row:n})=>[n.managerName?(y(),z("span",Mt,p(n.managerName),1)):(y(),z("span",Nt,"未设置"))]),"column-memberCount":t(({row:n})=>[l(ce,{type:"info",size:"small"},{default:t(()=>[r(p(n.memberCount)+"人",1)]),_:2},1024)]),"column-level":t(({row:n})=>[l(ce,{type:h(n.level),size:"small"},{default:t(()=>[r(p(n.level)+"级 ",1)]),_:2},1032,["type"])]),"column-status":t(({row:n})=>[l(ce,{type:n.status==="active"?"success":"danger",size:"small"},{default:t(()=>[r(p(n.status==="active"?"活跃":"停用"),1)]),_:2},1032,["type"])]),"column-updatedAt":t(({row:n})=>[r(p(v(n.updatedAt)),1)]),"table-actions":t(({row:n})=>[l(i,{type:"primary",link:"",size:"small",onClick:P=>a(n)},{default:t(()=>[l(_,null,{default:t(()=>[l(d(Ue))]),_:1}),s[37]||(s[37]=r(" 详情 ",-1))]),_:1},8,["onClick"]),l(i,{type:"primary",link:"",size:"small",onClick:P=>c(n)},{default:t(()=>[l(_,null,{default:t(()=>[l(d(Le))]),_:1}),s[38]||(s[38]=r(" 编辑 ",-1))]),_:1},8,["onClick"]),l(i,{type:"primary",link:"",size:"small",onClick:P=>f(n)},{default:t(()=>[l(_,null,{default:t(()=>[l(d(ge))]),_:1}),s[39]||(s[39]=r(" 权限 ",-1))]),_:1},8,["onClick"]),l(i,{type:"primary",link:"",size:"small",onClick:P=>C(n)},{default:t(()=>[l(_,null,{default:t(()=>[l(d(pe))]),_:1}),s[40]||(s[40]=r(" 成员 ",-1))]),_:1},8,["onClick"]),l(i,{type:"warning",link:"",size:"small",onClick:P=>te(n),disabled:n.level===1},{default:t(()=>[l(_,null,{default:t(()=>[l(d(Oe))]),_:1}),s[41]||(s[41]=r(" 移动 ",-1))]),_:1},8,["onClick","disabled"]),l(i,{type:"danger",link:"",size:"small",onClick:P=>oe(n),disabled:n.children&&n.children.length>0},{default:t(()=>[l(_,null,{default:t(()=>[l(d(Ae))]),_:1}),s[42]||(s[42]=r(" 删除 ",-1))]),_:1},8,["onClick","disabled"])]),_:1},8,["data","columns","total"])])),[[De,d(w).loading]]):me("",!0)]),l($l,{modelValue:m.value,"onUpdate:modelValue":s[5]||(s[5]=n=>m.value=n),department:O.value,"is-edit":q.value,onSuccess:Z},null,8,["modelValue","department","is-edit"]),l(Rl,{modelValue:b.value,"onUpdate:modelValue":s[6]||(s[6]=n=>b.value=n),department:O.value,onSuccess:re},null,8,["modelValue","department"]),l(Ns,{modelValue:U.value,"onUpdate:modelValue":s[7]||(s[7]=n=>U.value=n),department:O.value,onSuccess:V},null,8,["modelValue","department"]),l(Ke,{modelValue:F.value,"onUpdate:modelValue":s[10]||(s[10]=n=>F.value=n),title:"部门管理与角色权限操作指南",width:"80%","close-on-click-modal":!1,class:"guide-dialog"},{footer:t(()=>[e("div",Ut,[l(i,{onClick:s[8]||(s[8]=n=>F.value=!1)},{default:t(()=>[...s[43]||(s[43]=[r("关闭",-1)])]),_:1}),l(i,{type:"primary",onClick:s[9]||(s[9]=n=>F.value=!1)},{default:t(()=>[...s[44]||(s[44]=[r("我知道了",-1)])]),_:1})])]),default:t(()=>[s[45]||(s[45]=e("div",{class:"guide-content"},[e("div",{class:"guide-section"},[e("h3",null,"📋 概述"),e("p",null,"本指南将帮助您理解和使用CRM系统中的部门管理和角色权限功能，确保您能够高效地管理组织架构和权限分配。")]),e("div",{class:"guide-section"},[e("h3",null,"🏢 部门管理"),e("div",{class:"guide-subsection"},[e("h4",null,"基本概念"),e("ul",null,[e("li",null,[e("strong",null,"部门"),r("：组织的基本单位，用于划分不同的业务领域")]),e("li",null,[e("strong",null,"层级结构"),r("：支持多级部门嵌套，形成完整的组织架构")]),e("li",null,[e("strong",null,"部门负责人"),r("：每个部门可以指定一名或多名负责人")])])]),e("div",{class:"guide-subsection"},[e("h4",null,"主要功能"),e("div",{class:"feature-grid"},[e("div",{class:"feature-item"},[e("h5",null,"📋 查看部门列表"),e("ul",null,[e("li",null,"卡片视图：以卡片形式展示部门信息"),e("li",null,"表格视图：以表格形式展示详细数据"),e("li",null,"搜索功能：按部门名称、编码搜索")])]),e("div",{class:"feature-item"},[e("h5",null,"⚙️ 部门操作"),e("ul",null,[e("li",null,"新建部门：创建新的部门"),e("li",null,"编辑部门：修改部门信息"),e("li",null,'查看详情：点击"详情"按钮查看完整信息'),e("li",null,"删除部门：删除不再需要的部门")])])])])]),e("div",{class:"guide-section"},[e("h3",null,"👥 角色权限管理"),e("div",{class:"guide-subsection"},[e("h4",null,"权限类型"),e("div",{class:"permission-grid"},[e("div",{class:"permission-item"},[e("h5",null,"🔧 功能权限"),e("ul",null,[e("li",null,"客户管理：客户信息的增删改查权限"),e("li",null,"订单管理：订单处理和状态更新权限"),e("li",null,"产品管理：产品信息维护权限"),e("li",null,"数据分析：报表和统计数据查看权限")])]),e("div",{class:"permission-item"},[e("h5",null,"📊 数据权限"),e("ul",null,[e("li",null,"全部数据：可以查看所有数据"),e("li",null,"部门数据：只能查看本部门及下级部门数据"),e("li",null,"个人数据：只能查看自己创建的数据")])])])])]),e("div",{class:"guide-section"},[e("h3",null,"📝 操作步骤"),e("div",{class:"steps-grid"},[e("div",{class:"step-item"},[e("h5",null,"1️⃣ 新建部门"),e("ol",null,[e("li",null,'点击"新建部门"按钮'),e("li",null,"填写部门基本信息"),e("li",null,"选择上级部门（如果是子部门）"),e("li",null,"指定部门负责人"),e("li",null,"保存部门信息")])]),e("div",{class:"step-item"},[e("h5",null,"2️⃣ 配置部门权限"),e("ol",null,[e("li",null,"在部门列表中找到目标部门"),e("li",null,'点击"权限"按钮'),e("li",null,"选择要分配的角色"),e("li",null,"配置具体的功能权限"),e("li",null,"保存权限配置")])]),e("div",{class:"step-item"},[e("h5",null,"3️⃣ 管理部门成员"),e("ol",null,[e("li",null,'点击部门的"成员"按钮'),e("li",null,"查看当前部门成员列表"),e("li",null,"添加新成员或移除现有成员"),e("li",null,"为成员分配具体角色"),e("li",null,"确认成员权限设置")])]),e("div",{class:"step-item"},[e("h5",null,"4️⃣ 查看部门详情"),e("ol",null,[e("li",null,'点击部门的"详情"按钮'),e("li",null,"查看部门的完整信息"),e("li",null,"查看部门的权限配置"),e("li",null,"查看部门成员列表"),e("li",null,"查看部门的业务数据统计")])])])]),e("div",{class:"guide-section"},[e("h3",null,"⚠️ 注意事项"),e("div",{class:"warning-grid"},[e("div",{class:"warning-item"},[e("h5",null,"🔒 权限管理"),e("ul",null,[e("li",null,"删除部门前，请确保已妥善处理部门下的所有成员"),e("li",null,"修改部门权限时，会影响该部门下所有成员的权限"),e("li",null,"建议定期审查部门权限配置，确保符合业务需求")])]),e("div",{class:"warning-item"},[e("h5",null,"🛡️ 数据安全"),e("ul",null,[e("li",null,"敏感数据的访问权限应严格控制"),e("li",null,"定期检查用户权限，及时回收不必要的权限"),e("li",null,"重要操作建议启用审批流程")])])])]),e("div",{class:"guide-section"},[e("h3",null,"🆘 常见问题"),e("div",{class:"faq-list"},[e("div",{class:"faq-item"},[e("h5",null,"Q: 如何快速找到特定部门？"),e("p",null,"A: 使用搜索功能，输入部门名称或编码进行快速定位。")]),e("div",{class:"faq-item"},[e("h5",null,"Q: 部门权限修改后多久生效？"),e("p",null,"A: 权限修改后立即生效，用户下次登录或刷新页面即可看到新权限。")]),e("div",{class:"faq-item"},[e("h5",null,"Q: 如何批量管理多个部门的权限？"),e("p",null,"A: 可以通过上级部门统一配置权限，下级部门会自动继承。")]),e("div",{class:"faq-item"},[e("h5",null,"Q: 误删部门怎么办？"),e("p",null,"A: 请联系系统管理员进行数据恢复，建议删除前做好备份。")])])]),e("div",{class:"guide-footer"},[e("p",null,[r("💡 "),e("strong",null,"提示"),r("：如需更多帮助，请联系系统管理员或查看详细的用户手册。")])])],-1))]),_:1},8,["modelValue"])])}}}),Jt=be(Lt,[["__scopeId","data-v-9d2ec338"]]);export{Jt as default};
