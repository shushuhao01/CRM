var Xe=Object.defineProperty,Ye=Object.defineProperties;var et=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var tt=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable;var Ve=(D,p,d)=>p in D?Xe(D,p,{enumerable:!0,configurable:!0,writable:!0,value:d}):D[p]=d,O=(D,p)=>{for(var d in p||(p={}))tt.call(p,d)&&Ve(D,d,p[d]);if(Se)for(var d of Se(p))at.call(p,d)&&Ve(D,d,p[d]);return D},G=(D,p)=>Ye(D,et(p));var B=(D,p,d)=>new Promise((j,P)=>{var R=g=>{try{$(d.next(g))}catch(V){P(V)}},S=g=>{try{$(d.throw(g))}catch(V){P(V)}},$=g=>g.done?j(g.value):Promise.resolve(g.value).then(R,S);$((d=d.apply(D,p)).next())});import{l as st,e as H,r as x,Z as W,c as lt,w as nt,ag as k,aq as ot,m as A,p as o,q as t,U as l,M as u,O as n,S as c,u as m,Q as v,T as r,P as xe,F as X,a9 as Y,J as it,a2 as J}from"./vendor-D8Vxqhr-.js";import{p as dt,aa as rt,C as ct,ao as ut,c as pt,t as mt,s as ze,r as vt,v as Be,a7 as Pe,e as gt,f as _t,K as $e,T as ft,x as yt,D as bt,E as T,b as K}from"./elementPlus-Bmwh7Rh8.js";import{u as kt,g as ht,$ as ne,_ as wt}from"./settings-CuxbDWOu.js";import"./utils-ywHRn0uI.js";const Ct={class:"sms-templates-page"},Dt={class:"page-header"},At={class:"header-content"},Nt={class:"header-right"},Tt={class:"stats-section"},St={class:"stats-grid"},Vt={class:"stat-card total"},xt={class:"stat-icon"},zt={class:"stat-content"},Bt={class:"stat-value"},Pt={class:"stat-card active"},$t={class:"stat-icon"},Et={class:"stat-content"},Ut={class:"stat-value"},Mt={key:0,class:"stat-card pending"},Lt={class:"stat-icon"},jt={class:"stat-content"},Rt={class:"stat-value"},Ft={class:"stat-card usage"},It={class:"stat-icon"},qt={class:"stat-content"},Ot={class:"stat-value"},Jt={class:"search-section"},Kt={class:"search-form"},Qt={class:"search-left"},Zt={class:"search-right"},Gt={class:"templates-section"},Ht={class:"card-header"},Wt={class:"header-actions"},Xt={key:0,class:"grid-view"},Yt={class:"templates-grid"},ea={class:"template-header"},ta={class:"template-title"},aa={class:"template-status"},sa={class:"template-content"},la={class:"content-preview"},na={class:"template-meta"},oa={class:"category"},ia={class:"usage-count"},da={class:"template-footer"},ra={class:"template-time"},ca={class:"template-actions"},ua={key:1,class:"list-view"},pa={class:"template-name-cell"},ma={class:"name"},va={class:"content-cell"},ga={class:"content-text"},_a={key:0,class:"variables"},fa={class:"category-text"},ya={class:"usage-count"},ba={class:"time-text"},ka={class:"action-buttons"},ha={class:"pagination-section"},wa={class:"variables-section"},Ca={class:"variables-list"},Da={class:"dialog-footer"},Aa={class:"preview-content"},Na={class:"preview-header"},Ta={class:"preview-body"},Sa={class:"content-section"},Va={class:"content-display"},xa={key:0,class:"variables-section"},za={class:"variables-display"},Ba={class:"meta-section"},Pa={class:"meta-item"},$a={class:"value"},Ea={class:"meta-item"},Ua={class:"value"},Ma={class:"meta-item"},La={class:"value"},ja={class:"meta-item"},Ra={class:"value"},Fa=st({__name:"SmsTemplates",setup(D){const p=kt(),d=H(()=>{var s;return((s=p.user)==null?void 0:s.role)==="super_admin"}),j=ht(),P=x(!1),R=x(!1),S=x(!1),$=x(!1),g=x("create"),V=x("grid"),Q=x(),_=W({keyword:"",status:"",category:""}),w=W({currentPage:1,pageSize:20}),z=W({total:0,active:0,pending:0,usage:0}),C=x([]),N=x(null),f=W({id:"",name:"",content:"",category:"",description:"",isDefault:!1,status:"active"}),Ee={name:[{required:!0,message:"请输入模板名称",trigger:"blur"},{min:2,max:50,message:"模板名称长度在 2 到 50 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入模板内容",trigger:"blur"},{min:10,max:500,message:"模板内容长度在 10 到 500 个字符",trigger:"blur"}],category:[{required:!0,message:"请选择模板分类",trigger:"change"}],description:[{required:!0,message:"请输入申请说明",trigger:"blur"},{min:10,max:200,message:"申请说明长度在 10 到 200 个字符",trigger:"blur"}]},F=H(()=>{const e=f.content.match(/\{([^}]+)\}/g);return e?e.map(i=>i.slice(1,-1)):[]}),oe=H(()=>{let s=C.value;return d.value||(s=s.filter(e=>{var i;return e.status==="active"||e.createdBy===((i=p.user)==null?void 0:i.id)})),_.keyword&&(s=s.filter(e=>e.name.toLowerCase().includes(_.keyword.toLowerCase())||e.content.toLowerCase().includes(_.keyword.toLowerCase()))),_.status&&(s=s.filter(e=>e.status===_.status)),_.category&&(s=s.filter(e=>e.category===_.category)),s}),ie=H(()=>{const s=(w.currentPage-1)*w.pageSize,e=s+w.pageSize;return oe.value.slice(s,e)}),Ue=()=>B(this,null,function*(){P.value=!0;try{yield new Promise(s=>setTimeout(s,500)),C.value=[{id:"1",name:"客户回访模板",content:"尊敬的{customerName}，感谢您对我们产品的支持，我们将为您提供更好的服务。如有任何问题，请联系我们：{phone}",category:"notification",status:"active",isDefault:!1,usageCount:156,variables:["customerName","phone"],createdBy:"admin",createdAt:"2024-01-15 10:30:00",updatedAt:"2024-01-20 14:20:00"},{id:"2",name:"促销活动模板",content:"【{companyName}】新年大促销！全场商品{discount}折起，活动时间：{startDate}至{endDate}，详情咨询客服。",category:"marketing",status:"active",isDefault:!1,usageCount:89,variables:["companyName","discount","startDate","endDate"],createdBy:"admin",createdAt:"2024-01-10 09:15:00",updatedAt:"2024-01-18 16:45:00"},{id:"3",name:"验证码模板",content:"您的验证码是：{code}，请在{minutes}分钟内使用，请勿泄露给他人。",category:"verification",status:"active",isDefault:!0,usageCount:1234,variables:["code","minutes"],createdBy:"admin",createdAt:"2024-01-22 11:20:00",updatedAt:"2024-01-22 11:20:00"},{id:"4",name:"订单确认通知",content:"【{companyName}】您的订单{orderNo}已确认，商品：{productName}，金额：{amount}元，预计{deliveryDate}发货。",category:"order",status:"active",isDefault:!1,usageCount:892,variables:["companyName","orderNo","productName","amount","deliveryDate"],createdBy:"admin",createdAt:"2024-01-20 15:30:00",updatedAt:"2024-01-25 10:15:00"},{id:"5",name:"发货通知模板",content:"【{companyName}】您的订单{orderNo}已发货，快递单号：{trackingNo}，请注意查收。物流查询：{trackingUrl}",category:"notification",status:"active",isDefault:!1,usageCount:756,variables:["companyName","orderNo","trackingNo","trackingUrl"],createdBy:"admin",createdAt:"2024-01-18 14:20:00",updatedAt:"2024-01-23 09:45:00"},{id:"6",name:"付款提醒模板",content:"尊敬的{customerName}，您的订单{orderNo}待付款，金额{amount}元，请及时完成支付。如有疑问请联系客服。",category:"notification",status:"active",isDefault:!1,usageCount:423,variables:["customerName","orderNo","amount"],createdBy:"admin",createdAt:"2024-01-16 11:30:00",updatedAt:"2024-01-21 16:20:00"},{id:"7",name:"会议通知模板",content:"【会议通知】{meetingTitle}将于{meetingDate} {meetingTime}在{location}举行，请准时参加。联系人：{contact}",category:"notification",status:"active",isDefault:!1,usageCount:234,variables:["meetingTitle","meetingDate","meetingTime","location","contact"],createdBy:"admin",createdAt:"2024-01-19 13:15:00",updatedAt:"2024-01-24 08:30:00"},{id:"8",name:"生日祝福模板",content:"亲爱的{customerName}，今天是您的生日，{companyName}全体员工祝您生日快乐！特为您准备了生日礼品，请到店领取。",category:"marketing",status:"active",isDefault:!1,usageCount:67,variables:["customerName","companyName"],createdBy:"admin",createdAt:"2024-01-17 10:45:00",updatedAt:"2024-01-22 14:10:00"},{id:"9",name:"服务预约确认",content:"【{companyName}】您预约的{serviceName}服务已确认，时间：{appointmentDate} {appointmentTime}，地址：{address}，联系电话：{phone}",category:"notification",status:"active",isDefault:!1,usageCount:345,variables:["companyName","serviceName","appointmentDate","appointmentTime","address","phone"],createdBy:"admin",createdAt:"2024-01-21 09:20:00",updatedAt:"2024-01-26 11:40:00"},{id:"10",name:"账户余额提醒",content:"【{companyName}】您的账户余额为{balance}元，余额不足可能影响服务使用，请及时充值。充值热线：{phone}",category:"notification",status:"active",isDefault:!1,usageCount:178,variables:["companyName","balance","phone"],createdBy:"admin",createdAt:"2024-01-14 16:30:00",updatedAt:"2024-01-19 12:15:00"},{id:"11",name:"密码重置通知",content:"【{companyName}】您的账户密码已重置，新密码：{newPassword}，请及时登录修改。如非本人操作，请联系客服：{phone}",category:"notification",status:"disabled",isDefault:!1,usageCount:89,variables:["companyName","newPassword","phone"],createdBy:"admin",createdAt:"2024-01-13 08:45:00",updatedAt:"2024-01-18 15:20:00"},{id:"12",name:"活动邀请模板",content:"【{companyName}】诚邀您参加{eventName}，时间：{eventDate}，地点：{venue}。精彩活动，丰厚奖品等您来！报名电话：{phone}",category:"marketing",status:"active",isDefault:!1,usageCount:123,variables:["companyName","eventName","eventDate","venue","phone"],createdBy:"admin",createdAt:"2024-01-12 12:10:00",updatedAt:"2024-01-17 17:25:00"},{id:"13",name:"新用户申请模板",content:"【限时优惠】{name}，{product}现在只要{price}元！立即购买享受{discount}折优惠，活动截止{endTime}。",category:"marketing",status:"pending",isDefault:!1,usageCount:0,variables:["name","product","price","discount","endTime"],createdBy:"user2",createdAt:"2024-01-26 11:20:00",updatedAt:"2024-01-26 11:20:00"}],z.total=C.value.length,z.active=C.value.filter(s=>s.status==="active").length,z.pending=C.value.filter(s=>s.status==="pending").length,z.usage=C.value.reduce((s,e)=>s+e.usageCount,0)}catch(s){T.error("加载模板失败")}finally{P.value=!1}}),Me=()=>{g.value="create",ge(),S.value=!0},Le=()=>{g.value="apply",ge(),f.status="pending",S.value=!0},de=s=>{g.value="edit",Object.assign(f,s),S.value=!0},ee=s=>{N.value=s,$.value=!0},re=s=>B(this,null,function*(){try{yield K.confirm("确定要审核通过这个模板吗？","确认审核",{type:"warning"}),s.status="active",T.success("模板审核通过"),j.sendMessage(ne.SMS_TEMPLATE_APPROVED,`您申请的短信模板"${s.name}"已审核通过，现在可以使用了。`,{relatedId:s.id,relatedType:"sms_template",actionUrl:"/system/sms-templates"})}catch(e){}}),ce=s=>B(this,null,function*(){try{const{value:e}=yield K.prompt("请输入拒绝原因","审核拒绝",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.{5,}/,inputErrorMessage:"拒绝原因至少5个字符"});s.status="rejected",s.rejectReason=e,T.success("模板已拒绝"),j.sendMessage(ne.SMS_TEMPLATE_REJECTED,`您申请的短信模板"${s.name}"审核未通过。拒绝原因：${e}`,{relatedId:s.id,relatedType:"sms_template",actionUrl:"/system/sms-templates"})}catch(e){}}),ue=s=>B(this,null,function*(){try{yield K.confirm("确定要删除这个模板吗？删除后不可恢复。","确认删除",{type:"warning"});const e=C.value.findIndex(i=>i.id===s.id);e>-1&&(C.value.splice(e,1),T.success("模板删除成功"))}catch(e){}}),pe=s=>B(this,null,function*(){try{yield K.confirm("确定要启用这个模板吗？","确认启用",{type:"info"}),s.status="active",s.updatedAt=new Date().toLocaleString(),T.success("模板已启用")}catch(e){}}),me=s=>B(this,null,function*(){try{yield K.confirm("确定要禁用这个模板吗？禁用后将无法使用。","确认禁用",{type:"warning"}),s.status="disabled",s.updatedAt=new Date().toLocaleString(),T.success("模板已禁用")}catch(e){}}),je=()=>B(this,null,function*(){var s,e,i;if(Q.value)try{if(yield Q.value.validate(),R.value=!0,yield new Promise(b=>setTimeout(b,1e3)),g.value==="create"){const b=G(O({},f),{id:Date.now().toString(),usageCount:0,variables:F.value,createdBy:(s=p.user)==null?void 0:s.id,createdAt:new Date().toLocaleString(),updatedAt:new Date().toLocaleString()});C.value.unshift(b),T.success("模板创建成功")}else if(g.value==="edit"){const b=C.value.findIndex(M=>M.id===f.id);b>-1&&(C.value[b]=G(O(O({},C.value[b]),f),{variables:F.value,updatedAt:new Date().toLocaleString()}),T.success("模板更新成功"))}else if(g.value==="apply"){const b=G(O({},f),{id:Date.now().toString(),usageCount:0,variables:F.value,createdBy:(e=p.user)==null?void 0:e.id,createdAt:new Date().toLocaleString(),updatedAt:new Date().toLocaleString()});C.value.unshift(b),T.success("模板申请已提交，等待管理员审核"),j.sendMessage(ne.SMS_TEMPLATE_APPLIED,`用户 ${(i=p.user)==null?void 0:i.name} 申请了新的短信模板"${b.name}"，请及时审核。`,{relatedId:b.id,relatedType:"sms_template",actionUrl:"/system/sms-templates"})}S.value=!1}catch(b){T.error("操作失败，请重试")}finally{R.value=!1}}),ve=()=>{w.currentPage=1},Re=()=>{_.keyword="",_.status="",_.category="",w.currentPage=1},ge=()=>{var s;Object.assign(f,{id:"",name:"",content:"",category:"",description:"",isDefault:!1,status:"active"}),(s=Q.value)==null||s.resetFields()},Fe=s=>{w.pageSize=s,w.currentPage=1},Ie=s=>{w.currentPage=s},qe=s=>{ee(s)},Oe=(s,e)=>{s==="approve"?re(e):s==="reject"&&ce(e)},_e=s=>{var e;return d.value||s.createdBy===((e=p.user)==null?void 0:e.id)},fe=s=>{var e;return d.value||s.createdBy===((e=p.user)==null?void 0:e.id)&&s.status!=="active"},te=s=>({active:"success",disabled:"info",pending:"warning",rejected:"danger"})[s]||"info",ae=s=>({active:"已启用",disabled:"已禁用",pending:"待审核",rejected:"已拒绝"})[s]||"未知",se=s=>({marketing:"营销推广",notification:"系统通知",verification:"验证码",order:"订单提醒"})[s]||"其他",Z=s=>s||"-";return lt(()=>{Ue()}),nt([()=>_.keyword,()=>_.status,()=>_.category],()=>{w.currentPage=1}),(s,e)=>{const i=k("el-button"),b=k("el-icon"),M=k("el-input"),h=k("el-option"),le=k("el-select"),ye=k("el-card"),Je=k("el-button-group"),E=k("el-tag"),U=k("el-table-column"),be=k("el-dropdown-item"),Ke=k("el-dropdown-menu"),Qe=k("el-dropdown"),Ze=k("el-table"),Ge=k("el-pagination"),L=k("el-form-item"),He=k("el-switch"),We=k("el-form"),ke=k("el-dialog"),he=ot("loading");return o(),A("div",Ct,[t("div",Dt,[t("div",At,[e[17]||(e[17]=t("div",{class:"header-left"},[t("h1",{class:"page-title"},"短信模板管理"),t("p",{class:"page-subtitle"},"管理和配置短信模板，支持创建、编辑和审核流程")],-1)),t("div",Nt,[d.value?(o(),u(i,{key:0,type:"primary",icon:m(dt),onClick:Me,class:"create-btn"},{default:n(()=>[...e[15]||(e[15]=[c(" 创建模板 ",-1)])]),_:1},8,["icon"])):(o(),u(i,{key:1,type:"primary",icon:m(rt),onClick:Le,class:"apply-btn"},{default:n(()=>[...e[16]||(e[16]=[c(" 申请模板 ",-1)])]),_:1},8,["icon"]))])])]),t("div",Tt,[t("div",St,[t("div",Vt,[t("div",xt,[l(b,null,{default:n(()=>[l(m(ct))]),_:1})]),t("div",zt,[t("div",Bt,r(z.total),1),e[18]||(e[18]=t("div",{class:"stat-label"},"总模板数",-1))])]),t("div",Pt,[t("div",$t,[l(b,null,{default:n(()=>[l(m(ut))]),_:1})]),t("div",Et,[t("div",Ut,r(z.active),1),e[19]||(e[19]=t("div",{class:"stat-label"},"已启用",-1))])]),d.value?(o(),A("div",Mt,[t("div",Lt,[l(b,null,{default:n(()=>[l(m(pt))]),_:1})]),t("div",jt,[t("div",Rt,r(z.pending),1),e[20]||(e[20]=t("div",{class:"stat-label"},"待审核",-1))])])):v("",!0),t("div",Ft,[t("div",It,[l(b,null,{default:n(()=>[l(m(mt))]),_:1})]),t("div",qt,[t("div",Ot,r(z.usage),1),e[21]||(e[21]=t("div",{class:"stat-label"},"本月使用",-1))])])])]),t("div",Jt,[l(ye,{class:"search-card"},{default:n(()=>[t("div",Kt,[t("div",Qt,[l(M,{modelValue:_.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>_.keyword=a),placeholder:"搜索模板名称或内容","prefix-icon":m(ze),clearable:"",onInput:ve,class:"search-input"},null,8,["modelValue","prefix-icon"]),l(le,{modelValue:_.status,"onUpdate:modelValue":e[1]||(e[1]=a=>_.status=a),placeholder:"状态",clearable:"",class:"status-select"},{default:n(()=>[l(h,{label:"全部",value:""}),l(h,{label:"已启用",value:"active"}),l(h,{label:"已禁用",value:"disabled"}),d.value?(o(),u(h,{key:0,label:"待审核",value:"pending"})):v("",!0),d.value?(o(),u(h,{key:1,label:"已拒绝",value:"rejected"})):v("",!0)]),_:1},8,["modelValue"]),l(le,{modelValue:_.category,"onUpdate:modelValue":e[2]||(e[2]=a=>_.category=a),placeholder:"分类",clearable:"",class:"category-select"},{default:n(()=>[l(h,{label:"全部",value:""}),l(h,{label:"营销推广",value:"marketing"}),l(h,{label:"系统通知",value:"notification"}),l(h,{label:"验证码",value:"verification"}),l(h,{label:"订单提醒",value:"order"})]),_:1},8,["modelValue"])]),t("div",Zt,[l(i,{onClick:Re,icon:m(vt)},{default:n(()=>[...e[22]||(e[22]=[c("重置",-1)])]),_:1},8,["icon"]),l(i,{type:"primary",onClick:ve,icon:m(ze)},{default:n(()=>[...e[23]||(e[23]=[c("搜索",-1)])]),_:1},8,["icon"])])])]),_:1})]),t("div",Gt,[l(ye,{class:"templates-card"},{header:n(()=>[t("div",Ht,[e[24]||(e[24]=t("span",{class:"header-title"},"模板列表",-1)),t("div",Wt,[l(Je,null,{default:n(()=>[l(i,{type:V.value==="grid"?"primary":"",icon:m(yt),onClick:e[3]||(e[3]=a=>V.value="grid"),size:"small"},null,8,["type","icon"]),l(i,{type:V.value==="list"?"primary":"",icon:m(bt),onClick:e[4]||(e[4]=a=>V.value="list"),size:"small"},null,8,["type","icon"])]),_:1})])])]),default:n(()=>[V.value==="grid"?(o(),A("div",Xt,[xe((o(),A("div",Yt,[(o(!0),A(X,null,Y(ie.value,a=>(o(),A("div",{key:a.id,class:it(["template-card",{pending:a.status==="pending"}])},[t("div",ea,[t("div",ta,r(a.name),1),t("div",aa,[l(E,{type:te(a.status),size:"small",class:"status-tag"},{default:n(()=>[c(r(ae(a.status)),1)]),_:2},1032,["type"])])]),t("div",sa,[t("p",la,r(a.content),1),t("div",na,[t("span",oa,r(se(a.category)),1),t("span",ia,"使用 "+r(a.usageCount)+" 次",1)])]),t("div",da,[t("div",ra,[t("span",null,r(Z(a.updatedAt)),1)]),t("div",ca,[l(i,{size:"small",icon:m(Be),onClick:y=>ee(a),title:"预览"},{default:n(()=>[...e[25]||(e[25]=[c(" 预览 ",-1)])]),_:1},8,["icon","onClick"]),_e(a)?(o(),u(i,{key:0,size:"small",type:"primary",icon:m(Pe),onClick:y=>de(a),title:"编辑"},{default:n(()=>[...e[26]||(e[26]=[c(" 编辑 ",-1)])]),_:1},8,["icon","onClick"])):v("",!0),a.status==="active"?(o(),u(i,{key:1,size:"small",type:"warning",onClick:y=>me(a),title:"禁用"},{default:n(()=>[...e[27]||(e[27]=[c(" 禁用 ",-1)])]),_:1},8,["onClick"])):v("",!0),a.status==="disabled"?(o(),u(i,{key:2,size:"small",type:"success",onClick:y=>pe(a),title:"启用"},{default:n(()=>[...e[28]||(e[28]=[c(" 启用 ",-1)])]),_:1},8,["onClick"])):v("",!0),d.value&&a.status==="pending"?(o(),u(i,{key:3,size:"small",type:"success",icon:m(gt),onClick:y=>re(a),title:"审核通过"},null,8,["icon","onClick"])):v("",!0),d.value&&a.status==="pending"?(o(),u(i,{key:4,size:"small",type:"danger",icon:m(_t),onClick:y=>ce(a),title:"审核拒绝"},null,8,["icon","onClick"])):v("",!0),fe(a)?(o(),u(i,{key:5,size:"small",type:"danger",icon:m($e),onClick:y=>ue(a),title:"删除"},{default:n(()=>[...e[29]||(e[29]=[c(" 删除 ",-1)])]),_:1},8,["icon","onClick"])):v("",!0)])])],2))),128))])),[[he,P.value]])])):(o(),A("div",ua,[xe((o(),u(Ze,{data:ie.value,class:"templates-table",onRowClick:qe},{default:n(()=>[l(U,{prop:"name",label:"模板名称",width:"200"},{default:n(({row:a})=>[t("div",pa,[t("span",ma,r(a.name),1),a.isDefault?(o(),u(E,{key:0,type:"warning",size:"small",class:"default-tag"},{default:n(()=>[...e[30]||(e[30]=[c(" 默认 ",-1)])]),_:1})):v("",!0)])]),_:1}),l(U,{prop:"content",label:"模板内容","min-width":"300"},{default:n(({row:a})=>{var y;return[t("div",va,[t("p",ga,r(a.content),1),(y=a.variables)!=null&&y.length?(o(),A("div",_a,[(o(!0),A(X,null,Y(a.variables,I=>(o(),u(E,{key:I,size:"small",class:"variable-tag"},{default:n(()=>[c(r(I),1)]),_:2},1024))),128))])):v("",!0)])]}),_:1}),l(U,{prop:"category",label:"分类",width:"120"},{default:n(({row:a})=>[t("span",fa,r(se(a.category)),1)]),_:1}),l(U,{prop:"status",label:"状态",width:"100"},{default:n(({row:a})=>[l(E,{type:te(a.status),size:"small"},{default:n(()=>[c(r(ae(a.status)),1)]),_:2},1032,["type"])]),_:1}),l(U,{prop:"usageCount",label:"使用次数",width:"100",align:"center"},{default:n(({row:a})=>[t("span",ya,r(a.usageCount),1)]),_:1}),l(U,{prop:"updatedAt",label:"更新时间",width:"160"},{default:n(({row:a})=>[t("span",ba,r(Z(a.updatedAt)),1)]),_:1}),l(U,{label:"操作",width:"280",fixed:"right"},{default:n(({row:a})=>[t("div",ka,[l(i,{size:"small",icon:m(Be),onClick:J(y=>ee(a),["stop"])},{default:n(()=>[...e[31]||(e[31]=[c(" 预览 ",-1)])]),_:1},8,["icon","onClick"]),_e(a)?(o(),u(i,{key:0,size:"small",type:"primary",icon:m(Pe),onClick:J(y=>de(a),["stop"])},{default:n(()=>[...e[32]||(e[32]=[c(" 编辑 ",-1)])]),_:1},8,["icon","onClick"])):v("",!0),a.status==="active"?(o(),u(i,{key:1,size:"small",type:"warning",onClick:J(y=>me(a),["stop"])},{default:n(()=>[...e[33]||(e[33]=[c(" 禁用 ",-1)])]),_:1},8,["onClick"])):v("",!0),a.status==="disabled"?(o(),u(i,{key:2,size:"small",type:"success",onClick:J(y=>pe(a),["stop"])},{default:n(()=>[...e[34]||(e[34]=[c(" 启用 ",-1)])]),_:1},8,["onClick"])):v("",!0),d.value&&a.status==="pending"?(o(),u(Qe,{key:3,onCommand:y=>Oe(y,a)},{dropdown:n(()=>[l(Ke,null,{default:n(()=>[l(be,{command:"approve"},{default:n(()=>[...e[36]||(e[36]=[c("通过",-1)])]),_:1}),l(be,{command:"reject"},{default:n(()=>[...e[37]||(e[37]=[c("拒绝",-1)])]),_:1})]),_:1})]),default:n(()=>[l(i,{size:"small",type:"success"},{default:n(()=>[e[35]||(e[35]=c(" 审核",-1)),l(b,{class:"el-icon--right"},{default:n(()=>[l(m(ft))]),_:1})]),_:1})]),_:1},8,["onCommand"])):v("",!0),fe(a)?(o(),u(i,{key:4,size:"small",type:"danger",icon:m($e),onClick:J(y=>ue(a),["stop"])},{default:n(()=>[...e[38]||(e[38]=[c(" 删除 ",-1)])]),_:1},8,["icon","onClick"])):v("",!0)])]),_:1})]),_:1},8,["data"])),[[he,P.value]])])),t("div",ha,[l(Ge,{"current-page":w.currentPage,"onUpdate:currentPage":e[5]||(e[5]=a=>w.currentPage=a),"page-size":w.pageSize,"onUpdate:pageSize":e[6]||(e[6]=a=>w.pageSize=a),"page-sizes":[10,20,50,100],total:oe.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Fe,onCurrentChange:Ie,class:"pagination"},null,8,["current-page","page-size","total"])])]),_:1})]),l(ke,{modelValue:S.value,"onUpdate:modelValue":e[13]||(e[13]=a=>S.value=a),title:g.value==="create"?"创建模板":g.value==="edit"?"编辑模板":"申请模板",width:"800px",class:"template-dialog","close-on-click-modal":!1},{footer:n(()=>[t("div",Da,[l(i,{onClick:e[12]||(e[12]=a=>S.value=!1)},{default:n(()=>[...e[42]||(e[42]=[c("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:je,loading:R.value},{default:n(()=>[c(r(g.value==="apply"?"提交申请":"确定"),1)]),_:1},8,["loading"])])]),default:n(()=>[l(We,{model:f,rules:Ee,ref_key:"templateFormRef",ref:Q,"label-width":"100px",class:"template-form"},{default:n(()=>[l(L,{label:"模板名称",prop:"name"},{default:n(()=>[l(M,{modelValue:f.name,"onUpdate:modelValue":e[7]||(e[7]=a=>f.name=a),placeholder:"请输入模板名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(L,{label:"模板分类",prop:"category"},{default:n(()=>[l(le,{modelValue:f.category,"onUpdate:modelValue":e[8]||(e[8]=a=>f.category=a),placeholder:"请选择分类"},{default:n(()=>[l(h,{label:"营销推广",value:"marketing"}),l(h,{label:"系统通知",value:"notification"}),l(h,{label:"验证码",value:"verification"}),l(h,{label:"订单提醒",value:"order"})]),_:1},8,["modelValue"])]),_:1}),l(L,{label:"模板内容",prop:"content"},{default:n(()=>[l(M,{modelValue:f.content,"onUpdate:modelValue":e[9]||(e[9]=a=>f.content=a),type:"textarea",rows:6,placeholder:"请输入模板内容，使用 {变量名} 格式定义变量",maxlength:"500","show-word-limit":""},null,8,["modelValue"]),e[39]||(e[39]=t("div",{class:"form-tip"},[t("p",null,"• 使用 {变量名} 格式定义变量，如：{name}、{code}、{amount}"),t("p",null,"• 模板内容不能超过500字符"),t("p",null,"• 请确保内容符合相关法规要求")],-1))]),_:1}),F.value.length?(o(),u(L,{key:0,label:"变量说明"},{default:n(()=>[t("div",wa,[t("div",Ca,[(o(!0),A(X,null,Y(F.value,a=>(o(),u(E,{key:a,class:"variable-item"},{default:n(()=>[c(r(a),1)]),_:2},1024))),128))]),e[40]||(e[40]=t("p",{class:"variables-tip"},"系统自动检测到以上变量，请确保在使用时提供对应的值",-1))])]),_:1})):v("",!0),g.value==="apply"?(o(),u(L,{key:1,label:"申请说明",prop:"description"},{default:n(()=>[l(M,{modelValue:f.description,"onUpdate:modelValue":e[10]||(e[10]=a=>f.description=a),type:"textarea",rows:3,placeholder:"请说明申请此模板的用途和必要性",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})):v("",!0),d.value&&g.value!=="apply"?(o(),u(L,{key:2,label:"设为默认"},{default:n(()=>[l(He,{modelValue:f.isDefault,"onUpdate:modelValue":e[11]||(e[11]=a=>f.isDefault=a)},null,8,["modelValue"]),e[41]||(e[41]=t("span",{class:"form-tip"},"默认模板将在发送短信时优先显示",-1))]),_:1})):v("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(ke,{modelValue:$.value,"onUpdate:modelValue":e[14]||(e[14]=a=>$.value=a),title:"模板预览",width:"600px",class:"preview-dialog"},{default:n(()=>{var a,y,I,we,Ce,De,Ae,Ne,Te;return[t("div",Aa,[t("div",Na,[t("h4",null,r((a=N.value)==null?void 0:a.name),1),l(E,{type:te((y=N.value)==null?void 0:y.status)},{default:n(()=>{var q;return[c(r(ae((q=N.value)==null?void 0:q.status)),1)]}),_:1},8,["type"])]),t("div",Ta,[t("div",Sa,[e[43]||(e[43]=t("h5",null,"模板内容",-1)),t("div",Va,r((I=N.value)==null?void 0:I.content),1)]),(Ce=(we=N.value)==null?void 0:we.variables)!=null&&Ce.length?(o(),A("div",xa,[e[44]||(e[44]=t("h5",null,"变量列表",-1)),t("div",za,[(o(!0),A(X,null,Y(N.value.variables,q=>(o(),u(E,{key:q,class:"variable-tag"},{default:n(()=>[c(r(q),1)]),_:2},1024))),128))])])):v("",!0),t("div",Ba,[t("div",Pa,[e[45]||(e[45]=t("span",{class:"label"},"分类：",-1)),t("span",$a,r(se((De=N.value)==null?void 0:De.category)),1)]),t("div",Ea,[e[46]||(e[46]=t("span",{class:"label"},"使用次数：",-1)),t("span",Ua,r((Ae=N.value)==null?void 0:Ae.usageCount)+" 次",1)]),t("div",Ma,[e[47]||(e[47]=t("span",{class:"label"},"创建时间：",-1)),t("span",La,r(Z((Ne=N.value)==null?void 0:Ne.createdAt)),1)]),t("div",ja,[e[48]||(e[48]=t("span",{class:"label"},"更新时间：",-1)),t("span",Ra,r(Z((Te=N.value)==null?void 0:Te.updatedAt)),1)])])])])]}),_:1},8,["modelValue"])])}}}),Qa=wt(Fa,[["__scopeId","data-v-62d2cea2"]]);export{Qa as default};
