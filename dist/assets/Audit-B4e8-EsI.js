var Ft=Object.defineProperty,Lt=Object.defineProperties;var qt=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var Yt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable;var Le=(h,v,R)=>v in h?Ft(h,v,{enumerable:!0,configurable:!0,writable:!0,value:R}):h[v]=R,we=(h,v)=>{for(var R in v||(v={}))Yt.call(v,R)&&Le(h,R,v[R]);if(Fe)for(var R of Fe(v))Qt.call(v,R)&&Le(h,R,v[R]);return h},qe=(h,v)=>Lt(h,qt(v));var P=(h,v,R)=>new Promise((A,I)=>{var W=U=>{try{F(R.next(U))}catch(H){I(H)}},q=U=>{try{F(R.throw(U))}catch(H){I(H)}},F=U=>U.done?A(U.value):Promise.resolve(U.value).then(W,q);F((R=R.apply(h,v)).next())});import{aw as Wt,r as k,e as oe,l as Ge,Z as G,ag as y,m as N,p as m,q as l,U as t,a2 as Jt,O as a,u,S as p,Q as z,F as te,a9 as se,T as c,M as O,az as Gt,c as Kt,J as Se,P as Zt,V as Xt}from"./vendor-D8Vxqhr-.js";import{p as ea,K as ta,E,b as Ke,c as De,q as aa,al as la,a1 as oa,s as sa,r as Ye,v as na,e as ce,f as me,a7 as Qe,am as We,af as ra,G as Je,a3 as ia}from"./elementPlus-Bmwh7Rh8.js";import{u as Ze,_ as Xe,h as da,j as ua,g as ca,S as ma}from"./settings-CuxbDWOu.js";import{o as pa}from"./order-BYWArVux.js";import{m as va}from"./phone-DsAzMHsn.js";import{d as fa}from"./sensitiveInfo-BWt1a88R.js";import{D as ga}from"./DynamicTable-CiyMIP8-.js";import"./utils-ywHRn0uI.js";const et=Wt("rejectionReason",()=>{const h=k([{id:"1",name:"地址不正确",description:"收货地址信息有误或不完整",isDefault:!0,createTime:"2024-01-01 00:00:00",createdBy:"system"},{id:"2",name:"缺少定金截图",description:"未上传定金支付截图或截图不清晰",isDefault:!0,createTime:"2024-01-01 00:00:00",createdBy:"system"},{id:"3",name:"产品没有库存",description:"所选产品暂时缺货",isDefault:!0,createTime:"2024-01-01 00:00:00",createdBy:"system"},{id:"4",name:"客户信息有误",description:"客户联系方式或身份信息不正确",isDefault:!0,createTime:"2024-01-01 00:00:00",createdBy:"system"},{id:"5",name:"快递送不到",description:"收货地址超出配送范围",isDefault:!0,createTime:"2024-01-01 00:00:00",createdBy:"system"},{id:"6",name:"风险客户",description:"需要进一步核实客户信息",isDefault:!0,createTime:"2024-01-01 00:00:00",createdBy:"system"},{id:"7",name:"订单金额异常",description:"订单金额计算有误或存在异常",isDefault:!0,createTime:"2024-01-01 00:00:00",createdBy:"system"},{id:"8",name:"重复下单",description:"客户重复提交相同订单",isDefault:!0,createTime:"2024-01-01 00:00:00",createdBy:"system"},{id:"9",name:"产品信息不符",description:"产品规格、型号等信息与实际不符",isDefault:!0,createTime:"2024-01-01 00:00:00",createdBy:"system"},{id:"10",name:"其他",description:"其他原因，需要在备注中详细说明",isDefault:!0,createTime:"2024-01-01 00:00:00",createdBy:"system"}]),v=()=>h.value,R=()=>h.value.map(b=>({label:b.description||b.name,value:b.id,description:b.description})),A=b=>h.value.find(d=>d.id===b),I=b=>h.value.find(d=>d.name===b),W=oe(()=>h.value);return{rejectionReasons:h,reasons:W,getAllReasons:v,getReasonOptions:R,getReasonById:A,getReasonByName:I,addReason:b=>P(void 0,null,function*(){yield new Promise(C=>setTimeout(C,500));const d=qe(we({},b),{id:Date.now().toString(),createTime:new Date().toLocaleString("zh-CN"),isDefault:!1});return h.value.push(d),d}),updateReason:(b,d)=>{const C=h.value.findIndex(B=>B.id===b);return C!==-1?(h.value[C]=we(we({},h.value[C]),d),h.value[C]):null},deleteReason:b=>P(void 0,null,function*(){yield new Promise(C=>setTimeout(C,300));const d=h.value.findIndex(C=>C.id===b);if(d!==-1){if(h.value[d].isDefault)throw new Error("不能删除系统预设原因");return h.value.splice(d,1),!0}throw new Error("拒绝原因不存在")}),isOtherReason:b=>{const d=A(b);return(d==null?void 0:d.name)==="其他"}}}),_a={class:"rejection-reason-management"},ya={class:"add-reason-section"},ba={class:"reason-buttons-section"},ka={class:"reason-buttons-grid"},ha={class:"reason-button-content"},wa={class:"reason-info"},Ra={class:"reason-name"},Ca={key:0,class:"reason-description"},Ta={class:"reason-meta"},Aa={class:"create-time"},Va={class:"creator"},Sa={class:"reason-actions"},Da={key:0,class:"empty-state"},ja=Ge({__name:"RejectionReasonManagement",emits:["close"],setup(h){const v=et(),R=Ze(),A=k(),I=G({name:"",description:""}),W={name:[{required:!0,message:"请输入拒绝原因名称",trigger:"blur"},{min:2,max:30,message:"长度在 2 到 30 个字符",trigger:"blur"},{validator:(b,d,C)=>{v.reasons.some(B=>B.name===d)?C(new Error("该拒绝原因已存在")):C()},trigger:"blur"}],description:[{max:200,message:"描述不能超过200个字符",trigger:"blur"}]},q=k(!1),F=k(null),U=()=>P(this,null,function*(){A.value&&(yield A.value.validate(b=>P(this,null,function*(){var d,C;if(b){q.value=!0;try{yield v.addReason({name:I.name,description:I.description||void 0,createdBy:((d=R.user)==null?void 0:d.name)||"当前用户"}),E.success("添加成功"),I.name="",I.description="",(C=A.value)==null||C.resetFields()}catch(B){E.error("添加失败")}finally{q.value=!1}}})))}),H=b=>P(this,null,function*(){try{yield Ke.confirm(`确定要删除拒绝原因"${b.name}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),F.value=b.id;try{yield v.deleteReason(b.id),E.success("删除成功")}catch(d){E.error("删除失败")}finally{F.value=null}}catch(d){}});return(b,d)=>{const C=y("el-input"),B=y("el-form-item"),ae=y("el-button"),Y=y("el-form"),L=y("el-tag"),ne=y("el-empty");return m(),N("div",_a,[l("div",ya,[d[3]||(d[3]=l("h4",null,"添加新的拒绝原因",-1)),t(Y,{ref_key:"addFormRef",ref:A,model:I,rules:W,onSubmit:Jt(U,["prevent"])},{default:a(()=>[t(B,{prop:"name",label:"原因名称"},{default:a(()=>[t(C,{modelValue:I.name,"onUpdate:modelValue":d[0]||(d[0]=w=>I.name=w),placeholder:"请输入拒绝原因名称",maxlength:"30","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(B,{prop:"description",label:"详细描述"},{default:a(()=>[t(C,{modelValue:I.description,"onUpdate:modelValue":d[1]||(d[1]=w=>I.description=w),type:"textarea",rows:3,placeholder:"请输入详细描述（选填）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(B,null,{default:a(()=>[t(ae,{type:"primary",onClick:U,loading:q.value,icon:u(ea)},{default:a(()=>[...d[2]||(d[2]=[p(" 添加原因 ",-1)])]),_:1},8,["loading","icon"])]),_:1})]),_:1},8,["model"])]),l("div",ba,[d[5]||(d[5]=l("h4",null,"现有拒绝原因",-1)),l("div",ka,[(m(!0),N(te,null,se(u(v).reasons,w=>(m(),N("div",{key:w.id,class:"reason-button-item"},[l("div",ha,[l("div",wa,[l("div",Ra,c(w.name),1),w.description?(m(),N("div",Ca,c(w.description),1)):z("",!0),l("div",Ta,[l("span",Aa,c(w.createTime),1),l("span",Va,c(w.createdBy),1)])]),l("div",Sa,[w.isDefault?(m(),O(L,{key:1,type:"info",size:"small"},{default:a(()=>[...d[4]||(d[4]=[p("系统预设",-1)])]),_:1})):(m(),O(ae,{key:0,type:"danger",size:"small",icon:u(ta),onClick:K=>H(w),loading:F.value===w.id,circle:"",title:"删除"},null,8,["icon","onClick","loading"]))])])]))),128))]),u(v).reasons.length===0?(m(),N("div",Da,[t(ne,{description:"暂无拒绝原因"})])):z("",!0)])])}}}),Na=Xe(ja,[["__scopeId","data-v-648e178a"]]),xa={class:"order-audit"},Ia={class:"summary-cards"},$a={class:"summary-content"},Pa={class:"summary-icon pending"},Oa={class:"summary-info"},Ua={class:"summary-value"},Ba={class:"summary-content"},Ma={class:"summary-icon amount"},za={class:"summary-info"},Ea={class:"summary-value"},Ha={class:"summary-content"},Fa={class:"summary-icon today"},La={class:"summary-info"},qa={class:"summary-value"},Ya={class:"summary-content"},Qa={class:"summary-icon urgent"},Wa={class:"summary-info"},Ja={class:"summary-value"},Ga={class:"quick-filter-content"},Ka={class:"filter-buttons"},Za={class:"header-tabs"},Xa={key:1,class:"count-text"},el={class:"tab-label"},tl={class:"tab-label"},al={class:"header-actions-right"},ll={class:"total-info"},ol={class:"amount"},sl={key:1},nl={key:0,class:"order-detail-content"},rl={class:"card-header"},il={class:"info-item"},dl={class:"value"},ul={class:"info-item"},cl={class:"value amount"},ml={class:"info-item"},pl={class:"value deposit-amount"},vl={class:"info-item"},fl={class:"value cod-amount"},gl={class:"info-item"},_l={class:"value"},yl={class:"info-item"},bl={class:"value"},kl={class:"info-item"},hl={class:"value"},wl={class:"info-item"},Rl={class:"value"},Cl={class:"info-item"},Tl={class:"value"},Al={class:"info-item"},Vl={class:"value"},Sl={class:"info-item"},Dl={class:"info-item"},jl={class:"value"},Nl={class:"info-item"},xl={class:"screenshot-gallery"},Il=["onClick"],$l={class:"image-error"},Pl={class:"screenshot-name"},Ol={class:"screenshot-overlay"},Ul={class:"card-header"},Bl={class:"header-left"},Ml=["data-action"],zl={class:"timeline-header-compact"},El={class:"action-name"},Hl={class:"timeline-body-compact"},Fl={class:"operator"},Ll={key:0,class:"remark"},ql={class:"dialog-footer"},Yl={key:0,class:"image-viewer-container"},Ql={class:"image-error-large"},Wl={key:0,class:"image-navigation"},Jl={class:"image-counter"},Gl={class:"rejection-reason-section"},Kl={class:"batch-orders"},Zl={class:"dialog-footer"},Xl={class:"dialog-footer"},eo=Ge({__name:"Audit",setup(h){Gt();const v=Ze();da();const R=ua(),A=ca(),I=et(),W=k(!1),q=k(!1),F=k(!1),U=k(!1),H=k(!1),b=k(!1),d=k(!1),C=k(!1),B=k(!1),ae=k(!1),Y=k([]),L=k(0),ne=k(!0),w=k("pending"),K=G({pending:0,approved:0,rejected:0}),je=G({pending:!1});k([]);const M=k([]),re=k([]),ie=k([]),Z=k(),Re=k(),_e=k(),$=k([]),de=k(!1),tt=oe(()=>{const s=$.value.length,e=le.value.length;return s>0&&s<e}),at=oe(()=>B.value?`批量审核订单 (${$.value.length}个)`:"订单审核"),Q=G({pendingCount:0,pendingAmount:0,todayCount:0,urgentCount:0}),j=G({orderNo:"",customerName:"",salesPerson:"",minAmount:"",maxAmount:"",dateRange:[]}),Ce=k("today"),lt=[{label:"今日",value:"today"},{label:"昨日",value:"yesterday"},{label:"本周",value:"thisWeek"},{label:"本月",value:"thisMonth"},{label:"今年",value:"thisYear"},{label:"全部",value:"all"}],J=G({page:1,size:20,total:0}),le=oe(()=>{switch(w.value){case"pending":return M.value;case"approved":return re.value;case"rejected":return ie.value;default:return M.value}}),ot=oe(()=>[{prop:"orderNo",label:"订单号",width:160,visible:!0},{prop:"customerName",label:"客户姓名",width:120,visible:!0},{prop:"customerPhone",label:"客户电话",width:140,visible:!0},{prop:"salesPerson",label:"销售人员",width:100,visible:!0},{prop:"totalAmount",label:"订单金额",width:120,align:"right",visible:!0},{prop:"productCount",label:"商品数量",width:100,align:"center",visible:!0},{prop:"createTime",label:"创建时间",width:160,visible:!0},{prop:"waitingTime",label:"等待时间",width:120,align:"center",visible:w.value==="pending"},{prop:"auditStatus",label:"审核状态",width:120,align:"center",visible:w.value!=="pending"},{prop:"hasBeenAudited",label:"审核标识",width:100,align:"center",visible:w.value==="pending"},{prop:"auditTime",label:"审核时间",width:160,visible:w.value!=="pending"},{prop:"auditor",label:"审核人",width:100,visible:w.value!=="pending"},{prop:"remark",label:"订单备注",minWidth:150,showOverflowTooltip:!0,visible:!0}]),_=k({}),f=G({result:"approved",remark:"",rejectionReasonId:""}),ue=G({content:""}),S=G({result:"",rejectionReason:"",remark:""}),st=oe(()=>({result:[{required:!0,message:"请选择审核结果",trigger:"change"}],rejectionReasonId:f.result==="rejected"?[{required:!0,message:"请选择拒绝原因",trigger:"change"}]:[],remark:[]})),nt={content:[{required:!0,message:"请输入备注内容",trigger:"blur"},{min:2,message:"备注内容至少2个字符",trigger:"blur"}]},rt=oe(()=>({result:[{required:!0,message:"请选择审核结果",trigger:"change"}],rejectionReason:S.result==="rejected"?[{required:!0,message:"请选择拒绝原因",trigger:"change"}]:[],remark:[]})),Ne=s=>s>=48?"danger":s>=24?"warning":"success",it=s=>{switch(s){case"approved":return"success";case"rejected":return"danger";case"pending":return"warning";default:return"info"}},dt=s=>{switch(s){case"approved":return"已通过";case"rejected":return"已拒绝";case"pending":return"待审核";default:return"未知"}},ut=s=>{w.value=s,$.value=[],de.value=!1,J.page=1,pe()},ct=s=>{s?$.value=[...le.value]:$.value=[]},mt=s=>{$.value=s,de.value=s.length===le.value.length},pt=s=>{const e=$.value.findIndex(r=>r.id===s.id);e>-1&&$.value.splice(e,1)},vt=s=>{_.value=s,S.result="",S.rejectionReason="",S.remark="",d.value=!0},xe=(s,e)=>{_.value=s,f.result=e,f.remark="",f.rejectionReasonId="",B.value=!1,H.value=!0},Ie=s=>{if($.value.length===0){E.warning("请先选择要审核的订单");return}f.result=s,f.remark="",f.rejectionReasonId="",B.value=!0,H.value=!0},ft=s=>{_.value=s,ue.content=s.remark||"",b.value=!0},$e=(s,e)=>{const r=e==="approved"?"重新通过":"撤销";Ke.confirm(`确认${r}此订单吗？`,"操作确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>P(this,null,function*(){try{yield new Promise(x=>setTimeout(x,1e3));const i=le.value,g=i.findIndex(x=>x.id===s.id);g>-1&&i.splice(g,1),s.auditStatus=e,s.auditTime=new Date().toLocaleString(),s.auditor=v.user.name,e==="approved"?re.value.unshift(s):ie.value.unshift(s),pe(),E.success(`订单${r}成功`)}catch(i){E.error(`${r}失败`)}})).catch(()=>{})},pe=()=>{K.pending=M.value.length,K.approved=re.value.length,K.rejected=ie.value.length,Q.pendingCount=M.value.length,Q.pendingAmount=M.value.reduce((s,e)=>s+e.totalAmount,0)},gt=()=>P(this,null,function*(){Z.value&&(yield Z.value.validate(s=>P(this,null,function*(){if(s){q.value=!0;try{yield new Promise(i=>setTimeout(i,1500));const e=B.value?$.value:[_.value],r=f.result==="approved"?"通过":"拒绝";e.forEach(i=>{const g=M.value.findIndex(x=>x.id===i.id);g>-1&&M.value.splice(g,1),i.auditStatus=f.result,i.auditTime=new Date().toLocaleString(),i.auditor=v.user.name,i.auditRemark=f.remark,f.result==="approved"?re.value.unshift(i):ie.value.unshift(i)}),ye(),pe(),$.value=[],de.value=!1,E.success(`成功${r}${e.length}个订单`),e.forEach(i=>{var n,T,D;const g=f.result==="approved"?A.MessageType.AUDIT_APPROVED:A.MessageType.AUDIT_REJECTED,x=f.result==="approved"?"审核通过":"审核拒绝";A.sendMessage(g,`订单 ${i.orderNo} (客户: ${i.customerName}, 金额: ¥${(n=i.totalAmount)==null?void 0:n.toLocaleString()}) 已${x}`,{relatedId:i.id,relatedType:"order",actionUrl:`/order/detail/${i.id}`}),f.result==="approved"?(R.auditOrder(i.id,"approved",f.remark,((T=v.userInfo)==null?void 0:T.name)||"当前用户"),A.sendMessage(A.MessageType.ORDER_SHIPPED,`订单 ${i.orderNo} 审核通过，已流转到物流发货列表`,{relatedId:i.id,relatedType:"order",actionUrl:"/logistics/shipping"})):(R.auditOrder(i.id,"rejected",f.remark,((D=v.userInfo)==null?void 0:D.name)||"当前用户"),A.sendMessage(A.MessageType.ORDER_CANCELLED,`订单 ${i.orderNo} 审核被拒绝，已退回修改。拒绝原因：${f.remark}`,{relatedId:i.id,relatedType:"order",actionUrl:`/order/edit/${i.id}`}))}),H.value=!1,f.result="approved",f.remark="",f.rejectionReasonId=""}catch(e){E.error("审核失败")}finally{q.value=!1}}})))}),_t=()=>P(this,null,function*(){Re.value&&(yield Re.value.validate(s=>P(this,null,function*(){if(s){F.value=!0;try{yield new Promise(r=>setTimeout(r,800));const e=le.value.find(r=>r.id===_.value.id);e&&(e.remark=ue.content),E.success("备注保存成功"),b.value=!1,ue.content=""}catch(e){E.error("保存备注失败")}finally{F.value=!1}}})))}),Pe=()=>{var s;H.value=!1,f.result="approved",f.remark="",B.value=!1,(s=Z.value)==null||s.clearValidate()},Te=()=>{var s;d.value=!1,S.result="",S.rejectionReason="",S.remark="",_.value={},(s=_e.value)==null||s.clearValidate()},yt=s=>{je[s]=!0},bt=(s,e)=>{Y.value=s.map(r=>r.url),L.value=e,ae.value=!0},kt=()=>{ae.value=!1,Y.value=[],L.value=0},ht=()=>{L.value>0&&L.value--},wt=()=>{L.value<Y.value.length-1&&L.value++},Rt=s=>{switch(s){case"created":return"primary";case"submitted":return"warning";case"approved":return"success";case"rejected":return"danger";default:return"info"}},Ct=s=>{switch(s){case"created":return"Plus";case"submitted":return"Upload";case"approved":return"Check";case"rejected":return"Close";default:return"InfoFilled"}},Tt=s=>{switch(s){case"created":return"info";case"submitted":return"warning";case"approved":return"success";case"rejected":return"danger";default:return""}},At=()=>P(this,null,function*(){_e.value&&(yield _e.value.validate(s=>P(this,null,function*(){var e,r,i,g,x;if(s){U.value=!0;try{yield new Promise(ee=>setTimeout(ee,1e3));const n=_.value,T=S.result;n.auditStatus=T,n.auditTime=new Date().toLocaleString(),n.auditor=((e=v.userInfo)==null?void 0:e.name)||"当前用户",n.auditRemark=S.remark,n.auditHistory||(n.auditHistory=[]),n.auditHistory.push({id:n.auditHistory.length+1,action:T,actionName:T==="approved"?"审核通过":"审核拒绝",operator:((r=v.userInfo)==null?void 0:r.name)||"当前用户",operatorRole:"审核员",time:new Date().toLocaleString(),remark:S.remark});const D=M.value.findIndex(ee=>ee.id===n.id);D>-1&&M.value.splice(D,1),T==="approved"?re.value.unshift(n):ie.value.unshift(n),ye(),pe();const X=T==="approved"?A.MessageType.AUDIT_APPROVED:A.MessageType.AUDIT_REJECTED,ve=T==="approved"?"审核通过":"审核拒绝";if(A.sendMessage(X,`订单 ${n.orderNo} (客户: ${n.customerName}, 金额: ¥${(i=n.totalAmount)==null?void 0:i.toLocaleString()}) 已${ve}`,{relatedId:n.id,relatedType:"order",actionUrl:`/order/detail/${n.id}`}),T==="approved")R.auditOrder(n.id,"approved",S.remark,((g=v.userInfo)==null?void 0:g.name)||"当前用户"),A.sendMessage(A.MessageType.ORDER_SHIPPED,`订单 ${n.orderNo} 审核通过，已流转到物流发货列表`,{relatedId:n.id,relatedType:"order",actionUrl:"/logistics/shipping"});else{const ee=S.rejectionReason||S.remark;R.auditOrder(n.id,"rejected",ee,((x=v.userInfo)==null?void 0:x.name)||"当前用户"),A.sendMessage(A.MessageType.ORDER_CANCELLED,`订单 ${n.orderNo} 审核被拒绝，已退回修改。拒绝原因：${ee}`,{relatedId:n.id,relatedType:"order",actionUrl:`/order/edit/${n.id}`})}E.success(`订单${T==="approved"?"审核通过":"审核拒绝"}`),Te()}catch(n){E.error("审核失败，请重试")}finally{U.value=!1}}})))}),Ae=()=>{J.page=1,be()},Vt=()=>{Object.assign(j,{orderNo:"",customerName:"",salesPerson:"",minAmount:"",maxAmount:"",dateRange:[]}),Ae()},Oe=s=>{Ce.value=s;const e=new Date,r=new Date(e);r.setDate(r.getDate()-1);const i=new Date(e);i.setDate(e.getDate()-e.getDay());const g=new Date(e.getFullYear(),e.getMonth(),1),x=new Date(e.getFullYear(),0,1);switch(s){case"today":j.dateRange=[e,e];break;case"yesterday":j.dateRange=[r,r];break;case"thisWeek":j.dateRange=[i,e];break;case"thisMonth":j.dateRange=[g,e];break;case"thisYear":j.dateRange=[x,e];break;case"all":j.dateRange=[];break}Ae()},St=()=>{$.value=[],de.value=!1,be(),Be()},Dt=()=>{C.value=!0},Ue=()=>{C.value=!1},jt=()=>f.result==="rejected"?f.rejectionReasonId?"请输入补充说明（选填）":"请先选择拒绝原因":"请输入审核备注（选填）",Nt=s=>{Z.value&&Z.value.clearValidate(["remark"])},xt=s=>{s!=="rejected"&&(f.rejectionReasonId=""),Z.value&&Z.value.clearValidate(["rejectionReasonId","remark"])},It=s=>{J.size=s,be()},$t=s=>{J.page=s,be()},ye=()=>{const s=M.value.length,e=M.value.reduce((n,T)=>n+T.totalAmount,0),r=new Date().toISOString().split("T")[0],i=M.value.filter(n=>new Date(n.createTime).toISOString().split("T")[0]===r).length,g=new Date,x=M.value.filter(n=>{const T=new Date(n.createTime);return(g.getTime()-T.getTime())/(1e3*60*60)>24}).length;Object.assign(Q,{pendingCount:s,pendingAmount:e,todayCount:i,urgentCount:x}),console.log("汇总数据已更新",Q)},Be=()=>P(this,null,function*(){try{const s=yield pa.getStatistics();Object.assign(Q,{pendingCount:s.pendingCount,pendingAmount:s.pendingAmount,todayCount:s.todayCount,urgentCount:s.urgentCount}),console.log("汇总数据加载成功",Q)}catch(s){console.error("加载汇总数据失败:",s),ye()}}),Pt=s=>{const e=v.currentUser;return e?e.role==="admin"?s:e.role==="department_manager"?s.filter(r=>{const i=v.getUserById(r.createdBy);return(i==null?void 0:i.department)===e.department}):e.role==="sales_staff"?s.filter(r=>r.createdBy===e.id):e.role==="customer_service"?s.filter(r=>r.servicePersonId===e.id):s.filter(r=>r.createdBy===e.id):[]},be=()=>P(this,null,function*(){W.value=!0;try{const e=Pt(R.orders).filter(n=>n.markType==="reserved"||n.markType==="return"||n.auditStatus!=="pending"?!1:n.markType==="normal"?n.isAuditTransferred===!0:!0);yield new Promise(n=>setTimeout(n,300));const r=e.map(n=>({id:n.id,orderNo:n.orderNumber,customerName:n.customerName,customerPhone:n.customerPhone,salesPerson:n.createdBy,totalAmount:n.totalAmount,depositAmount:n.depositAmount,codAmount:n.totalAmount-n.depositAmount,productCount:n.products.length,createTime:n.createTime,waitingHours:Math.floor((new Date().getTime()-new Date(n.createTime).getTime())/(1e3*60*60)),remark:n.remark||"",auditStatus:n.auditStatus,hasBeenAudited:n.hasBeenAudited||!1,deliveryAddress:n.receiverAddress,paymentScreenshots:n.depositScreenshot?[{id:1,url:n.depositScreenshot,name:"定金截图.jpg"}]:[],auditHistory:[{id:1,action:"created",actionName:"订单创建",operator:n.customerName,operatorRole:"客户",time:n.createTime,remark:"客户下单"},{id:2,action:"submitted",actionName:"提交审核",operator:n.createdBy,operatorRole:"销售员",time:n.createTime,remark:"销售员提交订单审核"}]})),i=[{id:"1",orderNo:"ORD202401150001",customerName:"张三",customerPhone:"13812345678",salesPerson:"李销售",totalAmount:2999,depositAmount:500,codAmount:2499,productCount:2,createTime:"2024-01-15 09:30:00",waitingHours:6,remark:"客户要求尽快发货",auditStatus:"pending",deliveryAddress:"北京市朝阳区建国路88号SOHO现代城A座1201室",paymentScreenshots:[{id:1,url:"/api/uploads/payment1.jpg",name:"支付宝转账截图.jpg"},{id:2,url:"/api/uploads/payment2.jpg",name:"微信支付截图.jpg"}],auditHistory:[{id:1,action:"created",actionName:"订单创建",operator:"张三",operatorRole:"客户",time:"2024-01-15 14:30:00",remark:"客户下单"},{id:2,action:"submitted",actionName:"提交审核",operator:"王销售",operatorRole:"销售员",time:"2024-01-15 14:35:00",remark:"销售员提交订单审核"}]},{id:"2",orderNo:"ORD202401150002",customerName:"李四",customerPhone:"13987654321",salesPerson:"王销售",totalAmount:1599,depositAmount:300,codAmount:1299,productCount:1,createTime:"2024-01-15 10:15:00",waitingHours:5,remark:"",auditStatus:"pending",deliveryAddress:"上海市浦东新区陆家嘴环路1000号恒生银行大厦50楼",paymentScreenshots:[{id:3,url:"/api/uploads/payment3.jpg",name:"微信支付截图.jpg"}],auditHistory:[{id:1,action:"created",actionName:"订单创建",operator:"李四",operatorRole:"客户",time:"2024-01-15 10:15:00",remark:"客户下单"},{id:2,action:"submitted",actionName:"提交审核",operator:"王销售",operatorRole:"销售员",time:"2024-01-15 10:20:00",remark:"销售员提交订单审核"}]},{id:"3",orderNo:"ORD202401140015",customerName:"王五",customerPhone:"15555666777",salesPerson:"张销售",totalAmount:4299,depositAmount:1e3,codAmount:3299,productCount:3,createTime:"2024-01-14 16:20:00",waitingHours:25,remark:"大客户订单，优先处理",auditStatus:"pending",deliveryAddress:"广州市天河区珠江新城花城大道85号高德置地广场A座2801室",paymentScreenshots:[{id:4,url:"/api/uploads/payment4.jpg",name:"银行转账截图.jpg"},{id:5,url:"/api/uploads/payment5.jpg",name:"支付宝截图.jpg"}],auditHistory:[{id:1,action:"created",actionName:"订单创建",operator:"王五",operatorRole:"客户",time:"2024-01-14 16:20:00",remark:"客户下单"},{id:2,action:"submitted",actionName:"提交审核",operator:"张销售",operatorRole:"销售员",time:"2024-01-14 16:25:00",remark:"大客户订单，优先处理"}]}],g=[{id:"4",orderNo:"ORD202401140008",customerName:"赵六",customerPhone:"18888999000",salesPerson:"李销售",totalAmount:899,depositAmount:200,codAmount:699,productCount:1,createTime:"2024-01-14 11:45:00",remark:"",auditStatus:"approved",auditTime:"2024-01-14 14:30:00",auditor:"审核员A",auditRemark:"订单信息完整，审核通过",deliveryAddress:"深圳市南山区科技园南区深南大道9988号",paymentScreenshots:[{id:6,url:"/api/uploads/payment6.jpg",name:"定金支付截图.jpg"}],auditHistory:[{id:1,action:"created",actionName:"订单创建",operator:"赵六",operatorRole:"客户",time:"2024-01-14 11:45:00",remark:"客户下单"},{id:2,action:"submitted",actionName:"提交审核",operator:"李销售",operatorRole:"销售员",time:"2024-01-14 11:50:00",remark:"销售员提交订单审核"},{id:3,action:"approved",actionName:"审核通过",operator:"审核员A",operatorRole:"审核员",time:"2024-01-14 14:30:00",remark:"订单信息完整，审核通过"}]},{id:"5",orderNo:"ORD202401130022",customerName:"钱七",customerPhone:"17777888999",salesPerson:"王销售",totalAmount:6599,depositAmount:1500,codAmount:5099,productCount:4,createTime:"2024-01-13 14:30:00",remark:"VIP客户，需要特殊包装",auditStatus:"approved",auditTime:"2024-01-13 16:45:00",auditor:"审核员B",auditRemark:"VIP客户订单，优先处理",deliveryAddress:"杭州市西湖区文三路259号昌地火炬大厦1号楼17层",paymentScreenshots:[{id:7,url:"/api/uploads/payment7.jpg",name:"VIP客户转账截图.jpg"},{id:8,url:"/api/uploads/payment8.jpg",name:"银行回单.jpg"}],auditHistory:[{id:1,action:"created",actionName:"订单创建",operator:"钱七",operatorRole:"客户",time:"2024-01-13 14:30:00",remark:"VIP客户，需要特殊包装"},{id:2,action:"submitted",actionName:"提交审核",operator:"王销售",operatorRole:"销售员",time:"2024-01-13 14:35:00",remark:"VIP客户订单，优先处理"},{id:3,action:"approved",actionName:"审核通过",operator:"审核员B",operatorRole:"审核员",time:"2024-01-13 16:45:00",remark:"VIP客户订单，优先处理"}]}],x=[{id:"6",orderNo:"ORD202401120005",customerName:"孙八",customerPhone:"16666555444",salesPerson:"李销售",totalAmount:1299,depositAmount:0,codAmount:1299,productCount:1,createTime:"2024-01-12 15:20:00",remark:"",auditStatus:"rejected",auditTime:"2024-01-12 17:30:00",auditor:"审核员A",auditRemark:"客户信息不完整，需要补充联系地址",deliveryAddress:"成都市高新区天府大道中段1388号美年广场C座",paymentScreenshots:[],auditHistory:[{id:1,action:"created",actionName:"订单创建",operator:"孙八",operatorRole:"客户",time:"2024-01-12 15:20:00",remark:"客户下单"},{id:2,action:"submitted",actionName:"提交审核",operator:"李销售",operatorRole:"销售员",time:"2024-01-12 15:25:00",remark:"销售员提交订单审核"},{id:3,action:"rejected",actionName:"审核拒绝",operator:"审核员A",operatorRole:"审核员",time:"2024-01-12 17:30:00",remark:"客户信息不完整，需要补充联系地址"}]}];M.value=[...r,...i],re.value=g,ie.value=x,pe(),ye(),J.total=le.value.length}catch(s){E.error("加载订单列表失败")}finally{W.value=!1}});return Kt(()=>P(this,null,function*(){Oe("today"),Be()})),(s,e)=>{const r=y("el-icon"),i=y("el-card"),g=y("el-col"),x=y("el-row"),n=y("el-button"),T=y("el-input"),D=y("el-form-item"),X=y("el-option"),ve=y("el-select"),ee=y("el-date-picker"),ke=y("el-form"),Me=y("el-badge"),Ve=y("el-tab-pane"),Ot=y("el-tabs"),ze=y("el-divider"),Ut=y("el-checkbox"),fe=y("el-tag"),Bt=y("Document"),Ee=y("el-image"),he=y("el-radio"),He=y("el-radio-group"),Mt=y("el-timeline-item"),zt=y("el-timeline"),Et=y("el-collapse-transition"),ge=y("el-dialog");return m(),N("div",xa,[e[74]||(e[74]=l("div",{class:"page-header"},[l("h2",null,"订单审核")],-1)),l("div",Ia,[t(x,{gutter:20},{default:a(()=>[t(g,{span:6},{default:a(()=>[t(i,{class:"summary-card"},{default:a(()=>[l("div",$a,[l("div",Pa,[t(r,null,{default:a(()=>[t(u(De))]),_:1})]),l("div",Oa,[l("div",Ua,c(Q.pendingCount),1),e[26]||(e[26]=l("div",{class:"summary-label"},"待审核订单",-1))])])]),_:1})]),_:1}),t(g,{span:6},{default:a(()=>[t(i,{class:"summary-card"},{default:a(()=>[l("div",Ba,[l("div",Ma,[t(r,null,{default:a(()=>[t(u(aa))]),_:1})]),l("div",za,[l("div",Ea,"¥"+c((Q.pendingAmount||0).toLocaleString()),1),e[27]||(e[27]=l("div",{class:"summary-label"},"待审核金额",-1))])])]),_:1})]),_:1}),t(g,{span:6},{default:a(()=>[t(i,{class:"summary-card"},{default:a(()=>[l("div",Ha,[l("div",Fa,[t(r,null,{default:a(()=>[t(u(la))]),_:1})]),l("div",La,[l("div",qa,c(Q.todayCount),1),e[28]||(e[28]=l("div",{class:"summary-label"},"今日新增",-1))])])]),_:1})]),_:1}),t(g,{span:6},{default:a(()=>[t(i,{class:"summary-card"},{default:a(()=>[l("div",Ya,[l("div",Qa,[t(r,null,{default:a(()=>[t(u(oa))]),_:1})]),l("div",Wa,[l("div",Ja,c(Q.urgentCount),1),e[29]||(e[29]=l("div",{class:"summary-label"},"超时订单",-1))])])]),_:1})]),_:1})]),_:1})]),t(i,{class:"quick-filter-card"},{default:a(()=>[l("div",Ga,[e[30]||(e[30]=l("span",{class:"filter-label"},"快捷筛选：",-1)),l("div",Ka,[(m(),N(te,null,se(lt,o=>t(n,{key:o.value,type:Ce.value===o.value?"primary":"default",class:Se({"active-filter":Ce.value===o.value}),size:"small",round:"",onClick:V=>Oe(o.value)},{default:a(()=>[p(c(o.label),1)]),_:2},1032,["type","class","onClick"])),64))])])]),_:1}),t(i,{class:"search-card"},{default:a(()=>[t(ke,{model:j,inline:""},{default:a(()=>[t(D,{label:"订单号"},{default:a(()=>[t(T,{modelValue:j.orderNo,"onUpdate:modelValue":e[0]||(e[0]=o=>j.orderNo=o),placeholder:"请输入订单号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(D,{label:"客户姓名"},{default:a(()=>[t(T,{modelValue:j.customerName,"onUpdate:modelValue":e[1]||(e[1]=o=>j.customerName=o),placeholder:"请输入客户姓名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(D,{label:"销售人员"},{default:a(()=>[t(ve,{modelValue:j.salesPerson,"onUpdate:modelValue":e[2]||(e[2]=o=>j.salesPerson=o),placeholder:"请选择销售人员",clearable:"",style:{width:"200px"}},{default:a(()=>[t(X,{label:"全部",value:""}),t(X,{label:"张销售",value:"张销售"}),t(X,{label:"李销售",value:"李销售"}),t(X,{label:"王销售",value:"王销售"})]),_:1},8,["modelValue"])]),_:1}),t(D,{label:"订单金额"},{default:a(()=>[t(T,{modelValue:j.minAmount,"onUpdate:modelValue":e[3]||(e[3]=o=>j.minAmount=o),placeholder:"最小金额",type:"number",style:{width:"120px"}},null,8,["modelValue"]),e[31]||(e[31]=l("span",{style:{margin:"0 8px"}},"-",-1)),t(T,{modelValue:j.maxAmount,"onUpdate:modelValue":e[4]||(e[4]=o=>j.maxAmount=o),placeholder:"最大金额",type:"number",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),t(D,{label:"创建时间"},{default:a(()=>[t(ee,{modelValue:j.dateRange,"onUpdate:modelValue":e[5]||(e[5]=o=>j.dateRange=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),t(D,null,{default:a(()=>[t(n,{onClick:Ae,type:"primary",icon:u(sa)},{default:a(()=>[...e[32]||(e[32]=[p("搜索",-1)])]),_:1},8,["icon"]),t(n,{onClick:Vt,icon:u(Ye)},{default:a(()=>[...e[33]||(e[33]=[p("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),t(i,{class:"table-card-container"},{default:a(()=>[t(ga,{data:le.value,columns:ot.value,"storage-key":`order-audit-${w.value}`,loading:W.value,"show-selection":!0,"show-actions":!0,total:J.total,"page-sizes":[10,20,50,100],"current-page":J.page,"page-size":J.size,onSelectionChange:mt,onSizeChange:It,onCurrentChange:$t},{"header-actions":a(()=>[l("div",Za,[t(Ot,{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=o=>w.value=o),onTabChange:ut,class:"audit-tabs"},{default:a(()=>[t(Ve,{label:"待审核",name:"pending"},{label:a(()=>[l("span",{class:"tab-label",onClick:e[6]||(e[6]=o=>yt("pending"))},[t(r,null,{default:a(()=>[t(u(De))]),_:1}),e[34]||(e[34]=p(" 待审核 ",-1)),!je.pending&&K.pending>0?(m(),O(Me,{key:0,value:K.pending,max:99,class:"tab-badge"},null,8,["value"])):K.pending>0?(m(),N("span",Xa,c(K.pending),1)):z("",!0)])]),_:1}),t(Ve,{label:"已审核通过",name:"approved"},{label:a(()=>[l("span",el,[t(r,null,{default:a(()=>[t(u(ce))]),_:1}),e[35]||(e[35]=p(" 已审核通过 ",-1))])]),_:1}),t(Ve,{label:"审核拒绝",name:"rejected"},{label:a(()=>[l("span",tl,[t(r,null,{default:a(()=>[t(u(me))]),_:1}),e[36]||(e[36]=p(" 审核拒绝 ",-1))])]),_:1})]),_:1},8,["modelValue"])]),e[39]||(e[39]=l("div",{class:"header-spacer"},null,-1)),l("div",al,[t(n,{onClick:e[8]||(e[8]=o=>Ie("approved")),type:"success",disabled:$.value.length===0,icon:u(ce),size:"small"},{default:a(()=>[p(" 批量通过 ("+c($.value.length)+") ",1)]),_:1},8,["disabled","icon"]),t(n,{onClick:e[9]||(e[9]=o=>Ie("rejected")),type:"danger",disabled:$.value.length===0,icon:u(me),size:"small"},{default:a(()=>[p(" 批量拒绝 ("+c($.value.length)+") ",1)]),_:1},8,["disabled","icon"]),t(n,{onClick:St,icon:u(Ye),size:"small"},{default:a(()=>[...e[37]||(e[37]=[p("刷新",-1)])]),_:1},8,["icon"]),t(ze,{direction:"vertical"}),t(Ut,{modelValue:de.value,"onUpdate:modelValue":e[10]||(e[10]=o=>de.value=o),onChange:ct,indeterminate:tt.value},{default:a(()=>[...e[38]||(e[38]=[p(" 全选 ",-1)])]),_:1},8,["modelValue","indeterminate"]),t(ze,{direction:"vertical"}),l("span",ll,"共 "+c(J.total)+" 条记录",1)])]),customerPhone:a(({row:o})=>[p(c(u(va)(o.customerPhone)),1)]),totalAmount:a(({row:o})=>[l("span",ol,"¥"+c((o.totalAmount||0).toLocaleString()),1)]),waitingTime:a(({row:o})=>[t(fe,{type:Ne(o.waitingHours),size:"small"},{default:a(()=>[p(c(o.waitingHours)+"小时 ",1)]),_:2},1032,["type"])]),auditStatus:a(({row:o})=>[t(fe,{type:it(o.auditStatus),size:"small"},{default:a(()=>[p(c(dt(o.auditStatus)),1)]),_:2},1032,["type"])]),hasBeenAudited:a(({row:o})=>[o.hasBeenAudited?(m(),O(fe,{key:0,type:"warning",size:"small",effect:"plain"},{default:a(()=>[...e[40]||(e[40]=[p(" 曾审过 ",-1)])]),_:1})):(m(),N("span",sl,"-"))]),"table-actions":a(({row:o})=>[t(n,{onClick:V=>vt(o),type:"primary",link:"",size:"small",icon:u(na)},{default:a(()=>[...e[41]||(e[41]=[p(" 查看 ",-1)])]),_:1},8,["onClick","icon"]),w.value==="pending"?(m(),N(te,{key:0},[t(n,{onClick:V=>xe(o,"approved"),type:"success",link:"",size:"small",icon:u(ce)},{default:a(()=>[...e[42]||(e[42]=[p(" 通过 ",-1)])]),_:1},8,["onClick","icon"]),t(n,{onClick:V=>xe(o,"rejected"),type:"danger",link:"",size:"small",icon:u(me)},{default:a(()=>[...e[43]||(e[43]=[p(" 拒绝 ",-1)])]),_:1},8,["onClick","icon"])],64)):w.value==="approved"?(m(),O(n,{key:1,onClick:V=>$e(o,"rejected"),type:"danger",link:"",size:"small",icon:u(me)},{default:a(()=>[...e[44]||(e[44]=[p(" 撤销 ",-1)])]),_:1},8,["onClick","icon"])):w.value==="rejected"?(m(),O(n,{key:2,onClick:V=>$e(o,"approved"),type:"success",link:"",size:"small",icon:u(ce)},{default:a(()=>[...e[45]||(e[45]=[p(" 重新通过 ",-1)])]),_:1},8,["onClick","icon"])):z("",!0),t(n,{onClick:V=>ft(o),type:"warning",link:"",size:"small",icon:u(Qe)},{default:a(()=>[...e[46]||(e[46]=[p(" 备注 ",-1)])]),_:1},8,["onClick","icon"])]),_:1},8,["data","columns","storage-key","loading","total","current-page","page-size"])]),_:1}),t(ge,{modelValue:d.value,"onUpdate:modelValue":e[15]||(e[15]=o=>d.value=o),title:"订单审核",width:"800px","before-close":Te},{footer:a(()=>[l("div",ql,[t(n,{onClick:Te},{default:a(()=>[...e[66]||(e[66]=[p("取消",-1)])]),_:1}),t(n,{onClick:At,type:"primary",loading:U.value,disabled:!S.result},{default:a(()=>[p(" 确认"+c(S.result==="approved"?"通过":"拒绝"),1)]),_:1},8,["loading","disabled"])])]),default:a(()=>[_.value?(m(),N("div",nl,[t(i,{class:"order-info-card",shadow:"never"},{header:a(()=>[l("div",rl,[t(r,null,{default:a(()=>[t(Bt)]),_:1}),e[47]||(e[47]=l("span",null,"订单基本信息",-1))])]),default:a(()=>[t(x,{gutter:20},{default:a(()=>[t(g,{span:12},{default:a(()=>[l("div",il,[e[48]||(e[48]=l("span",{class:"label"},"订单号：",-1)),l("span",dl,c(_.value.orderNo),1)])]),_:1}),t(g,{span:12},{default:a(()=>{var o;return[l("div",ul,[e[49]||(e[49]=l("span",{class:"label"},"订单金额：",-1)),l("span",cl,"¥"+c((o=_.value.totalAmount)==null?void 0:o.toLocaleString()),1)])]}),_:1}),t(g,{span:12},{default:a(()=>[l("div",ml,[e[50]||(e[50]=l("span",{class:"label"},"定金金额：",-1)),l("span",pl,"¥"+c((_.value.depositAmount||0).toLocaleString()),1)])]),_:1}),t(g,{span:12},{default:a(()=>[l("div",vl,[e[51]||(e[51]=l("span",{class:"label"},"到付金额：",-1)),l("span",fl,"¥"+c((_.value.codAmount||0).toLocaleString()),1)])]),_:1}),t(g,{span:12},{default:a(()=>[l("div",gl,[e[52]||(e[52]=l("span",{class:"label"},"客户姓名：",-1)),l("span",_l,c(_.value.customerName),1)])]),_:1}),t(g,{span:12},{default:a(()=>{var o;return[l("div",yl,[e[53]||(e[53]=l("span",{class:"label"},"联系电话：",-1)),l("span",bl,c(u(fa)(_.value.customerPhone,u(ma).PHONE,((o=u(v).currentUser)==null?void 0:o.id)||"")),1)])]}),_:1}),t(g,{span:24},{default:a(()=>[l("div",kl,[e[54]||(e[54]=l("span",{class:"label"},"收货地址：",-1)),l("span",hl,c(_.value.deliveryAddress),1)])]),_:1}),t(g,{span:12},{default:a(()=>[l("div",wl,[e[55]||(e[55]=l("span",{class:"label"},"销售人员：",-1)),l("span",Rl,c(_.value.salesPerson),1)])]),_:1}),t(g,{span:12},{default:a(()=>[l("div",Cl,[e[56]||(e[56]=l("span",{class:"label"},"产品数量：",-1)),l("span",Tl,c(_.value.productCount)+" 件",1)])]),_:1}),t(g,{span:12},{default:a(()=>[l("div",Al,[e[57]||(e[57]=l("span",{class:"label"},"创建时间：",-1)),l("span",Vl,c(_.value.createTime),1)])]),_:1}),_.value.waitingHours?(m(),O(g,{key:0,span:12},{default:a(()=>[l("div",Sl,[e[58]||(e[58]=l("span",{class:"label"},"等待时间：",-1)),l("span",{class:Se(["value",Ne(_.value.waitingHours)])},c(_.value.waitingHours)+" 小时 ",3)])]),_:1})):z("",!0),_.value.remark?(m(),O(g,{key:1,span:24},{default:a(()=>[l("div",Dl,[e[59]||(e[59]=l("span",{class:"label"},"订单备注：",-1)),l("span",jl,c(_.value.remark),1)])]),_:1})):z("",!0),_.value.paymentScreenshots&&_.value.paymentScreenshots.length>0?(m(),O(g,{key:2,span:24},{default:a(()=>[l("div",Nl,[e[61]||(e[61]=l("span",{class:"label"},"支付截图：",-1)),l("div",xl,[(m(!0),N(te,null,se(_.value.paymentScreenshots,(o,V)=>(m(),N("div",{key:o.id,class:"screenshot-item",onClick:Ht=>bt(_.value.paymentScreenshots,V)},[t(Ee,{src:o.url,alt:o.name,fit:"cover",class:"screenshot-thumbnail","preview-disabled":!0},{error:a(()=>[l("div",$l,[t(r,null,{default:a(()=>[t(u(We))]),_:1}),e[60]||(e[60]=l("span",null,"加载失败",-1))])]),_:1},8,["src","alt"]),l("div",Pl,c(o.name),1),l("div",Ol,[t(r,{class:"view-icon"},{default:a(()=>[t(u(ra))]),_:1})])],8,Il))),128))])])]),_:1})):z("",!0)]),_:1})]),_:1}),t(i,{class:"audit-action-card",shadow:"never"},{header:a(()=>[l("div",Ul,[t(r,null,{default:a(()=>[t(u(Qe))]),_:1}),e[62]||(e[62]=l("span",null,"审核操作",-1))])]),default:a(()=>[t(ke,{ref_key:"quickAuditFormRef",ref:_e,model:S,rules:rt.value,"label-width":"100px"},{default:a(()=>[t(D,{label:"审核结果",prop:"result",required:!1},{default:a(()=>[t(He,{modelValue:S.result,"onUpdate:modelValue":e[11]||(e[11]=o=>S.result=o)},{default:a(()=>[t(he,{value:"approved"},{default:a(()=>[t(r,{color:"#67c23a"},{default:a(()=>[t(u(ce))]),_:1}),e[63]||(e[63]=p(" 审核通过 ",-1))]),_:1}),t(he,{value:"rejected"},{default:a(()=>[t(r,{color:"#f56c6c"},{default:a(()=>[t(u(me))]),_:1}),e[64]||(e[64]=p(" 审核拒绝 ",-1))]),_:1})]),_:1},8,["modelValue"])]),_:1}),S.result==="rejected"?(m(),O(D,{key:0,label:"拒绝原因",prop:"rejectionReason",required:""},{default:a(()=>[t(ve,{modelValue:S.rejectionReason,"onUpdate:modelValue":e[12]||(e[12]=o=>S.rejectionReason=o),placeholder:"请选择拒绝原因",style:{width:"100%"}},{default:a(()=>[(m(!0),N(te,null,se(u(I).reasons,o=>(m(),O(X,{key:o.id,label:o.name,value:o.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):z("",!0),t(D,{label:"审核备注",prop:"remark",required:!1},{default:a(()=>[t(T,{modelValue:S.remark,"onUpdate:modelValue":e[13]||(e[13]=o=>S.remark=o),type:"textarea",rows:3,placeholder:"请输入审核备注（选填）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),t(i,{class:"audit-history-card",shadow:"never"},{header:a(()=>{var o,V;return[l("div",{class:"card-header",onClick:e[14]||(e[14]=Ht=>ne.value=!ne.value),style:{cursor:"pointer"}},[l("div",Bl,[t(r,null,{default:a(()=>[t(u(De))]),_:1}),e[65]||(e[65]=l("span",null,"审核轨迹",-1)),t(Me,{value:((V=(o=_.value)==null?void 0:o.auditHistory)==null?void 0:V.length)||0,max:99,type:"info",style:{"margin-left":"8px"}},null,8,["value"])]),t(r,{class:Se(["collapse-icon",{collapsed:ne.value}])},{default:a(()=>[t(u(Je))]),_:1},8,["class"])])]}),default:a(()=>[t(Et,null,{default:a(()=>[Zt(l("div",null,[t(zt,{size:"small"},{default:a(()=>{var o;return[(m(!0),N(te,null,se(((o=_.value)==null?void 0:o.auditHistory)||[],V=>(m(),O(Mt,{key:V.id,timestamp:V.time,type:Rt(V.action),icon:Ct(V.action),placement:"top"},{default:a(()=>[l("div",{class:"timeline-content-compact","data-action":V.action},[l("div",zl,[l("span",El,c(V.actionName),1),t(fe,{type:Tt(V.action),size:"small"},{default:a(()=>[p(c(V.operatorRole),1)]),_:2},1032,["type"])]),l("div",Hl,[l("span",Fl,c(V.operator),1),V.remark?(m(),N("span",Ll,c(V.remark),1)):z("",!0)])],8,Ml)]),_:2},1032,["timestamp","type","icon"]))),128))]}),_:1})],512),[[Xt,!ne.value]])]),_:1})]),_:1})])):z("",!0)]),_:1},8,["modelValue"]),t(ge,{modelValue:ae.value,"onUpdate:modelValue":e[16]||(e[16]=o=>ae.value=o),title:"支付截图查看",width:"80%","before-close":kt,class:"image-viewer-dialog"},{default:a(()=>[Y.value.length>0?(m(),N("div",Yl,[t(Ee,{src:Y.value[L.value],fit:"contain",class:"viewer-image"},{error:a(()=>[l("div",Ql,[t(r,{size:"48"},{default:a(()=>[t(u(We))]),_:1}),e[67]||(e[67]=l("p",null,"图片加载失败",-1))])]),_:1},8,["src"]),Y.value.length>1?(m(),N("div",Wl,[t(n,{onClick:ht,disabled:L.value===0,circle:"",class:"nav-btn prev-btn"},{default:a(()=>[t(r,null,{default:a(()=>[t(u(ia))]),_:1})]),_:1},8,["disabled"]),l("span",Jl,c(L.value+1)+" / "+c(Y.value.length),1),t(n,{onClick:wt,disabled:L.value===Y.value.length-1,circle:"",class:"nav-btn next-btn"},{default:a(()=>[t(r,null,{default:a(()=>[t(u(Je))]),_:1})]),_:1},8,["disabled"])])):z("",!0)])):z("",!0)]),_:1},8,["modelValue"]),t(ge,{modelValue:H.value,"onUpdate:modelValue":e[20]||(e[20]=o=>H.value=o),title:at.value,width:"600px","before-close":Pe},{footer:a(()=>[l("div",Zl,[t(n,{onClick:Pe},{default:a(()=>[...e[71]||(e[71]=[p("取消",-1)])]),_:1}),t(n,{onClick:gt,type:"primary",loading:q.value},{default:a(()=>[p(" 确认"+c(f.result==="approved"?"通过":"拒绝"),1)]),_:1},8,["loading"])])]),default:a(()=>[t(ke,{ref_key:"auditFormRef",ref:Z,model:f,rules:st.value,"label-width":"100px"},{default:a(()=>[t(D,{label:"审核结果",prop:"result",required:!1},{default:a(()=>[t(He,{modelValue:f.result,"onUpdate:modelValue":e[17]||(e[17]=o=>f.result=o),onChange:xt},{default:a(()=>[t(he,{value:"approved"},{default:a(()=>[t(r,{color:"#67c23a"},{default:a(()=>[t(u(ce))]),_:1}),e[68]||(e[68]=p(" 审核通过 ",-1))]),_:1}),t(he,{value:"rejected"},{default:a(()=>[t(r,{color:"#f56c6c"},{default:a(()=>[t(u(me))]),_:1}),e[69]||(e[69]=p(" 审核拒绝 ",-1))]),_:1})]),_:1},8,["modelValue"])]),_:1}),f.result==="rejected"?(m(),O(D,{key:0,label:"拒绝原因",prop:"rejectionReasonId",required:""},{default:a(()=>[l("div",Gl,[t(ve,{modelValue:f.rejectionReasonId,"onUpdate:modelValue":e[18]||(e[18]=o=>f.rejectionReasonId=o),placeholder:"请选择拒绝原因",clearable:"",filterable:"",onChange:Nt,style:{width:"300px"}},{default:a(()=>[(m(!0),N(te,null,se(u(I).getReasonOptions(),o=>(m(),O(X,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(n,{type:"text",onClick:Dt,style:{"margin-left":"8px","flex-shrink":"0"}},{default:a(()=>[...e[70]||(e[70]=[p(" 管理原因 ",-1)])]),_:1})])]),_:1})):z("",!0),t(D,{label:"审核备注",prop:"remark",required:!1},{default:a(()=>[t(T,{modelValue:f.remark,"onUpdate:modelValue":e[19]||(e[19]=o=>f.remark=o),type:"textarea",rows:4,placeholder:jt(),maxlength:"500","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1}),B.value?(m(),O(D,{key:1,label:"影响订单"},{default:a(()=>[l("div",Kl,[(m(!0),N(te,null,se($.value,o=>(m(),O(fe,{key:o.id,class:"order-tag",closable:"",onClose:V=>pt(o)},{default:a(()=>[p(c(o.orderNo)+" - ¥"+c((o.totalAmount||0).toLocaleString()),1)]),_:2},1032,["onClose"]))),128))])]),_:1})):z("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(ge,{modelValue:b.value,"onUpdate:modelValue":e[24]||(e[24]=o=>b.value=o),title:"添加订单备注",width:"500px"},{footer:a(()=>[l("div",Xl,[t(n,{onClick:e[23]||(e[23]=o=>b.value=!1)},{default:a(()=>[...e[72]||(e[72]=[p("取消",-1)])]),_:1}),t(n,{onClick:_t,type:"primary",loading:F.value},{default:a(()=>[...e[73]||(e[73]=[p(" 保存备注 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(ke,{ref_key:"remarkFormRef",ref:Re,model:ue,rules:nt,"label-width":"80px"},{default:a(()=>[t(D,{label:"订单号"},{default:a(()=>[t(T,{modelValue:_.value.orderNo,"onUpdate:modelValue":e[21]||(e[21]=o=>_.value.orderNo=o),disabled:""},null,8,["modelValue"])]),_:1}),t(D,{label:"备注内容",prop:"content"},{default:a(()=>[t(T,{modelValue:ue.content,"onUpdate:modelValue":e[22]||(e[22]=o=>ue.content=o),type:"textarea",rows:4,placeholder:"请输入备注内容",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(ge,{modelValue:C.value,"onUpdate:modelValue":e[25]||(e[25]=o=>C.value=o),title:"拒绝原因管理",width:"800px",onClose:Ue},{default:a(()=>[t(Na,{onClose:Ue})]),_:1},8,["modelValue"])])}}}),co=Xe(eo,[["__scopeId","data-v-26ca435b"]]);export{co as default};
