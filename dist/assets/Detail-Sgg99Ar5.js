var J=(L,V,w)=>new Promise((E,u)=>{var T=p=>{try{b(w.next(p))}catch(t){u(t)}},A=p=>{try{b(w.throw(p))}catch(t){u(t)}},b=p=>p.done?E(p.value):Promise.resolve(p.value).then(T,A);b((w=w.apply(L,V)).next())});import{l as Ce,az as Ve,aC as Ae,r as x,Z as D,e as C,c as Me,ag as c,m as g,p as r,q as s,U as l,O as o,S as d,u as S,T as i,M as f,Q as k,F as P,a9 as F}from"./vendor-D8Vxqhr-.js";import{a3 as $e,a7 as W,am as Ee,C as Ue,E as y,F as I,c as X,b as Y,e as Be}from"./elementPlus-Bmwh7Rh8.js";import{u as De,g as Pe,c as Fe,_ as Ie}from"./settings-CuxbDWOu.js";import{m as Le}from"./phone-DsAzMHsn.js";import"./utils-ywHRn0uI.js";const ze={class:"service-detail"},Re={class:"page-header"},Oe={class:"header-left"},je={class:"title-section"},qe={class:"service-status"},Ge={class:"header-actions"},He={class:"info-grid"},Ke={class:"info-item"},Qe={class:"value"},Ze={class:"info-item"},Je={class:"value"},We={class:"info-item"},Xe={class:"value"},Ye={class:"info-item"},es={class:"info-item"},ss={class:"value"},ts={class:"info-item"},os={class:"value"},as={class:"info-grid"},ls={class:"info-item"},ns={class:"value"},is={class:"info-item"},rs={class:"value"},ds={key:1,class:"restricted-info"},us={class:"info-item"},cs={class:"value"},ps={key:0},ms={key:1,class:"restricted-info"},vs={class:"info-item"},fs={class:"value"},_s={class:"product-info"},ys={class:"product-item"},gs={class:"product-details"},ks={class:"product-spec"},bs={class:"product-meta"},Ts={class:"description-content"},hs={class:"reason-section"},ws={class:"description-section"},Ss={key:0,class:"remark-section"},Ns={class:"attachments-grid"},xs=["onClick"],Cs={class:"file-icon"},Vs={class:"file-info"},As={class:"file-name"},Ms={class:"file-size"},$s={class:"timeline-content"},Es={key:0,class:"operator"},Us={class:"quick-actions"},Bs={class:"related-info"},Ds={class:"related-item"},Ps={class:"related-item"},Fs={class:"related-item"},Is=Ce({__name:"Detail",setup(L){const V=Ve(),w=Ae(),E=Fe(V),u=De(),T=Pe(),A=x(!1),b=x(!1),p=x(!1),t=D({id:"",serviceNumber:"SH202401150001",orderNumber:"ORD202401150001",serviceType:"return",status:"processing",priority:"high",customerName:"张三",customerPhone:"13812345678",contactName:"张三",contactAddress:"北京市朝阳区xxx街道xxx号",productName:"智能手机",productSpec:"128GB 黑色",quantity:1,price:2999,reason:"商品质量问题",description:"手机屏幕出现黑屏现象，无法正常使用",remark:"客户要求退货处理",assignedTo:"李四",createdBy:"张三",createTime:"2024-01-15 10:30:00",updateTime:"2024-01-15 14:20:00",expectedTime:"2024-01-20 18:00:00",attachments:[{name:"问题图片1.jpg",size:1024e3,url:"/uploads/image1.jpg"},{name:"问题图片2.jpg",size:856e3,url:"/uploads/image2.jpg"}]}),M=x([{title:"售后申请提交",description:"客户提交售后申请",time:"2024-01-15 10:30:00",type:"success",icon:I,operator:"张三"},{title:"申请审核通过",description:"售后申请已通过审核",time:"2024-01-15 11:00:00",type:"success",icon:Be,operator:"王五"},{title:"分配处理人员",description:"已分配给李四处理",time:"2024-01-15 11:30:00",type:"success",icon:I,operator:"王五"},{title:"开始处理",description:"处理人员开始处理售后问题",time:"2024-01-15 14:00:00",type:"primary",icon:X,operator:"李四"}]),_=D({assignedTo:"",remark:""}),v=D({status:"",remark:""}),ee=x([{id:"1",name:"李四"},{id:"2",name:"赵六"},{id:"3",name:"孙八"},{id:"4",name:"周九"}]),z=C(()=>{var a;return u.canEditAfterSales||t.assignedTo===((a=u.currentUser)==null?void 0:a.name)&&u.hasAfterSalesPermission("service:write")}),R=C(()=>u.canProcessAfterSales&&t.status!=="closed"&&t.status!=="resolved"),se=C(()=>u.canCloseAfterSales&&t.status==="resolved"),te=C(()=>u.isAdmin||u.hasAfterSalesPermission("service:assign")),O=C(()=>u.hasAfterSalesPermission("service:read")),oe=()=>{V.back()},ae=()=>{E.push(`/service/edit/${t.id}`)},le=()=>{p.value=!0,v.status=t.status},ne=()=>{Y.confirm("确定要关闭此售后申请吗？","确认关闭",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{t.status="closed",T.sendMessage(T.MessageType.AFTER_SALES_CLOSED,`售后申请 ${t.serviceNumber} 已关闭，客户：${t.customerName}`,{relatedId:t.serviceNumber,relatedType:"service",actionUrl:`/service/detail/${t.serviceNumber}`,metadata:{customerName:t.customerName,serviceType:t.serviceType,closedAt:new Date().toISOString()}}),y.success("售后申请已关闭")})},ie=a=>{y.info(`查看订单 ${a}`)},re=()=>{y.success(`正在拨打 ${t.customerPhone}`)},de=()=>{b.value=!0,_.assignedTo=t.assignedTo},ue=()=>{var a;if(!_.assignedTo){y.warning("请选择处理人员");return}t.assignedTo=_.assignedTo,b.value=!1,T.sendMessage(T.MessageType.AFTER_SALES_ASSIGNED,`售后申请 ${t.serviceNumber} 已分配给 ${_.assignedTo}，客户：${t.customerName}`,{relatedId:t.serviceNumber,relatedType:"service",actionUrl:`/service/detail/${t.serviceNumber}`,metadata:{customerName:t.customerName,serviceType:t.serviceType,assignedTo:_.assignedTo}}),y.success("分配成功"),M.value.push({title:"重新分配处理人",description:`已分配给${_.assignedTo}处理`,time:new Date().toLocaleString(),type:"success",icon:I,operator:((a=u.currentUser)==null?void 0:a.name)||"系统"})},ce=()=>{p.value=!0},pe=()=>{var a;if(!v.status){y.warning("请选择状态");return}t.status=v.status,p.value=!1,T.sendMessage(T.MessageType.AFTER_SALES_STATUS_CHANGED,`售后申请 ${t.serviceNumber} 状态已更新为${U(v.status)}，客户：${t.customerName}`,{relatedId:t.serviceNumber,relatedType:"service",actionUrl:`/service/detail/${t.serviceNumber}`,metadata:{customerName:t.customerName,serviceType:t.serviceType,newStatus:v.status,remark:v.remark}}),y.success("状态更新成功"),M.value.push({title:"状态更新",description:v.remark||`状态更新为${U(v.status)}`,time:new Date().toLocaleString(),type:"primary",icon:X,operator:((a=u.currentUser)==null?void 0:a.name)||"系统"})},me=()=>{Y.prompt("请输入备注信息","添加备注",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea"}).then(({value:a})=>{var e;a&&(y.success("备注添加成功"),M.value.push({title:"添加备注",description:a,time:new Date().toLocaleString(),type:"info",icon:W,operator:((e=u.currentUser)==null?void 0:e.name)||"系统"}))})},ve=()=>{y.success("报告导出功能开发中...")},fe=a=>{y.info(`预览文件：${a.name}`)},_e=a=>{const e=[".jpg",".jpeg",".png",".gif",".bmp",".webp"],m=a.toLowerCase().substring(a.lastIndexOf("."));return e.includes(m)},ye=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":(a/(1024*1024)).toFixed(1)+" MB",ge=a=>({pending:"warning",processing:"primary",resolved:"success",closed:"info"})[a]||"info",U=a=>({pending:"待处理",processing:"处理中",resolved:"已解决",closed:"已关闭"})[a]||"未知",ke=a=>({return:"退货",exchange:"换货",repair:"维修",refund:"退款",complaint:"投诉"})[a]||"其他",be=a=>({low:"info",medium:"warning",high:"danger"})[a]||"info",Te=a=>({low:"低",medium:"中",high:"高"})[a]||"未知",he=()=>J(this,null,function*(){A.value=!0;try{const a=w.params.id;console.log("Loading service detail for ID:",a),yield new Promise(e=>setTimeout(e,500)),t.id=a}catch(a){console.error("Failed to load service detail:",a),y.error("加载售后详情失败")}finally{A.value=!1}});return Me(()=>{he()}),(a,e)=>{const m=c("el-button"),j=c("el-tag"),q=c("el-link"),h=c("el-card"),we=c("el-icon"),G=c("el-col"),Se=c("el-timeline-item"),Ne=c("el-timeline"),xe=c("el-row"),N=c("el-option"),H=c("el-select"),$=c("el-form-item"),K=c("el-input"),Q=c("el-form"),Z=c("el-dialog");return r(),g("div",ze,[s("div",Re,[s("div",Oe,[l(m,{type:"primary",icon:S($e),onClick:oe,class:"back-btn"},{default:o(()=>[...e[9]||(e[9]=[d(" 返回 ",-1)])]),_:1},8,["icon"]),s("div",je,[e[10]||(e[10]=s("h1",{class:"page-title"},"售后详情",-1)),s("div",qe,[l(j,{type:ge(t.status),size:"large",effect:"dark"},{default:o(()=>[d(i(U(t.status)),1)]),_:1},8,["type"])])])]),s("div",Ge,[z.value?(r(),f(m,{key:0,type:"primary",icon:S(W),onClick:ae},{default:o(()=>[...e[11]||(e[11]=[d(" 编辑 ",-1)])]),_:1},8,["icon"])):k("",!0),R.value?(r(),f(m,{key:1,type:"success",onClick:le},{default:o(()=>[...e[12]||(e[12]=[d(" 处理 ",-1)])]),_:1})):k("",!0),se.value?(r(),f(m,{key:2,type:"warning",onClick:ne},{default:o(()=>[...e[13]||(e[13]=[d(" 关闭 ",-1)])]),_:1})):k("",!0)])]),l(xe,{gutter:20},{default:o(()=>[l(G,{span:16},{default:o(()=>[l(h,{class:"info-card",shadow:"never"},{header:o(()=>[...e[14]||(e[14]=[s("div",{class:"card-header"},[s("h3",null,"基本信息")],-1)])]),default:o(()=>[s("div",He,[s("div",Ke,[e[15]||(e[15]=s("label",null,"售后单号：",-1)),s("span",Qe,i(t.serviceNumber),1)]),s("div",Ze,[e[16]||(e[16]=s("label",null,"原订单号：",-1)),s("span",Je,[l(q,{type:"primary",onClick:e[0]||(e[0]=n=>ie(t.orderNumber))},{default:o(()=>[d(i(t.orderNumber),1)]),_:1})])]),s("div",We,[e[17]||(e[17]=s("label",null,"服务类型：",-1)),s("span",Xe,i(ke(t.serviceType)),1)]),s("div",Ye,[e[18]||(e[18]=s("label",null,"优先级：",-1)),l(j,{type:be(t.priority)},{default:o(()=>[d(i(Te(t.priority)),1)]),_:1},8,["type"])]),s("div",es,[e[19]||(e[19]=s("label",null,"申请时间：",-1)),s("span",ss,i(t.createTime),1)]),s("div",ts,[e[20]||(e[20]=s("label",null,"处理人员：",-1)),s("span",os,i(t.assignedTo||"未分配"),1)])])]),_:1}),l(h,{class:"info-card",shadow:"never"},{header:o(()=>[...e[21]||(e[21]=[s("div",{class:"card-header"},[s("h3",null,"客户信息")],-1)])]),default:o(()=>[s("div",as,[s("div",ls,[e[22]||(e[22]=s("label",null,"客户姓名：",-1)),s("span",ns,i(t.customerName),1)]),s("div",is,[e[23]||(e[23]=s("label",null,"联系电话：",-1)),s("span",rs,[S(u).canViewPhone?(r(),f(q,{key:0,type:"primary",onClick:re},{default:o(()=>[d(i(S(Le)(t.customerPhone)),1)]),_:1})):(r(),g("span",ds,"***-****-****"))])]),s("div",us,[e[24]||(e[24]=s("label",null,"联系地址：",-1)),s("span",cs,[O.value?(r(),g("span",ps,i(t.contactAddress),1)):(r(),g("span",ms,"地址信息受限"))])]),s("div",vs,[e[25]||(e[25]=s("label",null,"联系人：",-1)),s("span",fs,i(t.contactName),1)])])]),_:1}),l(h,{class:"info-card",shadow:"never"},{header:o(()=>[...e[26]||(e[26]=[s("div",{class:"card-header"},[s("h3",null,"商品信息")],-1)])]),default:o(()=>[s("div",_s,[s("div",ys,[s("div",gs,[s("h4",null,i(t.productName),1),s("p",ks,"规格："+i(t.productSpec),1),s("div",bs,[s("span",null,"数量："+i(t.quantity),1),s("span",null,"单价：¥"+i(t.price),1)])])])])]),_:1}),l(h,{class:"info-card",shadow:"never"},{header:o(()=>[...e[27]||(e[27]=[s("div",{class:"card-header"},[s("h3",null,"问题描述")],-1)])]),default:o(()=>[s("div",Ts,[s("div",hs,[e[28]||(e[28]=s("h4",null,"问题原因",-1)),s("p",null,i(t.reason),1)]),s("div",ws,[e[29]||(e[29]=s("h4",null,"详细描述",-1)),s("p",null,i(t.description),1)]),t.remark?(r(),g("div",Ss,[e[30]||(e[30]=s("h4",null,"备注信息",-1)),s("p",null,i(t.remark),1)])):k("",!0)])]),_:1}),t.attachments&&t.attachments.length?(r(),f(h,{key:0,class:"info-card",shadow:"never"},{header:o(()=>[...e[31]||(e[31]=[s("div",{class:"card-header"},[s("h3",null,"相关附件")],-1)])]),default:o(()=>[s("div",Ns,[(r(!0),g(P,null,F(t.attachments,(n,B)=>(r(),g("div",{key:B,class:"attachment-item",onClick:Ls=>fe(n)},[s("div",Cs,[l(we,{size:"24"},{default:o(()=>[_e(n.name)?(r(),f(S(Ee),{key:0})):(r(),f(S(Ue),{key:1}))]),_:2},1024)]),s("div",Vs,[s("p",As,i(n.name),1),s("p",Ms,i(ye(n.size)),1)])],8,xs))),128))])]),_:1})):k("",!0)]),_:1}),l(G,{span:8},{default:o(()=>[l(h,{class:"progress-card",shadow:"never"},{header:o(()=>[...e[32]||(e[32]=[s("div",{class:"card-header"},[s("h3",null,"处理进度")],-1)])]),default:o(()=>[l(Ne,null,{default:o(()=>[(r(!0),g(P,null,F(M.value,(n,B)=>(r(),f(Se,{key:B,timestamp:n.time,type:n.type,icon:n.icon},{default:o(()=>[s("div",$s,[s("h4",null,i(n.title),1),s("p",null,i(n.description),1),n.operator?(r(),g("p",Es,"操作人："+i(n.operator),1)):k("",!0)])]),_:2},1032,["timestamp","type","icon"]))),128))]),_:1})]),_:1}),l(h,{class:"action-card",shadow:"never"},{header:o(()=>[...e[33]||(e[33]=[s("div",{class:"card-header"},[s("h3",null,"快速操作")],-1)])]),default:o(()=>[s("div",Us,[te.value?(r(),f(m,{key:0,type:"primary",size:"small",onClick:de,disabled:t.status==="closed"},{default:o(()=>[...e[34]||(e[34]=[d(" 分配处理人 ",-1)])]),_:1},8,["disabled"])):k("",!0),R.value?(r(),f(m,{key:1,type:"success",size:"small",onClick:ce,disabled:t.status==="closed"},{default:o(()=>[...e[35]||(e[35]=[d(" 更新状态 ",-1)])]),_:1},8,["disabled"])):k("",!0),z.value?(r(),f(m,{key:2,type:"warning",size:"small",onClick:me},{default:o(()=>[...e[36]||(e[36]=[d(" 添加备注 ",-1)])]),_:1})):k("",!0),O.value?(r(),f(m,{key:3,type:"info",size:"small",onClick:ve},{default:o(()=>[...e[37]||(e[37]=[d(" 导出报告 ",-1)])]),_:1})):k("",!0)])]),_:1}),l(h,{class:"related-card",shadow:"never"},{header:o(()=>[...e[38]||(e[38]=[s("div",{class:"card-header"},[s("h3",null,"相关信息")],-1)])]),default:o(()=>[s("div",Bs,[s("div",Ds,[e[39]||(e[39]=s("label",null,"创建人：",-1)),s("span",null,i(t.createdBy),1)]),s("div",Ps,[e[40]||(e[40]=s("label",null,"最后更新：",-1)),s("span",null,i(t.updateTime),1)]),s("div",Fs,[e[41]||(e[41]=s("label",null,"预计完成：",-1)),s("span",null,i(t.expectedTime||"未设定"),1)])])]),_:1})]),_:1})]),_:1}),l(Z,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=n=>b.value=n),title:"分配处理人",width:"400px"},{footer:o(()=>[l(m,{onClick:e[3]||(e[3]=n=>b.value=!1)},{default:o(()=>[...e[42]||(e[42]=[d("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:ue},{default:o(()=>[...e[43]||(e[43]=[d("确定",-1)])]),_:1})]),default:o(()=>[l(Q,{model:_,"label-width":"80px"},{default:o(()=>[l($,{label:"处理人员"},{default:o(()=>[l(H,{modelValue:_.assignedTo,"onUpdate:modelValue":e[1]||(e[1]=n=>_.assignedTo=n),placeholder:"请选择处理人员",style:{width:"100%"}},{default:o(()=>[(r(!0),g(P,null,F(ee.value,n=>(r(),f(N,{key:n.id,label:n.name,value:n.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l($,{label:"备注"},{default:o(()=>[l(K,{modelValue:_.remark,"onUpdate:modelValue":e[2]||(e[2]=n=>_.remark=n),type:"textarea",rows:3,placeholder:"请输入分配备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Z,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=n=>p.value=n),title:"更新状态",width:"400px"},{footer:o(()=>[l(m,{onClick:e[7]||(e[7]=n=>p.value=!1)},{default:o(()=>[...e[44]||(e[44]=[d("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:pe},{default:o(()=>[...e[45]||(e[45]=[d("确定",-1)])]),_:1})]),default:o(()=>[l(Q,{model:v,"label-width":"80px"},{default:o(()=>[l($,{label:"新状态"},{default:o(()=>[l(H,{modelValue:v.status,"onUpdate:modelValue":e[5]||(e[5]=n=>v.status=n),placeholder:"请选择状态",style:{width:"100%"}},{default:o(()=>[l(N,{label:"待处理",value:"pending"}),l(N,{label:"处理中",value:"processing"}),l(N,{label:"已解决",value:"resolved"}),l(N,{label:"已关闭",value:"closed"})]),_:1},8,["modelValue"])]),_:1}),l($,{label:"处理说明"},{default:o(()=>[l(K,{modelValue:v.remark,"onUpdate:modelValue":e[6]||(e[6]=n=>v.remark=n),type:"textarea",rows:3,placeholder:"请输入处理说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Hs=Ie(Is,[["__scopeId","data-v-8044b7f9"]]);export{Hs as default};
