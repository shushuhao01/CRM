var z=(ue,w,C)=>new Promise((q,A)=>{var Y=x=>{try{D(C.next(x))}catch(T){A(T)}},K=x=>{try{D(C.throw(x))}catch(T){A(T)}},D=x=>x.done?q(x.value):Promise.resolve(x.value).then(Y,K);D((C=C.apply(ue,w)).next())});import{l as ua,r as m,e as le,w as ye,c as ca,Y as pa,ag as _,aq as va,m as g,p as u,q as o,U as a,O as l,S as i,u as h,T as n,P as ma,M as R,F as G,a9 as H,Q as U,a7 as fa,J as _a,n as ha,af as j}from"./vendor-D8Vxqhr-.js";import{p as we,n as ga,a9 as ba,q as ya,a0 as Se,C as wa,v as Sa,a7 as ka,f as Ma,s as ke,J as Ca,Q as xa,ap as Ia,a2 as Me,K as Va,E as k,b as Ce}from"./elementPlus-Bmwh7Rh8.js";import{y as Ua,u as Da,j as Na,G as Ra,_ as Ta}from"./settings-CuxbDWOu.js";import"./utils-ywHRn0uI.js";const Oa={class:"page-header"},La={class:"header-actions"},$a={class:"share-overview"},Pa={class:"card-content"},za={class:"card-icon total"},Aa={class:"card-info"},Ya={class:"card-value"},Ba={class:"card-content"},ja={class:"card-icon amount"},Ea={class:"card-info"},Fa={class:"card-value"},Ja={class:"card-content"},qa={class:"card-icon members"},Ka={class:"card-info"},Qa={class:"card-value"},Ga={class:"card-content"},Ha={class:"card-icon orders"},Wa={class:"card-info"},Xa={class:"card-value"},Za={class:"card-header"},et={class:"header-filters"},at={class:"search-container"},tt={class:"share-members"},lt={class:"action-buttons"},st={class:"pagination-wrapper"},ot={class:"order-search-container"},rt={key:0,class:"search-result-tip"},nt={key:0,class:"no-result"},dt={key:1,class:"found-result"},it={key:2,class:"multiple-results"},ut={class:"order-option"},ct={class:"order-main"},pt={class:"customer-name"},vt={class:"order-amount"},mt={class:"order-sub"},ft={class:"phone"},_t={class:"time"},ht={key:0,class:"order-info-card"},gt={class:"order-info-header"},bt={class:"amount-text"},yt={class:"share-members-config"},wt={class:"percentage-summary"},St={key:0,class:"error-text"},kt={key:0,class:"share-detail"},Mt={class:"share-details-section"},Ct={class:"share-members-grid"},xt={class:"member-header"},It={class:"member-avatar"},Vt={class:"member-info"},Ut={class:"member-name"},Dt={class:"share-amount-section"},Nt={class:"percentage-display"},Rt={class:"percentage-circle"},Tt={class:"percentage-text"},Ot={class:"amount-display"},Lt={class:"amount-value"},$t={class:"member-footer"},Pt={key:0,class:"confirm-time"},zt={key:0,style:{"margin-top":"15px"}},At=ua({__name:"Share",setup(ue){const w=Ua(),C=Da(),q=Na(),A=m(!1),Y=m(!1),K=m(!1),D=m(!1),x=m(!1),T=m(!1),O=m(1),W=m(20),ce=m(0),E=m(""),F=m(null),B=m(""),X=m(!1),pe=m("csv"),J=m(null),se=m(!1),Z=m(),c=m({orderId:"",shareMembers:[{userId:"",percentage:50},{userId:"",percentage:50}],description:""}),xe={orderId:[{required:!0,message:"请选择订单",trigger:"change"}],shareMembers:[{required:!0,message:"请配置分享成员",trigger:"change"}]},S=m([]),oe=m([]),f=m(null),M=m(null),Q=m(""),re=le(()=>w.performanceShares),ee=le(()=>w.shareStats),Ie=le(()=>{let t=re.value;if(E.value&&(t=t.filter(e=>e.status===E.value)),F.value&&F.value.length===2){const[e,d]=F.value;t=t.filter(r=>{const p=r.createTime.split(" ")[0];return p>=e&&p<=d})}if(X.value&&B.value.trim()){const e=B.value.trim().toLowerCase();t=t.filter(d=>d.orderNumber.toLowerCase().includes(e))}return t}),ae=le(()=>c.value.shareMembers.reduce((t,e)=>t+(e.percentage||0),0)),N=()=>z(this,null,function*(){var t;A.value=!0;try{const e={page:O.value,limit:W.value,status:E.value||void 0,userId:(t=C.currentUser)==null?void 0:t.id},d=yield w.loadPerformanceShares(e);ce.value=d.total,d.shares.length}catch(e){console.error("加载分享记录失败:",e),k.error("加载分享记录失败")}finally{A.value=!1}}),Ve=t=>z(this,null,function*(){if(!t||t.trim().length===0){S.value=[],f.value=null,c.value.orderId="";return}T.value=!0;try{q.orders.length===0&&(yield q.initializeWithMockData()),yield new Promise(p=>setTimeout(p,200));const d=q.searchOrders(t).filter(p=>!re.value.some(v=>v.orderId===p.id)),r=d.find(p=>p.orderNumber.toLowerCase()===t.toLowerCase().trim());if(r){f.value=r,c.value.orderId=r.id,S.value=[r];return}S.value=d.slice(0,10),S.value.length===1&&(f.value=S.value[0],c.value.orderId=S.value[0].id)}catch(e){console.error("搜索订单失败:",e),k.error("搜索订单失败，请重试")}finally{T.value=!1}}),Ue=()=>{Q.value="",S.value=[],c.value.orderId="",f.value=null},De=t=>{f.value=S.value.find(e=>e.id===t)},Ne=t=>{const e=c.value.shareMembers[t],d=oe.value.find(r=>r.id===e.userId);d&&(e.userName=d.name)},Re=(t,e)=>c.value.shareMembers.some((d,r)=>r!==e&&d.userId===t),Te=()=>{c.value.shareMembers.length<5&&c.value.shareMembers.push({userId:"",percentage:0})},Oe=t=>{c.value.shareMembers.splice(t,1)},Le=()=>{},$e=()=>z(this,null,function*(){var t,e,d,r;if(Z.value)try{if(yield Z.value.validate(),ae.value!==100){k.error("分享比例总和必须为100%");return}x.value=!0;const p={orderId:c.value.orderId,orderNumber:((t=f.value)==null?void 0:t.orderNumber)||"",orderAmount:((e=f.value)==null?void 0:e.totalAmount)||0,shareMembers:c.value.shareMembers.map(v=>{var I;return{userId:v.userId,userName:((I=oe.value.find(L=>L.id===v.userId))==null?void 0:I.name)||"",percentage:v.percentage,shareAmount:0,status:"pending"}}),createdBy:((d=C.currentUser)==null?void 0:d.name)||"",createdById:((r=C.currentUser)==null?void 0:r.id)||"",description:c.value.description};if(D.value){const v=re.value.find(I=>I.id===c.value.orderId);v&&(yield w.updatePerformanceShare(v.id,p),k.success("分享更新成功"),yield N(),yield w.syncPerformanceData())}else{const v=yield w.createPerformanceShare(p);k.success("分享创建成功"),yield Pe(v),yield N(),yield w.syncPerformanceData()}ve(),yield N()}catch(p){console.error("提交分享失败:",p),k.error("提交分享失败")}finally{x.value=!1}}),Pe=t=>z(this,null,function*(){var e;for(const d of t.shareMembers)d.userId!==((e=C.currentUser)==null?void 0:e.id)&&(yield notificationStore.addMessage({type:"PERFORMANCE_SHARE",title:"业绩分享通知",content:`您收到了来自${t.createdBy}的业绩分享，订单${t.orderNumber}，分享比例${d.percentage}%`,priority:"normal",relatedId:t.id,relatedType:"performance_share"}))}),ve=()=>{var t;Y.value=!1,D.value=!1,c.value={orderId:"",shareMembers:[{userId:"",percentage:50},{userId:"",percentage:50}],description:""},f.value=null,(t=Z.value)==null||t.resetFields()},ze=t=>{M.value=t,K.value=!0},Ae=t=>{D.value=!0,c.value={orderId:t.orderId,shareMembers:[...t.shareMembers],description:t.description},f.value=S.value.find(e=>e.id===t.orderId),Y.value=!0},Ye=t=>z(this,null,function*(){try{yield Ce.confirm("确定要取消这个业绩分享吗？","确认取消",{type:"warning"}),(yield w.cancelPerformanceShare(t.id))?(k.success("业绩分享已取消"),yield N(),yield w.syncPerformanceData()):k.error("取消失败，请重试")}catch(e){console.error("取消分享失败:",e),k.error("取消失败")}}),Be=t=>C.isAdmin&&t.status==="active",je=t=>C.isAdmin&&t.status==="active",Ee=t=>{window.open(`/order/detail/${t}`,"_blank")},Fe=()=>z(this,null,function*(){try{se.value=!0;const{value:t}=yield Ce.prompt("请选择导出格式和日期范围","导出业绩分享记录",{confirmButtonText:"导出",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"可选：输入日期范围 (格式: 2024-01-01 至 2024-12-31)",showInput:!1,message:j("div",[j("div",{style:"margin-bottom: 10px"},"导出格式:"),j("el-radio-group",{modelValue:"csv","onUpdate:modelValue":r=>{pe.value=r}},[j("el-radio",{label:"csv"},"CSV格式"),j("el-radio",{label:"json"},"JSON格式")]),j("div",{style:"margin: 15px 0 10px 0"},"日期范围:"),j("el-date-picker",{modelValue:J.value,"onUpdate:modelValue":r=>{J.value=r},type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:"width: 100%"})])}),e={format:pe.value};J.value&&J.value.length===2&&(e.startDate=J.value[0],e.endDate=J.value[1]),k.loading("正在导出数据...");const d=yield Ra(e);if(e.format==="csv"){const r=new Blob([d.data],{type:"text/csv;charset=utf-8"}),p=window.URL.createObjectURL(r),v=document.createElement("a");v.href=p,v.download=`业绩分享记录_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(p)}else{const r=JSON.stringify(d.data.data,null,2),p=new Blob([r],{type:"application/json;charset=utf-8"}),v=window.URL.createObjectURL(p),I=document.createElement("a");I.href=v,I.download=`业绩分享记录_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),window.URL.revokeObjectURL(v)}k.success("导出成功！")}catch(t){t!=="cancel"&&(console.error("导出失败:",t),k.error("导出失败，请重试"))}finally{se.value=!1}}),me=t=>({active:"success",completed:"info",cancelled:"danger"})[t]||"info",fe=t=>({active:"生效中",completed:"已完成",cancelled:"已取消"})[t]||t,Je=t=>({pending:"warning",confirmed:"primary",shipped:"info",delivered:"success",cancelled:"danger"})[t]||"info",qe=t=>({pending:"待确认",confirmed:"已确认",shipped:"已发货",delivered:"已送达",cancelled:"已取消"})[t]||t,Ke=({row:t,rowIndex:e})=>`table-row-${e%2===0?"even":"odd"}`,Qe=t=>{k.info(`点击了分享记录: ${t.shareNumber}`)},Ge=t=>({pending:"warning",approved:"success",rejected:"danger"})[t]||"info",He=t=>({sales_staff:"销售员",sales_manager:"销售经理",department_manager:"部门经理",admin:"管理员",customer_service:"客服"})[t]||t,We=t=>({pending:"待审核",approved:"已通过",rejected:"已拒绝"})[t]||t,Xe=t=>{O.value=t,N()},_e=()=>{B.value.trim()?(X.value=!0,O.value=1):k.warning("请输入订单号")},he=()=>{B.value="",X.value=!1,O.value=1},te=m(null),Ze=()=>{te.value=setInterval(()=>z(this,null,function*(){yield N(),yield w.syncPerformanceData()}),3e4)},ea=()=>{te.value&&(clearInterval(te.value),te.value=null)};ye(()=>w.performanceShares,()=>{ha(()=>{w.syncPerformanceData()})},{deep:!0}),ca(()=>{N(),Ze()}),pa(()=>{ea()});const aa=t=>{W.value=t,O.value=1,N()};return ye([E,F],()=>{O.value=1,N()}),(t,e)=>{const d=_("el-button"),r=_("el-icon"),p=_("el-card"),v=_("el-col"),I=_("el-row"),L=_("el-option"),ne=_("el-select"),ta=_("el-date-picker"),de=_("el-input"),$=_("el-table-column"),la=_("el-link"),P=_("el-tag"),sa=_("el-table"),oa=_("el-pagination"),ra=_("el-tooltip"),ie=_("el-form-item"),V=_("el-descriptions-item"),ge=_("el-descriptions"),na=_("el-input-number"),da=_("el-form"),be=_("el-dialog"),ia=va("loading");return u(),g("div",{class:_a(["performance-share",{"page-loaded":!A.value}])},[o("div",Oa,[e[14]||(e[14]=o("h2",null,"业绩分享",-1)),o("div",La,[a(d,{onClick:e[0]||(e[0]=s=>Y.value=!0),type:"primary",icon:h(we),class:"action-btn-primary",loading:x.value},{default:l(()=>[...e[12]||(e[12]=[i(" 新建分享 ",-1)])]),_:1},8,["icon","loading"]),a(d,{onClick:Fe,icon:h(ga),class:"action-btn-secondary",loading:se.value},{default:l(()=>[...e[13]||(e[13]=[i(" 导出记录 ",-1)])]),_:1},8,["icon","loading"])])]),o("div",$a,[a(I,{gutter:20},{default:l(()=>[a(v,{span:6},{default:l(()=>[a(p,{class:"overview-card"},{default:l(()=>[o("div",Pa,[o("div",za,[a(r,null,{default:l(()=>[a(h(ba))]),_:1})]),o("div",Aa,[o("div",Ya,n(ee.value.totalShares),1),e[15]||(e[15]=o("div",{class:"card-label"},"总分享次数",-1))])])]),_:1})]),_:1}),a(v,{span:6},{default:l(()=>[a(p,{class:"overview-card"},{default:l(()=>[o("div",Ba,[o("div",ja,[a(r,null,{default:l(()=>[a(h(ya))]),_:1})]),o("div",Ea,[o("div",Fa,"¥"+n(ee.value.totalAmount.toLocaleString()),1),e[16]||(e[16]=o("div",{class:"card-label"},"分享总金额",-1))])])]),_:1})]),_:1}),a(v,{span:6},{default:l(()=>[a(p,{class:"overview-card"},{default:l(()=>[o("div",Ja,[o("div",qa,[a(r,null,{default:l(()=>[a(h(Se))]),_:1})]),o("div",Ka,[o("div",Qa,n(ee.value.involvedMembers),1),e[17]||(e[17]=o("div",{class:"card-label"},"参与成员",-1))])])]),_:1})]),_:1}),a(v,{span:6},{default:l(()=>[a(p,{class:"overview-card"},{default:l(()=>[o("div",Ga,[o("div",Ha,[a(r,null,{default:l(()=>[a(h(wa))]),_:1})]),o("div",Wa,[o("div",Xa,n(ee.value.sharedOrders),1),e[18]||(e[18]=o("div",{class:"card-label"},"分享订单数",-1))])])]),_:1})]),_:1})]),_:1})]),a(p,{class:"share-records"},{header:l(()=>[o("div",Za,[e[21]||(e[21]=o("span",null,"分享记录",-1)),o("div",et,[a(ne,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=s=>E.value=s),placeholder:"状态筛选",clearable:"",style:{width:"120px"}},{default:l(()=>[a(L,{label:"全部",value:""}),a(L,{label:"生效中",value:"active"}),a(L,{label:"已完成",value:"completed"}),a(L,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"]),a(ta,{modelValue:F.value,"onUpdate:modelValue":e[2]||(e[2]=s=>F.value=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px","margin-left":"10px"}},null,8,["modelValue"]),o("div",at,[a(de,{modelValue:B.value,"onUpdate:modelValue":e[3]||(e[3]=s=>B.value=s),placeholder:"搜索订单号",clearable:"",style:{width:"180px"},onKeyup:fa(_e,["enter"]),onClear:he},{prefix:l(()=>[a(r,null,{default:l(()=>[a(h(ke))]),_:1})]),_:1},8,["modelValue"]),a(d,{type:"primary",onClick:_e,disabled:!B.value.trim(),class:"search-btn"},{default:l(()=>[...e[19]||(e[19]=[i(" 搜索 ",-1)])]),_:1},8,["disabled"]),X.value?(u(),R(d,{key:0,onClick:he,class:"clear-btn"},{default:l(()=>[...e[20]||(e[20]=[i(" 清除 ",-1)])]),_:1})):U("",!0)])])])]),default:l(()=>[ma((u(),R(sa,{data:Ie.value,class:"share-table","row-class-name":Ke,onRowClick:Qe},{default:l(()=>[a($,{prop:"shareNumber",label:"分享编号",width:"140"}),a($,{prop:"orderNumber",label:"订单编号",width:"140"},{default:l(({row:s})=>[a(la,{type:"primary",onClick:b=>Ee(s.orderId)},{default:l(()=>[i(n(s.orderNumber),1)]),_:2},1032,["onClick"])]),_:1}),a($,{prop:"orderAmount",label:"订单金额",width:"120"},{default:l(({row:s})=>[i(" ¥"+n(s.orderAmount.toLocaleString()),1)]),_:1}),a($,{label:"分享成员",width:"200"},{default:l(({row:s})=>[o("div",tt,[(u(!0),g(G,null,H(s.shareMembers,b=>{var y;return u(),R(P,{key:b.userId,size:"small",type:b.userId===((y=h(C).currentUser)==null?void 0:y.id)?"success":"info",style:{"margin-right":"5px"}},{default:l(()=>[i(n(b.userName)+" ("+n(b.percentage)+"%) ",1)]),_:2},1032,["type"])}),128))])]),_:1}),a($,{prop:"createTime",label:"创建时间",width:"160"}),a($,{prop:"status",label:"状态",width:"100"},{default:l(({row:s})=>[a(P,{type:me(s.status)},{default:l(()=>[i(n(fe(s.status)),1)]),_:2},1032,["type"])]),_:1}),a($,{prop:"createdBy",label:"创建人",width:"100"}),a($,{label:"操作",width:"150",fixed:"right"},{default:l(({row:s})=>[o("div",lt,[a(d,{type:"info",size:"small",plain:"",onClick:b=>ze(s),class:"action-btn view-btn"},{default:l(()=>[a(r,null,{default:l(()=>[a(h(Sa))]),_:1}),e[22]||(e[22]=i(" 详情 ",-1))]),_:1},8,["onClick"]),s.status==="active"&&Be(s)?(u(),R(d,{key:0,type:"primary",size:"small",plain:"",onClick:b=>Ae(s),class:"action-btn edit-btn"},{default:l(()=>[a(r,null,{default:l(()=>[a(h(ka))]),_:1}),e[23]||(e[23]=i(" 编辑 ",-1))]),_:1},8,["onClick"])):U("",!0),s.status==="active"&&je(s)?(u(),R(d,{key:1,type:"danger",size:"small",plain:"",onClick:b=>Ye(s),class:"action-btn cancel-btn"},{default:l(()=>[a(r,null,{default:l(()=>[a(h(Ma))]),_:1}),e[24]||(e[24]=i(" 取消 ",-1))]),_:1},8,["onClick"])):U("",!0)])]),_:1})]),_:1},8,["data"])),[[ia,A.value]]),o("div",st,[a(oa,{"current-page":O.value,"onUpdate:currentPage":e[4]||(e[4]=s=>O.value=s),"page-size":W.value,"onUpdate:pageSize":e[5]||(e[5]=s=>W.value=s),"page-sizes":[10,20,50,100],total:ce.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:aa,onCurrentChange:Xe},null,8,["current-page","page-size","total"])])]),_:1}),a(be,{modelValue:Y.value,"onUpdate:modelValue":e[10]||(e[10]=s=>Y.value=s),title:D.value?"编辑分享":"新建分享",width:"800px","close-on-click-modal":!1},{footer:l(()=>[a(d,{onClick:ve},{default:l(()=>[...e[29]||(e[29]=[i("取消",-1)])]),_:1}),a(d,{type:"primary",onClick:$e,loading:x.value,disabled:ae.value!==100},{default:l(()=>[i(n(D.value?"更新":"确认分享"),1)]),_:1},8,["loading","disabled"])]),default:l(()=>[a(da,{ref_key:"shareFormRef",ref:Z,model:c.value,rules:xe,"label-width":"100px"},{default:l(()=>[a(ie,{label:"订单搜索",prop:"orderId"},{default:l(()=>[o("div",ot,[a(de,{modelValue:Q.value,"onUpdate:modelValue":e[6]||(e[6]=s=>Q.value=s),placeholder:"请输入完整订单号（如：ORD20250101001）或客户信息进行搜索",clearable:"",onInput:e[7]||(e[7]=s=>Ve(Q.value)),onClear:Ue,style:{"margin-bottom":"10px"},loading:T.value},{prefix:l(()=>[a(r,null,{default:l(()=>[a(h(ke))]),_:1})]),suffix:l(()=>[a(ra,{content:"支持订单号、客户名称、客户电话搜索",placement:"top"},{default:l(()=>[a(r,null,{default:l(()=>[a(h(Ca))]),_:1})]),_:1})]),_:1},8,["modelValue","loading"]),Q.value&&!T.value?(u(),g("div",rt,[S.value.length===0?(u(),g("span",nt,[a(r,null,{default:l(()=>[a(h(xa))]),_:1}),e[25]||(e[25]=i(" 未找到匹配的订单，请检查订单号是否正确 ",-1))])):f.value?(u(),g("span",dt,[a(r,null,{default:l(()=>[a(h(Ia))]),_:1}),i(" 已找到订单："+n(f.value.orderNumber),1)])):S.value.length>1?(u(),g("span",it,[a(r,null,{default:l(()=>[a(h(Me))]),_:1}),i(" 找到 "+n(S.value.length)+" 个匹配订单，请从下方选择 ",1)])):U("",!0)])):U("",!0),S.value.length>1&&!f.value?(u(),R(ne,{key:1,modelValue:c.value.orderId,"onUpdate:modelValue":e[8]||(e[8]=s=>c.value.orderId=s),placeholder:"从搜索结果中选择订单",style:{width:"100%","margin-top":"10px"},onChange:De},{default:l(()=>[(u(!0),g(G,null,H(S.value,s=>(u(),R(L,{key:s.id,label:`${s.orderNumber} - ¥${s.totalAmount.toLocaleString()} - ${s.customerName}`,value:s.id},{default:l(()=>[o("div",ut,[o("div",ct,[a(P,{type:"primary",size:"small"},{default:l(()=>[i(n(s.orderNumber),1)]),_:2},1024),o("span",pt,n(s.customerName),1),o("span",vt,"¥"+n(s.totalAmount.toLocaleString()),1)]),o("div",mt,[o("span",ft,n(s.customerPhone),1),o("span",_t,n(s.createTime),1)])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])):U("",!0)])]),_:1}),f.value?(u(),g("div",ht,[o("div",gt,[a(r,{class:"info-icon"},{default:l(()=>[a(h(Me))]),_:1}),e[26]||(e[26]=o("span",{class:"info-title"},"订单详情",-1))]),a(ge,{column:2,border:"",size:"small"},{default:l(()=>[a(V,{label:"订单编号"},{default:l(()=>[a(P,{type:"primary"},{default:l(()=>[i(n(f.value.orderNumber),1)]),_:1})]),_:1}),a(V,{label:"客户名称"},{default:l(()=>[i(n(f.value.customerName),1)]),_:1}),a(V,{label:"订单金额"},{default:l(()=>[o("span",bt,"¥"+n(f.value.totalAmount.toLocaleString()),1)]),_:1}),a(V,{label:"创建时间"},{default:l(()=>[i(n(f.value.createTime),1)]),_:1}),a(V,{label:"订单状态"},{default:l(()=>[a(P,{type:Je(f.value.status)},{default:l(()=>[i(n(qe(f.value.status)),1)]),_:1},8,["type"])]),_:1}),a(V,{label:"审核状态"},{default:l(()=>[a(P,{type:Ge(f.value.auditStatus)},{default:l(()=>[i(n(We(f.value.auditStatus)),1)]),_:1},8,["type"])]),_:1})]),_:1})])):U("",!0),a(ie,{label:"分享成员",prop:"shareMembers"},{default:l(()=>[o("div",yt,[(u(!0),g(G,null,H(c.value.shareMembers,(s,b)=>(u(),g("div",{key:b,class:"member-item"},[a(ne,{modelValue:s.userId,"onUpdate:modelValue":y=>s.userId=y,placeholder:"选择成员",style:{width:"200px"},onChange:y=>Ne(b)},{default:l(()=>[(u(!0),g(G,null,H(oe.value,y=>(u(),R(L,{key:y.id,label:`${y.name} (${y.department||"未知部门"} - ${He(y.role)})`,value:y.id,disabled:Re(y.id,b)},null,8,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),a(na,{modelValue:s.percentage,"onUpdate:modelValue":y=>s.percentage=y,min:1,max:100,precision:1,style:{width:"120px","margin-left":"10px"},onChange:Le},null,8,["modelValue","onUpdate:modelValue"]),e[27]||(e[27]=o("span",{style:{"margin-left":"5px"}},"%",-1)),c.value.shareMembers.length>1?(u(),R(d,{key:0,type:"danger",size:"small",icon:h(Va),circle:"",style:{"margin-left":"10px"},onClick:y=>Oe(b)},null,8,["icon","onClick"])):U("",!0)]))),128)),a(d,{type:"primary",size:"small",icon:h(we),onClick:Te,disabled:c.value.shareMembers.length>=5},{default:l(()=>[...e[28]||(e[28]=[i(" 添加成员 ",-1)])]),_:1},8,["icon","disabled"]),o("div",wt,[i(" 总比例: "+n(ae.value)+"% ",1),ae.value!==100?(u(),g("span",St," (比例总和必须为100%) ")):U("",!0)])])]),_:1}),a(ie,{label:"分享说明",prop:"description"},{default:l(()=>[a(de,{modelValue:c.value.description,"onUpdate:modelValue":e[9]||(e[9]=s=>c.value.description=s),type:"textarea",rows:3,placeholder:"请输入分享说明（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(be,{modelValue:K.value,"onUpdate:modelValue":e[11]||(e[11]=s=>K.value=s),title:"分享详情",width:"600px"},{default:l(()=>[M.value?(u(),g("div",kt,[a(ge,{column:1,border:""},{default:l(()=>[a(V,{label:"分享编号"},{default:l(()=>[i(n(M.value.shareNumber),1)]),_:1}),a(V,{label:"订单编号"},{default:l(()=>[i(n(M.value.orderNumber),1)]),_:1}),a(V,{label:"订单金额"},{default:l(()=>[i("¥"+n(M.value.orderAmount.toLocaleString()),1)]),_:1}),a(V,{label:"创建时间"},{default:l(()=>[i(n(M.value.createTime),1)]),_:1}),a(V,{label:"创建人"},{default:l(()=>[i(n(M.value.createdBy),1)]),_:1}),a(V,{label:"状态"},{default:l(()=>[a(P,{type:me(M.value.status)},{default:l(()=>[i(n(fe(M.value.status)),1)]),_:1},8,["type"])]),_:1})]),_:1}),o("div",Mt,[e[31]||(e[31]=o("h4",{class:"section-title"},"分享明细",-1)),o("div",Ct,[(u(!0),g(G,null,H(M.value.shareMembers,(s,b)=>(u(),g("div",{key:b,class:"member-share-card"},[o("div",xt,[o("div",It,[a(r,null,{default:l(()=>[a(h(Se))]),_:1})]),o("div",Vt,[o("div",Ut,n(s.userName),1),a(P,{type:s.status==="confirmed"?"success":"warning",size:"small",class:"member-status"},{default:l(()=>[i(n(s.status==="confirmed"?"已确认":"待确认"),1)]),_:2},1032,["type"])])]),o("div",Dt,[o("div",Nt,[o("div",Rt,[o("span",Tt,n(s.percentage)+"%",1)])]),o("div",Ot,[e[30]||(e[30]=o("div",{class:"amount-label"},"分享金额",-1)),o("div",Lt," ¥"+n((M.value.orderAmount*s.percentage/100).toLocaleString()),1)])]),o("div",$t,[s.confirmTime?(u(),g("div",Pt," 确认时间："+n(s.confirmTime),1)):U("",!0)])]))),128))])]),M.value.description?(u(),g("div",zt,[e[32]||(e[32]=o("h4",null,"分享说明",-1)),o("p",null,n(M.value.description),1)])):U("",!0)])):U("",!0)]),_:1},8,["modelValue"])],2)}}}),Jt=Ta(At,[["__scopeId","data-v-e7803591"]]);export{Jt as default};
