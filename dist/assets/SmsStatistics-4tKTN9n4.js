var T=(L,x,r)=>new Promise((C,M)=>{var S=c=>{try{g(r.next(c))}catch(y){M(y)}},D=c=>{try{g(r.throw(c))}catch(y){M(y)}},g=c=>c.done?C(c.value):Promise.resolve(c.value).then(S,D);g((r=r.apply(L,x)).next())});import{r as ct,n as ut,m as mt,t as _t,q as pt,al as vt,E as V}from"./elementPlus-Bmwh7Rh8.js";import{i as O}from"./utils-ywHRn0uI.js";import{_ as ft}from"./settings-CuxbDWOu.js";import{l as ht,r as f,Z as P,c as gt,n as X,Y as yt,ag as i,aq as St,m as $,p as j,q as e,P as bt,U as s,O as a,S as h,u as w,T as u}from"./vendor-D8Vxqhr-.js";const wt={class:"sms-statistics"},xt={class:"filter-section"},Ct={class:"stats-cards"},Mt={class:"stats-card"},Dt={class:"stats-icon success"},Ut={class:"stats-content"},kt={class:"stats-number"},Rt={class:"stats-card"},zt={class:"stats-icon warning"},Tt={class:"stats-content"},Vt={class:"stats-number"},Ot={class:"stats-card"},Et={class:"stats-icon danger"},Yt={class:"stats-content"},qt={class:"stats-number"},Lt={class:"stats-card"},At={class:"stats-icon info"},Nt={class:"stats-content"},Bt={class:"stats-number"},Ft={class:"charts-section"},It={class:"chart-card"},Pt={class:"chart-header"},Xt={class:"chart-content"},$t={class:"chart-card"},jt={class:"chart-content"},Wt={class:"chart-card"},Zt={class:"chart-content"},Gt={class:"chart-card"},Ht={class:"chart-content"},Jt={class:"table-section"},Kt={class:"cost-text"},Qt={class:"realtime-section"},te={class:"section-header"},ee={class:"realtime-stats"},se={class:"realtime-item"},ae={class:"realtime-value"},le={class:"realtime-item"},oe={class:"realtime-value"},ne={class:"realtime-item"},ie={class:"realtime-value"},de={class:"realtime-item"},re={class:"realtime-value"},ce=ht({__name:"SmsStatistics",setup(L){const x=f(!1),r=f([]),C=f("daily"),M=f(!1),S=f(null),D=f(),g=f(),c=f(),y=f();let m=null,_=null,p=null,v=null;const o=P({totalSent:0,successRate:0,totalCost:0,monthlyUsage:0,dailyUsage:0,templateUsage:[],trendData:[]}),d=P({todaySent:0,onlineUsers:0,queueCount:0,systemStatus:"normal"}),E=()=>T(this,null,function*(){x.value=!0;try{const l=yield(void 0)(r.value);Object.assign(o,l),yield X(),et()}catch(l){V.error("加载统计数据失败")}finally{x.value=!1}}),W=()=>T(this,null,function*(){try{const l=yield(void 0)(r.value.length>0?r.value:["2024-01-01","2024-01-31"],C.value);o.trendData=l,N()}catch(l){V.error("加载趋势数据失败")}}),Z=()=>{E()},G=()=>{V.info("导出功能开发中...")},H=l=>{const t=o.templateUsage.reduce((U,R)=>U+R.count,0);return t>0?(l/t*100).toFixed(1):"0.0"},J=l=>{V.info(`查看模板 "${l.templateName}" 的详细信息`)},K=l=>{l?Q():A()},Q=()=>{S.value=window.setInterval(()=>{d.todaySent+=Math.floor(Math.random()*5),d.onlineUsers=Math.floor(Math.random()*50)+10,d.queueCount=Math.floor(Math.random()*20),d.systemStatus=Math.random()>.1?"normal":"error"},3e3)},A=()=>{S.value&&(clearInterval(S.value),S.value=null)},tt=()=>{D.value&&(m=O(D.value)),g.value&&(_=O(g.value)),c.value&&(p=O(c.value)),y.value&&(v=O(y.value))},et=()=>{N(),st(),at(),lt()},N=()=>{if(!m)return;const l={title:{text:"发送量趋势",textStyle:{fontSize:14}},tooltip:{trigger:"axis"},xAxis:{type:"category",data:o.trendData.map(t=>t.date)},yAxis:{type:"value"},series:[{name:"发送量",type:"line",data:o.trendData.map(t=>t.count),smooth:!0,itemStyle:{color:"#409EFF"}}]};m.setOption(l)},st=()=>{if(!_)return;const l={title:{text:"模板使用分布",textStyle:{fontSize:14}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:"使用次数",type:"pie",radius:"60%",data:o.templateUsage.map(t=>({name:t.templateName,value:t.count})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};_.setOption(l)},at=()=>{if(!p)return;const l=Math.floor(o.totalSent*o.successRate/100),t=o.totalSent-l,U={title:{text:"发送成功率",textStyle:{fontSize:14}},tooltip:{trigger:"item"},series:[{name:"发送结果",type:"pie",radius:["40%","70%"],data:[{name:"成功",value:l,itemStyle:{color:"#67C23A"}},{name:"失败",value:t,itemStyle:{color:"#F56C6C"}}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};p.setOption(U)},lt=()=>{if(!v)return;const l={title:{text:"费用趋势",textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter:"{b}<br/>{a}: ¥{c}"},xAxis:{type:"category",data:o.trendData.map(t=>t.date)},yAxis:{type:"value",axisLabel:{formatter:"¥{value}"}},series:[{name:"费用",type:"bar",data:o.trendData.map(t=>t.cost),itemStyle:{color:"#E6A23C"}}]};v.setOption(l)},B=()=>{m==null||m.resize(),_==null||_.resize(),p==null||p.resize(),v==null||v.resize()};return gt(()=>T(this,null,function*(){const l=new Date,t=new Date(l.getTime()-7*24*60*60*1e3);r.value=[t.toISOString().split("T")[0],l.toISOString().split("T")[0]],yield E(),yield X(),tt(),window.addEventListener("resize",B),d.todaySent=Math.floor(Math.random()*1e3)+500,d.onlineUsers=Math.floor(Math.random()*50)+10,d.queueCount=Math.floor(Math.random()*20)})),yt(()=>{A(),window.removeEventListener("resize",B),m==null||m.dispose(),_==null||_.dispose(),p==null||p.dispose(),v==null||v.dispose()}),(l,t)=>{const U=i("el-date-picker"),R=i("el-form-item"),b=i("el-icon"),Y=i("el-button"),ot=i("el-form"),q=i("el-radio-button"),nt=i("el-radio-group"),z=i("el-col"),F=i("el-row"),k=i("el-table-column"),I=i("el-tag"),it=i("el-table"),dt=i("el-switch"),rt=St("loading");return j(),$("div",wt,[t[23]||(t[23]=e("div",{class:"page-header"},[e("h2",null,"短信统计分析"),e("p",null,"查看短信使用情况和数据分析报告")],-1)),e("div",xt,[s(ot,{inline:""},{default:a(()=>[s(R,{label:"统计时间"},{default:a(()=>[s(U,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=n=>r.value=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:Z,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),s(R,null,{default:a(()=>[s(Y,{type:"primary",onClick:E},{default:a(()=>[s(b,null,{default:a(()=>[s(w(ct))]),_:1}),t[3]||(t[3]=h(" 刷新数据 ",-1))]),_:1}),s(Y,{onClick:G},{default:a(()=>[s(b,null,{default:a(()=>[s(w(ut))]),_:1}),t[4]||(t[4]=h(" 导出报告 ",-1))]),_:1})]),_:1})]),_:1})]),bt((j(),$("div",Ct,[e("div",Mt,[e("div",Dt,[s(b,null,{default:a(()=>[s(w(mt))]),_:1})]),e("div",Ut,[e("div",kt,u(o.totalSent.toLocaleString()),1),t[5]||(t[5]=e("div",{class:"stats-label"},"总发送量",-1))])]),e("div",Rt,[e("div",zt,[s(b,null,{default:a(()=>[s(w(_t))]),_:1})]),e("div",Tt,[e("div",Vt,u(o.successRate)+"%",1),t[6]||(t[6]=e("div",{class:"stats-label"},"成功率",-1))])]),e("div",Ot,[e("div",Et,[s(b,null,{default:a(()=>[s(w(pt))]),_:1})]),e("div",Yt,[e("div",qt,"¥"+u(o.totalCost.toLocaleString()),1),t[7]||(t[7]=e("div",{class:"stats-label"},"总费用",-1))])]),e("div",Lt,[e("div",At,[s(b,null,{default:a(()=>[s(w(vt))]),_:1})]),e("div",Nt,[e("div",Bt,u(o.dailyUsage.toLocaleString()),1),t[8]||(t[8]=e("div",{class:"stats-label"},"日均发送",-1))])])])),[[rt,x.value]]),e("div",Ft,[s(F,{gutter:20},{default:a(()=>[s(z,{span:12},{default:a(()=>[e("div",It,[e("div",Pt,[t[12]||(t[12]=e("h3",null,"发送趋势",-1)),s(nt,{modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=n=>C.value=n),onChange:W},{default:a(()=>[s(q,{label:"daily"},{default:a(()=>[...t[9]||(t[9]=[h("按天",-1)])]),_:1}),s(q,{label:"weekly"},{default:a(()=>[...t[10]||(t[10]=[h("按周",-1)])]),_:1}),s(q,{label:"monthly"},{default:a(()=>[...t[11]||(t[11]=[h("按月",-1)])]),_:1})]),_:1},8,["modelValue"])]),e("div",Xt,[e("div",{ref_key:"trendChartRef",ref:D,style:{width:"100%",height:"300px"}},null,512)])])]),_:1}),s(z,{span:12},{default:a(()=>[e("div",$t,[t[13]||(t[13]=e("div",{class:"chart-header"},[e("h3",null,"模板使用统计")],-1)),e("div",jt,[e("div",{ref_key:"templateChartRef",ref:g,style:{width:"100%",height:"300px"}},null,512)])])]),_:1})]),_:1}),s(F,{gutter:20,style:{"margin-top":"20px"}},{default:a(()=>[s(z,{span:12},{default:a(()=>[e("div",Wt,[t[14]||(t[14]=e("div",{class:"chart-header"},[e("h3",null,"成功率分析")],-1)),e("div",Zt,[e("div",{ref_key:"successChartRef",ref:c,style:{width:"100%",height:"300px"}},null,512)])])]),_:1}),s(z,{span:12},{default:a(()=>[e("div",Gt,[t[15]||(t[15]=e("div",{class:"chart-header"},[e("h3",null,"费用分析")],-1)),e("div",Ht,[e("div",{ref_key:"costChartRef",ref:y,style:{width:"100%",height:"300px"}},null,512)])])]),_:1})]),_:1})]),e("div",Jt,[t[17]||(t[17]=e("div",{class:"section-header"},[e("h3",null,"模板使用详情")],-1)),s(it,{data:o.templateUsage,border:"",stripe:""},{default:a(()=>[s(k,{prop:"templateName",label:"模板名称","min-width":"200"}),s(k,{prop:"count",label:"使用次数",width:"120",align:"center"},{default:a(({row:n})=>[s(I,{type:"primary"},{default:a(()=>[h(u(n.count.toLocaleString()),1)]),_:2},1024)]),_:1}),s(k,{label:"使用占比",width:"120",align:"center"},{default:a(({row:n})=>[e("span",null,u(H(n.count))+"%",1)]),_:1}),s(k,{label:"费用估算",width:"120",align:"center"},{default:a(({row:n})=>[e("span",Kt,"¥"+u((n.count*.05).toFixed(2)),1)]),_:1}),s(k,{label:"操作",width:"100",align:"center"},{default:a(({row:n})=>[s(Y,{type:"text",size:"small",onClick:ue=>J(n)},{default:a(()=>[...t[16]||(t[16]=[h(" 查看详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),e("div",Qt,[e("div",te,[t[18]||(t[18]=e("h3",null,"实时数据",-1)),s(dt,{modelValue:M.value,"onUpdate:modelValue":t[2]||(t[2]=n=>M.value=n),"active-text":"实时更新",onChange:K},null,8,["modelValue"])]),e("div",ee,[e("div",se,[t[19]||(t[19]=e("div",{class:"realtime-label"},"今日发送",-1)),e("div",ae,u(d.todaySent),1)]),e("div",le,[t[20]||(t[20]=e("div",{class:"realtime-label"},"当前在线",-1)),e("div",oe,u(d.onlineUsers),1)]),e("div",ne,[t[21]||(t[21]=e("div",{class:"realtime-label"},"队列待发",-1)),e("div",ie,u(d.queueCount),1)]),e("div",de,[t[22]||(t[22]=e("div",{class:"realtime-label"},"系统状态",-1)),e("div",re,[s(I,{type:d.systemStatus==="normal"?"success":"danger"},{default:a(()=>[h(u(d.systemStatus==="normal"?"正常":"异常"),1)]),_:1},8,["type"])])])])])])}}}),he=ft(ce,[["__scopeId","data-v-0f1dea98"]]);export{he as default};
