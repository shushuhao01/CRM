var v=(b,_,n)=>new Promise((c,l)=>{var i=o=>{try{m(n.next(o))}catch(w){l(w)}},s=o=>{try{m(n.throw(o))}catch(w){l(w)}},m=o=>o.done?c(o.value):Promise.resolve(o.value).then(i,s);m((n=n.apply(b,_)).next())});import{l as x,az as y,r as C,Z as S,ag as f,m as E,p as N,q as g,U as a,O as u,S as U}from"./vendor-D8Vxqhr-.js";import{u as I,c as k,_ as z}from"./settings-CuxbDWOu.js";import{E as V}from"./elementPlus-Bmwh7Rh8.js";import"./utils-ywHRn0uI.js";const q={class:"change-password-container"},D={class:"change-password-box"},L=x({__name:"ChangePassword",setup(b){const _=y(),n=k(_),c=I(),l=C(!1),i=C(),s=S({currentPassword:"",newPassword:"",confirmPassword:""}),o={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,validator:(P,e,r)=>{e===""?r(new Error("请再次输入新密码")):e!==s.newPassword?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}]},w=()=>v(this,null,function*(){i.value&&(yield i.value.validate(P=>v(this,null,function*(){if(P){l.value=!0;try{const e=JSON.parse(localStorage.getItem("userDatabase")||"[]"),r=c.user;if(!r)throw new Error("用户信息不存在");const t=e.findIndex(h=>h.id===r.id);if(t===-1)throw new Error("用户不存在");const d=e[t];if(d.password!==s.currentPassword)throw new Error("当前密码错误");d.password=s.newPassword,d.needChangePassword=!1,d.passwordLastChanged=new Date().toISOString(),localStorage.setItem("userDatabase",JSON.stringify(e)),c.updateUser({forcePasswordChange:!1}),V.success("密码修改成功"),n.push("/")}catch(e){V.error(e.message||"密码修改失败")}finally{l.value=!1}}})))});return(P,e)=>{const r=f("el-input"),t=f("el-form-item"),d=f("el-button"),h=f("el-form");return N(),E("div",q,[g("div",D,[e[4]||(e[4]=g("div",{class:"change-password-header"},[g("h1",null,"修改密码"),g("p",null,"为了您的账户安全，请修改默认密码")],-1)),a(h,{model:s,rules:o,ref_key:"passwordFormRef",ref:i,class:"change-password-form"},{default:u(()=>[a(t,{label:"当前密码",prop:"currentPassword"},{default:u(()=>[a(r,{modelValue:s.currentPassword,"onUpdate:modelValue":e[0]||(e[0]=p=>s.currentPassword=p),type:"password",placeholder:"请输入当前密码",size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),a(t,{label:"新密码",prop:"newPassword"},{default:u(()=>[a(r,{modelValue:s.newPassword,"onUpdate:modelValue":e[1]||(e[1]=p=>s.newPassword=p),type:"password",placeholder:"请输入新密码",size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),a(t,{label:"确认新密码",prop:"confirmPassword"},{default:u(()=>[a(r,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=p=>s.confirmPassword=p),type:"password",placeholder:"请再次输入新密码",size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),a(t,null,{default:u(()=>[a(d,{type:"primary",size:"large",class:"change-password-button",loading:l.value,onClick:w},{default:u(()=>[...e[3]||(e[3]=[U(" 修改密码 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}}),M=z(L,[["__scopeId","data-v-73a37876"]]);export{M as default};
