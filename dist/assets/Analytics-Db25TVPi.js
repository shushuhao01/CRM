var ke=Object.defineProperty,Pe=Object.defineProperties;var De=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable;var ee=(h,r,i)=>r in h?ke(h,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[r]=i,U=(h,r)=>{for(var i in r||(r={}))Te.call(r,i)&&ee(h,i,r[i]);if(Z)for(var i of Z(r))We.call(r,i)&&ee(h,i,r[i]);return h},te=(h,r)=>Pe(h,De(r));var R=(h,r,i)=>new Promise((x,y)=>{var k=u=>{try{f(i.next(u))}catch(D){y(D)}},P=u=>{try{f(i.throw(u))}catch(D){y(D)}},f=u=>u.done?x(u.value):Promise.resolve(u.value).then(k,P);f((i=i.apply(h,r)).next())});import{au as ze,t as Fe,w as Ve,a1 as Ae,n as Le,r as Oe,a6 as Re,T as Ee,aF as Ie,s as Ne,E as W}from"./elementPlus-Bmwh7Rh8.js";import{i as E}from"./utils-ywHRn0uI.js";import{u as Ue,p as V}from"./product-DLyzXkG9.js";import{l as Be,r as p,e as I,w as ae,c as Me,ag as g,aq as qe,m as B,p as m,q as l,U as o,O as s,S as C,u as z,F as oe,a9 as se,M as S,I as $e,R as je,T as b,J as le,Q as M,P as Ge,n as A}from"./vendor-D8Vxqhr-.js";import{_ as Je}from"./settings-CuxbDWOu.js";const Ke={class:"product-analytics"},Qe={class:"page-header"},Xe={class:"header-actions"},He={class:"metrics-grid"},Ye={class:"metric-content"},Ze={class:"metric-info"},et={class:"metric-value"},tt={class:"metric-label"},at={class:"charts-section"},ot={class:"card-header"},st={class:"card-header"},lt={class:"header-actions"},nt={class:"pagination-wrapper"},rt=Be({__name:"Analytics",setup(h){const r=Ue(),i=p(!1),x=p([new Date(Date.now()-30*24*60*60*1e3),new Date]),y=p("30days"),k=p(""),P=p(""),f=p(1),u=p(20),D=p(0),w=p({salesStatistics:{totalRevenue:0,totalSales:0,totalProducts:0,lowStockWarning:0,revenueChange:"+0%",salesChange:"+0%",productsChange:"+0%",warningChange:"+0%"},salesTrend:{timeLabels:[],salesData:[],revenueData:[]},categorySales:[],topProducts:[],inventoryWarning:{lowStockCount:0,outOfStockCount:0,totalWarning:0,categories:[]}}),ne=I(()=>{const e=w.value.salesStatistics,t=n=>n>=1e8?(n/1e8).toFixed(1)+"亿":n>=1e4?(n/1e4).toFixed(1)+"万":n.toLocaleString();return[{key:"totalRevenue",label:"总销售额",value:`¥${t(e.totalRevenue)}`,change:e.revenueChange,trend:e.revenueChange.startsWith("+")?"up":e.revenueChange.startsWith("-")?"down":"stable",color:"#409EFF",icon:ze},{key:"totalSales",label:"总销量",value:t(e.totalSales),change:e.salesChange,trend:e.salesChange.startsWith("+")?"up":e.salesChange.startsWith("-")?"down":"stable",color:"#67C23A",icon:Fe},{key:"totalProducts",label:"商品总数",value:e.totalProducts.toString(),change:e.productsChange,trend:e.productsChange.startsWith("+")?"up":e.productsChange.startsWith("-")?"down":"stable",color:"#E6A23C",icon:Ve},{key:"lowStockWarning",label:"库存预警",value:e.lowStockWarning.toString(),change:e.warningChange,trend:e.warningChange.startsWith("+")?"up":e.warningChange.startsWith("-")?"down":"stable",color:"#F56C6C",icon:Ae}]}),re=I(()=>r.categories.map(e=>({label:e.name,value:e.name}))),ie=I(()=>r.products.map(e=>{const t=e.salesCount*e.price,n=e.salesCount*(e.price-e.costPrice),c=e.price>0?(e.price-e.costPrice)/e.price:0;return{id:e.id,name:e.name,category:e.categoryName,price:e.price,stock:e.stock,sales:e.salesCount,revenue:t,profit:n,profitRate:c}})),q=p(),$=p(),j=p(),G=p(),ce=I(()=>{let e=ie.value;k.value&&(e=e.filter(c=>c.name.toLowerCase().includes(k.value.toLowerCase()))),P.value&&(e=e.filter(c=>c.category===P.value)),D.value=e.length;const t=(f.value-1)*u.value,n=t+u.value;return e.slice(t,n)}),de=e=>{console.log("日期范围变更:",e),e&&e.length===2&&(F(),A(()=>{J()}))},ue=()=>{W.success("数据导出功能开发中...")},pe=()=>R(this,null,function*(){W.info("正在刷新数据...");try{yield r.fetchProducts(),yield F(),A(()=>{K()}),W.success("数据刷新成功")}catch(e){console.error("刷新数据失败:",e),W.error("数据刷新失败")}}),ge=()=>{f.value=1},he=({prop:e,order:t})=>{console.log("排序变更:",e,t)},ve=e=>{u.value=e,f.value=1},fe=e=>{f.value=e},me=e=>e<10?"danger":e<50?"warning":"success",ye=e=>e<10?"库存不足":e<50?"库存偏低":"库存充足",F=()=>R(this,null,function*(){i.value=!0;try{const[e,t]=x.value,n={startDate:e==null?void 0:e.toISOString().split("T")[0],endDate:t==null?void 0:t.toISOString().split("T")[0]},[c,d,v,T,L]=yield Promise.all([V.getSalesStatistics(n),V.getSalesTrend(te(U({},n),{period:y.value})),V.getCategorySales(n),V.getTopProducts(U({limit:5},n)),V.getInventoryWarning({})]);w.value={salesStatistics:c,salesTrend:d,categorySales:v,topProducts:T,inventoryWarning:L},W.success("数据已更新")}catch(e){console.error("加载分析数据失败:",e),W.error("加载数据失败")}finally{i.value=!1}}),_e=()=>R(this,null,function*(){r.products.length===0&&(yield r.fetchProducts()),yield F()}),J=()=>{N(),Q(),X(),H()},K=()=>{A(()=>{N(),Q(),X(),H()})},N=()=>{const e=E(q.value),{timeLabels:t,revenueData:n}=w.value.salesTrend,c={title:{text:`销售趋势 (${y.value==="7days"?"近7天":y.value==="30days"?"近30天":"近90天"})`,left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter:"{a} <br/>{b}: ¥{c}"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:t,boundaryGap:!1},yAxis:{type:"value",name:"销售额",axisLabel:{formatter:function(d){return d>=1e4?(d/1e4).toFixed(1)+"万":d}}},series:[{name:"销售额",data:n,type:"line",smooth:!0,itemStyle:{color:"#409EFF"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}]}}}]};e.setOption(c)},Q=()=>{const e=E($.value),t=w.value.categorySales.map(c=>({name:c.name,value:c.value})),n={title:{text:"分类销售占比",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: ¥{c} ({d}%)"},series:[{name:"销售额",type:"pie",radius:"60%",data:t,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};e.setOption(n)},X=()=>{const e=E(j.value),t=w.value.inventoryWarning.categories.map(d=>d.name),n=w.value.inventoryWarning.categories.map(d=>d.totalStock),c={title:{text:"库存状况",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter:"{a} <br/>{b}: {c} 件"},xAxis:{type:"category",data:t,axisLabel:{rotate:45,interval:0}},yAxis:{type:"value",name:"库存数量"},series:[{name:"库存",data:n,type:"bar",itemStyle:{color:"#67C23A",borderRadius:[4,4,0,0]},emphasis:{itemStyle:{color:"#85ce61"}}}]};e.setOption(c)},H=()=>{const e=E(G.value),t=w.value.topProducts,n=t.map(v=>v.name),c=t.map(v=>v.sales),d={title:{text:"热销商品TOP5",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter:"{a} <br/>{b}: {c} 件"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",name:"销量"},yAxis:{type:"category",data:n,axisLabel:{width:100,overflow:"truncate"}},series:[{name:"销量",data:c,type:"bar",itemStyle:{color:"#E6A23C",borderRadius:[0,4,4,0]},emphasis:{itemStyle:{color:"#eebe77"}},label:{show:!0,position:"right",formatter:"{c}"}}]};e.setOption(d)};return ae(y,()=>{F().then(()=>{A(()=>{N()})})}),ae(x,e=>{e&&e.length===2&&F().then(()=>{A(()=>{J()})})},{deep:!0}),Me(()=>{_e().then(()=>{K()})}),(e,t)=>{const n=g("el-date-picker"),c=g("el-button"),d=g("el-icon"),v=g("el-card"),T=g("el-option"),L=g("el-select"),O=g("el-col"),Y=g("el-row"),be=g("el-input"),_=g("el-table-column"),Ce=g("el-tag"),we=g("el-table"),Se=g("el-pagination"),xe=qe("loading");return m(),B("div",Ke,[l("div",Qe,[t[8]||(t[8]=l("h1",{class:"page-title"},"商品分析",-1)),l("div",Xe,[o(n,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=a=>x.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:de,style:{"margin-right":"12px"}},null,8,["modelValue"]),o(c,{type:"primary",icon:z(Le),onClick:ue},{default:s(()=>[...t[6]||(t[6]=[C(" 导出数据 ",-1)])]),_:1},8,["icon"]),o(c,{type:"success",icon:z(Oe),onClick:pe,style:{"margin-left":"12px"}},{default:s(()=>[...t[7]||(t[7]=[C(" 刷新 ",-1)])]),_:1},8,["icon"])])]),l("div",He,[(m(!0),B(oe,null,se(ne.value,a=>(m(),S(v,{key:a.key,class:"metric-card",shadow:"hover"},{default:s(()=>[l("div",Ye,[l("div",{class:"metric-icon",style:$e({backgroundColor:a.color})},[o(d,{size:24},{default:s(()=>[(m(),S(je(a.icon)))]),_:2},1024)],4),l("div",Ze,[l("div",et,b(a.value),1),l("div",tt,b(a.label),1),l("div",{class:le(["metric-change",a.trend])},[o(d,{size:12},{default:s(()=>[a.trend==="up"?(m(),S(z(Re),{key:0})):M("",!0),a.trend==="down"?(m(),S(z(Ee),{key:1})):M("",!0),a.trend==="stable"?(m(),S(z(Ie),{key:2})):M("",!0)]),_:2},1024),C(" "+b(a.change),1)],2)])])]),_:2},1024))),128))]),l("div",at,[o(Y,{gutter:20},{default:s(()=>[o(O,{span:12},{default:s(()=>[o(v,{class:"chart-card",shadow:"hover"},{header:s(()=>[l("div",ot,[t[9]||(t[9]=l("span",null,"销售趋势",-1)),o(L,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=a=>y.value=a),size:"small",style:{width:"120px"}},{default:s(()=>[o(T,{label:"近7天",value:"7days"}),o(T,{label:"近30天",value:"30days"}),o(T,{label:"近90天",value:"90days"})]),_:1},8,["modelValue"])])]),default:s(()=>[l("div",{ref_key:"salesTrendChart",ref:q,class:"chart-container"},null,512)]),_:1})]),_:1}),o(O,{span:12},{default:s(()=>[o(v,{class:"chart-card",shadow:"hover"},{header:s(()=>[...t[10]||(t[10]=[l("span",null,"商品分类销售占比",-1)])]),default:s(()=>[l("div",{ref_key:"categoryPieChart",ref:$,class:"chart-container"},null,512)]),_:1})]),_:1})]),_:1}),o(Y,{gutter:20,style:{"margin-top":"20px"}},{default:s(()=>[o(O,{span:12},{default:s(()=>[o(v,{class:"chart-card",shadow:"hover"},{header:s(()=>[...t[11]||(t[11]=[l("span",null,"库存预警",-1)])]),default:s(()=>[l("div",{ref_key:"inventoryChart",ref:j,class:"chart-container"},null,512)]),_:1})]),_:1}),o(O,{span:12},{default:s(()=>[o(v,{class:"chart-card",shadow:"hover"},{header:s(()=>[...t[12]||(t[12]=[l("span",null,"热销商品排行",-1)])]),default:s(()=>[l("div",{ref_key:"topProductsChart",ref:G,class:"chart-container"},null,512)]),_:1})]),_:1})]),_:1})]),o(v,{class:"table-card",shadow:"hover",style:{"margin-top":"20px"}},{header:s(()=>[l("div",st,[t[13]||(t[13]=l("span",null,"商品详细数据",-1)),l("div",lt,[o(be,{modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=a=>k.value=a),placeholder:"搜索商品名称",style:{width:"200px","margin-right":"12px"},clearable:"",onInput:ge},{prefix:s(()=>[o(d,null,{default:s(()=>[o(z(Ne))]),_:1})]),_:1},8,["modelValue"]),o(L,{modelValue:P.value,"onUpdate:modelValue":t[3]||(t[3]=a=>P.value=a),placeholder:"选择分类",style:{width:"150px"},clearable:""},{default:s(()=>[(m(!0),B(oe,null,se(re.value,a=>(m(),S(T,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),default:s(()=>[Ge((m(),S(we,{data:ce.value,stripe:"",style:{width:"100%"},onSortChange:he},{default:s(()=>[o(_,{prop:"name",label:"商品名称","min-width":"150"}),o(_,{prop:"category",label:"分类",width:"120"}),o(_,{prop:"price",label:"单价",width:"100",sortable:"custom"},{default:s(({row:a})=>[C(" ¥"+b(a.price.toFixed(2)),1)]),_:1}),o(_,{prop:"stock",label:"库存",width:"100",sortable:"custom"},{default:s(({row:a})=>[l("span",{class:le({"low-stock":a.stock<10})},b(a.stock),3)]),_:1}),o(_,{prop:"sales",label:"销量",width:"100",sortable:"custom"}),o(_,{prop:"revenue",label:"销售额",width:"120",sortable:"custom"},{default:s(({row:a})=>[C(" ¥"+b(a.revenue.toFixed(2)),1)]),_:1}),o(_,{prop:"profit",label:"利润",width:"120",sortable:"custom"},{default:s(({row:a})=>[C(" ¥"+b(a.profit.toFixed(2)),1)]),_:1}),o(_,{prop:"profitRate",label:"利润率",width:"100",sortable:"custom"},{default:s(({row:a})=>[C(b((a.profitRate*100).toFixed(1))+"% ",1)]),_:1}),o(_,{label:"状态",width:"100"},{default:s(({row:a})=>[o(Ce,{type:me(a.stock)},{default:s(()=>[C(b(ye(a.stock)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[xe,i.value]]),l("div",nt,[o(Se,{"current-page":f.value,"onUpdate:currentPage":t[4]||(t[4]=a=>f.value=a),"page-size":u.value,"onUpdate:pageSize":t[5]||(t[5]=a=>u.value=a),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ve,onCurrentChange:fe},null,8,["current-page","page-size","total"])])]),_:1})])}}}),ht=Je(rt,[["__scopeId","data-v-1a31da80"]]);export{ht as default};
