const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/uploadService-rJoD_mJD.js","assets/index-BGtT17ll.js","assets/vendor-BtukhyiH.js","assets/elementPlus-DxaqjplL.js","assets/utils-DfI7e5Rl.js","assets/index-Cj-RrGL6.css"])))=>i.map(i=>d[i]);
import{t as e,u as a,_ as l,b as r,d as t,j as o,l as u,c as d}from"./index-BGtT17ll.js";import{r as s,l as n,e as i,ag as c,M as m,q as p,O as v,p as f,U as g,a7 as h,u as y,S as b,m as _,T as w,aA as V,aC as k,Z as N,b as C,F as S,a9 as x,Q as T}from"./vendor-BtukhyiH.js";import{C as P,P as I,d as U,E as q,b as A,L as $,s as O,ac as B}from"./elementPlus-DxaqjplL.js";import{u as L}from"./service-CQY3-CML.js";import{m as j}from"./phone-CSnHMTQT.js";import{P as D}from"./phoneSync-DnGy6hcf.js";import"./utils-DfI7e5Rl.js";import"./env-DLalhsF6.js";const z=e("serviceType",()=>{const e=s([{id:"1",label:"退货",value:"return",enabled:!0,order:1,createdAt:(new Date).toISOString(),createdBy:"system"},{id:"2",label:"换货",value:"exchange",enabled:!0,order:2,createdAt:(new Date).toISOString(),createdBy:"system"},{id:"3",label:"维修",value:"repair",enabled:!0,order:3,createdAt:(new Date).toISOString(),createdBy:"system"},{id:"4",label:"投诉",value:"complaint",enabled:!0,order:4,createdAt:(new Date).toISOString(),createdBy:"system"},{id:"5",label:"咨询",value:"inquiry",enabled:!0,order:5,createdAt:(new Date).toISOString(),createdBy:"system"}]);return{serviceTypes:e,enabledServiceTypes:()=>e.value.filter(e=>e.enabled).sort((e,a)=>e.order-a.order),addServiceType:a=>{const l={...a,id:Date.now().toString(),createdAt:(new Date).toISOString()};return e.value.push(l),l},updateServiceType:(a,l)=>{const r=e.value.findIndex(e=>e.id===a);return-1!==r?(e.value[r]={...e.value[r],...l},e.value[r]):null},deleteServiceType:a=>{const l=e.value.findIndex(e=>e.id===a);return-1!==l&&(e.value.splice(l,1),!0)},toggleServiceType:a=>{const l=e.value.find(e=>e.id===a);return l?(l.enabled=!l.enabled,l):null},updateOrder:a=>{a.forEach((a,l)=>{const r=e.value.find(e=>e.id===a.id);r&&(r.order=l+1)})}}}),E={class:"service-type-config"},F={class:"add-section"},R={class:"type-list"},M={class:"sort-buttons"},K={key:1},J={class:"tip"},Q=l(n({__name:"ServiceTypeConfigDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const r=e,t=l,o=z(),u=a(),d=i({get:()=>r.modelValue,set:e=>t("update:modelValue",e)}),n=s(""),V=s(""),k=s(""),N=i(()=>[...o.serviceTypes].sort((e,a)=>e.order-a.order)),C=()=>{if(!n.value.trim())return void q.warning("请输入服务类型名称");if(o.serviceTypes.some(e=>e.label===n.value.trim()))return void q.warning("该服务类型已存在");const e=n.value.trim().toLowerCase().replace(/\s+/g,"_");o.addServiceType({label:n.value.trim(),value:e,enabled:!0,order:o.serviceTypes.length+1,createdBy:u.currentUser?.id||"system"}),q.success("添加成功"),n.value=""},S=e=>{if(!k.value.trim())return q.warning("服务类型名称不能为空"),k.value=e.label,void(V.value="");o.updateServiceType(e.id,{label:k.value.trim()}),V.value="",k.value="",q.success("修改成功")},x=()=>{d.value=!1};return(e,a)=>{const l=c("el-input"),r=c("el-button"),t=c("el-table-column"),u=c("el-switch"),s=c("el-table"),i=c("el-alert"),T=c("el-dialog");return p(),m(T,{modelValue:d.value,"onUpdate:modelValue":a[2]||(a[2]=e=>d.value=e),title:"服务类型配置",width:"600px","before-close":x},{footer:v(()=>[g(r,{onClick:x},{default:v(()=>[...a[7]||(a[7]=[b("关闭",-1)])]),_:1})]),default:v(()=>[f("div",E,[f("div",F,[g(l,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),placeholder:"输入新的服务类型名称",style:{width:"200px","margin-right":"10px"},onKeyup:h(C,["enter"])},null,8,["modelValue"]),g(r,{type:"primary",onClick:C,icon:y(P)},{default:v(()=>[...a[3]||(a[3]=[b(" 添加 ",-1)])]),_:1},8,["icon"])]),f("div",R,[g(s,{data:N.value,style:{width:"100%"}},{default:v(()=>[g(t,{label:"排序",width:"80"},{default:v(({$index:e})=>[f("div",M,[g(r,{size:"small",icon:y(I),disabled:0===e,onClick:a=>(e=>{if(0===e)return;const a=[...N.value];[a[e],a[e-1]]=[a[e-1],a[e]],o.updateOrder(a)})(e),link:""},null,8,["icon","disabled","onClick"]),g(r,{size:"small",icon:y(U),disabled:e===N.value.length-1,onClick:a=>(e=>{if(e===N.value.length-1)return;const a=[...N.value];[a[e],a[e+1]]=[a[e+1],a[e]],o.updateOrder(a)})(e),link:""},null,8,["icon","disabled","onClick"])])]),_:1}),g(t,{label:"类型名称",prop:"label"},{default:v(({row:e})=>[V.value===e.id?(p(),m(l,{key:0,modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=e=>k.value=e),size:"small",onBlur:a=>S(e),onKeyup:h(a=>S(e),["enter"])},null,8,["modelValue","onBlur","onKeyup"])):(p(),_("span",K,w(e.label),1))]),_:1}),g(t,{label:"状态",width:"100"},{default:v(({row:e})=>[g(u,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a,onChange:a=>(e=>{const a=e.enabled?"启用":"禁用";q.success(`已${a}`)})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),g(t,{label:"操作",width:"150"},{default:v(({row:e})=>[g(r,{size:"small",onClick:a=>(e=>{V.value=e.id,k.value=e.label})(e),link:""},{default:v(()=>[...a[4]||(a[4]=[b(" 编辑 ",-1)])]),_:1},8,["onClick"]),g(r,{size:"small",type:"danger",onClick:a=>(e=>{A.confirm("确定要删除这个服务类型吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.deleteServiceType(e.id),q.success("删除成功")})})(e),link:""},{default:v(()=>[...a[5]||(a[5]=[b(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),f("div",J,[g(i,{title:"提示",type:"info",closable:!1,"show-icon":""},{default:v(()=>[...a[6]||(a[6]=[f("p",null,"• 禁用的服务类型不会在下拉列表中显示",-1),f("p",null,"• 可以通过上下箭头调整显示顺序",-1),f("p",null,"• 配置后全局生效并自动保存",-1)])]),_:1})])])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-13163181"]]),W={class:"service-add-container"},Z={class:"page-header"},G={class:"form-section"},H={class:"service-type-wrapper"},X={class:"phone-management"},Y={class:"form-section"},ee={class:"form-section"},ae={class:"form-section"},le={class:"phone-management"},re={class:"form-section"},te={class:"form-actions"},oe=["src"],ue={key:0,class:"order-info"},de={key:0,style:{"margin-top":"20px"}},se={style:{"text-align":"right","margin-top":"12px","font-weight":"bold"}},ne={class:"dialog-footer"},ie={class:"dialog-footer"},ce=l(n({__name:"Add",setup(e){const l=V(),n=k(),h=d(l),I=r(),U=a(),E=L(),F=t(),R=z(),{isMobile:M}=o(),K=s(),J=s(!1),ce=s(!1),me=s(!1),pe=s(!1),ve=s(""),fe=s(!1),ge=s(!1),he=s([]),ye=s(!1),be=s([]),_e=s([]),we=s(!1),Ve=s(),ke=s(!1),Ne=s(!1),Ce=s(),Se=s(!1),xe=N({phone:"",remark:""}),Te=N({phone:"",remark:""}),Pe={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}]},Ie=N({orderId:"",orderNumber:"",customerId:"",serviceType:"",customerName:"",customerPhone:"",priority:"medium",productName:"",productSpec:"",quantity:1,price:0,reason:"",description:"",contactName:"",contactPhone:"",contactAddress:"",remark:""}),Ue=s([]),qe=s(null),Ae=i(()=>R.enabledServiceTypes()),$e=i(()=>{const e=U.currentUser;return!!e&&("super_admin"===e.role||"admin"===e.role)}),Oe={orderNumber:[{required:!0,message:"请输入原订单号",trigger:"blur"}],serviceType:[{required:!0,message:"请选择服务类型",trigger:"change"}],customerName:[{required:!0,message:"请输入客户姓名",trigger:"blur"}],customerPhone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],productName:[{required:!0,message:"请输入商品名称",trigger:"blur"}],quantity:[{required:!0,message:"请输入购买数量",trigger:"blur"}],price:[{required:!0,message:"请输入购买价格",trigger:"blur"}],reason:[{required:!0,message:"请选择申请原因",trigger:"change"}],description:[{required:!0,message:"请输入详细描述",trigger:"blur"},{min:10,message:"详细描述至少10个字符",trigger:"blur"}],contactName:[{required:!0,message:"请输入联系人姓名",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]},Be=()=>{l.back()},Le=()=>{Ie.customerName?(Ie.contactName=Ie.customerName,Ie.contactPhone=Ie.customerPhone,(qe.value?.shippingAddress||qe.value?.address)&&(Ie.contactAddress=qe.value.shippingAddress||qe.value.address),q.success("已复用客户信息到联系信息")):q.warning("请先选择订单或填写客户信息")},je=async e=>{if(!e||e.length<2)he.value=[];else{ge.value=!0;try{const l=e.trim();console.log("[售后订单搜索] 搜索关键词:",l);const r=localStorage.getItem("crm_store_order");if(!r)return console.error("[售后订单搜索] 订单数据不存在"),q.warning("订单数据未加载，请刷新页面重试"),void(he.value=[]);let t=[];try{const e=JSON.parse(r);e.data&&e.data.orders?t=e.data.orders:e.orders?t=e.orders:Array.isArray(e)&&(t=e),console.log("[售后订单搜索] 订单总数:",t.length)}catch(a){return console.error("[售后订单搜索] 解析订单数据失败:",a),q.error("订单数据解析失败"),void(he.value=[])}const o=t.filter(e=>{const a=e.orderNumber?.toLowerCase().includes(l.toLowerCase()),r=e.customerPhone?.includes(l),t=e.trackingNumber?.toLowerCase().includes(l.toLowerCase()),o=e.customerCode?.toLowerCase().includes(l.toLowerCase()),u=e.customerName?.toLowerCase().includes(l.toLowerCase()),d=e.products?.some(e=>e.name?.toLowerCase().includes(l.toLowerCase()));return a||r||t||o||u||d});console.log("[售后订单搜索] 匹配到的订单数:",o.length);const u=o.slice(0,10);console.log("[售后订单搜索] 可申请售后的订单数:",u.length),he.value=u.map(e=>{const a=e.products&&e.products.length>0?e.products[0].name:"无商品信息";return{...e,productName:a}})}catch(l){console.error("[售后订单搜索] 搜索失败:",l),q.error("搜索订单失败"),he.value=[]}finally{ge.value=!1}}},De=e=>{if(!e)return void(me.value=!1);const a=F.orders.find(a=>a.orderNumber===e);a&&(qe.value=a,fe.value=!0)},ze=()=>{if(qe.value){if(Ie.orderId=qe.value.id,Ie.orderNumber=qe.value.orderNumber,Ie.customerId=qe.value.customerId||qe.value.customer_id||"",Ie.customerName=qe.value.customerName,Ie.customerPhone=qe.value.customerPhone,qe.value.products&&qe.value.products.length>0){const e=qe.value.products[0];Ie.productName=e.name||"",Ie.productSpec=e.spec||e.specification||"",Ie.quantity=e.quantity||1,Ie.price=e.price||0}else Ie.productName=qe.value.productName||"",Ie.productSpec=qe.value.productSpec||"",Ie.quantity=qe.value.quantity||1,Ie.price=qe.value.price||0;Ie.contactName=qe.value.customerName,Ie.contactPhone=qe.value.customerPhone,Ie.contactAddress=qe.value.shippingAddress||qe.value.address||"",me.value=!0,fe.value=!1,q.success("订单信息已填充")}},Ee=e=>{ve.value=e.url,pe.value=!0},Fe=e=>{console.log("移除文件:",e)},Re=async e=>{if(e.raw){const l=e.raw.type.startsWith("image/"),r=e.raw.size/1024/1024<2;if(!l){q.error("只能上传图片文件!");const a=Ue.value.indexOf(e);return void(a>-1&&Ue.value.splice(a,1))}if(!r){q.error("图片大小不能超过 2MB!");const a=Ue.value.indexOf(e);return void(a>-1&&Ue.value.splice(a,1))}try{const{uploadImage:a}=await u(async()=>{const{uploadImage:e}=await import("./uploadService-rJoD_mJD.js");return{uploadImage:e}},__vite__mapDeps([0,1,2,3,4,5])),l=await a(e.raw,"service");if(l.success&&l.url)e.url=l.url,e.status="success",q.success("图片上传成功");else{const a=Ue.value.indexOf(e);a>-1&&Ue.value.splice(a,1),q.error(l.message||"图片上传失败")}}catch(a){console.error("图片上传失败:",a);const l=Ue.value.indexOf(e);l>-1&&Ue.value.splice(l,1),q.error("图片上传失败，请重试")}}},Me=async()=>{if(Ve.value)try{await Ve.value.validate(),ke.value=!0,await new Promise(e=>setTimeout(e,1e3));const a={id:Date.now(),phone:xe.phone,remark:xe.remark||"无备注"};be.value.push(a),Ie.customerPhone=a.phone;try{const e=Ie.customerId||"default-customer-id",l=await D.syncCustomerPhone(e,{id:a.id,phone:a.phone,remark:a.remark});l.success?q.success("添加成功，已同步到客户详情"):q.warning("添加成功，但同步失败："+l.message)}catch(e){console.error("同步客户手机号失败:",e),q.warning("添加成功，但同步失败")}Je()}catch(a){console.error("添加客户手机号失败:",a),q.error("添加失败")}finally{ke.value=!1}},Ke=async()=>{if(Ce.value)try{await Ce.value.validate(),Se.value=!0,await new Promise(e=>setTimeout(e,1e3));const a={id:Date.now(),phone:Te.phone,remark:Te.remark||"无备注"};_e.value.push(a),Ie.contactPhone=a.phone;try{const e=Ie.contactId||"default-contact-id",l=await D.syncContactPhone(e,{id:a.id,phone:a.phone,remark:a.remark});l.success?q.success("添加成功，已同步到联系人详情"):q.warning("添加成功，但同步失败："+l.message)}catch(e){console.error("同步联系手机号失败:",e),q.warning("添加成功，但同步失败")}Qe()}catch(a){console.error("添加联系手机号失败:",a),q.error("添加失败")}finally{Se.value=!1}},Je=()=>{we.value=!1,xe.phone="",xe.remark="",Ve.value&&Ve.value.clearValidate()},Qe=()=>{Ne.value=!1,Te.phone="",Te.remark="",Ce.value&&Ce.value.clearValidate()},We=()=>{A.confirm("确定要取消吗？未保存的数据将丢失。","确认取消",{confirmButtonText:"确定",cancelButtonText:"继续编辑",type:"warning"}).then(()=>{l.back()})},Ze=async()=>{ce.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),q.success("草稿保存成功")}catch(e){q.error("保存草稿失败")}finally{ce.value=!1}},Ge=async()=>{if(K.value)try{if(await K.value.validate(),!Ie.orderNumber)return void q.warning("请选择订单");if(!Ie.serviceType)return void q.warning("请选择服务类型");if(!Ie.customerName)return void q.warning("请输入客户姓名");if(!Ie.description||Ie.description.length<5)return void q.warning("详细描述至少需要5个字符");J.value=!0,console.log("开始提交售后申请:",{orderId:Ie.orderId,orderNumber:Ie.orderNumber,customerName:Ie.customerName,serviceType:Ie.serviceType});const e=await E.createAfterSalesService({orderId:Ie.orderId||"",orderNumber:Ie.orderNumber,customerId:Ie.customerId||"",customerName:Ie.customerName,customerPhone:Ie.customerPhone,serviceType:Ie.serviceType,priority:Ie.priority,description:Ie.description,productName:Ie.productName,productSpec:Ie.productSpec,quantity:Ie.quantity,price:Ie.price,reason:Ie.reason,contactName:Ie.contactName,contactPhone:Ie.contactPhone,contactAddress:Ie.contactAddress,remark:Ie.remark,attachments:Ue.value,createdBy:U.currentUser?.id||"system"});console.log("售后申请创建成功:",e),I.sendMessage(I.MessageType.AFTER_SALES_CREATED,`售后申请 ${e.serviceNumber} 已提交，客户：${Ie.customerName}，服务类型：${He(Ie.serviceType)}`,{relatedId:e.id,relatedType:"service",actionUrl:`/service/detail/${e.id}`}),q.success("售后申请提交成功"),setTimeout(()=>{h.push(`/service/detail/${e.id}`)},500)}catch(e){if(console.error("提交售后失败:",e),!1!==e){let a="提交失败，请检查表单信息";e instanceof Error&&(a=e.message,console.error("错误详情:",{message:e.message,stack:e.stack,formData:{orderId:Ie.orderId,orderNumber:Ie.orderNumber,customerName:Ie.customerName,serviceType:Ie.serviceType,description:Ie.description}})),q.error(a)}}finally{J.value=!1}},He=e=>({return:"退货",exchange:"换货",repair:"维修",refund:"退款",complaint:"投诉"}[e]||e);return C(()=>{(()=>{const e=n.query;if(e.orderId&&(Ie.orderId=e.orderId),e.orderNumber&&(Ie.orderNumber=e.orderNumber,me.value=!0),e.customerId&&(Ie.customerId=e.customerId),e.customerName&&(Ie.customerName=e.customerName),e.customerPhone&&(Ie.customerPhone=e.customerPhone),e.products)try{const a=JSON.parse(e.products);if(a&&a.length>0){const e=a[0];Ie.productName=e.name||"",Ie.productSpec=e.spec||"",Ie.quantity=e.quantity||1,Ie.price=e.price||0}}catch(a){console.warn("解析商品信息失败:",a)}e.orderNumber?q.success("已自动同步订单信息，请完善售后详情"):e.customerId&&e.customerName&&q.success(`已自动选择客户：${e.customerName}，请完善售后详情`)})(),(async()=>{try{be.value=[{id:1,phone:"13800138001",remark:"主要联系方式"},{id:2,phone:"13800138002",remark:"备用联系方式"}]}catch(e){console.error("加载客户手机号失败:",e)}})(),(async()=>{try{_e.value=[{id:1,phone:"13800138003",remark:"联系人手机"},{id:2,phone:"13800138004",remark:"紧急联系方式"}]}catch(e){console.error("加载联系手机号失败:",e)}})()}),(e,a)=>{const l=c("el-button"),r=c("el-option"),t=c("el-select"),o=c("el-form-item"),u=c("el-col"),d=c("el-row"),s=c("el-input"),n=c("el-radio"),i=c("el-radio-group"),h=c("el-input-number"),V=c("el-icon"),k=c("el-upload"),N=c("el-form"),C=c("el-card"),I=c("el-dialog"),U=c("el-descriptions-item"),q=c("el-descriptions"),A=c("el-table-column"),L=c("el-table");return p(),_("div",W,[f("div",Z,[g(l,{icon:y($),onClick:Be,class:"back-btn"},{default:v(()=>[...a[29]||(a[29]=[b(" 返回 ",-1)])]),_:1},8,["icon"]),a[30]||(a[30]=f("div",{class:"header-content"},[f("h2",null,"新建售后"),f("p",null,"创建新的售后服务申请")],-1))]),g(C,{shadow:"never"},{default:v(()=>[g(N,{ref_key:"formRef",ref:K,model:Ie,rules:Oe,"label-width":"120px","label-position":y(M)?"top":"right"},{default:v(()=>[f("div",G,[a[36]||(a[36]=f("h3",{class:"section-title"},"基本信息",-1)),g(d,{gutter:20},{default:v(()=>[g(u,{span:y(M)?24:12},{default:v(()=>[g(o,{label:"原订单号",prop:"orderNumber"},{default:v(()=>[g(t,{modelValue:Ie.orderNumber,"onUpdate:modelValue":a[0]||(a[0]=e=>Ie.orderNumber=e),placeholder:"请输入订单号/手机号/物流单号/客户编码搜索",filterable:"",remote:"","reserve-keyword":"","remote-method":je,loading:ge.value,style:{width:"100%"},clearable:"",onChange:De},{default:v(()=>[(p(!0),_(S,null,x(he.value,e=>(p(),m(r,{key:e.id,label:`${e.orderNumber} - ${e.customerName} - ${e.productName}`,value:e.orderNumber},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1},8,["span"]),g(u,{span:y(M)?24:12},{default:v(()=>[g(o,{label:"服务类型",prop:"serviceType"},{default:v(()=>[f("div",H,[g(t,{modelValue:Ie.serviceType,"onUpdate:modelValue":a[1]||(a[1]=e=>Ie.serviceType=e),placeholder:"请选择服务类型",style:{width:"100%"}},{default:v(()=>[(p(!0),_(S,null,x(Ae.value,e=>(p(),m(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),$e.value?(p(),m(l,{key:0,type:"primary",icon:y(O),size:"small",style:{"margin-left":"8px"},onClick:a[2]||(a[2]=e=>ye.value=!0),title:"配置服务类型"},null,8,["icon"])):T("",!0)])]),_:1})]),_:1},8,["span"])]),_:1}),g(d,{gutter:20},{default:v(()=>[g(u,{span:y(M)?24:12},{default:v(()=>[g(o,{label:"客户姓名",prop:"customerName"},{default:v(()=>[g(s,{modelValue:Ie.customerName,"onUpdate:modelValue":a[3]||(a[3]=e=>Ie.customerName=e),placeholder:"请输入客户姓名",readonly:me.value},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["span"]),g(u,{span:y(M)?24:12},{default:v(()=>[g(o,{label:"联系电话",prop:"customerPhone"},{default:v(()=>[f("div",X,[g(t,{modelValue:Ie.customerPhone,"onUpdate:modelValue":a[4]||(a[4]=e=>Ie.customerPhone=e),placeholder:"请选择联系电话",style:{width:"100%"},clearable:""},{default:v(()=>[(p(!0),_(S,null,x(be.value,e=>(p(),m(r,{key:e.id,label:`${y(j)(e.phone)} ${e.remark?"("+e.remark+")":""}`,value:e.phone},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),g(l,{type:"primary",size:"small",onClick:a[5]||(a[5]=e=>we.value=!0),style:{"margin-left":"8px"},icon:y(P)},{default:v(()=>[...a[31]||(a[31]=[b(" 新增 ",-1)])]),_:1},8,["icon"])])]),_:1})]),_:1},8,["span"])]),_:1}),g(d,{gutter:20},{default:v(()=>[g(u,{span:y(M)?24:12},{default:v(()=>[g(o,{label:"优先级",prop:"priority"},{default:v(()=>[g(i,{modelValue:Ie.priority,"onUpdate:modelValue":a[6]||(a[6]=e=>Ie.priority=e)},{default:v(()=>[g(n,{label:"low"},{default:v(()=>[...a[32]||(a[32]=[b("低",-1)])]),_:1}),g(n,{label:"medium"},{default:v(()=>[...a[33]||(a[33]=[b("中",-1)])]),_:1}),g(n,{label:"high"},{default:v(()=>[...a[34]||(a[34]=[b("高",-1)])]),_:1}),g(n,{label:"urgent"},{default:v(()=>[...a[35]||(a[35]=[b("紧急",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["span"])]),_:1})]),f("div",Y,[a[37]||(a[37]=f("h3",{class:"section-title"},"商品信息",-1)),g(d,{gutter:20},{default:v(()=>[g(u,{span:y(M)?24:12},{default:v(()=>[g(o,{label:"商品名称",prop:"productName"},{default:v(()=>[g(s,{modelValue:Ie.productName,"onUpdate:modelValue":a[7]||(a[7]=e=>Ie.productName=e),placeholder:"请输入商品名称",readonly:me.value},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["span"]),g(u,{span:y(M)?24:12},{default:v(()=>[g(o,{label:"商品规格",prop:"productSpec"},{default:v(()=>[g(s,{modelValue:Ie.productSpec,"onUpdate:modelValue":a[8]||(a[8]=e=>Ie.productSpec=e),placeholder:"请输入商品规格",readonly:me.value},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["span"])]),_:1}),g(d,{gutter:20},{default:v(()=>[g(u,{span:y(M)?24:12},{default:v(()=>[g(o,{label:"购买数量",prop:"quantity"},{default:v(()=>[g(h,{modelValue:Ie.quantity,"onUpdate:modelValue":a[9]||(a[9]=e=>Ie.quantity=e),min:1,style:{width:"100%"},readonly:me.value},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["span"]),g(u,{span:y(M)?24:12},{default:v(()=>[g(o,{label:"购买价格",prop:"price"},{default:v(()=>[g(h,{modelValue:Ie.price,"onUpdate:modelValue":a[10]||(a[10]=e=>Ie.price=e),min:0,precision:2,style:{width:"100%"},readonly:me.value},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["span"])]),_:1})]),f("div",ee,[a[39]||(a[39]=f("h3",{class:"section-title"},"申请信息",-1)),g(d,{gutter:20},{default:v(()=>[g(u,{span:24},{default:v(()=>[g(o,{label:"申请原因",prop:"reason"},{default:v(()=>[g(t,{modelValue:Ie.reason,"onUpdate:modelValue":a[11]||(a[11]=e=>Ie.reason=e),placeholder:"请选择申请原因",style:{width:"100%"}},{default:v(()=>[g(r,{label:"商品质量问题",value:"quality"}),g(r,{label:"商品损坏",value:"damaged"}),g(r,{label:"尺寸不合适",value:"size"}),g(r,{label:"颜色不符",value:"color"}),g(r,{label:"功能故障",value:"malfunction"}),g(r,{label:"发错商品",value:"wrong_item"}),g(r,{label:"不满意",value:"unsatisfied"}),g(r,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),g(d,{gutter:20},{default:v(()=>[g(u,{span:24},{default:v(()=>[g(o,{label:"详细描述",prop:"description"},{default:v(()=>[g(s,{modelValue:Ie.description,"onUpdate:modelValue":a[12]||(a[12]=e=>Ie.description=e),type:"textarea",rows:4,placeholder:"请详细描述问题或需求...",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),g(d,{gutter:20},{default:v(()=>[g(u,{span:24},{default:v(()=>[g(o,{label:"上传图片"},{default:v(()=>[g(k,{"file-list":Ue.value,"onUpdate:fileList":a[13]||(a[13]=e=>Ue.value=e),action:"#","list-type":"picture-card","auto-upload":!1,limit:5,accept:"image/*",onPreview:Ee,onRemove:Fe,onChange:Re},{default:v(()=>[g(V,null,{default:v(()=>[g(y(P))]),_:1})]),_:1},8,["file-list"]),a[38]||(a[38]=f("div",{class:"upload-tip"}," 支持jpg、png格式，最多上传5张图片，每张不超过2MB ",-1))]),_:1})]),_:1})]),_:1})]),f("div",ae,[a[42]||(a[42]=f("h3",{class:"section-title"},"联系信息",-1)),g(d,{gutter:20},{default:v(()=>[g(u,{span:y(M)?24:8},{default:v(()=>[g(o,{label:"联系人",prop:"contactName"},{default:v(()=>[g(s,{modelValue:Ie.contactName,"onUpdate:modelValue":a[14]||(a[14]=e=>Ie.contactName=e),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1})]),_:1},8,["span"]),g(u,{span:y(M)?24:8},{default:v(()=>[g(o,{label:"联系电话",prop:"contactPhone"},{default:v(()=>[f("div",le,[g(t,{modelValue:Ie.contactPhone,"onUpdate:modelValue":a[15]||(a[15]=e=>Ie.contactPhone=e),placeholder:"请选择联系电话",style:{width:"100%"},clearable:""},{default:v(()=>[(p(!0),_(S,null,x(_e.value,e=>(p(),m(r,{key:e.id,label:`${y(j)(e.phone)} ${e.remark?"("+e.remark+")":""}`,value:e.phone},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),g(l,{type:"primary",size:"small",onClick:a[16]||(a[16]=e=>Ne.value=!0),style:{"margin-left":"8px"},icon:y(P)},{default:v(()=>[...a[40]||(a[40]=[b(" 新增 ",-1)])]),_:1},8,["icon"])])]),_:1})]),_:1},8,["span"]),g(u,{span:y(M)?24:8},{default:v(()=>[g(o,{label:" "},{default:v(()=>[g(l,{type:"primary",icon:y(B),onClick:Le,disabled:!Ie.customerName},{default:v(()=>[...a[41]||(a[41]=[b(" 复用客户信息 ",-1)])]),_:1},8,["icon","disabled"])]),_:1})]),_:1},8,["span"])]),_:1}),g(d,{gutter:20},{default:v(()=>[g(u,{span:24},{default:v(()=>[g(o,{label:"联系地址",prop:"contactAddress"},{default:v(()=>[g(s,{modelValue:Ie.contactAddress,"onUpdate:modelValue":a[17]||(a[17]=e=>Ie.contactAddress=e),placeholder:"请输入详细地址"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),f("div",re,[a[43]||(a[43]=f("h3",{class:"section-title"},"备注信息",-1)),g(d,{gutter:20},{default:v(()=>[g(u,{span:24},{default:v(()=>[g(o,{label:"备注",prop:"remark"},{default:v(()=>[g(s,{modelValue:Ie.remark,"onUpdate:modelValue":a[18]||(a[18]=e=>Ie.remark=e),type:"textarea",rows:3,placeholder:"请输入备注信息...",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),f("div",te,[g(l,{onClick:We},{default:v(()=>[...a[44]||(a[44]=[b("取消",-1)])]),_:1}),g(l,{onClick:Ze,loading:ce.value},{default:v(()=>[...a[45]||(a[45]=[b(" 保存草稿 ",-1)])]),_:1},8,["loading"]),g(l,{type:"primary",onClick:Ge,loading:J.value},{default:v(()=>[...a[46]||(a[46]=[b(" 提交申请 ",-1)])]),_:1},8,["loading"])])]),_:1},8,["model","label-position"])]),_:1}),g(I,{modelValue:pe.value,"onUpdate:modelValue":a[19]||(a[19]=e=>pe.value=e),title:"图片预览",width:"800px"},{default:v(()=>[f("img",{src:ve.value,style:{width:"100%"}},null,8,oe)]),_:1},8,["modelValue"]),g(I,{modelValue:fe.value,"onUpdate:modelValue":a[21]||(a[21]=e=>fe.value=e),title:"订单信息",width:"700px"},{footer:v(()=>[g(l,{onClick:a[20]||(a[20]=e=>fe.value=!1)},{default:v(()=>[...a[48]||(a[48]=[b("关闭",-1)])]),_:1}),g(l,{type:"primary",onClick:ze},{default:v(()=>[...a[49]||(a[49]=[b("使用此订单信息",-1)])]),_:1})]),default:v(()=>[qe.value?(p(),_("div",ue,[g(q,{column:2,border:""},{default:v(()=>[g(U,{label:"订单号"},{default:v(()=>[b(w(qe.value.orderNumber),1)]),_:1}),g(U,{label:"客户姓名"},{default:v(()=>[b(w(qe.value.customerName),1)]),_:1}),g(U,{label:"联系电话"},{default:v(()=>[b(w(y(j)(qe.value.customerPhone)),1)]),_:1}),g(U,{label:"订单状态"},{default:v(()=>{return[b(w((e=qe.value.status,{pending_transfer:"待转单",pending_audit:"待审核",audit_rejected:"审核拒绝",pending_shipment:"待发货",logistics_returned:"物流退回",logistics_cancelled:"物流取消",delivered:"已送达",package_exception:"包裹异常",rejected:"已拒收",rejected_returned:"拒收退回",completed:"已完成",cancelled:"已取消",draft:"草稿",shipped:"已发货"}[e]||e)),1)];var e}),_:1}),g(U,{label:"物流单号"},{default:v(()=>[b(w(qe.value.trackingNumber||"暂无"),1)]),_:1}),g(U,{label:"客户编码"},{default:v(()=>[b(w(qe.value.customerCode||"暂无"),1)]),_:1}),g(U,{label:"收货地址",span:2},{default:v(()=>[b(w(qe.value.shippingAddress||qe.value.address||"暂无"),1)]),_:1}),g(U,{label:"下单时间",span:2},{default:v(()=>[b(w(qe.value.createdAt),1)]),_:1})]),_:1}),qe.value.products&&qe.value.products.length>0?(p(),_("div",de,[a[47]||(a[47]=f("h4",{style:{"margin-bottom":"12px"}},"商品信息",-1)),g(L,{data:qe.value.products,border:"",style:{width:"100%"}},{default:v(()=>[g(A,{prop:"name",label:"商品名称"}),g(A,{prop:"spec",label:"规格",width:"120"}),g(A,{prop:"quantity",label:"数量",width:"80",align:"center"}),g(A,{label:"单价",width:"100",align:"right"},{default:v(({row:e})=>[b("¥"+w(e.price?.toFixed(2)||"0.00"),1)]),_:1}),g(A,{label:"小计",width:"100",align:"right"},{default:v(({row:e})=>[b("¥"+w((e.price*e.quantity)?.toFixed(2)||"0.00"),1)]),_:1})]),_:1},8,["data"]),f("div",se," 订单总额: ¥"+w(qe.value.totalAmount?.toFixed(2)||qe.value.subtotal?.toFixed(2)||"0.00"),1)])):T("",!0)])):T("",!0)]),_:1},8,["modelValue"]),g(I,{modelValue:we.value,"onUpdate:modelValue":a[24]||(a[24]=e=>we.value=e),title:"新增客户手机号",width:"400px","before-close":Je},{footer:v(()=>[f("span",ne,[g(l,{onClick:Je},{default:v(()=>[...a[50]||(a[50]=[b("取消",-1)])]),_:1}),g(l,{type:"primary",onClick:Me,loading:ke.value},{default:v(()=>[...a[51]||(a[51]=[b(" 确认添加 ",-1)])]),_:1},8,["loading"])])]),default:v(()=>[g(N,{ref_key:"addCustomerPhoneFormRef",ref:Ve,model:xe,rules:Pe,"label-width":"80px"},{default:v(()=>[g(o,{label:"手机号",prop:"phone"},{default:v(()=>[g(s,{modelValue:xe.phone,"onUpdate:modelValue":a[22]||(a[22]=e=>xe.phone=e),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1}),g(o,{label:"备注",prop:"remark"},{default:v(()=>[g(s,{modelValue:xe.remark,"onUpdate:modelValue":a[23]||(a[23]=e=>xe.remark=e),placeholder:"请输入备注（可选）",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),g(I,{modelValue:Ne.value,"onUpdate:modelValue":a[27]||(a[27]=e=>Ne.value=e),title:"新增联系手机号",width:"400px","before-close":Qe},{footer:v(()=>[f("span",ie,[g(l,{onClick:Qe},{default:v(()=>[...a[52]||(a[52]=[b("取消",-1)])]),_:1}),g(l,{type:"primary",onClick:Ke,loading:Se.value},{default:v(()=>[...a[53]||(a[53]=[b(" 确认添加 ",-1)])]),_:1},8,["loading"])])]),default:v(()=>[g(N,{ref_key:"addContactPhoneFormRef",ref:Ce,model:Te,rules:Pe,"label-width":"80px"},{default:v(()=>[g(o,{label:"手机号",prop:"phone"},{default:v(()=>[g(s,{modelValue:Te.phone,"onUpdate:modelValue":a[25]||(a[25]=e=>Te.phone=e),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1}),g(o,{label:"备注",prop:"remark"},{default:v(()=>[g(s,{modelValue:Te.remark,"onUpdate:modelValue":a[26]||(a[26]=e=>Te.remark=e),placeholder:"请输入备注（可选）",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),g(Q,{modelValue:ye.value,"onUpdate:modelValue":a[28]||(a[28]=e=>ye.value=e)},null,8,["modelValue"])])}}}),[["__scopeId","data-v-73e20d8d"]]);export{ce as default};
