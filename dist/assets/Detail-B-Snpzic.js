import{l as e,aA as l,aC as a,r as t,Z as s,e as r,b as i,ag as n,m as o,q as d,p as u,U as c,O as p,S as m,u as v,T as f,M as h,Q as y,F as g,a9 as b}from"./vendor-BtukhyiH.js";import{L as _,Q as w,M as k,T,C as V,aa as I,a4 as U,u as N,H as S,j as C,b as $,E as x}from"./elementPlus-DxaqjplL.js";import{u as A,d as D,b as R,S as E,c as j,_ as M}from"./index-C4IdUW1A.js";import{u as B}from"./service-BjC45aOM.js";import{useDepartmentStore as P}from"./department-CMDKNhTn.js";import{a as O}from"./sensitiveInfo-CTSC2tj2.js";import{isProduction as Y}from"./env-DLalhsF6.js";import"./utils-DfI7e5Rl.js";const L={class:"service-detail"},q={class:"page-header"},z={class:"header-left"},F={class:"title-section"},H={class:"service-status"},J={class:"header-actions"},Q={class:"info-grid"},K={class:"info-item"},Z={class:"value"},G={class:"info-item"},W={class:"info-item"},X={class:"value"},ee={class:"info-item"},le={class:"info-item"},ae={class:"value"},te={class:"info-item"},se={class:"value"},re={class:"info-grid"},ie={class:"info-item"},ne={class:"info-item"},oe={class:"value"},de={class:"info-item"},ue={class:"value"},ce={key:0},pe={key:1,class:"restricted-info"},me={class:"info-item"},ve={class:"value"},fe={class:"product-info"},he={class:"product-item"},ye={class:"product-details"},ge={class:"product-spec"},be={class:"product-meta"},_e={class:"description-content"},we={class:"reason-section"},ke={class:"description-section"},Te={key:0,class:"remark-section"},Ve={class:"card-header"},Ie={class:"follow-up-content"},Ue={key:1,class:"follow-up-list"},Ne={key:0,class:"follow-up-item latest"},Se={class:"follow-up-header"},Ce={class:"follow-up-time"},$e={class:"follow-up-user"},xe={class:"follow-up-body"},Ae={class:"history-title"},De={class:"follow-up-header"},Re={class:"follow-up-time"},Ee={class:"follow-up-user"},je={class:"follow-up-body"},Me={class:"attachments-grid"},Be=["onClick"],Pe={class:"file-icon"},Oe={class:"file-info"},Ye={class:"file-name"},Le={class:"file-size"},qe={class:"timeline-content"},ze={key:0,class:"operator"},Fe={class:"quick-actions"},He={class:"related-info"},Je={class:"related-item"},Qe={class:"related-item"},Ke={class:"related-item"},Ze=M(e({__name:"Detail",setup(e){const M=l(),Ze=a(),Ge=j(M),We=A(),Xe=B();D();const el=R(),ll=P(),al=t(!1),tl=t(!1),sl=t(!1),rl=s({id:"",serviceNumber:"",orderId:"",orderNumber:"",customerId:"",serviceType:"return",status:"pending",priority:"normal",customerName:"",customerPhone:"",contactName:"",contactAddress:"",productName:"",productSpec:"",quantity:0,price:0,reason:"",description:"",remark:"",handleResult:"",assignedTo:"",createdBy:"",createTime:"",updateTime:"",expectedTime:"",attachments:[]}),il=t([]),nl=s({assignType:"user",filterDepartmentId:"",userId:"",departmentId:"",assignedTo:"",remark:""}),ol=t(!1),dl=s({status:"",handleResult:"",remark:""}),ul=t([]),cl=t([]),pl=t(!1),ml=s({followUpTime:"",content:""}),vl=t(!1),fl=t(!1),hl=s({phone:"",purpose:"service",note:""}),yl=r(()=>(We.users||[]).map(e=>{const l=e.name||e.username||e.realName||`用户${e.id}`,a=e.departmentName||e.department||e.deptName||"未分配部门";return{id:e.id,name:l,department:a}})),gl=r(()=>(ll.departments||[]).map(e=>({id:e.id,name:e.name}))),bl=r(()=>{if(!nl.filterDepartmentId)return yl.value;const e=gl.value.find(e=>e.id===nl.filterDepartmentId);return e?yl.value.filter(l=>l.department===e.name||l.department===e.id||l.department&&l.department.includes(e.name)):yl.value}),_l=r(()=>{try{const e=localStorage.getItem("crm_service_types");if(!e)return[];const l=JSON.parse(e).find(e=>e.value===rl.serviceType);return l&&l.handleResults?l.handleResults.map(e=>({value:e?.value||"",label:e?.label||e?.title||"未知",title:e?.title||e?.label||"未知"})):[]}catch(e){return console.error("获取处理结果选项失败:",e),[]}}),wl=()=>{nl.userId=""},kl=r(()=>We.canEditAfterSales||rl.assignedTo===We.currentUser?.name&&We.hasAfterSalesPermission("service:write")),Tl=r(()=>We.canProcessAfterSales&&"closed"!==rl.status&&"resolved"!==rl.status),Vl=r(()=>We.canCloseAfterSales&&"resolved"===rl.status),Il=r(()=>We.isAdmin||We.hasAfterSalesPermission("service:assign")),Ul=r(()=>We.hasAfterSalesPermission("service:read")),Nl=()=>{M.back()},Sl=()=>{Ge.push(`/service/edit/${rl.id}`)},Cl=()=>{sl.value=!0,dl.status=rl.status},$l=()=>{$.confirm("确定要关闭此售后申请吗？","确认关闭",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{rl.status="closed",el.sendMessage(el.MessageType.AFTER_SALES_CREATED,`售后申请 ${rl.serviceNumber} 已关闭，客户：${rl.customerName}`,{relatedId:rl.serviceNumber,relatedType:"service",actionUrl:`/service/detail/${rl.serviceNumber}`}),x.success("售后申请已关闭")})},xl=()=>{rl.customerId?Ge.push(`/customer/detail/${rl.customerId}`):x.warning("客户信息不完整,无法跳转")},Al=()=>{rl.orderId?Ge.push(`/order/detail/${rl.orderId}`):rl.orderNumber?Ge.push(`/order/detail/${rl.orderNumber}`):x.warning("订单信息不完整,无法跳转")},Dl=()=>{hl.phone=rl.customerPhone,hl.purpose="service",hl.note=`售后单号: ${rl.serviceNumber}`,vl.value=!0},Rl=async()=>{if(hl.phone)if(hl.purpose){fl.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),x.success("外呼成功,正在接通..."),vl.value=!1,console.log("外呼记录:",{phone:hl.phone,purpose:hl.purpose,note:hl.note,serviceNumber:rl.serviceNumber,time:(new Date).toISOString()})}catch(e){console.error("外呼失败:",e),x.error("外呼失败")}finally{fl.value=!1}}else x.warning("请选择通话目的");else x.warning("请输入电话号码")},El=()=>{tl.value=!0,nl.assignedTo=rl.assignedTo},jl=async()=>{let e="";if("user"===nl.assignType){if(!nl.userId)return void x.warning("请选择处理人");const l=yl.value.find(e=>e.id===nl.userId);if(!l)return void x.error("找不到选择的用户");e=l.name}else{if(!nl.departmentId)return void x.warning("请选择部门");const l=gl.value.find(e=>e.id===nl.departmentId);if(!l)return void x.error("找不到选择的部门");const a=yl.value.filter(e=>e.department===l.name||e.department===l.id||e.department&&e.department.includes(l.name));if(0===a.length)return void x.warning(`部门"${l.name}"下没有可分配的用户`);e=a[Math.floor(Math.random()*a.length)].name}ol.value=!0;try{rl.assignedTo=e,el.sendMessage(el.MessageType.AFTER_SALES_CREATED,`售后申请 ${rl.serviceNumber} 已分配给 ${e}，客户：${rl.customerName}`,{relatedId:rl.serviceNumber,relatedType:"service",actionUrl:`/service/detail/${rl.serviceNumber}`}),x.success("分配成功"),tl.value=!1,il.value.push({title:"重新分配处理人",description:`已分配给${e}处理`,time:(new Date).toLocaleString(),type:"success",icon:N,operator:We.currentUser?.name||"系统"})}catch(l){console.error("分配失败:",l),x.error("分配失败")}finally{ol.value=!1}},Ml=()=>{sl.value=!0},Bl=()=>{if(!dl.status)return void x.warning("请选择状态");rl.status=dl.status,dl.handleResult&&(rl.handleResult=dl.handleResult),sl.value=!1,el.sendMessage(el.MessageType.AFTER_SALES_CREATED,`售后申请 ${rl.serviceNumber} 状态已更新为${Ol(dl.status)}，客户：${rl.customerName}`,{relatedId:rl.serviceNumber,relatedType:"service",actionUrl:`/service/detail/${rl.serviceNumber}`}),x.success("状态更新成功");let e="";if(dl.handleResult&&_l.value.length>0){const l=_l.value.find(e=>e.value===dl.handleResult);e=l?.title||l?.label||""}const l=[dl.remark,e?`处理结果: ${e}`:"",dl.remark||e?"":`状态更新为${Ol(dl.status)}`].filter(Boolean).join(" - ");il.value.push({title:"状态更新",description:l,time:(new Date).toLocaleString(),type:"primary",icon:T,operator:We.currentUser?.name||"系统"})},Pl=e=>{const l=e.toLowerCase().substring(e.lastIndexOf("."));return[".jpg",".jpeg",".png",".gif",".bmp",".webp"].includes(l)},Ol=e=>({pending:"待处理",processing:"处理中",resolved:"已解决",closed:"已关闭"}[e]||"未知"),Yl=e=>({low:"低",medium:"中",high:"高"}[e]||"未知"),Ll=e=>{if(!e)return"未知";if(/^\d{11}$/.test(e)){const l=yl.value.find(l=>l.phone===e||l.id===e);return l?.name||e}const l=yl.value.find(l=>l.id===e);return l?l.name:e},ql=e=>{if(!e)return"系统";if(/^\d{11}$/.test(e)){const l=yl.value.find(l=>l.phone===e||l.id===e);return l?.name||e}const l=yl.value.find(l=>l.id===e);return l?l.name:e},zl=()=>{const e=[];e.push({title:"售后申请提交",description:"客户提交售后申请",time:rl.createTime,type:"success",icon:N,operator:rl.createdBy}),"pending"!==rl.status&&e.push({title:"申请已受理",description:"售后申请已受理,等待处理",time:rl.createTime,type:"success",icon:S,operator:"系统"}),rl.assignedTo&&e.push({title:"分配处理人员",description:`已分配给${rl.assignedTo}处理`,time:rl.updateTime||rl.createTime,type:"success",icon:N,operator:"系统"}),"processing"===rl.status&&e.push({title:"开始处理",description:"处理人员开始处理售后问题",time:rl.updateTime||rl.createTime,type:"primary",icon:T,operator:rl.assignedTo||"系统"}),"resolved"===rl.status&&e.push({title:"问题已解决",description:"售后问题已解决",time:rl.updateTime||rl.createTime,type:"success",icon:S,operator:rl.assignedTo||"系统"}),"closed"===rl.status&&e.push({title:"售后已关闭",description:"售后申请已关闭",time:rl.updateTime||rl.createTime,type:"info",icon:C,operator:"系统"}),il.value=e},Fl=()=>{pl.value=!0,ml.followUpTime=(new Date).toISOString().replace("T"," ").substring(0,19),ml.content=""},Hl=()=>{if(!ml.followUpTime)return void x.warning("请选择跟进时间");if(!ml.content||""===ml.content.trim())return void x.warning("请输入跟进内容");const e={id:Date.now().toString(),followUpTime:ml.followUpTime,content:ml.content.trim(),createdBy:We.currentUser?.name||"当前用户",createTime:(new Date).toISOString().replace("T"," ").substring(0,19)};ul.value.unshift(e),Jl(),pl.value=!1,x.success("跟进记录已保存")},Jl=()=>{const e=`service_follow_up_${rl.id}`;localStorage.setItem(e,JSON.stringify(ul.value))};return i(async()=>{await We.loadUsers(),(async()=>{al.value=!0;try{const e=Ze.params.id;if(!e)return x.error("售后ID不能为空"),void M.back();if(console.log("[售后详情] 加载售后记录:",e),Y()){console.log("[售后详情] 生产环境,调用API");const l=await fetch(`/api/service/${e}`);if(!l.ok)throw new Error("API调用失败");const a=await l.json();Object.assign(rl,a)}else{console.log("[售后详情] 开发环境,从store获取");const l=Xe.getServiceById(e);if(!l)return x.error("售后记录不存在"),void M.back();Object.assign(rl,l),console.log("[售后详情] 售后信息:",rl),zl()}}catch(e){console.error("[售后详情] 加载失败:",e),x.error("加载售后详情失败"),M.back()}finally{al.value=!1}})(),(()=>{const e=`service_follow_up_${rl.id}`,l=localStorage.getItem(e);if(l)try{ul.value=JSON.parse(l)}catch(a){console.error("加载跟进记录失败:",a),ul.value=[]}else ul.value=[]})()}),(e,l)=>{const a=n("el-button"),t=n("el-tag"),s=n("el-link"),r=n("el-card"),i=n("el-empty"),$=n("el-icon"),A=n("el-collapse-item"),D=n("el-collapse"),R=n("el-col"),j=n("el-timeline-item"),M=n("el-timeline"),B=n("el-row"),P=n("el-radio"),Y=n("el-radio-group"),Ze=n("el-form-item"),Ge=n("el-option"),We=n("el-select"),Xe=n("el-input"),el=n("el-form"),ll=n("el-dialog"),al=n("el-date-picker");return d(),o("div",L,[u("div",q,[u("div",z,[c(a,{type:"primary",icon:v(_),onClick:Nl,class:"back-btn"},{default:p(()=>[...l[22]||(l[22]=[m(" 返回 ",-1)])]),_:1},8,["icon"]),u("div",F,[l[23]||(l[23]=u("h1",{class:"page-title"},"售后详情",-1)),u("div",H,[c(t,{type:(yl=rl.status,{pending:"warning",processing:"primary",resolved:"success",closed:"info"}[yl]||"info"),size:"large",effect:"dark"},{default:p(()=>[m(f(Ol(rl.status)),1)]),_:1},8,["type"])])])]),u("div",J,[kl.value?(d(),h(a,{key:0,type:"primary",icon:v(w),onClick:Sl},{default:p(()=>[...l[24]||(l[24]=[m(" 编辑 ",-1)])]),_:1},8,["icon"])):y("",!0),Tl.value?(d(),h(a,{key:1,type:"success",onClick:Cl},{default:p(()=>[...l[25]||(l[25]=[m(" 处理 ",-1)])]),_:1})):y("",!0),Vl.value?(d(),h(a,{key:2,type:"warning",onClick:$l},{default:p(()=>[...l[26]||(l[26]=[m(" 关闭 ",-1)])]),_:1})):y("",!0)])]),c(B,{gutter:20},{default:p(()=>[c(R,{span:16},{default:p(()=>[c(r,{class:"info-card",shadow:"never"},{header:p(()=>[...l[27]||(l[27]=[u("div",{class:"card-header"},[u("h3",null,"基本信息")],-1)])]),default:p(()=>{return[u("div",Q,[u("div",K,[l[28]||(l[28]=u("label",null,"售后单号：",-1)),u("span",Z,f(rl.serviceNumber),1)]),u("div",G,[l[29]||(l[29]=u("label",null,"原订单号：",-1)),c(s,{type:"primary",onClick:Al,class:"value-link"},{default:p(()=>[m(f(rl.orderNumber),1)]),_:1})]),u("div",W,[l[30]||(l[30]=u("label",null,"服务类型：",-1)),u("span",X,f((a=rl.serviceType,{return:"退货",exchange:"换货",repair:"维修",refund:"退款",complaint:"投诉"}[a]||"其他")),1)]),u("div",ee,[l[31]||(l[31]=u("label",null,"优先级：",-1)),c(t,{type:(e=rl.priority,{low:"info",medium:"warning",high:"danger"}[e]||"info")},{default:p(()=>[m(f(Yl(rl.priority)),1)]),_:1},8,["type"])]),u("div",le,[l[32]||(l[32]=u("label",null,"申请时间：",-1)),u("span",ae,f(rl.createTime),1)]),u("div",te,[l[33]||(l[33]=u("label",null,"处理人员：",-1)),u("span",se,f(rl.assignedTo||"未分配"),1)])])];var e,a}),_:1}),c(r,{class:"info-card",shadow:"never"},{header:p(()=>[...l[34]||(l[34]=[u("div",{class:"card-header"},[u("h3",null,"客户信息")],-1)])]),default:p(()=>[u("div",re,[u("div",ie,[l[35]||(l[35]=u("label",null,"客户姓名：",-1)),c(s,{type:"primary",onClick:xl,class:"value-link"},{default:p(()=>[m(f(rl.customerName),1)]),_:1})]),u("div",ne,[l[36]||(l[36]=u("label",null,"联系电话：",-1)),u("span",oe,[c(s,{type:"primary",icon:v(k),onClick:Dl},{default:p(()=>[m(f(v(O)(rl.customerPhone,v(E).PHONE)),1)]),_:1},8,["icon"])])]),u("div",de,[l[37]||(l[37]=u("label",null,"联系地址：",-1)),u("span",ue,[Ul.value?(d(),o("span",ce,f(rl.contactAddress),1)):(d(),o("span",pe,"地址信息受限"))])]),u("div",me,[l[38]||(l[38]=u("label",null,"联系人：",-1)),u("span",ve,f(rl.contactName),1)])])]),_:1}),c(r,{class:"info-card",shadow:"never"},{header:p(()=>[...l[39]||(l[39]=[u("div",{class:"card-header"},[u("h3",null,"商品信息")],-1)])]),default:p(()=>[u("div",fe,[u("div",he,[u("div",ye,[u("h4",null,f(rl.productName),1),u("p",ge,"规格："+f(rl.productSpec),1),u("div",be,[u("span",null,"数量："+f(rl.quantity),1),u("span",null,"单价：¥"+f(rl.price),1)])])])])]),_:1}),c(r,{class:"info-card",shadow:"never"},{header:p(()=>[...l[40]||(l[40]=[u("div",{class:"card-header"},[u("h3",null,"问题描述")],-1)])]),default:p(()=>[u("div",_e,[u("div",we,[l[41]||(l[41]=u("h4",null,"问题原因",-1)),u("p",null,f(rl.reason),1)]),u("div",ke,[l[42]||(l[42]=u("h4",null,"详细描述",-1)),u("p",null,f(rl.description),1)]),rl.remark?(d(),o("div",Te,[l[43]||(l[43]=u("h4",null,"备注信息",-1)),u("p",null,f(rl.remark),1)])):y("",!0)])]),_:1}),c(r,{class:"info-card",shadow:"never"},{header:p(()=>[u("div",Ve,[l[45]||(l[45]=u("h3",null,"跟进记录",-1)),c(a,{type:"primary",size:"small",icon:v(V),onClick:Fl},{default:p(()=>[...l[44]||(l[44]=[m(" 添加跟进 ",-1)])]),_:1},8,["icon"])])]),default:p(()=>[u("div",Ie,[0===ul.value.length?(d(),h(i,{key:0,description:"暂无跟进记录","image-size":80})):(d(),o("div",Ue,[ul.value.length>0?(d(),o("div",Ne,[u("div",Se,[u("div",Ce,[c($,null,{default:p(()=>[c(v(T))]),_:1}),m(" "+f(ul.value[0].followUpTime),1)]),u("div",$e,f(ul.value[0].createdBy),1)]),u("div",xe,[u("p",null,f(ul.value[0].content),1)])])):y("",!0),ul.value.length>1?(d(),h(D,{key:1,modelValue:cl.value,"onUpdate:modelValue":l[0]||(l[0]=e=>cl.value=e)},{default:p(()=>[c(A,{name:"history"},{title:p(()=>[u("span",Ae," 查看历史记录 ("+f(ul.value.length-1)+"条) ",1)]),default:p(()=>[(d(!0),o(g,null,b(ul.value.slice(1),(e,l)=>(d(),o("div",{key:e.id,class:"follow-up-item"},[u("div",De,[u("div",Re,[c($,null,{default:p(()=>[c(v(T))]),_:1}),m(" "+f(e.followUpTime),1)]),u("div",Ee,f(e.createdBy),1)]),u("div",je,[u("p",null,f(e.content),1)])]))),128))]),_:1})]),_:1},8,["modelValue"])):y("",!0)]))])]),_:1}),rl.attachments&&rl.attachments.length?(d(),h(r,{key:0,class:"info-card",shadow:"never"},{header:p(()=>[...l[46]||(l[46]=[u("div",{class:"card-header"},[u("h3",null,"相关附件")],-1)])]),default:p(()=>[u("div",Me,[(d(!0),o(g,null,b(rl.attachments,(e,l)=>{return d(),o("div",{key:l,class:"attachment-item",onClick:l=>(e=>{x.info(`预览文件：${e.name}`)})(e)},[u("div",Pe,[c($,{size:"24"},{default:p(()=>[Pl(e.name)?(d(),h(v(I),{key:0})):(d(),h(v(U),{key:1}))]),_:2},1024)]),u("div",Oe,[u("p",Ye,f(e.name),1),u("p",Le,f((a=e.size,a<1024?a+" B":a<1048576?(a/1024).toFixed(1)+" KB":(a/1048576).toFixed(1)+" MB")),1)])],8,Be);var a}),128))])]),_:1})):y("",!0)]),_:1}),c(R,{span:8},{default:p(()=>[c(r,{class:"progress-card",shadow:"never"},{header:p(()=>[...l[47]||(l[47]=[u("div",{class:"card-header"},[u("h3",null,"处理进度")],-1)])]),default:p(()=>[c(M,null,{default:p(()=>[(d(!0),o(g,null,b(il.value,(e,l)=>(d(),h(j,{key:l,timestamp:e?.time||"",type:e?.type||"info",icon:e?.icon},{default:p(()=>[u("div",qe,[u("h4",null,f(e?.title||"未知步骤"),1),u("p",null,f(e?.description||""),1),e?.operator?(d(),o("p",ze,"操作人："+f(ql(e.operator)),1)):y("",!0)])]),_:2},1032,["timestamp","type","icon"]))),128))]),_:1})]),_:1}),c(r,{class:"action-card",shadow:"never"},{header:p(()=>[...l[48]||(l[48]=[u("div",{class:"card-header"},[u("h3",null,"快速操作")],-1)])]),default:p(()=>[u("div",Fe,[Il.value?(d(),h(a,{key:0,type:"primary",icon:v(N),onClick:El,disabled:"closed"===rl.status,class:"action-btn"},{default:p(()=>[...l[49]||(l[49]=[m(" 分配处理人 ",-1)])]),_:1},8,["icon","disabled"])):y("",!0),Tl.value?(d(),h(a,{key:1,type:"success",icon:v(S),onClick:Ml,disabled:"closed"===rl.status,class:"action-btn"},{default:p(()=>[...l[50]||(l[50]=[m(" 更新状态 ",-1)])]),_:1},8,["icon","disabled"])):y("",!0),kl.value?(d(),h(a,{key:2,type:"warning",icon:v(w),onClick:Sl,class:"action-btn"},{default:p(()=>[...l[51]||(l[51]=[m(" 编辑售后 ",-1)])]),_:1},8,["icon"])):y("",!0),Vl.value?(d(),h(a,{key:3,type:"danger",icon:v(C),onClick:$l,class:"action-btn"},{default:p(()=>[...l[52]||(l[52]=[m(" 关闭售后 ",-1)])]),_:1},8,["icon"])):y("",!0)])]),_:1}),c(r,{class:"related-card",shadow:"never"},{header:p(()=>[...l[53]||(l[53]=[u("div",{class:"card-header"},[u("h3",null,"相关信息")],-1)])]),default:p(()=>[u("div",He,[u("div",Je,[l[54]||(l[54]=u("label",null,"创建人：",-1)),u("span",null,f(Ll(rl.createdBy)),1)]),u("div",Qe,[l[55]||(l[55]=u("label",null,"最后更新：",-1)),u("span",null,f(rl.updateTime),1)]),u("div",Ke,[l[56]||(l[56]=u("label",null,"预计完成：",-1)),u("span",null,f(rl.expectedTime||"未设定"),1)])])]),_:1})]),_:1})]),_:1}),c(ll,{modelValue:tl.value,"onUpdate:modelValue":l[7]||(l[7]=e=>tl.value=e),title:"分配处理人",width:"500px"},{footer:p(()=>[c(a,{onClick:l[6]||(l[6]=e=>tl.value=!1)},{default:p(()=>[...l[59]||(l[59]=[m("取消",-1)])]),_:1}),c(a,{type:"primary",onClick:jl,loading:ol.value},{default:p(()=>[...l[60]||(l[60]=[m(" 确定分配 ",-1)])]),_:1},8,["loading"])]),default:p(()=>[c(el,{model:nl,"label-width":"100px"},{default:p(()=>[c(Ze,{label:"分配方式"},{default:p(()=>[c(Y,{modelValue:nl.assignType,"onUpdate:modelValue":l[1]||(l[1]=e=>nl.assignType=e)},{default:p(()=>[c(P,{label:"user"},{default:p(()=>[...l[57]||(l[57]=[m("指定用户",-1)])]),_:1}),c(P,{label:"department"},{default:p(()=>[...l[58]||(l[58]=[m("部门随机",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),"user"===nl.assignType?(d(),h(Ze,{key:0,label:"筛选部门"},{default:p(()=>[c(We,{modelValue:nl.filterDepartmentId,"onUpdate:modelValue":l[2]||(l[2]=e=>nl.filterDepartmentId=e),placeholder:"全部部门",clearable:"",style:{width:"100%"},onChange:wl},{default:p(()=>[c(Ge,{label:"全部部门",value:""}),(d(!0),o(g,null,b(gl.value,e=>(d(),h(Ge,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):y("",!0),"user"===nl.assignType?(d(),h(Ze,{key:1,label:"选择用户"},{default:p(()=>[c(We,{modelValue:nl.userId,"onUpdate:modelValue":l[3]||(l[3]=e=>nl.userId=e),placeholder:"请选择处理人",filterable:"",style:{width:"100%"}},{default:p(()=>[(d(!0),o(g,null,b(bl.value,e=>(d(),h(Ge,{key:e.id,label:`${e.name} (${e.department||"未分配部门"})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):y("",!0),"department"===nl.assignType?(d(),h(Ze,{key:2,label:"选择部门"},{default:p(()=>[c(We,{modelValue:nl.departmentId,"onUpdate:modelValue":l[4]||(l[4]=e=>nl.departmentId=e),placeholder:"请选择部门",style:{width:"100%"}},{default:p(()=>[(d(!0),o(g,null,b(gl.value,e=>(d(),h(Ge,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):y("",!0),c(Ze,{label:"备注"},{default:p(()=>[c(Xe,{modelValue:nl.remark,"onUpdate:modelValue":l[5]||(l[5]=e=>nl.remark=e),type:"textarea",rows:3,placeholder:"请输入分配备注(可选)"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),c(ll,{modelValue:sl.value,"onUpdate:modelValue":l[12]||(l[12]=e=>sl.value=e),title:"更新状态",width:"500px"},{footer:p(()=>[c(a,{onClick:l[11]||(l[11]=e=>sl.value=!1)},{default:p(()=>[...l[61]||(l[61]=[m("取消",-1)])]),_:1}),c(a,{type:"primary",onClick:Bl},{default:p(()=>[...l[62]||(l[62]=[m("确定",-1)])]),_:1})]),default:p(()=>[c(el,{model:dl,"label-width":"100px"},{default:p(()=>[c(Ze,{label:"新状态"},{default:p(()=>[c(We,{modelValue:dl.status,"onUpdate:modelValue":l[8]||(l[8]=e=>dl.status=e),placeholder:"请选择状态",style:{width:"100%"}},{default:p(()=>[c(Ge,{label:"待处理",value:"pending"}),c(Ge,{label:"处理中",value:"processing"}),c(Ge,{label:"已解决",value:"resolved"}),c(Ge,{label:"已关闭",value:"closed"})]),_:1},8,["modelValue"])]),_:1}),_l.value.length>0?(d(),h(Ze,{key:0,label:"处理结果"},{default:p(()=>[c(We,{modelValue:dl.handleResult,"onUpdate:modelValue":l[9]||(l[9]=e=>dl.handleResult=e),placeholder:"请选择处理结果",style:{width:"100%"}},{default:p(()=>[(d(!0),o(g,null,b(_l.value,e=>(d(),h(Ge,{key:e?.value||"",label:e?.title||e?.label||"未知",value:e?.value||""},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):y("",!0),c(Ze,{label:"处理说明"},{default:p(()=>[c(Xe,{modelValue:dl.remark,"onUpdate:modelValue":l[10]||(l[10]=e=>dl.remark=e),type:"textarea",rows:3,placeholder:"请输入处理说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),c(ll,{modelValue:vl.value,"onUpdate:modelValue":l[17]||(l[17]=e=>vl.value=e),title:"发起外呼",width:"500px"},{footer:p(()=>[c(a,{onClick:l[16]||(l[16]=e=>vl.value=!1)},{default:p(()=>[...l[63]||(l[63]=[m("取消",-1)])]),_:1}),c(a,{onClick:Rl,type:"primary",loading:fl.value},{default:p(()=>[...l[64]||(l[64]=[m("开始通话",-1)])]),_:1},8,["loading"])]),default:p(()=>[c(el,{model:hl,"label-width":"80px"},{default:p(()=>[c(Ze,{label:"电话号码"},{default:p(()=>[c(Xe,{modelValue:hl.phone,"onUpdate:modelValue":l[13]||(l[13]=e=>hl.phone=e),disabled:""},null,8,["modelValue"])]),_:1}),c(Ze,{label:"通话目的"},{default:p(()=>[c(We,{modelValue:hl.purpose,"onUpdate:modelValue":l[14]||(l[14]=e=>hl.purpose=e),placeholder:"请选择",style:{width:"100%"}},{default:p(()=>[c(Ge,{label:"售后跟进",value:"service"}),c(Ge,{label:"客户回访",value:"callback"}),c(Ge,{label:"问题确认",value:"confirm"}),c(Ge,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),c(Ze,{label:"备注"},{default:p(()=>[c(Xe,{modelValue:hl.note,"onUpdate:modelValue":l[15]||(l[15]=e=>hl.note=e),type:"textarea",rows:"3",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),c(ll,{modelValue:pl.value,"onUpdate:modelValue":l[21]||(l[21]=e=>pl.value=e),title:"添加跟进记录",width:"600px"},{footer:p(()=>[c(a,{onClick:l[20]||(l[20]=e=>pl.value=!1)},{default:p(()=>[...l[65]||(l[65]=[m("取消",-1)])]),_:1}),c(a,{type:"primary",onClick:Hl},{default:p(()=>[...l[66]||(l[66]=[m("保存",-1)])]),_:1})]),default:p(()=>[c(el,{model:ml,"label-width":"100px"},{default:p(()=>[c(Ze,{label:"跟进时间",required:""},{default:p(()=>[c(al,{modelValue:ml.followUpTime,"onUpdate:modelValue":l[18]||(l[18]=e=>ml.followUpTime=e),type:"datetime",placeholder:"选择跟进时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),c(Ze,{label:"跟进内容",required:""},{default:p(()=>[c(Xe,{modelValue:ml.content,"onUpdate:modelValue":l[19]||(l[19]=e=>ml.content=e),type:"textarea",rows:6,placeholder:"请输入跟进内容",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]);var yl}}}),[["__scopeId","data-v-310de993"]]);export{Ze as default};
