const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/department-CjUKIEbz.js","assets/settings-CuxbDWOu.js","assets/elementPlus-Bmwh7Rh8.js","assets/vendor-D8Vxqhr-.js","assets/utils-ywHRn0uI.js","assets/settings-B8JH4JCn.css"])))=>i.map(i=>d[i]);
var Y=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var x=(s,u,i)=>u in s?Y(s,u,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[u]=i,_=(s,u)=>{for(var i in u||(u={}))te.call(u,i)&&x(s,i,u[i]);if(O)for(var i of O(u))ae.call(u,i)&&x(s,i,u[i]);return s},g=(s,u)=>Z(s,ee(u));var l=(s,u,i)=>new Promise((d,n)=>{var D=v=>{try{y(i.next(v))}catch(w){n(w)}},h=v=>{try{y(i.throw(v))}catch(w){n(w)}},y=v=>v.done?d(v.value):Promise.resolve(v.value).then(D,h);y((i=i.apply(s,u)).next())});import{K as re,a as m}from"./settings-CuxbDWOu.js";import{r as f,e as P}from"./vendor-D8Vxqhr-.js";import"./elementPlus-Bmwh7Rh8.js";import"./utils-ywHRn0uI.js";const ce=re("department",()=>{const s=f([]),u=f([]),i=f([]),d=f([]),n=f(!1),D=f({totalDepartments:0,activeDepartments:0,totalMembers:0,departmentsByType:{}}),h=P(()=>D.value.totalDepartments>0?D.value:{totalDepartments:s.value.length,activeDepartments:s.value.filter(e=>e.status==="active").length,totalMembers:u.value.filter(e=>e.status==="active").length,departmentsByType:s.value.reduce((e,t)=>{const a=t.parentId?"子部门":"主部门";return e[a]=(e[a]||0)+1,e},{})}),y=()=>{},v=P(()=>{const e=t=>s.value.filter(a=>a.parentId===t).sort((a,r)=>a.sort-r.sort).map(a=>g(_({},a),{children:e(a.id)}));return e(null)}),w=P(()=>s.value.sort((e,t)=>e.level!==t.level?e.level-t.level:e.sort-t.sort)),S=e=>s.value.find(t=>t.id===e),T=e=>u.value.filter(t=>t.departmentId===e),L=e=>l(void 0,null,function*(){n.value=!0;try{const{createDepartment:t}=yield m(()=>l(void 0,null,function*(){const{createDepartment:o}=yield import("./department-CjUKIEbz.js");return{createDepartment:o}}),__vite__mapDeps([0,1,2,3,4,5])),r=(yield t(e)).data;return s.value.push(r),r}catch(t){throw console.error("创建部门失败:",t),t}finally{n.value=!1}}),U=(e,t)=>l(void 0,null,function*(){n.value=!0;try{const{updateDepartment:a}=yield m(()=>l(void 0,null,function*(){const{updateDepartment:p}=yield import("./department-CjUKIEbz.js");return{updateDepartment:p}}),__vite__mapDeps([0,1,2,3,4,5])),o=(yield a(e,t)).data,c=s.value.findIndex(p=>p.id===e);return c!==-1&&(s.value[c]=o),o}catch(a){throw console.error("更新部门失败:",a),a}finally{n.value=!1}}),V=(e,t)=>l(void 0,null,function*(){n.value=!0;try{const{updateDepartmentStatus:a}=yield m(()=>l(void 0,null,function*(){const{updateDepartmentStatus:p}=yield import("./department-CjUKIEbz.js");return{updateDepartmentStatus:p}}),__vite__mapDeps([0,1,2,3,4,5])),o=(yield a(e,t)).data,c=s.value.findIndex(p=>p.id===e);return c!==-1&&(s.value[c]=o),o}catch(a){throw console.error("更新部门状态失败:",a),a}finally{n.value=!1}}),C=e=>l(void 0,null,function*(){n.value=!0;try{const{deleteDepartment:t}=yield m(()=>l(void 0,null,function*(){const{deleteDepartment:r}=yield import("./department-CjUKIEbz.js");return{deleteDepartment:r}}),__vite__mapDeps([0,1,2,3,4,5]));yield t(e);const a=s.value.findIndex(r=>r.id===e);return a!==-1?(s.value.splice(a,1),u.value=u.value.filter(r=>r.departmentId!==e),!0):!1}catch(t){throw console.error("删除部门失败:",t),t}finally{n.value=!1}}),B=(e,t,a)=>l(void 0,null,function*(){var r;n.value=!0;try{const o=s.value.find(c=>c.id===e);o&&(o.parentId=t,o.sort=a,o.level=t?(((r=S(t))==null?void 0:r.level)||0)+1:1,o.updatedAt=new Date().toISOString())}finally{n.value=!1}}),$=e=>l(void 0,null,function*(){n.value=!0;try{const{addDepartmentMember:t}=yield m(()=>l(void 0,null,function*(){const{addDepartmentMember:c}=yield import("./department-CjUKIEbz.js");return{addDepartmentMember:c}}),__vite__mapDeps([0,1,2,3,4,5])),r=(yield t(e.departmentId,e.userId,e.role)).data;u.value.push(r);const o=s.value.find(c=>c.id===e.departmentId);return o&&(o.memberCount=(o.memberCount||0)+1),r}catch(t){throw console.error("添加部门成员失败:",t),t}finally{n.value=!1}}),k=(e,t)=>l(void 0,null,function*(){n.value=!0;try{const{removeDepartmentMember:a}=yield m(()=>l(void 0,null,function*(){const{removeDepartmentMember:o}=yield import("./department-CjUKIEbz.js");return{removeDepartmentMember:o}}),__vite__mapDeps([0,1,2,3,4,5]));yield a(e,t);const r=u.value.findIndex(o=>o.departmentId===e&&o.userId===t);if(r!==-1){u.value.splice(r,1);const o=s.value.find(c=>c.id===e);return o&&o.memberCount>0&&(o.memberCount-=1),!0}return!1}catch(a){throw console.error("移除部门成员失败:",a),a}finally{n.value=!1}}),F=(e,t)=>l(void 0,null,function*(){n.value=!0;try{const a=s.value.find(r=>r.id===e);a&&(a.permissions=[...t],a.updatedAt=new Date().toISOString())}finally{n.value=!1}}),K=e=>l(void 0,null,function*(){n.value=!0;try{e.forEach(t=>{const a=s.value.find(r=>r.id===t.id);a&&(a.permissions=[...t.permissions],a.updatedAt=new Date().toISOString())})}finally{n.value=!1}}),N=(e,t)=>l(void 0,null,function*(){n.value=!0;try{const a=s.value.find(r=>r.id===e);if(a){const r=[...a.permissions];t.forEach(o=>{const c=s.value.find(p=>p.id===o);c&&(c.permissions=[...r],c.updatedAt=new Date().toISOString())})}}finally{n.value=!1}}),j=()=>{const e={totalPermissions:0,departmentPermissions:{},permissionUsage:{}};return s.value.forEach(t=>{e.totalPermissions+=t.permissions.length,e.departmentPermissions[t.id]=t.permissions.length,t.permissions.forEach(a=>{e.permissionUsage[a]=(e.permissionUsage[a]||0)+1})}),e},q=e=>i.value.find(t=>t.id===e),z=e=>i.value.filter(t=>t.departmentId===e),A=e=>d.value.filter(t=>t.roleId===e),G=e=>l(void 0,null,function*(){n.value=!0;try{const t=S(e.departmentId),a=g(_({},e),{id:Date.now().toString(),departmentName:(t==null?void 0:t.name)||"",userCount:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});return i.value.push(a),a}finally{n.value=!1}}),H=(e,t)=>l(void 0,null,function*(){n.value=!0;try{const a=i.value.findIndex(r=>r.id===e);if(a!==-1)return i.value[a]=g(_(_({},i.value[a]),t),{updatedAt:new Date().toISOString()}),i.value[a];throw new Error("角色不存在")}finally{n.value=!1}}),J=e=>l(void 0,null,function*(){n.value=!0;try{const t=i.value.findIndex(a=>a.id===e);t!==-1&&(d.value=d.value.filter(a=>a.roleId!==e),i.value.splice(t,1))}finally{n.value=!1}}),Q=(e,t,a,r="admin")=>l(void 0,null,function*(){n.value=!0;try{if(d.value.find(I=>I.roleId===e&&I.userId===t))throw new Error("用户已分配到该角色");const c={id:Date.now().toString(),userId:t,userName:a,roleId:e,assignedAt:new Date().toISOString(),assignedBy:r};d.value.push(c);const p=i.value.find(I=>I.id===e);return p&&(p.userCount=A(e).length),c}finally{n.value=!1}}),W=(e,t)=>l(void 0,null,function*(){n.value=!0;try{const a=d.value.findIndex(r=>r.roleId===e&&r.userId===t);if(a!==-1){d.value.splice(a,1);const r=i.value.find(o=>o.id===e);r&&(r.userCount=A(e).length)}}finally{n.value=!1}}),X=(e,t)=>l(void 0,null,function*(){n.value=!0;try{e.forEach(a=>{const r=i.value.find(o=>o.id===a);r&&(r.permissions=[...t],r.updatedAt=new Date().toISOString())})}finally{n.value=!1}}),R=()=>l(void 0,null,function*(){n.value=!0;try{const{getDepartmentList:e}=yield m(()=>l(void 0,null,function*(){const{getDepartmentList:a}=yield import("./department-CjUKIEbz.js");return{getDepartmentList:a}}),__vite__mapDeps([0,1,2,3,4,5])),t=yield e();s.value=t.data||[]}catch(e){console.error("获取部门列表失败:",e),s.value=[]}finally{n.value=!1}}),E=()=>l(void 0,null,function*(){try{const{getDepartmentStats:e}=yield m(()=>l(void 0,null,function*(){const{getDepartmentStats:a}=yield import("./department-CjUKIEbz.js");return{getDepartmentStats:a}}),__vite__mapDeps([0,1,2,3,4,5])),t=yield e();t.data&&(D.value=t.data,console.log("[DepartmentStore] 统计数据已更新:",t.data))}catch(e){console.error("获取部门统计数据失败:",e)}}),b=()=>l(void 0,null,function*(){n.value=!0;try{const{getDepartmentMembers:e}=yield m(()=>l(void 0,null,function*(){const{getDepartmentMembers:a}=yield import("./department-CjUKIEbz.js");return{getDepartmentMembers:a}}),__vite__mapDeps([0,1,2,3,4,5])),t=[];for(const a of s.value)try{const r=yield e(a.id);t.push(...r.data||[])}catch(r){console.warn(`获取部门 ${a.name} 成员失败:`,r)}u.value=t}catch(e){console.error("获取部门成员失败:",e),u.value=[]}finally{n.value=!1}}),M=()=>l(void 0,null,function*(){n.value=!0;try{const{getDepartmentRoles:e}=yield m(()=>l(void 0,null,function*(){const{getDepartmentRoles:a}=yield import("./department-CjUKIEbz.js");return{getDepartmentRoles:a}}),__vite__mapDeps([0,1,2,3,4,5])),t=[];for(const a of s.value)try{const r=yield e(a.id);t.push(...r.data||[])}catch(r){console.warn(`获取部门 ${a.name} 角色失败:`,r)}i.value=t}catch(e){console.error("获取部门角色失败:",e),i.value=[]}finally{n.value=!1}});return{departments:s,members:u,roles:i,roleUsers:d,loading:n,stats:h,departmentTree:v,departmentList:w,getDepartmentById:S,getDepartmentMembers:T,addDepartment:L,updateDepartment:U,updateDepartmentStatus:V,deleteDepartment:C,moveDepartment:B,addDepartmentMember:$,removeDepartmentMember:k,updateDepartmentPermissions:F,batchUpdatePermissions:K,copyPermissions:N,getPermissionStats:j,getRoleById:q,getRolesByDepartment:z,getRoleUsers:A,addRole:G,updateRole:H,deleteRole:J,assignUserToRole:Q,removeUserFromRole:W,batchUpdateRolePermissions:X,fetchDepartments:R,fetchDepartmentMembers:b,fetchDepartmentRoles:M,fetchDepartmentStats:E,initData:()=>l(void 0,null,function*(){yield R(),yield b(),yield M(),yield E()}),initMockData:y}});export{ce as useDepartmentStore};
