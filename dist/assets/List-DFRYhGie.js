var W=(f,T,M)=>new Promise((q,E)=>{var Q=_=>{try{b(M.next(_))}catch(S){E(S)}},U=_=>{try{b(M.throw(_))}catch(S){E(S)}},b=_=>_.done?q(_.value):Promise.resolve(_.value).then(Q,U);b((M=M.apply(f,T)).next())});import{l as we,e as R,r as A,ag as p,M as h,p as u,O as s,m as k,Q as g,q as t,U as a,S as r,u as v,T as d,F as X,a9 as ne,Z as Le,w as he,az as St,c as xt,J as Ie}from"./vendor-D8Vxqhr-.js";import{S as De,_ as Ce,u as qe,c as zt}from"./settings-CuxbDWOu.js";import{F as ke,l as Ee,a4 as It,az as Pe,a0 as le,aA as je,aB as Ue,E as C,C as Ne,c as Nt,q as Mt,s as Ut,v as Lt,K as Ot,a1 as Qe,h as Rt,aC as Bt,D as Ft,T as qt,a6 as Pt,P as Qt,a5 as Et,b as Me}from"./elementPlus-Bmwh7Rh8.js";import{u as He}from"./data-D5rIftf7.js";import{useDepartmentStore as jt}from"./department-CTOju6hT.js";import{a as Te}from"./sensitiveInfo-BWt1a88R.js";import{T as Ht,D as Kt}from"./DynamicTable-CiyMIP8-.js";import"./utils-ywHRn0uI.js";const Jt={key:0,class:"customer-detail-content"},Wt={class:"detail-section"},Yt={class:"section-title"},Zt={class:"info-grid"},Gt={class:"info-item"},Xt={class:"value"},ea={class:"info-item"},ta={class:"value"},aa={class:"info-item"},sa={class:"value amount"},la={class:"info-item"},na={class:"value"},oa={class:"info-item"},ia={class:"value"},ra={class:"info-item"},ua={key:0,class:"info-item"},da={class:"value"},ca={class:"info-item"},ma={class:"value"},pa={class:"info-item"},va={class:"value"},ga={class:"info-item full-width"},fa={class:"value"},_a={key:1,class:"info-item full-width"},ha={class:"value"},ya={key:2,class:"info-item full-width"},ba={class:"value"},ka={key:0,class:"detail-section"},wa={class:"section-title"},Da={class:"archive-info"},Ca={class:"archive-item"},Ta={class:"value"},$a={class:"archive-item"},Va={class:"value"},Aa={class:"archive-item"},Sa={class:"value"},xa={class:"archive-item"},za={class:"value"},Ia={class:"archive-item full-width"},Na={class:"value"},Ma={class:"detail-section"},Ua={class:"section-title"},La={class:"order-info"},Oa={class:"order-item"},Ra={class:"value"},Ba={class:"order-item"},Fa={class:"value"},qa={class:"order-item"},Pa={class:"value"},Qa={class:"order-item"},Ea={class:"value"},ja={class:"action-section"},Ha={class:"section-title"},Ka={class:"action-buttons"},Ja={class:"operation-history"},Wa={class:"collapse-title"},Ya={key:0,class:"latest-record"},Za={class:"history-list"},Ga={class:"history-header"},Xa={class:"history-time"},es={class:"history-content"},ts={class:"history-operator"},as={key:0,class:"department"},ss={key:0,class:"history-target"},ls={key:0,class:"department"},ns={key:1,class:"history-reason"},os={key:2,class:"history-remark"},is=we({__name:"CustomerDetailDialog",props:{modelValue:{type:Boolean},customerData:{}},emits:["update:modelValue","quick-assign","quick-archive","quick-recover","quick-reassign"],setup(f,{emit:T}){const M=f,q=T,E=R({get:()=>M.modelValue,set:D=>q("update:modelValue",D)}),Q=A([]),U=R(()=>{var n;const D=((n=M.customerData)==null?void 0:n.operationRecords)||[];return D.length===0?null:D.reduce((c,x)=>new Date(x.createTime)>new Date(c.createTime)?x:c)}),b=D=>({assign:"分配",archive:"封存",recover:"回收",reassign:"重新分配"})[D]||D,_=D=>({assign:"success",archive:"warning",recover:"danger",reassign:"info"})[D]||"info",S=D=>D?new Date(D).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"暂无",j=()=>{q("update:modelValue",!1)},H=D=>({pending:"",assigned:"success",archived:"warning"})[D]||"",ae=D=>({pending:"待分配",assigned:"已分配",archived:"已封存",recovered:"已回收"})[D]||D,V=()=>{M.customerData&&q("quick-assign",M.customerData)},y=()=>{M.customerData&&q("quick-archive",M.customerData)},oe=()=>{M.customerData&&q("quick-recover",M.customerData)},I=()=>{M.customerData&&q("quick-reassign",M.customerData)};return(D,n)=>{const c=p("el-icon"),x=p("el-tag"),w=p("el-button"),B=p("el-collapse-item"),N=p("el-collapse"),ie=p("el-dialog");return u(),h(ie,{modelValue:E.value,"onUpdate:modelValue":n[1]||(n[1]=F=>E.value=F),title:"客户详情",width:"80%","before-close":j,class:"customer-detail-dialog",top:"5vh"},{footer:s(()=>[a(w,{onClick:j},{default:s(()=>[...n[33]||(n[33]=[r("关闭",-1)])]),_:1})]),default:s(()=>{var F;return[f.customerData?(u(),k("div",Jt,[t("div",Wt,[t("h3",Yt,[a(c,null,{default:s(()=>[a(v(ke))]),_:1}),n[2]||(n[2]=r(" 客户基本信息 ",-1))]),t("div",Zt,[t("div",Gt,[n[3]||(n[3]=t("label",null,"客户姓名：",-1)),t("span",Xt,d(f.customerData.customerName),1)]),t("div",ea,[n[4]||(n[4]=t("label",null,"联系电话：",-1)),t("span",ta,d(v(Te)(f.customerData.phone,v(De).PHONE)),1)]),t("div",aa,[n[5]||(n[5]=t("label",null,"订单金额：",-1)),t("span",sa,"¥"+d((F=f.customerData.orderAmount)==null?void 0:F.toLocaleString()),1)]),t("div",la,[n[6]||(n[6]=t("label",null,"下单日期：",-1)),t("span",na,d(f.customerData.orderDate),1)]),t("div",oa,[n[7]||(n[7]=t("label",null,"签收日期：",-1)),t("span",ia,d(f.customerData.signDate),1)]),t("div",ra,[n[8]||(n[8]=t("label",null,"当前状态：",-1)),a(x,{type:H(f.customerData.status)},{default:s(()=>[r(d(ae(f.customerData.status)),1)]),_:1},8,["type"])]),f.customerData.status==="assigned"||f.customerData.status==="archived"?(u(),k("div",ua,[n[9]||(n[9]=t("label",null,"操作人：",-1)),t("span",da,d(f.customerData.operatorName||"未知"),1)])):g("",!0),t("div",ca,[n[10]||(n[10]=t("label",null,"归属人：",-1)),t("span",ma,d(f.customerData.createdByName||"未知"),1)]),t("div",pa,[n[11]||(n[11]=t("label",null,"创建时间：",-1)),t("span",va,d(S(f.customerData.createTime)),1)]),t("div",ga,[n[12]||(n[12]=t("label",null,"收货地址：",-1)),t("span",fa,d(f.customerData.address),1)]),f.customerData.remark?(u(),k("div",_a,[n[13]||(n[13]=t("label",null,"备注信息：",-1)),t("span",ha,d(f.customerData.remark),1)])):g("",!0),f.customerData.isReassigned?(u(),k("div",ya,[n[15]||(n[15]=t("label",null,"重新分配：",-1)),t("span",ba,[a(x,{type:"warning",size:"small"},{default:s(()=>[...n[14]||(n[14]=[r("已重新分配",-1)])]),_:1})])])):g("",!0)])]),f.customerData.archiveInfo?(u(),k("div",ka,[t("h3",wa,[a(c,null,{default:s(()=>[a(v(Ee))]),_:1}),n[16]||(n[16]=r(" 封存信息 ",-1))]),t("div",Da,[t("div",Ca,[n[17]||(n[17]=t("label",null,"封存时长：",-1)),t("span",Ta,d(f.customerData.archiveInfo.duration),1)]),t("div",$a,[n[18]||(n[18]=t("label",null,"封存原因：",-1)),t("span",Va,d(f.customerData.archiveInfo.reason),1)]),t("div",Aa,[n[19]||(n[19]=t("label",null,"封存时间：",-1)),t("span",Sa,d(S(f.customerData.archiveInfo.archiveTime)),1)]),t("div",xa,[n[20]||(n[20]=t("label",null,"预计解封：",-1)),t("span",za,d(S(f.customerData.archiveInfo.unarchiveTime)),1)]),t("div",Ia,[n[21]||(n[21]=t("label",null,"封存备注：",-1)),t("span",Na,d(f.customerData.archiveInfo.remark),1)])])])):g("",!0),t("div",Ma,[t("h3",Ua,[a(c,null,{default:s(()=>[a(v(It))]),_:1}),n[22]||(n[22]=r(" 订单信息 ",-1))]),t("div",La,[t("div",Oa,[n[23]||(n[23]=t("label",null,"订单号：",-1)),t("span",Ra,d(f.customerData.orderNo),1)]),t("div",Ba,[n[24]||(n[24]=t("label",null,"物流单号：",-1)),t("span",Fa,d(f.customerData.trackingNo||"暂无"),1)]),t("div",qa,[n[25]||(n[25]=t("label",null,"创建时间：",-1)),t("span",Pa,d(S(f.customerData.createTime)),1)]),t("div",Qa,[n[26]||(n[26]=t("label",null,"更新时间：",-1)),t("span",Ea,d(S(f.customerData.updateTime)),1)])])]),t("div",ja,[t("h3",Ha,[a(c,null,{default:s(()=>[a(v(Pe))]),_:1}),n[27]||(n[27]=r(" 快捷操作 ",-1))]),t("div",Ka,[f.customerData.status==="pending"?(u(),h(w,{key:0,type:"success",onClick:V,icon:v(le)},{default:s(()=>[...n[28]||(n[28]=[r(" 分配 ",-1)])]),_:1},8,["icon"])):g("",!0),f.customerData.status!=="archived"?(u(),h(w,{key:1,type:"danger",onClick:y,icon:v(je)},{default:s(()=>[...n[29]||(n[29]=[r(" 封存 ",-1)])]),_:1},8,["icon"])):g("",!0),f.customerData.status==="archived"?(u(),h(w,{key:2,type:"info",onClick:I,icon:v(Ue)},{default:s(()=>[...n[30]||(n[30]=[r(" 重新分配 ",-1)])]),_:1},8,["icon"])):g("",!0),f.customerData.status!=="pending"?(u(),h(w,{key:3,type:"warning",onClick:oe,icon:v(Ue)},{default:s(()=>[...n[31]||(n[31]=[r(" 回收 ",-1)])]),_:1},8,["icon"])):g("",!0)])])])):g("",!0),t("div",Ja,[a(N,{modelValue:Q.value,"onUpdate:modelValue":n[0]||(n[0]=P=>Q.value=P)},{default:s(()=>[a(B,{title:"操作轨迹记录",name:"history"},{title:s(()=>[t("div",Wa,[a(c,null,{default:s(()=>[a(v(Pe))]),_:1}),n[32]||(n[32]=t("span",null,"操作轨迹记录",-1)),U.value?(u(),k("span",Ya," （最新："+d(U.value.operatorName)+" "+d(b(U.value.type))+" - "+d(S(U.value.createTime))+"） ",1)):g("",!0)])]),default:s(()=>{var P;return[t("div",Za,[(u(!0),k(X,null,ne(((P=f.customerData)==null?void 0:P.operationRecords)||[],L=>(u(),k("div",{key:L.id,class:"history-item"},[t("div",Ga,[a(x,{type:_(L.type),size:"small"},{default:s(()=>[r(d(b(L.type)),1)]),_:2},1032,["type"]),t("span",Xa,d(S(L.createTime)),1)]),t("div",es,[t("div",ts,[a(c,null,{default:s(()=>[a(v(ke))]),_:1}),t("span",null,"操作人："+d(L.operatorName),1),L.operatorDepartment?(u(),k("span",as,"（"+d(L.operatorDepartment)+"）",1)):g("",!0)]),L.targetUserId?(u(),k("div",ss,[a(c,null,{default:s(()=>[a(v(le))]),_:1}),t("span",null,"目标："+d(L.targetUserName),1),L.targetUserDepartment?(u(),k("span",ls,"（"+d(L.targetUserDepartment)+"）",1)):g("",!0)])):g("",!0),L.reason?(u(),k("div",ns,[t("span",null,"原因："+d(L.reason),1)])):g("",!0),L.remark?(u(),k("div",os,[t("span",null,"备注："+d(L.remark),1)])):g("",!0)])]))),128))])]}),_:1})]),_:1},8,["modelValue"])])]}),_:1},8,["modelValue"])}}}),rs=Ce(is,[["__scopeId","data-v-e6f604de"]]),us={class:"archive-dialog-content"},ds={class:"archive-info"},cs={key:0,class:"customer-info"},ms={class:"info-row"},ps={class:"value"},vs={class:"info-row"},gs={class:"value"},fs={class:"info-row"},_s={class:"value"},hs=we({__name:"ArchiveDialog",props:{modelValue:{type:Boolean},customerData:{}},emits:["update:modelValue","confirm"],setup(f,{emit:T}){const M=f,q=T,E=A(),Q=A(!1),U=R({get:()=>M.modelValue,set:V=>q("update:modelValue",V)}),b=Le({duration:"",reason:"",remark:""}),_={duration:[{required:!0,message:"请选择封存时长",trigger:"change"}],reason:[{required:!0,message:"请选择封存原因",trigger:"change"}],remark:[{required:!0,message:"请填写备注说明",trigger:"blur"},{min:10,message:"备注说明至少10个字符",trigger:"blur"}]},S=()=>{if(!b.duration)return"";const V=new Date;let y;switch(b.duration){case"1day":y=new Date(V.getTime()+24*60*60*1e3);break;case"7days":y=new Date(V.getTime()+7*24*60*60*1e3);break;case"15days":y=new Date(V.getTime()+15*24*60*60*1e3);break;case"30days":y=new Date(V.getTime()+30*24*60*60*1e3);break;case"1year":y=new Date(V.getTime()+365*24*60*60*1e3);break;default:return"永久封存"}return y.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},j=()=>{var V;b.duration="",b.reason="",b.remark="",(V=E.value)==null||V.clearValidate()},H=()=>{U.value=!1,j()},ae=()=>W(this,null,function*(){if(E.value)try{yield E.value.validate(),Q.value=!0;const V={duration:b.duration,reason:b.reason,remark:b.remark,unarchiveTime:b.duration!=="permanent"?S():void 0};q("confirm",V),C.success("封存成功"),H()}catch(V){console.error("表单验证失败:",V)}finally{Q.value=!1}});return he(()=>M.modelValue,V=>{V&&j()}),(V,y)=>{const oe=p("el-alert"),I=p("el-option"),D=p("el-select"),n=p("el-form-item"),c=p("el-input"),x=p("el-text"),w=p("el-form"),B=p("el-divider"),N=p("el-button"),ie=p("el-dialog");return u(),h(ie,{modelValue:U.value,"onUpdate:modelValue":y[3]||(y[3]=F=>U.value=F),title:"封存客户资料",width:"500px","close-on-click-modal":!1,onClose:H},{footer:s(()=>[a(N,{onClick:H},{default:s(()=>[...y[9]||(y[9]=[r("取消",-1)])]),_:1}),a(N,{type:"danger",onClick:ae,loading:Q.value},{default:s(()=>[...y[10]||(y[10]=[r(" 确认封存 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[t("div",us,[t("div",ds,[a(oe,{title:"封存说明",type:"warning",closable:!1,"show-icon":""},{default:s(()=>[...y[4]||(y[4]=[t("p",null,'封存后的客户资料将从当前列表中移除，在指定时间后自动重新出现在未分配列表中，并标记为"重新分配"状态。',-1)])]),_:1})]),a(w,{ref_key:"formRef",ref:E,model:b,rules:_,"label-width":"100px",class:"archive-form"},{default:s(()=>[a(n,{label:"封存时长",prop:"duration"},{default:s(()=>[a(D,{modelValue:b.duration,"onUpdate:modelValue":y[0]||(y[0]=F=>b.duration=F),placeholder:"请选择封存时长",style:{width:"100%"}},{default:s(()=>[a(I,{label:"1天",value:"1day"}),a(I,{label:"7天",value:"7days"}),a(I,{label:"15天",value:"15days"}),a(I,{label:"30天",value:"30days"}),a(I,{label:"1年",value:"1year"}),a(I,{label:"永久封存",value:"permanent"})]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"封存原因",prop:"reason"},{default:s(()=>[a(D,{modelValue:b.reason,"onUpdate:modelValue":y[1]||(y[1]=F=>b.reason=F),placeholder:"请选择封存原因",style:{width:"100%"}},{default:s(()=>[a(I,{label:"客户暂时无需求",value:"no_demand"}),a(I,{label:"客户预算不足",value:"insufficient_budget"}),a(I,{label:"客户决策周期长",value:"long_decision_cycle"}),a(I,{label:"竞争对手已成交",value:"competitor_deal"}),a(I,{label:"客户信息不准确",value:"inaccurate_info"}),a(I,{label:"其他原因",value:"other"})]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"备注说明",prop:"remark"},{default:s(()=>[a(c,{modelValue:b.remark,"onUpdate:modelValue":y[2]||(y[2]=F=>b.remark=F),type:"textarea",placeholder:"请详细说明封存原因，此信息将在客户重新分配时显示（必填）",rows:4,maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),b.duration!=="permanent"?(u(),h(n,{key:0,label:"预计解封时间"},{default:s(()=>[a(x,{type:"info"},{default:s(()=>[r(d(S()),1)]),_:1})]),_:1})):g("",!0)]),_:1},8,["model"]),f.customerData?(u(),k("div",cs,[a(B,{"content-position":"left"},{default:s(()=>[...y[5]||(y[5]=[r("客户信息",-1)])]),_:1}),t("div",ms,[y[6]||(y[6]=t("span",{class:"label"},"客户姓名：",-1)),t("span",ps,d(f.customerData.customerName),1)]),t("div",vs,[y[7]||(y[7]=t("span",{class:"label"},"联系电话：",-1)),t("span",gs,d(v(Te)(f.customerData.phone,v(De).PHONE)),1)]),t("div",fs,[y[8]||(y[8]=t("span",{class:"label"},"订单金额：",-1)),t("span",_s,"¥"+d(f.customerData.orderAmount.toLocaleString()),1)])])):g("",!0)])]),_:1},8,["modelValue"])}}}),ys=Ce(hs,[["__scopeId","data-v-a3f54651"]]),bs={class:"assign-content"},ks={class:"info-section"},ws={class:"assignment-section"},Ds={class:"preview-section"},Cs={class:"custom-assign-section"},Ts={class:"member-name"},$s={class:"current-count"},Vs={class:"assign-summary"},As={class:"data-list-section"},Ss={class:"dialog-footer"},xs=we({__name:"LeaderAssignDialog",props:{modelValue:{type:Boolean},pendingData:{},departmentId:{},departmentName:{}},emits:["update:modelValue","assigned"],setup(f,{emit:T}){const M=f,q=T,E=He(),Q=R({get:()=>M.modelValue,set:n=>q("update:modelValue",n)}),U=R(()=>M.pendingData||[]),b=A([{id:"1",name:"张三",assignmentCount:5},{id:"2",name:"李四",assignmentCount:3},{id:"3",name:"王五",assignmentCount:7},{id:"4",name:"赵六",assignmentCount:2}]),_=Le({assignType:"roundrobin",assignTo:"",remark:""}),S=A({}),j=A(!1),H=()=>{const n={};b.value.forEach(c=>{n[c.id]=0}),S.value=n},ae=R(()=>{if(_.assignType!=="roundrobin")return[];const n=[...b.value].sort((w,B)=>w.assignmentCount-B.assignmentCount),c=U.value.length,x=n.length;return n.map((w,B)=>{const N=Math.floor(c/x)+(B<c%x?1:0);return{memberName:w.name,currentCount:w.assignmentCount,willAssign:N,totalAfter:w.assignmentCount+N}})}),V=R(()=>Object.values(S.value).reduce((n,c)=>n+c,0)),y=R(()=>_.assignType==="specific"?!!_.assignTo:_.assignType==="custom"?V.value===U.value.length:!0),oe=n=>new Date(n).toLocaleDateString(),I=()=>W(this,null,function*(){try{j.value=!0;let n=[];if(_.assignType==="specific"){const c=b.value.find(x=>x.id===_.assignTo);if(!c){C.error("请选择有效的部门成员");return}n=U.value.map(x=>({dataId:x.id,assigneeId:c.id,assigneeName:c.name}))}else if(_.assignType==="roundrobin"){const c=[...b.value].sort((x,w)=>x.assignmentCount-w.assignmentCount);n=U.value.map((x,w)=>{const B=w%c.length,N=c[B];return{dataId:x.id,assigneeId:N.id,assigneeName:N.name}})}else{let c=0;for(const[x,w]of Object.entries(S.value)){const B=b.value.find(N=>N.id===x);if(B&&w>0)for(let N=0;N<w;N++)c<U.value.length&&(n.push({dataId:U.value[c].id,assigneeId:B.id,assigneeName:B.name}),c++)}}yield E.batchAssignData({dataIds:n.map(c=>c.dataId),assigneeId:n[0].assigneeId,assigneeName:n[0].assigneeName,remark:_.remark}),C.success(`成功分配 ${n.length} 条资料`),q("assigned"),D()}catch(n){C.error("分配失败")}finally{j.value=!1}}),D=()=>{Q.value=!1,_.assignType="roundrobin",_.assignTo="",_.remark="",H()};return he(Q,n=>{n&&H()}),(n,c)=>{const x=p("el-alert"),w=p("el-radio"),B=p("el-radio-group"),N=p("el-form-item"),ie=p("el-option"),F=p("el-select"),P=p("el-table-column"),L=p("el-table"),$=p("el-input-number"),ee=p("el-text"),ye=p("el-input"),ce=p("el-form"),me=p("el-divider"),be=p("el-button"),$e=p("el-dialog");return u(),h($e,{modelValue:Q.value,"onUpdate:modelValue":c[3]||(c[3]=i=>Q.value=i),title:"部门负责人分配",width:"600px","close-on-click-modal":!1,onClose:D},{footer:s(()=>[t("div",Ss,[a(be,{onClick:D},{default:s(()=>[...c[11]||(c[11]=[r("取消",-1)])]),_:1}),a(be,{type:"primary",onClick:I,loading:j.value,disabled:!y.value},{default:s(()=>[...c[12]||(c[12]=[r(" 确认分配 ",-1)])]),_:1},8,["loading","disabled"])])]),default:s(()=>[t("div",bs,[t("div",ks,[a(x,{title:"分配说明",type:"info",closable:!1,"show-icon":""},{default:s(()=>[t("p",null,[c[4]||(c[4]=r("您有 ",-1)),t("strong",null,d(U.value.length),1),c[5]||(c[5]=r(" 条待分配的客户资料",-1))]),c[6]||(c[6]=t("p",null,"请选择部门成员进行分配，系统将按轮流方式确保公平分配",-1))]),_:1})]),t("div",ws,[a(ce,{model:_,"label-width":"100px"},{default:s(()=>[a(N,{label:"分配方式"},{default:s(()=>[a(B,{modelValue:_.assignType,"onUpdate:modelValue":c[0]||(c[0]=i=>_.assignType=i)},{default:s(()=>[a(w,{value:"roundrobin"},{default:s(()=>[...c[7]||(c[7]=[r("轮流分配",-1)])]),_:1}),a(w,{value:"specific"},{default:s(()=>[...c[8]||(c[8]=[r("指定成员",-1)])]),_:1}),a(w,{value:"custom"},{default:s(()=>[...c[9]||(c[9]=[r("自定义分配",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),_.assignType==="specific"?(u(),h(N,{key:0,label:"选择成员"},{default:s(()=>[a(F,{modelValue:_.assignTo,"onUpdate:modelValue":c[1]||(c[1]=i=>_.assignTo=i),placeholder:"选择部门成员",style:{width:"100%"}},{default:s(()=>[(u(!0),k(X,null,ne(b.value,i=>(u(),h(ie,{key:i.id,label:`${i.name} (已分配: ${i.assignmentCount}条)`,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),_.assignType==="roundrobin"?(u(),h(N,{key:1,label:"分配预览"},{default:s(()=>[t("div",Ds,[a(L,{data:ae.value,size:"small","max-height":"200px"},{default:s(()=>[a(P,{prop:"memberName",label:"成员",width:"120"}),a(P,{prop:"currentCount",label:"当前分配",width:"80"}),a(P,{prop:"willAssign",label:"将分配",width:"80"}),a(P,{prop:"totalAfter",label:"分配后总数",width:"100"})]),_:1},8,["data"])])]),_:1})):g("",!0),_.assignType==="custom"?(u(),h(N,{key:2,label:"自定义分配"},{default:s(()=>[t("div",Cs,[(u(!0),k(X,null,ne(b.value,i=>(u(),k("div",{key:i.id,class:"member-assign-item"},[t("span",Ts,d(i.name),1),a($,{modelValue:S.value[i.id],"onUpdate:modelValue":Z=>S.value[i.id]=Z,min:0,max:U.value.length,size:"small",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue","max"]),t("span",$s,"当前: "+d(i.assignmentCount)+"条",1)]))),128)),t("div",Vs,[a(ee,{type:"info"},{default:s(()=>[r(" 总计分配: "+d(V.value)+" / "+d(U.value.length),1)]),_:1})])])]),_:1})):g("",!0),a(N,{label:"备注"},{default:s(()=>[a(ye,{modelValue:_.remark,"onUpdate:modelValue":c[2]||(c[2]=i=>_.remark=i),type:"textarea",rows:3,placeholder:"请输入分配备注（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),t("div",As,[a(me,{"content-position":"left"},{default:s(()=>[...c[10]||(c[10]=[r("待分配资料列表",-1)])]),_:1}),a(L,{data:U.value,size:"small","max-height":"300px"},{default:s(()=>[a(P,{prop:"customerName",label:"客户姓名",width:"120"}),a(P,{prop:"phone",label:"联系电话",width:"130"},{default:s(({row:i})=>[r(d(v(Te)(i.phone,v(De).PHONE)),1)]),_:1}),a(P,{prop:"orderAmount",label:"订单金额",width:"100"},{default:s(({row:i})=>[r(" ¥"+d(i.orderAmount.toLocaleString()),1)]),_:1}),a(P,{prop:"orderDate",label:"下单时间",width:"100"},{default:s(({row:i})=>[r(d(oe(i.orderDate)),1)]),_:1}),a(P,{prop:"source",label:"来源"})]),_:1},8,["data"])])])]),_:1},8,["modelValue"])}}}),zs=Ce(xs,[["__scopeId","data-v-929eba62"]]),Is={class:"data-list-container"},Ns={class:"page-header"},Ms={class:"header-content"},Us={class:"title-row"},Ls={class:"title-section"},Os={class:"page-title"},Rs={key:0,class:"leader-assign-alert"},Bs={class:"alert-content"},Fs={class:"summary-cards"},qs={class:"card-item"},Ps={class:"card-icon total"},Qs={class:"card-content"},Es={class:"card-number"},js={class:"card-item"},Hs={class:"card-icon pending"},Ks={class:"card-content"},Js={class:"card-number"},Ws={class:"card-item"},Ys={class:"card-icon assigned"},Zs={class:"card-content"},Gs={class:"card-number"},Xs={class:"card-item"},el={class:"card-icon amount"},tl={class:"card-content"},al={class:"card-number"},sl={class:"quick-filter-container"},ll={class:"quick-filters"},nl={class:"filter-buttons"},ol={class:"filter-content"},il={class:"search-filters"},rl={class:"list-section"},ul={class:"list-header"},dl={class:"header-top-row"},cl={class:"nav-tabs"},ml=["onClick"],pl={class:"tab-label"},vl={class:"tab-count"},gl={class:"header-actions"},fl={class:"batch-operations"},_l={class:"table-settings"},hl=["onClick","title"],yl={class:"amount"},bl={key:1,class:"self-created"},kl={class:"assign-dialog-content"},wl={class:"assign-info-section"},Dl={key:0},Cl={style:{color:"#E6A23C","margin-top":"5px"}},Tl={key:1},$l={key:0,style:{"margin-top":"8px"}},Vl={style:{"margin-top":"8px"}},Al={style:{"margin-top":"8px"}},Sl={class:"member-info"},xl={class:"member-main-info"},zl={class:"member-name"},Il={class:"member-details"},Nl={class:"member-department"},Ml={class:"member-phone"},Ul={key:0,class:"assign-preview-section"},Ll={class:"preview-header"},Ol={class:"header-content"},Rl={class:"target-info-compact"},Bl={class:"target-header-compact"},Fl={class:"target-title"},ql={key:0,class:"target-detail-compact"},Pl={class:"detail-item"},Ql={class:"detail-item"},El={key:0,class:"customer-preview"},jl={class:"preview-table-header"},Hl={class:"table-title"},Kl={class:"table-actions"},Jl={key:0,class:"more-data-tip"},Wl={key:1,class:"remark-preview"},Yl={class:"remark-header"},Zl={class:"remark-content"},Gl=we({__name:"List",setup(f){const T=He(),M=qe(),q=jt(),E=St(),Q=zt(E),U=R(()=>T.loading),b=A(!1),_=A(!1),S=A(!1),j=A(!1),H=A(!1),ae=A(null),V=A(null),y=A([]),oe=A(),I=R(()=>{const l=T.filteredDataList;return{totalCount:l.length,pendingCount:l.filter(e=>e.status==="pending").length,assignedCount:l.filter(e=>e.status==="assigned").length,archivedCount:l.filter(e=>e.status==="archived").length,recoveredCount:l.filter(e=>e.status==="recovered").length,totalAmount:l.reduce((e,m)=>e+m.orderAmount,0),todayCount:l.filter(e=>{const m=new Date().toDateString();return new Date(e.orderDate).toDateString()===m}).length,weekCount:l.filter(e=>{const m=new Date;return m.setDate(m.getDate()-7),new Date(e.orderDate)>=m}).length,monthCount:l.filter(e=>{const m=new Date;return m.setMonth(m.getMonth()-1),new Date(e.orderDate)>=m}).length}}),D=R(()=>M.isSuperAdmin),n=R(()=>M.isManager&&!D.value),c=R(()=>n.value&&y.value.length>0),x=A("today"),w=A(null),B=A(""),N=A(""),ie=[{label:"今日",value:"today"},{label:"昨日",value:"yesterday"},{label:"本周",value:"thisWeek"},{label:"近30天",value:"last30Days"},{label:"本月",value:"thisMonth"},{label:"今年",value:"thisYear"},{label:"全部",value:"all"}],F=A("pending"),P=R(()=>{const l=[{label:"待分配",value:"pending",count:I.value.pendingCount},{label:"已分配",value:"assigned",count:I.value.assignedCount}];return n.value&&!D.value?l:[...l,{label:"已封存",value:"archived",count:I.value.archivedCount},{label:"已回收",value:"recovered",count:I.value.recoveredCount}]});he(F,l=>{T.setFilters({status:l}),$.value=[]}),he(N,l=>{ee.value=1,T.setFilters({status:l})});const L=R(()=>T.filteredDataList),$=A([]),ee=A(1),ye=A(30),ce=A([]),me=[{prop:"customerCode",label:"客户编码",width:140,visible:!0,sortable:!0,showOverflowTooltip:!0},{prop:"customerName",label:"客户姓名",width:120,visible:!0,sortable:!0,showOverflowTooltip:!0},{prop:"phone",label:"手机号",width:130,visible:!0,sortable:!1,showOverflowTooltip:!0},{prop:"orderAmount",label:"订单金额",width:120,visible:!0,sortable:!0,showOverflowTooltip:!1},{prop:"orderDate",label:"下单日期",width:120,visible:!0,sortable:!0,showOverflowTooltip:!0},{prop:"signDate",label:"签收日期",width:120,visible:!0,sortable:!0,showOverflowTooltip:!0},{prop:"status",label:"状态",width:100,visible:!0,sortable:!0,showOverflowTooltip:!1,formatter:l=>Oe(l.status)},{prop:"allocationSource",label:"来源",width:80,visible:!0,sortable:!1,showOverflowTooltip:!1},{prop:"assigneeName",label:"归属人",width:120,visible:!0,sortable:!0,showOverflowTooltip:!0},{prop:"operatorName",label:"操作人",width:120,visible:!0,sortable:!0,showOverflowTooltip:!0},{prop:"assignDate",label:"分配时间",width:120,visible:!0,sortable:!0,showOverflowTooltip:!0}],be=R(()=>ce.value.length===0?me.filter(l=>l.visible):me.filter(l=>ce.value.includes(l.prop)));he([ee,ye],([l,e])=>{T.setPagination(l,e)});const $e=R(()=>T.total),i=Le({assignType:"specific",assignMode:"direct",assignTo:"",departmentId:"",crossDepartmentStrategy:"workload",selectedDepartments:[],remark:""}),Z=A(!1),te=R(()=>{var l;return $.value.length===1&&((l=$.value[0])==null?void 0:l.status)==="archived"});R(()=>T.assigneeOptions);const pe=A([]),Ve=A(!1),re=R(()=>q.departmentList),Ke=()=>{if(i.assignType==="roundrobin"){const l=re.value.find(e=>e.id===i.departmentId);return l?l.name:"请选择部门"}else if(i.assignType==="cross_department")if(i.crossDepartmentStrategy==="manual"){const l=re.value.filter(e=>i.selectedDepartments.includes(e.id));return l.length>0?l.map(e=>e.name).join("、"):"请选择部门"}else return"全部门智能分配";else if(i.assignType==="specific"){const l=ve.value.find(e=>e.id===i.assignTo);return l?`${l.name} (${l.department})`:"请选择成员"}return""},Je=()=>{switch(i.assignType){case"roundrobin":return"primary";case"specific":return"success";case"cross_department":return"warning";default:return"info"}},We=()=>{switch(i.assignType){case"roundrobin":return"轮流分配";case"specific":return"指定成员";case"cross_department":return"跨部门分配";default:return"未选择"}},Ye=()=>{const l=ve.value.find(e=>e.id===i.assignTo);return l?l.phone:""},Ze=()=>{const l=ve.value.find(e=>e.id===i.assignTo);return l?l.department:""},Ge=l=>{switch(l){case"pending":return"warning";case"assigned":return"success";case"archived":return"info";case"recovered":return"danger";default:return"info"}},Xe=l=>{const e=new Date(l);return`${e.getMonth()+1}/${e.getDate()}`},et=()=>{H.value=!0},tt=l=>{console.log("部门负责人分配确认:",l);const{assignments:e,assignType:m,customAssignments:z}=l;m==="roundrobin"?C.success(`已按轮流方式分配 ${e.length} 条资料`):m==="specific"?C.success(`已分配 ${e.length} 条资料给指定成员`):m==="custom"&&C.success(`已按自定义方式分配 ${z.length} 条资料`),y.value=[],H.value=!1,T.loadDataList()},at=()=>{if(!n.value||D.value){y.value=[];return}const l=[{id:"pending_1",customerName:"王五",phone:"13800138003",orderAmount:6500,orderDate:"2024-01-16",assignedAt:"2024-01-16 09:30:00",assignedBy:"系统管理员",departmentName:"销售一部"},{id:"pending_2",customerName:"赵六",phone:"13800138004",orderAmount:7200,orderDate:"2024-01-16",assignedAt:"2024-01-16 10:15:00",assignedBy:"系统管理员",departmentName:"销售一部"}],e=n.value;y.value=e?l:[]},st=()=>{x.value="";const l={};w.value&&(l.dateRange=Array.isArray(w.value)?w.value.map(e=>e.toISOString().split("T")[0]):[]),T.setFilters(l)},lt=l=>{x.value=l,w.value=null,T.setFilters({dateFilter:l})},nt=()=>{ee.value=1;const l={searchKeyword:B.value};w.value&&(l.dateRange=Array.isArray(w.value)?w.value.map(e=>e.toISOString().split("T")[0]):[]),T.setFilters(l)},ot=l=>{F.value=l,ee.value=1,$.value=[]},it=l=>{$.value=l},rt=l=>{ee.value=l},ut=()=>{ee.value=1},dt=({prop:l,order:e})=>{console.log("排序变化:",l,e)},ct=l=>{console.log("列设置变化:",l),ce.value=l.filter(e=>e.visible).map(e=>e.prop)},mt=l=>({pending:"",assigned:"success",archived:"warning",recovered:"info"})[l]||"",Oe=l=>({pending:"待分配",assigned:"已分配",archived:"已封存",recovered:"已回收"})[l]||l,pt=l=>{var z;const m=(z=qe().currentUser)==null?void 0:z.id;return l.createdBy&&l.createdBy!==m},vt=l=>{ae.value=l,S.value=!0},gt=l=>{l&&l!=="N/A"&&Q.push(`/customer/detail?code=${l}`)},ft=()=>{fe(),_.value=!0},Re=l=>{$.value=[l],fe(),_.value=!0},Ae=l=>{$.value=[l],i.assignType="specific",i.assignMode="direct",i.assignTo="",i.departmentId="",i.remark="",fe(),_.value=!0},Be=l=>W(this,null,function*(){try{yield Me.confirm("确认要回收这条客户资料吗？","确认操作",{type:"warning"}),yield T.recoverData(l.id),C.success("回收成功")}catch(e){e!=="cancel"&&C.error("回收失败")}}),Fe=l=>{V.value=l,j.value=!0},_t=l=>W(this,null,function*(){try{yield Me.confirm("确认要删除这条客户资料吗？删除后将移至回收站，30天后永久删除。","确认删除",{type:"warning",confirmButtonText:"确认删除",cancelButtonText:"取消"}),yield T.deleteData(l.id),C.success("删除成功，已移至回收站")}catch(e){e!=="cancel"&&C.error("删除失败")}}),ht=l=>W(this,null,function*(){if(V.value)try{yield T.archiveData({dataId:V.value.id,duration:l.duration,reason:l.reason,remark:l.remark,unarchiveTime:l.unarchiveTime}),C.success("封存成功"),j.value=!1,V.value=null}catch(e){C.error("封存失败")}}),ve=A([{id:"1",name:"张三",account:"zhangsan",department:"销售一部",phone:"13800138001",status:"active"},{id:"2",name:"李四",account:"lisi",department:"销售一部",phone:"13800138002",status:"active"},{id:"3",name:"王五",account:"wangwu",department:"销售二部",phone:"13800138003",status:"active"},{id:"4",name:"赵六",account:"zhaoliu",department:"销售二部",phone:"13800138004",status:"active"},{id:"5",name:"钱七",account:"qianqi",department:"销售三部",phone:"13800138005",status:"active"},{id:"6",name:"孙八",account:"sunba",department:"客服部",phone:"13800138006",status:"active"},{id:"7",name:"周九",account:"zhoujiu",department:"技术部",phone:"13800138007",status:"active"},{id:"8",name:"吴十",account:"wushi",department:"销售一部",phone:"13800138008",status:"active"},{id:"9",name:"郑十一",account:"zhengshiyi",department:"销售二部",phone:"13800138009",status:"active"},{id:"10",name:"王十二",account:"wangshier",department:"销售三部",phone:"13800138010",status:"active"},{id:"11",name:"李十三",account:"lishisan",department:"客服部",phone:"13800138011",status:"active"},{id:"12",name:"张十四",account:"zhangshisi",department:"技术部",phone:"13800138012",status:"active"}]),yt=l=>W(this,null,function*(){Ve.value=!0,setTimeout(()=>{if(!l||l.trim()==="")pe.value=ve.value.filter(e=>e.status==="active");else{const e=l.toLowerCase().trim();pe.value=ve.value.filter(m=>m.status==="active"&&(m.name.includes(l)||m.account.toLowerCase().includes(e)||m.phone.includes(e)||m.department.includes(l)))}Ve.value=!1},200)}),fe=()=>{pe.value=ve.value.filter(l=>l.status==="active")},bt=l=>{S.value=!1,$.value=[l],fe(),_.value=!0},kt=l=>{S.value=!1,Fe(l)},wt=l=>W(this,null,function*(){S.value=!1,yield Be(l)}),Dt=()=>W(this,null,function*(){try{yield Me.confirm(`确认要封存选中的 ${$.value.length} 条资料吗？`,"确认操作",{type:"warning"});const l=$.value.map(e=>e.id);yield T.batchArchiveData({dataIds:l}),C.success("封存成功"),$.value=[]}catch(l){l!=="cancel"&&C.error("封存失败")}}),Ct=()=>W(this,null,function*(){if(te.value){if(!i.assignTo){C.warning("请选择新的负责人");return}}else{if(i.assignType==="specific"&&!i.assignTo){C.warning("请选择分配成员");return}if(i.assignType==="roundrobin"&&!i.departmentId){C.warning("请选择分配部门");return}}b.value=!0;try{const l=$.value.map(e=>e.id);if(te.value||i.assignType==="specific"){const e=pe.value.find(m=>m.id===i.assignTo);if(!e){C.error("分配人员信息错误");return}yield T.batchAssignData({dataIds:l,assigneeId:i.assignTo,assigneeName:e.name,remark:i.remark}),te.value?C.success("成功将 "+$.value.length+" 条资料重新分配给 "+e.name):C.success("成功分配 "+$.value.length+" 条资料给 "+e.name)}else if(i.assignType==="roundrobin"){const e=re.value.find(K=>K.id===i.departmentId);if(!e){C.error("部门信息错误");return}const m=[{id:"1",name:"张三",account:"zhangsan",department:"销售一部"},{id:"2",name:"李四",account:"lisi",department:"销售一部"},{id:"3",name:"王五",account:"wangwu",department:"销售二部"},{id:"4",name:"赵六",account:"zhaoliu",department:"销售二部"},{id:"5",name:"钱七",account:"qianqi",department:"销售三部"},{id:"6",name:"孙八",account:"sunba",department:"客服部"},{id:"7",name:"周九",account:"zhoujiu",department:"技术部"}].filter(K=>K.department===e.name);if(m.length===0){C.error("该部门暂无可分配成员");return}const z=m[0];yield T.batchRoundRobinAssignData({dataIds:l,departmentId:i.departmentId,departmentName:e.name,members:m,mode:i.assignMode,leaderId:i.assignMode==="leader"?z.id:void 0,leaderName:i.assignMode==="leader"?z.name:void 0,remark:i.remark}),i.assignMode==="leader"?C.success("成功将 "+$.value.length+" 条资料分配给 "+e.name+" 负责人 "+z.name+"，请负责人进行二次分配"):C.success("成功将 "+$.value.length+" 条资料轮流分配给 "+e.name+" 的 "+m.length+" 名成员")}else if(i.assignType==="cross_department"){if(i.crossDepartmentStrategy==="manual"&&i.selectedDepartments.length===0){C.warning("请选择参与分配的部门");return}let e=[];if(i.crossDepartmentStrategy==="manual"?e=re.value.filter(O=>i.selectedDepartments.includes(O.id)):e=re.value,e.length===0){C.error("没有可分配的部门");return}const K=[...[{id:"1",name:"张三",account:"zhangsan",department:"销售一部",workload:5,performance:85},{id:"2",name:"李四",account:"lisi",department:"销售一部",workload:3,performance:92},{id:"3",name:"王五",account:"wangwu",department:"销售二部",workload:7,performance:78},{id:"4",name:"赵六",account:"zhaoliu",department:"销售二部",workload:2,performance:88},{id:"5",name:"钱七",account:"qianqi",department:"销售三部",workload:4,performance:90},{id:"6",name:"孙八",account:"sunba",department:"客服部",workload:6,performance:82},{id:"7",name:"周九",account:"zhoujiu",department:"技术部",workload:1,performance:95}].filter(O=>e.some(J=>J.name===O.department))];i.crossDepartmentStrategy==="workload"?K.sort((O,J)=>O.workload-J.workload):i.crossDepartmentStrategy==="performance"&&K.sort((O,J)=>J.performance-O.performance);const _e=[];l.forEach((O,J)=>{const xe=J%K.length,G=K[xe];_e.push({dataId:O,assigneeId:G.id,assigneeName:G.name,department:G.department})}),yield T.batchCrossDepartmentAssignData({assignments:_e,strategy:i.crossDepartmentStrategy,targetDepartments:e.map(O=>({id:O.id,name:O.name})),remark:i.remark});const Se={workload:"工作负载均衡",performance:"业绩表现优先",manual:"手动选择部门"}[i.crossDepartmentStrategy];C.success('成功使用"'+Se+'"策略将 '+$.value.length+" 条资料跨部门分配给 "+e.length+" 个部门的 "+K.length+" 名成员")}_.value=!1,$.value=[],i.assignType="specific",i.assignMode="direct",i.assignTo="",i.departmentId="",i.crossDepartmentStrategy="workload",i.selectedDepartments=[],i.remark="",pe.value=[]}catch(l){C.error("分配失败")}finally{b.value=!1}}),Tt=()=>W(this,null,function*(){try{yield T.fetchDataList()}catch(l){C.error("加载数据失败")}});return xt(()=>W(this,null,function*(){try{ce.value=me.filter(l=>l.visible).map(l=>l.prop),T.setFilters({dateFilter:"today"}),yield T.fetchAssigneeOptions(),q.initData(),yield Tt(),at()}catch(l){C.error("初始化失败")}})),(l,e)=>{const m=p("el-icon"),z=p("el-button"),K=p("el-alert"),_e=p("el-input"),Se=p("el-date-picker"),O=p("el-option"),J=p("el-select"),xe=p("el-card"),G=p("el-tag"),se=p("el-radio"),ze=p("el-radio-group"),ue=p("el-text"),de=p("el-form-item"),$t=p("el-form"),ge=p("el-table-column"),Vt=p("el-table"),At=p("el-dialog");return u(),k("div",Is,[t("div",Ns,[t("div",Ms,[t("div",Us,[t("div",Ls,[t("h1",Os,[a(m,{class:"title-icon"},{default:s(()=>[a(v(Ne))]),_:1}),e[16]||(e[16]=r(" 资料列表 ",-1))]),e[17]||(e[17]=t("p",{class:"page-description"},"管理已签收客户资料，支持分配、封存和批量操作",-1))])])]),c.value?(u(),k("div",Rs,[a(K,{title:"您有待分配的客户资料",type:"warning",closable:!1,"show-icon":""},{default:s(()=>[t("div",Bs,[t("span",null,[e[18]||(e[18]=r("您有 ",-1)),t("strong",null,d(y.value.length),1),e[19]||(e[19]=r(" 条客户资料需要分配给部门成员",-1))]),a(z,{type:"primary",size:"small",onClick:et,style:{"margin-left":"15px"}},{default:s(()=>[...e[20]||(e[20]=[r(" 立即分配 ",-1)])]),_:1})])]),_:1})])):g("",!0)]),t("div",Fs,[t("div",qs,[t("div",Ps,[a(m,null,{default:s(()=>[a(v(Ne))]),_:1})]),t("div",Qs,[t("div",Es,d(I.value.totalCount),1),e[21]||(e[21]=t("div",{class:"card-label"},"资料总数",-1))])]),t("div",js,[t("div",Hs,[a(m,null,{default:s(()=>[a(v(Nt))]),_:1})]),t("div",Ks,[t("div",Js,d(I.value.pendingCount),1),e[22]||(e[22]=t("div",{class:"card-label"},"待分配",-1))])]),t("div",Ws,[t("div",Ys,[a(m,null,{default:s(()=>[a(v(ke))]),_:1})]),t("div",Zs,[t("div",Gs,d(I.value.assignedCount),1),e[23]||(e[23]=t("div",{class:"card-label"},"已分配",-1))])]),t("div",Xs,[t("div",el,[a(m,null,{default:s(()=>[a(v(Mt))]),_:1})]),t("div",tl,[t("div",al,"¥"+d(I.value.totalAmount.toLocaleString()),1),e[24]||(e[24]=t("div",{class:"card-label"},"订单总额",-1))])])]),t("div",sl,[t("div",ll,[e[25]||(e[25]=t("span",{class:"filter-label"},"快速筛选：",-1)),t("div",nl,[(u(),k(X,null,ne(ie,o=>a(z,{key:o.value,type:x.value===o.value?"primary":"default",size:"small",onClick:Y=>lt(o.value)},{default:s(()=>[r(d(o.label),1)]),_:2},1032,["type","onClick"])),64))])])]),a(xe,{class:"filter-card"},{default:s(()=>[t("div",ol,[t("div",il,[a(_e,{modelValue:B.value,"onUpdate:modelValue":e[0]||(e[0]=o=>B.value=o),placeholder:"搜索客户姓名、手机号、客户编码",onInput:nt,class:"search-input",clearable:""},{prefix:s(()=>[a(m,null,{default:s(()=>[a(v(Ut))]),_:1})]),_:1},8,["modelValue"]),a(Se,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=o=>w.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:st,class:"date-picker",size:"default"},null,8,["modelValue"]),a(J,{modelValue:N.value,"onUpdate:modelValue":e[2]||(e[2]=o=>N.value=o),placeholder:"状态筛选",clearable:"",class:"status-filter"},{default:s(()=>[a(O,{label:"待分配",value:"pending"}),a(O,{label:"已分配",value:"assigned"}),a(O,{label:"已封存",value:"archived"}),a(O,{label:"已回收",value:"recovered"})]),_:1},8,["modelValue"])])])]),_:1}),t("div",rl,[t("div",ul,[t("div",dl,[t("div",cl,[(u(!0),k(X,null,ne(P.value,o=>(u(),k("div",{key:o.value,class:Ie(["nav-tab",{active:F.value===o.value}]),onClick:Y=>ot(o.value)},[t("span",pl,d(o.label),1),t("span",vl,d(o.count),1)],10,ml))),128))]),t("div",gl,[t("div",fl,[a(z,{type:"primary",disabled:$.value.length===0,onClick:ft},{default:s(()=>[a(m,null,{default:s(()=>[a(v(le))]),_:1}),r(" 批量分配 ("+d($.value.length)+") ",1)]),_:1},8,["disabled"]),D.value||!n.value?(u(),h(z,{key:0,type:"warning",disabled:$.value.length===0,onClick:Dt},{default:s(()=>[a(m,null,{default:s(()=>[a(v(Ee))]),_:1}),e[26]||(e[26]=r(" 批量封存 ",-1))]),_:1},8,["disabled"])):g("",!0)]),t("div",_l,[a(Ht,{columns:me,"storage-key":"data-list-columns",onColumnsChange:ct,ref_key:"columnSettingsRef",ref:oe},null,512)])])])]),a(Kt,{data:L.value,columns:be.value,"storage-key":"data-list-columns",loading:U.value,"show-column-settings":!1,"show-selection":!0,"show-index":!1,pagination:{currentPage:ee.value,pageSize:ye.value,total:$e.value,pageSizes:[30,50,100]},onSelectionChange:it,onSortChange:dt,onSizeChange:ut,onCurrentChange:rt},{"column-customerCode":s(({row:o})=>[t("span",{class:"code-link",onClick:Y=>gt(o.customerCode),title:o.customerCode},d(o.customerCode||"N/A"),9,hl)]),"column-orderAmount":s(({row:o})=>[t("span",yl,"¥"+d(o.orderAmount.toLocaleString()),1)]),"column-status":s(({row:o})=>[a(G,{type:mt(o.status)},{default:s(()=>[r(d(Oe(o.status)),1)]),_:2},1032,["type"]),o.isReassigned?(u(),h(G,{key:0,type:"warning",size:"small",style:{"margin-left":"4px"}},{default:s(()=>[...e[27]||(e[27]=[r(" 重分配 ",-1)])]),_:1})):g("",!0)]),"column-allocationSource":s(({row:o})=>[pt(o)?(u(),h(G,{key:0,type:"info",size:"small"},{default:s(()=>[...e[28]||(e[28]=[r(" 分配 ",-1)])]),_:1})):(u(),k("span",bl,"自建"))]),"column-phone":s(({row:o})=>[r(d(v(Te)(o.phone,v(De).PHONE)),1)]),"column-assigneeName":s(({row:o})=>[r(d(o.status==="assigned"&&o.assigneeName||"-"),1)]),"column-operatorName":s(({row:o})=>[r(d((o.status==="assigned"||o.status==="archived")&&o.operatorName||"-"),1)]),"column-assignDate":s(({row:o})=>[r(d(o.status==="pending"?o.orderDate:o.assignDate||"-"),1)]),"table-actions":s(({row:o})=>[a(z,{type:"primary",size:"small",onClick:Y=>vt(o)},{default:s(()=>[a(m,null,{default:s(()=>[a(v(Lt))]),_:1}),e[29]||(e[29]=r(" 查看 ",-1))]),_:1},8,["onClick"]),n.value?(u(),k(X,{key:0},[o.status==="pending"?(u(),h(z,{key:0,type:"success",size:"small",onClick:Y=>Re(o)},{default:s(()=>[a(m,null,{default:s(()=>[a(v(le))]),_:1}),e[30]||(e[30]=r(" 分配 ",-1))]),_:1},8,["onClick"])):g("",!0),o.status==="assigned"?(u(),h(z,{key:1,type:"success",size:"small",onClick:Y=>Ae(o)},{default:s(()=>[a(m,null,{default:s(()=>[a(v(le))]),_:1}),e[31]||(e[31]=r(" 重新分配 ",-1))]),_:1},8,["onClick"])):g("",!0)],64)):(u(),k(X,{key:1},[o.status==="pending"?(u(),h(z,{key:0,type:"success",size:"small",onClick:Y=>Re(o)},{default:s(()=>[a(m,null,{default:s(()=>[a(v(le))]),_:1}),e[32]||(e[32]=r(" 分配 ",-1))]),_:1},8,["onClick"])):g("",!0),o.status==="recovered"?(u(),h(z,{key:1,type:"success",size:"small",onClick:Y=>Ae(o)},{default:s(()=>[a(m,null,{default:s(()=>[a(v(le))]),_:1}),e[33]||(e[33]=r(" 重新分配 ",-1))]),_:1},8,["onClick"])):g("",!0),o.status!=="pending"&&o.status!=="recovered"?(u(),h(z,{key:2,type:"warning",size:"small",onClick:Y=>Be(o)},{default:s(()=>[a(m,null,{default:s(()=>[a(v(Ue))]),_:1}),e[34]||(e[34]=r(" 回收 ",-1))]),_:1},8,["onClick"])):g("",!0),o.status==="recovered"?(u(),h(z,{key:3,type:"danger",size:"small",onClick:Y=>_t(o)},{default:s(()=>[a(m,null,{default:s(()=>[a(v(Ot))]),_:1}),e[35]||(e[35]=r(" 删除 ",-1))]),_:1},8,["onClick"])):g("",!0),o.status==="archived"?(u(),h(z,{key:4,type:"success",size:"small",onClick:Y=>Ae(o)},{default:s(()=>[a(m,null,{default:s(()=>[a(v(le))]),_:1}),e[37]||(e[37]=r(" 重新分配 ",-1)),o.isReassigned?(u(),h(G,{key:0,type:"info",size:"small",style:{"margin-left":"4px"}},{default:s(()=>[...e[36]||(e[36]=[r("重分",-1)])]),_:1})):g("",!0)]),_:2},1032,["onClick"])):g("",!0),o.status==="pending"||o.status==="assigned"?(u(),h(z,{key:5,type:"danger",size:"small",onClick:Y=>Fe(o)},{default:s(()=>[a(m,null,{default:s(()=>[a(v(je))]),_:1}),e[38]||(e[38]=r(" 封存 ",-1))]),_:1},8,["onClick"])):g("",!0)],64))]),_:1},8,["data","columns","loading","pagination"])]),a(At,{modelValue:_.value,"onUpdate:modelValue":e[12]||(e[12]=o=>_.value=o),title:te.value?"重新分配资料":"部门负责人分配",width:"700px","close-on-click-modal":!1},{footer:s(()=>[a(z,{onClick:e[11]||(e[11]=o=>_.value=!1)},{default:s(()=>[...e[62]||(e[62]=[r("取消",-1)])]),_:1}),a(z,{type:"primary",onClick:Ct,loading:b.value},{default:s(()=>[...e[63]||(e[63]=[r("确认分配",-1)])]),_:1},8,["loading"])]),default:s(()=>[t("div",kl,[t("div",wl,[a(K,{title:"分配说明",type:"info",closable:!1,"show-icon":""},{default:s(()=>[te.value?(u(),k("div",Dl,[t("p",null,[e[39]||(e[39]=r("您有 ",-1)),t("strong",null,d($.value.length),1),e[40]||(e[40]=r(" 条待分配的客户资料",-1))]),t("p",Cl,[a(m,null,{default:s(()=>[a(v(Qe))]),_:1}),e[41]||(e[41]=r(" 重新分配后，原负责人将失去该客户的归属权 ",-1))])])):(u(),k("div",Tl,[t("p",null,[e[42]||(e[42]=r("您有 ",-1)),t("strong",null,d($.value.length),1),e[43]||(e[43]=r(" 条待分配的客户资料",-1))]),e[44]||(e[44]=t("p",null,"请选择分配方式进行分配，系统将按轮流方式确保公平分配",-1))]))]),_:1})]),a($t,{model:i,"label-width":"100px"},{default:s(()=>[te.value?g("",!0):(u(),h(de,{key:0,label:"分配方式"},{default:s(()=>[a(ze,{modelValue:i.assignType,"onUpdate:modelValue":e[3]||(e[3]=o=>i.assignType=o)},{default:s(()=>[a(se,{value:"roundrobin"},{default:s(()=>[...e[45]||(e[45]=[r("部门内轮流分配",-1)])]),_:1}),a(se,{value:"specific"},{default:s(()=>[...e[46]||(e[46]=[r("指定成员分配",-1)])]),_:1}),D.value?(u(),h(se,{key:0,value:"cross_department"},{default:s(()=>[...e[47]||(e[47]=[r("跨部门智能分配",-1)])]),_:1})):g("",!0)]),_:1},8,["modelValue"]),i.assignType==="cross_department"?(u(),k("div",$l,[a(ue,{type:"warning",size:"small"},{default:s(()=>[a(m,null,{default:s(()=>[a(v(Qe))]),_:1}),e[48]||(e[48]=r(" 超级管理员权限：可跨部门分配资料，系统将根据各部门工作负载智能分配 ",-1))]),_:1})])):g("",!0)]),_:1})),i.assignType==="roundrobin"?(u(),h(de,{key:1,label:"分配模式"},{default:s(()=>[a(ze,{modelValue:i.assignMode,"onUpdate:modelValue":e[4]||(e[4]=o=>i.assignMode=o)},{default:s(()=>[a(se,{value:"direct"},{default:s(()=>[...e[49]||(e[49]=[r("直接分配给成员",-1)])]),_:1}),a(se,{value:"leader"},{default:s(()=>[...e[50]||(e[50]=[r("先分配给部门负责人",-1)])]),_:1})]),_:1},8,["modelValue"]),t("div",Vl,[i.assignMode==="direct"?(u(),h(ue,{key:0,type:"info",size:"small"},{default:s(()=>[...e[51]||(e[51]=[r(" 系统将按轮流顺序直接分配给部门成员，确保每个人都能轮流获得资料 ",-1)])]),_:1})):(u(),h(ue,{key:1,type:"info",size:"small"},{default:s(()=>[...e[52]||(e[52]=[r(" 所有资料将先分配给部门负责人，由负责人再次分配给部门成员 ",-1)])]),_:1}))])]),_:1})):g("",!0),i.assignType==="cross_department"?(u(),h(de,{key:2,label:"分配策略"},{default:s(()=>[a(ze,{modelValue:i.crossDepartmentStrategy,"onUpdate:modelValue":e[5]||(e[5]=o=>i.crossDepartmentStrategy=o)},{default:s(()=>[a(se,{value:"workload"},{default:s(()=>[...e[53]||(e[53]=[r("按工作负载均衡",-1)])]),_:1}),a(se,{value:"performance"},{default:s(()=>[...e[54]||(e[54]=[r("按业绩表现分配",-1)])]),_:1}),a(se,{value:"manual"},{default:s(()=>[...e[55]||(e[55]=[r("手动选择部门",-1)])]),_:1})]),_:1},8,["modelValue"]),t("div",Al,[i.crossDepartmentStrategy==="workload"?(u(),h(ue,{key:0,type:"info",size:"small"},{default:s(()=>[...e[56]||(e[56]=[r(" 系统将根据各部门当前工作负载自动分配，确保负载均衡 ",-1)])]),_:1})):i.crossDepartmentStrategy==="performance"?(u(),h(ue,{key:1,type:"info",size:"small"},{default:s(()=>[...e[57]||(e[57]=[r(" 优先分配给业绩表现较好的部门，激励团队竞争 ",-1)])]),_:1})):(u(),h(ue,{key:2,type:"info",size:"small"},{default:s(()=>[...e[58]||(e[58]=[r(" 手动选择要参与分配的部门，灵活控制分配范围 ",-1)])]),_:1}))])]),_:1})):g("",!0),i.assignType==="cross_department"&&i.crossDepartmentStrategy==="manual"?(u(),h(de,{key:3,label:"参与部门"},{default:s(()=>[a(J,{modelValue:i.selectedDepartments,"onUpdate:modelValue":e[6]||(e[6]=o=>i.selectedDepartments=o),multiple:"",placeholder:"选择参与分配的部门",style:{width:"100%"}},{default:s(()=>[(u(!0),k(X,null,ne(re.value,o=>(u(),h(O,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),i.assignType==="roundrobin"?(u(),h(de,{key:4,label:"选择部门"},{default:s(()=>[a(J,{modelValue:i.departmentId,"onUpdate:modelValue":e[7]||(e[7]=o=>i.departmentId=o),placeholder:"选择部门",style:{width:"100%"}},{default:s(()=>[(u(!0),k(X,null,ne(re.value,o=>(u(),h(O,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),te.value||i.assignType==="specific"?(u(),h(de,{key:5,label:te.value?"转移给":"指定成员"},{default:s(()=>[a(J,{modelValue:i.assignTo,"onUpdate:modelValue":e[8]||(e[8]=o=>i.assignTo=o),placeholder:te.value?"选择新的负责人":"搜索成员姓名、账号、手机号或部门",style:{width:"100%"},filterable:"",remote:"","remote-method":yt,loading:Ve.value,onFocus:fe,clearable:""},{default:s(()=>[(u(!0),k(X,null,ne(pe.value,o=>(u(),h(O,{key:o.id,label:`${o.name} (${o.account}) - ${o.department}`,value:o.id},{default:s(()=>[t("div",Sl,[t("div",xl,[t("div",zl,d(o.name)+" ("+d(o.account)+")",1),t("div",Il,[t("span",Nl,d(o.department),1),t("span",Ml,d(o.phone),1)])])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1},8,["label"])):g("",!0),a(de,{label:"备注"},{default:s(()=>[a(_e,{modelValue:i.remark,"onUpdate:modelValue":e[9]||(e[9]=o=>i.remark=o),type:"textarea",placeholder:"分配备注（可选）",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),i.assignType?(u(),k("div",Ul,[t("div",Ll,[t("div",Ol,[a(m,{class:"preview-icon"},{default:s(()=>[a(v(Ne))]),_:1}),e[59]||(e[59]=t("h4",null,"分配预览",-1)),a(G,{type:Je(),size:"small"},{default:s(()=>[r(d(We()),1)]),_:1},8,["type"])]),t("div",Rl,[t("div",Bl,[a(m,{class:"target-icon"},{default:s(()=>[a(v(ke))]),_:1}),t("span",Fl,d(Ke()),1)]),i.assignType==="specific"&&i.assignTo?(u(),k("div",ql,[t("span",Pl,[a(m,null,{default:s(()=>[a(v(Rt))]),_:1}),r(" "+d(Ye()),1)]),t("span",Ql,[a(m,null,{default:s(()=>[a(v(Bt))]),_:1}),r(" "+d(Ze()),1)])])):g("",!0)])]),$.value.length>0?(u(),k("div",El,[t("div",jl,[t("div",Hl,[a(m,null,{default:s(()=>[a(v(Ft))]),_:1}),e[60]||(e[60]=t("span",null,"客户详情预览",-1))]),t("div",Kl,[a(z,{size:"small",text:"",onClick:e[10]||(e[10]=o=>Z.value=!Z.value)},{default:s(()=>[r(d(Z.value?"收起":"展开")+" ",1),a(m,null,{default:s(()=>[Z.value?(u(),h(v(Pt),{key:1})):(u(),h(v(qt),{key:0}))]),_:1})]),_:1})])]),t("div",{class:Ie(["preview-table-container",{expanded:Z.value}])},[a(Vt,{data:$.value.slice(0,Z.value?$.value.length:3),size:"small",stripe:"","max-height":Z.value?400:200,class:"preview-table"},{default:s(()=>[a(ge,{prop:"customerName",label:"客户姓名",width:"100","show-overflow-tooltip":""}),a(ge,{prop:"phone",label:"联系电话",width:"120","show-overflow-tooltip":""}),a(ge,{prop:"orderAmount",label:"订单金额",width:"100",align:"right"},{default:s(o=>[t("span",{class:Ie(["amount-text",{"high-value":o.row.orderAmount>=5e4}])}," ¥"+d(o.row.orderAmount.toLocaleString()),3)]),_:1}),a(ge,{prop:"source",label:"来源",width:"80","show-overflow-tooltip":""}),a(ge,{prop:"status",label:"状态",width:"80"},{default:s(o=>[a(G,{size:"small",type:Ge(o.row.status)},{default:s(()=>[r(d(o.row.status),1)]),_:2},1032,["type"])]),_:1}),a(ge,{prop:"createTime",label:"创建时间",width:"100","show-overflow-tooltip":""},{default:s(o=>[r(d(Xe(o.row.createTime)),1)]),_:1})]),_:1},8,["data","max-height"]),!Z.value&&$.value.length>3?(u(),k("div",Jl,[a(ue,{type:"info",size:"small"},{default:s(()=>[a(m,null,{default:s(()=>[a(v(Qt))]),_:1}),r(" 还有 "+d($.value.length-3)+" 条客户数据，点击展开查看全部 ",1)]),_:1})])):g("",!0)],2)])):g("",!0),i.remark?(u(),k("div",Wl,[t("div",Yl,[a(m,null,{default:s(()=>[a(v(Et))]),_:1}),e[61]||(e[61]=t("span",null,"分配备注",-1))]),t("div",Zl,d(i.remark),1)])):g("",!0)])):g("",!0)])]),_:1},8,["modelValue","title"]),a(rs,{modelValue:S.value,"onUpdate:modelValue":e[13]||(e[13]=o=>S.value=o),"customer-data":ae.value,onQuickAssign:bt,onQuickArchive:kt,onQuickRecover:wt},null,8,["modelValue","customer-data"]),a(ys,{modelValue:j.value,"onUpdate:modelValue":e[14]||(e[14]=o=>j.value=o),"customer-data":V.value,onConfirm:ht},null,8,["modelValue","customer-data"]),a(zs,{modelValue:H.value,"onUpdate:modelValue":e[15]||(e[15]=o=>H.value=o),"pending-assignments":y.value,onConfirm:tt},null,8,["modelValue","pending-assignments"])])}}}),un=Ce(Gl,[["__scopeId","data-v-1df42200"]]);export{un as default};
