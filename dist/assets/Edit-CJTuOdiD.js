var ce=Object.defineProperty,ve=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var Y=(c,d,n)=>d in c?ce(c,d,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[d]=n,ee=(c,d)=>{for(var n in d||(d={}))_e.call(d,n)&&Y(c,n,d[n]);if(X)for(var n of X(d))be.call(d,n)&&Y(c,n,d[n]);return c},le=(c,d)=>ve(c,ge(d));var T=(c,d,n)=>new Promise((w,_)=>{var E=b=>{try{h(n.next(b))}catch(S){_(S)}},D=b=>{try{h(n.throw(b))}catch(S){_(S)}},h=b=>b.done?w(b.value):Promise.resolve(b.value).then(E,D);h((n=n.apply(c,d)).next())});import{l as ye,aC as Ve,az as he,r as y,e as we,Z as ke,c as Ue,ag as i,m as A,p,q as f,U as l,O as t,S as g,u as V,F as P,a9 as I,M as x,Q as Ce}from"./vendor-D8Vxqhr-.js";import{a2 as O,E as B,b as Ae}from"./elementPlus-Bmwh7Rh8.js";import{u as xe,t as Pe,S as j,c as Ie,_ as Be}from"./settings-CuxbDWOu.js";import{g as Se,a as Ge,b as Ee,c as De}from"./addressData-DOzoWqjI.js";import{d as z}from"./sensitiveInfo-BWt1a88R.js";import{c as He}from"./customerTags-Cm4wsNSA.js";import"./utils-ywHRn0uI.js";const Te={class:"customer-form"},Ne={class:"page-header"},Fe={class:"header-actions"},qe={class:"form-section"},Me={class:"form-section"},Re={class:"form-section"},Le={class:"form-section"},Oe={class:"form-section"},je=ye({__name:"Edit",setup(c){const d=Ve(),n=he(),w=Ie(n),_=xe(),E=Pe(),D=y(),h=y(!1),b=y(null),S=we(()=>{if(!b.value||!_.currentUser)return!1;const r=_.currentUser,e=b.value;if(_.isSuperAdmin)return!0;if(_.isDepartmentLeader){if(e.createdBy===r.id||e.salesPersonId===r.id)return!0;const G=_.users.find(s=>s.id===e.createdBy),v=_.users.find(s=>s.id===e.salesPersonId);return G&&G.departmentId===r.departmentId||v&&v.departmentId===r.departmentId}return e.createdBy===r.id||e.salesPersonId===r.id}),a=ke({name:"",gender:"unknown",phone:"",age:null,email:"",wechat:"",height:null,weight:null,province:"",city:"",district:"",street:"",detailAddress:"",overseasAddress:"",medicalHistory:"",improvementGoals:[],otherGoals:"",level:"normal",source:"online",tags:[],salesPerson:"",remark:""}),te={name:[{required:!0,message:"请输入客户姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],age:[{type:"number",min:1,max:120,message:"年龄必须在1-120之间",trigger:"blur"}],level:[{required:!0,message:"请选择客户等级",trigger:"change"}],salesPerson:[{required:!0,message:"请选择负责销售",trigger:"change"}]},Q=y([]),W=y([]),N=y([]),H=y([]),ae=y([{id:"1",name:"张三",department:"销售一部"},{id:"2",name:"李四",department:"销售二部"},{id:"3",name:"王五",department:"销售一部"},{id:"4",name:"赵六",department:"销售三部"}]),Z=y([]),F=y(!1),$=r=>{a.city="",a.district="",a.street="",W.value=Se(r),N.value=[],H.value=[]},J=r=>{a.district="",a.street="",N.value=Ge(a.province,r),H.value=[]},K=r=>{a.street="",H.value=Ee(a.province,a.city,r)},oe=()=>{var r;a.salesPerson=((r=_.currentUser)==null?void 0:r.id)||""},re=()=>T(this,null,function*(){try{F.value=!0;const r=yield He.getActiveList();Z.value=r.data}catch(r){console.error("加载标签失败:",r),B.error("加载标签失败")}finally{F.value=!1}}),se=()=>{w.back()},ne=()=>T(this,null,function*(){try{yield D.value.validate(),h.value=!0;const r=[a.province,a.city,a.district,a.street,a.detailAddress].filter(Boolean).join(""),e=le(ee({},a),{address:r,province:a.province,city:a.city,district:a.district,street:a.street,detailAddress:a.detailAddress,overseasAddress:a.overseasAddress});yield E.updateCustomer(e),B.success("客户信息更新成功"),w.push("/customer/list")}catch(r){console.error("更新失败:",r),B.error("更新客户信息失败")}finally{h.value=!1}}),de=()=>T(this,null,function*(){const r=d.params.id;if(!r){B.error("客户ID不存在"),w.push("/customer/list");return}try{h.value=!0;const e=E.getCustomerById(r);if(!e){B.error("客户不存在"),w.push("/customer/list");return}if(b.value=e,!S.value){yield Ae.alert("您没有权限编辑此客户信息。只能编辑自己创建或被分配的客户。","权限不足",{confirmButtonText:"返回",type:"warning"}),w.push("/customer/list");return}Object.assign(a,{name:e.name||"",gender:e.gender||"unknown",phone:e.phone||"",age:e.age||null,email:e.email||"",wechat:e.wechat||"",height:e.height||null,weight:e.weight||null,province:e.province||"",city:e.city||"",district:e.district||"",street:e.street||"",detailAddress:e.detailAddress||"",medicalHistory:e.medicalHistory||"",improvementGoals:e.improvementGoals||[],otherGoals:e.otherGoals||"",level:e.level||"normal",source:e.source||"online",tags:e.tags||[],salesPerson:e.salesPersonId||"",remark:e.remark||""}),a.province&&$(a.province),a.city&&J(a.city),a.district&&K(a.district)}catch(e){console.error("加载客户详情失败:",e),B.error("加载客户信息失败"),w.push("/customer/list")}finally{h.value=!1}}),ue=()=>{Q.value=De()};return Ue(()=>{oe(),ue(),re(),de()}),(r,e)=>{const G=i("el-button"),v=i("el-input"),s=i("el-form-item"),u=i("el-col"),q=i("el-radio"),ie=i("el-radio-group"),U=i("el-row"),M=i("el-icon"),R=i("el-tooltip"),L=i("el-input-number"),m=i("el-option"),k=i("el-select"),C=i("el-checkbox"),me=i("el-checkbox-group"),pe=i("el-form"),fe=i("el-card");return p(),A("div",Te,[f("div",Ne,[e[21]||(e[21]=f("h2",null,"编辑客户",-1)),f("div",Fe,[l(G,{onClick:se},{default:t(()=>[...e[19]||(e[19]=[g("取消",-1)])]),_:1}),l(G,{type:"primary",onClick:ne,loading:h.value},{default:t(()=>[...e[20]||(e[20]=[g(" 更新 ",-1)])]),_:1},8,["loading"])])]),l(fe,{class:"form-card"},{default:t(()=>[l(pe,{ref_key:"customerFormRef",ref:D,model:a,rules:te,"label-width":"100px",size:"default"},{default:t(()=>[f("div",qe,[e[25]||(e[25]=f("h3",{class:"section-title"},"基本信息",-1)),l(U,{gutter:20},{default:t(()=>[l(u,{span:12},{default:t(()=>[l(s,{label:"客户姓名",prop:"name"},{default:t(()=>[l(v,{modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.name=o),placeholder:"请输入客户姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:12},{default:t(()=>[l(s,{label:"性别",prop:"gender"},{default:t(()=>[l(ie,{modelValue:a.gender,"onUpdate:modelValue":e[1]||(e[1]=o=>a.gender=o)},{default:t(()=>[l(q,{label:"male"},{default:t(()=>[...e[22]||(e[22]=[g("男",-1)])]),_:1}),l(q,{label:"female"},{default:t(()=>[...e[23]||(e[23]=[g("女",-1)])]),_:1}),l(q,{label:"unknown"},{default:t(()=>[...e[24]||(e[24]=[g("未知",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(U,{gutter:20},{default:t(()=>[l(u,{span:12},{default:t(()=>[l(s,{label:"手机号",prop:"phone"},{default:t(()=>[l(v,{value:V(z)(a.phone,V(j).PHONE),readonly:"",placeholder:"敏感信息已加密显示"},{suffix:t(()=>[l(R,{content:"敏感信息已加密显示，不可修改"},{default:t(()=>[l(M,null,{default:t(()=>[l(V(O))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),l(u,{span:12},{default:t(()=>[l(s,{label:"年龄",prop:"age"},{default:t(()=>[l(L,{modelValue:a.age,"onUpdate:modelValue":e[2]||(e[2]=o=>a.age=o),min:1,max:120,placeholder:"请输入年龄",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(U,{gutter:20},{default:t(()=>[l(u,{span:12},{default:t(()=>[l(s,{label:"邮箱",prop:"email"},{default:t(()=>[l(v,{value:V(z)(a.email,V(j).EMAIL),readonly:"",placeholder:"敏感信息已加密显示"},{suffix:t(()=>[l(R,{content:"敏感信息已加密显示，不可修改"},{default:t(()=>[l(M,null,{default:t(()=>[l(V(O))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),l(u,{span:12},{default:t(()=>[l(s,{label:"微信号",prop:"wechat"},{default:t(()=>[l(v,{value:V(z)(a.wechat,V(j).WECHAT),readonly:"",placeholder:"敏感信息已加密显示"},{suffix:t(()=>[l(R,{content:"敏感信息已加密显示，不可修改"},{default:t(()=>[l(M,null,{default:t(()=>[l(V(O))]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),l(U,{gutter:20},{default:t(()=>[l(u,{span:12},{default:t(()=>[l(s,{label:"身高(cm)",prop:"height"},{default:t(()=>[l(L,{modelValue:a.height,"onUpdate:modelValue":e[3]||(e[3]=o=>a.height=o),min:50,max:250,placeholder:"请输入身高",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:12},{default:t(()=>[l(s,{label:"体重(kg)",prop:"weight"},{default:t(()=>[l(L,{modelValue:a.weight,"onUpdate:modelValue":e[4]||(e[4]=o=>a.weight=o),min:20,max:300,placeholder:"请输入体重",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),f("div",Me,[e[26]||(e[26]=f("h3",{class:"section-title"},"收货地址",-1)),l(U,{gutter:20},{default:t(()=>[l(u,{span:6},{default:t(()=>[l(s,{label:"省份",prop:"province"},{default:t(()=>[l(k,{modelValue:a.province,"onUpdate:modelValue":e[5]||(e[5]=o=>a.province=o),placeholder:"请选择省份",style:{width:"100%"},onChange:$},{default:t(()=>[(p(!0),A(P,null,I(Q.value,o=>(p(),x(m,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(u,{span:6},{default:t(()=>[l(s,{label:"城市",prop:"city"},{default:t(()=>[l(k,{modelValue:a.city,"onUpdate:modelValue":e[6]||(e[6]=o=>a.city=o),placeholder:"请选择城市",style:{width:"100%"},onChange:J},{default:t(()=>[(p(!0),A(P,null,I(W.value,o=>(p(),x(m,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(u,{span:6},{default:t(()=>[l(s,{label:"区县",prop:"district"},{default:t(()=>[l(k,{modelValue:a.district,"onUpdate:modelValue":e[7]||(e[7]=o=>a.district=o),placeholder:"请选择区县",style:{width:"100%"},onChange:K},{default:t(()=>[(p(!0),A(P,null,I(N.value,o=>(p(),x(m,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(u,{span:6},{default:t(()=>[l(s,{label:"街道",prop:"street"},{default:t(()=>[l(k,{modelValue:a.street,"onUpdate:modelValue":e[8]||(e[8]=o=>a.street=o),placeholder:"请选择街道",style:{width:"100%"}},{default:t(()=>[(p(!0),A(P,null,I(H.value,o=>(p(),x(m,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(s,{label:"详细地址",prop:"detailAddress"},{default:t(()=>[l(v,{modelValue:a.detailAddress,"onUpdate:modelValue":e[9]||(e[9]=o=>a.detailAddress=o),placeholder:"请输入详细地址（门牌号、楼层等）",clearable:""},null,8,["modelValue"])]),_:1}),l(s,{label:"境外地址",prop:"overseasAddress"},{default:t(()=>[l(v,{modelValue:a.overseasAddress,"onUpdate:modelValue":e[10]||(e[10]=o=>a.overseasAddress=o),placeholder:"如为境外地址，请在此输入完整地址",clearable:""},null,8,["modelValue"])]),_:1})]),f("div",Re,[e[34]||(e[34]=f("h3",{class:"section-title"},"健康信息",-1)),l(s,{label:"疾病史",prop:"medicalHistory"},{default:t(()=>[l(v,{modelValue:a.medicalHistory,"onUpdate:modelValue":e[11]||(e[11]=o=>a.medicalHistory=o),type:"textarea",rows:3,placeholder:"请输入疾病史（如有）"},null,8,["modelValue"])]),_:1}),l(s,{label:"改善问题",prop:"improvementGoals"},{default:t(()=>[l(me,{modelValue:a.improvementGoals,"onUpdate:modelValue":e[12]||(e[12]=o=>a.improvementGoals=o)},{default:t(()=>[l(C,{label:"减肥瘦身"},{default:t(()=>[...e[27]||(e[27]=[g("减肥瘦身",-1)])]),_:1}),l(C,{label:"增肌塑形"},{default:t(()=>[...e[28]||(e[28]=[g("增肌塑形",-1)])]),_:1}),l(C,{label:"改善睡眠"},{default:t(()=>[...e[29]||(e[29]=[g("改善睡眠",-1)])]),_:1}),l(C,{label:"提高免疫力"},{default:t(()=>[...e[30]||(e[30]=[g("提高免疫力",-1)])]),_:1}),l(C,{label:"调理肠胃"},{default:t(()=>[...e[31]||(e[31]=[g("调理肠胃",-1)])]),_:1}),l(C,{label:"美容养颜"},{default:t(()=>[...e[32]||(e[32]=[g("美容养颜",-1)])]),_:1}),l(C,{label:"其他"},{default:t(()=>[...e[33]||(e[33]=[g("其他",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a.improvementGoals.includes("其他")?(p(),x(s,{key:0,label:"其他改善目标",prop:"otherGoals"},{default:t(()=>[l(v,{modelValue:a.otherGoals,"onUpdate:modelValue":e[13]||(e[13]=o=>a.otherGoals=o),placeholder:"请输入其他改善目标",clearable:""},null,8,["modelValue"])]),_:1})):Ce("",!0)]),f("div",Le,[e[35]||(e[35]=f("h3",{class:"section-title"},"客户分类",-1)),l(U,{gutter:20},{default:t(()=>[l(u,{span:12},{default:t(()=>[l(s,{label:"客户等级",prop:"level"},{default:t(()=>[l(k,{modelValue:a.level,"onUpdate:modelValue":e[14]||(e[14]=o=>a.level=o),placeholder:"请选择客户等级",style:{width:"100%"}},{default:t(()=>[l(m,{label:"普通客户",value:"normal"}),l(m,{label:"VIP客户",value:"vip"}),l(m,{label:"SVIP客户",value:"svip"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(u,{span:12},{default:t(()=>[l(s,{label:"客户来源",prop:"source"},{default:t(()=>[l(k,{modelValue:a.source,"onUpdate:modelValue":e[15]||(e[15]=o=>a.source=o),placeholder:"请选择客户来源",style:{width:"100%"}},{default:t(()=>[l(m,{label:"线上推广",value:"online"}),l(m,{label:"朋友推荐",value:"referral"}),l(m,{label:"电话营销",value:"telemarketing"}),l(m,{label:"门店到访",value:"store"}),l(m,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(U,{gutter:20},{default:t(()=>[l(u,{span:12},{default:t(()=>[l(s,{label:"客户标签",prop:"tags"},{default:t(()=>[l(k,{modelValue:a.tags,"onUpdate:modelValue":e[16]||(e[16]=o=>a.tags=o),placeholder:"请选择客户标签",multiple:"",style:{width:"100%"},loading:F.value},{default:t(()=>[(p(!0),A(P,null,I(Z.value,o=>(p(),x(m,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1}),l(u,{span:12},{default:t(()=>[l(s,{label:"负责销售",prop:"salesPerson"},{default:t(()=>[l(k,{modelValue:a.salesPerson,"onUpdate:modelValue":e[17]||(e[17]=o=>a.salesPerson=o),placeholder:"请选择负责销售",style:{width:"100%"},disabled:!V(_).isAdmin},{default:t(()=>[(p(!0),A(P,null,I(ae.value,o=>(p(),x(m,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),f("div",Oe,[e[36]||(e[36]=f("h3",{class:"section-title"},"备注信息",-1)),l(s,{label:"备注",prop:"remark"},{default:t(()=>[l(v,{modelValue:a.remark,"onUpdate:modelValue":e[18]||(e[18]=o=>a.remark=o),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})])]),_:1},8,["model"])]),_:1})])}}}),Ye=Be(je,[["__scopeId","data-v-3ab4dd2b"]]);export{Ye as default};
