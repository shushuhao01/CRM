var W=Object.defineProperty,Z=Object.defineProperties;var tt=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var et=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable;var M=(p,r,i)=>r in p?W(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,O=(p,r)=>{for(var i in r||(r={}))et.call(r,i)&&M(p,i,r[i]);if(L)for(var i of L(r))at.call(r,i)&&M(p,i,r[i]);return p},$=(p,r)=>Z(p,tt(r));var A=(p,r,i)=>new Promise((m,S)=>{var D=_=>{try{b(i.next(_))}catch(x){S(x)}},R=_=>{try{b(i.throw(_))}catch(x){S(x)}},b=_=>_.done?m(_.value):Promise.resolve(_.value).then(D,R);b((i=i.apply(p,r)).next())});import{u as lt,e as st}from"./call-C9NCWzRc.js";import{i as T,L as ot}from"./utils-ywHRn0uI.js";import{d as nt,n as it,h as rt,ai as dt,c as ct,ap as ut,s as mt,E as Y}from"./elementPlus-Bmwh7Rh8.js";import{l as pt,r as h,e as ft,c as _t,ag as f,m as vt,p as yt,q as a,U as e,S as v,O as l,u as C,T as g,n as ht}from"./vendor-D8Vxqhr-.js";import{_ as gt}from"./settings-CuxbDWOu.js";const bt={class:"call-dashboard"},xt={class:"page-header"},Ct={class:"header-content"},wt={class:"page-title"},St={class:"date-filter"},Dt={class:"metrics-cards"},Rt={class:"metric-content"},kt={class:"metric-icon total-calls"},At={class:"metric-info"},Vt={class:"metric-value"},Tt={class:"metric-content"},Ut={class:"metric-icon total-duration"},Et={class:"metric-info"},Lt={class:"metric-value"},Mt={class:"metric-content"},Ot={class:"metric-icon avg-duration"},$t={class:"metric-info"},Yt={class:"metric-value"},Bt={class:"metric-content"},Ft={class:"metric-icon connection-rate"},Nt={class:"metric-info"},It={class:"metric-value"},jt={class:"charts-section"},zt={class:"card-header"},qt={class:"staff-statistics"},Gt={class:"card-header"},Kt={class:"time-analysis"},Pt=pt({__name:"Dashboard",setup(p){const r=lt(),i=h([new Date(Date.now()-7*24*60*60*1e3).toISOString().split("T")[0],new Date().toISOString().split("T")[0]]),m=h(null),S=h("calls"),D=h(""),R=h(!1),b=h(),_=h(),x=h(),B=ft(()=>{var s;return(s=m.value)!=null&&s.userStats?m.value.userStats.filter(t=>t.userName.toLowerCase().includes(D.value.toLowerCase())).map(t=>$(O({},t),{avgDuration:t.calls>0?t.duration/t.calls:0,department:"销售部"})):[]}),k=s=>{if(s<60)return`${s}秒`;const t=Math.floor(s/3600),n=Math.floor(s%3600/60),d=s%60;return t>0?`${t}小时${n}分${d}秒`:`${n}分${d}秒`},F=(s,t)=>s>=80&&t>=50?"success":s>=60&&t>=30?"warning":"danger",N=(s,t)=>s>=80&&t>=50?"优秀":s>=60&&t>=30?"良好":"待提升",I=()=>{U()},U=()=>A(this,null,function*(){try{const[s,t]=i.value,n=yield r.fetchCallStatistics({startDate:s,endDate:t,groupBy:"day"});m.value=n,yield ht(),q()}catch(s){console.error("加载统计数据失败:",s)}}),j=()=>A(this,null,function*(){try{R.value=!0;const[s,t]=i.value,n=yield st({startDate:s,endDate:t,format:"excel"}),d=new Blob([n.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=window.URL.createObjectURL(d),u=document.createElement("a");u.href=c,u.download=`通话数据_${s}_${t}.xlsx`,u.click(),window.URL.revokeObjectURL(c),Y.success("数据导出成功")}catch(s){console.error("导出失败:",s),Y.error("数据导出失败")}finally{R.value=!1}}),z=s=>{console.log("查看用户详情:",s)},q=()=>{G(),K(),P()},G=()=>{var d;if(!b.value||!((d=m.value)!=null&&d.dailyStats))return;const s=T(b.value),t=m.value.dailyStats,n={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["通话数","通话时长(分钟)","接通率(%)"]},xAxis:{type:"category",data:t.map(c=>c.date)},yAxis:[{type:"value",name:"通话数/时长",position:"left"},{type:"value",name:"接通率(%)",position:"right",max:100}],series:[{name:"通话数",type:"line",data:t.map(c=>c.calls),smooth:!0,itemStyle:{color:"#409EFF"}},{name:"通话时长(分钟)",type:"line",data:t.map(c=>Math.round(c.duration/60)),smooth:!0,itemStyle:{color:"#67C23A"}},{name:"接通率(%)",type:"line",yAxisIndex:1,data:t.map(c=>c.connectionRate),smooth:!0,itemStyle:{color:"#E6A23C"}}]};s.setOption(n)},K=()=>{if(!_.value||!m.value)return;const s=T(_.value),{totalCalls:t,connectedCalls:n,missedCalls:d}=m.value,c=t-n-d,u={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{name:"通话状态",type:"pie",radius:"50%",data:[{value:n,name:"已接通",itemStyle:{color:"#67C23A"}},{value:d,name:"未接听",itemStyle:{color:"#E6A23C"}},{value:c,name:"失败/拒接",itemStyle:{color:"#F56C6C"}}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};s.setOption(u)},P=()=>{if(!x.value)return;const s=T(x.value),t=[{time:"09:00",calls:15},{time:"10:00",calls:25},{time:"11:00",calls:30},{time:"14:00",calls:35},{time:"15:00",calls:40},{time:"16:00",calls:32},{time:"17:00",calls:28}],n={tooltip:{trigger:"axis"},xAxis:{type:"category",data:t.map(d=>d.time)},yAxis:{type:"value",name:"通话数"},series:[{name:"通话数",type:"bar",data:t.map(d=>d.calls),itemStyle:{color:new ot(0,0,0,1,[{offset:0,color:"#83bff6"},{offset:.5,color:"#188df0"},{offset:1,color:"#188df0"}])}}]};s.setOption(n)};return _t(()=>A(this,null,function*(){yield U()})),(s,t)=>{const n=f("el-icon"),d=f("el-date-picker"),c=f("el-button"),u=f("el-card"),w=f("el-col"),E=f("el-row"),V=f("el-radio-button"),X=f("el-radio-group"),H=f("el-input"),y=f("el-table-column"),J=f("el-tag"),Q=f("el-table");return yt(),vt("div",bt,[a("div",xt,[a("div",Ct,[a("h1",wt,[e(n,null,{default:l(()=>[e(C(nt))]),_:1}),t[3]||(t[3]=v(" 通话数据汇总 ",-1))]),t[4]||(t[4]=a("p",{class:"page-description"},"查看通话统计、呼出时长、拨打个数等详细数据分析",-1))]),a("div",St,[e(d,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=o=>i.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:I},null,8,["modelValue"]),e(c,{onClick:j,loading:R.value},{default:l(()=>[e(n,null,{default:l(()=>[e(C(it))]),_:1}),t[5]||(t[5]=v(" 导出数据 ",-1))]),_:1},8,["loading"])])]),a("div",Dt,[e(E,{gutter:20},{default:l(()=>[e(w,{span:6},{default:l(()=>[e(u,{class:"metric-card"},{default:l(()=>{var o;return[a("div",Rt,[a("div",kt,[e(n,null,{default:l(()=>[e(C(rt))]),_:1})]),a("div",At,[a("div",Vt,g(((o=m.value)==null?void 0:o.totalCalls)||0),1),t[6]||(t[6]=a("div",{class:"metric-label"},"总通话数",-1)),t[7]||(t[7]=a("div",{class:"metric-trend"},[a("span",{class:"trend-text"},"较昨日 +12%")],-1))])])]}),_:1})]),_:1}),e(w,{span:6},{default:l(()=>[e(u,{class:"metric-card"},{default:l(()=>{var o;return[a("div",Tt,[a("div",Ut,[e(n,null,{default:l(()=>[e(C(dt))]),_:1})]),a("div",Et,[a("div",Lt,g(k(((o=m.value)==null?void 0:o.totalDuration)||0)),1),t[8]||(t[8]=a("div",{class:"metric-label"},"总通话时长",-1)),t[9]||(t[9]=a("div",{class:"metric-trend"},[a("span",{class:"trend-text"},"较昨日 +8%")],-1))])])]}),_:1})]),_:1}),e(w,{span:6},{default:l(()=>[e(u,{class:"metric-card"},{default:l(()=>{var o;return[a("div",Mt,[a("div",Ot,[e(n,null,{default:l(()=>[e(C(ct))]),_:1})]),a("div",$t,[a("div",Yt,g(k(((o=m.value)==null?void 0:o.averageDuration)||0)),1),t[10]||(t[10]=a("div",{class:"metric-label"},"平均通话时长",-1)),t[11]||(t[11]=a("div",{class:"metric-trend"},[a("span",{class:"trend-text"},"较昨日 -2%")],-1))])])]}),_:1})]),_:1}),e(w,{span:6},{default:l(()=>[e(u,{class:"metric-card"},{default:l(()=>{var o;return[a("div",Bt,[a("div",Ft,[e(n,null,{default:l(()=>[e(C(ut))]),_:1})]),a("div",Nt,[a("div",It,g((((o=m.value)==null?void 0:o.connectionRate)||0).toFixed(1))+"%",1),t[12]||(t[12]=a("div",{class:"metric-label"},"接通率",-1)),t[13]||(t[13]=a("div",{class:"metric-trend"},[a("span",{class:"trend-text"},"较昨日 +5%")],-1))])])]}),_:1})]),_:1})]),_:1})]),a("div",jt,[e(E,{gutter:20},{default:l(()=>[e(w,{span:16},{default:l(()=>[e(u,null,{header:l(()=>[a("div",zt,[t[17]||(t[17]=a("span",null,"通话趋势分析",-1)),e(X,{modelValue:S.value,"onUpdate:modelValue":t[1]||(t[1]=o=>S.value=o),size:"small"},{default:l(()=>[e(V,{label:"calls"},{default:l(()=>[...t[14]||(t[14]=[v("通话数",-1)])]),_:1}),e(V,{label:"duration"},{default:l(()=>[...t[15]||(t[15]=[v("时长",-1)])]),_:1}),e(V,{label:"rate"},{default:l(()=>[...t[16]||(t[16]=[v("接通率",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:l(()=>[a("div",{ref_key:"trendChartRef",ref:b,style:{height:"300px"}},null,512)]),_:1})]),_:1}),e(w,{span:8},{default:l(()=>[e(u,null,{header:l(()=>[...t[18]||(t[18]=[a("span",null,"通话状态分布",-1)])]),default:l(()=>[a("div",{ref_key:"statusChartRef",ref:_,style:{height:"300px"}},null,512)]),_:1})]),_:1})]),_:1})]),a("div",qt,[e(u,null,{header:l(()=>[a("div",Gt,[t[19]||(t[19]=a("span",null,"人员通话统计",-1)),e(H,{modelValue:D.value,"onUpdate:modelValue":t[2]||(t[2]=o=>D.value=o),placeholder:"搜索人员姓名",style:{width:"200px"},clearable:""},{prefix:l(()=>[e(n,null,{default:l(()=>[e(C(mt))]),_:1})]),_:1},8,["modelValue"])])]),default:l(()=>[e(Q,{data:B.value,style:{width:"100%"}},{default:l(()=>[e(y,{prop:"userName",label:"姓名",width:"120"}),e(y,{prop:"department",label:"部门",width:"120"}),e(y,{prop:"calls",label:"通话数",width:"100",sortable:""}),e(y,{prop:"duration",label:"通话时长",width:"120",sortable:""},{default:l(({row:o})=>[v(g(k(o.duration)),1)]),_:1}),e(y,{prop:"connectionRate",label:"接通率",width:"100",sortable:""},{default:l(({row:o})=>[v(g(o.connectionRate.toFixed(1))+"% ",1)]),_:1}),e(y,{prop:"avgDuration",label:"平均时长",width:"120",sortable:""},{default:l(({row:o})=>[v(g(k(o.avgDuration||0)),1)]),_:1}),e(y,{label:"效率评级",width:"120"},{default:l(({row:o})=>[e(J,{type:F(o.connectionRate,o.calls)},{default:l(()=>[v(g(N(o.connectionRate,o.calls)),1)]),_:2},1032,["type"])]),_:1}),e(y,{label:"操作",width:"120"},{default:l(({row:o})=>[e(c,{text:"",size:"small",onClick:Xt=>z(o)},{default:l(()=>[...t[20]||(t[20]=[v(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),a("div",Kt,[e(u,null,{header:l(()=>[...t[21]||(t[21]=[a("span",null,"时段通话分析",-1)])]),default:l(()=>[a("div",{ref_key:"timeAnalysisChartRef",ref:x,style:{height:"250px"}},null,512)]),_:1})])])}}}),ee=gt(Pt,[["__scopeId","data-v-bd5d0e70"]]);export{ee as default};
