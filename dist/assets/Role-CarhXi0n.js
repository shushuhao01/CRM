import{u as e,F as a,z as t,_ as i}from"./index-DkAJPKqn.js";import{r as n}from"./roleApiService-pAvzaC49.js";import"./userDataService-WmhE7J4W.js";import{B as s,u as l,l as o,C as c,s as d,F as r,r as m,d as u,A as p,H as y,j as v,aI as g,aJ as h,au as f,T as w,G as b,q as _,ar as k,aK as V,E as C,b as S}from"./elementPlus-DxaqjplL.js";import{l as x,r as $,Z as T,e as U,b as z,ag as A,aq as L,m as P,q as j,p as D,U as I,O,u as R,T as B,M as E,Q as N,S as F,P as q,R as K,F as M,a9 as H}from"./vendor-BtukhyiH.js";import"./utils-DfI7e5Rl.js";const J={class:"role-management"},G={class:"page-header"},Z={class:"header-left"},Q={class:"stats-section"},Y={class:"stat-content"},W={class:"stat-icon primary"},X={class:"stat-info"},ee={class:"stat-number primary"},ae={class:"stat-content"},te={class:"stat-icon success"},ie={class:"stat-info"},ne={class:"stat-number success"},se={class:"stat-content"},le={class:"stat-icon warning"},oe={class:"stat-info"},ce={class:"stat-number warning"},de={class:"header-actions"},re={class:"table-header"},me={class:"table-actions"},ue={class:"pagination-container"},pe={class:"dialog-footer"},ye={class:"permission-setting"},ve={class:"role-info"},ge={class:"permission-tree"},he={class:"tree-node"},fe={class:"dialog-footer"},we={class:"permission-manage"},be={class:"manage-header"},_e={class:"dialog-footer"},ke={class:"user-list-content"},Ve={class:"stat-mini-content"},Ce={class:"stat-mini-info"},Se={class:"stat-mini-value"},xe={class:"stat-mini-content"},$e={class:"stat-mini-info"},Te={class:"stat-mini-value"},Ue={class:"stat-mini-content"},ze={class:"stat-mini-info"},Ae={class:"stat-mini-value"},Le={class:"stat-mini-content"},Pe={class:"stat-mini-info"},je={class:"stat-mini-value"},De={class:"list-header"},Ie={key:0,class:"pagination-container"},Oe={class:"permission-list-content"},Re={class:"stat-mini-content"},Be={class:"stat-mini-info"},Ee={class:"stat-mini-value"},Ne={class:"stat-mini-content"},Fe={class:"stat-mini-info"},qe={class:"stat-mini-value"},Ke={class:"stat-mini-content"},Me={class:"stat-mini-info"},He={class:"stat-mini-value"},Je={class:"stat-mini-content"},Ge={class:"stat-mini-info"},Ze={class:"stat-mini-value"},Qe={class:"list-header"},Ye={key:0,class:"pagination-container"},We=i(x({__name:"Role",setup(i){const x=e(),We=$(!1),Xe=$(!1),ea=$(!1),aa=$(!1),ta=$(!1),ia=$(!1),na=$(!1),sa=$(!1),la=$(!1),oa=$(!1),ca=$(!1),da=$(!1),ra=$([]),ma=$(null),ua=$(null),pa=$([]),ya=$([]),va=$([]),ga=$(""),ha=$(""),fa=$(""),wa=$([]),ba=$(!1),_a=T({page:1,size:10}),ka=$([]),Va=$([]),Ca=$(""),Sa=$(""),xa=$(""),$a=$([]),Ta=$(!1),Ua=T({page:1,size:20}),za=$({total:0,active:0,permissions:0}),Aa=T({name:"",status:"",createTimeRange:[]}),La=T({id:"",name:"",code:"",status:"active",roleType:"custom",description:""}),Pa=T({id:"",parentId:"",name:"",code:"",type:"menu",path:"",icon:"",sort:0,status:"active"}),ja=$([]),Da=$([]),Ia=$([]),Oa=$([]),Ra=T({page:1,size:20,total:0}),Ba={children:"children",label:"name"},Ea={name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"},{pattern:/^[A-Z_]+$/,message:"角色编码只能包含大写字母和下划线",trigger:"blur"}]},Na={name:[{required:!0,message:"请输入权限名称",trigger:"blur"}],code:[{required:!0,message:"请输入权限编码",trigger:"blur"}],type:[{required:!0,message:"请选择权限类型",trigger:"change"}]},Fa=$(),qa=$(),Ka=$(),Ma=U(()=>ca.value?"编辑角色":"新增角色"),Ha=U(()=>da.value?"编辑权限":"新增权限"),Ja=U(()=>{const e=ya.value,a=e.filter(e=>"active"===e.status).length,t=new Set(e.map(e=>e.department)).size,i=e.filter(e=>{if(!e.lastLoginTime||"从未登录"===e.lastLoginTime)return!1;try{const a=new Date(e.lastLoginTime),t=new Date;return t.setDate(t.getDate()-7),a>t}catch{return!1}}).length;return{total:e.length,active:a,departments:t,lastLogin:i}}),Ga=U(()=>{const e=ka.value,a=e.filter(e=>"menu"===e.type).length,t=e.filter(e=>"action"===e.type).length,i=new Set(e.map(e=>e.module)).size;return{total:e.length,menu:a,action:t,modules:i}}),Za=U(()=>{const e=(_a.page-1)*_a.size,a=e+_a.size;return va.value.slice(e,a)}),Qa=U(()=>{const e=(Ua.page-1)*Ua.size,a=e+Ua.size;return Va.value.slice(e,a)}),Ya=U(()=>x.isAdmin),Wa=U(()=>x.isAdmin),Xa=U(()=>x.isAdmin),et=U(()=>x.isAdmin),at=U(()=>x.isAdmin),tt=U(()=>x.isAdmin),it=()=>{ca.value=!1,St(),ta.value=!0},nt=e=>{console.log("[角色权限] 获取角色默认权限:",e);const t=a(e);return console.log("[角色权限] 默认权限数量:",t.length),console.log("[角色权限] 默认权限列表:",t),t},st=()=>{Ut(),na.value=!0},lt=e=>{ca.value=!1,Object.assign(La,{id:"",name:`${e.name}_副本`,code:`${e.code}_COPY`,status:e.status,roleType:e.roleType||"custom",description:e.description}),ta.value=!0},ot=async e=>{const a=e.status,t="active"===a?"inactive":"active",i="active"===t?"启用":"禁用";try{await S.confirm(`确定要${i}角色"${e.name}"吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await n.updateRole({id:e.id,name:e.name,code:e.code,status:t,roleType:e.roleType,description:e.description}),e.status=t,C.success(`${i}成功`),await Tt(),await $t()}catch(s){"cancel"!==s&&(console.error("切换角色状态失败:",s),e.status=a,C.error(`${i}失败，请重试`))}},ct=async e=>{try{await S.confirm(`确定要删除角色"${e.name}"吗？删除后不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await n.deleteRole(e.id),C.success("删除成功"),Tt(),$t()}catch(a){a.message&&"cancel"!==a.message&&(console.error("删除角色失败:",a),C.error("删除失败"))}},dt=async()=>{try{await S.confirm(`确定要删除选中的 ${ra.value.length} 个角色吗？删除后不可恢复！`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=ra.value.map(e=>e.id);await n.batchDeleteRoles(e),C.success("批量删除成功"),ra.value=[],Tt(),$t()}catch(e){e.message&&"cancel"!==e.message&&(console.error("批量删除角色失败:",e),C.error("批量删除失败"))}},rt=async e=>{const a="active"===e?"启用":"禁用";try{await S.confirm(`确定要${a}选中的 ${ra.value.length} 个角色吗？`,`确认批量${a}`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=ra.value.map(e=>e.id);await n.batchUpdateRoleStatus(t,e),C.success(`批量${a}成功`),ra.value=[],Tt(),$t()}catch(t){"cancel"!==t&&(console.error("批量更新角色状态失败:",t),C.error(`批量${a}失败，请重试`))}},mt=()=>{Ra.page=1,Tt()},ut=()=>{Object.assign(Aa,{name:"",status:"",createTimeRange:[]}),mt()},pt=e=>{ra.value=e},yt=e=>{Ra.size=e,Tt()},vt=e=>{Ra.page=e,Tt()},gt=(e,a)=>{if(!Ka.value)return;a.checkedNodes;if(a.checkedKeys.includes(e.id)?e:null){const a=e=>{Ka.value?.setChecked(e.id,!0,!1),e.children&&e.children.length>0&&e.children.forEach(e=>a(e))};a(e)}else{const a=e=>{Ka.value?.setChecked(e.id,!1,!1),e.children&&e.children.length>0&&e.children.forEach(e=>a(e))};a(e)}console.log("权限选择变化:",{permission:e.name,checked:a.checkedKeys.includes(e.id),totalSelected:a.checkedKeys.length})},ht=()=>{if(Ka.value){const e=[],a=t=>{t.forEach(t=>{e.push(t.id),t.children&&a(t.children)})};a(Da.value),Ka.value.setExpandedKeys(e),C.success("已展开所有权限节点")}},ft=()=>{Ka.value&&(Ka.value.setExpandedKeys([]),C.success("已收起所有权限节点"))},wt=()=>{da.value=!1,xt(),sa.value=!0},bt=async()=>{try{await(Fa.value?.validate()),Xe.value=!0,ca.value?(await n.updateRole({id:La.id,name:La.name,code:La.code,description:La.description,status:La.status,roleType:La.roleType}),C.success("角色更新成功")):(await n.createRole({name:La.name,code:La.code,description:La.description,status:La.status,roleType:La.roleType}),C.success("角色创建成功")),Vt(),Tt(),$t()}catch(e){console.error("角色操作失败:",e),C.error(ca.value?"角色更新失败":"角色创建失败")}finally{Xe.value=!1}},_t=async()=>{try{ea.value=!0;const a=Ka.value?.getCheckedKeys();if(!ma.value)return void C.error("未选择角色");console.log("[角色权限] 开始保存权限:",{roleId:ma.value.id,roleName:ma.value.name,permissionCount:a?.length||0});try{const e=JSON.parse(localStorage.getItem("crm_roles")||"[]"),t=e.findIndex(e=>e.id===ma.value.id);if(-1===t)throw new Error(`未找到角色 ID: ${ma.value.id}`);e[t].permissions=a||[],e[t].permissionCount=a?.length||0,e[t].updatedAt=(new Date).toISOString(),localStorage.setItem("crm_roles",JSON.stringify(e)),console.log("[角色权限] 权限保存成功:",{role:e[t].name,permissions:a?.length||0});const i=x.user;!i||i.roleId!==ma.value.code&&i.role!==ma.value.code||(console.log("[角色权限] 当前用户角色匹配,更新用户权限"),x.updatePermissions(a||[])),C.success("权限设置成功"),Ct(),Tt()}catch(e){throw console.error("[角色权限] 保存失败:",e),e}}catch(a){console.error("[角色权限] 权限设置失败:",a),C.error(`权限设置失败: ${a.message||"未知错误"}`)}finally{ea.value=!1}},kt=async()=>{try{await(qa.value?.validate()),aa.value=!0,await new Promise(e=>setTimeout(e,1e3)),C.success(da.value?"权限更新成功":"权限创建成功"),sa.value=!1,xt(),Ut()}catch(e){console.error("表单验证失败:",e)}finally{aa.value=!1}},Vt=()=>{ta.value=!1,Fa.value?.clearValidate(),St()},Ct=()=>{ia.value=!1,ma.value=null,pa.value=[]},St=()=>{Object.assign(La,{id:"",name:"",code:"",status:"active",roleType:"custom",description:""})},xt=()=>{Object.assign(Pa,{id:"",parentId:"",name:"",code:"",type:"menu",path:"",icon:"",sort:0,status:"active"})},$t=async()=>{try{console.log("[角色权限] 开始加载角色统计");const a=await n.getRoles(),i=a.length,s=a.filter(e=>"active"===e.status).length;console.log("[角色权限] 角色统计:",{total:i,active:s});let l=0;try{const e=t.getAllPermissions(),a=e=>{let t=0;return e.forEach(e=>{t++,e.children&&e.children.length>0&&(t+=a(e.children))}),t};l=a(e),console.log("[角色权限] 权限统计:",l)}catch(e){console.error("[角色权限] 获取权限数据失败:",e),l=0}za.value={total:i,active:s,permissions:l},console.log("[角色权限] 统计数据更新完成:",za.value)}catch(e){console.error("[角色权限] 加载角色统计失败:",e);try{const e=localStorage.getItem("crm_roles");if(e){const i=JSON.parse(e),n=i.length,s=i.filter(e=>"active"===e.status).length;let l=0;try{const e=t.getAllPermissions(),a=e=>{let t=0;return e.forEach(e=>{t++,e.children&&e.children.length>0&&(t+=a(e.children))}),t};l=a(e)}catch(a){console.error("[角色权限] 降级方案获取权限失败:",a)}za.value={total:n,active:s,permissions:l},console.log("[角色权限] 使用降级方案,统计数据:",za.value)}else za.value={total:0,active:0,permissions:0}}catch(i){console.error("[角色权限] 降级方案也失败:",i),za.value={total:0,active:0,permissions:0}}}},Tt=async()=>{try{We.value=!0,console.log("[角色权限] 开始加载角色列表");const e=await n.getRoles();console.log("[角色权限] API返回角色数据:",e);let t=[];console.log("[角色权限] 生产环境：应通过API获取用户数据"),t.length>0&&(console.log("[角色权限] 用户角色详情:"),t.forEach((e,a)=>{const t=e.roleId||e.role;console.log(`  ${a+1}. ${e.realName||e.username}:`),console.log(`     - roleId: "${e.roleId}" (主要字段,匹配角色code)`),console.log(`     - role: "${e.role}" (兼容字段)`),console.log(`     - position: "${e.position}" (职位标识,不用于角色匹配)`),console.log(`     - 使用: "${t}"`)}));const i={};t.forEach(e=>{const a=e.roleId||e.role;a&&(i[a]=(i[a]||0)+1)}),console.log("[角色权限] 角色用户统计结果:"),Object.entries(i).forEach(([a,t])=>{const i=e.find(e=>e.code===a);console.log(`  - ${a}: ${t}人 ${i?`✓ 匹配角色: ${i.name}`:"✗ 未匹配到角色"}`)}),console.log("[角色权限] ========== 统计完成 =========="),ja.value=e.map(e=>{const t=a(e.code),n=e.permissions&&e.permissions.length>0?e.permissions:t,s=i[e.code]||0;return console.log(`[角色权限] 处理角色: ${e.name} (code: ${e.code})`),console.log(`  - 默认权限: ${t.length}个`),console.log(`  - 实际权限: ${n.length}个`),console.log(`  - 用户数量: ${s}人 ${0===s?"⚠️ 无用户":"✓"}`),console.log(`  - 角色状态: ${e.status}`),{id:e.id,name:e.name,code:e.code,status:e.status,roleType:e.roleType||"custom",userCount:s,permissionCount:n.length,description:e.description||"",createTime:e.createdAt?new Date(e.createdAt).toLocaleString():"",permissions:n}}),Ra.total=e.length,localStorage.setItem("crm_roles",JSON.stringify(ja.value)),console.log("[角色权限] 角色列表已保存到 localStorage:",{roleCount:ja.value.length,totalUsers:t.length}),ja.value.forEach(e=>{console.log(`[角色权限] 最终角色数据: ${e.name} - 权限:${e.permissionCount}, 用户:${e.userCount}`)})}catch(e){console.error("加载角色列表失败:",e),C.error("加载角色列表失败")}finally{We.value=!1}},Ut=async()=>{try{const e=t.getAllPermissions();Ia.value=e,console.log("所有权限加载成功")}catch(e){console.error("加载所有权限失败:",e),Ia.value=[{id:"system",name:"系统管理",code:"system",type:"menu",path:"/system",icon:"Setting",sort:1,status:"active",children:[{id:"system.user",name:"用户管理",code:"system.user",type:"menu",path:"/system/user",icon:"User",sort:1,status:"active",children:[{id:"system.user.view",name:"查看用户",code:"system.user.view",type:"action",sort:1,status:"active"},{id:"system.user.create",name:"创建用户",code:"system.user.create",type:"action",sort:2,status:"active"},{id:"system.user.edit",name:"编辑用户",code:"system.user.edit",type:"action",sort:3,status:"active"},{id:"system.user.delete",name:"删除用户",code:"system.user.delete",type:"action",sort:4,status:"active"}]},{id:"system.role",name:"角色管理",code:"system.role",type:"menu",path:"/system/role",icon:"UserFilled",sort:2,status:"active",children:[{id:"system.role.view",name:"查看角色",code:"system.role.view",type:"action",sort:1,status:"active"},{id:"system.role.create",name:"创建角色",code:"system.role.create",type:"action",sort:2,status:"active"},{id:"system.role.edit",name:"编辑角色",code:"system.role.edit",type:"action",sort:3,status:"active"},{id:"system.role.delete",name:"删除角色",code:"system.role.delete",type:"action",sort:4,status:"active"}]},{id:"system.permission",name:"权限管理",code:"system.permission",type:"menu",path:"/system/permission",icon:"Lock",sort:3,status:"active",children:[{id:"system.permission.view",name:"查看权限",code:"system.permission.view",type:"action",sort:1,status:"active"},{id:"system.permission.assign",name:"分配权限",code:"system.permission.assign",type:"action",sort:2,status:"active"}]}]},{id:"customer",name:"客户管理",code:"customer",type:"menu",path:"/customer",icon:"Avatar",sort:2,status:"active",children:[{id:"customer.list",name:"客户列表",code:"customer.list",type:"menu",path:"/customer/list",icon:"List",sort:1,status:"active",children:[{id:"customer.list.view",name:"查看客户列表",code:"customer.list.view",type:"action",sort:1,status:"active"},{id:"customer.list.export",name:"导出客户数据",code:"customer.list.export",type:"action",sort:2,status:"active"}]},{id:"customer.detail",name:"客户详情",code:"customer.detail",type:"menu",path:"/customer/detail",icon:"View",sort:2,status:"active",children:[{id:"customer.detail.view",name:"查看客户详情",code:"customer.detail.view",type:"action",sort:1,status:"active"},{id:"customer.detail.edit",name:"编辑客户信息",code:"customer.detail.edit",type:"action",sort:2,status:"active"}]},{id:"customer.manage",name:"客户操作",code:"customer.manage",type:"menu",icon:"Operation",sort:3,status:"active",children:[{id:"customer.manage.create",name:"新增客户",code:"customer.manage.create",type:"action",sort:1,status:"active"},{id:"customer.manage.edit",name:"编辑客户",code:"customer.manage.edit",type:"action",sort:2,status:"active"},{id:"customer.manage.delete",name:"删除客户",code:"customer.manage.delete",type:"action",sort:3,status:"active"},{id:"customer.manage.assign",name:"分配客户",code:"customer.manage.assign",type:"action",sort:4,status:"active"}]}]},{id:"order",name:"订单管理",code:"order",type:"menu",path:"/order",icon:"Document",sort:3,status:"active",children:[{id:"order.list",name:"订单列表",code:"order.list",type:"menu",path:"/order/list",icon:"List",sort:1,status:"active",children:[{id:"order.list.view",name:"查看订单列表",code:"order.list.view",type:"action",sort:1,status:"active"},{id:"order.list.export",name:"导出订单数据",code:"order.list.export",type:"action",sort:2,status:"active"}]},{id:"order.detail",name:"订单详情",code:"order.detail",type:"menu",path:"/order/detail",icon:"View",sort:2,status:"active",children:[{id:"order.detail.view",name:"查看订单详情",code:"order.detail.view",type:"action",sort:1,status:"active"},{id:"order.detail.edit",name:"编辑订单信息",code:"order.detail.edit",type:"action",sort:2,status:"active"}]},{id:"order.manage",name:"订单操作",code:"order.manage",type:"menu",icon:"Operation",sort:3,status:"active",children:[{id:"order.manage.create",name:"新增订单",code:"order.manage.create",type:"action",sort:1,status:"active"},{id:"order.manage.edit",name:"编辑订单",code:"order.manage.edit",type:"action",sort:2,status:"active"},{id:"order.manage.delete",name:"删除订单",code:"order.manage.delete",type:"action",sort:3,status:"active"},{id:"order.manage.approve",name:"审批订单",code:"order.manage.approve",type:"action",sort:4,status:"active"}]}]},{id:"data",name:"数据管理",code:"data",type:"menu",path:"/data",icon:"DataAnalysis",sort:4,status:"active",children:[{id:"data.analysis",name:"数据分析",code:"data.analysis",type:"menu",path:"/data/analysis",icon:"TrendCharts",sort:1,status:"active",children:[{id:"data.analysis.view",name:"查看数据分析",code:"data.analysis.view",type:"action",sort:1,status:"active"},{id:"data.analysis.export",name:"导出分析报告",code:"data.analysis.export",type:"action",sort:2,status:"active"}]},{id:"data.report",name:"报表管理",code:"data.report",type:"menu",path:"/data/report",icon:"Document",sort:2,status:"active",children:[{id:"data.report.view",name:"查看报表",code:"data.report.view",type:"action",sort:1,status:"active"},{id:"data.report.create",name:"创建报表",code:"data.report.create",type:"action",sort:2,status:"active"},{id:"data.report.edit",name:"编辑报表",code:"data.report.edit",type:"action",sort:3,status:"active"}]}]}],Oa.value=zt(Ia.value)}},zt=e=>e.map(e=>({id:e.id,name:e.name,children:e.children?zt(e.children):void 0})),At=()=>{let e=ya.value;if(ga.value){const a=ga.value.toLowerCase();e=e.filter(e=>e.username.toLowerCase().includes(a)||e.realName.toLowerCase().includes(a)||e.email.toLowerCase().includes(a))}ha.value&&(e=e.filter(e=>e.status===ha.value)),fa.value&&(e=e.filter(e=>e.department===fa.value)),va.value=e,_a.page=1},Lt=()=>{let e=ka.value;if(Ca.value){const a=Ca.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(a)||e.code.toLowerCase().includes(a)||e.description.toLowerCase().includes(a))}Sa.value&&(e=e.filter(e=>e.type===Sa.value)),xa.value&&(e=e.filter(e=>e.module===xa.value)),Va.value=e,Ua.page=1},Pt=()=>{try{if(0===va.value.length)return void C.warning("没有可导出的用户数据");const e=va.value.map(e=>({"用户名":e.username,"姓名":e.realName,"邮箱":e.email,"部门":e.department,"职位":e.position,"状态":"active"===e.status?"在职":"离职","最后登录":e.lastLoginTime})),a=Object.keys(e[0]),t=[a.join(","),...e.map(e=>a.map(a=>`"${e[a]}"`).join(","))].join("\n"),i=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),s=URL.createObjectURL(i);n.setAttribute("href",s),n.setAttribute("download",`${ua.value?.name}_用户列表_${(new Date).toLocaleDateString()}.csv`),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),C.success("用户列表导出成功")}catch(e){console.error("导出用户列表失败:",e),C.error("导出失败")}},jt=()=>{try{if(0===Va.value.length)return void C.warning("没有可导出的权限数据");const e=Va.value.map(e=>({"权限名称":e.name,"权限编码":e.code,"类型":"menu"===e.type?"菜单":"操作","所属模块":e.module,"描述":e.description})),a=Object.keys(e[0]),t=[a.join(","),...e.map(e=>a.map(a=>`"${e[a]}"`).join(","))].join("\n"),i=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),s=URL.createObjectURL(i);n.setAttribute("href",s),n.setAttribute("download",`${ua.value?.name}_权限列表_${(new Date).toLocaleDateString()}.csv`),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),C.success("权限列表导出成功")}catch(e){console.error("导出权限列表失败:",e),C.error("导出失败")}},Dt=()=>{la.value=!1,ga.value="",ha.value="",fa.value="",ya.value=[],va.value=[],ua.value=null,_a.page=1},It=()=>{oa.value=!1,Ca.value="",Sa.value="",xa.value="",ka.value=[],Va.value=[],ua.value=null,Ua.page=1};return z(()=>{$t(),Tt(),(async()=>{try{const e=t.getAllPermissions();Da.value=e,console.log("权限树加载成功")}catch(e){console.error("加载权限树失败:",e),Da.value=[{id:"system",name:"系统管理",icon:"Setting",type:"menu",children:[{id:"system.department",name:"部门管理",icon:"OfficeBuilding",type:"menu",children:[{id:"system.department.view",name:"查看部门",type:"action"},{id:"system.department.create",name:"新增部门",type:"action"},{id:"system.department.edit",name:"编辑部门",type:"action"},{id:"system.department.delete",name:"删除部门",type:"action"},{id:"system.department.manage",name:"管理部门",type:"action"}]},{id:"system.user",name:"用户管理",icon:"User",type:"menu",children:[{id:"system.user.view",name:"查看用户",type:"action"},{id:"system.user.create",name:"新增用户",type:"action"},{id:"system.user.edit",name:"编辑用户",type:"action"},{id:"system.user.delete",name:"删除用户",type:"action"},{id:"system.user.resetPassword",name:"重置密码",type:"action"},{id:"system.user.setPermissions",name:"权限设置",type:"action"},{id:"system.user.viewLogs",name:"操作日志",type:"action"}]},{id:"system.role",name:"角色权限",icon:"UserFilled",type:"menu",children:[{id:"system.role.view",name:"查看角色",type:"action"},{id:"system.role.create",name:"新增角色",type:"action"},{id:"system.role.edit",name:"编辑角色",type:"action"},{id:"system.role.delete",name:"删除角色",type:"action"},{id:"system.role.setPermissions",name:"设置权限",type:"action"}]},{id:"system.permission",name:"权限管理",icon:"Lock",type:"menu",children:[{id:"system.permission.view",name:"查看权限",type:"action"},{id:"system.permission.manage",name:"权限管理",type:"action"},{id:"system.permission.roleManage",name:"角色管理",type:"action"},{id:"system.permission.sensitivePermission",name:"敏感权限",type:"action"},{id:"system.permission.customerServiceManage",name:"客服管理",type:"action"}]},{id:"system.superAdmin",name:"超管面板",icon:"Crown",type:"menu",children:[{id:"system.superAdmin.view",name:"查看面板",type:"action"},{id:"system.superAdmin.editPermissions",name:"编辑权限",type:"action"},{id:"system.superAdmin.viewDetails",name:"查看详情",type:"action"},{id:"system.superAdmin.resetPassword",name:"重置密码",type:"action"},{id:"system.superAdmin.memberManage",name:"成员管理",type:"action"},{id:"system.superAdmin.permissionDetails",name:"权限详情",type:"action"}]},{id:"system.customerService",name:"客服管理",icon:"Headset",type:"menu",children:[{id:"system.customerService.view",name:"查看客服",type:"action"},{id:"system.customerService.manage",name:"管理客服",type:"action"},{id:"system.customerService.setPermissions",name:"设置权限",type:"action"},{id:"system.customerService.enableAll",name:"全部启用",type:"action"},{id:"system.customerService.disableAll",name:"全部禁用",type:"action"}]},{id:"system.message",name:"消息管理",icon:"ChatDotSquare",type:"menu",children:[{id:"system.message.view",name:"查看消息",type:"action"},{id:"system.message.send",name:"发送消息",type:"action"},{id:"system.message.delete",name:"删除消息",type:"action"},{id:"system.message.manage",name:"消息管理",type:"action"}]},{id:"system.settings",name:"系统设置",icon:"Tools",type:"menu",children:[{id:"system.settings.view",name:"查看设置",type:"action"},{id:"system.settings.edit",name:"编辑设置",type:"action"},{id:"system.settings.backup",name:"数据备份",type:"action"},{id:"system.settings.restore",name:"数据恢复",type:"action"}]}]},{id:"customer",name:"客户管理",icon:"Avatar",type:"menu",children:[{id:"customer.list",name:"客户列表",icon:"List",type:"menu",children:[{id:"customer.list.view",name:"查看客户",type:"action"},{id:"customer.list.export",name:"导出客户",type:"action"},{id:"customer.list.import",name:"导入客户",type:"action"},{id:"customer.list.edit",name:"编辑客户",type:"action"},{id:"customer.list.delete",name:"删除客户",type:"action"},{id:"customer.list.assign",name:"分配客户",type:"action"},{id:"customer.list.batchOperation",name:"批量操作",type:"action"}]},{id:"customer.add",name:"新增客户",icon:"Plus",type:"menu",children:[{id:"customer.add.create",name:"创建客户",type:"action"}]},{id:"customer.tags",name:"客户标签",icon:"PriceTag",type:"menu",children:[{id:"customer.tags.view",name:"查看标签",type:"action"},{id:"customer.tags.create",name:"新增标签",type:"action"},{id:"customer.tags.edit",name:"编辑标签",type:"action"},{id:"customer.tags.delete",name:"删除标签",type:"action"},{id:"customer.tags.assign",name:"分配标签",type:"action"}]},{id:"customer.groups",name:"客户分组",icon:"Collection",type:"menu",children:[{id:"customer.groups.view",name:"查看分组",type:"action"},{id:"customer.groups.create",name:"新增分组",type:"action"},{id:"customer.groups.edit",name:"编辑分组",type:"action"},{id:"customer.groups.delete",name:"删除分组",type:"action"},{id:"customer.groups.manage",name:"管理分组",type:"action"}]}]},{id:"order",name:"订单管理",icon:"Document",type:"menu",children:[{id:"order.list",name:"订单列表",icon:"List",type:"menu",children:[{id:"order.list.view",name:"查看订单",type:"action"},{id:"order.list.export",name:"导出订单",type:"action"},{id:"order.list.edit",name:"编辑订单",type:"action"},{id:"order.list.delete",name:"删除订单",type:"action"},{id:"order.list.cancel",name:"取消订单",type:"action"},{id:"order.list.batchOperation",name:"批量操作",type:"action"}]},{id:"order.add",name:"新增订单",icon:"Plus",type:"menu",children:[{id:"order.add.create",name:"创建订单",type:"action"}]},{id:"order.audit",name:"订单审核",icon:"DocumentChecked",type:"menu",children:[{id:"order.audit.view",name:"查看审核",type:"action"},{id:"order.audit.approve",name:"通过审核",type:"action"},{id:"order.audit.reject",name:"拒绝审核",type:"action"},{id:"order.audit.revoke",name:"撤销审核",type:"action"},{id:"order.audit.batchAudit",name:"批量审核",type:"action"}]},{id:"order.audit",name:"订单审核",icon:"CircleCheck",type:"menu",children:[{id:"order.audit.view",name:"查看待审核订单",type:"action"},{id:"order.audit.approve",name:"审核通过",type:"action"},{id:"order.audit.reject",name:"审核拒绝",type:"action"},{id:"order.audit.batch",name:"批量审核",type:"action"}]}]},{id:"service",name:"服务管理",icon:"Headset",type:"menu",children:[{id:"service.ticket",name:"工单管理",icon:"Tickets",type:"menu",children:[{id:"service.ticket.view",name:"查看工单",type:"action"},{id:"service.ticket.create",name:"创建工单",type:"action"},{id:"service.ticket.edit",name:"编辑工单",type:"action"},{id:"service.ticket.delete",name:"删除工单",type:"action"},{id:"service.ticket.assign",name:"分配工单",type:"action"},{id:"service.ticket.close",name:"关闭工单",type:"action"},{id:"service.ticket.export",name:"导出工单",type:"action"}]},{id:"service.chat",name:"在线客服",icon:"ChatDotRound",type:"menu",children:[{id:"service.chat.view",name:"查看对话",type:"action"},{id:"service.chat.reply",name:"回复消息",type:"action"},{id:"service.chat.transfer",name:"转接客服",type:"action"},{id:"service.chat.history",name:"查看历史",type:"action"},{id:"service.chat.settings",name:"客服设置",type:"action"}]},{id:"service.knowledge",name:"知识库",icon:"Collection",type:"menu",children:[{id:"service.knowledge.view",name:"查看知识库",type:"action"},{id:"service.knowledge.create",name:"创建文档",type:"action"},{id:"service.knowledge.edit",name:"编辑文档",type:"action"},{id:"service.knowledge.delete",name:"删除文档",type:"action"},{id:"service.knowledge.category",name:"分类管理",type:"action"},{id:"service.knowledge.publish",name:"发布文档",type:"action"}]},{id:"service.call",name:"通话管理",icon:"Phone",type:"menu",children:[{id:"service.call.view",name:"查看通话记录",type:"action"},{id:"service.call.make",name:"发起通话",type:"action"},{id:"service.call.record",name:"录音管理",type:"action"},{id:"service.call.statistics",name:"通话统计",type:"action"}]},{id:"service.sms",name:"短信管理",icon:"Message",type:"menu",children:[{id:"service.sms.view",name:"查看短信记录",type:"action"},{id:"service.sms.send",name:"发送短信",type:"action"},{id:"service.sms.template",name:"模板管理",type:"action"},{id:"service.sms.batch",name:"批量发送",type:"action"},{id:"service.sms.statistics",name:"短信统计",type:"action"}]}]},{id:"performance",name:"业绩统计",icon:"TrendCharts",type:"menu",children:[{id:"performance.personal",name:"个人业绩",icon:"User",type:"menu",children:[{id:"performance.personal.view",name:"查看个人业绩",type:"action"},{id:"performance.personal.export",name:"导出个人数据",type:"action"}]},{id:"performance.team",name:"团队业绩",icon:"UserFilled",type:"menu",children:[{id:"performance.team.view",name:"查看团队业绩",type:"action"},{id:"performance.team.export",name:"导出团队数据",type:"action"},{id:"performance.team.compare",name:"业绩对比",type:"action"}]},{id:"performance.analysis",name:"业绩分析",icon:"DataAnalysis",type:"menu",children:[{id:"performance.analysis.view",name:"查看分析报告",type:"action"},{id:"performance.analysis.trend",name:"趋势分析",type:"action"},{id:"performance.analysis.forecast",name:"业绩预测",type:"action"}]},{id:"performance.share",name:"业绩分享",icon:"Share",type:"menu",children:[{id:"performance.share.view",name:"查看分享",type:"action"},{id:"performance.share.create",name:"创建分享",type:"action"},{id:"performance.share.manage",name:"管理分享",type:"action"}]}]},{id:"logistics",name:"物流管理",icon:"Van",type:"menu",children:[{id:"logistics.list",name:"物流列表",icon:"List",type:"menu",children:[{id:"logistics.list.view",name:"查看物流列表",type:"action"},{id:"logistics.list.export",name:"导出物流数据",type:"action"}]},{id:"logistics.track",name:"物流跟踪",icon:"Position",type:"menu",children:[{id:"logistics.track.view",name:"查看跟踪信息",type:"action"},{id:"logistics.track.update",name:"更新跟踪状态",type:"action"}]},{id:"logistics.companies",name:"物流公司",icon:"OfficeBuilding",type:"menu",children:[{id:"logistics.companies.view",name:"查看物流公司",type:"action"},{id:"logistics.companies.create",name:"添加物流公司",type:"action"},{id:"logistics.companies.edit",name:"编辑物流公司",type:"action"},{id:"logistics.companies.delete",name:"删除物流公司",type:"action"}]},{id:"logistics.shipping",name:"发货列表",icon:"Box",type:"menu",children:[{id:"logistics.shipping.view",name:"查看发货列表",type:"action"},{id:"logistics.shipping.create",name:"创建发货单",type:"action"},{id:"logistics.shipping.edit",name:"编辑发货单",type:"action"},{id:"logistics.shipping.batchExport",name:"批量导出",type:"action"}]},{id:"logistics.status",name:"状态更新",icon:"Refresh",type:"menu",children:[{id:"logistics.status.view",name:"查看状态",type:"action"},{id:"logistics.status.update",name:"更新状态",type:"action"},{id:"logistics.status.batch",name:"批量更新",type:"action"}]}]},{id:"afterSales",name:"售后管理",icon:"Tools",type:"menu",children:[{id:"afterSales.list",name:"售后订单",icon:"List",type:"menu",children:[{id:"afterSales.list.view",name:"查看售后订单",type:"action"},{id:"afterSales.list.export",name:"导出售后数据",type:"action"}]},{id:"afterSales.add",name:"新建售后",icon:"Plus",type:"menu",children:[{id:"afterSales.add.create",name:"创建售后单",type:"action"},{id:"afterSales.add.batch",name:"批量创建",type:"action"}]},{id:"afterSales.detail",name:"售后详情",icon:"View",type:"menu",children:[{id:"afterSales.detail.view",name:"查看售后详情",type:"action"},{id:"afterSales.detail.edit",name:"编辑售后单",type:"action"},{id:"afterSales.detail.process",name:"处理售后",type:"action"}]},{id:"afterSales.data",name:"售后数据",icon:"DataAnalysis",type:"menu",children:[{id:"afterSales.data.view",name:"查看售后数据",type:"action"},{id:"afterSales.data.analysis",name:"售后分析",type:"action"},{id:"afterSales.data.report",name:"售后报告",type:"action"}]}]},{id:"data",name:"资料管理",icon:"FolderOpened",type:"menu",children:[{id:"data.list",name:"资料列表",icon:"List",type:"menu",children:[{id:"data.list.view",name:"查看资料列表",type:"action"},{id:"data.list.export",name:"导出资料",type:"action"},{id:"data.list.import",name:"导入资料",type:"action"},{id:"data.list.assign",name:"分配资料",type:"action"}]},{id:"data.search",name:"客户查询",icon:"Search",type:"menu",children:[{id:"data.search.basic",name:"基础查询",type:"action"},{id:"data.search.advanced",name:"高级查询",type:"action"},{id:"data.search.export",name:"导出查询结果",type:"action"}]},{id:"data.recycle",name:"回收站",icon:"Delete",type:"menu",children:[{id:"data.recycle.view",name:"查看回收站",type:"action"},{id:"data.recycle.restore",name:"恢复数据",type:"action"},{id:"data.recycle.delete",name:"彻底删除",type:"action"}]}]},{id:"product",name:"商品管理",icon:"Goods",type:"menu",children:[{id:"product.list",name:"商品列表",icon:"List",type:"menu",children:[{id:"product.list.view",name:"查看商品",type:"action"},{id:"product.list.export",name:"导出商品",type:"action"},{id:"product.list.edit",name:"编辑商品",type:"action"},{id:"product.list.delete",name:"删除商品",type:"action"},{id:"product.list.batchOperation",name:"批量操作",type:"action"},{id:"product.list.priceAdjust",name:"价格调整",type:"action"}]},{id:"product.add",name:"新增商品",icon:"Plus",type:"menu",children:[{id:"product.add.create",name:"创建商品",type:"action"},{id:"product.add.batchAdd",name:"批量新增",type:"action"}]},{id:"product.category",name:"商品分类",icon:"Collection",type:"menu",children:[{id:"product.category.view",name:"查看分类",type:"action"},{id:"product.category.create",name:"新增分类",type:"action"},{id:"product.category.edit",name:"编辑分类",type:"action"},{id:"product.category.delete",name:"删除分类",type:"action"},{id:"product.category.manage",name:"管理分类",type:"action"}]},{id:"product.inventory",name:"库存管理",icon:"Box",type:"menu",children:[{id:"product.inventory.view",name:"查看库存",type:"action"},{id:"product.inventory.adjust",name:"调整库存",type:"action"},{id:"product.inventory.inbound",name:"入库操作",type:"action"},{id:"product.inventory.outbound",name:"出库操作",type:"action"},{id:"product.inventory.transfer",name:"转移库存",type:"action"},{id:"product.inventory.alert",name:"预警设置",type:"action"}]},{id:"product.analytics",name:"商品分析",icon:"DataAnalysis",type:"menu",children:[{id:"product.analytics.view",name:"查看分析",type:"action"},{id:"product.analytics.sales",name:"销售分析",type:"action"},{id:"product.analytics.profit",name:"利润分析",type:"action"},{id:"product.analytics.trend",name:"趋势分析",type:"action"},{id:"product.analytics.exportReport",name:"导出报表",type:"action"}]}]},{id:"data",name:"资料管理",icon:"FolderOpened",type:"menu",children:[{id:"data.list",name:"资料列表",icon:"List",type:"menu",children:[{id:"data.list.view",name:"查看资料列表",type:"action"},{id:"data.list.export",name:"导出资料",type:"action"},{id:"data.list.import",name:"导入资料",type:"action"},{id:"data.list.assign",name:"分配资料",type:"action"}]},{id:"data.search",name:"客户查询",icon:"Search",type:"menu",children:[{id:"data.search.basic",name:"基础查询",type:"action"},{id:"data.search.advanced",name:"高级查询",type:"action"},{id:"data.search.export",name:"导出查询结果",type:"action"}]},{id:"data.recycle",name:"回收站",icon:"Delete",type:"menu",children:[{id:"data.recycle.view",name:"查看回收站",type:"action"},{id:"data.recycle.restore",name:"恢复数据",type:"action"},{id:"data.recycle.delete",name:"彻底删除",type:"action"}]}]},{id:"performance",name:"业绩统计",icon:"TrendCharts",type:"menu",children:[{id:"performance.personal",name:"个人业绩",icon:"User",type:"menu",children:[{id:"performance.personal.view",name:"查看个人业绩",type:"action"},{id:"performance.personal.export",name:"导出个人数据",type:"action"}]},{id:"performance.team",name:"团队业绩",icon:"UserFilled",type:"menu",children:[{id:"performance.team.view",name:"查看团队业绩",type:"action"},{id:"performance.team.export",name:"导出团队数据",type:"action"},{id:"performance.team.compare",name:"业绩对比",type:"action"}]},{id:"performance.analysis",name:"业绩分析",icon:"DataAnalysis",type:"menu",children:[{id:"performance.analysis.view",name:"查看分析报告",type:"action"},{id:"performance.analysis.trend",name:"趋势分析",type:"action"},{id:"performance.analysis.forecast",name:"业绩预测",type:"action"}]},{id:"performance.share",name:"业绩分享",icon:"Share",type:"menu",children:[{id:"performance.share.view",name:"查看分享",type:"action"},{id:"performance.share.create",name:"创建分享",type:"action"},{id:"performance.share.manage",name:"管理分享",type:"action"}]}]},{id:"afterSales",name:"售后管理",icon:"Tools",type:"menu",children:[{id:"afterSales.list",name:"售后订单",icon:"List",type:"menu",children:[{id:"afterSales.list.view",name:"查看售后订单",type:"action"},{id:"afterSales.list.export",name:"导出售后数据",type:"action"}]},{id:"afterSales.add",name:"新建售后",icon:"Plus",type:"menu",children:[{id:"afterSales.add.create",name:"创建售后单",type:"action"},{id:"afterSales.add.batch",name:"批量创建",type:"action"}]},{id:"afterSales.detail",name:"售后详情",icon:"View",type:"menu",children:[{id:"afterSales.detail.view",name:"查看售后详情",type:"action"},{id:"afterSales.detail.edit",name:"编辑售后单",type:"action"},{id:"afterSales.detail.process",name:"处理售后",type:"action"}]},{id:"afterSales.data",name:"售后数据",icon:"DataAnalysis",type:"menu",children:[{id:"afterSales.data.view",name:"查看售后数据",type:"action"},{id:"afterSales.data.analysis",name:"售后分析",type:"action"},{id:"afterSales.data.report",name:"售后报告",type:"action"}]}]},{id:"logistics",name:"物流管理",icon:"Van",type:"menu",children:[{id:"logistics.list",name:"物流列表",icon:"List",type:"menu",children:[{id:"logistics.list.view",name:"查看物流列表",type:"action"},{id:"logistics.list.export",name:"导出物流数据",type:"action"}]},{id:"logistics.track",name:"物流跟踪",icon:"Position",type:"menu",children:[{id:"logistics.track.view",name:"查看跟踪信息",type:"action"},{id:"logistics.track.update",name:"更新跟踪状态",type:"action"}]},{id:"logistics.companies",name:"物流公司",icon:"OfficeBuilding",type:"menu",children:[{id:"logistics.companies.view",name:"查看物流公司",type:"action"},{id:"logistics.companies.create",name:"添加物流公司",type:"action"},{id:"logistics.companies.edit",name:"编辑物流公司",type:"action"},{id:"logistics.companies.delete",name:"删除物流公司",type:"action"}]},{id:"logistics.shipping",name:"发货列表",icon:"Box",type:"menu",children:[{id:"logistics.shipping.view",name:"查看发货列表",type:"action"},{id:"logistics.shipping.create",name:"创建发货单",type:"action"},{id:"logistics.shipping.edit",name:"编辑发货单",type:"action"},{id:"logistics.shipping.batchExport",name:"批量导出",type:"action"}]},{id:"logistics.status",name:"状态更新",icon:"Refresh",type:"menu",children:[{id:"logistics.status.view",name:"查看状态",type:"action"},{id:"logistics.status.update",name:"更新状态",type:"action"},{id:"logistics.status.batch",name:"批量更新",type:"action"}]}]}]}finally{Oa.value=zt(Da.value)}})()}),(e,a)=>{const i=A("el-icon"),x=A("el-card"),$=A("el-button"),T=A("el-input"),U=A("el-form-item"),z=A("el-option"),St=A("el-select"),xt=A("el-date-picker"),$t=A("el-form"),zt=A("el-table-column"),Ot=A("el-tag"),Rt=A("el-link"),Bt=A("el-dropdown-item"),Et=A("el-dropdown-menu"),Nt=A("el-dropdown"),Ft=A("el-table"),qt=A("el-pagination"),Kt=A("el-radio"),Mt=A("el-radio-group"),Ht=A("el-dialog"),Jt=A("el-divider"),Gt=A("el-tree"),Zt=A("el-tree-select"),Qt=A("el-input-number"),Yt=A("el-col"),Wt=A("el-row"),Xt=L("loading");return j(),P("div",J,[D("div",G,[D("div",Z,[a[43]||(a[43]=D("h2",null,"角色权限管理",-1)),D("div",Q,[I(x,{class:"stat-card primary",shadow:"hover"},{default:O(()=>[D("div",Y,[D("div",W,[I(i,null,{default:O(()=>[I(R(s))]),_:1})]),D("div",X,[D("div",ee,B(za.value.total),1),a[37]||(a[37]=D("div",{class:"stat-title"},"角色总数",-1)),a[38]||(a[38]=D("div",{class:"stat-desc"},"系统中所有角色数量",-1))])])]),_:1}),I(x,{class:"stat-card success",shadow:"hover"},{default:O(()=>[D("div",ae,[D("div",te,[I(i,null,{default:O(()=>[I(R(l))]),_:1})]),D("div",ie,[D("div",ne,B(za.value.active),1),a[39]||(a[39]=D("div",{class:"stat-title"},"启用角色",-1)),a[40]||(a[40]=D("div",{class:"stat-desc"},"当前启用的角色数量",-1))])])]),_:1}),I(x,{class:"stat-card warning",shadow:"hover"},{default:O(()=>[D("div",se,[D("div",le,[I(i,null,{default:O(()=>[I(R(o))]),_:1})]),D("div",oe,[D("div",ce,B(za.value.permissions),1),a[41]||(a[41]=D("div",{class:"stat-title"},"权限总数",-1)),a[42]||(a[42]=D("div",{class:"stat-desc"},"系统中所有权限数量",-1))])])]),_:1})])]),D("div",de,[Ya.value?(j(),E($,{key:0,onClick:it,type:"primary",icon:R(c)},{default:O(()=>[...a[44]||(a[44]=[F(" 新增角色 ",-1)])]),_:1},8,["icon"])):N("",!0),et.value?(j(),E($,{key:1,onClick:st,icon:R(d)},{default:O(()=>[...a[45]||(a[45]=[F(" 权限管理 ",-1)])]),_:1},8,["icon"])):N("",!0)])]),I(x,{class:"search-card"},{default:O(()=>[I($t,{model:Aa,inline:""},{default:O(()=>[I(U,{label:"角色名称"},{default:O(()=>[I(T,{modelValue:Aa.name,"onUpdate:modelValue":a[0]||(a[0]=e=>Aa.name=e),placeholder:"请输入角色名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),I(U,{label:"状态"},{default:O(()=>[I(St,{modelValue:Aa.status,"onUpdate:modelValue":a[1]||(a[1]=e=>Aa.status=e),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:O(()=>[I(z,{label:"启用",value:"active"}),I(z,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),I(U,{label:"创建时间"},{default:O(()=>[I(xt,{modelValue:Aa.createTimeRange,"onUpdate:modelValue":a[2]||(a[2]=e=>Aa.createTimeRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),I(U,null,{default:O(()=>[I($,{onClick:mt,type:"primary",icon:R(r)},{default:O(()=>[...a[46]||(a[46]=[F(" 搜索 ",-1)])]),_:1},8,["icon"]),I($,{onClick:ut,icon:R(m)},{default:O(()=>[...a[47]||(a[47]=[F(" 重置 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),I(x,{class:"table-card"},{header:O(()=>[D("div",re,[a[51]||(a[51]=D("span",null,"角色列表",-1)),D("div",me,[Xa.value?(j(),E($,{key:0,onClick:dt,disabled:!ra.value.length,type:"danger",size:"small",icon:R(p)},{default:O(()=>[...a[48]||(a[48]=[F(" 批量删除 ",-1)])]),_:1},8,["disabled","icon"])):N("",!0),tt.value?(j(),E($,{key:1,onClick:a[3]||(a[3]=e=>rt("active")),disabled:!ra.value.length,size:"small",icon:R(y)},{default:O(()=>[...a[49]||(a[49]=[F(" 批量启用 ",-1)])]),_:1},8,["disabled","icon"])):N("",!0),tt.value?(j(),E($,{key:2,onClick:a[4]||(a[4]=e=>rt("inactive")),disabled:!ra.value.length,size:"small",icon:R(v)},{default:O(()=>[...a[50]||(a[50]=[F(" 批量禁用 ",-1)])]),_:1},8,["disabled","icon"])):N("",!0)])])]),default:O(()=>[q((j(),E(Ft,{data:ja.value,onSelectionChange:pt,style:{width:"100%"}},{default:O(()=>[I(zt,{type:"selection",width:"55"}),I(zt,{prop:"name",label:"角色名称",width:"150"}),I(zt,{prop:"code",label:"角色编码",width:"150"}),I(zt,{label:"状态",width:"100"},{default:O(({row:e})=>[I(Ot,{type:"active"===e.status?"success":"danger",size:"small"},{default:O(()=>[F(B("active"===e.status?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),I(zt,{label:"角色类型",width:"140"},{default:O(({row:e})=>[I(St,{modelValue:e.roleType,"onUpdate:modelValue":a=>e.roleType=a,size:"small",onChange:a=>(async e=>{try{await n.updateRole({id:e.id,name:e.name,code:e.code,status:e.status,roleType:e.roleType,description:e.description}),C.success("角色类型更新成功"),await Tt()}catch(a){console.error("更新角色类型失败:",a),C.error("更新角色类型失败，请重试"),await Tt()}})(e),disabled:!Wa.value},{default:O(()=>[I(z,{label:"系统角色",value:"system"}),I(z,{label:"业务角色",value:"business"}),I(z,{label:"临时角色",value:"temporary"}),I(z,{label:"自定义角色",value:"custom"})]),_:1},8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_:1}),I(zt,{label:"用户数量",width:"100"},{default:O(({row:e})=>[I(Rt,{onClick:a=>(async e=>{console.log("[角色权限] 查看角色用户:",e),ua.value=e,ba.value=!0,la.value=!0,ga.value="",ha.value="",fa.value="",_a.page=1;try{let a=[];console.log("[角色权限] 生产环境：应通过API获取用户数据"),console.log("[角色权限] 查找角色:",e.code);const t=a.filter(a=>{const t=a.roleId||a.role;return console.log(`[角色权限] 用户 ${a.username} 的角色: ${t}`),t===e.code}).map(e=>({id:e.id,username:e.username,realName:e.realName||e.name||e.username,email:e.email||`${e.username}@example.com`,department:e.departmentName||e.department||"未分配",position:e.position||"员工",status:e.status||"active",lastLoginTime:e.lastLoginTime||"从未登录"}));console.log("[角色权限] 筛选后的用户:",t.length),ya.value=t,va.value=t;const i=new Set(t.map(e=>e.department));wa.value=Array.from(i).filter(e=>"未分配"!==e),t.length>0?C.success(`成功加载 ${t.length} 个用户`):C.info("该角色暂无用户")}catch(a){console.error("获取角色用户失败:",a),C.error("获取用户列表失败"),ya.value=[],va.value=[]}finally{ba.value=!1}})(e),type:"primary"},{default:O(()=>[F(B(e.userCount),1)]),_:2},1032,["onClick"])]),_:1}),I(zt,{label:"权限数量",width:"100"},{default:O(({row:e})=>[I(Rt,{onClick:a=>(async e=>{console.log("[角色权限] 查看角色权限:",e),ua.value=e,Ta.value=!0,oa.value=!0,Ca.value="",Sa.value="",xa.value="",Ua.page=1;try{const a=e.permissions||[];console.log("[角色权限] 角色权限ID列表:",a.length);const i=t.getAllPermissions();console.log("[角色权限] 所有权限数据:",i.length);const n=[],s=(e,a,t="")=>{for(const i of e){const e=t||i.name;if(i.id===a)return{...i,module:e};if(i.children&&i.children.length>0){const t=s(i.children,a,e);if(t)return t}}return null};a.forEach(e=>{const a=s(i,e);a&&n.push({id:a.id,name:a.name,code:a.code||a.id,type:a.type||"menu",module:a.module||"系统",description:a.description||a.name,path:a.path||""})}),console.log("[角色权限] 权限详情:",n.length),ka.value=n,Va.value=n;const l=new Set(n.map(e=>e.module));$a.value=Array.from(l),n.length>0?C.success(`成功加载 ${n.length} 个权限`):C.info("该角色暂无权限")}catch(a){console.error("获取角色权限失败:",a),C.error("获取权限列表失败"),ka.value=[],Va.value=[]}finally{Ta.value=!1}})(e),type:"primary"},{default:O(()=>[F(B(e.permissionCount),1)]),_:2},1032,["onClick"])]),_:1}),I(zt,{prop:"description",label:"描述","show-overflow-tooltip":""}),I(zt,{prop:"createTime",label:"创建时间",width:"160"}),I(zt,{label:"操作",width:"200",fixed:"right"},{default:O(({row:e})=>[Wa.value?(j(),E($,{key:0,onClick:a=>(e=>{ca.value=!0,Object.assign(La,{id:e.id,name:e.name,code:e.code,status:e.status,roleType:e.roleType||"custom",description:e.description}),ta.value=!0})(e),type:"primary",size:"small",link:""},{default:O(()=>[...a[52]||(a[52]=[F(" 编辑 ",-1)])]),_:1},8,["onClick"])):N("",!0),at.value?(j(),E($,{key:1,onClick:a=>(e=>{console.log("[角色权限] 开始配置权限:",e),ma.value=e;let a=e.permissions||[];a.length||(console.log("[角色权限] 角色权限为空,从默认配置加载:",e.code),a=nt(e.code||e.name)),console.log("[角色权限] 配置权限详情:",{roleId:e.id,roleName:e.name,roleCode:e.code,originalPermissions:e.permissions?.length||0,defaultPermissions:a.length,permissions:a}),pa.value=a,ia.value=!0,setTimeout(()=>{if(console.log("[角色权限] 开始设置权限树选中状态"),console.log("[角色权限] 权限树引用:",!!Ka.value),console.log("[角色权限] 权限数量:",a.length),console.log("[角色权限] 权限列表:",a),Ka.value)if(a.length>0)try{Ka.value.setCheckedKeys(a),console.log("✅ 权限树选中状态设置成功:",a);const e=Ka.value.getCheckedKeys();console.log("✅ 验证选中结果:",e),0===e.length&&(console.error("❌ 权限树选中失败,尝试使用 setChecked 方法"),a.forEach(e=>{try{Ka.value.setChecked(e,!0,!1)}catch(a){console.error(`设置权限 ${e} 失败:`,a)}}))}catch(e){console.error("❌ 设置权限树选中状态失败:",e)}else console.warn("⚠️ 权限列表为空,无法设置选中状态");else console.error("❌ 权限树组件引用未找到")},1e3)})(e),type:"primary",size:"small",link:""},{default:O(()=>[...a[53]||(a[53]=[F(" 权限设置 ",-1)])]),_:1},8,["onClick"])):N("",!0),Wa.value||Xa.value?(j(),E(Nt,{key:2,onCommand:a=>((e,a)=>{switch(e){case"copy":lt(a);break;case"toggle":ot(a);break;case"delete":ct(a)}})(a,e)},{dropdown:O(()=>[I(Et,null,{default:O(()=>[Wa.value?(j(),E(Bt,{key:0,command:"copy"},{default:O(()=>[...a[55]||(a[55]=[F(" 复制角色 ",-1)])]),_:1})):N("",!0),Wa.value?(j(),E(Bt,{key:1,command:"toggle"},{default:O(()=>[F(B("active"===e.status?"禁用":"启用"),1)]),_:2},1024)):N("",!0),Xa.value?(j(),E(Bt,{key:2,command:"delete",divided:"",class:"danger-item"},{default:O(()=>[...a[56]||(a[56]=[F(" 删除 ",-1)])]),_:1})):N("",!0)]),_:2},1024)]),default:O(()=>[I($,{type:"primary",size:"small",link:""},{default:O(()=>[a[54]||(a[54]=F(" 更多",-1)),I(i,{class:"el-icon--right"},{default:O(()=>[I(R(u))]),_:1})]),_:1})]),_:2},1032,["onCommand"])):N("",!0)]),_:1})]),_:1},8,["data"])),[[Xt,We.value]]),D("div",ue,[I(qt,{"current-page":Ra.page,"onUpdate:currentPage":a[5]||(a[5]=e=>Ra.page=e),"page-size":Ra.size,"onUpdate:pageSize":a[6]||(a[6]=e=>Ra.size=e),"page-sizes":[10,20,50,100],total:Ra.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:yt,onCurrentChange:vt},null,8,["current-page","page-size","total"])])]),_:1}),I(Ht,{modelValue:ta.value,"onUpdate:modelValue":a[12]||(a[12]=e=>ta.value=e),title:Ma.value,width:"600px","before-close":Vt},{footer:O(()=>[D("span",pe,[I($,{onClick:Vt},{default:O(()=>[...a[59]||(a[59]=[F("取消",-1)])]),_:1}),I($,{onClick:bt,type:"primary",loading:Xe.value},{default:O(()=>[...a[60]||(a[60]=[F(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:O(()=>[I($t,{ref_key:"roleFormRef",ref:Fa,model:La,rules:Ea,"label-width":"100px"},{default:O(()=>[I(U,{label:"角色名称",prop:"name"},{default:O(()=>[I(T,{modelValue:La.name,"onUpdate:modelValue":a[7]||(a[7]=e=>La.name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),I(U,{label:"角色编码",prop:"code"},{default:O(()=>[I(T,{modelValue:La.code,"onUpdate:modelValue":a[8]||(a[8]=e=>La.code=e),placeholder:"请输入角色编码",disabled:ca.value},null,8,["modelValue","disabled"])]),_:1}),I(U,{label:"角色类型",prop:"roleType"},{default:O(()=>[I(St,{modelValue:La.roleType,"onUpdate:modelValue":a[9]||(a[9]=e=>La.roleType=e),placeholder:"请选择角色类型"},{default:O(()=>[I(z,{label:"系统角色",value:"system"}),I(z,{label:"业务角色",value:"business"}),I(z,{label:"临时角色",value:"temporary"}),I(z,{label:"自定义角色",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),I(U,{label:"状态",prop:"status"},{default:O(()=>[I(Mt,{modelValue:La.status,"onUpdate:modelValue":a[10]||(a[10]=e=>La.status=e)},{default:O(()=>[I(Kt,{label:"active"},{default:O(()=>[...a[57]||(a[57]=[F("启用",-1)])]),_:1}),I(Kt,{label:"inactive"},{default:O(()=>[...a[58]||(a[58]=[F("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),I(U,{label:"描述",prop:"description"},{default:O(()=>[I(T,{modelValue:La.description,"onUpdate:modelValue":a[11]||(a[11]=e=>La.description=e),type:"textarea",rows:3,placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),I(Ht,{modelValue:ia.value,"onUpdate:modelValue":a[13]||(a[13]=e=>ia.value=e),title:"权限设置",width:"800px","before-close":Ct},{footer:O(()=>[D("span",fe,[I($,{onClick:Ct},{default:O(()=>[...a[61]||(a[61]=[F("取消",-1)])]),_:1}),I($,{onClick:_t,type:"primary",loading:ea.value},{default:O(()=>[...a[62]||(a[62]=[F(" 保存权限 ",-1)])]),_:1},8,["loading"])])]),default:O(()=>[D("div",ye,[D("div",ve,[D("h4",null,"角色："+B(ma.value?.name),1),D("p",null,B(ma.value?.description),1)]),I(Jt),D("div",ge,[I(Gt,{ref_key:"permissionTreeRef",ref:Ka,data:Da.value,props:Ba,"show-checkbox":"","node-key":"id","default-checked-keys":pa.value,"check-strictly":!0,onCheck:gt},{default:O(({node:e,data:a})=>[D("span",he,[a.icon?(j(),E(i,{key:0,class:"node-icon"},{default:O(()=>[(j(),E(K(a.icon)))]),_:2},1024)):N("",!0),D("span",null,B(a.name),1),a.type?(j(),E(Ot,{key:1,size:"small",class:"node-tag"},{default:O(()=>[F(B(a.type),1)]),_:2},1024)):N("",!0)])]),_:1},8,["data","default-checked-keys"])])])]),_:1},8,["modelValue"]),I(Ht,{modelValue:na.value,"onUpdate:modelValue":a[14]||(a[14]=e=>na.value=e),title:"权限管理",width:"1000px"},{default:O(()=>[D("div",we,[D("div",be,[I($,{onClick:wt,type:"primary",icon:R(c)},{default:O(()=>[...a[63]||(a[63]=[F(" 新增权限 ",-1)])]),_:1},8,["icon"]),I($,{onClick:ht,icon:R(g)},{default:O(()=>[...a[64]||(a[64]=[F(" 展开全部 ",-1)])]),_:1},8,["icon"]),I($,{onClick:ft,icon:R(h)},{default:O(()=>[...a[65]||(a[65]=[F(" 收起全部 ",-1)])]),_:1},8,["icon"])]),I(Ft,{data:Ia.value,"row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},style:{width:"100%","margin-top":"20px"}},{default:O(()=>[I(zt,{prop:"name",label:"权限名称",width:"200"}),I(zt,{prop:"code",label:"权限编码",width:"200"}),I(zt,{label:"类型",width:"100"},{default:O(({row:e})=>{return[I(Ot,{type:(a=e.type,{menu:"primary",button:"success",api:"warning"}[a]||""),size:"small"},{default:O(()=>[F(B(e.type),1)]),_:2},1032,["type"])];var a}),_:1}),I(zt,{prop:"path",label:"路径","show-overflow-tooltip":""}),I(zt,{label:"状态",width:"80"},{default:O(({row:e})=>[I(Ot,{type:"active"===e.status?"success":"danger",size:"small"},{default:O(()=>[F(B("active"===e.status?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),I(zt,{label:"操作",width:"150"},{default:O(({row:e})=>[I($,{onClick:a=>(e=>{da.value=!0,Object.assign(Pa,{id:e.id,parentId:e.parentId,name:e.name,code:e.code,type:e.type,path:e.path,icon:e.icon,sort:e.sort,status:e.status}),sa.value=!0})(e),type:"primary",size:"small",link:""},{default:O(()=>[...a[66]||(a[66]=[F(" 编辑 ",-1)])]),_:1},8,["onClick"]),I($,{onClick:a=>(async e=>{try{await S.confirm(`确定要删除权限"${e.name}"吗？删除后不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await new Promise(e=>setTimeout(e,500)),C.success("删除成功"),Ut()}catch(a){}})(e),type:"danger",size:"small",link:""},{default:O(()=>[...a[67]||(a[67]=[F(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1},8,["modelValue"]),I(Ht,{modelValue:sa.value,"onUpdate:modelValue":a[24]||(a[24]=e=>sa.value=e),title:Ha.value,width:"500px"},{footer:O(()=>[D("span",_e,[I($,{onClick:a[23]||(a[23]=e=>sa.value=!1)},{default:O(()=>[...a[70]||(a[70]=[F("取消",-1)])]),_:1}),I($,{onClick:kt,type:"primary",loading:aa.value},{default:O(()=>[...a[71]||(a[71]=[F(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:O(()=>[I($t,{ref_key:"permissionFormRef",ref:qa,model:Pa,rules:Na,"label-width":"100px"},{default:O(()=>[I(U,{label:"上级权限",prop:"parentId"},{default:O(()=>[I(Zt,{modelValue:Pa.parentId,"onUpdate:modelValue":a[15]||(a[15]=e=>Pa.parentId=e),data:Oa.value,props:{label:"name",value:"id"},placeholder:"请选择上级权限",clearable:"","check-strictly":""},null,8,["modelValue","data"])]),_:1}),I(U,{label:"权限名称",prop:"name"},{default:O(()=>[I(T,{modelValue:Pa.name,"onUpdate:modelValue":a[16]||(a[16]=e=>Pa.name=e),placeholder:"请输入权限名称"},null,8,["modelValue"])]),_:1}),I(U,{label:"权限编码",prop:"code"},{default:O(()=>[I(T,{modelValue:Pa.code,"onUpdate:modelValue":a[17]||(a[17]=e=>Pa.code=e),placeholder:"请输入权限编码"},null,8,["modelValue"])]),_:1}),I(U,{label:"权限类型",prop:"type"},{default:O(()=>[I(St,{modelValue:Pa.type,"onUpdate:modelValue":a[18]||(a[18]=e=>Pa.type=e),placeholder:"请选择权限类型"},{default:O(()=>[I(z,{label:"菜单",value:"menu"}),I(z,{label:"按钮",value:"button"}),I(z,{label:"接口",value:"api"})]),_:1},8,["modelValue"])]),_:1}),I(U,{label:"路径",prop:"path"},{default:O(()=>[I(T,{modelValue:Pa.path,"onUpdate:modelValue":a[19]||(a[19]=e=>Pa.path=e),placeholder:"请输入路径"},null,8,["modelValue"])]),_:1}),I(U,{label:"图标",prop:"icon"},{default:O(()=>[I(T,{modelValue:Pa.icon,"onUpdate:modelValue":a[20]||(a[20]=e=>Pa.icon=e),placeholder:"请输入图标名称"},null,8,["modelValue"])]),_:1}),I(U,{label:"排序",prop:"sort"},{default:O(()=>[I(Qt,{modelValue:Pa.sort,"onUpdate:modelValue":a[21]||(a[21]=e=>Pa.sort=e),min:0,placeholder:"排序"},null,8,["modelValue"])]),_:1}),I(U,{label:"状态",prop:"status"},{default:O(()=>[I(Mt,{modelValue:Pa.status,"onUpdate:modelValue":a[22]||(a[22]=e=>Pa.status=e)},{default:O(()=>[I(Kt,{label:"active"},{default:O(()=>[...a[68]||(a[68]=[F("启用",-1)])]),_:1}),I(Kt,{label:"inactive"},{default:O(()=>[...a[69]||(a[69]=[F("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),I(Ht,{modelValue:la.value,"onUpdate:modelValue":a[30]||(a[30]=e=>la.value=e),title:`角色「${ua.value?.name}」的用户列表`,width:"1200px",onClose:Dt},{default:O(()=>[D("div",ke,[I(Wt,{gutter:20,class:"stats-row"},{default:O(()=>[I(Yt,{span:6},{default:O(()=>[I(x,{shadow:"hover",class:"stat-card-mini"},{default:O(()=>[D("div",Ve,[I(i,{class:"stat-mini-icon primary"},{default:O(()=>[I(R(s))]),_:1}),D("div",Ce,[D("div",Se,B(Ja.value.total),1),a[72]||(a[72]=D("div",{class:"stat-mini-label"},"总用户数",-1))])])]),_:1})]),_:1}),I(Yt,{span:6},{default:O(()=>[I(x,{shadow:"hover",class:"stat-card-mini"},{default:O(()=>[D("div",xe,[I(i,{class:"stat-mini-icon success"},{default:O(()=>[I(R(l))]),_:1}),D("div",$e,[D("div",Te,B(Ja.value.active),1),a[73]||(a[73]=D("div",{class:"stat-mini-label"},"在职用户",-1))])])]),_:1})]),_:1}),I(Yt,{span:6},{default:O(()=>[I(x,{shadow:"hover",class:"stat-card-mini"},{default:O(()=>[D("div",Ue,[I(i,{class:"stat-mini-icon warning"},{default:O(()=>[I(R(f))]),_:1}),D("div",ze,[D("div",Ae,B(Ja.value.departments),1),a[74]||(a[74]=D("div",{class:"stat-mini-label"},"涉及部门",-1))])])]),_:1})]),_:1}),I(Yt,{span:6},{default:O(()=>[I(x,{shadow:"hover",class:"stat-card-mini"},{default:O(()=>[D("div",Le,[I(i,{class:"stat-mini-icon info"},{default:O(()=>[I(R(w))]),_:1}),D("div",Pe,[D("div",je,B(Ja.value.lastLogin),1),a[75]||(a[75]=D("div",{class:"stat-mini-label"},"近7天活跃",-1))])])]),_:1})]),_:1})]),_:1}),D("div",De,[I(Wt,{gutter:20},{default:O(()=>[I(Yt,{span:8},{default:O(()=>[I(T,{modelValue:ga.value,"onUpdate:modelValue":a[25]||(a[25]=e=>ga.value=e),placeholder:"搜索用户名、姓名或邮箱",clearable:"",onInput:At},{prefix:O(()=>[I(i,null,{default:O(()=>[I(R(r))]),_:1})]),_:1},8,["modelValue"])]),_:1}),I(Yt,{span:6},{default:O(()=>[I(St,{modelValue:ha.value,"onUpdate:modelValue":a[26]||(a[26]=e=>ha.value=e),placeholder:"状态筛选",clearable:"",onChange:At},{default:O(()=>[I(z,{label:"全部",value:""}),I(z,{label:"在职",value:"active"}),I(z,{label:"离职",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),I(Yt,{span:6},{default:O(()=>[I(St,{modelValue:fa.value,"onUpdate:modelValue":a[27]||(a[27]=e=>fa.value=e),placeholder:"部门筛选",clearable:"",onChange:At},{default:O(()=>[I(z,{label:"全部",value:""}),(j(!0),P(M,null,H(wa.value,e=>(j(),E(z,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),I(Yt,{span:4},{default:O(()=>[I($,{type:"primary",onClick:Pt,style:{width:"100%"}},{default:O(()=>[I(i,null,{default:O(()=>[I(R(b))]),_:1}),a[76]||(a[76]=F(" 导出 ",-1))]),_:1})]),_:1})]),_:1})]),q((j(),E(Ft,{data:Za.value,style:{width:"100%","margin-top":"20px"},stripe:""},{default:O(()=>[I(zt,{prop:"username",label:"用户名",width:"120"}),I(zt,{prop:"realName",label:"姓名",width:"120"}),I(zt,{prop:"email",label:"邮箱",width:"200","show-overflow-tooltip":""}),I(zt,{prop:"department",label:"部门",width:"150"}),I(zt,{prop:"position",label:"职位",width:"120"}),I(zt,{label:"状态",width:"80"},{default:O(({row:e})=>[I(Ot,{type:"active"===e.status?"success":"danger",size:"small"},{default:O(()=>[F(B("active"===e.status?"在职":"离职"),1)]),_:2},1032,["type"])]),_:1}),I(zt,{prop:"lastLoginTime",label:"最后登录",width:"160"}),I(zt,{label:"操作",width:"100",fixed:"right"},{default:O(({row:e})=>[I($,{type:"primary",size:"small",link:"",onClick:a=>{return t=e,void S.alert(`\n      <div style="line-height: 2;">\n        <p><strong>用户名：</strong>${t.username}</p>\n        <p><strong>姓名：</strong>${t.realName}</p>\n        <p><strong>邮箱：</strong>${t.email}</p>\n        <p><strong>部门：</strong>${t.department}</p>\n        <p><strong>职位：</strong>${t.position}</p>\n        <p><strong>状态：</strong>${"active"===t.status?"在职":"离职"}</p>\n        <p><strong>最后登录：</strong>${t.lastLoginTime}</p>\n      </div>\n    `,"用户详情",{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭"});var t}},{default:O(()=>[...a[77]||(a[77]=[F(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Xt,ba.value]]),va.value.length>0?(j(),P("div",Ie,[I(qt,{"current-page":_a.page,"onUpdate:currentPage":a[28]||(a[28]=e=>_a.page=e),"page-size":_a.size,"onUpdate:pageSize":a[29]||(a[29]=e=>_a.size=e),"page-sizes":[10,20,50,100],total:va.value.length,layout:"total, sizes, prev, pager, next, jumper",small:""},null,8,["current-page","page-size","total"])])):N("",!0)])]),_:1},8,["modelValue","title"]),I(Ht,{modelValue:oa.value,"onUpdate:modelValue":a[36]||(a[36]=e=>oa.value=e),title:`角色「${ua.value?.name}」的权限列表`,width:"1200px",onClose:It},{default:O(()=>[D("div",Oe,[I(Wt,{gutter:20,class:"stats-row"},{default:O(()=>[I(Yt,{span:6},{default:O(()=>[I(x,{shadow:"hover",class:"stat-card-mini"},{default:O(()=>[D("div",Re,[I(i,{class:"stat-mini-icon primary"},{default:O(()=>[I(R(o))]),_:1}),D("div",Be,[D("div",Ee,B(Ga.value.total),1),a[78]||(a[78]=D("div",{class:"stat-mini-label"},"总权限数",-1))])])]),_:1})]),_:1}),I(Yt,{span:6},{default:O(()=>[I(x,{shadow:"hover",class:"stat-card-mini"},{default:O(()=>[D("div",Ne,[I(i,{class:"stat-mini-icon success"},{default:O(()=>[I(R(_))]),_:1}),D("div",Fe,[D("div",qe,B(Ga.value.menu),1),a[79]||(a[79]=D("div",{class:"stat-mini-label"},"菜单权限",-1))])])]),_:1})]),_:1}),I(Yt,{span:6},{default:O(()=>[I(x,{shadow:"hover",class:"stat-card-mini"},{default:O(()=>[D("div",Ke,[I(i,{class:"stat-mini-icon warning"},{default:O(()=>[I(R(k))]),_:1}),D("div",Me,[D("div",He,B(Ga.value.action),1),a[80]||(a[80]=D("div",{class:"stat-mini-label"},"操作权限",-1))])])]),_:1})]),_:1}),I(Yt,{span:6},{default:O(()=>[I(x,{shadow:"hover",class:"stat-card-mini"},{default:O(()=>[D("div",Je,[I(i,{class:"stat-mini-icon info"},{default:O(()=>[I(R(V))]),_:1}),D("div",Ge,[D("div",Ze,B(Ga.value.modules),1),a[81]||(a[81]=D("div",{class:"stat-mini-label"},"功能模块",-1))])])]),_:1})]),_:1})]),_:1}),D("div",Qe,[I(Wt,{gutter:20},{default:O(()=>[I(Yt,{span:8},{default:O(()=>[I(T,{modelValue:Ca.value,"onUpdate:modelValue":a[31]||(a[31]=e=>Ca.value=e),placeholder:"搜索权限名称、编码或描述",clearable:"",onInput:Lt},{prefix:O(()=>[I(i,null,{default:O(()=>[I(R(r))]),_:1})]),_:1},8,["modelValue"])]),_:1}),I(Yt,{span:6},{default:O(()=>[I(St,{modelValue:Sa.value,"onUpdate:modelValue":a[32]||(a[32]=e=>Sa.value=e),placeholder:"类型筛选",clearable:"",onChange:Lt},{default:O(()=>[I(z,{label:"全部",value:""}),I(z,{label:"菜单",value:"menu"}),I(z,{label:"操作",value:"action"})]),_:1},8,["modelValue"])]),_:1}),I(Yt,{span:6},{default:O(()=>[I(St,{modelValue:xa.value,"onUpdate:modelValue":a[33]||(a[33]=e=>xa.value=e),placeholder:"模块筛选",clearable:"",onChange:Lt},{default:O(()=>[I(z,{label:"全部",value:""}),(j(!0),P(M,null,H($a.value,e=>(j(),E(z,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),I(Yt,{span:4},{default:O(()=>[I($,{type:"primary",onClick:jt,style:{width:"100%"}},{default:O(()=>[I(i,null,{default:O(()=>[I(R(b))]),_:1}),a[82]||(a[82]=F(" 导出 ",-1))]),_:1})]),_:1})]),_:1})]),q((j(),E(Ft,{data:Qa.value,style:{width:"100%","margin-top":"20px"},stripe:""},{default:O(()=>[I(zt,{prop:"name",label:"权限名称",width:"200"}),I(zt,{prop:"code",label:"权限编码",width:"250","show-overflow-tooltip":""}),I(zt,{label:"类型",width:"100"},{default:O(({row:e})=>[I(Ot,{type:"menu"===e.type?"success":"warning",size:"small"},{default:O(()=>[F(B("menu"===e.type?"菜单":"操作"),1)]),_:2},1032,["type"])]),_:1}),I(zt,{prop:"module",label:"所属模块",width:"150"}),I(zt,{prop:"description",label:"描述","show-overflow-tooltip":""}),I(zt,{label:"操作",width:"100",fixed:"right"},{default:O(({row:e})=>[I($,{type:"primary",size:"small",link:"",onClick:a=>{return t=e,void S.alert(`\n      <div style="line-height: 2;">\n        <p><strong>权限名称：</strong>${t.name}</p>\n        <p><strong>权限编码：</strong>${t.code}</p>\n        <p><strong>类型：</strong>${"menu"===t.type?"菜单":"操作"}</p>\n        <p><strong>所属模块：</strong>${t.module}</p>\n        <p><strong>描述：</strong>${t.description}</p>\n        ${t.path?`<p><strong>路径：</strong>${t.path}</p>`:""}\n      </div>\n    `,"权限详情",{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭"});var t}},{default:O(()=>[...a[83]||(a[83]=[F(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Xt,Ta.value]]),Va.value.length>0?(j(),P("div",Ye,[I(qt,{"current-page":Ua.page,"onUpdate:currentPage":a[34]||(a[34]=e=>Ua.page=e),"page-size":Ua.size,"onUpdate:pageSize":a[35]||(a[35]=e=>Ua.size=e),"page-sizes":[20,50,100],total:Va.value.length,layout:"total, sizes, prev, pager, next, jumper",small:""},null,8,["current-page","page-size","total"])])):N("",!0)])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-1baa361c"]]);export{We as default};
