var O=(be,Y,x)=>new Promise(($,w)=>{var pe=C=>{try{j(x.next(C))}catch(M){w(M)}},L=C=>{try{j(x.throw(C))}catch(M){w(M)}},j=C=>C.done?$(C.value):Promise.resolve(C.value).then(pe,L);j((x=x.apply(be,Y)).next())});import{l as wt,az as kt,aC as Tt,r as y,Z as bt,e as D,c as xt,Y as St,ag as _,m,p as l,q as t,Q as v,U as a,u as c,T as i,M as g,O as n,S as p,F as U,a9 as W,P as re,V as de}from"./vendor-D8Vxqhr-.js";import{a3 as Nt,ah as Dt,T as K,l as Ct,h as je,m as At,ad as ke,F as It,G as $t,c as E,ai as Me,M as z,af as Re,C as Pe,q as Ot,aj as Et,ak as zt,a4 as Lt,D as jt,a6 as le,H as Mt,E as f,f as Te,a1 as Rt,e as ce,p as Pt,b as ue}from"./elementPlus-Bmwh7Rh8.js";import{j as Bt,t as Ft,g as qt,u as Vt,S as Ht,c as Ut,_ as Wt}from"./settings-CuxbDWOu.js";import{u as Kt}from"./service-CXxf5jtg.js";import{m as Yt}from"./phone-DsAzMHsn.js";import{d as Zt}from"./sensitiveInfo-BWt1a88R.js";import"./utils-ywHRn0uI.js";const Gt={class:"order-detail"},Jt={class:"page-header"},Qt={class:"header-left"},Xt={class:"header-info"},es={class:"order-number"},ts={class:"header-actions"},ss={key:1,class:"mark-status"},os={class:"row-layout full-width"},as={class:"card-header-modern"},ns={class:"header-left"},is={class:"header-right"},rs={class:"customer-info-modern"},ds={class:"customer-main"},ls={class:"customer-avatar-section"},cs={class:"customer-details-modern"},us={class:"customer-name-modern"},ps={class:"customer-contact-modern"},ms={class:"contact-text"},vs={class:"contact-item-modern"},_s={class:"contact-text"},fs={class:"contact-item-modern address-item"},gs={class:"contact-text"},hs={class:"row-layout full-width"},ys={class:"status-header-horizontal"},ws={class:"status-title"},ks={class:"status-right-section"},Ts={key:0,class:"countdown-section"},bs={class:"countdown-timer"},xs={class:"countdown-text"},Ss={class:"status-timeline-horizontal"},Ns={class:"timeline-item-horizontal"},Ds={class:"timeline-content"},Cs={class:"timeline-value"},As={class:"timeline-item-horizontal"},Is={class:"timeline-content"},$s={class:"timeline-value"},Os={key:0,class:"timeline-item-horizontal countdown-timeline"},Es={class:"timeline-content"},zs={class:"timeline-value countdown-value"},Ls={key:1,class:"status-tip-horizontal"},js={class:"row-layout full-width"},Ms={class:"card-header-modern"},Rs={class:"header-left"},Ps={class:"delivery-info-modern"},Bs={class:"delivery-grid-modern"},Fs={class:"delivery-field-modern"},qs={class:"field-value-modern"},Vs={class:"delivery-field-modern"},Hs={class:"delivery-field-modern address-field-modern"},Us={class:"field-value-modern address-value-modern"},Ws={class:"row-layout full-width"},Ks={class:"card-header-modern"},Ys={class:"header-left"},Zs={class:"order-info-modern"},Gs={class:"order-basic-info"},Js={class:"info-grid"},Qs={class:"info-item"},Xs={class:"info-value order-number-value"},eo={class:"info-item"},to={class:"info-value"},so={class:"info-item"},oo={class:"info-value"},ao={class:"info-item"},no={class:"info-value"},io={class:"logistics-section"},ro={class:"section-title"},lo={key:0,class:"logistics-info-grid"},co={class:"logistics-item highlight"},uo={class:"logistics-value"},po={class:"logistics-item highlight"},mo={class:"logistics-value tracking-number-modern"},vo={class:"logistics-item"},_o={class:"logistics-value"},fo={class:"logistics-item"},go={class:"logistics-value estimated-delivery"},ho={key:1,class:"logistics-info-grid pending"},yo={class:"logistics-item"},wo={class:"logistics-value"},ko={class:"logistics-item"},To={class:"logistics-value"},bo={class:"logistics-item"},xo={class:"logistics-value"},So={key:0,class:"order-remark-modern"},No={class:"remark-title"},Do={class:"remark-content"},Co={class:"row-layout full-width"},Ao={class:"card-header"},Io={class:"products-list"},$o={class:"product-info"},Oo={class:"product-image"},Eo=["src","alt"],zo={class:"product-details"},Lo={class:"product-name"},jo={class:"product-sku"},Mo={class:"amount-summary-modern"},Ro={class:"amount-cards-modern"},Po={class:"amount-card-modern total-modern"},Bo={class:"amount-icon-modern"},Fo={class:"amount-content-modern"},qo={class:"amount-value-modern"},Vo={key:0,class:"amount-card-modern deposit-modern"},Ho={class:"amount-icon-modern"},Uo={class:"amount-content-modern"},Wo={class:"amount-value-modern"},Ko={key:1,class:"amount-card-modern collect-modern"},Yo={class:"amount-icon-modern"},Zo={class:"amount-content-modern"},Go={class:"amount-value-modern"},Jo={class:"amount-row-detail"},Qo={class:"amount-detail-item subtotal-item"},Xo={class:"detail-value subtotal"},ea={key:0,class:"amount-detail-item discount-item"},ta={class:"detail-value discount"},sa={key:0,class:"deposit-screenshot-horizontal"},oa={class:"screenshots-container"},aa=["onClick"],na={class:"screenshot-overlay"},ia={key:0,class:"screenshot-count"},ra={class:"row-layout full-width"},da={class:"card-header"},la={class:"logistics-timeline"},ca={class:"logistics-content"},ua={class:"logistics-status"},pa={class:"logistics-description"},ma={key:0,class:"logistics-location"},va={class:"row-layout full-width"},_a={class:"card-header"},fa={class:"row-layout full-width"},ga={class:"card-header"},ha={class:"timeline-content"},ya={class:"timeline-title"},wa={class:"timeline-description"},ka={key:0,class:"timeline-operator"},Ta={key:0,class:"row-layout full-width"},ba={class:"card-header"},xa={class:"logistics-header-info"},Sa={key:1,class:"tracking-number"},Na={key:0,class:"logistics-loading"},Da={class:"logistics-content"},Ca={class:"logistics-status"},Aa={class:"logistics-description"},Ia={key:0,class:"logistics-location"},$a={class:"logistics-actions"},Oa={class:"row-layout full-width"},Ea={class:"card-header"},za={class:"after-sales-content"},La={class:"after-sales-title"},ja={class:"after-sales-description"},Ma={key:0,class:"after-sales-operator"},Ra={key:1,class:"after-sales-amount"},Pa=wt({__name:"Detail",setup(be){const Y=kt(),x=Tt(),$=Ut(Y),w=Bt(),pe=Ft(),L=qt(),j=Kt(),C=Vt(),M=y(!1),h=x.params.id,Z=y(180),k=y(null),me=y("03:00"),o=bt({id:"",orderNumber:"",status:"pending",auditStatus:"pending",markType:"",createTime:"",updateTime:"",auditTransferTime:"",isAuditTransferred:!1,customer:{id:"",name:"",phone:"",wechat:"",address:"",level:"normal",avatar:""},receiverName:"",receiverPhone:"",receiverAddress:"",expressCompany:"",trackingNumber:"",serviceWechat:"",orderSource:"",expectedShipDate:"",expectedDeliveryDate:"",products:[],subtotal:0,discount:0,totalAmount:0,depositAmount:0,depositScreenshot:"",depositScreenshots:[],remark:""}),G=y([]),R=y([]),ve=y([]),J=y([]),P=y(!0),B=y(!0),F=y(!0),q=y(!1),Q=y(!1),Be=()=>{window.addEventListener("operation-log-update",s=>{const{orderId:e,log:d}=s.detail;e===x.params.id&&ve.value.unshift(d)}),window.addEventListener("order-status-update",s=>{const{orderId:e,newStatus:d}=s.detail;e===x.params.id&&(o.status=d,xe(),Se())}),window.addEventListener("logistics-status-update",s=>{const e=s.detail;o.trackingNumber===e.trackingNumber&&ee()}),window.addEventListener("after-sales-update",s=>{const{orderId:e,serviceId:d}=s.detail;e===x.params.id&&_e()}),window.addEventListener("service-status-update",s=>{const{orderId:e,serviceId:d,newStatus:b}=s.detail;e===x.params.id&&_e()})},xe=()=>{ve.value=w.getOperationLogs(h)},_e=()=>O(this,null,function*(){try{const s=j.getServicesByOrderId(o.id);J.value=s.map(e=>({timestamp:e.createTime,type:e.serviceType,title:Fe(e.serviceType,e.status),description:e.description||e.reason,operator:e.createdBy,amount:e.price||0,status:e.status,serviceNumber:e.serviceNumber})),J.value.sort((e,d)=>new Date(d.timestamp).getTime()-new Date(e.timestamp).getTime())}catch(s){console.error("加载售后历史失败:",s)}}),Fe=(s,e)=>{const d={return:"退货申请",exchange:"换货申请",repair:"维修申请",refund:"退款申请"},b={pending:"已提交",processing:"处理中",resolved:"已解决",closed:"已关闭"};return`${d[s]||"售后申请"} - ${b[e]||e}`},Se=()=>{const s=w.getOrderStatusHistory(h);s&&s.length>0?G.value=s.map(e=>({timestamp:e.timestamp,type:qe(e.status),icon:Ve(e.status),color:He(e.status),title:e.title||te(e.status),description:e.description||`订单状态变更为：${te(e.status)}`,operator:e.operator||"系统"})):G.value=[{timestamp:o.createTime,type:"info",icon:Pt,color:"#909399",title:"订单创建",description:`订单创建成功，订单号：${o.orderNumber}`,operator:"系统"}],G.value.sort((e,d)=>new Date(d.timestamp).getTime()-new Date(e.timestamp).getTime())},qe=s=>({pending:"info",pending_approval:"warning",approved:"success",rejected:"danger",pending_shipment:"warning",shipped:"primary",delivered:"success",completed:"success",cancelled:"danger"})[s]||"info",Ve=s=>({pending:E,pending_approval:E,approved:ce,rejected:Te,pending_shipment:E,shipped:z,delivered:ce,completed:ce,cancelled:Te})[s]||E,He=s=>({pending:"#909399",pending_approval:"#e6a23c",approved:"#67c23a",rejected:"#f56c6c",pending_shipment:"#e6a23c",shipped:"#409eff",delivered:"#67c23a",completed:"#67c23a",cancelled:"#f56c6c"})[s]||"#909399",Ne=D(()=>o.auditStatus==="pending"&&o.markType==="normal"&&!o.isAuditTransferred&&Z.value>0),De=D(()=>["shipped","delivered","completed","abnormal","rejected","rejected_returned"].includes(o.status)),Ue=D(()=>o.status==="pending_approval"),We=D(()=>o.status==="pending_approval"),X=D(()=>o.auditStatus==="approved"||o.status==="pending_cancel"||o.status==="cancelled"||o.status==="cancel_failed"?!1:o.auditStatus==="pending"&&o.markType==="normal"?!o.isAuditTransferred:!0),Ce=D(()=>o.auditStatus==="pending"&&o.markType==="normal"&&o.isAuditTransferred),fe=y(!1),Ae=y(0),Ke=D(()=>["shipped","delivered","completed","package_exception","rejected","rejected_returned"].includes(o.status)&&o.trackingNumber),Ye=D(()=>!o.products||o.products.length===0?0:o.products.reduce((s,e)=>s+e.price*e.quantity,0)),Ie=D(()=>o.markType==="normal"&&o.auditStatus==="pending"&&!o.isAuditTransferred),V=D(()=>o.depositScreenshots&&o.depositScreenshots.length>0?o.depositScreenshots:o.depositScreenshot?[o.depositScreenshot]:[]),Ze=()=>{Y.back()},Ge=s=>{Ae.value=s,fe.value=!0},Je=s=>O(this,null,function*(){return yield j.checkExistingAfterSales(s)}),Qe=()=>O(this,null,function*(){try{const s=yield Je(o.id);s?($.push(`/service/detail/${s.id}`),f.info("该订单已有售后记录，已跳转到售后详情页")):$.push({path:"/service/add",query:{orderId:o.id,orderNumber:o.orderNumber,customerId:o.customer.id,customerName:o.customer.name,customerPhone:o.customer.phone}})}catch(s){console.error("检查售后记录失败:",s),$.push({path:"/service/add",query:{orderId:o.id,orderNumber:o.orderNumber,customerId:o.customer.id,customerName:o.customer.name,customerPhone:o.customer.phone}})}}),Xe=s=>{if(s==="reserved"&&Ie.value){const d={reserved:"预留单",normal:"正常发货单",return:"退单"};ue.confirm(`确认将此订单标记为"${d[s]}"？
注意：修改为预留单后，订单将不会流转到审核，信息将保留在系统中。`,"确认标记",{type:"warning"}).then(()=>{k.value&&(clearInterval(k.value),k.value=null),o.markType=s,o.isAuditTransferred=!0,w.updateOrder(h,{markType:s,isAuditTransferred:!0})?(f.success(`订单已标记为${d[s]}，信息已保留在系统中`),L.sendMessage({type:"ORDER_MARKED",title:"订单标记更新",content:`订单 ${o.orderNumber} 已标记为${d[s]}`,link:`/order/detail/${h}`,metadata:{orderId:o.id,orderNumber:o.orderNumber,markType:s,previousMarkType:"normal"}})):(f.error("更新订单标记失败"),he())}).catch(()=>{});return}if(!X.value){Ce.value?f.warning("订单正在审核中，无法修改标记。如需修改，请等待审核完成或联系审核员退回订单。"):o.auditStatus==="approved"?f.warning("订单已审核通过，无法修改标记"):f.warning("当前状态下无法修改订单标记");return}const e={reserved:"预留单",normal:"正常发货单",return:"退单"};ue.confirm(`确认将此订单标记为"${e[s]}"？`,"确认标记",{type:"warning"}).then(()=>{o.markType=s;const d={markType:s};if(s==="return")d.isAuditTransferred=!0,d.status="confirmed";else if(s==="normal"&&o.markType==="reserved"){d.isAuditTransferred=!1;const u=new Date(Date.now()+3*60*1e3);d.auditTransferTime=u.toLocaleString("zh-CN")}w.updateOrder(h,d)?(f.success(`订单已标记为${e[s]}`),s==="return"?f.info("退单已处理完成，订单信息已保留在系统中，不会流转到审核"):s==="normal"&&o.status==="pending"&&f.info("订单已变更为正常发货单，将进入审核流程"),L.sendMessage({type:"ORDER_MARKED",title:"订单标记更新",content:`订单 ${o.orderNumber} 已标记为${e[s]}`,link:`/order/detail/${h}`,metadata:{orderId:o.id,orderNumber:o.orderNumber,markType:s,previousMarkType:o.markType}})):(f.error("更新订单标记失败"),he())}).catch(()=>{})},et=()=>O(this,null,function*(){var s;try{yield ue.confirm("确认审核通过此订单？","审核确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),yield new Promise(e=>setTimeout(e,1e3)),w.syncOrderStatus(h,"pending_shipment","审核员","订单审核通过，等待发货"),o.status="pending_shipment",L.sendMessage({type:"ORDER_APPROVED",title:"订单审核通过",content:`订单 ${o.orderNo} (客户: ${o.customer.name}, 金额: ¥${(s=o.totalAmount)==null?void 0:s.toLocaleString()}) 已审核通过`,link:`/order/detail/${h}`,metadata:{orderId:h,orderNo:o.orderNo,customerName:o.customer.name,totalAmount:o.totalAmount,auditResult:"approved"}}),f.success("订单审核通过")}catch(e){}}),tt=()=>O(this,null,function*(){var s;try{const{value:e}=yield ue.prompt("请输入拒绝原因","审核拒绝",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"请输入拒绝原因"});yield new Promise(d=>setTimeout(d,1e3)),w.syncOrderStatus(h,"audit_rejected","审核员",`订单审核拒绝：${e}`),o.status="audit_rejected",L.sendMessage({type:"ORDER_REJECTED",title:"订单审核拒绝",content:`订单 ${o.orderNo} (客户: ${o.customer.name}, 金额: ¥${(s=o.totalAmount)==null?void 0:s.toLocaleString()}) 已审核拒绝，原因: ${e}`,link:`/order/detail/${h}`,metadata:{orderId:h,orderNo:o.orderNo,customerName:o.customer.name,totalAmount:o.totalAmount,auditResult:"rejected",auditRemark:e}}),f.success("订单已拒绝")}catch(e){}}),$e=()=>{window.open(`tel:${o.customer.phone}`)},st=()=>{console.log("goToCustomerDetail called"),console.log("orderDetail.customer:",o.customer),console.log("customer id:",o.customer.id),console.log("跳转路径:",`/customer/detail/${o.customer.id}`),$.push(`/customer/detail/${o.customer.id}`)},ot=()=>{const s=`https://www.kuaidi100.com/query?type=${o.expressCompany}&postid=${o.trackingNumber}`;window.open(s,"_blank")},at=s=>{try{const d=(s.tracks||[])[0];if(!d)return;const b=new Date;let u=0;const T=d.status||d.statusText||"",H=o.expressCompany;if(T.includes("已签收")||T.includes("delivered"))return;T.includes("派送中")||T.includes("out_for_delivery")?u=.5:T.includes("到达")||T.includes("arrived")?u=1:T.includes("运输中")||T.includes("in_transit")?H==="SF"?u=1:H==="YTO"||H==="ZTO"?u=2:u=3:u=3;const ye=new Date(b.getTime()+u*24*60*60*1e3);o.expectedDeliveryDate=ye.toISOString().split("T")[0]}catch(e){console.error("更新预计到达时间失败:",e)}},ee=()=>O(this,null,function*(){if(!o.trackingNumber||!o.expressCompany){f.warning("缺少快递单号或快递公司信息");return}try{Q.value=!0;const s=yield w.queryLogisticsTrack(h);s&&s.tracks&&s.tracks.length>0?(R.value=s.tracks.map(e=>({time:e.time,status:e.status,statusText:e.statusText||e.status,description:e.description,location:e.location})),at(s),f.success("物流信息已更新")):f.warning("暂无物流信息")}catch(s){console.error("获取物流信息失败:",s),f.error("获取物流信息失败")}finally{Q.value=!1}}),ge=s=>{if(!s)return"info";const e={delivered:"success",out_for_delivery:"primary",in_transit:"primary",picked_up:"info",pending:"info",exception:"warning",rejected:"danger",已签收:"success",已送达:"success",派送中:"primary",运输中:"primary",在途:"primary",已揽收:"info",已发货:"info",待发货:"info",异常:"warning",拒收:"danger",退回:"danger"};return e[s]?e[s]:s.includes("签收")||s.includes("送达")?"success":s.includes("派送")||s.includes("运输")||s.includes("在途")?"primary":s.includes("揽收")||s.includes("发货")?"info":s.includes("异常")||s.includes("问题")?"warning":s.includes("拒收")||s.includes("退回")?"danger":"info"},nt=s=>({delivered:ce,out_for_delivery:z,in_transit:z,picked_up:z,pending:E,exception:Rt,rejected:Te})[s]||E,it=s=>({pending_transfer:"info",pending_audit:"warning",audit_rejected:"danger",pending_shipment:"primary",shipped:"primary",delivered:"success",package_exception:"warning",rejected:"danger",rejected_returned:"info",after_sales_created:"warning",cancelled:"info",draft:"info",pending:"warning",pending_approval:"warning",approved:"success",rejected:"danger",paid:"success",completed:"success",confirmed:"success"})[s]||"info",te=s=>({pending_transfer:"待流转",pending_audit:"待审核",audit_rejected:"审核拒绝",pending_shipment:"待发货",shipped:"已发货",delivered:"已签收",package_exception:"包裹异常",rejected:"拒收",rejected_returned:"拒收已退回",after_sales_created:"已建售后",cancelled:"已取消",draft:"草稿",pending:"待处理",pending_approval:"待审核",approved:"已审核",paid:"已付款",completed:"已完成",confirmed:"已确认"})[s]||s,rt=s=>({vip:"warning",premium:"danger",normal:"info"})[s]||"info",dt=s=>({vip:"VIP客户",premium:"高级客户",normal:"普通客户"})[s]||"普通客户",Oe=s=>({sf:"顺丰速运",yt:"圆通速递",zt:"中通快递",st:"申通快递",yd:"韵达速递",bs:"百世快递",db:"德邦快递",jd:"京东物流"})[s]||s,lt=s=>({online_store:"线上商城",wechat_mini:"微信小程序",wechat_service:"微信客服",phone_call:"电话咨询",offline_store:"线下门店",referral:"客户推荐",advertisement:"广告投放",other:"其他渠道"})[s]||s,ct=s=>({refund:"warning",return:"danger",exchange:"primary",repair:"info",complaint:"danger"})[s]||"info",ut=s=>({reserved:"预留单",normal:"正常发货单",return:"退单"})[s]||s,pt=()=>o.markType&&{reserved:"warning",normal:"success",return:"danger"}[o.markType]||"default",mt=s=>({reserved:"warning",normal:"success",return:"danger"})[s]||"info",se=s=>s?new Date(s).toLocaleString("zh-CN"):"",oe=s=>s?new Date(s).toLocaleDateString("zh-CN"):"",he=()=>O(this,null,function*(){try{M.value=!0;const s=w.getOrderById(h);if(!s){f.error("订单不存在"),$.push("/order/list");return}const e=pe.getCustomerById(s.customerId);Object.assign(o,{id:s.id,orderNumber:s.orderNumber,status:s.status,auditStatus:s.auditStatus||"pending",markType:s.markType||"normal",createTime:s.createTime,updateTime:s.createTime,auditTransferTime:s.auditTransferTime||"",isAuditTransferred:s.isAuditTransferred||!1,customer:e?{id:e.id,name:e.name,phone:e.phone,wechat:e.wechatId||"",address:e.address,level:e.level,avatar:""}:{id:s.customerId,name:s.customerName,phone:s.customerPhone,wechat:"",address:"",level:"normal",avatar:""},receiverName:s.receiverName,receiverPhone:s.receiverPhone,receiverAddress:s.receiverAddress,expressCompany:s.expressCompany||"",trackingNumber:s.trackingNumber||"",serviceWechat:s.serviceWechat||"",orderSource:s.orderSource||"",expectedShipDate:s.expectedShipDate||"",expectedDeliveryDate:s.expectedDeliveryDate||"",products:s.products,subtotal:s.subtotal,discount:s.discount,totalAmount:s.totalAmount,depositAmount:s.depositAmount,depositScreenshot:s.depositScreenshot||"",remark:s.remark}),Se(),xe(),_e(),o.trackingNumber&&ee(),Be(),vt()}catch(s){f.error("加载订单详情失败"),$.push("/order/list")}finally{M.value=!1}}),vt=()=>{if(k.value&&(clearInterval(k.value),k.value=null),o.markType!=="normal"||o.auditStatus!=="pending"||o.isAuditTransferred)return;if(!o.auditTransferTime){const d=new Date(Date.now()+18e4).toISOString();o.auditTransferTime=d,w.updateOrder(h,{auditTransferTime:d})}const s=new Date(o.auditTransferTime).getTime(),e=Date.now();if(s<=e){ze();return}Ee(),k.value=setInterval(Ee,1e3)},Ee=()=>{if(!o.auditTransferTime)return;const s=new Date(o.auditTransferTime).getTime(),e=Date.now(),d=Math.max(0,s-e);if(d<=0){k.value&&(clearInterval(k.value),k.value=null),ze();return}Z.value=Math.floor(d/1e3);const b=Math.floor(Z.value/60),u=Z.value%60;me.value=`${b}分${u.toString().padStart(2,"0")}秒`},ze=()=>{o.isAuditTransferred=!0,o.status="pending_audit",o.auditStatus="pending",w.updateOrder(h,{isAuditTransferred:!0,status:"pending_audit",auditStatus:"pending"}),w.checkAndTransferOrders(),f.info("订单已自动流转到审核"),L.sendMessage({type:"ORDER_TRANSFERRED",title:"订单流转审核",content:`订单 ${o.orderNumber} 已自动流转到审核`,link:`/order/detail/${h}`,metadata:{orderId:o.id,orderNumber:o.orderNumber}})};return xt(()=>{he()}),St(()=>{k.value&&(clearInterval(k.value),k.value=null),window.removeEventListener("operation-log-update",()=>{}),window.removeEventListener("order-status-update",()=>{}),window.removeEventListener("logistics-status-update",()=>{})}),(s,e)=>{const d=_("el-button"),b=_("el-tooltip"),u=_("el-icon"),T=_("el-dropdown-item"),H=_("el-dropdown-menu"),ye=_("el-dropdown"),A=_("el-tag"),_t=_("el-avatar"),S=_("el-card"),ft=_("InfoFilled"),I=_("el-table-column"),Le=_("el-table"),gt=_("el-image"),ht=_("el-image-viewer"),ae=_("el-timeline-item"),ne=_("el-timeline"),we=_("el-empty"),ie=_("el-collapse-transition"),yt=_("el-skeleton");return l(),m("div",Gt,[t("div",Jt,[t("div",Qt,[a(d,{onClick:Ze,icon:c(Nt),circle:""},null,8,["icon"]),t("div",Xt,[e[6]||(e[6]=t("h2",null,"订单详情",-1)),t("div",es,"订单号："+i(o.orderNumber),1)])]),t("div",ts,[a(b,{content:De.value?"点击创建售后服务":"订单需要发货后才能建立售后",placement:"bottom"},{default:n(()=>[a(d,{type:"primary",disabled:!De.value,onClick:Qe},{default:n(()=>[...e[7]||(e[7]=[p(" 建立售后 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["content"]),a(ye,{onCommand:Xe,class:"mark-dropdown",disabled:!X.value},{dropdown:n(()=>[a(H,null,{default:n(()=>[a(T,{command:"reserved"},{default:n(()=>[...e[9]||(e[9]=[p("预留单",-1)])]),_:1}),a(T,{command:"normal"},{default:n(()=>[...e[10]||(e[10]=[p("正常发货单",-1)])]),_:1}),a(T,{command:"return"},{default:n(()=>[...e[11]||(e[11]=[p("退单",-1)])]),_:1})]),_:1})]),default:n(()=>[a(d,{icon:c(Dt),type:pt(),disabled:!X.value},{default:n(()=>[e[8]||(e[8]=p(" 标记 ",-1)),a(u,{class:"el-icon--right"},{default:n(()=>[a(c(K))]),_:1})]),_:1},8,["icon","type","disabled"])]),_:1},8,["disabled"]),!X.value&&Ce.value?(l(),g(b,{key:0,content:"订单正在审核中，无法修改标记",placement:"top"},{default:n(()=>[a(u,{class:"audit-lock-icon"},{default:n(()=>[a(c(Ct))]),_:1})]),_:1})):v("",!0),o.markType?(l(),m("div",ss,[a(A,{type:mt(o.markType),size:"default",effect:"dark"},{default:n(()=>[p(i(ut(o.markType)),1)]),_:1},8,["type"])])):v("",!0),Ue.value?(l(),g(d,{key:2,type:"success",onClick:et},{default:n(()=>[...e[12]||(e[12]=[p("审核通过",-1)])]),_:1})):v("",!0),We.value?(l(),g(d,{key:3,type:"danger",onClick:tt},{default:n(()=>[...e[13]||(e[13]=[p("审核拒绝",-1)])]),_:1})):v("",!0)])]),t("div",os,[a(S,{class:"customer-info-card modern-card"},{header:n(()=>[t("div",as,[t("div",ns,[a(u,{class:"header-icon"},{default:n(()=>[a(c(It))]),_:1}),e[14]||(e[14]=t("span",{class:"header-title"},"客户信息",-1))]),t("div",is,[a(d,{type:"text",size:"small",onClick:st,class:"view-more-btn"},{default:n(()=>[e[15]||(e[15]=p(" 查看更多 ",-1)),a(u,{class:"ml-1"},{default:n(()=>[a(c($t))]),_:1})]),_:1})])])]),default:n(()=>{var r;return[t("div",rs,[t("div",ds,[t("div",ls,[a(_t,{size:64,src:o.customer.avatar,class:"customer-avatar-modern"},{default:n(()=>[p(i(o.customer.name.charAt(0)),1)]),_:1},8,["src"]),a(A,{type:rt(o.customer.level),size:"small",class:"customer-level-tag",effect:"light"},{default:n(()=>[p(i(dt(o.customer.level)),1)]),_:1},8,["type"])]),t("div",cs,[t("div",us,i(o.customer.name),1),t("div",ps,[t("div",{class:"contact-item-modern phone-item-modern",onClick:$e},[a(u,{class:"contact-icon"},{default:n(()=>[a(c(je))]),_:1}),t("span",ms,i(c(Zt)(o.customer.phone,c(Ht).PHONE,((r=c(C).currentUser)==null?void 0:r.id)||"")),1),a(u,{class:"call-icon"},{default:n(()=>[a(c(je))]),_:1})]),t("div",vs,[a(u,{class:"contact-icon"},{default:n(()=>[a(c(At))]),_:1}),t("span",_s,i(o.customer.wechat||"未设置微信"),1)]),t("div",fs,[a(u,{class:"contact-icon"},{default:n(()=>[a(c(ke))]),_:1}),t("span",gs,i(o.customer.address),1)])])])])])]}),_:1})]),t("div",hs,[a(S,{class:"modern-card order-status-modern order-status-horizontal"},{default:n(()=>[t("div",ys,[t("div",ws,[a(u,{class:"status-icon"},{default:n(()=>[a(c(E))]),_:1}),e[16]||(e[16]=t("span",{class:"title-text"},"订单状态",-1))]),t("div",ks,[a(A,{type:it(o.status),class:"status-tag-modern",effect:"light"},{default:n(()=>[p(i(te(o.status)),1)]),_:1},8,["type"]),Ne.value?(l(),m("div",Ts,[t("div",bs,[a(u,{class:"countdown-icon"},{default:n(()=>[a(c(Me))]),_:1}),t("span",xs,i(me.value),1)]),e[17]||(e[17]=t("div",{class:"countdown-tip"},"请在倒计时结束前完成审核",-1))])):v("",!0)])]),t("div",Ss,[t("div",Ns,[e[19]||(e[19]=t("div",{class:"timeline-dot"},null,-1)),t("div",Ds,[e[18]||(e[18]=t("div",{class:"timeline-label"},"创建时间",-1)),t("div",Cs,i(se(o.createTime)),1)])]),t("div",As,[e[21]||(e[21]=t("div",{class:"timeline-dot"},null,-1)),t("div",Is,[e[20]||(e[20]=t("div",{class:"timeline-label"},"更新时间",-1)),t("div",$s,i(se(o.updateTime)),1)])]),Ne.value?(l(),m("div",Os,[e[24]||(e[24]=t("div",{class:"timeline-dot countdown-dot"},null,-1)),t("div",Es,[e[23]||(e[23]=t("div",{class:"timeline-label"},"流转审核倒计时",-1)),t("div",zs,[p(i(me.value)+" ",1),a(A,{type:"warning",size:"small",class:"countdown-badge"},{default:n(()=>[a(u,null,{default:n(()=>[a(c(Me))]),_:1}),e[22]||(e[22]=p(" 自动流转中 ",-1))]),_:1})])])])):v("",!0),Ie.value?(l(),m("div",Ls,[a(u,{class:"tip-icon"},{default:n(()=>[a(ft)]),_:1}),e[25]||(e[25]=t("span",{class:"tip-text"},"流转前可修改为预留单，修改后将不会流转到审核",-1))])):v("",!0)])]),_:1})]),t("div",js,[a(S,{class:"modern-card delivery-info-card"},{header:n(()=>[t("div",Ms,[t("div",Rs,[a(u,{class:"header-icon"},{default:n(()=>[a(c(z))]),_:1}),e[26]||(e[26]=t("span",{class:"header-title"},"收货信息",-1))])])]),default:n(()=>[t("div",Ps,[t("div",Bs,[t("div",Fs,[e[27]||(e[27]=t("div",{class:"field-label-modern"},"收货人",-1)),t("div",qs,i(o.receiverName),1)]),t("div",Vs,[e[28]||(e[28]=t("div",{class:"field-label-modern"},"联系电话",-1)),t("div",{class:"field-value-modern phone-clickable",onClick:e[0]||(e[0]=r=>$e(o.receiverPhone))},i(c(Yt)(o.receiverPhone)),1)]),t("div",Hs,[e[29]||(e[29]=t("div",{class:"field-label-modern"},"收货地址",-1)),t("div",Us,i(o.receiverAddress),1)])])])]),_:1})]),t("div",Ws,[a(S,{class:"order-info-card modern-card"},{header:n(()=>[t("div",Ks,[t("div",Ys,[a(u,{class:"header-icon"},{default:n(()=>[a(c(Pe))]),_:1}),e[30]||(e[30]=t("span",{class:"header-title"},"订单信息",-1))])])]),default:n(()=>[t("div",Zs,[t("div",Gs,[t("div",Js,[t("div",Qs,[e[31]||(e[31]=t("div",{class:"info-label"},"订单号",-1)),t("div",Xs,i(o.orderNumber),1)]),t("div",eo,[e[32]||(e[32]=t("div",{class:"info-label"},"下单时间",-1)),t("div",to,i(se(o.createTime)),1)]),t("div",so,[e[33]||(e[33]=t("div",{class:"info-label"},"客服微信",-1)),t("div",oo,i(o.serviceWechat),1)]),t("div",ao,[e[34]||(e[34]=t("div",{class:"info-label"},"订单来源",-1)),t("div",no,i(lt(o.orderSource)),1)])])]),t("div",io,[t("div",ro,[a(u,null,{default:n(()=>[a(c(z))]),_:1}),e[37]||(e[37]=t("span",null,"物流信息",-1)),o.status==="shipped"?(l(),g(A,{key:0,type:"success",size:"small",effect:"light",class:"status-indicator"},{default:n(()=>[...e[35]||(e[35]=[p(" 已发货 ",-1)])]),_:1})):o.status==="pending_shipment"?(l(),g(A,{key:1,type:"warning",size:"small",effect:"light",class:"status-indicator"},{default:n(()=>[...e[36]||(e[36]=[p(" 待发货 ",-1)])]),_:1})):(l(),g(A,{key:2,type:"info",size:"small",effect:"light",class:"status-indicator"},{default:n(()=>[p(i(te(o.status)),1)]),_:1}))]),o.status==="shipped"&&o.trackingNumber?(l(),m("div",lo,[t("div",co,[e[38]||(e[38]=t("div",{class:"logistics-label"},"快递公司",-1)),t("div",uo,i(Oe(o.expressCompany)),1)]),t("div",po,[e[40]||(e[40]=t("div",{class:"logistics-label"},"物流单号",-1)),t("div",mo,[p(i(o.trackingNumber)+" ",1),a(d,{size:"small",type:"primary",text:"",onClick:ot,class:"track-btn"},{default:n(()=>[a(u,null,{default:n(()=>[a(c(Re))]),_:1}),e[39]||(e[39]=p(" 查询 ",-1))]),_:1})])]),t("div",vo,[e[41]||(e[41]=t("div",{class:"logistics-label"},"预计发货",-1)),t("div",_o,i(oe(o.expectedShipDate)||"已发货"),1)]),t("div",fo,[e[42]||(e[42]=t("div",{class:"logistics-label"},"预计到达",-1)),t("div",go,i(oe(o.expectedDeliveryDate)||"计算中..."),1)])])):(l(),m("div",ho,[t("div",yo,[e[43]||(e[43]=t("div",{class:"logistics-label"},"预计发货",-1)),t("div",wo,i(oe(o.expectedShipDate)||"待确定"),1)]),t("div",ko,[e[44]||(e[44]=t("div",{class:"logistics-label"},"预计到达",-1)),t("div",To,i(oe(o.expectedDeliveryDate)||"待确定"),1)]),t("div",bo,[e[45]||(e[45]=t("div",{class:"logistics-label"},"快递公司",-1)),t("div",xo,i(Oe(o.expressCompany)||"待确定"),1)]),e[46]||(e[46]=t("div",{class:"logistics-item"},[t("div",{class:"logistics-label"},"物流单号"),t("div",{class:"logistics-value pending-text"},"待发货后生成")],-1))]))]),o.remark?(l(),m("div",So,[t("div",No,[a(u,null,{default:n(()=>[a(c(Pe))]),_:1}),e[47]||(e[47]=t("span",null,"订单备注",-1))]),t("div",Do,i(o.remark),1)])):v("",!0)])]),_:1})]),t("div",Co,[a(S,{class:"products-card"},{header:n(()=>[t("div",Ao,[a(u,null,{default:n(()=>[a(c(Lt))]),_:1}),e[48]||(e[48]=t("span",null,"商品清单",-1))])]),default:n(()=>[t("div",Io,[a(Le,{data:o.products,style:{width:"100%"}},{default:n(()=>[a(I,{label:"商品信息","min-width":"200"},{default:n(({row:r})=>[t("div",$o,[t("div",Oo,[t("img",{src:r.image||"/default-product.png",alt:r.name},null,8,Eo)]),t("div",zo,[t("div",Lo,i(r.name),1),t("div",jo,"SKU: "+i(r.sku||r.id),1)])])]),_:1}),a(I,{prop:"price",label:"单价",width:"100"},{default:n(({row:r})=>[p(" ¥"+i(r.price.toFixed(2)),1)]),_:1}),a(I,{prop:"quantity",label:"数量",width:"80"}),a(I,{label:"小计",width:"120"},{default:n(({row:r})=>[p(" ¥"+i((r.price*r.quantity).toFixed(2)),1)]),_:1})]),_:1},8,["data"]),t("div",Mo,[t("div",Ro,[t("div",Po,[t("div",Bo,[a(u,null,{default:n(()=>[a(c(Ot))]),_:1})]),t("div",Fo,[e[49]||(e[49]=t("div",{class:"amount-label-modern"},"订单总额",-1)),t("div",qo,"¥"+i((o.totalAmount||0).toFixed(2)),1)])]),(o.depositAmount||0)>0?(l(),m("div",Vo,[t("div",Ho,[a(u,null,{default:n(()=>[a(c(Et))]),_:1})]),t("div",Uo,[e[50]||(e[50]=t("div",{class:"amount-label-modern"},"定金",-1)),t("div",Wo,"¥"+i((o.depositAmount||0).toFixed(2)),1)])])):v("",!0),(o.depositAmount||0)>0?(l(),m("div",Ko,[t("div",Yo,[a(u,null,{default:n(()=>[a(c(zt))]),_:1})]),t("div",Zo,[e[51]||(e[51]=t("div",{class:"amount-label-modern"},"代收",-1)),t("div",Go,"¥"+i(((o.totalAmount||0)-(o.depositAmount||0)).toFixed(2)),1)])])):v("",!0)]),t("div",Jo,[t("div",Qo,[e[52]||(e[52]=t("span",{class:"detail-label"},"商品总额：",-1)),t("span",Xo,"¥"+i(Ye.value.toFixed(2)),1)]),(o.discount||0)>0?(l(),m("div",ea,[e[53]||(e[53]=t("span",{class:"detail-label"},"优惠金额：",-1)),t("span",ta,"-¥"+i((o.discount||0).toFixed(2)),1)])):v("",!0)]),V.value.length>0?(l(),m("div",sa,[e[54]||(e[54]=t("span",{class:"label"},"定金截图：",-1)),t("div",oa,[(l(!0),m(U,null,W(V.value,(r,N)=>(l(),m("div",{key:N,class:"screenshot-container",onClick:Ba=>Ge(N)},[a(gt,{src:r,fit:"cover",style:{width:"60px",height:"45px","border-radius":"4px","margin-left":"8px"}},null,8,["src"]),t("div",na,[a(u,{class:"zoom-icon"},{default:n(()=>[a(c(Re))]),_:1})])],8,aa))),128)),V.value.length>1?(l(),m("div",ia," 共"+i(V.value.length)+"张 ",1)):v("",!0)])])):v("",!0),fe.value?(l(),g(ht,{key:1,"url-list":V.value,"initial-index":Ae.value,onClose:e[1]||(e[1]=r=>fe.value=!1)},null,8,["url-list","initial-index"])):v("",!0)])])]),_:1})]),t("div",ra,[a(S,{class:"logistics-card"},{header:n(()=>[t("div",da,[a(u,null,{default:n(()=>[a(c(z))]),_:1}),e[56]||(e[56]=t("span",null,"物流信息跟踪",-1)),a(d,{size:"small",onClick:ee},{default:n(()=>[...e[55]||(e[55]=[p("刷新",-1)])]),_:1})])]),default:n(()=>[t("div",la,[R.value.length>0?(l(),g(ne,{key:0},{default:n(()=>[(l(!0),m(U,null,W(R.value,(r,N)=>(l(),g(ae,{key:N,timestamp:r.time,type:ge(r.statusText),placement:"top"},{default:n(()=>[t("div",ca,[t("div",ua,[a(A,{type:ge(r.statusText)},{default:n(()=>[p(i(r.statusText||r.status),1)]),_:2},1032,["type"])]),t("div",pa,i(r.description),1),r.location?(l(),m("div",ma,[a(u,null,{default:n(()=>[a(c(ke))]),_:1}),p(" "+i(r.location),1)])):v("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(l(),g(we,{key:1,description:"暂无物流信息"}))])]),_:1})]),t("div",va,[a(S,{class:"operation-log-card"},{header:n(()=>[t("div",_a,[a(u,null,{default:n(()=>[a(c(jt))]),_:1}),e[57]||(e[57]=t("span",null,"操作记录",-1)),a(d,{size:"small",type:"text",onClick:e[2]||(e[2]=r=>P.value=!P.value),icon:P.value?c(K):c(le)},{default:n(()=>[p(i(P.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),default:n(()=>[a(ie,null,{default:n(()=>[re(t("div",null,[a(Le,{data:ve.value,style:{width:"100%"}},{default:n(()=>[a(I,{prop:"time",label:"操作时间",width:"180"},{default:n(({row:r})=>[p(i(se(r.time)),1)]),_:1}),a(I,{prop:"operator",label:"操作人",width:"120"}),a(I,{prop:"action",label:"操作类型",width:"120"}),a(I,{prop:"description",label:"操作描述"}),a(I,{prop:"remark",label:"备注",width:"200"})]),_:1},8,["data"])],512),[[de,!P.value]])]),_:1})]),_:1})]),t("div",fa,[a(S,{class:"status-timeline-card"},{header:n(()=>[t("div",ga,[a(u,null,{default:n(()=>[a(c(E))]),_:1}),e[58]||(e[58]=t("span",null,"订单状态和轨迹",-1)),a(d,{size:"small",type:"text",onClick:e[3]||(e[3]=r=>B.value=!B.value),icon:B.value?c(K):c(le)},{default:n(()=>[p(i(B.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),default:n(()=>[a(ie,null,{default:n(()=>[re(t("div",null,[a(ne,null,{default:n(()=>[(l(!0),m(U,null,W(G.value,(r,N)=>(l(),g(ae,{key:N,timestamp:r.timestamp,type:r.type,icon:r.icon,color:r.color},{default:n(()=>[t("div",ha,[t("div",ya,i(r.title),1),t("div",wa,i(r.description),1),r.operator?(l(),m("div",ka,"操作人："+i(r.operator),1)):v("",!0)])]),_:2},1032,["timestamp","type","icon","color"]))),128))]),_:1})],512),[[de,!B.value]])]),_:1})]),_:1})]),Ke.value?(l(),m("div",Ta,[a(S,{class:"logistics-track-card"},{header:n(()=>[t("div",ba,[a(u,null,{default:n(()=>[a(c(z))]),_:1}),e[59]||(e[59]=t("span",null,"物流轨迹",-1)),t("div",xa,[o.expressCompany?(l(),g(A,{key:0,type:"info",size:"small"},{default:n(()=>[p(i(o.expressCompany),1)]),_:1})):v("",!0),o.trackingNumber?(l(),m("span",Sa,i(o.trackingNumber),1)):v("",!0)]),a(d,{size:"small",type:"text",onClick:e[4]||(e[4]=r=>q.value=!q.value),icon:q.value?c(K):c(le)},{default:n(()=>[p(i(q.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),default:n(()=>[a(ie,null,{default:n(()=>[re(t("div",null,[Q.value?(l(),m("div",Na,[a(yt,{rows:3,animated:""})])):R.value.length>0?(l(),g(ne,{key:1},{default:n(()=>[(l(!0),m(U,null,W(R.value,(r,N)=>(l(),g(ae,{key:N,timestamp:r.time,type:ge(r.status),icon:nt(r.status)},{default:n(()=>[t("div",Da,[t("div",Ca,i(r.statusText),1),t("div",Aa,i(r.description),1),r.location?(l(),m("div",Ia,[a(u,null,{default:n(()=>[a(c(ke))]),_:1}),p(" "+i(r.location),1)])):v("",!0)])]),_:2},1032,["timestamp","type","icon"]))),128))]),_:1})):(l(),g(we,{key:2,description:"暂无物流信息"})),t("div",$a,[a(d,{size:"small",type:"primary",loading:Q.value,onClick:ee},{default:n(()=>[...e[60]||(e[60]=[p(" 刷新物流信息 ",-1)])]),_:1},8,["loading"])])],512),[[de,!q.value]])]),_:1})]),_:1})])):v("",!0),t("div",Oa,[a(S,{class:"after-sales-card"},{header:n(()=>[t("div",Ea,[a(u,null,{default:n(()=>[a(c(Mt))]),_:1}),e[61]||(e[61]=t("span",null,"售后历史轨迹",-1)),a(d,{size:"small",type:"text",onClick:e[5]||(e[5]=r=>F.value=!F.value),icon:F.value?c(K):c(le)},{default:n(()=>[p(i(F.value?"展开":"收起"),1)]),_:1},8,["icon"])])]),default:n(()=>[a(ie,null,{default:n(()=>[re(t("div",null,[J.value.length>0?(l(),g(ne,{key:0},{default:n(()=>[(l(!0),m(U,null,W(J.value,(r,N)=>(l(),g(ae,{key:N,timestamp:r.timestamp,type:ct(r.type)},{default:n(()=>[t("div",za,[t("div",La,i(r.title),1),t("div",ja,i(r.description),1),r.operator?(l(),m("div",Ma,"处理人："+i(r.operator),1)):v("",!0),r.amount?(l(),m("div",Ra,"金额：¥"+i(r.amount.toFixed(2)),1)):v("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(l(),g(we,{key:1,description:"暂无售后记录"}))],512),[[de,!F.value]])]),_:1})]),_:1})])])}}}),Za=Wt(Pa,[["__scopeId","data-v-5b72652f"]]);export{Za as default};
