# 部门管理与角色权限关系文档

## 概述

本文档详细说明了CRM系统中部门管理和角色权限之间的关系，以及它们在系统中的作用和区别。

## 核心概念

### 1. 部门管理 (Department Management)
部门管理是组织架构的基础，用于管理公司的组织结构和人员归属。

**主要功能：**
- 创建、编辑、删除部门
- 设置部门层级关系（父子部门）
- 管理部门成员
- 设置部门负责人
- 配置部门特定的权限范围

**核心属性：**
- 部门名称
- 部门描述
- 父部门ID（支持多级部门结构）
- 部门负责人
- 部门成员列表
- 部门状态（启用/禁用）
- 创建时间和更新时间

### 2. 角色权限 (Role Permissions)
角色权限是功能权限的集合，定义了用户在系统中可以执行的操作。

**主要功能：**
- 创建、编辑、删除角色
- 配置角色的功能权限
- 分配角色给用户
- 管理角色层级关系

**核心属性：**
- 角色名称
- 角色描述
- 权限列表（功能权限集合）
- 角色级别
- 角色状态

## 关系模型

### 1. 用户-部门-角色三元关系

```
用户 (User)
├── 所属部门 (Department) - 一对一关系
├── 分配角色 (Role) - 多对多关系
└── 有效权限 = 角色权限 ∩ 部门权限范围
```

### 2. 权限继承机制

**部门权限继承：**
- 子部门继承父部门的基础权限
- 子部门可以有额外的特定权限
- 部门负责人自动获得本部门及子部门的管理权限

**角色权限叠加：**
- 用户可以拥有多个角色
- 最终权限 = 所有角色权限的并集
- 受部门权限范围限制

## 权限控制逻辑

### 1. 数据访问权限

**超级管理员：**
- 访问所有数据
- 管理所有部门和角色

**部门负责人：**
- 访问本部门及子部门数据
- 管理本部门成员的角色分配

**普通员工：**
- 访问个人数据
- 根据角色权限访问相关功能数据
- 受部门数据范围限制

### 2. 功能访问权限

**系统管理功能：**
- 部门管理：需要管理员权限
- 角色权限管理：需要超级管理员权限
- 用户管理：部门负责人可管理本部门用户

**业务功能：**
- 客户管理：根据角色权限和部门范围
- 订单管理：根据角色权限和部门范围
- 数据统计：根据角色权限和部门范围

## 实际应用场景

### 场景1：销售部门结构
```
销售部
├── 华北销售部
│   ├── 北京销售组
│   └── 天津销售组
└── 华南销售部
    ├── 广州销售组
    └── 深圳销售组
```

**权限配置：**
- 销售部总监：管理整个销售部数据
- 华北销售部经理：管理华北销售部及其子部门数据
- 北京销售组长：管理北京销售组数据
- 销售员：只能访问自己的客户和订单数据

### 场景2：角色权限配置
```
角色层级：
├── 超级管理员 (所有权限)
├── 部门经理 (部门管理 + 业务权限)
├── 销售主管 (客户管理 + 订单管理)
├── 销售员 (客户查看 + 订单创建)
└── 客服 (客户服务 + 售后支持)
```

## 部门详情页功能

### 1. 基本信息
- 部门名称、描述
- 创建时间、更新时间
- 部门状态

### 2. 组织架构
- 父部门信息
- 子部门列表
- 部门层级图

### 3. 人员管理
- 部门负责人信息
- 部门成员列表
- 成员角色分配情况

### 4. 权限配置
- 部门特定权限设置
- 数据访问范围配置
- 功能权限限制

### 5. 统计信息
- 部门人员数量
- 部门业绩统计
- 权限使用情况

## 最佳实践

### 1. 部门设计原则
- 按业务职能划分部门
- 保持部门层级简洁（建议不超过4级）
- 明确部门职责边界

### 2. 角色设计原则
- 按工作职责定义角色
- 遵循最小权限原则
- 定期审查和更新角色权限

### 3. 权限分配原则
- 基于岗位需要分配权限
- 定期审查用户权限
- 建立权限变更审批流程

## 技术实现

### 1. 数据库设计
```sql
-- 部门表
departments (id, name, description, parent_id, manager_id, status, created_at, updated_at)

-- 角色表
roles (id, name, description, permissions, level, status, created_at, updated_at)

-- 用户部门关系表
user_departments (user_id, department_id, created_at)

-- 用户角色关系表
user_roles (user_id, role_id, created_at)
```

### 2. 权限检查流程
1. 获取用户所属部门
2. 获取用户分配的角色
3. 计算角色权限并集
4. 应用部门权限范围限制
5. 返回最终有效权限

## 总结

部门管理和角色权限是CRM系统权限控制的两个核心维度：
- **部门管理**：解决"谁能访问哪些数据"的问题
- **角色权限**：解决"谁能执行哪些操作"的问题

两者结合使用，形成了完整的权限控制体系，既保证了数据安全，又提供了灵活的权限管理能力。