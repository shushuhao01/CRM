<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘ç»œè¿æ¥ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .test-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .status {
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #logs {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç½‘ç»œè¿æ¥ä¿®å¤æµ‹è¯•</h1>
        
        <div class="test-section">
            <div class="test-title">1. å‰ç«¯æœåŠ¡å™¨è¿æ¥æµ‹è¯•</div>
            <div id="frontend-status" class="status info">æ£€æµ‹ä¸­...</div>
            <button onclick="testFrontend()">é‡æ–°æµ‹è¯•å‰ç«¯</button>
        </div>

        <div class="test-section">
            <div class="test-title">2. åç«¯APIæœåŠ¡å™¨è¿æ¥æµ‹è¯•</div>
            <div id="backend-status" class="status info">æ£€æµ‹ä¸­...</div>
            <button onclick="testBackend()">é‡æ–°æµ‹è¯•åç«¯</button>
        </div>

        <div class="test-section">
            <div class="test-title">3. Mock APIé…ç½®æ£€æµ‹</div>
            <div id="mock-status" class="status info">æ£€æµ‹ä¸­...</div>
            <button onclick="testMockConfig()">æ£€æµ‹Mocké…ç½®</button>
        </div>

        <div class="test-section">
            <div class="test-title">4. åº”ç”¨å¯åŠ¨æµ‹è¯•</div>
            <div id="app-status" class="status info">æ£€æµ‹ä¸­...</div>
            <button onclick="testApp()">æµ‹è¯•åº”ç”¨å¯åŠ¨</button>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•æ—¥å¿—</div>
            <div id="logs"></div>
            <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <script>
        function log(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
        }

        function updateStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            element.className = `status ${status}`;
            element.textContent = message;
        }

        async function testFrontend() {
            log('å¼€å§‹æµ‹è¯•å‰ç«¯æœåŠ¡å™¨è¿æ¥...');
            updateStatus('frontend-status', 'info', 'æµ‹è¯•ä¸­...');
            
            try {
                const response = await fetch('http://localhost:5175/');
                if (response.ok) {
                    updateStatus('frontend-status', 'success', 'âœ… å‰ç«¯æœåŠ¡å™¨è¿æ¥æ­£å¸¸');
                    log('âœ… å‰ç«¯æœåŠ¡å™¨ (http://localhost:5175) è¿æ¥æˆåŠŸ');
                } else {
                    updateStatus('frontend-status', 'error', 'âŒ å‰ç«¯æœåŠ¡å™¨å“åº”å¼‚å¸¸');
                    log(`âŒ å‰ç«¯æœåŠ¡å™¨å“åº”çŠ¶æ€: ${response.status}`);
                }
            } catch (error) {
                updateStatus('frontend-status', 'error', 'âŒ å‰ç«¯æœåŠ¡å™¨è¿æ¥å¤±è´¥');
                log(`âŒ å‰ç«¯æœåŠ¡å™¨è¿æ¥å¤±è´¥: ${error.message}`);
            }
        }

        async function testBackend() {
            log('å¼€å§‹æµ‹è¯•åç«¯APIæœåŠ¡å™¨è¿æ¥...');
            updateStatus('backend-status', 'info', 'æµ‹è¯•ä¸­...');
            
            try {
                const response = await fetch('http://localhost:3000/health');
                if (response.ok) {
                    const data = await response.json();
                    updateStatus('backend-status', 'success', 'âœ… åç«¯APIæœåŠ¡å™¨è¿æ¥æ­£å¸¸');
                    log(`âœ… åç«¯APIæœåŠ¡å™¨è¿æ¥æˆåŠŸ: ${data.message || 'å¥åº·æ£€æŸ¥é€šè¿‡'}`);
                } else {
                    updateStatus('backend-status', 'error', 'âŒ åç«¯APIæœåŠ¡å™¨å“åº”å¼‚å¸¸');
                    log(`âŒ åç«¯APIæœåŠ¡å™¨å“åº”çŠ¶æ€: ${response.status}`);
                }
            } catch (error) {
                updateStatus('backend-status', 'error', 'âŒ åç«¯APIæœåŠ¡å™¨è¿æ¥å¤±è´¥');
                log(`âŒ åç«¯APIæœåŠ¡å™¨è¿æ¥å¤±è´¥: ${error.message}`);
            }
        }

        function testMockConfig() {
            log('æ£€æµ‹Mock APIé…ç½®...');
            updateStatus('mock-status', 'info', 'æ£€æµ‹ä¸­...');
            
            // æ£€æŸ¥ç¯å¢ƒå˜é‡
            const apiBaseUrl = 'http://localhost:3000/api/v1'; // ä»ç¯å¢ƒå˜é‡è·å–
            const isProduction = false; // å¼€å‘ç¯å¢ƒ
            
            // æ¨¡æ‹ŸshouldUseMockApié€»è¾‘
            let shouldUseMock = false;
            if (isProduction) {
                shouldUseMock = false;
                log('ğŸ” ç”Ÿäº§ç¯å¢ƒ - ä¸ä½¿ç”¨Mock API');
            } else if (apiBaseUrl && apiBaseUrl.includes(':3000')) {
                shouldUseMock = false;
                log('ğŸ” æ£€æµ‹åˆ°åç«¯APIé…ç½® (:3000) - ä½¿ç”¨çœŸå®API');
            } else if (apiBaseUrl && !apiBaseUrl.includes('localhost')) {
                shouldUseMock = false;
                log('ğŸ” æ£€æµ‹åˆ°å¤–éƒ¨APIé…ç½® - ä½¿ç”¨çœŸå®API');
            } else {
                shouldUseMock = true;
                log('ğŸ” å¼€å‘ç¯å¢ƒé»˜è®¤ - ä½¿ç”¨Mock API');
            }
            
            log(`ğŸ“‹ VITE_API_BASE_URL: ${apiBaseUrl || 'æœªè®¾ç½®'}`);
            
            if (shouldUseMock) {
                updateStatus('mock-status', 'success', 'âœ… é…ç½®ä¸ºä½¿ç”¨Mock API');
                log('âœ… å½“å‰é…ç½®: ä½¿ç”¨Mock APIï¼Œé¿å…ç½‘ç»œè¯·æ±‚');
            } else {
                updateStatus('mock-status', 'info', 'â„¹ï¸ é…ç½®ä¸ºä½¿ç”¨çœŸå®API');
                log('â„¹ï¸ å½“å‰é…ç½®: ä½¿ç”¨çœŸå®APIï¼Œéœ€è¦åç«¯æœåŠ¡å™¨');
            }
        }

        async function testApp() {
            log('å¼€å§‹æµ‹è¯•åº”ç”¨å¯åŠ¨...');
            updateStatus('app-status', 'info', 'æµ‹è¯•ä¸­...');
            
            try {
                // æµ‹è¯•åº”ç”¨ä¸»é¡µé¢
                const response = await fetch('http://localhost:5175/');
                if (response.ok) {
                    const html = await response.text();
                    if (html.includes('CRM') || html.includes('app')) {
                        updateStatus('app-status', 'success', 'âœ… åº”ç”¨å¯åŠ¨æ­£å¸¸');
                        log('âœ… åº”ç”¨é¡µé¢åŠ è½½æˆåŠŸï¼Œæœªå‘ç°ç½‘ç»œè¿æ¥é”™è¯¯');
                    } else {
                        updateStatus('app-status', 'error', 'âŒ åº”ç”¨é¡µé¢å†…å®¹å¼‚å¸¸');
                        log('âŒ åº”ç”¨é¡µé¢å†…å®¹ä¸ç¬¦åˆé¢„æœŸ');
                    }
                } else {
                    updateStatus('app-status', 'error', 'âŒ åº”ç”¨é¡µé¢åŠ è½½å¤±è´¥');
                    log(`âŒ åº”ç”¨é¡µé¢å“åº”çŠ¶æ€: ${response.status}`);
                }
            } catch (error) {
                updateStatus('app-status', 'error', 'âŒ åº”ç”¨è¿æ¥å¤±è´¥');
                log(`âŒ åº”ç”¨è¿æ¥å¤±è´¥: ${error.message}`);
            }
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•
        window.onload = function() {
            log('ğŸš€ å¼€å§‹ç½‘ç»œè¿æ¥ä¿®å¤éªŒè¯...');
            log('='.repeat(50));
            
            setTimeout(() => {
                testFrontend();
                setTimeout(() => {
                    testBackend();
                    setTimeout(() => {
                        testMockConfig();
                        setTimeout(() => {
                            testApp();
                            setTimeout(() => {
                                log('='.repeat(50));
                                log('âœ¨ ç½‘ç»œè¿æ¥ä¿®å¤éªŒè¯å®Œæˆï¼');
                            }, 1000);
                        }, 1000);
                    }, 1000);
                }, 1000);
            }, 500);
        };
    </script>
</body>
</html>