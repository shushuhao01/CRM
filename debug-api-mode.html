<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API模式调试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 3px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>API模式调试工具</h1>
    
    <div class="section">
        <h3>环境变量检查</h3>
        <button onclick="checkEnvVars()">检查环境变量</button>
        <div id="envResult" class="result"></div>
    </div>
    
    <div class="section">
        <h3>API模式检查</h3>
        <button onclick="checkApiMode()">检查API模式</button>
        <div id="apiModeResult" class="result"></div>
    </div>
    
    <div class="section">
        <h3>直接API测试</h3>
        <button onclick="testDirectApi()">测试直接API调用</button>
        <div id="directApiResult" class="result"></div>
    </div>
    
    <div class="section">
        <h3>前端登录测试</h3>
        <button onclick="testFrontendLogin()">测试前端登录</button>
        <div id="frontendLoginResult" class="result"></div>
    </div>

    <script>
        function checkEnvVars() {
            const result = document.getElementById('envResult');
            result.innerHTML = `
                <p>此页面无法直接访问Vite环境变量</p>
                <p>请在Vue应用的浏览器控制台中运行:</p>
                <pre>console.log('环境变量:', import.meta.env)</pre>
            `;
        }
        
        function checkApiMode() {
            const result = document.getElementById('apiModeResult');
            result.innerHTML = `
                <p>此页面无法直接检查API模式</p>
                <p>请在Vue应用的浏览器控制台中运行:</p>
                <pre>
// 检查环境变量
console.log('VITE_API_BASE_URL:', import.meta.env.VITE_API_BASE_URL);
console.log('PROD:', import.meta.env.PROD);

// 检查API模式（如果函数可用）
if (window.shouldUseMockApi) {
    console.log('shouldUseMockApi:', window.shouldUseMockApi());
}
                </pre>
            `;
         }
        
        async function testDirectApi() {
            const result = document.getElementById('directApiResult');
            result.innerHTML = '正在测试...';
            
            try {
                const response = await fetch('http://localhost:3000/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });
                
                const data = await response.json();
                
                result.innerHTML = `
                    <p><strong>状态码:</strong> ${response.status}</p>
                    <p><strong>响应:</strong></p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                result.className = response.ok ? 'result success' : 'result error';
            } catch (error) {
                result.innerHTML = `<p><strong>错误:</strong> ${error.message}</p>`;
                result.className = 'result error';
            }
        }
        
        async function testFrontendLogin() {
            const result = document.getElementById('frontendLoginResult');
            result.innerHTML = '正在测试前端登录...';
            
            try {
                // 这里需要导入前端的登录服务
                // 由于这是一个独立的HTML文件，我们无法直接导入
                // 所以这个测试需要在实际的Vue应用中进行
                result.innerHTML = `
                    <p>此测试需要在Vue应用环境中进行</p>
                    <p>请在浏览器控制台中运行以下代码:</p>
                    <pre>
// 检查API模式
console.log('shouldUseMockApi:', window.shouldUseMockApi ? window.shouldUseMockApi() : '函数未找到');

// 测试登录
if (window.authApiService) {
    window.authApiService.login({username: 'admin', password: 'admin123'})
        .then(response => console.log('登录成功:', response))
        .catch(error => console.error('登录失败:', error));
}
                    </pre>
                `;
            } catch (error) {
                result.innerHTML = `<p><strong>错误:</strong> ${error.message}</p>`;
                result.className = 'result error';
            }
        }
    </script>
</body>
</html>