<template>
  <div class="help-content">
    <h1>æ•°æ®åº“é…ç½®</h1>

    <section class="intro-section">
      <div class="intro-card">
        <el-icon class="intro-icon"><Coin /></el-icon>
        <div class="intro-text">
          <p>äº‘å®¢CRMç³»ç»Ÿä½¿ç”¨ MySQL æ•°æ®åº“å­˜å‚¨æ•°æ®ã€‚æœ¬æ–‡æ¡£å°†æŒ‡å¯¼æ‚¨å®Œæˆæ•°æ®åº“çš„å®‰è£…ã€é…ç½®å’Œåˆå§‹åŒ–ã€‚</p>
        </div>
      </div>
    </section>

    <section>
      <h2><el-icon><Download /></el-icon> MySQLå®‰è£…</h2>

      <el-tabs v-model="installMethod" type="border-card">
        <el-tab-pane label="ğŸ–¥ï¸ å®å¡”é¢æ¿å®‰è£…ï¼ˆæ¨èï¼‰" name="bt">
          <div class="install-content">
            <h3>æ­¥éª¤è¯´æ˜</h3>
            <ol>
              <li>ç™»å½•å®å¡”é¢æ¿</li>
              <li>ç‚¹å‡»å·¦ä¾§èœå•ã€Œè½¯ä»¶å•†åº—ã€</li>
              <li>åœ¨æœç´¢æ¡†è¾“å…¥ <code>mysql</code></li>
              <li>æ‰¾åˆ° <strong>MySQL 8.0</strong>ï¼ˆæˆ– 5.7ï¼‰ï¼Œç‚¹å‡»ã€Œå®‰è£…ã€</li>
              <li>é€‰æ‹©ã€Œæé€Ÿå®‰è£…ã€ï¼Œç­‰å¾…å®‰è£…å®Œæˆï¼ˆçº¦5-8åˆ†é’Ÿï¼‰</li>
            </ol>

            <div class="tip-box success">
              <el-icon><SuccessFilled /></el-icon>
              <span>å®å¡”é¢æ¿ä¼šè‡ªåŠ¨é…ç½® MySQLï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®</span>
            </div>
          </div>
        </el-tab-pane>

        <el-tab-pane label="Ubuntu/Debian" name="ubuntu">
          <div class="install-content">
            <div class="code-block">
              <div class="code-header">
                <span>Shell</span>
                <el-button size="small" text @click="copyCode('ubuntu-mysql')">å¤åˆ¶</el-button>
              </div>
              <pre id="ubuntu-mysql"># æ›´æ–°è½¯ä»¶æº
apt-get update

# å®‰è£…MySQL 8.0
apt-get install -y mysql-server

# å¯åŠ¨æœåŠ¡
systemctl start mysql
systemctl enable mysql

# å®‰å…¨é…ç½®ï¼ˆè®¾ç½®rootå¯†ç ç­‰ï¼‰
mysql_secure_installation</pre>
            </div>
          </div>
        </el-tab-pane>

        <el-tab-pane label="CentOS" name="centos">
          <div class="install-content">
            <div class="code-block">
              <div class="code-header">
                <span>Shell</span>
                <el-button size="small" text @click="copyCode('centos-mysql')">å¤åˆ¶</el-button>
              </div>
              <pre id="centos-mysql"># å®‰è£…MySQL 8.0
yum install -y mysql-server

# å¯åŠ¨æœåŠ¡
systemctl start mysqld
systemctl enable mysqld

# è·å–ä¸´æ—¶å¯†ç 
grep 'temporary password' /var/log/mysqld.log

# å®‰å…¨é…ç½®
mysql_secure_installation</pre>
            </div>
          </div>
        </el-tab-pane>
      </el-tabs>
    </section>

    <section>
      <h2><el-icon><Plus /></el-icon> åˆ›å»ºæ•°æ®åº“</h2>

      <el-tabs v-model="createMethod" type="border-card">
        <el-tab-pane label="ğŸ–¥ï¸ å®å¡”é¢æ¿åˆ›å»ºï¼ˆæ¨èï¼‰" name="bt">
          <div class="create-content">
            <h3>æ“ä½œæ­¥éª¤</h3>
            <ol>
              <li>åœ¨å®å¡”é¢æ¿ç‚¹å‡»å·¦ä¾§èœå•ã€Œæ•°æ®åº“ã€</li>
              <li>ç‚¹å‡»ã€Œæ·»åŠ æ•°æ®åº“ã€æŒ‰é’®</li>
              <li>å¡«å†™ä¿¡æ¯ï¼š
                <ul>
                  <li>æ•°æ®åº“åï¼š<code>crm_db</code></li>
                  <li>ç”¨æˆ·åï¼š<code>crm_user</code></li>
                  <li>å¯†ç ï¼šç‚¹å‡»ã€Œç”Ÿæˆå¯†ç ã€è‡ªåŠ¨ç”Ÿæˆå¼ºå¯†ç </li>
                  <li>è®¿é—®æƒé™ï¼šé€‰æ‹©ã€Œæœ¬åœ°æœåŠ¡å™¨ã€</li>
                </ul>
              </li>
              <li><strong>é‡è¦ï¼š</strong>å¤åˆ¶å¹¶ä¿å­˜ç”Ÿæˆçš„å¯†ç ï¼</li>
              <li>ç‚¹å‡»ã€Œæäº¤ã€åˆ›å»ºæ•°æ®åº“</li>
            </ol>

            <div class="tip-box warning">
              <el-icon><WarningFilled /></el-icon>
              <span>è¯·åŠ¡å¿…ä¿å­˜æ•°æ®åº“å¯†ç ï¼Œåç»­é…ç½® backend/.env æ—¶éœ€è¦ä½¿ç”¨</span>
            </div>
          </div>
        </el-tab-pane>

        <el-tab-pane label="å‘½ä»¤è¡Œåˆ›å»º" name="cli">
          <div class="create-content">
            <div class="code-block">
              <div class="code-header">
                <span>MySQL</span>
                <el-button size="small" text @click="copyCode('create-db')">å¤åˆ¶</el-button>
              </div>
              <pre id="create-db"># ç™»å½•MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“ï¼ˆä½¿ç”¨utf8mb4å­—ç¬¦é›†ï¼‰
CREATE DATABASE crm_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# åˆ›å»ºç”¨æˆ·ï¼ˆè¯·ä¿®æ”¹å¯†ç ï¼‰
CREATE USER 'crm_user'@'localhost' IDENTIFIED BY 'your_strong_password';

# æˆæƒ
GRANT ALL PRIVILEGES ON crm_db.* TO 'crm_user'@'localhost';
FLUSH PRIVILEGES;

# é€€å‡º
EXIT;</pre>
            </div>
          </div>
        </el-tab-pane>
      </el-tabs>
    </section>

    <section>
      <h2><el-icon><Upload /></el-icon> å¯¼å…¥æ•°æ®åº“ç»“æ„</h2>

      <el-tabs v-model="importMethod" type="border-card">
        <el-tab-pane label="ğŸ–¥ï¸ å®å¡”é¢æ¿å¯¼å…¥ï¼ˆæ¨èï¼‰" name="bt">
          <div class="import-content">
            <ol>
              <li>åœ¨æ•°æ®åº“åˆ—è¡¨ä¸­æ‰¾åˆ° <code>crm_db</code></li>
              <li>ç‚¹å‡»å³ä¾§ã€Œç®¡ç†ã€æŒ‰é’®ï¼Œè¿›å…¥ phpMyAdmin</li>
              <li>ç‚¹å‡»é¡¶éƒ¨ã€Œå¯¼å…¥ã€æ ‡ç­¾</li>
              <li>ç‚¹å‡»ã€Œé€‰æ‹©æ–‡ä»¶ã€ï¼Œé€‰æ‹©é¡¹ç›®ä¸­çš„ <code>database/schema.sql</code></li>
              <li>ç‚¹å‡»ã€Œæ‰§è¡Œã€æŒ‰é’®</li>
              <li>ç­‰å¾…å¯¼å…¥å®Œæˆï¼Œåº”è¯¥çœ‹åˆ°å¤šä¸ªè¡¨è¢«åˆ›å»º</li>
            </ol>

            <div class="tip-box success">
              <el-icon><SuccessFilled /></el-icon>
              <span>å¯¼å…¥æˆåŠŸåï¼Œå¯ä»¥åœ¨å·¦ä¾§çœ‹åˆ° usersã€customersã€orders ç­‰è¡¨</span>
            </div>
          </div>
        </el-tab-pane>

        <el-tab-pane label="å‘½ä»¤è¡Œå¯¼å…¥" name="cli">
          <div class="import-content">
            <div class="code-block">
              <div class="code-header">
                <span>Shell</span>
                <el-button size="small" text @click="copyCode('import-sql')">å¤åˆ¶</el-button>
              </div>
              <pre id="import-sql"># è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/CRM

# å¯¼å…¥æ•°æ®åº“ç»“æ„
mysql -u crm_user -p crm_db &lt; database/schema.sql</pre>
            </div>
          </div>
        </el-tab-pane>
      </el-tabs>
    </section>

    <section>
      <h2><el-icon><Setting /></el-icon> é…ç½®åç«¯è¿æ¥</h2>
      <p>åœ¨ <code>backend/.env</code> æ–‡ä»¶ä¸­é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š</p>

      <div class="code-block">
        <div class="code-header">
          <span>backend/.env</span>
          <el-button size="small" text @click="copyCode('env-db')">å¤åˆ¶</el-button>
        </div>
        <pre id="env-db"># æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=crm_user
DB_PASSWORD=æ‚¨çš„æ•°æ®åº“å¯†ç   # â† å¡«å†™åˆ›å»ºæ•°æ®åº“æ—¶ä¿å­˜çš„å¯†ç 
DB_DATABASE=crm_db
DB_CHARSET=utf8mb4
DB_TIMEZONE=+08:00</pre>
      </div>
    </section>

    <section>
      <h2><el-icon><DocumentCopy /></el-icon> æ•°æ®å¤‡ä»½</h2>

      <h3>æ‰‹åŠ¨å¤‡ä»½</h3>
      <div class="code-block">
        <pre># å¤‡ä»½æ•°æ®åº“
mysqldump -u crm_user -p crm_db &gt; backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
mysql -u crm_user -p crm_db &lt; backup_20240101.sql</pre>
      </div>

      <h3>å®å¡”é¢æ¿å¤‡ä»½</h3>
      <ol>
        <li>åœ¨å®å¡”é¢æ¿ç‚¹å‡»ã€Œè®¡åˆ’ä»»åŠ¡ã€</li>
        <li>æ·»åŠ ä»»åŠ¡ï¼Œç±»å‹é€‰æ‹©ã€Œå¤‡ä»½æ•°æ®åº“ã€</li>
        <li>é€‰æ‹©è¦å¤‡ä»½çš„æ•°æ®åº“ <code>crm_db</code></li>
        <li>è®¾ç½®æ‰§è¡Œå‘¨æœŸï¼ˆå»ºè®®æ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰</li>
        <li>è®¾ç½®ä¿ç•™ä»½æ•°ï¼ˆå»ºè®®ä¿ç•™7ä»½ï¼‰</li>
      </ol>
    </section>

    <section>
      <h2><el-icon><QuestionFilled /></el-icon> å¸¸è§é—®é¢˜</h2>
      <el-collapse accordion>
        <el-collapse-item title="è¿æ¥æ•°æ®åº“å¤±è´¥" name="1">
          <div class="faq-content">
            <p><strong>æ£€æŸ¥æ­¥éª¤ï¼š</strong></p>
            <ul>
              <li>ç¡®è®¤ MySQL æœåŠ¡å·²å¯åŠ¨</li>
              <li>ç¡®è®¤ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®</li>
              <li>ç¡®è®¤æ•°æ®åº“åæ­£ç¡®</li>
              <li>ç¡®è®¤ç”¨æˆ·æœ‰è®¿é—®æƒé™</li>
              <li>å¦‚æœæ˜¯è¿œç¨‹è¿æ¥ï¼Œæ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 3306 ç«¯å£</li>
            </ul>
          </div>
        </el-collapse-item>
        <el-collapse-item title="å­—ç¬¦é›†/ä¹±ç é—®é¢˜" name="2">
          <div class="faq-content">
            <p>ç¡®ä¿æ•°æ®åº“ä½¿ç”¨ <code>utf8mb4</code> å­—ç¬¦é›†ï¼Œæ”¯æŒ emoji ç­‰ç‰¹æ®Šå­—ç¬¦ã€‚</p>
            <p>å¦‚æœå·²æœ‰æ•°æ®åº“å­—ç¬¦é›†ä¸å¯¹ï¼Œå¯ä»¥æ‰§è¡Œï¼š</p>
            <div class="code-block small">
              <pre>ALTER DATABASE crm_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</pre>
            </div>
          </div>
        </el-collapse-item>
        <el-collapse-item title="å¯¼å…¥ SQL æ–‡ä»¶å¤±è´¥" name="3">
          <div class="faq-content">
            <p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
            <ul>
              <li>SQL æ–‡ä»¶è¿‡å¤§ï¼Œè¶…è¿‡ phpMyAdmin ä¸Šä¼ é™åˆ¶</li>
              <li>SQL è¯­æ³•ä¸ MySQL ç‰ˆæœ¬ä¸å…¼å®¹</li>
            </ul>
            <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
            <ul>
              <li>ä½¿ç”¨å‘½ä»¤è¡Œå¯¼å…¥ï¼ˆæ— å¤§å°é™åˆ¶ï¼‰</li>
              <li>åœ¨å®å¡”é¢æ¿è°ƒæ•´ PHP ä¸Šä¼ é™åˆ¶</li>
            </ul>
          </div>
        </el-collapse-item>
      </el-collapse>
    </section>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { ElMessage } from 'element-plus'
import {
  Coin, Download, Plus, Upload, Setting, DocumentCopy, QuestionFilled,
  SuccessFilled, WarningFilled
} from '@element-plus/icons-vue'

const installMethod = ref('bt')
const createMethod = ref('bt')
const importMethod = ref('bt')

const copyCode = (id: string) => {
  const element = document.getElementById(id)
  if (element) {
    navigator.clipboard.writeText(element.textContent || '')
    ElMessage.success('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
  }
}
</script>
<style scoped>
.help-content {
  line-height: 1.8;
  color: #333;
}

.help-content h1 {
  font-size: 28px;
  color: #1a1a1a;
  margin-bottom: 30px;
  padding-bottom: 15px;
  border-bottom: 2px solid #409eff;
}

.help-content h2 {
  font-size: 20px;
  color: #303133;
  margin: 35px 0 20px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.help-content h3 {
  font-size: 16px;
  color: #409eff;
  margin: 20px 0 10px;
}

.help-content p {
  margin: 10px 0;
  color: #606266;
}

.help-content ul, .help-content ol {
  margin: 10px 0;
  padding-left: 20px;
}

.help-content li {
  margin: 8px 0;
  color: #606266;
}

.help-content code {
  background: #f5f7fa;
  padding: 2px 6px;
  border-radius: 4px;
  font-family: 'Consolas', 'Monaco', monospace;
  font-size: 13px;
  color: #e6a23c;
}

section {
  margin-bottom: 40px;
}

.intro-section {
  margin-bottom: 30px;
}

.intro-card {
  display: flex;
  align-items: flex-start;
  gap: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 25px;
  border-radius: 12px;
  color: white;
}

.intro-icon {
  font-size: 48px;
  opacity: 0.9;
}

.intro-text p {
  margin: 0;
  color: white;
  font-size: 15px;
  line-height: 1.8;
}

.install-content, .create-content, .import-content {
  padding: 15px 0;
}

.code-block {
  background: #1e1e1e;
  border-radius: 8px;
  margin: 15px 0;
  overflow: hidden;
}

.code-block.small {
  margin: 10px 0;
}

.code-block.small pre {
  padding: 10px;
  font-size: 12px;
}

.code-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 15px;
  background: #2d2d2d;
  border-bottom: 1px solid #3d3d3d;
}

.code-header span {
  color: #888;
  font-size: 12px;
}

.code-block pre {
  margin: 0;
  padding: 15px;
  color: #d4d4d4;
  font-family: 'Consolas', 'Monaco', monospace;
  font-size: 13px;
  line-height: 1.6;
  white-space: pre-wrap;
  overflow-x: auto;
}

.tip-box {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 15px;
  border-radius: 8px;
  margin: 15px 0;
  font-size: 14px;
}

.tip-box.success {
  background: #f0f9eb;
  border: 1px solid #e1f3d8;
  color: #67c23a;
}

.tip-box.warning {
  background: #fdf6ec;
  border: 1px solid #faecd8;
  color: #e6a23c;
}

.faq-content {
  padding: 10px 0;
}

.faq-content p {
  margin: 8px 0;
}

.faq-content ul {
  margin: 10px 0;
  padding-left: 20px;
}
</style>
