<template>
  <div class="mobile-sdk-container">
    <div class="page-header">
      <h1>ç§»åŠ¨SDKç®¡ç†</h1>
      <p>ç®¡ç†å’Œåˆ†å‘CRMç³»ç»Ÿç§»åŠ¨ç«¯SDK - ç°å·²å‡çº§ä¸ºPWAåº”ç”¨</p>
      
      <!-- APKä¸‹è½½è¯´æ˜ -->
      <div class="alert alert-info">
        <h3>ğŸ“± CRMç§»åŠ¨SDK - åŸç”ŸAndroidåº”ç”¨</h3>
        <p>æä¾›å®Œæ•´çš„CRMåŠŸèƒ½ï¼Œæ”¯æŒç›´æ¥å®‰è£…ï¼Œæ— éœ€åº”ç”¨å•†åº—ã€‚</p>
        <p>åŒ…å«æƒé™ç®¡ç†ã€ç½‘ç»œè¿æ¥æµ‹è¯•ã€é€šè¯æœåŠ¡ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚</p>
      </div>
    </div>

    <div class="sdk-grid">
      <!-- Android SDK -->
      <div class="sdk-card">
        <div class="sdk-icon android">
          <svg viewBox="0 0 24 24" width="48" height="48">
            <path fill="currentColor" d="M17.6,9.48l1.84-3.18c0.16-0.31,0.04-0.69-0.26-0.85c-0.29-0.15-0.65-0.06-0.83,0.22l-1.88,3.24 c-2.86-1.21-6.08-1.21-8.94,0L5.65,5.67c-0.19-0.29-0.58-0.38-0.87-0.22C4.5,5.65,4.41,6.01,4.56,6.3L6.4,9.48 C3.3,11.25,1.28,14.44,1,18h22C22.72,14.44,20.7,11.25,17.6,9.48z M7,15.25c-0.69,0-1.25-0.56-1.25-1.25 c0-0.69,0.56-1.25,1.25-1.25S8.25,13.31,8.25,14C8.25,14.69,7.69,15.25,7,15.25z M17,15.25c-0.69,0-1.25-0.56-1.25-1.25 c0-0.69,0.56-1.25,1.25-1.25s1.25,0.56,1.25,1.25C18.25,14.69,17.69,15.25,17,15.25z"/>
          </svg>
        </div>
        <h3>Android SDK</h3>
        <p>é€‚ç”¨äºAndroidè®¾å¤‡çš„CRMç§»åŠ¨SDK</p>
        <div class="sdk-info">
          <div class="info-item">
            <span class="label">ç‰ˆæœ¬:</span>
            <span class="value">1.0.0</span>
          </div>
          <div class="info-item">
            <span class="label">å¤§å°:</span>
            <span class="value">{{ androidSize }}</span>
          </div>
          <div class="info-item">
            <span class="label">æ›´æ–°æ—¶é—´:</span>
            <span class="value">{{ androidUpdateTime }}</span>
          </div>
        </div>
        <div class="sdk-actions">
          <a href="/api/v1/mobile-sdk/download/android" class="btn btn-primary" download>
            <i class="fas fa-download"></i>
            ä¸‹è½½APK
          </a>
          <button @click="showInstallGuide('android')" class="btn btn-secondary">
            <i class="fas fa-book"></i>
            å®‰è£…è¯´æ˜
          </button>
        </div>
      </div>

      <!-- iOS SDK -->
      <div class="sdk-card">
        <div class="sdk-icon ios">
          <svg viewBox="0 0 24 24" width="48" height="48">
            <path fill="currentColor" d="M18.71,19.5C17.88,20.74 17,21.95 15.66,21.97C14.32,22 13.89,21.18 12.37,21.18C10.84,21.18 10.37,21.95 9.1,22C7.79,22.05 6.8,20.68 5.96,19.47C4.25,17 2.94,12.45 4.7,9.39C5.57,7.87 7.13,6.91 8.82,6.88C10.1,6.86 11.32,7.75 12.11,7.75C12.89,7.75 14.37,6.68 15.92,6.84C16.57,6.87 18.39,7.1 19.56,8.82C19.47,8.88 17.39,10.1 17.41,12.63C17.44,15.65 20.06,16.66 20.09,16.67C20.06,16.74 19.67,18.11 18.71,19.5M13,3.5C13.73,2.67 14.94,2.04 15.94,2C16.07,3.17 15.6,4.35 14.9,5.19C14.21,6.04 13.07,6.7 11.95,6.61C11.8,5.46 12.36,4.26 13,3.5Z"/>
          </svg>
        </div>
        <h3>iOS SDK</h3>
        <p>é€‚ç”¨äºiPhoneå’ŒiPadçš„CRMç§»åŠ¨SDK</p>
        <div class="sdk-info">
          <div class="info-item">
            <span class="label">ç‰ˆæœ¬:</span>
            <span class="value">1.0.0</span>
          </div>
          <div class="info-item">
            <span class="label">å¤§å°:</span>
            <span class="value">{{ iosSize }}</span>
          </div>
          <div class="info-item">
            <span class="label">æ›´æ–°æ—¶é—´:</span>
            <span class="value">{{ iosUpdateTime }}</span>
          </div>
        </div>
        <div class="sdk-actions">
          <a href="/api/v1/mobile-sdk/download/ios" class="btn btn-primary" download>
            <i class="fas fa-download"></i>
            ä¸‹è½½IPA
          </a>
          <button @click="showInstallGuide('ios')" class="btn btn-secondary">
            <i class="fas fa-book"></i>
            å®‰è£…è¯´æ˜
          </button>
        </div>
      </div>
    </div>

    <!-- å®‰è£…è¯´æ˜ -->
    <div class="installation-guide">
      <h2>å®‰è£…è¯´æ˜</h2>
      <div class="guide-tabs">
        <button 
          class="tab-btn" 
          :class="{ active: activeTab === 'android' }"
          @click="activeTab = 'android'"
        >
          Androidå®‰è£…
        </button>
        <button 
          class="tab-btn" 
          :class="{ active: activeTab === 'ios' }"
          @click="activeTab = 'ios'"
        >
          iOSå®‰è£…
        </button>
        <button 
          class="tab-btn" 
          :class="{ active: activeTab === 'web' }"
          @click="activeTab = 'web'"
        >
          Webç‰ˆæœ¬
        </button>
      </div>

      <div class="tab-content">
        <div v-if="activeTab === 'android'" class="guide-content">
          <h3>Android APKå®‰è£…æ­¥éª¤</h3>
          <ol>
            <li><strong>ä¸‹è½½APKæ–‡ä»¶</strong><br>
                ç‚¹å‡»ä¸Šæ–¹"ä¸‹è½½APK"æŒ‰é’®ï¼Œå°†æ–‡ä»¶ä¿å­˜åˆ°è®¾å¤‡</li>
            <li><strong>å¯ç”¨æœªçŸ¥æ¥æº</strong><br>
                è¿›å…¥è®¾ç½® â†’ å®‰å…¨ â†’ å…è®¸å®‰è£…æœªçŸ¥æ¥æºçš„åº”ç”¨</li>
            <li><strong>å®‰è£…åº”ç”¨</strong><br>
                æ‰¾åˆ°ä¸‹è½½çš„APKæ–‡ä»¶ï¼Œç‚¹å‡»è¿›è¡Œå®‰è£…</li>
            <li><strong>æˆäºˆæƒé™</strong><br>
                é¦–æ¬¡å¯åŠ¨æ—¶ï¼Œæ ¹æ®æç¤ºæˆäºˆå¿…è¦çš„æƒé™</li>
            <li><strong>å¼€å§‹ä½¿ç”¨</strong><br>
                å®Œæˆæƒé™è®¾ç½®åå³å¯æ­£å¸¸ä½¿ç”¨CRMåŠŸèƒ½</li>
          </ol>
          <div class="note">
            <strong>ä¼˜åŠ¿ï¼š</strong>å®Œæ•´çš„é€šè¯åŠŸèƒ½æ”¯æŒï¼Œæ›´å¥½çš„æƒé™ç®¡ç†ï¼ŒåŸç”Ÿæ€§èƒ½ä½“éªŒ
          </div>
        </div>

        <div v-if="activeTab === 'ios'" class="guide-content">
          <h3>iOS IPAå®‰è£…æ­¥éª¤</h3>
          <ol>
            <li><strong>ä¸‹è½½IPAæ–‡ä»¶</strong><br>
                ç‚¹å‡»ä¸Šæ–¹"ä¸‹è½½IPA"æŒ‰é’®ï¼Œå°†æ–‡ä»¶ä¿å­˜åˆ°è®¾å¤‡</li>
            <li><strong>ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·</strong><br>
                éœ€è¦ä½¿ç”¨AltStoreã€Sideloadlyç­‰å·¥å…·è¿›è¡Œå®‰è£…</li>
            <li><strong>ä¿¡ä»»å¼€å‘è€…</strong><br>
                å®‰è£…åéœ€è¦åœ¨è®¾ç½®ä¸­ä¿¡ä»»å¼€å‘è€…è¯ä¹¦</li>
            <li><strong>æˆäºˆæƒé™</strong><br>
                é¦–æ¬¡å¯åŠ¨æ—¶ï¼Œæ ¹æ®æç¤ºæˆäºˆå¿…è¦çš„æƒé™</li>
            <li><strong>å¼€å§‹ä½¿ç”¨</strong><br>
                å®Œæˆè®¾ç½®åå³å¯æ­£å¸¸ä½¿ç”¨CRMåŠŸèƒ½</li>
          </ol>
          <div class="note">
            <strong>æ³¨æ„ï¼š</strong>iOSå®‰è£…ç›¸å¯¹å¤æ‚ï¼Œå»ºè®®ä¼ä¸šç”¨æˆ·ä½¿ç”¨ä¼ä¸šè¯ä¹¦åˆ†å‘
          </div>
        </div>

        <div v-if="activeTab === 'web'" class="guide-content">
          <h3>Webç‰ˆæœ¬ä½¿ç”¨è¯´æ˜</h3>
          <ol>
            <li>åœ¨æ‰‹æœºæµè§ˆå™¨ä¸­è®¿é—®SDKé¡µé¢</li>
            <li>æ”¯æŒChromeã€Safariã€Firefoxç­‰ä¸»æµæµè§ˆå™¨</li>
            <li>å¯ä»¥æ·»åŠ åˆ°ä¸»å±å¹•ï¼Œè·å¾—ç±»ä¼¼åŸç”Ÿåº”ç”¨çš„ä½“éªŒ</li>
            <li>æ”¯æŒç¦»çº¿ä½¿ç”¨ï¼Œæ— éœ€ç½‘ç»œè¿æ¥</li>
            <li>è‡ªåŠ¨æ›´æ–°ï¼Œå§‹ç»ˆä½¿ç”¨æœ€æ–°ç‰ˆæœ¬</li>
          </ol>
          <div class="note">
            <strong>ä¼˜åŠ¿ï¼š</strong>æ— éœ€ä¸‹è½½å®‰è£…ï¼Œå³å¼€å³ç”¨ï¼Œè·¨å¹³å°å…¼å®¹
          </div>
        </div>
      </div>
    </div>

    <!-- äºŒç»´ç åˆ†äº« -->
    <div class="qr-section">
      <h2>æ‰«ç è®¿é—®</h2>
      <div class="qr-container">
        <div class="qr-code">
          <div class="qr-placeholder">
            <svg viewBox="0 0 24 24" width="64" height="64">
              <path fill="currentColor" d="M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H9V11M15,11H17V13H15V11M19,5H21V9H19V5M5,5H9V9H5V5M3,19H5V21H3V19M5,19H9V21H5V19M11,19H13V21H11V19M15,19H17V21H15V19M19,19H21V21H19V19Z"/>
            </svg>
          </div>
          <p>æ‰«æäºŒç»´ç <br>åœ¨æ‰‹æœºä¸Šè®¿é—®</p>
        </div>
        <div class="qr-info">
          <h3>ç§»åŠ¨ç«¯è®¿é—®åœ°å€</h3>
          <div class="url-box">
            <code>{{ mobileSDKUrl }}</code>
            <button class="copy-btn" @click="copyUrl">å¤åˆ¶</button>
          </div>
          <p>ç”¨æˆ·å¯ä»¥é€šè¿‡æ‰«æäºŒç»´ç æˆ–ç›´æ¥è®¿é—®é“¾æ¥æ¥ä½¿ç”¨ç§»åŠ¨SDK</p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { ElMessage } from 'element-plus'

const activeTab = ref('android')
const androidSize = ref('--')
const iosSize = ref('--')
const androidUpdateTime = ref('--')
const iosUpdateTime = ref('--')
const mobileSDKUrl = ref('http://localhost:5173/mobile-sdk/')

// è·å–æ–‡ä»¶ä¿¡æ¯
const getFileInfo = async () => {
  try {
    const response = await fetch('/api/v1/mobile-sdk/info')
    const result = await response.json()
    
    if (result.success) {
      const { android, ios } = result.data
      androidSize.value = android.available ? formatFileSize(android.size) : 'æœªæ„å»º'
      iosSize.value = ios.available ? formatFileSize(ios.size) : 'å¼€å‘ä¸­'
      androidUpdateTime.value = android.updateTime || new Date().toLocaleDateString('zh-CN')
      iosUpdateTime.value = ios.updateTime || new Date().toLocaleDateString('zh-CN')
    }
  } catch (error) {
    console.error('è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥:', error)
    androidSize.value = 'è·å–å¤±è´¥'
    iosSize.value = 'è·å–å¤±è´¥'
  }
}

// æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
const formatFileSize = (bytes: number): string => {
  if (bytes === 0) return '0 B'
  const k = 1024
  const sizes = ['B', 'KB', 'MB', 'GB']
  const i = Math.floor(Math.log(bytes) / Math.log(k))
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
}

// ä¸‹è½½Android SDK
const downloadAndroidSDK = () => {
  // è°ƒç”¨åç«¯APIä¸‹è½½APKæ–‡ä»¶
  window.open('/api/v1/mobile-sdk/download/android', '_blank')
  ElMessage.success('Android SDKä¸‹è½½å·²å¼€å§‹')
}

// ä¸‹è½½iOS SDK
const downloadIOSSDK = () => {
  // è°ƒç”¨åç«¯APIä¸‹è½½IPAæ–‡ä»¶
  window.open('/api/v1/mobile-sdk/download/ios', '_blank')
  ElMessage.success('iOS SDKä¸‹è½½å·²å¼€å§‹')
}

// é¢„è§ˆAndroid SDK
const previewAndroidSDK = () => {
  window.open('/mobile-sdk/', '_blank')
}

// é¢„è§ˆiOS SDK
const previewIOSSDK = () => {
  window.open('/mobile-sdk/', '_blank')
}

// æ˜¾ç¤ºå®‰è£…æŒ‡å—
const showInstallGuide = (platform: string) => {
  activeTab.value = platform
  // æ»šåŠ¨åˆ°å®‰è£…æŒ‡å—éƒ¨åˆ†
  const guideSection = document.querySelector('.installation-guide')
  if (guideSection) {
    guideSection.scrollIntoView({ behavior: 'smooth' })
  }
}

// å¤åˆ¶URL
const copyUrl = async () => {
  try {
    await navigator.clipboard.writeText(mobileSDKUrl.value)
    ElMessage.success('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
  } catch (error) {
    ElMessage.error('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')
  }
}

onMounted(() => {
  getFileInfo()
})
</script>

<style scoped>
.mobile-sdk-container {
  padding: 24px;
  max-width: 1200px;
  margin: 0 auto;
}

.page-header {
  margin-bottom: 32px;
}

.page-header h1 {
  font-size: 28px;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 8px;
}

.page-header p {
  color: #6b7280;
  font-size: 16px;
}

.alert {
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
  text-align: left;
}

.alert-info {
  background: #e3f2fd;
  border: 1px solid #2196f3;
  color: #1565c0;
}

.alert h3 {
  margin-bottom: 12px;
  font-size: 18px;
  font-weight: 600;
}

.alert p {
  margin-bottom: 16px;
  line-height: 1.6;
}

.sdk-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 24px;
  margin-bottom: 48px;
}

.sdk-card {
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;
  transition: all 0.3s ease;
}

.sdk-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  transform: translateY(-2px);
}

.sdk-icon {
  width: 64px;
  height: 64px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 16px;
}

.sdk-icon.android {
  background: linear-gradient(135deg, #3ddc84 0%, #2e7d32 100%);
  color: white;
}

.sdk-icon.ios {
  background: linear-gradient(135deg, #007aff 0%, #0056b3 100%);
  color: white;
}

.sdk-card h3 {
  font-size: 20px;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 8px;
}

.sdk-card p {
  color: #6b7280;
  margin-bottom: 20px;
}

.sdk-info {
  margin-bottom: 24px;
}

.info-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
  padding: 8px 0;
  border-bottom: 1px solid #f3f4f6;
}

.info-item:last-child {
  border-bottom: none;
}

.label {
  color: #6b7280;
  font-weight: 500;
}

.value {
  color: #1f2937;
  font-weight: 600;
}

.sdk-actions {
  display: flex;
  gap: 12px;
}

.btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  border-radius: 8px;
  border: none;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  flex: 1;
  justify-content: center;
}

.btn-primary {
  background: #409eff;
  color: white;
}

.btn-primary:hover {
  background: #337ecc;
}

.btn-secondary {
  background: #f3f4f6;
  color: #374151;
  border: 1px solid #d1d5db;
}

.btn-secondary:hover {
  background: #e5e7eb;
}

.installation-guide {
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;
  margin-bottom: 32px;
}

.installation-guide h2 {
  font-size: 24px;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 20px;
}

.guide-tabs {
  display: flex;
  border-bottom: 1px solid #e5e7eb;
  margin-bottom: 24px;
}

.tab-btn {
  padding: 12px 24px;
  border: none;
  background: none;
  color: #6b7280;
  font-weight: 500;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all 0.3s ease;
}

.tab-btn.active {
  color: #409eff;
  border-bottom-color: #409eff;
}

.tab-btn:hover {
  color: #409eff;
}

.guide-content h3 {
  font-size: 18px;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 16px;
}

.guide-content ol {
  margin-bottom: 16px;
  padding-left: 20px;
}

.guide-content li {
  margin-bottom: 8px;
  color: #374151;
  line-height: 1.6;
}

.note {
  background: #fef3c7;
  border: 1px solid #f59e0b;
  border-radius: 8px;
  padding: 12px;
  color: #92400e;
}

.qr-section {
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;
}

.qr-section h2 {
  font-size: 24px;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 20px;
}

.qr-container {
  display: flex;
  gap: 32px;
  align-items: center;
}

.qr-code {
  text-align: center;
}

.qr-placeholder {
  width: 120px;
  height: 120px;
  background: #f3f4f6;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 12px;
  color: #9ca3af;
}

.qr-info {
  flex: 1;
}

.qr-info h3 {
  font-size: 18px;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 12px;
}

.url-box {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.url-box code {
  flex: 1;
  background: #f3f4f6;
  padding: 8px 12px;
  border-radius: 6px;
  font-family: 'Courier New', monospace;
  color: #374151;
}

.copy-btn {
  padding: 8px 16px;
  background: #409eff;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: background 0.3s ease;
}

.copy-btn:hover {
  background: #337ecc;
}

@media (max-width: 768px) {
  .sdk-grid {
    grid-template-columns: 1fr;
  }
  
  .qr-container {
    flex-direction: column;
    text-align: center;
  }
  
  .url-box {
    flex-direction: column;
  }
  
  .url-box code {
    word-break: break-all;
  }
}
</style>