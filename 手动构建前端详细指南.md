# æ‰‹åŠ¨æ„å»ºå‰ç«¯è¯¦ç»†æŒ‡å—

> é€‚ç”¨äºæœåŠ¡å™¨è‡ªåŠ¨æ„å»ºå¤±è´¥ï¼Œæˆ–éœ€è¦æ‰‹åŠ¨æ§åˆ¶æ„å»ºè¿‡ç¨‹çš„æƒ…å†µ

---

## ğŸ“‹ ä»€ä¹ˆæ—¶å€™éœ€è¦æ‰‹åŠ¨æ„å»ºï¼Ÿ

### é€‚ç”¨åœºæ™¯ï¼š
- âœ… æœåŠ¡å™¨å†…å­˜ä¸è¶³ï¼ˆ2GBä»¥ä¸‹ï¼‰
- âœ… è‡ªåŠ¨æ„å»ºè„šæœ¬å¡ä½æˆ–å¤±è´¥
- âœ… éœ€è¦æ›´ç²¾ç»†åœ°æ§åˆ¶æ„å»ºè¿‡ç¨‹
- âœ… æƒ³è¦åœ¨æœ¬åœ°ç”µè„‘æ„å»ºåä¸Šä¼ 

---

## ğŸ¯ æ–¹æ¡ˆä¸€ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ‰‹åŠ¨æ„å»º

### å‰ç½®æ¡ä»¶ï¼š
- å·²å®‰è£… Node.js 16.x+
- å·²å®‰è£…é¡¹ç›®ä¾èµ–
- å·²é…ç½® .env.production

### è¯¦ç»†æ­¥éª¤ï¼š

#### æ­¥éª¤ 1ï¼šè¿›å…¥é¡¹ç›®ç›®å½•

```bash
cd /www/wwwroot/abc789.cn
```

#### æ­¥éª¤ 2ï¼šæ£€æŸ¥ç¯å¢ƒ

```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node -v
# åº”è¯¥æ˜¾ç¤º v16.x.x æˆ–æ›´é«˜

# æ£€æŸ¥ npm ç‰ˆæœ¬
npm -v

# æ£€æŸ¥ç³»ç»Ÿå†…å­˜
free -h
```

#### æ­¥éª¤ 3ï¼šè®¾ç½®å†…å­˜é™åˆ¶ï¼ˆé‡è¦ï¼ï¼‰

```bash
# æ ¹æ®æœåŠ¡å™¨å†…å­˜è®¾ç½®
# 2GB æœåŠ¡å™¨
export NODE_OPTIONS="--max-old-space-size=1536"

# 4GB æœåŠ¡å™¨
export NODE_OPTIONS="--max-old-space-size=3072"

# 8GB+ æœåŠ¡å™¨
export NODE_OPTIONS="--max-old-space-size=4096"

# éªŒè¯è®¾ç½®
echo $NODE_OPTIONS
```

#### æ­¥éª¤ 4ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶

```bash
# æ£€æŸ¥å‰ç«¯é…ç½®
cat .env.production

# åº”è¯¥åŒ…å«ï¼š
# VITE_API_BASE_URL=/api
# VITE_APP_TITLE=CRMç®¡ç†ç³»ç»Ÿ
# NODE_ENV=production
# VITE_USE_REAL_API=true
```

å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒï¼š

```bash
cat > .env.production << 'EOF'
VITE_API_BASE_URL=/api
VITE_APP_TITLE=CRMç®¡ç†ç³»ç»Ÿ
NODE_ENV=production
VITE_USE_REAL_API=true
EOF
```

#### æ­¥éª¤ 5ï¼šæ£€æŸ¥ä¾èµ–æ˜¯å¦å·²å®‰è£…

```bash
# æ£€æŸ¥ node_modules ç›®å½•
ls -la node_modules | head -20

# å¦‚æœä¸å­˜åœ¨æˆ–ä¸å®Œæ•´ï¼Œå®‰è£…ä¾èµ–
if [ ! -d "node_modules" ]; then
    echo "å®‰è£…å‰ç«¯ä¾èµ–..."
    npm install --legacy-peer-deps
fi
```

#### æ­¥éª¤ 6ï¼šæ¸…ç†æ—§çš„æ„å»ºç¼“å­˜

```bash
# æ¸…ç† Vite ç¼“å­˜
rm -rf node_modules/.vite

# æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶
rm -rf dist

# éªŒè¯æ¸…ç†ç»“æœ
ls -la | grep -E "dist|.vite"
# åº”è¯¥æ²¡æœ‰è¾“å‡º
```

#### æ­¥éª¤ 7ï¼šå¼€å§‹æ„å»ºï¼ˆæ ‡å‡†æ–¹å¼ï¼‰

```bash
# å¼€å§‹æ„å»º
echo "å¼€å§‹æ„å»ºå‰ç«¯..."
npm run build

# æ„å»ºè¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºï¼š
# vite v4.x.x building for production...
# transforming...
# rendering chunks...
# computing gzip size...
# dist/index.html  x.xx kB
# ...
```

**é¢„è®¡æ—¶é—´**ï¼š
- 2GB æœåŠ¡å™¨ï¼š10-15 åˆ†é’Ÿ
- 4GB æœåŠ¡å™¨ï¼š5-8 åˆ†é’Ÿ
- 8GB+ æœåŠ¡å™¨ï¼š3-5 åˆ†é’Ÿ

#### æ­¥éª¤ 8ï¼šéªŒè¯æ„å»ºç»“æœ

```bash
# æ£€æŸ¥ dist ç›®å½•
ls -lh dist/

# åº”è¯¥çœ‹åˆ°ï¼š
# index.html
# assets/
# favicon.ico
# ...

# æ£€æŸ¥ index.html æ˜¯å¦å­˜åœ¨
if [ -f "dist/index.html" ]; then
    echo "âœ… æ„å»ºæˆåŠŸï¼"
    du -sh dist/
else
    echo "âŒ æ„å»ºå¤±è´¥ï¼Œdist/index.html ä¸å­˜åœ¨"
fi
```

---

## ğŸ”§ æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ç®€åŒ–æ„å»ºï¼ˆå†…å­˜ä¸è¶³æ—¶ï¼‰

å¦‚æœæ ‡å‡†æ„å»ºå¤±è´¥ï¼Œä½¿ç”¨ç®€åŒ–æ„å»ºï¼š

### æ­¥éª¤ 1-6ï¼šåŒæ–¹æ¡ˆä¸€

### æ­¥éª¤ 7ï¼šç®€åŒ–æ„å»º

```bash
# ä½¿ç”¨ç®€åŒ–æ„å»ºï¼ˆä¸å‹ç¼©ï¼‰
echo "ä½¿ç”¨ç®€åŒ–æ„å»º..."
npm run build -- --minify false

# æˆ–è€…ä½¿ç”¨ esbuild å‹ç¼©ï¼ˆæ›´å¿«ï¼‰
npm run build -- --minify esbuild
```

**ä¼˜ç‚¹**ï¼š
- æ›´å¿«
- å ç”¨å†…å­˜æ›´å°‘
- æˆåŠŸç‡æ›´é«˜

**ç¼ºç‚¹**ï¼š
- æ–‡ä»¶ä½“ç§¯ç¨å¤§
- åŠ è½½é€Ÿåº¦ç¨æ…¢

---

## ğŸ’» æ–¹æ¡ˆä¸‰ï¼šåœ¨æœ¬åœ°ç”µè„‘æ„å»ºï¼ˆæ¨èï¼‰

### é€‚ç”¨åœºæ™¯ï¼š
- æœåŠ¡å™¨å†…å­˜ä¸¥é‡ä¸è¶³
- æœåŠ¡å™¨æ„å»ºå¤šæ¬¡å¤±è´¥
- æƒ³è¦æ›´å¿«çš„æ„å»ºé€Ÿåº¦

### åœ¨æœ¬åœ°ç”µè„‘æ“ä½œï¼š

#### Windows ç”¨æˆ·ï¼š

##### æ­¥éª¤ 1ï¼šå®‰è£… Node.js

1. è®¿é—®ï¼šhttps://nodejs.org/
2. ä¸‹è½½ LTS ç‰ˆæœ¬ï¼ˆæ¨è 18.xï¼‰
3. å®‰è£…ï¼ˆä¸€è·¯ä¸‹ä¸€æ­¥ï¼‰
4. éªŒè¯å®‰è£…ï¼š
   ```cmd
   node -v
   npm -v
   ```

##### æ­¥éª¤ 2ï¼šå…‹éš†é¡¹ç›®

```cmd
# æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼ˆCMDï¼‰æˆ– PowerShell

# è¿›å…¥å·¥ä½œç›®å½•
cd D:\Projects

# å…‹éš†é¡¹ç›®
git clone https://github.com/shushuhao01/CRM.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd CRM
```

##### æ­¥éª¤ 3ï¼šå®‰è£…ä¾èµ–

```cmd
# é…ç½® npm é•œåƒï¼ˆåŠ é€Ÿï¼‰
npm config set registry https://registry.npmmirror.com

# å®‰è£…ä¾èµ–
npm install --legacy-peer-deps
```

**é¢„è®¡æ—¶é—´**ï¼š5-10 åˆ†é’Ÿ

##### æ­¥éª¤ 4ï¼šé…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env.production` æ–‡ä»¶ï¼š

```cmd
# ä½¿ç”¨è®°äº‹æœ¬åˆ›å»º
notepad .env.production
```

å†…å®¹ï¼š
```env
VITE_API_BASE_URL=/api
VITE_APP_TITLE=CRMç®¡ç†ç³»ç»Ÿ
NODE_ENV=production
VITE_USE_REAL_API=true
```

ä¿å­˜å¹¶å…³é—­ã€‚

##### æ­¥éª¤ 5ï¼šæ„å»º

```cmd
# æ„å»ºå‰ç«¯
npm run build
```

**é¢„è®¡æ—¶é—´**ï¼š2-5 åˆ†é’Ÿ

##### æ­¥éª¤ 6ï¼šæ‰“åŒ… dist æ–‡ä»¶å¤¹

**æ–¹æ³• Aï¼šä½¿ç”¨ Windows è‡ªå¸¦å‹ç¼©**
1. å³é”® `dist` æ–‡ä»¶å¤¹
2. é€‰æ‹© "å‘é€åˆ°" â†’ "å‹ç¼©(zipped)æ–‡ä»¶å¤¹"
3. å¾—åˆ° `dist.zip`

**æ–¹æ³• Bï¼šä½¿ç”¨ 7-Zip**
1. å³é”® `dist` æ–‡ä»¶å¤¹
2. é€‰æ‹© "7-Zip" â†’ "æ·»åŠ åˆ°å‹ç¼©åŒ…"
3. æ ¼å¼é€‰æ‹© "zip"
4. ç‚¹å‡» "ç¡®å®š"

##### æ­¥éª¤ 7ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨

**ä½¿ç”¨å®å¡”é¢æ¿ä¸Šä¼ ï¼š**
1. ç™»å½•å®å¡”é¢æ¿
2. ç‚¹å‡»å·¦ä¾§ "æ–‡ä»¶"
3. è¿›å…¥ `/www/wwwroot/abc789.cn`
4. ç‚¹å‡» "ä¸Šä¼ " æŒ‰é’®
5. é€‰æ‹© `dist.zip`
6. ç­‰å¾…ä¸Šä¼ å®Œæˆ

**é¢„è®¡æ—¶é—´**ï¼šæ ¹æ®ç½‘é€Ÿï¼Œ1-5 åˆ†é’Ÿ

##### æ­¥éª¤ 8ï¼šåœ¨æœåŠ¡å™¨ä¸Šè§£å‹

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/abc789.cn

# å¤‡ä»½æ—§çš„ distï¼ˆå¦‚æœå­˜åœ¨ï¼‰
if [ -d "dist" ]; then
    mv dist dist.backup.$(date +%Y%m%d_%H%M%S)
fi

# è§£å‹æ–°çš„ dist
unzip -q dist.zip

# éªŒè¯
ls -lh dist/

# åˆ é™¤å‹ç¼©åŒ…
rm dist.zip
```

#### Mac/Linux ç”¨æˆ·ï¼š

##### æ­¥éª¤ 1-5ï¼šåŒ Windows

##### æ­¥éª¤ 6ï¼šæ‰“åŒ…

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd ~/Projects/CRM

# æ‰“åŒ… dist æ–‡ä»¶å¤¹
cd dist
zip -r ../dist.zip .
cd ..

# æˆ–ä½¿ç”¨ tar
tar -czf dist.tar.gz dist/
```

##### æ­¥éª¤ 7ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨

**æ–¹æ³• Aï¼šä½¿ç”¨ scp**
```bash
scp dist.zip root@æ‚¨çš„æœåŠ¡å™¨IP:/www/wwwroot/abc789.cn/
```

**æ–¹æ³• Bï¼šä½¿ç”¨å®å¡”é¢æ¿**ï¼ˆåŒ Windowsï¼‰

##### æ­¥éª¤ 8ï¼šè§£å‹ï¼ˆåŒ Windowsï¼‰

---

## ğŸ” æ„å»ºè¿‡ç¨‹ç›‘æ§

### æŸ¥çœ‹æ„å»ºè¿›åº¦

åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£æ‰§è¡Œï¼š

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
watch -n 2 free -h

# æŸ¥çœ‹ Node.js è¿›ç¨‹
watch -n 2 "ps aux | grep node"

# æŸ¥çœ‹æ„å»ºæ–‡ä»¶å¤§å°
watch -n 5 "du -sh dist/ 2>/dev/null || echo 'æ„å»ºä¸­...'"
```

---

## âš ï¸ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šæ„å»ºå¡ä½ä¸åŠ¨

**ç°è±¡**ï¼š
```
transforming (292) node_modules/...
```
é•¿æ—¶é—´åœåœ¨æŸä¸ªæ–‡ä»¶

**è§£å†³æ–¹æ¡ˆ Aï¼šå¢åŠ  Swap è™šæ‹Ÿå†…å­˜**
```bash
# åˆ›å»º 2GB Swap
sudo dd if=/dev/zero of=/swapfile bs=1M count=2048
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# éªŒè¯
free -h

# é‡æ–°æ„å»º
npm run build
```

**è§£å†³æ–¹æ¡ˆ Bï¼šä½¿ç”¨ç®€åŒ–æ„å»º**
```bash
npm run build -- --minify false
```

**è§£å†³æ–¹æ¡ˆ Cï¼šä¸´æ—¶åœæ­¢å…¶ä»–æœåŠ¡**
```bash
# åœæ­¢ MySQLï¼ˆé‡Šæ”¾å†…å­˜ï¼‰
systemctl stop mysql

# æ„å»º
npm run build

# æ„å»ºå®Œæˆåé‡å¯ MySQL
systemctl start mysql
```

### é—®é¢˜ 2ï¼šå†…å­˜æº¢å‡º

**é”™è¯¯ä¿¡æ¯**ï¼š
```
FATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å¢åŠ å†…å­˜é™åˆ¶
export NODE_OPTIONS="--max-old-space-size=2048"

# é‡æ–°æ„å»º
npm run build
```

### é—®é¢˜ 3ï¼šä¾èµ–é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: Cannot find module 'xxx'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£…
rm -rf node_modules package-lock.json
npm install --legacy-peer-deps

# é‡æ–°æ„å»º
npm run build
```

### é—®é¢˜ 4ï¼šæ„å»ºå¤±è´¥ä½†æ²¡æœ‰æ˜ç¡®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
npm run build --verbose

# æˆ–ä½¿ç”¨ debug æ¨¡å¼
DEBUG=vite:* npm run build
```

### é—®é¢˜ 5ï¼šæ„å»ºæ–‡ä»¶ä¸å®Œæ•´

**éªŒè¯æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥å¿…è¦æ–‡ä»¶
ls -la dist/index.html
ls -la dist/assets/

# æ£€æŸ¥æ–‡ä»¶å¤§å°
du -sh dist/
# åº”è¯¥è‡³å°‘æœ‰å‡ MB
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†åé‡æ–°æ„å»º
rm -rf dist node_modules/.vite
npm run build
```

---

## ğŸ“Š æ„å»ºæ€§èƒ½å¯¹æ¯”

| æ„å»ºæ–¹å¼ | æ—¶é—´ | å†…å­˜å ç”¨ | æˆåŠŸç‡ | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|--------|---------|
| æœåŠ¡å™¨æ ‡å‡†æ„å»º | 10-15åˆ†é’Ÿ | 1.5-2GB | ä¸­ç­‰ | 4GB+ æœåŠ¡å™¨ |
| æœåŠ¡å™¨ç®€åŒ–æ„å»º | 8-12åˆ†é’Ÿ | 1-1.5GB | é«˜ | 2GB+ æœåŠ¡å™¨ |
| æœ¬åœ°æ„å»º | 2-5åˆ†é’Ÿ | ä¸é™ | å¾ˆé«˜ | ä»»ä½•æœåŠ¡å™¨ âœ… |

---

## âœ… æ„å»ºå®Œæˆåçš„æ“ä½œ

### 1. éªŒè¯æ„å»ºæ–‡ä»¶

```bash
cd /www/wwwroot/abc789.cn

# æ£€æŸ¥æ–‡ä»¶ç»“æ„
tree -L 2 dist/

# æˆ–
ls -lh dist/
ls -lh dist/assets/
```

### 2. é…ç½® Nginxï¼ˆå¦‚æœè¿˜æ²¡é…ç½®ï¼‰

åœ¨å®å¡”é¢æ¿ï¼š
1. ç½‘ç«™ â†’ æ·»åŠ ç«™ç‚¹
2. æ ¹ç›®å½•ï¼š`/www/wwwroot/abc789.cn/dist`
3. PHPç‰ˆæœ¬ï¼šçº¯é™æ€

### 3. æµ‹è¯•è®¿é—®

åœ¨æµè§ˆå™¨è®¿é—®ï¼š`http://æ‚¨çš„IPæˆ–åŸŸå`

åº”è¯¥èƒ½çœ‹åˆ°ç™»å½•é¡µé¢ã€‚

### 4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

æŒ‰ `Ctrl + Shift + Delete` æˆ– `Ctrl + F5` å¼ºåˆ¶åˆ·æ–°

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### æ ¹æ®æœåŠ¡å™¨é…ç½®é€‰æ‹©ï¼š

| æœåŠ¡å™¨å†…å­˜ | æ¨èæ–¹æ¡ˆ | åŸå›  |
|-----------|---------|------|
| < 2GB | æœ¬åœ°æ„å»º | æœåŠ¡å™¨å†…å­˜ä¸è¶³ |
| 2GB | ç®€åŒ–æ„å»º æˆ– æœ¬åœ°æ„å»º | æ ‡å‡†æ„å»ºå¯èƒ½å¤±è´¥ |
| 4GB | æ ‡å‡†æ„å»º | é€šå¸¸èƒ½æˆåŠŸ |
| 8GB+ | æ ‡å‡†æ„å»º | å®Œå…¨æ²¡é—®é¢˜ |

### æˆ‘çš„å»ºè®®ï¼š

1. **é¦–æ¬¡éƒ¨ç½²**ï¼šä½¿ç”¨æœ¬åœ°æ„å»ºï¼ˆæœ€ç¨³å¦¥ï¼‰
2. **æ—¥å¸¸æ›´æ–°**ï¼š
   - ä»£ç æ”¹åŠ¨å°ï¼šæœåŠ¡å™¨æ„å»º
   - ä»£ç æ”¹åŠ¨å¤§ï¼šæœ¬åœ°æ„å»º

---

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### æœåŠ¡å™¨æ ‡å‡†æ„å»º
```bash
cd /www/wwwroot/abc789.cn
export NODE_OPTIONS="--max-old-space-size=1536"
rm -rf node_modules/.vite dist
npm run build
```

### æœåŠ¡å™¨ç®€åŒ–æ„å»º
```bash
cd /www/wwwroot/abc789.cn
export NODE_OPTIONS="--max-old-space-size=1536"
rm -rf node_modules/.vite dist
npm run build -- --minify false
```

### æœ¬åœ°æ„å»ºï¼ˆWindowsï¼‰
```cmd
cd D:\Projects\CRM
npm install --legacy-peer-deps
npm run build
```

### ä¸Šä¼ å¹¶è§£å‹
```bash
cd /www/wwwroot/abc789.cn
unzip -q dist.zip
ls -lh dist/
```

---

## ğŸ’¡ å°è´´å£«

1. **æ„å»ºå‰æ£€æŸ¥ç£ç›˜ç©ºé—´**
   ```bash
   df -h /www/wwwroot
   # è‡³å°‘éœ€è¦ 2GB å¯ç”¨ç©ºé—´
   ```

2. **æ„å»ºæ—¶ç›‘æ§å†…å­˜**
   ```bash
   watch -n 2 free -h
   ```

3. **ä¿å­˜æ„å»ºæ—¥å¿—**
   ```bash
   npm run build 2>&1 | tee build.log
   ```

4. **å®šæœŸæ¸…ç†ç¼“å­˜**
   ```bash
   rm -rf node_modules/.vite
   npm cache clean --force
   ```

---

**ç‰ˆæœ¬**ï¼šv1.0  
**æ›´æ–°æ—¥æœŸ**ï¼š2024-11-23  
**é€‚ç”¨äº**ï¼šCRM ç³»ç»Ÿ v1.8.3+
