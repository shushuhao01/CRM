# 角色权限配置说明

## 概述

本系统采用基于角色的访问控制（RBAC），通过角色来管理用户权限。系统内置5种角色，每种角色拥有不同的权限范围。

## 角色体系

### 1. 超级管理员（super_admin）
**权限范围**：所有权限（`*`）

**职责**：
- 系统最高权限管理者
- 管理所有用户和角色
- 配置系统设置
- 查看和管理所有数据

---

### 2. 管理员（admin）
**权限范围**：所有权限（`*`）

**职责**：
- 与超级管理员权限相同
- 日常系统管理工作
- 用户和数据管理

---

### 3. 部门经理（department_manager）

#### 一级菜单权限

| 一级菜单 | 权限代码 | 是否有权限 |
|---------|---------|:---:|
| 数据看板 | dashboard | ✅ |
| 客户管理 | customer | ✅ |
| 订单管理 | order | ✅ |
| 服务管理 | service | ✅ |
| 业绩统计 | performance | ✅ |
| 物流管理 | logistics | ✅ |
| 售后管理 | aftersale | ✅ |
| 资料管理 | data | ✅ |
| 商品管理 | product | ❌ |
| 系统管理 | system | ❌ |

#### 二级菜单权限

| 一级菜单 | 二级菜单 | 权限代码 | 是否有权限 |
|---------|---------|---------|:---:|
| 数据看板 | 数据看板 | dashboard | ✅ |
| 客户管理 | 客户列表 | customer:list | ✅ |
| 客户管理 | 新增客户 | customer:add | ✅ |
| 客户管理 | 客户分组 | customer:groups | ❌ |
| 客户管理 | 客户标签 | customer:tags | ❌ |
| 订单管理 | 订单列表 | order:list | ✅ |
| 订单管理 | 新增订单 | order:add | ✅ |
| 订单管理 | 订单审核 | order:audit | ❌ |
| 服务管理 | 通话管理 | service:call | ✅ |
| 服务管理 | 短信管理 | service:sms | ❌ |
| 业绩统计 | 个人业绩 | performance:personal | ✅ |
| 业绩统计 | 团队业绩 | performance:team | ✅ |
| 业绩统计 | 业绩分析 | performance:analysis | ✅ |
| 业绩统计 | 业绩分享 | performance:share | ✅ |
| 物流管理 | 物流列表 | logistics:list | ✅ |
| 物流管理 | 物流跟踪 | logistics:tracking | ✅ |
| 物流管理 | 发货列表 | logistics:shipping | ❌ |
| 物流管理 | 状态更新 | logistics:status | ❌ |
| 售后管理 | 售后列表 | aftersale:order | ✅ |
| 售后管理 | 新建售后 | aftersale:add | ✅ |
| 售后管理 | 售后数据 | aftersale:analysis | ✅ |
| 资料管理 | 资料列表 | data:list | ❌ |
| 资料管理 | 客户查询 | data:customer | ✅ |
| 资料管理 | 回收站 | data:recycle | ❌ |

#### 功能按钮权限

| 功能模块 | 按钮功能 | 权限代码 | 是否有权限 |
|---------|---------|---------|:---:|
| 客户管理 | 查看客户 | customer:view:department | ✅ |
| 客户管理 | 编辑客户 | customer:edit | ✅ |
| 客户管理 | 导入客户 | customer:import | ✅ |
| 客户管理 | 导出客户 | customer:export | ✅ |
| 订单管理 | 查看订单 | order:view:department | ✅ |
| 订单管理 | 编辑订单 | order:edit | ✅ |
| 物流管理 | 查看物流 | logistics:view | ✅ |
| 物流管理 | 添加物流 | logistics:add | ✅ |
| 物流管理 | 编辑物流 | logistics:edit | ✅ |
| 售后管理 | 查看售后 | aftersale:view:department | ✅ |
| 售后管理 | 编辑售后 | aftersale:edit | ✅ |

**数据权限**：查看本部门所有数据

---

### 4. 销售员（sales_staff）

#### 一级菜单权限

| 一级菜单 | 权限代码 | 是否有权限 |
|---------|---------|:---:|
| 数据看板 | dashboard | ✅ |
| 客户管理 | customer | ✅ |
| 订单管理 | order | ✅ |
| 服务管理 | service | ✅ |
| 业绩统计 | performance | ✅ |
| 物流管理 | logistics | ✅ |
| 售后管理 | aftersale | ✅ |
| 资料管理 | data | ✅ |
| 商品管理 | product | ❌ |
| 系统管理 | system | ❌ |

#### 二级菜单权限

| 一级菜单 | 二级菜单 | 权限代码 | 是否有权限 |
|---------|---------|---------|:---:|
| 数据看板 | 数据看板 | dashboard | ✅ |
| 客户管理 | 客户列表 | customer:list | ✅ |
| 客户管理 | 新增客户 | customer:add | ✅ |
| 客户管理 | 客户分组 | customer:groups | ❌ |
| 客户管理 | 客户标签 | customer:tags | ❌ |
| 订单管理 | 订单列表 | order:list | ✅ |
| 订单管理 | 新增订单 | order:add | ✅ |
| 订单管理 | 订单审核 | order:audit | ❌ |
| 服务管理 | 通话管理 | service:call | ✅ |
| 服务管理 | 短信管理 | service:sms | ❌ |
| 业绩统计 | 个人业绩 | performance:personal | ✅ |
| 业绩统计 | 团队业绩 | performance:team | ✅ |
| 业绩统计 | 业绩分析 | performance:analysis | ❌ |
| 业绩统计 | 业绩分享 | performance:share | ❌ |
| 物流管理 | 物流列表 | logistics:list | ✅ |
| 物流管理 | 物流跟踪 | logistics:tracking | ✅ |
| 物流管理 | 发货列表 | logistics:shipping | ❌ |
| 物流管理 | 状态更新 | logistics:status | ❌ |
| 售后管理 | 售后列表 | aftersale:order | ✅ |
| 售后管理 | 新建售后 | aftersale:add | ✅ |
| 售后管理 | 售后数据 | aftersale:analysis | ❌ |
| 资料管理 | 资料列表 | data:list | ❌ |
| 资料管理 | 客户查询 | data:customer | ✅ |
| 资料管理 | 回收站 | data:recycle | ❌ |

#### 功能按钮权限

| 功能模块 | 按钮功能 | 权限代码 | 是否有权限 |
|---------|---------|---------|:---:|
| 客户管理 | 查看客户 | customer:view:personal | ✅ |
| 客户管理 | 编辑客户 | customer:edit | ❌ |
| 客户管理 | 导入客户 | customer:import | ❌ |
| 客户管理 | 导出客户 | customer:export | ❌ |
| 订单管理 | 查看订单 | order:view:personal | ✅ |
| 订单管理 | 编辑订单 | order:edit | ✅ |
| 物流管理 | 查看物流 | logistics:view | ✅ |
| 通话管理 | 查看通话 | service:call:view | ✅ |
| 通话管理 | 新增通话 | service:call:add | ✅ |
| 通话管理 | 编辑通话 | service:call:edit | ✅ |
| 售后管理 | 查看售后 | aftersale:view:personal | ✅ |

**数据权限**：仅查看自己的数据

---

### 5. 客服（customer_service）

#### 一级菜单权限

| 一级菜单 | 权限代码 | 是否有权限 |
|---------|---------|:---:|
| 数据看板 | dashboard | ✅ |
| 客户管理 | customer | ❌ |
| 订单管理 | order | ✅ |
| 服务管理 | service | ❌ |
| 业绩统计 | performance | ❌ |
| 物流管理 | logistics | ✅ |
| 售后管理 | aftersale | ✅ |
| 资料管理 | data | ✅ |
| 商品管理 | product | ❌ |
| 系统管理 | system | ❌ |

#### 二级菜单权限

| 一级菜单 | 二级菜单 | 权限代码 | 是否有权限 |
|---------|---------|---------|:---:|
| 数据看板 | 数据看板 | dashboard | ✅ |
| 订单管理 | 订单列表 | order:list | ❌ |
| 订单管理 | 新增订单 | order:add | ❌ |
| 订单管理 | 订单审核 | order:audit | ✅ |
| 物流管理 | 物流列表 | logistics:list | ✅ |
| 物流管理 | 物流跟踪 | logistics:tracking | ✅ |
| 物流管理 | 发货列表 | logistics:shipping | ✅ |
| 物流管理 | 状态更新 | logistics:status | ✅ |
| 售后管理 | 售后列表 | aftersale:order | ✅ |
| 售后管理 | 新建售后 | aftersale:add | ✅ |
| 售后管理 | 售后数据 | aftersale:analysis | ✅ |
| 资料管理 | 资料列表 | data:list | ✅ |
| 资料管理 | 客户查询 | data:customer | ✅ |
| 资料管理 | 回收站 | data:recycle | ❌ |

#### 功能按钮权限

| 功能模块 | 按钮功能 | 权限代码 | 是否有权限 |
|---------|---------|---------|:---:|
| 订单管理 | 审核订单 | order:audit:view | ✅ |
| 物流管理 | 查看物流 | logistics:list:view | ✅ |
| 物流管理 | 发货操作 | logistics:shipping:view | ✅ |
| 物流管理 | 状态更新 | logistics:status_update | ✅ |
| 售后管理 | 查看售后 | aftersale:order:view | ✅ |

**数据权限**：查看全公司订单、物流、售后数据

---

## 权限配置文件

### 源代码配置位置
`src/config/defaultRolePermissions.ts`

### 动态调整
超级管理员/管理员可以在"系统管理 → 角色权限"中动态调整权限：
1. 选择要配置的角色
2. 点击"权限设置"按钮
3. 在权限树中勾选或取消权限
4. 点击"保存权限"
5. 用户刷新页面后权限立即生效

**注意**：动态配置的权限会保存到 `localStorage` 的 `crm_roles` 中，优先级高于默认配置。

---

## 权限代码清单

### 数据看板
```
dashboard                    # 数据看板模块
dashboard:personal          # 个人数据
dashboard:department        # 部门数据
```

### 客户管理
```
customer                    # 客户管理模块
customer:list              # 客户列表
customer:view:personal     # 查看个人客户
customer:view:department   # 查看部门客户
customer:add               # 新增客户
customer:edit              # 编辑客户
customer:import            # 导入客户
customer:export            # 导出客户
customer:groups            # 客户分组
customer:tags              # 客户标签
```

### 订单管理
```
order                      # 订单管理模块
order:list                # 订单列表
order:view:personal       # 查看个人订单
order:view:department     # 查看部门订单
order:add                 # 新增订单
order:edit                # 编辑订单
order:audit               # 订单审核
order:audit:view          # 查看审核
```

### 服务管理
```
service                   # 服务管理模块
service:call             # 通话管理
service:call:view        # 查看通话记录
service:call:add         # 新增通话
service:call:edit        # 编辑通话
service:sms              # 短信管理
```

### 业绩统计
```
performance                # 业绩统计模块
performance:personal       # 个人业绩
performance:personal:view  # 查看个人业绩
performance:team          # 团队业绩
performance:team:view     # 查看团队业绩
performance:analysis      # 业绩分析
performance:share         # 业绩分享
```

### 物流管理
```
logistics                  # 物流管理模块
logistics:list            # 物流列表
logistics:list:view       # 查看物流列表
logistics:view            # 查看物流
logistics:add             # 添加物流
logistics:edit            # 编辑物流
logistics:tracking        # 物流跟踪
logistics:tracking:view   # 查看物流跟踪
logistics:shipping        # 发货列表（客服专用）
logistics:shipping:view   # 查看发货列表
logistics:status          # 状态更新（客服专用）
logistics:status_update   # 更新状态
```

### 售后管理
```
aftersale                 # 售后管理模块
aftersale:order          # 售后列表
aftersale:order:view     # 查看售后列表
aftersale:view:personal  # 查看个人售后
aftersale:view:department # 查看部门售后
aftersale:add            # 新增售后
aftersale:edit           # 编辑售后
aftersale:analysis       # 售后数据
```

### 资料管理
```
data                      # 资料管理模块
data:list                # 资料列表
data:customer            # 客户查询
data:customer:search     # 客户搜索
data:recycle             # 回收站
```

### 系统管理
```
system                    # 系统管理模块（仅管理员）
system:user              # 用户管理
system:role              # 角色管理
system:department        # 部门管理
system:settings          # 系统设置
```

---

## 权限生效机制

1. **默认权限**：系统启动时从 `src/config/defaultRolePermissions.ts` 加载
2. **动态权限**：管理员在"角色权限"页面配置后保存到 `localStorage` 的 `crm_roles`
3. **优先级**：动态配置 > 默认配置
4. **生效时机**：用户刷新页面或重新登录后立即生效

---

## 更新日志

- 2024-12-03：修复销售员多余权限（客户分组、客户标签、发货列表、状态更新、售后数据、回收站、短信管理）
- 2024-12-03：修复客服缺少数据看板权限
- 2024-12-03：修复经理多余资料列表权限
- 2024-12-03：实现动态权限配置功能，管理员可在角色权限页面调整权限
