# 角色权限配置说明

## 概述

本系统采用基于角色的访问控制（RBAC），通过角色来管理用户权限。系统内置5种角色，每种角色拥有不同的权限范围。

## 角色体系

### 1. 超级管理员（super_admin）
**权限范围**：所有权限（`*`）

**职责**：
- 系统最高权限管理者
- 管理所有用户和角色
- 配置系统设置
- 查看和管理所有数据

**典型使用场景**：
- 系统初始化和配置
- 用户和权限管理
- 系统维护和升级

---

### 2. 管理员（admin）
**权限范围**：所有权限（`*`）

**职责**：
- 与超级管理员权限相同
- 日常系统管理工作
- 用户和数据管理

**典型使用场景**：
- 日常管理工作
- 用户支持和问题处理
- 数据审核和管理

---

### 3. 部门经理（department_manager）
**权限范围**：部门业务管理

**核心权限**：
- ✅ 数据看板（查看、导出）
- ✅ 客户管理（查看、新增、编辑、导入导出）
- ✅ 订单管理（查看、新增）
- ✅ 业绩统计（个人业绩、团队业绩）
- ✅ 物流管理（查看、跟踪）
- ✅ 售后管理（查看、新增）
- ✅ 资料管理（查看、搜索）
- ✅ 通话管理（查看、拨打）

**数据权限**：
- 查看本部门所有数据
- 查看下属员工数据
- 导出部门数据

**典型使用场景**：
- 管理部门销售团队
- 监控部门业绩
- 审核和指导下属工作

---

### 4. 销售员（sales_staff）
**权限范围**：销售业务操作

**核心权限**：
- ✅ 数据看板（查看）
- ✅ 客户管理（查看、新增）
- ✅ 订单管理（查看、新增）
- ✅ 业绩统计（个人业绩、团队业绩）
- ✅ 物流管理（查看、跟踪）
- ✅ 售后管理（查看、新增）
- ✅ 资料管理（查看、搜索）
- ✅ 通话管理（查看、拨打）

**数据权限**：
- 查看自己的客户和订单
- 查看团队业绩（只读）
- 不能导入导出数据

**典型使用场景**：
- 客户开发和维护
- 订单录入和跟进
- 查看个人业绩

---

### 5. 客服（customer_service）
**权限范围**：订单处理和售后服务

**核心权限**：
- ✅ 数据看板（查看）
- ✅ 订单管理（查看、审核）
- ✅ 物流管理（完整权限）⭐
  - 查看物流列表
  - 物流跟踪
  - 发货列表
  - **状态更新**（关键权限）
- ✅ 售后管理（完整权限）⭐
  - 查看售后列表
  - **新建售后**（关键权限）
  - **售后数据**（关键权限）
- ✅ 资料管理（查看、搜索）

**数据权限**：
- 查看全公司订单数据
- 处理所有物流和售后
- 不能查看客户管理
- 不能查看业绩统计

**典型使用场景**：
- 订单审核和处理
- 物流状态更新
- 售后问题处理
- 客户咨询响应

---

## 权限代码清单

### 数据看板
```
dashboard                    # 数据看板模块
dashboard.view              # 查看数据看板
dashboard.export            # 导出数据
```

### 客户管理
```
customer                    # 客户管理模块
customer.list              # 客户列表
customer.list.view         # 查看客户列表
customer.list.export       # 导出客户
customer.list.import       # 导入客户
customer.list.edit         # 编辑客户
customer.add               # 新增客户
customer.add.create        # 创建客户
```

### 订单管理
```
order                      # 订单管理模块
order.list                # 订单列表
order.list.view           # 查看订单列表
order.add                 # 新增订单
order.add.create          # 创建订单
order.audit               # 订单审核
order.audit.view          # 查看审核
```

### 业绩统计
```
performance                # 业绩统计模块
performance.personal       # 个人业绩
performance.personal.view  # 查看个人业绩
performance.team          # 团队业绩
performance.team.view     # 查看团队业绩
```

### 物流管理
```
logistics                  # 物流管理模块
logistics.list            # 物流列表
logistics.list.view       # 查看物流列表
logistics.track           # 物流跟踪
logistics.track.view      # 查看物流跟踪
logistics.shipping        # 发货列表（客服专用）
logistics.shipping.view   # 查看发货列表
logistics.status          # 状态更新（客服专用）⭐
logistics.status.update   # 更新状态
```

### 售后管理
```
aftersale                 # 售后管理模块
aftersale.list           # 售后列表
aftersale.list.view      # 查看售后列表
aftersale.add            # 新增售后（客服专用）⭐
aftersale.add.create     # 创建售后
aftersale.data           # 售后数据（客服专用）⭐
aftersale.data.view      # 查看售后数据
```

### 资料管理
```
data                      # 资料管理模块
data.list                # 资料列表
data.list.view           # 查看资料列表
data.search              # 资料搜索
data.search.basic        # 基础搜索
```

### 通话管理
```
service                   # 服务管理模块
service.call             # 通话管理
service.call.view        # 查看通话记录
service.call.make        # 拨打电话
```

### 系统管理
```
system                    # 系统管理模块（仅管理员）
system.user              # 用户管理
system.role              # 角色管理
system.department        # 部门管理
system.settings          # 系统设置
```

---

## 权限配置文件

### 源代码配置
权限配置写在源代码中：`src/config/defaultRolePermissions.ts`

```typescript
export const DEFAULT_ROLE_PERMISSIONS: Record<string, RolePermissionConfig> = {
  super_admin: {
    roleId: 'super_admin',
    roleName: '超级管理员',
    permissions: ['*'], // 所有权限
  },
  // ... 其他角色配置
}
```

### 动态调整
超级管理员可以在"系统管理 → 角色权限"中动态调整权限：
1. 选择要配置的角色
2. 勾选或取消权限树中的权限
3. 点击"保存"
4. 用户刷新页面后权限立即生效

---

## 权限检查机制

### 前端权限检查
```typescript
// 检查是否有某个权限
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()
const hasPermission = userStore.hasPermission('customer.add')

// 检查是否有任一权限
const hasAnyPermission = userStore.hasAnyPermission([
  'customer.add',
  'customer.edit'
])
```

### 路由守卫
系统自动检查路由权限，无权限的页面会自动跳转到403页面。

### 按钮级权限
使用 `v-permission` 指令控制按钮显示：
```vue
<el-button v-permission="'customer.add'">新增客户</el-button>
```

---

## 数据权限规则

### 超级管理员 / 管理员
- 查看所有数据
- 管理所有数据

### 部门经理
- 查看本部门数据
- 查看下属员工数据
- 管理部门数据

### 销售员
- 查看自己创建的数据
- 查看分配给自己的数据
- 查看团队业绩（只读）

### 客服
- 查看全公司订单数据
- 处理所有物流和售后
- 不能查看客户详细信息
- 不能查看业绩数据

---

## 权限修改流程

### 1. 修改角色默认权限
编辑 `src/config/defaultRolePermissions.ts` 文件，修改对应角色的 `permissions` 数组。

### 2. 动态调整权限
1. 以超级管理员身份登录
2. 进入"系统管理 → 角色权限"
3. 选择要修改的角色
4. 勾选或取消权限
5. 点击"保存"

### 3. 权限生效
- 用户刷新页面后立即生效
- 无需重启系统
- 所有设备同步生效

---

## 最佳实践

### 1. 最小权限原则
只授予用户完成工作所需的最小权限。

### 2. 角色分离
- 销售和客服职责分离
- 避免一人多角色
- 定期审查权限

### 3. 权限审计
- 定期检查用户权限
- 及时回收离职员工权限
- 记录权限变更日志

### 4. 测试验证
修改权限后，使用对应角色账号测试验证功能是否正常。

---

## 常见问题

### Q: 如何给某个用户特殊权限？
A: 可以为该用户创建一个新角色，或者修改现有角色的权限。

### Q: 权限修改后为什么不生效？
A: 请刷新页面，权限是实时生效的。

### Q: 客服为什么看不到客户管理？
A: 这是设计如此，客服专注于订单处理和售后服务，不需要查看客户详细信息。

### Q: 如何让销售员也能导出数据？
A: 在角色权限配置中，给销售员角色添加 `customer.list.export` 权限。

### Q: 权限代码在哪里定义？
A: 权限代码在 `src/config/defaultRolePermissions.ts` 中定义，菜单和按钮通过这些代码进行权限控制。
