# 🎯 宝塔面板界面操作指南

## 📋 第一步：添加网站（前端）

### 选择项目类型
- ✅ **选择：PHP项目**（不是Node.js项目）
- 原因：前端是静态文件，需要Web服务器提供服务

### 填写配置信息
```
项目名称: crm-system
项目目录: /www/wwwroot/crm
启动文件: index.html
Node.js版本: v16.20.2
启动方式: pm2
运行用户: www
项目端口: (留空)
项目域名: 您的域名或IP
备注: CRM系统前端静态文件
```

### 重要设置
1. **根目录**：必须指向 `/www/wwwroot/crm/dist`
2. **PHP版本**：选择"纯静态"
3. **SSL**：如有域名可配置SSL证书

---

## 📋 第二步：配置Node.js项目（后端API）

### 进入Node.js项目管理器
1. 点击左侧菜单 "软件商店"
2. 找到 "Node.js版本管理器"
3. 点击 "设置" → "项目管理"

### 添加Node.js项目
```
项目名称: crm-backend
项目路径: /www/wwwroot/crm/backend
启动文件: dist/app.js
运行端口: 3000
项目描述: CRM系统后端API服务
```

### 环境变量配置
在项目设置中添加：
```
NODE_ENV=production
DB_HOST=localhost
DB_PORT=3306
DB_NAME=abc789_cn
DB_USERNAME=abc789_cn
DB_PASSWORD=pM8rpkQ22CS3
```

---

## 📋 第三步：配置反向代理

### 在网站设置中配置
1. 进入网站管理 → 找到您的CRM网站
2. 点击 "设置" → "反向代理"
3. 添加反向代理规则：

```
代理名称: api
目标URL: http://127.0.0.1:3000
发送域名: $host
代理目录: /api/
高级设置:
  - 开启缓存: 否
  - 开启WebSocket: 是
```

### Nginx配置示例
```nginx
location /api/ {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
}

location /uploads/ {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
```

---

## 📋 第四步：数据库配置

### 在phpMyAdmin中执行
1. 登录宝塔面板 → 数据库 → phpMyAdmin
2. 选择数据库：`abc789_cn`
3. 点击 "SQL" 标签
4. 复制粘贴以下文件内容：`/www/wwwroot/crm/backend/database-schema.sql`
5. 点击 "执行"

### 验证数据库
执行后应该看到11个表被创建：
- users (用户表)
- roles (角色表)
- permissions (权限表)
- customers (客户表)
- orders (订单表)
- products (产品表)
- departments (部门表)
- 等等...

---

## 📋 第五步：启动服务

### 启动Node.js后端
1. 进入Node.js项目管理器
2. 找到 "crm-backend" 项目
3. 点击 "启动"
4. 查看状态确保运行正常

### 检查服务状态
在宝塔终端中执行：
```bash
# 检查端口监听
netstat -tlnp | grep 3000

# 检查进程
ps aux | grep node

# 查看日志
pm2 logs crm-backend
```

---

## 📋 第六步：测试访问

### 前端访问测试
1. 浏览器访问：`http://您的域名`
2. 应该看到CRM登录页面
3. 检查页面是否正常加载

### API接口测试
1. 访问：`http://您的域名/api/health`
2. 应该返回JSON格式的健康检查信息

### 登录功能测试
使用默认账户登录：
- 用户名：`admin`
- 密码：`admin123`

---

## 🔧 常见问题解决

### 问题1：网站显示404
**解决方案**：
1. 检查网站根目录是否指向 `/www/wwwroot/crm/dist`
2. 确认 `index.html` 文件存在
3. 检查文件权限：`chmod -R 755 /www/wwwroot/crm`

### 问题2：API请求失败
**解决方案**：
1. 检查Node.js服务是否启动
2. 检查端口3000是否被监听
3. 检查反向代理配置是否正确

### 问题3：数据库连接失败
**解决方案**：
1. 检查数据库配置信息
2. 确认数据库用户权限
3. 检查 `.env` 文件配置

### 问题4：静态文件加载失败
**解决方案**：
1. 检查Nginx配置
2. 清除浏览器缓存
3. 检查文件路径是否正确

---

## 📊 部署验证清单

- [ ] 网站配置完成，根目录指向 `/www/wwwroot/crm/dist`
- [ ] Node.js项目配置完成，端口3000
- [ ] 反向代理配置正确，`/api/` 指向后端
- [ ] 数据库脚本执行成功，创建11个表
- [ ] 前端页面可以正常访问
- [ ] API接口可以正常调用
- [ ] 管理员账户可以正常登录
- [ ] 各功能模块运行正常

---

## 🎯 关键配置总结

### 网站配置（前端）
- **类型**：PHP项目（纯静态）
- **根目录**：`/www/wwwroot/crm/dist`
- **入口文件**：`index.html`

### Node.js配置（后端）
- **项目路径**：`/www/wwwroot/crm/backend`
- **启动文件**：`dist/app.js`
- **运行端口**：3000

### 反向代理配置
- **API路径**：`/api/` → `http://127.0.0.1:3000`
- **上传路径**：`/uploads/` → `http://127.0.0.1:3000`

---

**🎉 按照以上步骤操作，您的CRM系统将在宝塔面板中完美运行！**