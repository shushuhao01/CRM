内存
B 置**：2核2G最低配
**1.8.3+  ：CRM 系统 v 
**适用于**024-11-23 
**更新日期**：2  **版本**：v1.0---

率！

提高了部署成功可以单独执行和验证，大大存服务器

每一步都 ✅ 适合 2GB 内构建导致卡死
-避免一次性决问题
- ✅  及时发现和解部署过程
- ✅ 更好地控制以：
- ✅

通过分步部署，您可

## 🎯 总结
---清除浏览器缓存

3. 配置查 Nginx  检在
2.录是否存 目 检查 dist：
1.决方案**

**解
### 问题：页面空白查端口占用

3. 检库配置
2. 检查数据nd`crm-backelogs 志：`pm2 **：
1. 查看日**解决方案
即停止
# 问题：服务启动后立构建方案

##. 或使用本地alse`
4minify f- --n build -构建：`npm ru简化拟内存
3. 使用 虚2. 增加 Swap消
l+C 取按 Ctr. **：
1
**解决方案
文件不动问题：构建卡在某个

### # 🔧 故障排查--

#ld
```

- run buinpme=1536"
pace-sizax-old-sTIONS="--mE_OPxport NODt/CRM
ewrooww/ww`bash
cd /w构建前端
``### 重新```


rm-backend ctop
pm2 s止服务
```bash```

### 停kend
rm-bac cpm2 restart
```bash重启服务
```

### backend
gs crm-
pm2 lo`bash## 查看日志
``
#st
```
pm2 li
``bash 查看服务状态
`常用命令

###
## 💡 --
|

-0分钟** | 计** | **20-3 |
| **总Nginx5分钟 | 配置 |
| 步骤8 | 分钟 | 启动服务 | 1
| 步骤7 |⚠️分钟 | 构建前端 10步骤6 | 5-后端依赖 |
| 5分钟 | 步骤5 | 3-| 前端依赖 |
| 骤4 | 5-8分钟  |
| 步 npm镜像 步骤3 | 30秒 |
|分钟 | 配置检查 | 1 |境检查 |
| 步骤2 | 环 步骤1 | 1分钟
|----|-----|--|----
|------ |说明间 | | 预计时
| 步骤 署时间统计

## 📊 部息

---
该没有错误信`

应s 20
``end --linegs crm-back
pm2 lo志

```bash 测试 4：检查后端日查询

###- ✅ 数据
- ✅ 订单管理

- ✅ 客户管理看数据看板

- ✅ 查测试 3：测试功能
### `
super123456 密码：`dmin`
-户名：`supera
- 用

使用预设账号：## 测试 2：测试登录

#该能看到登录页面的IP或域名`

应p://您`htt站

在浏览器输入：问网## 测试 1：访终测试

#

## 🎉 最否正确

--- 否 → 检查配置是进行最终测试
-- 是 → 配置完成？
Nginx **

### ✅ 存""保. 点击 **
```

3}
scheme;o $otForwarded-Prer X-_set_head proxy;
   arded_foradd_x_forw-For $proxy_ X-Forwardedheader_set_xy
    proote_addr;remal-IP $-Reheader Xxy_set_t;
    pror Host $hoset_headeproxy_s  
  .0.0.1:3000;s http://127xy_pas  pro
  ation /api {}

lochtml;
index.ri/ /les $uri $u  try_fition / {
  `nginx
loca，修改为：

``cation /` 部分找到 `lo
2. 签配置文件"** 标"站设置中，点击 **1. 在网

配置 URL 重写## 8.3 
##*"保存"**
6. 点击 *
$host`发送域名**：`- **
   .0.0.1:3000`/127ttp:/**：`hURL**目标
   - `**：`api   - **代理名称
5. 填写：
"添加反向代理"**击 **
4. 点反向代理"** 标签
3. 点击 **"**点击 **"设置"
2. 到刚创建的网站列表找
1. 在网站理
# 8.2 配置反向代
###"提交"**
*态
4. 点击 ***PHP版本**：纯静`
   - RM/dist/wwwroot/C*根目录**：`/www * IP
   -的域名或 - **域名**：您3. 填写信息：
  "**
 **"添加站点. 点击"**
2点击左侧 **"网站塔面板，

1. 在宝站创建网8.1 操作：

#### # 

##后端协同工作x 反向代理，让前端和：
配置 Nginx

### 目的8：配置 Ngin
## 步骤 问题

---
查看日志排查
- 否 → 续步骤 8成功？
- 是 → 继务启动`

### ✅ 服
``tionall --produces
npm instnode_modulm -rf ackend
rwwroot/CRM/b
cd /www/w安装依赖``bash
# 重新 **缺少依赖**
```

3.名 -p 数据库名
`sql -u 用户接
my测试数据库连B_

#  D| grepkend/.env 
cat bac
# 检查配置文件bash接失败**
```库连
2. **数据ID
```
9 进程进程
kill -占用的

# 停止 | grep 3000-tunlpt sta程
net 端口的进用 3000# 查看占
```bash
*被占用**

1. **端口

**常见问题：*s 50
```ckend --line-bacrmgs 2 loh
pm```bas*
志**检查日果启动失败：

* 如`

### ❌─┘
``───┴───────────┴─────────────────────┴─     │
└0  │   │ online  crm-backend│ ─┤
│ 0   ──────┼────────────┼────┼─────────rt │
├─────restatus  │ sta         │  name
│ id  │─────────┐┬─────────┬───────────────────┬==
┌ =务状态 服果：
```
===`

### 预期结am
``ostres 10 --n --linendckem-bags cr="
pm2 lo= 最近日志 =="
echo "=="查看日志
echo 

#  list==="
pm2== 服务状态  "=""
echo看服务状态
echo 
# 查up

pm2 start自启# 设置开机ave

M2 配置
pm2 s保存 Prt

# d" -- starm-backen"came  npm --nstart
pm2 "==="=== 启动后端服务 ""
echo 新服务
echo 服务"

# 启动册的"没有已注 echo null ||d 2>/dev/enete crm-backel2 dpm服务"
ho "没有运行中的ecv/null || >/de 2rm-backend c
pm2 stop"==== 停止旧服务 =="
echo "
echo " 停止旧服务（如果存在）
#pm2
fi
stall -g m in    np..."
安装M2 未安装，正在⚠️  P "choen
    ev/null; thm2 &> /de -v pnd! comma2 ==="
if === 检查 PM否安装
echo "
# 检查 PM2 是d
enCRM/backwwroot/
cd /www/w录 进入后端目```bash
#
：
务

### 操作ode.js 服PM2 启动后端 N### 目的：
使用 

7：启动后端服务

## 步骤 解决方案

--- 否 → 尝试上述 继续步骤 7
- 是 →
-✅ 构建成功？### 7

骤，直接进行步骤 
4. 跳过此步M/dist`CRoot/ `/www/wwwr. 解压到
3到服务器 文件夹打包上传dist`将 `
2.  build`m runnp在本地电脑运行 `1. 案：
建，使用本地构建方如果服务器实在无法构*
C：使用本地构建*`

**方案 sql
``tart mysystemctl s重启 MySQL


# 构建完成后un build 重新构建
npm r
#op mysql
mctl styste放内存
s停止其他服务释+C）

# 临时前构建（Ctrlbash
# 取消当
```方案 B：分批构建**

**``
`alse- --minify frun build -
npm 不压缩）# 使用简化构建（trl+C）

消当前构建（C```bash
# 取*
方案 A：使用简化构建*：

**构建卡住或失败
### ❌ 如果sets
```
xxx as root  xr-x 2 rootl
drwxr-x.htmt  xxx inde 1 root roo--r--w-r
-r件：建文 构建成功！
构
✅ 预期结果：
```

###```fi
失败"
cho "❌ 构建  ee
  st/
els di -lh   ls"构建文件："
 
    echo "成功！ho "✅ 构建n
    ec" ]; thedex.html"dist/in] && [ -f "dist" -d 
if [ 查构建结果 ==="ho "=== 检 ""
ec查构建结果
echo

# 检buildpm run 
necho ""
 取消"
 Ctrl+C 15 分钟没反应，按"💡 如果超过..."
echo 等待分钟，请耐心可能需要 5-10  "⏳ 这
echo=="开始构建前端 =ho "=== 
ec"echo "始构建
 dist

# 开ite
rm -rfules/.vmodnode_rf =="
rm - 清理旧缓存 ="===o ech清理旧的构建缓存


# 536"ce-size=1-max-old-spaPTIONS="-t NODE_Oxpor！）
e设置内存限制（重要RM

# /wwwroot/Cd /www目录
c项目根ash
# 确保在``b
`
### 操作：

l+C 取消Ctr没反应，按 15 分钟 分钟
- 如果超过 骤
- 需要 5-10最容易卡住的步要提示：
- 这是

### ⚠️ 重包成可部署的静态文件源代码编译打### 目的：
将前端）

：构建前端（关键步骤
## 步骤 6

---
 清理后重试6
- 否 →步骤  继续？
- 是 →## ✅ 安装成功包
```

#量：200+ 个目录已创建
已安装包数ode_modules ackend/n✅ b
```

### 预期结果： ..
```
 返回项目根目录
cdi

#"❌ 安装失败"
f
    echo 
else-lules | wc _modode"
    ls n"已安装包数量：
    echo les 目录已创建"duode_moackend/n  echo "✅ bthen
  ]; e_modules" od-d "nf [ 装结果 ==="
io "=== 检查安 ""
ech果
echo
# 检查安装结eps
eer-d-legacy-p --productionm install - 分钟..."
np3-5可能需要 echo "⏳ 这后端依赖 ==="
cho "=== 安装）
e生产环境端依赖（仅
# 安装后
backend 进入后端目录
cd h
#

```bas
### 操作：赖，节省空间和时间
意：
只安装生产环境依 注包

### ⚠️所需的依赖 目的：
安装后端项目装后端依赖

###
## 步骤 5：安--


-解决方案 否 → 尝试上述步骤 5
-→ 继续安装成功？
- 是 ``

### ✅ eer-deps
`acy-p-legll -装
npm insta
# 重新安apfile
 /swdo swaponswapfile
suudo mkswap /ile
s 600 /swapfhmod2048
sudo cunt==1M co bsilewapfof=/szero f=/dev/udo dd iSwap
s 2GB # 创建
``bash存**
`wap 虚拟内增加 S*方案 B：
```

*-depscy-peergastall --leson
npm ink.jpackage-locs
rm -rf node_modulef 
rm -rbash```**
重试方案 A：清理后：

**安装失败### ❌ 如果 个包
```

00+量：8建
已安装包数odules 目录已创`
✅ node_m
``果：## 预期结
#
```
"
fi失败❌ 安装o "se
    echwc -l
eldules | de_mo"
    ls no"已安装包数量：ho     ec 目录已创建"
dules✅ node_mo  echo "]; then
  modules" "node_"
if [ -d 果 ===装结检查安
echo "=== 
echo ""装结果

# 检查安psacy-peer-deall --legst
npm in..."，请耐心等待需要 5-8 分钟 这可能 "⏳==="
echo装前端依赖 echo "=== 安
安装前端依赖

# e=1536"d-space-siz="--max-olNSt NODE_OPTIO要！）
expor置内存限制（重sh
# 设`ba# 操作：

``##待

分钟，请耐心等-8 注意：
这一步需要 5

### ⚠️ 目所需的所有依赖包装前端项
安目的：
### 4：安装前端依赖

## 步骤 --

- 重新执行配置命令
步骤 4
- 否 → 是 → 继续# ✅ 配置成功？
-
##m/
```
.coy.npmmirroristrhttps://reg当前镜像：
果：
```
# 预期结
##ry
```
registet  gpm config"当前镜像："
n echo验证配置
m

# irror.co.npmmry//registtps:ht registry fig setnpm con==="
pm 镜像 "=== 配置 n镜像
echo 置淘宝 配bash
#操作：

```赖下载

### ：
使用淘宝镜像加速依
### 目的置 npm 镜像
 步骤 3：配

##

---后再继续
- 否 → 完成配置续步骤 3完成？
- 是 → 继配置
### ✅ 的密钥
```
随机生成WT_SECRET=库名
JASE=您的数据DB_DATAB码
据库密ASSWORD=您的数数据库用户名
DB_PNAME=您的
DB_USER`env
``以下配置：`

修改文件管理器编辑
``宝塔面板的使用
# 或nv
.ekend/
nano bac 编辑器 nanoash
# 使用编辑它：

```b的，必须env` 是新创建kend/.
如果 `bac重要：
### ⚠️ 
```
oduction 存在在
✅ .env.pr/.env 存ackend：
```
✅ b
### 预期结果
```
ction"
fidu创建 .env.proo "✅ 已EOF
    ech
AL_API=trueTE_USE_REn
VIductioro=p_ENV
NODEM管理系统APP_TITLE=CRVITE_
E_URL=/api_API_BASEOF'
VITEtion << '.product > .env"
    ca置..."正在创建默认配
    echo tion 不存在".env.produc  echo "❌ lse
  
eon 存在"v.producti "✅ .en
    echoen" ]; thductionv.pro".enif [ -f 置 ==="
端配== 检查前
echo "=""
echo 端配置文件

# 检查前"
fi信息！文件，填写数据库v en编辑 backend/.  请 echo "⚠️/.env
   ple backendv.examd/.enken baccp"
    o "正在创建...
    echd/.env 不存在"ken bac "❌ho
    ec
elseASSWORD""P -v epnv | gr.e backend/ "DB_"
    grep "数据库配置："
    echoenv 存在"end/."✅ backo 
    echhenv" ]; t"backend/.en [ -f 置 ==="
if后端配ho "=== 检查查后端配置文件
ec`bash
# 检
``
### 操作：已准备好

的配置文件都必要所有
确保

### 目的：配置文件检查 步骤 2：
---

##务器
容服e.js 或扩- 否 → 升级 Nod→ 继续步骤 2
 检查通过？
- 是 ```

### ✅或更高
: 5GB 空间空间 ===
可用
=== 磁盘或更高

total: 2GB  === 系统内存

===
9.x.x 或更高 版本 ==== npm
==.x 或更高
v18.x===
ode.js 版本 `
=== N``期结果：
 预
###wroot
```
/www/ww"
df -h  === 磁盘空间echo "===
磁盘空间

# 检查ree -h
f存 ===""=== 系统内o 查系统内存
ech

# 检
npm -v="=== npm 版本 echo "==本

# 检查 npm 版
node -v
版本 ==="e.js  Nod
echo "===ode.js 版本

# 检查 NRMww/wwwroot/Ccd /w目录

# 进入项目
```bash执行：


打开宝塔终端， 操作：

###否满足要求检查服务器环境是
### 目的：

1：环境检查# 步骤 
---

#oot/CRM`
wwwr`/www/目代码到  [ ] 已上传项.sql
-并导入 schema据库
- [ ] 已创建数、Node.js、PM2MySQL 已安装 Nginx、[ ]安装宝塔面板
-  ] 已 [前，请确保：
- 在开始之
##### 📝 准备工作
---

分钟)
```

inx (5
步骤8: 配置Ng1分钟)
   ↓服务 (后端 启动  ↓
步骤7:易卡住的步骤
 ) ← 最容-10分钟构建前端 (5↓
步骤6: -5分钟)
   依赖 (3安装后端5:  ↓
步骤)
  赖 (5-8分钟
步骤4: 安装前端依   ↓
m镜像 (30秒)置np骤3: 配分钟)
   ↓
步2: 配置文件检查 (1
   ↓
步骤 环境检查 (1分钟)
步骤1:

```## 🎯 部署流程概览
---

用
 ✅ 更好地控制内存使单独重试某一步
-
- ✅ 出错可以执行完可以检查结果立步骤
- ✅ 每步分为 8 个独- ✅ 将部署# 解决方案：


##败后不知道哪一步出错不足
- ❌ 构建失存服务器构建时内存住
- ❌ 2GB 内署脚本在构建前端时容易卡
- ❌ 一键部

### 问题：什么要分步部署？ 为

## 📋死

---次性构建导致服务器卡可以单独执行，避免一每步都多个独立步骤， 本指南将部署过程分解为

>2GB内存服务器）塔分步部署指南（适合# 宝