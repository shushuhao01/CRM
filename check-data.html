<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>检查客户和订单数据</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .customer, .order { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .highlight { background: #ffeb3b; font-weight: bold; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>检查客户和订单数据</h1>
    
    <div class="section">
        <h2>客户数据检查</h2>
        <div id="customer-info"></div>
    </div>
    
    <div class="section">
        <h2>订单数据检查</h2>
        <div id="order-info"></div>
    </div>
    
    <div class="section">
        <h2>所有localStorage键</h2>
        <div id="storage-keys"></div>
    </div>

    <script>
        function checkCustomerData() {
            const customerInfo = document.getElementById('customer-info');
            
            // 检查新的持久化存储键
            const persistentKey = 'crm_store_customer';
            const persistentData = localStorage.getItem(persistentKey);
            
            // 检查旧的统一存储键
            const unifiedKey = 'crm_customers_unified';
            const unifiedData = localStorage.getItem(unifiedKey);
            
            let html = '';
            
            if (persistentData) {
                try {
                    const data = JSON.parse(persistentData);
                    html += `<h3>✅ 新持久化存储 (${persistentKey})</h3>`;
                    
                    if (data.customers && Array.isArray(data.customers)) {
                        html += `<p>客户总数: <strong>${data.customers.length}</strong></p>`;
                        
                        // 查找黄锋
                        const huangfeng = data.customers.find(c => 
                            c.name === '黄锋' || c.phone === '15815897364'
                        );
                        
                        if (huangfeng) {
                            html += `<div class="customer highlight">
                                <h4>🎯 找到客户：黄锋</h4>
                                <p><strong>姓名:</strong> ${huangfeng.name}</p>
                                <p><strong>电话:</strong> ${huangfeng.phone}</p>
                                <p><strong>ID:</strong> ${huangfeng.id}</p>
                                <p><strong>客户编码:</strong> ${huangfeng.code}</p>
                                <p><strong>创建时间:</strong> ${huangfeng.createTime}</p>
                                <p><strong>创建者:</strong> ${huangfeng.createdBy}</p>
                                <p><strong>销售人员:</strong> ${huangfeng.salesPersonId}</p>
                                <p><strong>地址:</strong> ${huangfeng.address}</p>
                                <p><strong>年龄:</strong> ${huangfeng.age}</p>
                                <p><strong>等级:</strong> ${huangfeng.level}</p>
                                <p><strong>状态:</strong> ${huangfeng.status}</p>
                            </div>`;
                        } else {
                            html += `<p>❌ 未找到客户"黄锋"或手机号"15815897364"</p>`;
                        }
                        
                        // 显示最近的3个客户
                        html += '<h4>最近的3个客户:</h4>';
                        data.customers.slice(-3).forEach((customer, index) => {
                            html += `<div class="customer">
                                <strong>${index + 1}. ${customer.name}</strong> (${customer.phone}) 
                                - 创建时间: ${customer.createTime}
                            </div>`;
                        });
                    } else {
                        html += '<p>❌ 客户数据格式不正确</p>';
                    }
                } catch (error) {
                    html += `<p>❌ 解析新持久化数据失败: ${error.message}</p>`;
                }
            } else {
                html += `<p>❌ 未找到新持久化存储 (${persistentKey})</p>`;
            }
            
            if (unifiedData) {
                try {
                    const data = JSON.parse(unifiedData);
                    html += `<h3>📦 旧统一存储 (${unifiedKey})</h3>`;
                    
                    if (data.customers && Array.isArray(data.customers)) {
                        html += `<p>客户总数: <strong>${data.customers.length}</strong></p>`;
                        
                        // 查找黄锋
                        const huangfeng = data.customers.find(c => 
                            c.name === '黄锋' || c.phone === '15815897364'
                        );
                        
                        if (huangfeng) {
                            html += `<div class="customer highlight">
                                <h4>🎯 在旧存储中找到客户：黄锋</h4>
                                <pre>${JSON.stringify(huangfeng, null, 2)}</pre>
                            </div>`;
                        }
                    }
                } catch (error) {
                    html += `<p>❌ 解析旧统一数据失败: ${error.message}</p>`;
                }
            } else {
                html += `<p>❌ 未找到旧统一存储 (${unifiedKey})</p>`;
            }
            
            customerInfo.innerHTML = html;
        }
        
        function checkOrderData() {
            const orderInfo = document.getElementById('order-info');
            
            const orderKey = 'crm_store_orders';
            const orderData = localStorage.getItem(orderKey);
            
            let html = '';
            
            if (orderData) {
                try {
                    const data = JSON.parse(orderData);
                    html += `<h3>✅ 订单存储 (${orderKey})</h3>`;
                    
                    if (data.orders && Array.isArray(data.orders)) {
                        html += `<p>订单总数: <strong>${data.orders.length}</strong></p>`;
                        
                        // 查找指定订单
                        const targetOrder = data.orders.find(o => 
                            o.orderNumber === 'ORD20251011890366'
                        );
                        
                        if (targetOrder) {
                            html += `<div class="order highlight">
                                <h4>🎯 找到订单：ORD20251011890366</h4>
                                <p><strong>订单号:</strong> ${targetOrder.orderNumber}</p>
                                <p><strong>客户:</strong> ${targetOrder.customerName} (${targetOrder.customerPhone})</p>
                                <p><strong>总金额:</strong> ${targetOrder.totalAmount}</p>
                                <p><strong>状态:</strong> ${targetOrder.status}</p>
                                <p><strong>创建时间:</strong> ${targetOrder.createTime}</p>
                                <pre>${JSON.stringify(targetOrder, null, 2)}</pre>
                            </div>`;
                        } else {
                            html += `<p>❌ 未找到订单"ORD20251011890366"</p>`;
                        }
                        
                        // 显示最近的3个订单
                        html += '<h4>最近的3个订单:</h4>';
                        data.orders.slice(-3).forEach((order, index) => {
                            html += `<div class="order">
                                <strong>${index + 1}. ${order.orderNumber}</strong> 
                                - 客户: ${order.customerName} (${order.customerPhone})
                                - 创建时间: ${order.createTime}
                            </div>`;
                        });
                    } else {
                        html += '<p>❌ 订单数据格式不正确</p>';
                    }
                } catch (error) {
                    html += `<p>❌ 解析订单数据失败: ${error.message}</p>`;
                }
            } else {
                html += `<p>❌ 未找到订单存储 (${orderKey})</p>`;
            }
            
            orderInfo.innerHTML = html;
        }
        
        function showAllStorageKeys() {
            const storageKeys = document.getElementById('storage-keys');
            const allKeys = Object.keys(localStorage);
            const crmKeys = allKeys.filter(key => key.includes('crm') || key.includes('customer') || key.includes('order'));
            
            let html = '<h3>CRM相关的localStorage键:</h3>';
            crmKeys.forEach(key => {
                const value = localStorage.getItem(key);
                const preview = value ? (value.length > 100 ? value.substring(0, 100) + '...' : value) : 'null';
                html += `<div><strong>${key}:</strong> ${preview}</div>`;
            });
            
            storageKeys.innerHTML = html;
        }
        
        // 页面加载时执行检查
        window.onload = function() {
            checkCustomerData();
            checkOrderData();
            showAllStorageKeys();
        };
    </script>
</body>
</html>