<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ£€æŸ¥å®¢æˆ·å’Œè®¢å•æ•°æ®</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .customer, .order { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .highlight { background: #ffeb3b; font-weight: bold; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>æ£€æŸ¥å®¢æˆ·å’Œè®¢å•æ•°æ®</h1>
    
    <div class="section">
        <h2>å®¢æˆ·æ•°æ®æ£€æŸ¥</h2>
        <div id="customer-info"></div>
    </div>
    
    <div class="section">
        <h2>è®¢å•æ•°æ®æ£€æŸ¥</h2>
        <div id="order-info"></div>
    </div>
    
    <div class="section">
        <h2>æ‰€æœ‰localStorageé”®</h2>
        <div id="storage-keys"></div>
    </div>

    <script>
        function checkCustomerData() {
            const customerInfo = document.getElementById('customer-info');
            
            // æ£€æŸ¥æ–°çš„æŒä¹…åŒ–å­˜å‚¨é”®
            const persistentKey = 'crm_store_customer';
            const persistentData = localStorage.getItem(persistentKey);
            
            // æ£€æŸ¥æ—§çš„ç»Ÿä¸€å­˜å‚¨é”®
            const unifiedKey = 'crm_customers_unified';
            const unifiedData = localStorage.getItem(unifiedKey);
            
            let html = '';
            
            if (persistentData) {
                try {
                    const data = JSON.parse(persistentData);
                    html += `<h3>âœ… æ–°æŒä¹…åŒ–å­˜å‚¨ (${persistentKey})</h3>`;
                    
                    if (data.customers && Array.isArray(data.customers)) {
                        html += `<p>å®¢æˆ·æ€»æ•°: <strong>${data.customers.length}</strong></p>`;
                        
                        // æŸ¥æ‰¾é»„é”‹
                        const huangfeng = data.customers.find(c => 
                            c.name === 'é»„é”‹' || c.phone === '15815897364'
                        );
                        
                        if (huangfeng) {
                            html += `<div class="customer highlight">
                                <h4>ğŸ¯ æ‰¾åˆ°å®¢æˆ·ï¼šé»„é”‹</h4>
                                <p><strong>å§“å:</strong> ${huangfeng.name}</p>
                                <p><strong>ç”µè¯:</strong> ${huangfeng.phone}</p>
                                <p><strong>ID:</strong> ${huangfeng.id}</p>
                                <p><strong>å®¢æˆ·ç¼–ç :</strong> ${huangfeng.code}</p>
                                <p><strong>åˆ›å»ºæ—¶é—´:</strong> ${huangfeng.createTime}</p>
                                <p><strong>åˆ›å»ºè€…:</strong> ${huangfeng.createdBy}</p>
                                <p><strong>é”€å”®äººå‘˜:</strong> ${huangfeng.salesPersonId}</p>
                                <p><strong>åœ°å€:</strong> ${huangfeng.address}</p>
                                <p><strong>å¹´é¾„:</strong> ${huangfeng.age}</p>
                                <p><strong>ç­‰çº§:</strong> ${huangfeng.level}</p>
                                <p><strong>çŠ¶æ€:</strong> ${huangfeng.status}</p>
                            </div>`;
                        } else {
                            html += `<p>âŒ æœªæ‰¾åˆ°å®¢æˆ·"é»„é”‹"æˆ–æ‰‹æœºå·"15815897364"</p>`;
                        }
                        
                        // æ˜¾ç¤ºæœ€è¿‘çš„3ä¸ªå®¢æˆ·
                        html += '<h4>æœ€è¿‘çš„3ä¸ªå®¢æˆ·:</h4>';
                        data.customers.slice(-3).forEach((customer, index) => {
                            html += `<div class="customer">
                                <strong>${index + 1}. ${customer.name}</strong> (${customer.phone}) 
                                - åˆ›å»ºæ—¶é—´: ${customer.createTime}
                            </div>`;
                        });
                    } else {
                        html += '<p>âŒ å®¢æˆ·æ•°æ®æ ¼å¼ä¸æ­£ç¡®</p>';
                    }
                } catch (error) {
                    html += `<p>âŒ è§£ææ–°æŒä¹…åŒ–æ•°æ®å¤±è´¥: ${error.message}</p>`;
                }
            } else {
                html += `<p>âŒ æœªæ‰¾åˆ°æ–°æŒä¹…åŒ–å­˜å‚¨ (${persistentKey})</p>`;
            }
            
            if (unifiedData) {
                try {
                    const data = JSON.parse(unifiedData);
                    html += `<h3>ğŸ“¦ æ—§ç»Ÿä¸€å­˜å‚¨ (${unifiedKey})</h3>`;
                    
                    if (data.customers && Array.isArray(data.customers)) {
                        html += `<p>å®¢æˆ·æ€»æ•°: <strong>${data.customers.length}</strong></p>`;
                        
                        // æŸ¥æ‰¾é»„é”‹
                        const huangfeng = data.customers.find(c => 
                            c.name === 'é»„é”‹' || c.phone === '15815897364'
                        );
                        
                        if (huangfeng) {
                            html += `<div class="customer highlight">
                                <h4>ğŸ¯ åœ¨æ—§å­˜å‚¨ä¸­æ‰¾åˆ°å®¢æˆ·ï¼šé»„é”‹</h4>
                                <pre>${JSON.stringify(huangfeng, null, 2)}</pre>
                            </div>`;
                        }
                    }
                } catch (error) {
                    html += `<p>âŒ è§£ææ—§ç»Ÿä¸€æ•°æ®å¤±è´¥: ${error.message}</p>`;
                }
            } else {
                html += `<p>âŒ æœªæ‰¾åˆ°æ—§ç»Ÿä¸€å­˜å‚¨ (${unifiedKey})</p>`;
            }
            
            customerInfo.innerHTML = html;
        }
        
        function checkOrderData() {
            const orderInfo = document.getElementById('order-info');
            
            const orderKey = 'crm_store_orders';
            const orderData = localStorage.getItem(orderKey);
            
            let html = '';
            
            if (orderData) {
                try {
                    const data = JSON.parse(orderData);
                    html += `<h3>âœ… è®¢å•å­˜å‚¨ (${orderKey})</h3>`;
                    
                    if (data.orders && Array.isArray(data.orders)) {
                        html += `<p>è®¢å•æ€»æ•°: <strong>${data.orders.length}</strong></p>`;
                        
                        // æŸ¥æ‰¾æŒ‡å®šè®¢å•
                        const targetOrder = data.orders.find(o => 
                            o.orderNumber === 'ORD20251011890366'
                        );
                        
                        if (targetOrder) {
                            html += `<div class="order highlight">
                                <h4>ğŸ¯ æ‰¾åˆ°è®¢å•ï¼šORD20251011890366</h4>
                                <p><strong>è®¢å•å·:</strong> ${targetOrder.orderNumber}</p>
                                <p><strong>å®¢æˆ·:</strong> ${targetOrder.customerName} (${targetOrder.customerPhone})</p>
                                <p><strong>æ€»é‡‘é¢:</strong> ${targetOrder.totalAmount}</p>
                                <p><strong>çŠ¶æ€:</strong> ${targetOrder.status}</p>
                                <p><strong>åˆ›å»ºæ—¶é—´:</strong> ${targetOrder.createTime}</p>
                                <pre>${JSON.stringify(targetOrder, null, 2)}</pre>
                            </div>`;
                        } else {
                            html += `<p>âŒ æœªæ‰¾åˆ°è®¢å•"ORD20251011890366"</p>`;
                        }
                        
                        // æ˜¾ç¤ºæœ€è¿‘çš„3ä¸ªè®¢å•
                        html += '<h4>æœ€è¿‘çš„3ä¸ªè®¢å•:</h4>';
                        data.orders.slice(-3).forEach((order, index) => {
                            html += `<div class="order">
                                <strong>${index + 1}. ${order.orderNumber}</strong> 
                                - å®¢æˆ·: ${order.customerName} (${order.customerPhone})
                                - åˆ›å»ºæ—¶é—´: ${order.createTime}
                            </div>`;
                        });
                    } else {
                        html += '<p>âŒ è®¢å•æ•°æ®æ ¼å¼ä¸æ­£ç¡®</p>';
                    }
                } catch (error) {
                    html += `<p>âŒ è§£æè®¢å•æ•°æ®å¤±è´¥: ${error.message}</p>`;
                }
            } else {
                html += `<p>âŒ æœªæ‰¾åˆ°è®¢å•å­˜å‚¨ (${orderKey})</p>`;
            }
            
            orderInfo.innerHTML = html;
        }
        
        function showAllStorageKeys() {
            const storageKeys = document.getElementById('storage-keys');
            const allKeys = Object.keys(localStorage);
            const crmKeys = allKeys.filter(key => key.includes('crm') || key.includes('customer') || key.includes('order'));
            
            let html = '<h3>CRMç›¸å…³çš„localStorageé”®:</h3>';
            crmKeys.forEach(key => {
                const value = localStorage.getItem(key);
                const preview = value ? (value.length > 100 ? value.substring(0, 100) + '...' : value) : 'null';
                html += `<div><strong>${key}:</strong> ${preview}</div>`;
            });
            
            storageKeys.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæ£€æŸ¥
        window.onload = function() {
            checkCustomerData();
            checkOrderData();
            showAllStorageKeys();
        };
    </script>
</body>
</html>