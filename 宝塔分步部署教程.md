# å®å¡”åˆ†æ­¥éƒ¨ç½²æ•™ç¨‹ï¼ˆ2GBæœåŠ¡å™¨ä¸“ç”¨ï¼‰

> å°†éƒ¨ç½²è¿‡ç¨‹åˆ†è§£ä¸º8ä¸ªç‹¬ç«‹æ­¥éª¤ï¼Œæ¯æ­¥å¯å•ç‹¬æ‰§è¡Œï¼Œé¿å…ä¸€æ¬¡æ€§æ„å»ºå¡æ­»

---

## ğŸ“‹ éƒ¨ç½²æµç¨‹

```
æ­¥éª¤1: ç¯å¢ƒæ£€æŸ¥ â†’ æ­¥éª¤2: é…ç½®æ£€æŸ¥ â†’ æ­¥éª¤3: npmé•œåƒ 
   â†“
æ­¥éª¤4: å‰ç«¯ä¾èµ– â†’ æ­¥éª¤5: åç«¯ä¾èµ– â†’ æ­¥éª¤6: æ„å»ºå‰ç«¯
   â†“
æ­¥éª¤7: å¯åŠ¨æœåŠ¡ â†’ æ­¥éª¤8: é…ç½®Nginx â†’ å®Œæˆ
```

---

## æ­¥éª¤ 1ï¼šç¯å¢ƒæ£€æŸ¥

æ‰“å¼€å®å¡”ç»ˆç«¯ï¼Œæ‰§è¡Œï¼š

```bash
cd /www/wwwroot/CRM
node -v  # åº”è¯¥ >= v16
npm -v
free -h  # æŸ¥çœ‹å†…å­˜
```

---

## æ­¥éª¤ 2ï¼šé…ç½®æ–‡ä»¶æ£€æŸ¥

```bash
# æ£€æŸ¥åç«¯é…ç½®
if [ ! -f "backend/.env" ]; then
    cp backend/.env.example backend/.env
    echo "âš ï¸  è¯·ç¼–è¾‘ backend/.env å¡«å†™æ•°æ®åº“ä¿¡æ¯"
fi

# æ£€æŸ¥å‰ç«¯é…ç½®
if [ ! -f ".env.production" ]; then
    cat > .env.production << 'EOF'
VITE_API_BASE_URL=/api
VITE_APP_TITLE=CRMç®¡ç†ç³»ç»Ÿ
NODE_ENV=production
VITE_USE_REAL_API=true
EOF
fi
```

**é‡è¦**ï¼šç¼–è¾‘ `backend/.env`ï¼Œå¡«å†™æ•°æ®åº“ä¿¡æ¯å’ŒJWTå¯†é’¥

---

## æ­¥éª¤ 3ï¼šé…ç½®npmé•œåƒ

```bash
npm config set registry https://registry.npmmirror.com
npm config get registry  # éªŒè¯
```

---

## æ­¥éª¤ 4ï¼šå®‰è£…å‰ç«¯ä¾èµ–ï¼ˆ5-8åˆ†é’Ÿï¼‰

```bash
export NODE_OPTIONS="--max-old-space-size=1536"
npm install --legacy-peer-deps
```

**å¦‚æœå¤±è´¥**ï¼š
```bash
rm -rf node_modules package-lock.json
npm install --legacy-peer-deps
```

---

## æ­¥éª¤ 5ï¼šå®‰è£…åç«¯ä¾èµ–ï¼ˆ3-5åˆ†é’Ÿï¼‰

```bash
cd backend
npm install --production --legacy-peer-deps
cd ..
```

---

## æ­¥éª¤ 6ï¼šæ„å»ºå‰ç«¯ï¼ˆ5-10åˆ†é’Ÿï¼‰âš ï¸

```bash
export NODE_OPTIONS="--max-old-space-size=1536"
rm -rf node_modules/.vite dist
npm run build
```

**å¦‚æœå¡ä½è¶…è¿‡15åˆ†é’Ÿ**ï¼š
- æŒ‰ Ctrl+C å–æ¶ˆ
- å°è¯•ï¼š`npm run build -- --minify false`
- æˆ–ä½¿ç”¨æœ¬åœ°æ„å»ºæ–¹æ¡ˆ

---

## æ­¥éª¤ 7ï¼šå¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend
pm2 stop crm-backend 2>/dev/null || true
pm2 delete crm-backend 2>/dev/null || true
pm2 start npm --name "crm-backend" -- start
pm2 save
pm2 list
```

---

## æ­¥éª¤ 8ï¼šé…ç½®Nginx

### 8.1 åˆ›å»ºç½‘ç«™
- å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ æ·»åŠ ç«™ç‚¹
- æ ¹ç›®å½•ï¼š`/www/wwwroot/CRM/dist`
- PHPç‰ˆæœ¬ï¼šçº¯é™æ€

### 8.2 é…ç½®åå‘ä»£ç†
- è®¾ç½® â†’ åå‘ä»£ç† â†’ æ·»åŠ 
- ç›®æ ‡URLï¼š`http://127.0.0.1:3000`

### 8.3 é…ç½®æ–‡ä»¶
```nginx
location / {
    try_files $uri $uri/ /index.html;
}

location /api {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}
```

---

## ğŸ‰ æµ‹è¯•

è®¿é—®ï¼š`http://æ‚¨çš„IPæˆ–åŸŸå`

ç™»å½•ï¼š`superadmin` / `super123456`

---

## ğŸ’¡ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs crm-backend

# é‡å¯æœåŠ¡
pm2 restart crm-backend

# é‡æ–°æ„å»º
cd /www/wwwroot/CRM
export NODE_OPTIONS="--max-old-space-size=1536"
npm run build
```

---

**æ€»è€—æ—¶**ï¼š20-30åˆ†é’Ÿ
