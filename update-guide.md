# GitHub ä»£ç æ›´æ–°æŒ‡å—

## ğŸ“‹ ç›®å½•
- [æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨æ›´æ–°](#æ–¹æ³•ä¸€æ‰‹åŠ¨æ›´æ–°)
- [æ–¹æ³•äºŒï¼šä½¿ç”¨æ›´æ–°è„šæœ¬](#æ–¹æ³•äºŒä½¿ç”¨æ›´æ–°è„šæœ¬)
- [æ–¹æ³•ä¸‰ï¼šå®å¡”è®¡åˆ’ä»»åŠ¡](#æ–¹æ³•ä¸‰å®å¡”è®¡åˆ’ä»»åŠ¡)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨æ›´æ–°

### é€‚ç”¨åœºæ™¯
- ç¬¬ä¸€æ¬¡æ›´æ–°
- éœ€è¦æŸ¥çœ‹è¯¦ç»†æ›´æ–°è¿‡ç¨‹
- å‡ºç°é—®é¢˜éœ€è¦æ‰‹åŠ¨æ’æŸ¥

### æ“ä½œæ­¥éª¤

#### 1. æ‰“å¼€å®å¡”ç»ˆç«¯
åœ¨å®å¡”é¢æ¿å³ä¸Šè§’ç‚¹å‡» **"ç»ˆç«¯"** æŒ‰é’®

#### 2. è¿›å…¥é¡¹ç›®ç›®å½•
```bash
cd /www/wwwroot/CRM
```

#### 3. æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
```bash
git log --oneline -1
```

#### 4. æ‹‰å–æœ€æ–°ä»£ç 
```bash
git pull origin main
```

#### 5. æŸ¥çœ‹æ›´æ–°å†…å®¹
```bash
git log --oneline -5
```

#### 6. æ›´æ–°ä¾èµ–
```bash
# æ›´æ–°å‰ç«¯ä¾èµ–
npm install

# æ›´æ–°åç«¯ä¾èµ–
cd backend
npm install
cd ..
```

#### 7. é‡æ–°æ„å»ºå‰ç«¯
```bash
npm run build
```

#### 8. é‡å¯åç«¯æœåŠ¡
```bash
pm2 restart crm-backend
```

#### 9. éªŒè¯æ›´æ–°
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs crm-backend --lines 20
```

---

## æ–¹æ³•äºŒï¼šä½¿ç”¨æ›´æ–°è„šæœ¬

### é€‚ç”¨åœºæ™¯
- æ—¥å¸¸æ›´æ–°
- å¿«é€Ÿæ›´æ–°
- è‡ªåŠ¨åŒ–æ›´æ–°

### é¦–æ¬¡è®¾ç½®

#### 1. ä¸Šä¼ æ›´æ–°è„šæœ¬
å°† `update.sh` æ–‡ä»¶ä¸Šä¼ åˆ° `/www/wwwroot/CRM` ç›®å½•

#### 2. ç»™è„šæœ¬æ‰§è¡Œæƒé™
```bash
cd /www/wwwroot/CRM
chmod +x update.sh
```

### ä½¿ç”¨æ–¹æ³•

#### æ¯æ¬¡æ›´æ–°åªéœ€æ‰§è¡Œï¼š
```bash
cd /www/wwwroot/CRM
./update.sh
```

### è„šæœ¬åŠŸèƒ½
- âœ… è‡ªåŠ¨å¤‡ä»½é…ç½®æ–‡ä»¶
- âœ… æ‹‰å–æœ€æ–°ä»£ç 
- âœ… æ¢å¤é…ç½®æ–‡ä»¶
- âœ… æ›´æ–°ä¾èµ–
- âœ… æ„å»ºå‰ç«¯
- âœ… é‡å¯åç«¯
- âœ… æ˜¾ç¤ºæ›´æ–°æ—¥å¿—

---

## æ–¹æ³•ä¸‰ï¼šå®å¡”è®¡åˆ’ä»»åŠ¡

### é€‚ç”¨åœºæ™¯
- å®šæœŸè‡ªåŠ¨æ›´æ–°
- æ— éœ€æ‰‹åŠ¨æ“ä½œ

### è®¾ç½®æ­¥éª¤

#### 1. è¿›å…¥è®¡åˆ’ä»»åŠ¡
åœ¨å®å¡”é¢æ¿ï¼Œç‚¹å‡»å·¦ä¾§ **"è®¡åˆ’ä»»åŠ¡"**

#### 2. æ·»åŠ ä»»åŠ¡
- **ä»»åŠ¡ç±»å‹**ï¼šShell è„šæœ¬
- **ä»»åŠ¡åç§°**ï¼šCRM ä»£ç æ›´æ–°
- **æ‰§è¡Œå‘¨æœŸ**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©ï¼ˆå¦‚ï¼šæ¯å¤©å‡Œæ™¨ 2 ç‚¹ï¼‰
- **è„šæœ¬å†…å®¹**ï¼š
```bash
#!/bin/bash
cd /www/wwwroot/CRM
./update.sh >> /www/wwwroot/CRM/update.log 2>&1
```

#### 3. ä¿å­˜å¹¶æµ‹è¯•
ç‚¹å‡» **"æ‰§è¡Œ"** æŒ‰é’®æµ‹è¯•ä»»åŠ¡æ˜¯å¦æ­£å¸¸

---

## ğŸ” æ›´æ–°å‰æ£€æŸ¥

### 1. æŸ¥çœ‹è¿œç¨‹æ›´æ–°å†…å®¹
```bash
cd /www/wwwroot/CRM
git fetch origin
git log HEAD..origin/main --oneline
```

### 2. æŸ¥çœ‹æœ¬åœ°ä¿®æ”¹
```bash
git status
```

### 3. å¤‡ä»½é‡è¦æ•°æ®
```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u ç”¨æˆ·å -p æ•°æ®åº“å > backup_$(date +%Y%m%d).sql

# å¤‡ä»½é…ç½®æ–‡ä»¶
cp backend/.env backend/.env.backup
```

---

## ğŸ”„ æ›´æ–°åéªŒè¯

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
pm2 list
```
åº”è¯¥çœ‹åˆ° `crm-backend` çŠ¶æ€ä¸º `online`

### 2. æŸ¥çœ‹æ—¥å¿—
```bash
pm2 logs crm-backend --lines 50
```
æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

### 3. è®¿é—®ç½‘ç«™
åœ¨æµè§ˆå™¨è®¿é—®æ‚¨çš„ç½‘ç«™ï¼Œæµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸

### 4. æµ‹è¯•å…³é”®åŠŸèƒ½
- âœ… ç™»å½•åŠŸèƒ½
- âœ… æ•°æ®æŸ¥è¯¢
- âœ… æ•°æ®æ·»åŠ 
- âœ… æ•°æ®ä¿®æ”¹

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šä»£ç å†²çª

**ç°è±¡**ï¼š
```
error: Your local changes to the following files would be overwritten by merge
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ¡ˆ Aï¼šä¿å­˜æœ¬åœ°ä¿®æ”¹
git stash
git pull origin main
git stash pop

# æ–¹æ¡ˆ Bï¼šæ”¾å¼ƒæœ¬åœ°ä¿®æ”¹
git reset --hard
git pull origin main

# æ–¹æ¡ˆ Cï¼šæŸ¥çœ‹å†²çªæ–‡ä»¶
git status
# æ‰‹åŠ¨å¤„ç†å†²çªæ–‡ä»¶
```

---

### é—®é¢˜ 2ï¼šä¾èµ–å®‰è£…å¤±è´¥

**ç°è±¡**ï¼š
```
npm ERR! code ELIFECYCLE
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†ç¼“å­˜
npm cache clean --force

# åˆ é™¤ node_modules
rm -rf node_modules
rm -rf backend/node_modules

# é‡æ–°å®‰è£…
npm install
cd backend && npm install
```

---

### é—®é¢˜ 3ï¼šæ„å»ºå¤±è´¥

**ç°è±¡**ï¼š
```
Build failed with errors
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
npm run build

# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node -v
# åº”è¯¥æ˜¯ 16.x æˆ–æ›´é«˜

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
```

---

### é—®é¢˜ 4ï¼šPM2 é‡å¯å¤±è´¥

**ç°è±¡**ï¼š
```
[PM2] Process not found
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
pm2 list

# åˆ é™¤æ—§è¿›ç¨‹
pm2 delete crm-backend

# é‡æ–°å¯åŠ¨
cd /www/wwwroot/CRM/backend
pm2 start npm --name "crm-backend" -- start

# ä¿å­˜é…ç½®
pm2 save
```

---

### é—®é¢˜ 5ï¼šæ›´æ–°åé¡µé¢ç©ºç™½

**å¯èƒ½åŸå› **ï¼š
- å‰ç«¯æ„å»ºå¤±è´¥
- Nginx é…ç½®é”™è¯¯
- ç¼“å­˜é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥æ„å»ºæ–‡ä»¶
ls -la /www/wwwroot/CRM/dist

# 2. é‡æ–°æ„å»º
cd /www/wwwroot/CRM
npm run build

# 3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# æŒ‰ Ctrl + Shift + Delete

# 4. é‡å¯ Nginx
systemctl restart nginx
```

---

## ğŸ”™ å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬

### å¦‚æœæ›´æ–°åå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å›æ»šï¼š

```bash
# 1. æŸ¥çœ‹æäº¤å†å²
cd /www/wwwroot/CRM
git log --oneline -10

# 2. å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
git reset --hard æäº¤ID

# 3. é‡æ–°æ„å»ºå’Œé‡å¯
npm install
npm run build
cd backend && npm install
pm2 restart crm-backend
```

---

## ğŸ“Š æ›´æ–°æ—¥å¿—æŸ¥çœ‹

### æŸ¥çœ‹æœ€è¿‘çš„æ›´æ–°
```bash
cd /www/wwwroot/CRM
git log --oneline -10
```

### æŸ¥çœ‹è¯¦ç»†æ›´æ–°å†…å®¹
```bash
git log -p -2
```

### æŸ¥çœ‹æŸä¸ªæ–‡ä»¶çš„ä¿®æ”¹å†å²
```bash
git log --follow -- æ–‡ä»¶è·¯å¾„
```

---

## ğŸ” å®‰å…¨å»ºè®®

### 1. æ›´æ–°å‰å¤‡ä»½
- å¤‡ä»½æ•°æ®åº“
- å¤‡ä»½é…ç½®æ–‡ä»¶
- å¤‡ä»½é‡è¦æ•°æ®

### 2. åœ¨æµ‹è¯•ç¯å¢ƒå…ˆæµ‹è¯•
- å¦‚æœæœ‰æµ‹è¯•ç¯å¢ƒï¼Œå…ˆåœ¨æµ‹è¯•ç¯å¢ƒæ›´æ–°
- ç¡®è®¤æ— é—®é¢˜åå†æ›´æ–°ç”Ÿäº§ç¯å¢ƒ

### 3. é€‰æ‹©åˆé€‚çš„æ›´æ–°æ—¶é—´
- é¿å…ä¸šåŠ¡é«˜å³°æœŸ
- å»ºè®®åœ¨å‡Œæ™¨æˆ–ä¸šåŠ¡ä½è°·æœŸæ›´æ–°

### 4. é€šçŸ¥ç”¨æˆ·
- æå‰é€šçŸ¥ç”¨æˆ·ç³»ç»Ÿç»´æŠ¤æ—¶é—´
- æ›´æ–°å®Œæˆåé€šçŸ¥ç”¨æˆ·

---

## ğŸ“ æ›´æ–°æ£€æŸ¥æ¸…å•

æ›´æ–°å‰ï¼š
- [ ] æŸ¥çœ‹æ›´æ–°å†…å®¹
- [ ] å¤‡ä»½æ•°æ®åº“
- [ ] å¤‡ä»½é…ç½®æ–‡ä»¶
- [ ] é€šçŸ¥ç”¨æˆ·ï¼ˆå¦‚éœ€è¦ï¼‰

æ›´æ–°ä¸­ï¼š
- [ ] æ‹‰å–æœ€æ–°ä»£ç 
- [ ] æ›´æ–°ä¾èµ–
- [ ] æ„å»ºå‰ç«¯
- [ ] é‡å¯åç«¯

æ›´æ–°åï¼š
- [ ] æ£€æŸ¥æœåŠ¡çŠ¶æ€
- [ ] æŸ¥çœ‹æ—¥å¿—
- [ ] æµ‹è¯•å…³é”®åŠŸèƒ½
- [ ] ç›‘æ§ç³»ç»Ÿè¿è¡Œ

---

## ğŸ¯ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# æ›´æ–°ä»£ç 
cd /www/wwwroot/CRM && git pull origin main

# ä¸€é”®æ›´æ–°ï¼ˆä½¿ç”¨è„šæœ¬ï¼‰
cd /www/wwwroot/CRM && ./update.sh

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs crm-backend

# é‡å¯æœåŠ¡
pm2 restart crm-backend

# æŸ¥çœ‹æ›´æ–°å†å²
git log --oneline -10

# å›æ»šç‰ˆæœ¬
git reset --hard æäº¤ID
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å®šæœŸæ›´æ–°
- å»ºè®®æ¯å‘¨æ£€æŸ¥ä¸€æ¬¡æ›´æ–°
- é‡è¦æ›´æ–°åŠæ—¶åº”ç”¨

### 2. ä¿æŒé…ç½®æ–‡ä»¶ç‹¬ç«‹
- ä¸è¦ä¿®æ”¹ `.env.example`
- åªä¿®æ”¹ `.env` æ–‡ä»¶
- `.env` æ–‡ä»¶ä¸ä¼šè¢« Git è¦†ç›–

### 3. ä½¿ç”¨ç‰ˆæœ¬æ ‡ç­¾
```bash
# æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬æ ‡ç­¾
git tag

# åˆ‡æ¢åˆ°æŒ‡å®šç‰ˆæœ¬
git checkout v1.0.0
```

### 4. ç›‘æ§æ›´æ–°
- å…³æ³¨ GitHub ä»“åº“çš„ Release é¡µé¢
- è®¢é˜…æ›´æ–°é€šçŸ¥

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæ›´æ–°è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
2. å‚è€ƒå¸¸è§é—®é¢˜éƒ¨åˆ†
3. åœ¨ GitHub æäº¤ Issue
4. è”ç³»æŠ€æœ¯æ”¯æŒ

---

**ç‰ˆæœ¬**ï¼šv1.0  
**æ›´æ–°æ—¥æœŸ**ï¼š2024-11-23  
**é€‚ç”¨äº**ï¼šCRM ç³»ç»Ÿ v1.8.3+
