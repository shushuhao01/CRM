# 本地开发环境 - 代收相关字段标准

## orders 表必须包含的代收字段

根据 `backend/src/entities/Order.ts` 实体定义，orders 表必须包含以下代收相关字段：

### 1. cod_amount
- **类型**: DECIMAL(10,2)
- **默认值**: 0
- **说明**: 代收金额
- **是否必须**: 是

### 2. cod_status
- **类型**: VARCHAR(20)
- **默认值**: 'pending'
- **说明**: 代收状态
- **可选值**: 
  - pending - 未返款
  - returned - 已返款
  - cancelled - 已取消代收
- **是否必须**: 是

### 3. cod_returned_amount
- **类型**: DECIMAL(10,2)
- **默认值**: 0
- **说明**: 已返款金额
- **是否必须**: 是

### 4. cod_returned_at
- **类型**: DATETIME
- **默认值**: NULL
- **说明**: 返款时间
- **是否必须**: 是

### 5. cod_cancelled_at
- **类型**: DATETIME
- **默认值**: NULL
- **说明**: 取消代收时间
- **是否必须**: 是

### 6. cod_remark
- **类型**: VARCHAR(500)
- **默认值**: NULL
- **说明**: 代收备注
- **是否必须**: 是

### 7. deposit_amount
- **类型**: DECIMAL(10,2)
- **默认值**: 0
- **说明**: 定金金额
- **是否必须**: 是（用于计算代收金额）

## cod_cancel_applications 表结构

### 表名
`cod_cancel_applications` - 代收取消申请表

### 必须字段

| 字段名 | 类型 | 默认值 | 说明 | 是否必须 |
|--------|------|--------|------|----------|
| id | INT AUTO_INCREMENT | - | 主键ID | 是 |
| application_number | VARCHAR(50) | - | 申请单号 | 是 |
| order_id | VARCHAR(50) | - | 订单ID | 是 |
| order_number | VARCHAR(50) | - | 订单号 | 是 |
| customer_id | VARCHAR(50) | - | 客户ID | 是 |
| customer_name | VARCHAR(100) | - | 客户姓名 | 是 |
| customer_phone | VARCHAR(20) | NULL | 客户电话 | 否 |
| original_cod_amount | DECIMAL(10,2) | - | 原代收金额 | 是 |
| current_cod_amount | DECIMAL(10,2) | - | 当前代收金额 | 是 |
| requested_cod_amount | DECIMAL(10,2) | - | 申请代收金额 | 是 |
| cancel_reason | TEXT | - | 取消原因 | 是 |
| payment_proof | JSON | NULL | 尾款凭证 | 否 |
| status | VARCHAR(20) | 'pending' | 申请状态 | 是 |
| applicant_id | VARCHAR(50) | - | 申请人ID | 是 |
| applicant_name | VARCHAR(50) | - | 申请人姓名 | 是 |
| department_id | VARCHAR(36) | NULL | 申请人部门ID | 否 |
| department_name | VARCHAR(50) | NULL | 申请人部门名称 | 否 |
| reviewer_id | VARCHAR(50) | NULL | 审核人ID | 否 |
| reviewer_name | VARCHAR(50) | NULL | 审核人姓名 | 否 |
| review_time | DATETIME | NULL | 审核时间 | 否 |
| review_remark | TEXT | NULL | 审核意见 | 否 |
| created_at | DATETIME | CURRENT_TIMESTAMP | 创建时间 | 是 |
| updated_at | DATETIME | CURRENT_TIMESTAMP | 更新时间 | 是 |

### 索引

- PRIMARY KEY: `id`
- UNIQUE KEY: `application_number`
- INDEX: `order_id`, `order_number`, `status`, `applicant_id`, `created_at`

## 对比检查清单

执行 `检查生产环境数据库结构.sql` 后，请检查：

### orders 表检查项
- [ ] 是否存在 `cod_amount` 字段
- [ ] 是否存在 `cod_status` 字段
- [ ] 是否存在 `cod_returned_amount` 字段
- [ ] 是否存在 `cod_returned_at` 字段
- [ ] 是否存在 `cod_cancelled_at` 字段
- [ ] 是否存在 `cod_remark` 字段
- [ ] 是否存在 `deposit_amount` 字段

### cod_cancel_applications 表检查项
- [ ] 表是否存在
- [ ] 所有必须字段是否存在
- [ ] 字段类型是否正确
- [ ] 索引是否创建

## 常见问题

### 问题1：字段名称不一致
如果生产环境使用了不同的字段名（如 `cod_modified` 而不是 `cod_status`），需要：
1. 添加正确的字段
2. 迁移旧字段的数据
3. 删除旧字段（可选）

### 问题2：字段类型不一致
如果字段类型不匹配，需要使用 `ALTER TABLE` 修改字段类型。

### 问题3：缺少字段
使用 `ALTER TABLE ADD COLUMN` 添加缺失的字段。

## 下一步

1. 在生产环境执行 `检查生产环境数据库结构.sql`
2. 将所有结果截图
3. 对比本文档中的标准字段
4. 我会根据差异生成修复SQL
