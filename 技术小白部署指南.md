# 🚀 技术小白专用 - CRM系统宝塔面板部署指南

## 🎯 这个指南适合谁？
- 不懂技术的小白
- 只会用宝塔面板
- 想要一键部署，不想折腾

## 📋 部署前准备

### ✅ 确认你已经有：
1. **宝塔面板** - 已安装并能正常访问
2. **服务器** - Linux系统（推荐CentOS/Ubuntu）
3. **MySQL数据库** - 已配置好数据库和用户权限
4. **域名** - 已解析到服务器IP（可选）

### 🔧 需要安装的环境：
- **Node.js 16+** 
- **PM2** 
- **Nginx**
- **MySQL** - 已预配置数据库

## 🚀 一键部署步骤

### 第1步：安装环境
在宝塔面板的"软件商店"中安装：
- **Node.js** (版本选择 16.x 或更高)
- **PM2管理器**

### 第2步：上传文件
1. 将整个CRM文件夹上传到 `/www/wwwroot/` 目录
2. 如果有域名，建议重命名为你的域名，比如 `abc789.cn`

### 第3步：配置MySQL数据库 🗄️

在运行部署脚本前，请先配置数据库：

1. **修改数据库配置文件**：
```bash
# 编辑后端环境配置
nano backend/.env.production
```

2. **更新数据库信息**：
```env
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=你的数据库用户名
DB_PASSWORD=你的数据库密码
DB_DATABASE=crm
```

### 第4步：一键部署
1. 在宝塔面板点击"终端"
2. 输入以下命令：
```bash
cd /www/wwwroot/你的文件夹名称
chmod +x start.sh
./start.sh
```
3. 等待脚本执行完成（大约2-5分钟）

**脚本会自动：**
- ✅ 检查Node.js环境
- ✅ 安装PM2管理器
- ✅ 构建前端项目
- ✅ 构建后端项目
- ✅ 启动后端服务（连接MySQL）

### 第5步：添加网站
1. 在宝塔面板点击"网站" → "添加站点"
2. 填写信息：
   - **域名**：你的域名（或者IP地址）
   - **根目录**：`/www/wwwroot/你的文件夹名称/dist`
   - **PHP版本**：纯静态
3. 点击"提交"

### 第6步：配置Nginx
1. 点击刚创建的网站后面的"设置"
2. 点击"配置文件"
3. 在配置文件中找到这一段：
```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```
4. 在这段代码**前面**添加：
```nginx
location /api {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
```
5. 点击"保存"

### 第7步：访问系统

## 🎉 完成！

现在你可以通过域名（或IP）访问你的CRM系统了！

## 🔧 常见问题

### Q: 数据库连接失败？
A: 
- 检查MySQL服务是否启动
- 确认数据库用户名密码正确
- 确保数据库 `crm` 已创建
- 检查数据库用户是否有足够权限

### Q: 网站打不开怎么办？
A: 检查以下几点：
1. 确保防火墙开放了80和443端口
2. 检查域名是否正确解析到服务器IP
3. 在宝塔面板查看网站日志

### Q: 后端服务没启动怎么办？
A: 在终端执行：
```bash
pm2 list
```
如果没有看到 `crm-backend`，重新运行部署脚本。

### Q: 如何查看错误日志？
A: 在终端执行：
```bash
pm2 logs crm-backend
```

### Q: 如何重启服务？
A: 在终端执行：
```bash
pm2 restart crm-backend
```

## 📞 需要帮助？
如果遇到问题，可以：
1. 查看宝塔面板的网站日志
2. 查看PM2日志：`pm2 logs crm-backend`
3. 重新运行部署脚本

## 🎯 默认登录信息
- 用户名：admin
- 密码：123456
- **⚠️ 登录后请立即修改密码！**